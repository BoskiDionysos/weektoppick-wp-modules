<?php /**  * MU Safe Loader – ładuje wszystkie MU pluginy (tylko *.php) i loguje postęp/błędy.  * Pliki wyłączone (np. *.off, *.disabled, *.off.php, *.disabled.php) są pomijane.  */ if (!defined('ABSPATH')) exit;  $mu_dir = __DIR__; $log    = WP_CONTENT_DIR . '/uploads/wtp-ro/mu-loader.log';  // upewnij się, że ścieżka na log istnieje @mkdir(dirname($log), 0775, true); @file_put_contents($log, "[".date('c')."] MU Safe Loader init\n", FILE_APPEND);  /** Polyfill dla PHP < 8 (na wszelki wypadek) */ if (!function_exists('str_ends_with')) {     function str_ends_with($haystack, $needle) {         if ($needle === '') return true;         $len = strlen($needle);         return $len === 0 ? true : substr($haystack, -$len) === $needle;     } }  $files = @scandir($mu_dir) ?: []; foreach ($files as $f) {     if ($f === '.' || $f === '..') continue;     if ($f === basename(__FILE__)) continue;      // Ładujemy tylko .php     if (!str_ends_with($f, '.php')) continue;      // Pomijamy pliki oznaczone jako wyłączone     $lower = strtolower($f);     if (str_ends_with($lower, '.off.php') || str_ends_with($lower, '.disabled.php') ||         str_ends_with($lower, '.off')     || str_ends_with($lower, '.disabled')) {         @file_put_contents($log, "[".date('c')."] Skip (disabled): $f\n", FILE_APPEND);         continue;     }      $path = $mu_dir . '/' . $f;     if (!is_file($path)) continue;      try {         include_once $path;         @file_put_contents($log, "[".date('c')."] Loaded: $f\n", FILE_APPEND);     } catch (Throwable $e) {         @file_put_contents(             $log,             "[".date('c')."] ERROR in $f: ".$e->getMessage()."\n",             FILE_APPEND         );     } }