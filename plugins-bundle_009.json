{
    "plugins/litespeed-cache/src/htaccess.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The htaccess rewrite rule operation class\n *\n * @since      1.0.0\n * @package    LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Htaccess extends Root {\n\n\tprivate $frontend_htaccess          = null;\n\tprivate $_default_frontend_htaccess = null;\n\tprivate $backend_htaccess           = null;\n\tprivate $_default_backend_htaccess  = null;\n\tprivate $theme_htaccess             = null; // Not used yet\n\tprivate $frontend_htaccess_readable = false;\n\tprivate $frontend_htaccess_writable = false;\n\tprivate $backend_htaccess_readable  = false;\n\tprivate $backend_htaccess_writable  = false;\n\tprivate $theme_htaccess_readable    = false;\n\tprivate $theme_htaccess_writable    = false;\n\tprivate $__rewrite_on;\n\n\tconst LS_MODULE_START            = '<IfModule LiteSpeed>';\n\tconst EXPIRES_MODULE_START       = '<IfModule mod_expires.c>';\n\tconst LS_MODULE_END              = '</IfModule>';\n\tconst LS_MODULE_REWRITE_START    = '<IfModule mod_rewrite.c>';\n\tconst REWRITE_ON                 = 'RewriteEngine on';\n\tconst LS_MODULE_DONOTEDIT        = '## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##';\n\tconst MARKER                     = 'LSCACHE';\n\tconst MARKER_NONLS               = 'NON_LSCACHE';\n\tconst MARKER_LOGIN_COOKIE        = '### marker LOGIN COOKIE';\n\tconst MARKER_ASYNC               = '### marker ASYNC';\n\tconst MARKER_CRAWLER             = '### marker CRAWLER';\n\tconst MARKER_MOBILE              = '### marker MOBILE';\n\tconst MARKER_NOCACHE_COOKIES     = '### marker NOCACHE COOKIES';\n\tconst MARKER_NOCACHE_USER_AGENTS = '### marker NOCACHE USER AGENTS';\n\tconst MARKER_CACHE_RESOURCE      = '### marker CACHE RESOURCE';\n\tconst MARKER_BROWSER_CACHE       = '### marker BROWSER CACHE';\n\tconst MARKER_MINIFY              = '### marker MINIFY';\n\tconst MARKER_CORS                = '### marker CORS';\n\tconst MARKER_WEBP                = '### marker WEBP';\n\tconst MARKER_DROPQS              = '### marker DROPQS';\n\tconst MARKER_START               = ' start ###';\n\tconst MARKER_END                 = ' end ###';\n\n\tconst RW_PATTERN_RES = '/.*/[^/]*(responsive|css|js|dynamic|loader|fonts)\\.php';\n\n\t/**\n\t * Initialize the class and set its properties.\n\t *\n\t * @since    1.0.7\n\t */\n\tpublic function __construct() {\n\t\t$this->_path_set();\n\t\t$this->_default_frontend_htaccess = $this->frontend_htaccess;\n\t\t$this->_default_backend_htaccess  = $this->backend_htaccess;\n\n\t\t$frontend_htaccess = defined('LITESPEED_CFG_HTACCESS') ? LITESPEED_CFG_HTACCESS : false;\n\t\tif ($frontend_htaccess && substr($frontend_htaccess, -10) === '/.htaccess') {\n\t\t\t$this->frontend_htaccess = $frontend_htaccess;\n\t\t}\n\t\t$backend_htaccess = defined('LITESPEED_CFG_HTACCESS_BACKEND') ? LITESPEED_CFG_HTACCESS_BACKEND : false;\n\t\tif ($backend_htaccess && substr($backend_htaccess, -10) === '/.htaccess') {\n\t\t\t$this->backend_htaccess = $backend_htaccess;\n\t\t}\n\n\t\t// Filter for frontend&backend htaccess path\n\t\t$this->frontend_htaccess = apply_filters('litespeed_frontend_htaccess', $this->frontend_htaccess);\n\t\t$this->backend_htaccess  = apply_filters('litespeed_backend_htaccess', $this->backend_htaccess);\n\n\t\tclearstatcache();\n\n\t\t// frontend .htaccess privilege\n\t\t$test_permissions = file_exists($this->frontend_htaccess) ? $this->frontend_htaccess : dirname($this->frontend_htaccess);\n\t\tif (is_readable($test_permissions)) {\n\t\t\t$this->frontend_htaccess_readable = true;\n\t\t}\n\t\tif (is_writable($test_permissions)) {\n\t\t\t$this->frontend_htaccess_writable = true;\n\t\t}\n\n\t\t$this->__rewrite_on = array(\n\t\t\tself::REWRITE_ON,\n\t\t\t'CacheLookup on',\n\t\t\t'RewriteRule .* - [E=Cache-Control:no-autoflush]',\n\t\t\t'RewriteRule ' . preg_quote(LITESPEED_DATA_FOLDER) . '/debug/.*\\.log$ - [F,L]',\n\t\t\t'RewriteRule ' . preg_quote(self::CONF_FILE) . ' - [F,L]',\n\t\t);\n\n\t\t// backend .htaccess privilege\n\t\tif ($this->frontend_htaccess === $this->backend_htaccess) {\n\t\t\t$this->backend_htaccess_readable = $this->frontend_htaccess_readable;\n\t\t\t$this->backend_htaccess_writable = $this->frontend_htaccess_writable;\n\t\t} else {\n\t\t\t$test_permissions = file_exists($this->backend_htaccess) ? $this->backend_htaccess : dirname($this->backend_htaccess);\n\t\t\tif (is_readable($test_permissions)) {\n\t\t\t\t$this->backend_htaccess_readable = true;\n\t\t\t}\n\t\t\tif (is_writable($test_permissions)) {\n\t\t\t\t$this->backend_htaccess_writable = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get if htaccess file is readable\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t */\n\tprivate function _readable( $kind = 'frontend' ) {\n\t\tif ($kind === 'frontend') {\n\t\t\treturn $this->frontend_htaccess_readable;\n\t\t}\n\t\tif ($kind === 'backend') {\n\t\t\treturn $this->backend_htaccess_readable;\n\t\t}\n\t}\n\n\t/**\n\t * Get if htaccess file is writable\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t */\n\tpublic function writable( $kind = 'frontend' ) {\n\t\tif ($kind === 'frontend') {\n\t\t\treturn $this->frontend_htaccess_writable;\n\t\t}\n\t\tif ($kind === 'backend') {\n\t\t\treturn $this->backend_htaccess_writable;\n\t\t}\n\t}\n\n\t/**\n\t * Get frontend htaccess path\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t */\n\tpublic static function get_frontend_htaccess( $show_default = false ) {\n\t\tif ($show_default) {\n\t\t\treturn self::cls()->_default_frontend_htaccess;\n\t\t}\n\t\treturn self::cls()->frontend_htaccess;\n\t}\n\n\t/**\n\t * Get backend htaccess path\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t */\n\tpublic static function get_backend_htaccess( $show_default = false ) {\n\t\tif ($show_default) {\n\t\t\treturn self::cls()->_default_backend_htaccess;\n\t\t}\n\t\treturn self::cls()->backend_htaccess;\n\t}\n\n\t/**\n\t * Check to see if .htaccess exists starting at $start_path and going up directories until it hits DOCUMENT_ROOT.\n\t *\n\t * As dirname() strips the ending '/', paths passed in must exclude the final '/'\n\t *\n\t * @since 1.0.11\n\t * @access private\n\t */\n\tprivate function _htaccess_search( $start_path ) {\n\t\twhile (!file_exists($start_path . '/.htaccess')) {\n\t\t\tif ($start_path === '/' || !$start_path) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!empty($_SERVER['DOCUMENT_ROOT']) && wp_normalize_path($start_path) === wp_normalize_path($_SERVER['DOCUMENT_ROOT'])) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (dirname($start_path) === $start_path) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$start_path = dirname($start_path);\n\t\t}\n\n\t\treturn $start_path;\n\t}\n\n\t/**\n\t * Set the path class variables.\n\t *\n\t * @since 1.0.11\n\t * @access private\n\t */\n\tprivate function _path_set() {\n\t\t$frontend                 = Router::frontend_path();\n\t\t$frontend_htaccess_search = $this->_htaccess_search($frontend); // The existing .htaccess path to be used for frontend .htaccess\n\t\t$this->frontend_htaccess  = ($frontend_htaccess_search ?: $frontend) . '/.htaccess';\n\n\t\t$backend = realpath(ABSPATH); // /home/user/public_html/backend/\n\t\tif ($frontend == $backend) {\n\t\t\t$this->backend_htaccess = $this->frontend_htaccess;\n\t\t\treturn;\n\t\t}\n\n\t\t// Backend is a different path\n\t\t$backend_htaccess_search = $this->_htaccess_search($backend);\n\t\t// Found affected .htaccess\n\t\tif ($backend_htaccess_search) {\n\t\t\t$this->backend_htaccess = $backend_htaccess_search . '/.htaccess';\n\t\t\treturn;\n\t\t}\n\n\t\t// Frontend path is the parent of backend path\n\t\tif (stripos($backend, $frontend . '/') === 0) {\n\t\t\t// backend use frontend htaccess\n\t\t\t$this->backend_htaccess = $this->frontend_htaccess;\n\t\t\treturn;\n\t\t}\n\n\t\t$this->backend_htaccess = $backend . '/.htaccess';\n\t}\n\n\t/**\n\t * Get corresponding htaccess path\n\t *\n\t * @since 1.1.0\n\t * @param  string $kind Frontend or backend\n\t * @return string       Path\n\t */\n\tpublic function htaccess_path( $kind = 'frontend' ) {\n\t\tswitch ($kind) {\n\t\t\tcase 'backend':\n            $path = $this->backend_htaccess;\n\t\t\t\tbreak;\n\n\t\t\tcase 'frontend':\n\t\t\tdefault:\n            $path = $this->frontend_htaccess;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn $path;\n\t}\n\n\t/**\n\t * Get the content of the rules file.\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.0.4\n\t * @since  2.9 Used exception for failed reading\n\t * @access public\n\t */\n\tpublic function htaccess_read( $kind = 'frontend' ) {\n\t\t$path = $this->htaccess_path($kind);\n\n\t\tif (!$path || !file_exists($path)) {\n\t\t\treturn \"\\n\";\n\t\t}\n\n\t\tif (!$this->_readable($kind)) {\n\t\t\tError::t('HTA_R');\n\t\t}\n\n\t\t$content = File::read($path);\n\t\tif ($content === false) {\n\t\t\tError::t('HTA_GET');\n\t\t}\n\n\t\t// Remove ^M characters.\n\t\t$content = str_ireplace(\"\\x0D\", '', $content);\n\t\treturn $content;\n\t}\n\n\t/**\n\t * Try to backup the .htaccess file if we didn't save one before.\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.0.10\n\t * @access private\n\t */\n\tprivate function _htaccess_backup( $kind = 'frontend' ) {\n\t\t$path = $this->htaccess_path($kind);\n\n\t\tif (!file_exists($path)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (file_exists($path . '.bk')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$res = copy($path, $path . '.bk');\n\n\t\t// Failed to backup, abort\n\t\tif (!$res) {\n\t\t\tError::t('HTA_BK');\n\t\t}\n\t}\n\n\t/**\n\t * Get mobile view rule from htaccess file\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.1.0\n\t */\n\tpublic function current_mobile_agents() {\n\t\t$rules = $this->_get_rule_by(self::MARKER_MOBILE);\n\t\tif (!isset($rules[0])) {\n\t\t\tError::t('HTA_DNF', self::MARKER_MOBILE);\n\t\t}\n\n\t\t$rule = trim($rules[0]);\n\t\t// 'RewriteCond %{HTTP_USER_AGENT} ' . Utility::arr2regex( $cfg[ $id ], true ) . ' [NC]';\n\t\t$match = substr($rule, strlen('RewriteCond %{HTTP_USER_AGENT} '), -strlen(' [NC]'));\n\n\t\tif (!$match) {\n\t\t\tError::t('HTA_DNF', __('Mobile Agent Rules', 'litespeed-cache'));\n\t\t}\n\n\t\treturn $match;\n\t}\n\n\t/**\n\t * Parse rewrites rule from the .htaccess file.\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic function current_login_cookie( $kind = 'frontend' ) {\n\t\t$rule = $this->_get_rule_by(self::MARKER_LOGIN_COOKIE, $kind);\n\n\t\tif (!$rule) {\n\t\t\tError::t('HTA_DNF', self::MARKER_LOGIN_COOKIE);\n\t\t}\n\n\t\tif (strpos($rule, 'RewriteRule .? - [E=') !== 0) {\n\t\t\tError::t('HTA_LOGIN_COOKIE_INVALID');\n\t\t}\n\n\t\t$rule_cookie = substr($rule, strlen('RewriteRule .? - [E='), -1);\n\n\t\tif (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t\t\t$rule_cookie = trim($rule_cookie, '\"');\n\t\t}\n\n\t\t// Drop `Cache-Vary:`\n\t\t$rule_cookie = substr($rule_cookie, strlen('Cache-Vary:'));\n\n\t\treturn $rule_cookie;\n\t}\n\n\t/**\n\t * Get rewrite rules based on the marker\n\t *\n\t * @since  2.0\n\t * @access private\n\t */\n\tprivate function _get_rule_by( $cond, $kind = 'frontend' ) {\n\t\tclearstatcache();\n\t\t$path = $this->htaccess_path($kind);\n\t\tif (!$this->_readable($kind)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$rules = File::extract_from_markers($path, self::MARKER);\n\t\tif (!in_array($cond . self::MARKER_START, $rules) || !in_array($cond . self::MARKER_END, $rules)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$key_start = array_search($cond . self::MARKER_START, $rules);\n\t\t$key_end   = array_search($cond . self::MARKER_END, $rules);\n\t\tif ($key_start === false || $key_end === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$results = array_slice($rules, $key_start + 1, $key_end - $key_start - 1);\n\t\tif (!$results) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (count($results) == 1) {\n\t\t\treturn trim($results[0]);\n\t\t}\n\n\t\treturn array_filter($results);\n\t}\n\n\t/**\n\t * Generate browser cache rules\n\t *\n\t * @since  1.3\n\t * @access private\n\t * @return array Rules set\n\t */\n\tprivate function _browser_cache_rules( $cfg ) {\n\t\t/**\n\t\t * Add ttl setting\n\t\t *\n\t\t * @since 1.6.3\n\t\t */\n\t\t$id    = Base::O_CACHE_TTL_BROWSER;\n\t\t$ttl   = $cfg[$id];\n\t\t$rules = array(\n\t\t\tself::EXPIRES_MODULE_START,\n\t\t\t// '<FilesMatch \"\\.(pdf|ico|svg|xml|jpg|jpeg|png|gif|webp|ogg|mp4|webm|js|css|woff|woff2|ttf|eot)(\\.gz)?$\">',\n\t\t\t'ExpiresActive on',\n\t\t\t'ExpiresByType application/pdf A' . $ttl,\n\t\t\t'ExpiresByType image/x-icon A' . $ttl,\n\t\t\t'ExpiresByType image/vnd.microsoft.icon A' . $ttl,\n\t\t\t'ExpiresByType image/svg+xml A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType image/jpg A' . $ttl,\n\t\t\t'ExpiresByType image/jpeg A' . $ttl,\n\t\t\t'ExpiresByType image/png A' . $ttl,\n\t\t\t'ExpiresByType image/gif A' . $ttl,\n\t\t\t'ExpiresByType image/webp A' . $ttl,\n\t\t\t'ExpiresByType image/avif A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType video/ogg A' . $ttl,\n\t\t\t'ExpiresByType audio/ogg A' . $ttl,\n\t\t\t'ExpiresByType video/mp4 A' . $ttl,\n\t\t\t'ExpiresByType video/webm A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType text/css A' . $ttl,\n\t\t\t'ExpiresByType text/javascript A' . $ttl,\n\t\t\t'ExpiresByType application/javascript A' . $ttl,\n\t\t\t'ExpiresByType application/x-javascript A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType application/x-font-ttf A' . $ttl,\n\t\t\t'ExpiresByType application/x-font-woff A' . $ttl,\n\t\t\t'ExpiresByType application/font-woff A' . $ttl,\n\t\t\t'ExpiresByType application/font-woff2 A' . $ttl,\n\t\t\t'ExpiresByType application/vnd.ms-fontobject A' . $ttl,\n\t\t\t'ExpiresByType font/ttf A' . $ttl,\n\t\t\t'ExpiresByType font/otf A' . $ttl,\n\t\t\t'ExpiresByType font/woff A' . $ttl,\n\t\t\t'ExpiresByType font/woff2 A' . $ttl,\n\t\t\t'',\n\t\t\t// '</FilesMatch>',\n\t\t\tself::LS_MODULE_END,\n\t\t);\n\t\treturn $rules;\n\t}\n\n\t/**\n\t * Generate CORS rules for fonts\n\t *\n\t * @since  1.5\n\t * @access private\n\t * @return array Rules set\n\t */\n\tprivate function _cors_rules() {\n\t\treturn array(\n\t\t\t'<FilesMatch \"\\.(ttf|ttc|otf|eot|woff|woff2|font\\.css)$\">',\n\t\t\t'<IfModule mod_headers.c>',\n\t\t\t'Header set Access-Control-Allow-Origin \"*\"',\n\t\t\t'</IfModule>',\n\t\t\t'</FilesMatch>',\n\t\t);\n\t}\n\n\t/**\n\t * Generate rewrite rules based on settings\n\t *\n\t * @since  1.3\n\t * @access private\n\t * @param  array $cfg  The settings to be used for rewrite rule\n\t * @return array      Rules array\n\t */\n\tprivate function _generate_rules( $cfg ) {\n\t\t$new_rules               = array();\n\t\t$new_rules_nonls         = array();\n\t\t$new_rules_backend       = array();\n\t\t$new_rules_backend_nonls = array();\n\n\t\t// continual crawler\n\t\t// $id = Base::O_CRAWLER;\n\t\t// if (!empty($cfg[$id])) {\n\t\t$new_rules[] = self::MARKER_ASYNC . self::MARKER_START;\n\t\t$new_rules[] = 'RewriteCond %{REQUEST_URI} /wp-admin/admin-ajax\\.php';\n\t\t$new_rules[] = 'RewriteCond %{QUERY_STRING} action=async_litespeed';\n\t\t$new_rules[] = 'RewriteRule .* - [E=noabort:1]';\n\t\t$new_rules[] = self::MARKER_ASYNC . self::MARKER_END;\n\t\t$new_rules[] = '';\n\t\t// }\n\n\t\t// mobile agents\n\t\t$id = Base::O_CACHE_MOBILE_RULES;\n\t\tif ((!empty($cfg[Base::O_CACHE_MOBILE]) || !empty($cfg[Base::O_GUEST])) && !empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_MOBILE . self::MARKER_START;\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} ' . Utility::arr2regex($cfg[$id], true) . ' [NC]';\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+ismobile]';\n\t\t\t$new_rules[] = self::MARKER_MOBILE . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// nocache cookie\n\t\t$id = Base::O_CACHE_EXC_COOKIES;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_COOKIES . self::MARKER_START;\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_COOKIE} ' . Utility::arr2regex($cfg[$id], true);\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:no-cache]';\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_COOKIES . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// nocache user agents\n\t\t$id = Base::O_CACHE_EXC_USERAGENTS;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_USER_AGENTS . self::MARKER_START;\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} ' . Utility::arr2regex($cfg[$id], true) . ' [NC]';\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:no-cache]';\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_USER_AGENTS . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// check login cookie\n\t\t$vary_cookies = $cfg[Base::O_CACHE_VARY_COOKIES];\n\t\t$id           = Base::O_CACHE_LOGIN_COOKIE;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$vary_cookies[] = $cfg[$id];\n\t\t}\n\t\tif (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t\t\t// Need to keep this due to different behavior of OLS when handling response vary header @Sep/22/2018\n\t\t\tif (defined('COOKIEHASH')) {\n\t\t\t\t$vary_cookies[] = ',wp-postpass_' . COOKIEHASH;\n\t\t\t}\n\t\t}\n\t\t$vary_cookies = apply_filters('litespeed_vary_cookies', $vary_cookies); // todo: test if response vary header can work in latest OLS, drop the above two lines\n\t\t// frontend and backend\n\t\tif ($vary_cookies) {\n\t\t\t$env = 'Cache-Vary:' . implode(',', $vary_cookies);\n\t\t\t// if (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t\t\t// }\n\t\t\t$env         = '\"' . $env . '\"';\n\t\t\t$new_rules[] = $new_rules_backend[] = self::MARKER_LOGIN_COOKIE . self::MARKER_START;\n\t\t\t$new_rules[] = $new_rules_backend[] = 'RewriteRule .? - [E=' . $env . ']';\n\t\t\t$new_rules[] = $new_rules_backend[] = self::MARKER_LOGIN_COOKIE . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// CORS font rules\n\t\t$id = Base::O_CDN;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_CORS . self::MARKER_START;\n\t\t\t$new_rules   = array_merge($new_rules, $this->_cors_rules()); // todo: network\n\t\t\t$new_rules[] = self::MARKER_CORS . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// webp support\n\t\t$id = Base::O_IMG_OPTM_WEBP;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$next_gen_format = 'webp';\n\t\t\tif ($cfg[$id] == 2) {\n\t\t\t\t$next_gen_format = 'avif';\n\t\t\t}\n\t\t\t$new_rules[] = self::MARKER_WEBP . self::MARKER_START;\n\t\t\t// Check for WebP support via HTTP_ACCEPT\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_ACCEPT} image/' . $next_gen_format . ' [OR]';\n\n\t\t\t// Check for iPhone browsers (version > 13)\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} iPhone\\ OS\\ (1[4-9]|[2-9][0-9]) [OR]';\n\n\t\t\t// Check for Firefox (version >= 65)\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} Firefox/([6-9][0-9]|[1-9][0-9]{2,})';\n\n\t\t\t// Add vary\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]';\n\t\t\t$new_rules[] = self::MARKER_WEBP . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// drop qs support\n\t\t$id = Base::O_CACHE_DROP_QS;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_DROPQS . self::MARKER_START;\n\t\t\tforeach ($cfg[$id] as $v) {\n\t\t\t\t$new_rules[] = 'CacheKeyModify -qs:' . $v;\n\t\t\t}\n\t\t\t$new_rules[] = self::MARKER_DROPQS . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t// Browser cache\n\t\t$id = Base::O_CACHE_BROWSER;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules_nonls[]       = $new_rules_backend_nonls[] = self::MARKER_BROWSER_CACHE . self::MARKER_START;\n\t\t\t$new_rules_nonls         = array_merge($new_rules_nonls, $this->_browser_cache_rules($cfg));\n\t\t\t$new_rules_backend_nonls = array_merge($new_rules_backend_nonls, $this->_browser_cache_rules($cfg));\n\t\t\t$new_rules_nonls[]       = $new_rules_backend_nonls[] = self::MARKER_BROWSER_CACHE . self::MARKER_END;\n\t\t\t$new_rules_nonls[]       = '';\n\t\t}\n\n\t\t// Add module wrapper for LiteSpeed rules\n\t\tif ($new_rules) {\n\t\t\t$new_rules = $this->_wrap_ls_module($new_rules);\n\t\t}\n\n\t\tif ($new_rules_backend) {\n\t\t\t$new_rules_backend = $this->_wrap_ls_module($new_rules_backend);\n\t\t}\n\n\t\treturn array( $new_rules, $new_rules_backend, $new_rules_nonls, $new_rules_backend_nonls );\n\t}\n\n\t/**\n\t * Add LitSpeed module wrapper with rewrite on\n\t *\n\t * @since  2.1.1\n\t * @access private\n\t */\n\tprivate function _wrap_ls_module( $rules = array() ) {\n\t\treturn array_merge(array( self::LS_MODULE_START ), $this->__rewrite_on, array( '' ), $rules, array( self::LS_MODULE_END ));\n\t}\n\n\t/**\n\t * Insert LitSpeed module wrapper with rewrite on\n\t *\n\t * @since  2.1.1\n\t * @access public\n\t */\n\tpublic function insert_ls_wrapper() {\n\t\t$rules = $this->_wrap_ls_module();\n\t\t$this->_insert_wrapper($rules);\n\t}\n\n\t/**\n\t * wrap rules with module on info\n\t *\n\t * @since  1.1.5\n\t * @param  array $rules\n\t * @return array        wrapped rules with module info\n\t */\n\tprivate function _wrap_do_no_edit( $rules ) {\n\t\t// When to clear rules, don't need DONOTEDIT msg\n\t\tif ($rules === false || !is_array($rules)) {\n\t\t\treturn $rules;\n\t\t}\n\n\t\t$rules = array_merge(array( self::LS_MODULE_DONOTEDIT ), $rules, array( self::LS_MODULE_DONOTEDIT ));\n\n\t\treturn $rules;\n\t}\n\n\t/**\n\t * Write to htaccess with rules\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t */\n\tprivate function _insert_wrapper( $rules = array(), $kind = false, $marker = false ) {\n\t\tif ($kind != 'backend') {\n\t\t\t$kind = 'frontend';\n\t\t}\n\n\t\t// Default marker is LiteSpeed marker `LSCACHE`\n\t\tif ($marker === false) {\n\t\t\t$marker = self::MARKER;\n\t\t}\n\n\t\t$this->_htaccess_backup($kind);\n\n\t\tFile::insert_with_markers($this->htaccess_path($kind), $this->_wrap_do_no_edit($rules), $marker, true);\n\t}\n\n\t/**\n\t * Update rewrite rules based on setting\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.3\n\t * @access public\n\t */\n\tpublic function update( $cfg ) {\n\t\tlist($frontend_rules, $backend_rules, $frontend_rules_nonls, $backend_rules_nonls) = $this->_generate_rules($cfg);\n\n\t\t// Check frontend content\n\t\tlist($rules, $rules_nonls) = $this->_extract_rules();\n\n\t\t// Check Non-LiteSpeed rules\n\t\tif ($this->_wrap_do_no_edit($frontend_rules_nonls) != $rules_nonls) {\n\t\t\tDebug2::debug('[Rules] Update non-ls frontend rules');\n\t\t\t// Need to update frontend htaccess\n\t\t\ttry {\n\t\t\t\t$this->_insert_wrapper($frontend_rules_nonls, false, self::MARKER_NONLS);\n\t\t\t} catch (\\Exception $e) {\n\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->frontend_htaccess, $frontend_rules_nonls, self::MARKER_NONLS);\n\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t}\n\t\t}\n\n\t\t// Check LiteSpeed rules\n\t\tif ($this->_wrap_do_no_edit($frontend_rules) != $rules) {\n\t\t\tDebug2::debug('[Rules] Update frontend rules');\n\t\t\t// Need to update frontend htaccess\n\t\t\ttry {\n\t\t\t\t$this->_insert_wrapper($frontend_rules);\n\t\t\t} catch (\\Exception $e) {\n\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->frontend_htaccess, $frontend_rules);\n\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t}\n\t\t}\n\n\t\tif ($this->frontend_htaccess !== $this->backend_htaccess) {\n\t\t\tlist($rules, $rules_nonls) = $this->_extract_rules('backend');\n\n\t\t\t// Check Non-LiteSpeed rules for backend\n\t\t\tif ($this->_wrap_do_no_edit($backend_rules_nonls) != $rules_nonls) {\n\t\t\t\tDebug2::debug('[Rules] Update non-ls backend rules');\n\t\t\t\t// Need to update frontend htaccess\n\t\t\t\ttry {\n\t\t\t\t\t$this->_insert_wrapper($backend_rules_nonls, 'backend', self::MARKER_NONLS);\n\t\t\t\t} catch (\\Exception $e) {\n\t\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->backend_htaccess, $backend_rules_nonls, self::MARKER_NONLS);\n\t\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check backend content\n\t\t\tif ($this->_wrap_do_no_edit($backend_rules) != $rules) {\n\t\t\t\tDebug2::debug('[Rules] Update backend rules');\n\t\t\t\t// Need to update backend htaccess\n\t\t\t\ttry {\n\t\t\t\t\t$this->_insert_wrapper($backend_rules, 'backend');\n\t\t\t\t} catch (\\Exception $e) {\n\t\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->backend_htaccess, $backend_rules);\n\t\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Get existing rewrite rules\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since  1.3\n\t * @access private\n\t * @param  string $kind Frontend or backend .htaccess file\n\t */\n\tprivate function _extract_rules( $kind = 'frontend' ) {\n\t\tclearstatcache();\n\t\t$path = $this->htaccess_path($kind);\n\t\tif (!$this->_readable($kind)) {\n\t\t\tError::t('E_HTA_R');\n\t\t}\n\n\t\t$rules       = File::extract_from_markers($path, self::MARKER);\n\t\t$rules_nonls = File::extract_from_markers($path, self::MARKER_NONLS);\n\n\t\treturn array( $rules, $rules_nonls );\n\t}\n\n\t/**\n\t * Output the msg with rules plain data for manual insert\n\t *\n\t * @since  1.1.5\n\t * @param  string $file\n\t * @param  array  $rules\n\t * @return string        final msg to output\n\t */\n\tprivate function _rewrite_codes_msg( $file, $rules, $marker = false ) {\n\t\treturn sprintf(\n\t\t\t__('<p>Please add/replace the following codes into the beginning of %1$s:</p> %2$s', 'litespeed-cache'),\n\t\t\t$file,\n\t\t\t'<textarea style=\"width:100%;\" rows=\"10\" readonly>' . htmlspecialchars($this->_wrap_rules_with_marker($rules, $marker)) . '</textarea>'\n\t\t);\n\t}\n\n\t/**\n\t * Generate rules plain data for manual insert\n\t *\n\t * @since  1.1.5\n\t */\n\tprivate function _wrap_rules_with_marker( $rules, $marker = false ) {\n\t\t// Default marker is LiteSpeed marker `LSCACHE`\n\t\tif ($marker === false) {\n\t\t\t$marker = self::MARKER;\n\t\t}\n\n\t\t$start_marker  = \"# BEGIN {$marker}\";\n\t\t$end_marker    = \"# END {$marker}\";\n\t\t$new_file_data = implode(\"\\n\", array_merge(array( $start_marker ), $this->_wrap_do_no_edit($rules), array( $end_marker )));\n\n\t\treturn $new_file_data;\n\t}\n\n\t/**\n\t * Clear the rules file of any changes added by the plugin specifically.\n\t *\n\t * @since 1.0.4\n\t * @access public\n\t */\n\tpublic function clear_rules() {\n\t\t$this->_insert_wrapper(false); // Use false to avoid do-not-edit msg\n\t\t// Clear non ls rules\n\t\t$this->_insert_wrapper(false, false, self::MARKER_NONLS);\n\n\t\tif ($this->frontend_htaccess !== $this->backend_htaccess) {\n\t\t\t$this->_insert_wrapper(false, 'backend');\n\t\t\t$this->_insert_wrapper(false, 'backend', self::MARKER_NONLS);\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/src/purge.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The plugin purge class for X-LiteSpeed-Purge\n *\n * @since       1.1.3\n * @since       2.2 Refactored. Changed access from public to private for most func and class variables.\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Purge extends Base {\n\n\tconst LOG_TAG = '🧹';\n\n\tprotected $_pub_purge    = array();\n\tprotected $_pub_purge2   = array();\n\tprotected $_priv_purge   = array();\n\tprotected $_purge_single = false;\n\n\tconst X_HEADER  = 'X-LiteSpeed-Purge';\n\tconst X_HEADER2 = 'X-LiteSpeed-Purge2';\n\tconst DB_QUEUE  = 'queue';\n\tconst DB_QUEUE2 = 'queue2';\n\n\tconst TYPE_PURGE_ALL          = 'purge_all';\n\tconst TYPE_PURGE_ALL_LSCACHE  = 'purge_all_lscache';\n\tconst TYPE_PURGE_ALL_CSSJS    = 'purge_all_cssjs';\n\tconst TYPE_PURGE_ALL_LOCALRES = 'purge_all_localres';\n\tconst TYPE_PURGE_ALL_CCSS     = 'purge_all_ccss';\n\tconst TYPE_PURGE_ALL_UCSS     = 'purge_all_ucss';\n\tconst TYPE_PURGE_ALL_LQIP     = 'purge_all_lqip';\n\tconst TYPE_PURGE_ALL_AVATAR   = 'purge_all_avatar';\n\tconst TYPE_PURGE_ALL_OBJECT   = 'purge_all_object';\n\tconst TYPE_PURGE_ALL_OPCACHE  = 'purge_all_opcache';\n\n\tconst TYPE_PURGE_FRONT     = 'purge_front';\n\tconst TYPE_PURGE_UCSS      = 'purge_ucss';\n\tconst TYPE_PURGE_FRONTPAGE = 'purge_frontpage';\n\tconst TYPE_PURGE_PAGES     = 'purge_pages';\n\tconst TYPE_PURGE_ERROR     = 'purge_error';\n\n\t/**\n\t * Init hooks\n\t *\n\t * @since  3.0\n\t */\n\tpublic function init() {\n\t\t// Register purge actions.\n\t\t// Most used values: edit_post, save_post, delete_post, wp_trash_post, clean_post_cache, wp_update_comment_count\n\t\t$purge_post_events = apply_filters('litespeed_purge_post_events', array(\n\t\t\t'delete_post',\n\t\t\t'wp_trash_post',\n\t\t\t// 'clean_post_cache', // This will disable wc's not purge product when stock status not change setting\n\t\t\t'wp_update_comment_count', // TODO: check if needed for non ESI\n\t\t));\n\n\t\tforeach ($purge_post_events as $event) {\n\t\t\t// this will purge all related tags\n\t\t\tadd_action($event, array( $this, 'purge_post' ));\n\t\t}\n\n\t\t// Purge post only when status is/was publish\n\t\tadd_action('transition_post_status', array( $this, 'purge_publish' ), 10, 3);\n\n\t\tadd_action('wp_update_comment_count', array( $this, 'purge_feeds' ));\n\n\t\tif ($this->conf(self::O_OPTM_UCSS)) {\n\t\t\tadd_action('edit_post', __NAMESPACE__ . '\\Purge::purge_ucss');\n\t\t}\n\t}\n\n\t/**\n\t * Only purge publish related status post\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic function purge_publish( $new_status, $old_status, $post ) {\n\t\tif ($new_status != 'publish' && $old_status != 'publish') {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->purge_post($post->ID);\n\t}\n\n\t/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  1.8\n\t * @access public\n\t */\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_PURGE_ALL:\n            $this->_purge_all();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_LSCACHE:\n            $this->_purge_all_lscache();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_CSSJS:\n            $this->_purge_all_cssjs();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_LOCALRES:\n            $this->_purge_all_localres();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_CCSS:\n            $this->_purge_all_ccss();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_UCSS:\n            $this->_purge_all_ucss();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_LQIP:\n            $this->_purge_all_lqip();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_AVATAR:\n            $this->_purge_all_avatar();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_OBJECT:\n            $this->_purge_all_object();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_OPCACHE:\n            $this->purge_all_opcache();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_FRONT:\n            $this->_purge_front();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_UCSS:\n            $this->_purge_ucss();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_FRONTPAGE:\n            $this->_purge_frontpage();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_PAGES:\n            $this->_purge_pages();\n\t\t\t\tbreak;\n\n\t\t\tcase strpos($type, self::TYPE_PURGE_ERROR) === 0:\n            $this->_purge_error(substr($type, strlen(self::TYPE_PURGE_ERROR)));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n\n\t/**\n\t * Shortcut to purge all lscache\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t */\n\tpublic static function purge_all( $reason = false ) {\n\t\tself::cls()->_purge_all($reason);\n\t}\n\n\t/**\n\t * Purge all caches (lscache/op/oc)\n\t *\n\t * @since 2.2\n\t * @access private\n\t */\n\tprivate function _purge_all( $reason = false ) {\n\t\t// if ( defined( 'LITESPEED_CLI' ) ) {\n\t\t// Can't send, already has output, need to save and wait for next run\n\t\t// self::update_option( self::DB_QUEUE, $curr_built );\n\t\t// self::debug( 'CLI request, queue stored: ' . $curr_built );\n\t\t// }\n\t\t// else {\n\t\t$this->_purge_all_lscache(true);\n\t\t$this->_purge_all_cssjs(true);\n\t\t$this->_purge_all_localres(true);\n\t\t// $this->_purge_all_ccss( true );\n\t\t// $this->_purge_all_lqip( true );\n\t\t$this->_purge_all_object(true);\n\t\t$this->purge_all_opcache(true);\n\t\t// }\n\n\t\tif ($this->conf(self::O_CDN_CLOUDFLARE_CLEAR)) {\n\t\t\tCDN\\Cloudflare::purge_all('Purge All');\n\t\t}\n\n\t\tif (!is_string($reason)) {\n\t\t\t$reason = false;\n\t\t}\n\n\t\tif ($reason) {\n\t\t\t$reason = \"( $reason )\";\n\t\t}\n\n\t\tself::debug('Purge all ' . $reason, 3);\n\n\t\t$msg = __('Purged all caches successfully.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\n\t\tdo_action('litespeed_purged_all');\n\t}\n\n\t/**\n\t * Alerts LiteSpeed Web Server to purge all pages.\n\t *\n\t * For multisite installs, if this is called by a site admin (not network admin),\n\t * it will only purge all posts associated with that site.\n\t *\n\t * @since 2.2\n\t * @access public\n\t */\n\tprivate function _purge_all_lscache( $silence = false ) {\n\t\t$this->_add('*');\n\n\t\t// Action to run after server was notified to delete LSCache entries.\n\t\tdo_action('litespeed_purged_all_lscache');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Notified LiteSpeed Web Server to purge all LSCache entries.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Delete all critical css\n\t *\n\t * @since    2.3\n\t * @access   private\n\t */\n\tprivate function _purge_all_ccss( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_ccss');\n\n\t\t$this->cls('CSS')->rm_cache_folder('ccss');\n\n\t\t$this->cls('Data')->url_file_clean('ccss');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all Critical CSS files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Delete all unique css\n\t *\n\t * @since    2.3\n\t * @access   private\n\t */\n\tprivate function _purge_all_ucss( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_ucss');\n\n\t\t$this->cls('CSS')->rm_cache_folder('ucss');\n\n\t\t$this->cls('Data')->url_file_clean('ucss');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all Unique CSS files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Purge one UCSS by URL\n\t *\n\t * @since 4.5\n\t * @access public\n\t */\n\tpublic static function purge_ucss( $post_id_or_url ) {\n\t\tself::debug('Purge a single UCSS: ' . $post_id_or_url);\n\t\t// If is post_id, generate URL\n\t\tif (!preg_match('/\\D/', $post_id_or_url)) {\n\t\t\t$post_id_or_url = get_permalink($post_id_or_url);\n\t\t}\n\t\t$post_id_or_url = untrailingslashit($post_id_or_url);\n\n\t\t$existing_url_files = Data::cls()->mark_as_expired($post_id_or_url, true);\n\t\tif ($existing_url_files) {\n\t\t\t// Add to UCSS Q\n\t\t\tself::cls('UCSS')->add_to_q($existing_url_files);\n\t\t}\n\t}\n\n\t/**\n\t * Delete all LQIP images\n\t *\n\t * @since    3.0\n\t * @access   private\n\t */\n\tprivate function _purge_all_lqip( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_lqip');\n\n\t\t$this->cls('Placeholder')->rm_cache_folder('lqip');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all LQIP files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Delete all avatar images\n\t *\n\t * @since    3.0\n\t * @access   private\n\t */\n\tprivate function _purge_all_avatar( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_avatar');\n\n\t\t$this->cls('Avatar')->rm_cache_folder('avatar');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all Gravatar files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Delete all localized JS\n\t *\n\t * @since    3.3\n\t * @access   private\n\t */\n\tprivate function _purge_all_localres( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_localres');\n\n\t\t$this->_add(Tag::TYPE_LOCALRES);\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all localized resource entries.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Alerts LiteSpeed Web Server to purge pages.\n\t *\n\t * @since    1.2.2\n\t * @access   private\n\t */\n\tprivate function _purge_all_cssjs( $silence = false ) {\n\t\tif (wp_doing_cron() || defined('LITESPEED_DID_send_headers')) {\n\t\t\tself::debug('❌ Bypassed cssjs delete as header sent (lscache purge after this point will fail) or doing cron');\n\t\t\treturn;\n\t\t}\n\t\t$this->_purge_all_lscache($silence); // Purge CSSJS must purge lscache too to avoid 404\n\n\t\tdo_action('litespeed_purged_all_cssjs');\n\n\t\tOptimize::update_option(Optimize::ITEM_TIMESTAMP_PURGE_CSS, time());\n\n\t\t$this->_add(Tag::TYPE_MIN);\n\n\t\t$this->cls('CSS')->rm_cache_folder('css');\n\t\t$this->cls('CSS')->rm_cache_folder('js');\n\n\t\t$this->cls('Data')->url_file_clean('css');\n\t\t$this->cls('Data')->url_file_clean('js');\n\n\t\t// Clear UCSS queue as it used combined CSS to generate\n\t\t$this->clear_q('ucss', true);\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Notified LiteSpeed Web Server to purge CSS/JS entries.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Purge opcode cache\n\t *\n\t * @since  1.8.2\n\t * @since  7.3 added test for opcode cache restriction\n\t * @access public\n\t */\n\tpublic function purge_all_opcache( $silence = false ) {\n\t\tif (!Router::opcache_enabled()) {\n\t\t\tself::debug('❌ Failed to reset OPcache due to OPcache not enabled');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = __('OPcache is not enabled.', 'litespeed-cache');\n\t\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::error($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Router::opcache_restricted(__FILE__)) {\n\t\t\tself::debug('❌ Failed to reset OPcache due to OPcache is restricted. File requesting the clear is not allowed.');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = sprintf(__('OPcache is restricted by %s setting.', 'litespeed-cache'), '<code>restrict_api</code>');\n\t\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::error($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Purge opcode cache\n\t\tif (!opcache_reset()) {\n\t\t\tself::debug('❌ Reset OPcache not worked');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = __('Reset the OPcache failed.', 'litespeed-cache');\n\t\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Action to run after opcache purge.\n\t\tdo_action('litespeed_purged_all_opcache');\n\n\t\tself::debug('Reset OPcache');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Reset the entire OPcache successfully.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Purge object cache\n\t *\n\t * @since  3.4\n\t * @access public\n\t */\n\tpublic static function purge_all_object( $silence = true ) {\n\t\tself::cls()->_purge_all_object($silence);\n\t}\n\n\t/**\n\t * Purge object cache\n\t *\n\t * @since  1.8\n\t * @access private\n\t */\n\tprivate function _purge_all_object( $silence = false ) {\n\t\tif (!defined('LSCWP_OBJECT_CACHE')) {\n\t\t\tself::debug('Failed to flush object cache due to object cache not enabled');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = __('Object cache is not enabled.', 'litespeed-cache');\n\t\t\t\tAdmin_Display::error($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tdo_action('litespeed_purged_all_object');\n\n\t\t$this->cls('Object_Cache')->flush();\n\t\tself::debug('Flushed object cache');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Purge all object caches successfully.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Adds new public purge tags to the array of purge tags for the request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param mixed $tags Tags to add to the list.\n\t */\n\tpublic static function add( $tags, $purge2 = false ) {\n\t\tself::cls()->_add($tags, $purge2);\n\t}\n\n\t/**\n\t * Add tags to purge\n\t *\n\t * @since 2.2\n\t * @access private\n\t */\n\tprivate function _add( $tags, $purge2 = false ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\t$tags = $this->_prepend_bid($tags);\n\n\t\tif (!array_diff($tags, $purge2 ? $this->_pub_purge2 : $this->_pub_purge)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ($purge2) {\n\t\t\t$this->_pub_purge2 = array_merge($this->_pub_purge2, $tags);\n\t\t\t$this->_pub_purge2 = array_unique($this->_pub_purge2);\n\t\t} else {\n\t\t\t$this->_pub_purge = array_merge($this->_pub_purge, $tags);\n\t\t\t$this->_pub_purge = array_unique($this->_pub_purge);\n\t\t}\n\t\tself::debug('added ' . implode(',', $tags) . ($purge2 ? ' [Purge2]' : ''), 8);\n\n\t\t// Send purge header immediately\n\t\t$curr_built = $this->_build($purge2);\n\t\tif (defined('LITESPEED_CLI')) {\n\t\t\t// Can't send, already has output, need to save and wait for next run\n\t\t\tself::update_option($purge2 ? self::DB_QUEUE2 : self::DB_QUEUE, $curr_built);\n\t\t\tself::debug('CLI request, queue stored: ' . $curr_built);\n\t\t} else {\n\t\t\t@header($curr_built);\n\t\t\tif (wp_doing_cron() || defined('LITESPEED_DID_send_headers') || apply_filters('litespeed_delay_purge', false)) {\n\t\t\t\tself::update_option($purge2 ? self::DB_QUEUE2 : self::DB_QUEUE, $curr_built);\n\t\t\t\tself::debug('Output existed, queue stored: ' . $curr_built);\n\t\t\t}\n\t\t\tself::debug($curr_built);\n\t\t}\n\t}\n\n\t/**\n\t * Adds new private purge tags to the array of purge tags for the request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param mixed $tags Tags to add to the list.\n\t */\n\tpublic static function add_private( $tags ) {\n\t\tself::cls()->_add_private($tags);\n\t}\n\n\t/**\n\t * Add private ESI tag to purge list\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function add_private_esi( $tag ) {\n\t\tself::add_private(Tag::TYPE_ESI . $tag);\n\t}\n\n\t/**\n\t * Add private all tag to purge list\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function add_private_all() {\n\t\tself::add_private('*');\n\t}\n\n\t/**\n\t * Add tags to private purge\n\t *\n\t * @since 2.2\n\t * @access private\n\t */\n\tprivate function _add_private( $tags ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\t$tags = $this->_prepend_bid($tags);\n\n\t\tif (!array_diff($tags, $this->_priv_purge)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('added [private] ' . implode(',', $tags), 3);\n\n\t\t$this->_priv_purge = array_merge($this->_priv_purge, $tags);\n\t\t$this->_priv_purge = array_unique($this->_priv_purge);\n\n\t\t// Send purge header immediately\n\t\t@header($this->_build());\n\t}\n\n\t/**\n\t * Incorporate blog_id into purge tags for multisite\n\t *\n\t * @since 4.0\n\t * @access private\n\t * @param mixed $tags Tags to add to the list.\n\t */\n\tprivate function _prepend_bid( $tags ) {\n\t\tif (in_array('*', $tags)) {\n\t\t\treturn array( '*' );\n\t\t}\n\n\t\t$curr_bid = is_multisite() ? get_current_blog_id() : '';\n\n\t\tforeach ($tags as $k => $v) {\n\t\t\t$tags[$k] = $curr_bid . '_' . $v;\n\t\t}\n\t\treturn $tags;\n\t}\n\n\t/**\n\t * Activate `purge related tags` for Admin QS.\n\t *\n\t * @since    1.1.3\n\t * @access   public\n\t * @deprecated @7.0 Drop @v7.5\n\t */\n\tpublic static function set_purge_related() {\n\t}\n\n\t/**\n\t * Activate `purge single url tag` for Admin QS.\n\t *\n\t * @since    1.1.3\n\t * @access   public\n\t */\n\tpublic static function set_purge_single() {\n\t\tself::cls()->_purge_single = true;\n\t\tdo_action('litespeed_purged_single');\n\t}\n\n\t/**\n\t * Purge frontend url\n\t *\n\t * @since 1.3\n\t * @since 2.2 Renamed from `frontend_purge`; Access changed from public\n\t * @access private\n\t */\n\tprivate function _purge_front() {\n\t\tif (empty($_SERVER['HTTP_REFERER'])) {\n\t\t\texit('no referer');\n\t\t}\n\n\t\t$this->purge_url($_SERVER['HTTP_REFERER']);\n\n\t\tdo_action('litespeed_purged_front', $_SERVER['HTTP_REFERER']);\n\t\twp_redirect($_SERVER['HTTP_REFERER']);\n\t\texit();\n\t}\n\n\t/**\n\t * Purge single UCSS\n\t *\n\t * @since 4.7\n\t */\n\tprivate function _purge_ucss() {\n\t\tif (empty($_SERVER['HTTP_REFERER'])) {\n\t\t\texit('no referer');\n\t\t}\n\n\t\t$url_tag = empty($_GET['url_tag']) ? $_SERVER['HTTP_REFERER'] : $_GET['url_tag'];\n\n\t\tself::debug('Purge ucss [url_tag] ' . $url_tag);\n\n\t\tdo_action('litespeed_purge_ucss', $url_tag);\n\t\t$this->purge_url($_SERVER['HTTP_REFERER']);\n\n\t\twp_redirect($_SERVER['HTTP_REFERER']);\n\t\texit();\n\t}\n\n\t/**\n\t * Alerts LiteSpeed Web Server to purge the front page.\n\t *\n\t * @since    1.0.3\n\t * @since    2.2    Access changed from public to private, renamed from `_purge_front`\n\t * @access   private\n\t */\n\tprivate function _purge_frontpage() {\n\t\t$this->_add(Tag::TYPE_FRONTPAGE);\n\t\tif (LITESPEED_SERVER_TYPE !== 'LITESPEED_SERVER_OLS') {\n\t\t\t$this->_add_private(Tag::TYPE_FRONTPAGE);\n\t\t}\n\n\t\t$msg = __('Notified LiteSpeed Web Server to purge the front page.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\tdo_action('litespeed_purged_frontpage');\n\t}\n\n\t/**\n\t * Alerts LiteSpeed Web Server to purge pages.\n\t *\n\t * @since    1.0.15\n\t * @access   private\n\t */\n\tprivate function _purge_pages() {\n\t\t$this->_add(Tag::TYPE_PAGES);\n\n\t\t$msg = __('Notified LiteSpeed Web Server to purge all pages.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\tdo_action('litespeed_purged_pages');\n\t}\n\n\t/**\n\t * Alerts LiteSpeed Web Server to purge error pages.\n\t *\n\t * @since    1.0.14\n\t * @access   private\n\t */\n\tprivate function _purge_error( $type = false ) {\n\t\t$this->_add(Tag::TYPE_HTTP);\n\n\t\tif (!$type || !in_array($type, array( '403', '404', '500' ))) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_add(Tag::TYPE_HTTP . $type);\n\n\t\t$msg = __('Notified LiteSpeed Web Server to purge error pages.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t}\n\n\t/**\n\t * Callback to add purge tags if admin selects to purge selected category pages.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t */\n\tpublic function purge_cat( $value ) {\n\t\t$val = trim($value);\n\t\tif (empty($val)) {\n\t\t\treturn;\n\t\t}\n\t\tif (preg_match('/^[a-zA-Z0-9-]+$/', $val) == 0) {\n\t\t\tself::debug(\"$val cat invalid\");\n\t\t\treturn;\n\t\t}\n\t\t$cat = get_category_by_slug($val);\n\t\tif ($cat == false) {\n\t\t\tself::debug(\"$val cat not existed/published\");\n\t\t\treturn;\n\t\t}\n\n\t\tself::add(Tag::TYPE_ARCHIVE_TERM . $cat->term_id);\n\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success(sprintf(__('Purge category %s', 'litespeed-cache'), $val));\n\n\t\t// Action to run after category purge.\n\t\tdo_action('litespeed_purged_cat', $value);\n\t}\n\n\t/**\n\t * Callback to add purge tags if admin selects to purge selected tag pages.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t */\n\tpublic function purge_tag( $val ) {\n\t\t$val = trim($val);\n\t\tif (empty($val)) {\n\t\t\treturn;\n\t\t}\n\t\tif (preg_match('/^[a-zA-Z0-9-]+$/', $val) == 0) {\n\t\t\tself::debug(\"$val tag invalid\");\n\t\t\treturn;\n\t\t}\n\t\t$term = get_term_by('slug', $val, 'post_tag');\n\t\tif ($term === false) {\n\t\t\tself::debug(\"$val tag not exist\");\n\t\t\treturn;\n\t\t}\n\n\t\tself::add(Tag::TYPE_ARCHIVE_TERM . $term->term_id);\n\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success(sprintf(__('Purge tag %s', 'litespeed-cache'), $val));\n\n\t\t// Action to run after tag purge.\n\t\tdo_action('litespeed_purged_tag', $val);\n\t}\n\n\t/**\n\t * Callback to add purge tags if admin selects to purge selected urls.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t */\n\tpublic function purge_url( $url, $purge2 = false, $quite = false ) {\n\t\t$val = trim($url);\n\t\tif (empty($val)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (strpos($val, '<') !== false) {\n\t\t\tself::debug(\"$val url contains <\");\n\t\t\treturn;\n\t\t}\n\n\t\t$val = Utility::make_relative($val);\n\n\t\t$hash = Tag::get_uri_tag($val);\n\n\t\tif ($hash === false) {\n\t\t\tself::debug(\"$val url invalid\");\n\t\t\treturn;\n\t\t}\n\n\t\tself::add($hash, $purge2);\n\n\t\t!$quite && !defined('LITESPEED_PURGE_SILENT') && Admin_Display::success(sprintf(__('Purge url %s', 'litespeed-cache'), $val));\n\n\t\t// Action to run after url purge.\n\t\tdo_action('litespeed_purged_link', $url);\n\t}\n\n\t/**\n\t * Purge a list of pages when selected by admin. This method will look at the post arguments to determine how and what to purge.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t */\n\tpublic function purge_list() {\n\t\tif (!isset($_REQUEST[Admin_Display::PURGEBYOPT_SELECT]) || !isset($_REQUEST[Admin_Display::PURGEBYOPT_LIST])) {\n\t\t\treturn;\n\t\t}\n\t\t$sel      = $_REQUEST[Admin_Display::PURGEBYOPT_SELECT];\n\t\t$list_buf = $_REQUEST[Admin_Display::PURGEBYOPT_LIST];\n\t\tif (empty($list_buf)) {\n\t\t\treturn;\n\t\t}\n\t\t$list_buf = str_replace(',', \"\\n\", $list_buf); // for cli\n\t\t$list     = explode(\"\\n\", $list_buf);\n\t\tswitch ($sel) {\n\t\t\tcase Admin_Display::PURGEBY_CAT:\n            $cb = 'purge_cat';\n\t\t\t\tbreak;\n\t\t\tcase Admin_Display::PURGEBY_PID:\n            $cb = 'purge_post';\n\t\t\t\tbreak;\n\t\t\tcase Admin_Display::PURGEBY_TAG:\n            $cb = 'purge_tag';\n\t\t\t\tbreak;\n\t\t\tcase Admin_Display::PURGEBY_URL:\n            $cb = 'purge_url';\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t}\n\t\tarray_map(array( $this, $cb ), $list);\n\n\t\t// for redirection\n\t\t$_GET[Admin_Display::PURGEBYOPT_SELECT] = $sel;\n\t}\n\n\t/**\n\t * Purge ESI\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function purge_esi( $tag ) {\n\t\tself::add(Tag::TYPE_ESI . $tag);\n\t\tdo_action('litespeed_purged_esi', $tag);\n\t}\n\n\t/**\n\t * Purge a certain post type\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function purge_posttype( $post_type ) {\n\t\tself::add(Tag::TYPE_ARCHIVE_POSTTYPE . $post_type);\n\t\tself::add($post_type);\n\n\t\tdo_action('litespeed_purged_posttype', $post_type);\n\t}\n\n\t/**\n\t * Purge all related tags to a post.\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t */\n\tpublic function purge_post( $pid ) {\n\t\t$pid = intval($pid);\n\t\t// ignore the status we don't care\n\t\tif (!$pid || !in_array(get_post_status($pid), array( 'publish', 'trash', 'private', 'draft' ))) {\n\t\t\treturn;\n\t\t}\n\n\t\t$purge_tags = $this->_get_purge_tags_by_post($pid);\n\t\tif (!$purge_tags) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::add($purge_tags);\n\t\tif ($this->conf(self::O_CACHE_REST)) {\n\t\t\tself::add(Tag::TYPE_REST);\n\t\t}\n\n\t\t// $this->cls( 'Control' )->set_stale();\n\t\tdo_action('litespeed_purged_post', $pid);\n\t}\n\n\t/**\n\t * Hooked to the load-widgets.php action.\n\t * Attempts to purge a single widget from cache.\n\t * If no widget id is passed in, the method will attempt to find the widget id.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function purge_widget( $widget_id = null ) {\n\t\tif (is_null($widget_id)) {\n\t\t\t$widget_id = $_POST['widget-id'];\n\t\t\tif (is_null($widget_id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tself::add(Tag::TYPE_WIDGET . $widget_id);\n\t\tself::add_private(Tag::TYPE_WIDGET . $widget_id);\n\n\t\tdo_action('litespeed_purged_widget', $widget_id);\n\t}\n\n\t/**\n\t * Hooked to the wp_update_comment_count action.\n\t * Purges the comment widget when the count is updated.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global type $wp_widget_factory\n\t */\n\tpublic static function purge_comment_widget() {\n\t\tglobal $wp_widget_factory;\n\t\tif (!isset($wp_widget_factory->widgets['WP_Widget_Recent_Comments'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$recent_comments = $wp_widget_factory->widgets['WP_Widget_Recent_Comments'];\n\t\tif (!is_null($recent_comments)) {\n\t\t\tself::add(Tag::TYPE_WIDGET . $recent_comments->id);\n\t\t\tself::add_private(Tag::TYPE_WIDGET . $recent_comments->id);\n\n\t\t\tdo_action('litespeed_purged_comment_widget', $recent_comments->id);\n\t\t}\n\t}\n\n\t/**\n\t * Purges feeds on comment count update.\n\t *\n\t * @since 1.0.9\n\t * @access public\n\t */\n\tpublic function purge_feeds() {\n\t\tif ($this->conf(self::O_CACHE_TTL_FEED) > 0) {\n\t\t\tself::add(Tag::TYPE_FEED);\n\t\t}\n\t\tdo_action('litespeed_purged_feeds');\n\t}\n\n\t/**\n\t * Purges all private cache entries when the user logs out.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic static function purge_on_logout() {\n\t\tself::add_private_all();\n\t\tdo_action('litespeed_purged_on_logout');\n\t}\n\n\t/**\n\t * Generate all purge tags before output\n\t *\n\t * @access private\n\t * @since 1.1.3\n\t */\n\tprivate function _finalize() {\n\t\t// Make sure header output only run once\n\t\tif (!defined('LITESPEED_DID_' . __FUNCTION__)) {\n\t\t\tdefine('LITESPEED_DID_' . __FUNCTION__, true);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_purge_finalize');\n\n\t\t// Append unique uri purge tags if Admin QS is `PURGESINGLE` or `PURGE`\n\t\tif ($this->_purge_single) {\n\t\t\t$tags             = array( Tag::build_uri_tag() );\n\t\t\t$this->_pub_purge = array_merge($this->_pub_purge, $this->_prepend_bid($tags));\n\t\t}\n\n\t\tif (!empty($this->_pub_purge)) {\n\t\t\t$this->_pub_purge = array_unique($this->_pub_purge);\n\t\t}\n\n\t\tif (!empty($this->_priv_purge)) {\n\t\t\t$this->_priv_purge = array_unique($this->_priv_purge);\n\t\t}\n\t}\n\n\t/**\n\t * Gathers all the purge headers.\n\t *\n\t * This will collect all site wide purge tags as well as third party plugin defined purge tags.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return string the built purge header\n\t */\n\tpublic static function output() {\n\t\t$instance = self::cls();\n\n\t\t$instance->_finalize();\n\n\t\treturn $instance->_build();\n\t}\n\n\t/**\n\t * Build the current purge headers.\n\t *\n\t * @since 1.1.5\n\t * @access private\n\t * @return string the built purge header\n\t */\n\tprivate function _build( $purge2 = false ) {\n\t\tif ($purge2) {\n\t\t\tif (empty($this->_pub_purge2)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} elseif (empty($this->_pub_purge) && empty($this->_priv_purge)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$purge_header = '';\n\n\t\t// Handle purge2 @since 4.4.1\n\t\tif ($purge2) {\n\t\t\t$public_tags = $this->_append_prefix($this->_pub_purge2);\n\t\t\tif (empty($public_tags)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$purge_header = self::X_HEADER2 . ': public,';\n\t\t\tif (Control::is_stale()) {\n\t\t\t\t$purge_header .= 'stale,';\n\t\t\t}\n\t\t\t$purge_header .= implode(',', $public_tags);\n\t\t\treturn $purge_header;\n\t\t}\n\n\t\t$private_prefix = self::X_HEADER . ': private,';\n\n\t\tif (!empty($this->_pub_purge)) {\n\t\t\t$public_tags = $this->_append_prefix($this->_pub_purge);\n\t\t\tif (empty($public_tags)) {\n\t\t\t\t// If this ends up empty, private will also end up empty\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$purge_header = self::X_HEADER . ': public,';\n\t\t\tif (Control::is_stale()) {\n\t\t\t\t$purge_header .= 'stale,';\n\t\t\t}\n\t\t\t$purge_header  .= implode(',', $public_tags);\n\t\t\t$private_prefix = ';private,';\n\t\t}\n\n\t\t// Handle priv purge tags\n\t\tif (!empty($this->_priv_purge)) {\n\t\t\t$private_tags  = $this->_append_prefix($this->_priv_purge, true);\n\t\t\t$purge_header .= $private_prefix . implode(',', $private_tags);\n\t\t}\n\n\t\treturn $purge_header;\n\t}\n\n\t/**\n\t * Append prefix to an array of purge headers\n\t *\n\t * @since 1.1.0\n\t * @access private\n\t */\n\tprivate function _append_prefix( $purge_tags, $is_private = false ) {\n\t\t$curr_bid = is_multisite() ? get_current_blog_id() : '';\n\n\t\t$purge_tags = apply_filters('litespeed_purge_tags', $purge_tags, $is_private);\n\t\tif (!in_array('*', $purge_tags)) {\n\t\t\t$tags = array();\n\t\t\tforeach ($purge_tags as $val) {\n\t\t\t\t$tags[] = LSWCP_TAG_PREFIX . $val;\n\t\t\t}\n\t\t\treturn $tags;\n\t\t}\n\n\t\t// Purge All need to check if need to reset crawler or not\n\t\tif (!$is_private && $this->conf(self::O_CRAWLER)) {\n\t\t\tCrawler::cls()->reset_pos();\n\t\t}\n\n\t\tif ((defined('LSWCP_EMPTYCACHE') && LSWCP_EMPTYCACHE) || $is_private) {\n\t\t\treturn array( '*' );\n\t\t}\n\n\t\tif (is_multisite() && !$this->_is_subsite_purge()) {\n\t\t\t$blogs = Activation::get_network_ids();\n\t\t\tif (empty($blogs)) {\n\t\t\t\tself::debug('build_purge_headers: blog list is empty');\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t$tags = array();\n\t\t\tforeach ($blogs as $blog_id) {\n\t\t\t\t$tags[] = LSWCP_TAG_PREFIX . $blog_id . '_';\n\t\t\t}\n\t\t\treturn $tags;\n\t\t} else {\n\t\t\treturn array( LSWCP_TAG_PREFIX . $curr_bid . '_' );\n\t\t}\n\t}\n\n\t/**\n\t * Check if this purge belongs to a subsite purge\n\t *\n\t * @since  4.0\n\t */\n\tprivate function _is_subsite_purge() {\n\t\tif (!is_multisite()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (is_network_admin()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (defined('LSWCP_EMPTYCACHE') && LSWCP_EMPTYCACHE) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Would only use multisite and network admin except is_network_admin is false for ajax calls, which is used by WordPress updates v4.6+\n\t\tif (Router::is_ajax() && (check_ajax_referer('updates', false, false) || check_ajax_referer('litespeed-purgeall-network', false, false))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Gets all the purge tags correlated with the post about to be purged.\n\t *\n\t * If the purge all pages configuration is set, all pages will be purged.\n\t *\n\t * This includes site wide post types (e.g. front page) as well as any third party plugin specific post tags.\n\t *\n\t * @since 1.0.0\n\t * @access private\n\t */\n\tprivate function _get_purge_tags_by_post( $post_id ) {\n\t\t// If this is a valid post we want to purge the post, the home page and any associated tags & cats\n\t\t// If not, purge everything on the site.\n\n\t\t$purge_tags = array();\n\n\t\tif ($this->conf(self::O_PURGE_POST_ALL)) {\n\t\t\t// ignore the rest if purge all\n\t\t\treturn array( '*' );\n\t\t}\n\n\t\t// now do API hook action for post purge\n\t\tdo_action('litespeed_api_purge_post', $post_id);\n\n\t\t// post\n\t\t$purge_tags[] = Tag::TYPE_POST . $post_id;\n\t\t$post_status  = get_post_status($post_id);\n\t\tif (function_exists('is_post_status_viewable')) {\n\t\t\t$viewable = is_post_status_viewable($post_status);\n\t\t\tif ($viewable) {\n\t\t\t\t$purge_tags[] = Tag::get_uri_tag(wp_make_link_relative(get_permalink($post_id)));\n\t\t\t}\n\t\t}\n\n\t\t// for archive of categories|tags|custom tax\n\t\tglobal $post;\n\t\t$original_post = $post;\n\t\t$post          = get_post($post_id);\n\t\t$post_type     = $post->post_type;\n\n\t\tglobal $wp_widget_factory;\n\t\t// recent_posts\n\t\t$recent_posts = isset($wp_widget_factory->widgets['WP_Widget_Recent_Posts']) ? $wp_widget_factory->widgets['WP_Widget_Recent_Posts'] : null;\n\t\tif (!is_null($recent_posts)) {\n\t\t\t$purge_tags[] = Tag::TYPE_WIDGET . $recent_posts->id;\n\t\t}\n\n\t\t// get adjacent posts id as related post tag\n\t\tif ($post_type == 'post') {\n\t\t\t$prev_post = get_previous_post();\n\t\t\t$next_post = get_next_post();\n\t\t\tif (!empty($prev_post->ID)) {\n\t\t\t\t$purge_tags[] = Tag::TYPE_POST . $prev_post->ID;\n\t\t\t\tself::debug('--------purge_tags prev is: ' . $prev_post->ID);\n\t\t\t}\n\t\t\tif (!empty($next_post->ID)) {\n\t\t\t\t$purge_tags[] = Tag::TYPE_POST . $next_post->ID;\n\t\t\t\tself::debug('--------purge_tags next is: ' . $next_post->ID);\n\t\t\t}\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_TERM)) {\n\t\t\t$taxonomies = get_object_taxonomies($post_type);\n\t\t\t// self::debug('purge by post, check tax = ' . var_export($taxonomies, true));\n\t\t\tforeach ($taxonomies as $tax) {\n\t\t\t\t$terms = get_the_terms($post_id, $tax);\n\t\t\t\tif (!empty($terms)) {\n\t\t\t\t\tforeach ($terms as $term) {\n\t\t\t\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_TERM . $term->term_id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ($this->conf(self::O_CACHE_TTL_FEED)) {\n\t\t\t$purge_tags[] = Tag::TYPE_FEED;\n\t\t}\n\n\t\t// author, for author posts and feed list\n\t\tif ($this->conf(self::O_PURGE_POST_AUTHOR)) {\n\t\t\t$purge_tags[] = Tag::TYPE_AUTHOR . get_post_field('post_author', $post_id);\n\t\t}\n\n\t\t// archive and feed of post type\n\t\t// todo: check if type contains space\n\t\tif ($this->conf(self::O_PURGE_POST_POSTTYPE)) {\n\t\t\tif (get_post_type_archive_link($post_type)) {\n\t\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_POSTTYPE . $post_type;\n\t\t\t\t$purge_tags[] = $post_type;\n\t\t\t}\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_FRONTPAGE)) {\n\t\t\t$purge_tags[] = Tag::TYPE_FRONTPAGE;\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_HOMEPAGE)) {\n\t\t\t$purge_tags[] = Tag::TYPE_HOME;\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_PAGES)) {\n\t\t\t$purge_tags[] = Tag::TYPE_PAGES;\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_PAGES_WITH_RECENT_POSTS)) {\n\t\t\t$purge_tags[] = Tag::TYPE_PAGES_WITH_RECENT_POSTS;\n\t\t}\n\n\t\t// if configured to have archived by date\n\t\t$date = $post->post_date;\n\t\t$date = strtotime($date);\n\n\t\tif ($this->conf(self::O_PURGE_POST_DATE)) {\n\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_DATE . date('Ymd', $date);\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_MONTH)) {\n\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_DATE . date('Ym', $date);\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_YEAR)) {\n\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_DATE . date('Y', $date);\n\t\t}\n\n\t\t// Set back to original post as $post_id might affecting the global $post value\n\t\t$post = $original_post;\n\n\t\treturn array_unique($purge_tags);\n\t}\n\n\t/**\n\t * The dummy filter for purge all\n\t *\n\t * @since 1.1.5\n\t * @access public\n\t * @param string $val The filter value\n\t * @return string     The filter value\n\t */\n\tpublic static function filter_with_purge_all( $val ) {\n\t\tself::purge_all();\n\t\treturn $val;\n\t}\n}\n",
    "plugins/litespeed-cache/src/utility.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The utility class.\n *\n * @since       1.1.5\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Utility extends Root {\n\n\tprivate static $_internal_domains;\n\n\t/**\n\t * Validate regex\n\t *\n\t * @since 1.0.9\n\t * @since  3.0 Moved here from admin-settings.cls\n\t * @access public\n\t * @return bool True for valid rules, false otherwise.\n\t */\n\tpublic static function syntax_checker( $rules ) {\n\t\treturn preg_match(self::arr2regex($rules), '') !== false;\n\t}\n\n\t/**\n\t * Combine regex array to regex rule\n\t *\n\t * @since  3.0\n\t */\n\tpublic static function arr2regex( $arr, $drop_delimiter = false ) {\n\t\t$arr = self::sanitize_lines($arr);\n\n\t\t$new_arr = array();\n\t\tforeach ($arr as $v) {\n\t\t\t$new_arr[] = preg_quote($v, '#');\n\t\t}\n\n\t\t$regex = implode('|', $new_arr);\n\t\t$regex = str_replace(' ', '\\\\ ', $regex);\n\n\t\tif ($drop_delimiter) {\n\t\t\treturn $regex;\n\t\t}\n\n\t\treturn '#' . $regex . '#';\n\t}\n\n\t/**\n\t * Replace wildcard to regex\n\t *\n\t * @since  3.2.2\n\t */\n\tpublic static function wildcard2regex( $string ) {\n\t\tif (is_array($string)) {\n\t\t\treturn array_map(__CLASS__ . '::wildcard2regex', $string);\n\t\t}\n\n\t\tif (strpos($string, '*') !== false) {\n\t\t\t$string = preg_quote($string, '#');\n\t\t\t$string = str_replace('\\*', '.*', $string);\n\t\t}\n\n\t\treturn $string;\n\t}\n\n\t/**\n\t * Check if an URL or current page is REST req or not\n\t *\n\t * @since  2.9.3\n\t * @deprecated 2.9.4 Moved to REST class\n\t * @access public\n\t */\n\tpublic static function is_rest( $url = false ) {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Get current page type\n\t *\n\t * @since  2.9\n\t */\n\tpublic static function page_type() {\n\t\tglobal $wp_query;\n\t\t$page_type = 'default';\n\n\t\tif ($wp_query->is_page) {\n\t\t\t$page_type = is_front_page() ? 'front' : 'page';\n\t\t} elseif ($wp_query->is_home) {\n\t\t\t$page_type = 'home';\n\t\t} elseif ($wp_query->is_single) {\n\t\t\t// $page_type = $wp_query->is_attachment ? 'attachment' : 'single';\n\t\t\t$page_type = get_post_type();\n\t\t} elseif ($wp_query->is_category) {\n\t\t\t$page_type = 'category';\n\t\t} elseif ($wp_query->is_tag) {\n\t\t\t$page_type = 'tag';\n\t\t} elseif ($wp_query->is_tax) {\n\t\t\t$page_type = 'tax';\n\t\t\t// $page_type = get_queried_object()->taxonomy;\n\t\t} elseif ($wp_query->is_archive) {\n\t\t\tif ($wp_query->is_day) {\n\t\t\t\t$page_type = 'day';\n\t\t\t} elseif ($wp_query->is_month) {\n\t\t\t\t$page_type = 'month';\n\t\t\t} elseif ($wp_query->is_year) {\n\t\t\t\t$page_type = 'year';\n\t\t\t} elseif ($wp_query->is_author) {\n\t\t\t\t$page_type = 'author';\n\t\t\t} else {\n\t\t\t\t$page_type = 'archive';\n\t\t\t}\n\t\t} elseif ($wp_query->is_search) {\n\t\t\t$page_type = 'search';\n\t\t} elseif ($wp_query->is_404) {\n\t\t\t$page_type = '404';\n\t\t}\n\n\t\treturn $page_type;\n\n\t\t// if ( is_404() ) {\n\t\t// $page_type = '404';\n\t\t// }\n\t\t// elseif ( is_singular() ) {\n\t\t// $page_type = get_post_type();\n\t\t// }\n\t\t// elseif ( is_home() && get_option( 'show_on_front' ) == 'page' ) {\n\t\t// $page_type = 'home';\n\t\t// }\n\t\t// elseif ( is_front_page() ) {\n\t\t// $page_type = 'front';\n\t\t// }\n\t\t// elseif ( is_tax() ) {\n\t\t// $page_type = get_queried_object()->taxonomy;\n\t\t// }\n\t\t// elseif ( is_category() ) {\n\t\t// $page_type = 'category';\n\t\t// }\n\t\t// elseif ( is_tag() ) {\n\t\t// $page_type = 'tag';\n\t\t// }\n\n\t\t// return $page_type;\n\t}\n\n\t/**\n\t * Get ping speed\n\t *\n\t * @since  2.9\n\t */\n\tpublic static function ping( $domain ) {\n\t\tif (strpos($domain, ':')) {\n\t\t\t$domain = parse_url($domain, PHP_URL_HOST);\n\t\t}\n\t\t$starttime = microtime(true);\n\t\t$file      = fsockopen($domain, 443, $errno, $errstr, 10);\n\t\t$stoptime  = microtime(true);\n\t\t$status    = 0;\n\n\t\tif (!$file) {\n\t\t\t$status = 99999;\n\t\t}\n\t\t// Site is down\n\t\telse {\n\t\t\tfclose($file);\n\t\t\t$status = ($stoptime - $starttime) * 1000;\n\t\t\t$status = floor($status);\n\t\t}\n\n\t\tDebug2::debug(\"[Util] ping [Domain] $domain \\t[Speed] $status\");\n\n\t\treturn $status;\n\t}\n\n\t/**\n\t * Set seconds/timestamp to readable format\n\t *\n\t * @since  1.6.5\n\t * @access public\n\t */\n\tpublic static function readable_time( $seconds_or_timestamp, $timeout = 3600, $forward = false ) {\n\t\tif (strlen($seconds_or_timestamp) == 10) {\n\t\t\t$seconds = time() - $seconds_or_timestamp;\n\t\t\tif ($seconds > $timeout) {\n\t\t\t\treturn date('m/d/Y H:i:s', $seconds_or_timestamp + LITESPEED_TIME_OFFSET);\n\t\t\t}\n\t\t} else {\n\t\t\t$seconds = $seconds_or_timestamp;\n\t\t}\n\n\t\t$res = '';\n\t\tif ($seconds > 86400) {\n\t\t\t$num      = floor($seconds / 86400);\n\t\t\t$res     .= $num . 'd';\n\t\t\t$seconds %= 86400;\n\t\t}\n\n\t\tif ($seconds > 3600) {\n\t\t\tif ($res) {\n\t\t\t\t$res .= ', ';\n\t\t\t}\n\t\t\t$num      = floor($seconds / 3600);\n\t\t\t$res     .= $num . 'h';\n\t\t\t$seconds %= 3600;\n\t\t}\n\n\t\tif ($seconds > 60) {\n\t\t\tif ($res) {\n\t\t\t\t$res .= ', ';\n\t\t\t}\n\t\t\t$num      = floor($seconds / 60);\n\t\t\t$res     .= $num . 'm';\n\t\t\t$seconds %= 60;\n\t\t}\n\n\t\tif ($seconds > 0) {\n\t\t\tif ($res) {\n\t\t\t\t$res .= ' ';\n\t\t\t}\n\t\t\t$res .= $seconds . 's';\n\t\t}\n\n\t\tif (!$res) {\n\t\t\treturn $forward ? __('right now', 'litespeed-cache') : __('just now', 'litespeed-cache');\n\t\t}\n\n\t\t$res = $forward ? $res : sprintf(__(' %s ago', 'litespeed-cache'), $res);\n\n\t\treturn $res;\n\t}\n\n\t/**\n\t * Convert array to string\n\t *\n\t * @since  1.6\n\t * @access public\n\t */\n\tpublic static function arr2str( $arr ) {\n\t\tif (!is_array($arr)) {\n\t\t\treturn $arr;\n\t\t}\n\n\t\treturn base64_encode(\\json_encode($arr));\n\t}\n\n\t/**\n\t * Get human readable size\n\t *\n\t * @since  1.6\n\t * @access public\n\t */\n\tpublic static function real_size( $filesize, $is_1000 = false ) {\n\t\t$unit = $is_1000 ? 1000 : 1024;\n\n\t\tif ($filesize >= pow($unit, 3)) {\n\t\t\t$filesize = round(($filesize / pow($unit, 3)) * 100) / 100 . 'G';\n\t\t} elseif ($filesize >= pow($unit, 2)) {\n\t\t\t$filesize = round(($filesize / pow($unit, 2)) * 100) / 100 . 'M';\n\t\t} elseif ($filesize >= $unit) {\n\t\t\t$filesize = round(($filesize / $unit) * 100) / 100 . 'K';\n\t\t} else {\n\t\t\t$filesize = $filesize . 'B';\n\t\t}\n\t\treturn $filesize;\n\t}\n\n\t/**\n\t * Parse attributes from string\n\t *\n\t * @since  1.2.2\n\t * @since  1.4 Moved from optimize to utility\n\t * @access private\n\t * @param  string $str\n\t * @return array  All the attributes\n\t */\n\tpublic static function parse_attr( $str ) {\n\t\t$attrs = array();\n\t\tpreg_match_all('#([\\w-]+)=([\"\\'])([^\\2]*)\\2#isU', $str, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$attrs[$match[1]] = trim($match[3]);\n\t\t}\n\t\treturn $attrs;\n\t}\n\n\t/**\n\t * Check if an array has a string\n\t *\n\t * Support $ exact match\n\t *\n\t * @since 1.3\n\t * @access private\n\t * @param string $needle The string to search with\n\t * @param array  $haystack\n\t * @return bool|string False if not found, otherwise return the matched string in haystack.\n\t */\n\tpublic static function str_hit_array( $needle, $haystack, $has_ttl = false ) {\n\t\tif (!$haystack) {\n\t\t\treturn false;\n\t\t}\n\t\t/**\n\t\t * Safety check to avoid PHP warning\n\t\t *\n\t\t * @see  https://github.com/litespeedtech/lscache_wp/pull/131/commits/45fc03af308c7d6b5583d1664fad68f75fb6d017\n\t\t */\n\t\tif (!is_array($haystack)) {\n\t\t\tDebug2::debug('[Util] ❌ bad param in str_hit_array()!');\n\n\t\t\treturn false;\n\t\t}\n\n\t\t$hit      = false;\n\t\t$this_ttl = 0;\n\t\tforeach ($haystack as $item) {\n\t\t\tif (!$item) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($has_ttl) {\n\t\t\t\t$this_ttl = 0;\n\t\t\t\t$item     = explode(' ', $item);\n\t\t\t\tif (!empty($item[1])) {\n\t\t\t\t\t$this_ttl = $item[1];\n\t\t\t\t}\n\t\t\t\t$item = $item[0];\n\t\t\t}\n\n\t\t\tif (substr($item, 0, 1) === '^' && substr($item, -1) === '$') {\n\t\t\t\t// do exact match\n\t\t\t\tif (substr($item, 1, -1) === $needle) {\n\t\t\t\t\t$hit = $item;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} elseif (substr($item, -1) === '$') {\n\t\t\t\t// match end\n\t\t\t\tif (substr($item, 0, -1) === substr($needle, -strlen($item) + 1)) {\n\t\t\t\t\t$hit = $item;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} elseif (substr($item, 0, 1) === '^') {\n\t\t\t\t// match beginning\n\t\t\t\tif (substr($item, 1) === substr($needle, 0, strlen($item) - 1)) {\n\t\t\t\t\t$hit = $item;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} elseif (strpos($needle, $item) !== false) {\n\t\t\t\t$hit = $item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ($hit) {\n\t\t\tif ($has_ttl) {\n\t\t\t\treturn array( $hit, $this_ttl );\n\t\t\t}\n\n\t\t\treturn $hit;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Improve compatibility to PHP old versions\n\t *\n\t * @since  1.2.2\n\t */\n\tpublic static function compatibility() {\n\t\trequire_once LSCWP_DIR . 'lib/php-compatibility.func.php';\n\t}\n\n\t/**\n\t * Convert URI to URL\n\t *\n\t * @since  1.3\n\t * @access public\n\t * @param  string $uri `xx/xx.html` or `/subfolder/xx/xx.html`\n\t * @return  string http://www.example.com/subfolder/xx/xx.html\n\t */\n\tpublic static function uri2url( $uri ) {\n\t\tif (substr($uri, 0, 1) === '/') {\n\t\t\tself::domain_const();\n\t\t\t$url = LSCWP_DOMAIN . $uri;\n\t\t} else {\n\t\t\t$url = home_url('/') . $uri;\n\t\t}\n\n\t\treturn $url;\n\t}\n\n\t/**\n\t * Convert URL to basename (filename)\n\t *\n\t * @since  4.7\n\t */\n\tpublic static function basename( $url ) {\n\t\t$url      = trim($url);\n\t\t$uri      = @parse_url($url, PHP_URL_PATH);\n\t\t$basename = pathinfo($uri, PATHINFO_BASENAME);\n\n\t\treturn $basename;\n\t}\n\n\t/**\n\t * Drop .webp and .avif if existed in filename\n\t *\n\t * @since  4.7\n\t */\n\tpublic static function drop_webp( $filename ) {\n\t\tif (in_array(substr($filename, -5), array( '.webp', '.avif' ))) {\n\t\t\t$filename = substr($filename, 0, -5);\n\t\t}\n\n\t\treturn $filename;\n\t}\n\n\t/**\n\t * Convert URL to URI\n\t *\n\t * @since  1.2.2\n\t * @since  1.6.2.1 Added 2nd param keep_qs\n\t * @access public\n\t */\n\tpublic static function url2uri( $url, $keep_qs = false ) {\n\t\t$url = trim($url);\n\t\t$uri = @parse_url($url, PHP_URL_PATH);\n\t\t$qs  = @parse_url($url, PHP_URL_QUERY);\n\n\t\tif (!$keep_qs || !$qs) {\n\t\t\treturn $uri;\n\t\t}\n\n\t\treturn $uri . '?' . $qs;\n\t}\n\n\t/**\n\t * Get attachment relative path to upload folder\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param  string $url `https://aa.com/bbb/wp-content/upload/2018/08/test.jpg` or `/bbb/wp-content/upload/2018/08/test.jpg`\n\t * @return string   `2018/08/test.jpg`\n\t */\n\tpublic static function att_short_path( $url ) {\n\t\tif (!defined('LITESPEED_UPLOAD_PATH')) {\n\t\t\t$_wp_upload_dir = wp_upload_dir();\n\n\t\t\t$upload_path = self::url2uri($_wp_upload_dir['baseurl']);\n\n\t\t\tdefine('LITESPEED_UPLOAD_PATH', $upload_path);\n\t\t}\n\n\t\t$local_file = self::url2uri($url);\n\n\t\t$short_path = substr($local_file, strlen(LITESPEED_UPLOAD_PATH) + 1);\n\n\t\treturn $short_path;\n\t}\n\n\t/**\n\t * Make URL to be relative\n\t *\n\t * NOTE: for subfolder home_url, will keep subfolder part (strip nothing but scheme and host)\n\t *\n\t * @param  string $url\n\t * @return string      Relative URL, start with /\n\t */\n\tpublic static function make_relative( $url ) {\n\t\t// replace home_url if the url is full url\n\t\tself::domain_const();\n\t\tif (strpos($url, LSCWP_DOMAIN) === 0) {\n\t\t\t$url = substr($url, strlen(LSCWP_DOMAIN));\n\t\t}\n\t\treturn trim($url);\n\t}\n\n\t/**\n\t * Convert URL to domain only\n\t *\n\t * @since  1.7.1\n\t */\n\tpublic static function parse_domain( $url ) {\n\t\t$url = @parse_url($url);\n\t\tif (empty($url['host'])) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!empty($url['scheme'])) {\n\t\t\treturn $url['scheme'] . '://' . $url['host'];\n\t\t}\n\n\t\treturn '//' . $url['host'];\n\t}\n\n\t/**\n\t * Drop protocol `https:` from https://example.com\n\t *\n\t * @since  3.3\n\t */\n\tpublic static function noprotocol( $url ) {\n\t\t$tmp = parse_url(trim($url));\n\t\tif (!empty($tmp['scheme'])) {\n\t\t\t$url = str_replace($tmp['scheme'] . ':', '', $url);\n\t\t}\n\n\t\treturn $url;\n\t}\n\n\t/**\n\t * Validate ip v4\n\t *\n\t * @since 5.5\n\t */\n\tpublic static function valid_ipv4( $ip ) {\n\t\treturn filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4 | FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE);\n\t}\n\n\t/**\n\t * Generate domain const\n\t *\n\t * This will generate http://www.example.com even there is a subfolder in home_url setting\n\t *\n\t * Conf LSCWP_DOMAIN has NO trailing /\n\t *\n\t * @since  1.3\n\t * @access public\n\t */\n\tpublic static function domain_const() {\n\t\tif (defined('LSCWP_DOMAIN')) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::compatibility();\n\t\t$domain = http_build_url(get_home_url(), array(), HTTP_URL_STRIP_ALL);\n\n\t\tdefine('LSCWP_DOMAIN', $domain);\n\t}\n\n\t/**\n\t * Array map one textarea to sanitize the url\n\t *\n\t * @since  1.3\n\t * @access public\n\t * @param  array|string $arr\n\t * @param  string|null  $type String handler type\n\t * @return string|array\n\t */\n\tpublic static function sanitize_lines( $arr, $type = null ) {\n\t\t$types = $type ? explode(',', $type) : array();\n\n\t\tif (!$arr) {\n\t\t\tif ($type === 'string') {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\treturn array();\n\t\t}\n\n\t\tif (!is_array($arr)) {\n\t\t\t$arr = explode(\"\\n\", $arr);\n\t\t}\n\n\t\t$arr     = array_map('trim', $arr);\n\t\t$changed = false;\n\t\tif (in_array('uri', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::url2uri', $arr);\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('basename', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::basename', $arr);\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('drop_webp', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::drop_webp', $arr);\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('relative', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::make_relative', $arr); // Remove domain\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('domain', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::parse_domain', $arr); // Only keep domain\n\t\t\t$changed = true;\n\t\t}\n\n\t\tif (in_array('noprotocol', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::noprotocol', $arr); // Drop protocol, `https://example.com` -> `//example.com`\n\t\t\t$changed = true;\n\t\t}\n\n\t\tif (in_array('trailingslash', $types)) {\n\t\t\t$arr     = array_map('trailingslashit', $arr); // Append trailing slash, `https://example.com` -> `https://example.com/`\n\t\t\t$changed = true;\n\t\t}\n\n\t\tif ($changed) {\n\t\t\t$arr = array_map('trim', $arr);\n\t\t}\n\t\t$arr = array_unique($arr);\n\t\t$arr = array_filter($arr);\n\n\t\tif (in_array('string', $types)) {\n\t\t\treturn implode(\"\\n\", $arr);\n\t\t}\n\n\t\treturn $arr;\n\t}\n\n\t/**\n\t * Builds an url with an action and a nonce.\n\t *\n\t * Assumes user capabilities are already checked.\n\t *\n\t * @since  1.6 Changed order of 2nd&3rd param, changed 3rd param `append_str` to 2nd `type`\n\t * @access public\n\t * @return string The built url.\n\t */\n\tpublic static function build_url( $action, $type = false, $is_ajax = false, $page = null, $append_arr = array(), $unescape = false ) {\n\t\t$prefix = '?';\n\n\t\tif ($page === '_ori') {\n\t\t\t$page                         = true;\n\t\t\t$append_arr['_litespeed_ori'] = 1;\n\t\t}\n\n\t\tif (!$is_ajax) {\n\t\t\tif ($page) {\n\t\t\t\t// If use admin url\n\t\t\t\tif ($page === true) {\n\t\t\t\t\t$page = 'admin.php';\n\t\t\t\t} elseif (strpos($page, '?') !== false) {\n\t\t\t\t\t$prefix = '&';\n\t\t\t\t}\n\t\t\t\t$combined = $page . $prefix . Router::ACTION . '=' . $action;\n\t\t\t} else {\n\t\t\t\t// Current page rebuild URL\n\t\t\t\t$params = $_GET;\n\n\t\t\t\tif (!empty($params)) {\n\t\t\t\t\tif (isset($params[Router::ACTION])) {\n\t\t\t\t\t\tunset($params[Router::ACTION]);\n\t\t\t\t\t}\n\t\t\t\t\tif (isset($params['_wpnonce'])) {\n\t\t\t\t\t\tunset($params['_wpnonce']);\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty($params)) {\n\t\t\t\t\t\t$prefix .= http_build_query($params) . '&';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tglobal $pagenow;\n\t\t\t\t$combined = $pagenow . $prefix . Router::ACTION . '=' . $action;\n\t\t\t}\n\t\t} else {\n\t\t\t$combined = 'admin-ajax.php?action=litespeed_ajax&' . Router::ACTION . '=' . $action;\n\t\t}\n\n\t\tif (is_network_admin()) {\n\t\t\t$prenonce = network_admin_url($combined);\n\t\t} else {\n\t\t\t$prenonce = admin_url($combined);\n\t\t}\n\t\t$url = wp_nonce_url($prenonce, $action, Router::NONCE);\n\n\t\tif ($type) {\n\t\t\t// Remove potential param `type` from url\n\t\t\t$url = parse_url(htmlspecialchars_decode($url));\n\t\t\tparse_str($url['query'], $query);\n\n\t\t\t$built_arr = array_merge($query, array( Router::TYPE => $type ));\n\t\t\tif ($append_arr) {\n\t\t\t\t$built_arr = array_merge($built_arr, $append_arr);\n\t\t\t}\n\t\t\t$url['query'] = http_build_query($built_arr);\n\t\t\tself::compatibility();\n\t\t\t$url = http_build_url($url);\n\t\t\t$url = htmlspecialchars($url, ENT_QUOTES, 'UTF-8');\n\t\t}\n\n\t\tif ($unescape) {\n\t\t\t$url = wp_specialchars_decode($url);\n\t\t}\n\n\t\treturn $url;\n\t}\n\n\t/**\n\t * Check if the host is the internal host\n\t *\n\t * @since  1.2.3\n\t */\n\tpublic static function internal( $host ) {\n\t\tif (!defined('LITESPEED_FRONTEND_HOST')) {\n\t\t\tif (defined('WP_HOME')) {\n\t\t\t\t$home_host = WP_HOME; // Also think of `WP_SITEURL`\n\t\t\t} else {\n\t\t\t\t$home_host = get_option('home');\n\t\t\t}\n\t\t\tdefine('LITESPEED_FRONTEND_HOST', parse_url($home_host, PHP_URL_HOST));\n\t\t}\n\n\t\tif ($host === LITESPEED_FRONTEND_HOST) {\n\t\t\treturn true;\n\t\t}\n\n\t\t/**\n\t\t * Filter for multiple domains\n\t\t *\n\t\t * @since 2.9.4\n\t\t */\n\t\tif (!isset(self::$_internal_domains)) {\n\t\t\tself::$_internal_domains = apply_filters('litespeed_internal_domains', array());\n\t\t}\n\n\t\tif (self::$_internal_domains) {\n\t\t\treturn in_array($host, self::$_internal_domains);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Check if an URL is a internal existing file\n\t *\n\t * @since  1.2.2\n\t * @since  1.6.2 Moved here from optm.cls due to usage of media.cls\n\t * @access public\n\t * @return string|bool The real path of file OR false\n\t */\n\tpublic static function is_internal_file( $url, $addition_postfix = false ) {\n\t\tif (substr($url, 0, 5) == 'data:') {\n\t\t\tDebug2::debug2('[Util] data: content not file');\n\t\t\treturn false;\n\t\t}\n\t\t$url_parsed = parse_url($url);\n\t\tif (isset($url_parsed['host']) && !self::internal($url_parsed['host'])) {\n\t\t\t// Check if is cdn path\n\t\t\t// Do this to avoid user hardcoded src in tpl\n\t\t\tif (!CDN::internal($url_parsed['host'])) {\n\t\t\t\tDebug2::debug2('[Util] external');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (empty($url_parsed['path'])) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Need to replace child blog path for assets, ref: .htaccess\n\t\tif (is_multisite() && defined('PATH_CURRENT_SITE')) {\n\t\t\t$pattern            = '#^' . PATH_CURRENT_SITE . '([_0-9a-zA-Z-]+/)(wp-(content|admin|includes))#U';\n\t\t\t$replacement        = PATH_CURRENT_SITE . '$2';\n\t\t\t$url_parsed['path'] = preg_replace($pattern, $replacement, $url_parsed['path']);\n\t\t\t// $current_blog = (int) get_current_blog_id();\n\t\t\t// $main_blog_id = (int) get_network()->site_id;\n\t\t\t// if ( $current_blog === $main_blog_id ) {\n\t\t\t// define( 'LITESPEED_IS_MAIN_BLOG', true );\n\t\t\t// }\n\t\t\t// else {\n\t\t\t// define( 'LITESPEED_IS_MAIN_BLOG', false );\n\t\t\t// }\n\t\t}\n\n\t\t// Parse file path\n\t\t/**\n\t\t * Trying to fix pure /.htaccess rewrite to /wordpress case\n\t\t *\n\t\t * Add `define( 'LITESPEED_WP_REALPATH', '/wordpress' );` in wp-config.php in this case\n\t\t *\n\t\t * @internal #611001 - Combine & Minify not working?\n\t\t * @since  1.6.3\n\t\t */\n\t\tif (substr($url_parsed['path'], 0, 1) === '/') {\n\t\t\tif (defined('LITESPEED_WP_REALPATH')) {\n\t\t\t\t$file_path_ori = $_SERVER['DOCUMENT_ROOT'] . LITESPEED_WP_REALPATH . $url_parsed['path'];\n\t\t\t} else {\n\t\t\t\t$file_path_ori = $_SERVER['DOCUMENT_ROOT'] . $url_parsed['path'];\n\t\t\t}\n\t\t} else {\n\t\t\t$file_path_ori = Router::frontend_path() . '/' . $url_parsed['path'];\n\t\t}\n\n\t\t/**\n\t\t * Added new file postfix to be check if passed in\n\t\t *\n\t\t * @since 2.2.4\n\t\t */\n\t\tif ($addition_postfix) {\n\t\t\t$file_path_ori .= '.' . $addition_postfix;\n\t\t}\n\n\t\t/**\n\t\t * Added this filter for those plugins which overwrite the filepath\n\t\t *\n\t\t * @see #101091 plugin `Hide My WordPress`\n\t\t * @since 2.2.3\n\t\t */\n\t\t$file_path_ori = apply_filters('litespeed_realpath', $file_path_ori);\n\n\t\t$file_path = realpath($file_path_ori);\n\t\tif (!is_file($file_path)) {\n\t\t\tDebug2::debug2('[Util] file not exist: ' . $file_path_ori);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn array( $file_path, filesize($file_path) );\n\t}\n\n\t/**\n\t * Safely parse URL for v5.3 compatibility\n\t *\n\t * @since  3.4.3\n\t */\n\tpublic static function parse_url_safe( $url, $component = -1 ) {\n\t\tif (substr($url, 0, 2) == '//') {\n\t\t\t$url = 'https:' . $url;\n\t\t}\n\n\t\treturn parse_url($url, $component);\n\t}\n\n\t/**\n\t * Replace url in srcset to new value\n\t *\n\t * @since  2.2.3\n\t */\n\tpublic static function srcset_replace( $content, $callback ) {\n\t\tpreg_match_all('# srcset=([\\'\"])(.+)\\g{1}#iU', $content, $matches);\n\t\t$srcset_ori   = array();\n\t\t$srcset_final = array();\n\t\tforeach ($matches[2] as $k => $urls_ori) {\n\t\t\t$urls_final = explode(',', $urls_ori);\n\n\t\t\t$changed = false;\n\n\t\t\tforeach ($urls_final as $k2 => $url_info) {\n\t\t\t\t$url_info_arr = explode(' ', trim($url_info));\n\n\t\t\t\tif (!($url2 = call_user_func($callback, $url_info_arr[0]))) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$changed = true;\n\n\t\t\t\t$urls_final[$k2] = str_replace($url_info_arr[0], $url2, $url_info);\n\n\t\t\t\tDebug2::debug2('[Util] - srcset replaced to ' . $url2 . (!empty($url_info_arr[1]) ? ' ' . $url_info_arr[1] : ''));\n\t\t\t}\n\n\t\t\tif (!$changed) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$urls_final = implode(',', $urls_final);\n\n\t\t\t$srcset_ori[] = $matches[0][$k];\n\n\t\t\t$srcset_final[] = str_replace($urls_ori, $urls_final, $matches[0][$k]);\n\t\t}\n\n\t\tif ($srcset_ori) {\n\t\t\t$content = str_replace($srcset_ori, $srcset_final, $content);\n\t\t\tDebug2::debug2('[Util] - srcset replaced');\n\t\t}\n\n\t\treturn $content;\n\t}\n\n\t/**\n\t * Generate pagination\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function pagination( $total, $limit, $return_offset = false ) {\n\t\t$pagenum = isset($_GET['pagenum']) ? absint($_GET['pagenum']) : 1;\n\n\t\t$offset       = ($pagenum - 1) * $limit;\n\t\t$num_of_pages = ceil($total / $limit);\n\n\t\tif ($offset > $total) {\n\t\t\t$offset = $total - $limit;\n\t\t}\n\n\t\tif ($offset < 0) {\n\t\t\t$offset = 0;\n\t\t}\n\n\t\tif ($return_offset) {\n\t\t\treturn $offset;\n\t\t}\n\n\t\t$page_links = paginate_links(array(\n\t\t\t'base' => add_query_arg('pagenum', '%#%'),\n\t\t\t'format' => '',\n\t\t\t'prev_text' => '&laquo;',\n\t\t\t'next_text' => '&raquo;',\n\t\t\t'total' => $num_of_pages,\n\t\t\t'current' => $pagenum,\n\t\t));\n\n\t\treturn '<div class=\"tablenav\"><div class=\"tablenav-pages\" style=\"margin: 1em 0\">' . $page_links . '</div></div>';\n\t}\n\n\t/**\n\t * Generate placeholder for an array to query\n\t *\n\t * @since 2.0\n\t * @access public\n\t */\n\tpublic static function chunk_placeholder( $data, $fields ) {\n\t\t$division = substr_count($fields, ',') + 1;\n\n\t\t$q = implode(\n\t\t\t',',\n\t\t\tarray_map(function ( $el ) {\n\t\t\t\treturn '(' . implode(',', $el) . ')';\n\t\t\t}, array_chunk(array_fill(0, count($data), '%s'), $division))\n\t\t);\n\n\t\treturn $q;\n\t}\n}\n",
    "plugins/litespeed-cache/src/doc.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The Doc class.\n *\n * @since       2.2.7\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Doc {\n\n\t// protected static $_instance;\n\n\t/**\n\t * Show option is actually ON by GM\n\t *\n\t * @since  5.5\n\t * @access public\n\t */\n\tpublic static function maybe_on_by_gm( $id ) {\n\t\tif (apply_filters('litespeed_conf', $id)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!apply_filters('litespeed_conf', Base::O_GUEST)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!apply_filters('litespeed_conf', Base::O_GUEST_OPTM)) {\n\t\t\treturn;\n\t\t}\n\t\techo '<font class=\"litespeed-warning\">';\n\t\techo '⚠️ ' .\n\t\t\tsprintf(\n\t\t\t\t__('This setting is %1$s for certain qualifying requests due to %2$s!', 'litespeed-cache'),\n\t\t\t\t'<code>' . __('ON', 'litespeed-cache') . '</code>',\n\t\t\t\tLang::title(Base::O_GUEST_OPTM)\n\t\t\t);\n\t\tself::learn_more('https://docs.litespeedtech.com/lscache/lscwp/general/#guest-optimization');\n\t\techo '</font>';\n\t}\n\n\t/**\n\t * Changes affect crawler list warning\n\t *\n\t * @since  4.3\n\t * @access public\n\t */\n\tpublic static function crawler_affected() {\n\t\techo '<font class=\"litespeed-primary\">';\n\t\techo '⚠️ ' . __('This setting will regenerate crawler list and clear the disabled list!', 'litespeed-cache');\n\t\techo '</font>';\n\t}\n\n\t/**\n\t * Privacy policy\n\t *\n\t * @since 2.2.7\n\t * @access public\n\t */\n\tpublic static function privacy_policy() {\n\t\treturn __(\n\t\t\t'This site utilizes caching in order to facilitate a faster response time and better user experience. Caching potentially stores a duplicate copy of every web page that is on display on this site. All cache files are temporary, and are never accessed by any third party, except as necessary to obtain technical support from the cache plugin vendor. Cache files expire on a schedule set by the site administrator, but may easily be purged by the admin before their natural expiration, if necessary. We may use QUIC.cloud services to process & cache your data temporarily.',\n\t\t\t'litespeed-cache'\n\t\t) .\n\t\t\tsprintf(\n\t\t\t\t__('Please see %s for more details.', 'litespeed-cache'),\n\t\t\t\t'<a href=\"https://quic.cloud/privacy-policy/\" target=\"_blank\">https://quic.cloud/privacy-policy/</a>'\n\t\t\t);\n\t}\n\n\t/**\n\t * Learn more link\n\t *\n\t * @since  2.4.2\n\t * @access public\n\t */\n\tpublic static function learn_more( $url, $title = false, $self = false, $class = false, $return = false ) {\n\t\tif (!$class) {\n\t\t\t$class = 'litespeed-learn-more';\n\t\t}\n\n\t\tif (!$title) {\n\t\t\t$title = __('Learn More', 'litespeed-cache');\n\t\t}\n\n\t\t$self = $self ? '' : \"target='_blank'\";\n\n\t\t$txt = \" <a href='$url' $self class='$class'>$title</a>\";\n\n\t\tif ($return) {\n\t\t\treturn $txt;\n\t\t}\n\n\t\techo $txt;\n\t}\n\n\t/**\n\t * One per line\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic static function one_per_line( $return = false ) {\n\t\t$str = __('One per line.', 'litespeed-cache');\n\t\tif ($return) {\n\t\t\treturn $str;\n\t\t}\n\t\techo $str;\n\t}\n\n\t/**\n\t * One per line\n\t *\n\t * @since  3.4\n\t * @access public\n\t */\n\tpublic static function full_or_partial_url( $string_only = false ) {\n\t\tif ($string_only) {\n\t\t\techo __('Both full and partial strings can be used.', 'litespeed-cache');\n\t\t} else {\n\t\t\techo __('Both full URLs and partial strings can be used.', 'litespeed-cache');\n\t\t}\n\t}\n\n\t/**\n\t * Notice to edit .htaccess\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic static function notice_htaccess() {\n\t\techo '<font class=\"litespeed-primary\">';\n\t\techo '⚠️ ' . __('This setting will edit the .htaccess file.', 'litespeed-cache');\n\t\techo ' <a href=\"https://docs.litespeedtech.com/lscache/lscwp/toolbox/#edit-htaccess-tab\" target=\"_blank\" class=\"litespeed-learn-more\">' .\n\t\t\t__('Learn More', 'litespeed-cache') .\n\t\t\t'</a>';\n\t\techo '</font>';\n\t}\n\n\t/**\n\t * Gentle reminder that web services run asynchronously\n\t *\n\t * @since  5.3.1\n\t * @access public\n\t */\n\tpublic static function queue_issues( $return = false ) {\n\t\t$str =\n\t\t\t'<div class=\"litespeed-desc\">' .\n\t\t\t__('The queue is processed asynchronously. It may take time.', 'litespeed-cache') .\n\t\t\tself::learn_more('https://docs.litespeedtech.com/lscache/lscwp/troubleshoot/#quiccloud-queue-issues', false, false, false, true) .\n\t\t\t'</div>';\n\t\tif ($return) {\n\t\t\treturn $str;\n\t\t}\n\t\techo $str;\n\t}\n}\n",
    "plugins/litespeed-cache/src/data.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The class to store and manage litespeed db data.\n *\n * @since       1.3.1\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Data extends Root {\n\n\tconst LOG_TAG = '🚀';\n\n\tprivate $_db_updater = array(\n\t\t'5.3-a5' => array( 'litespeed_update_5_3' ),\n\t\t'7.0-b26' => array( 'litespeed_update_7' ),\n\t\t'7.0.1-b1' => array( 'litespeed_update_7_0_1' ),\n\t);\n\n\tprivate $_db_site_updater = array(\n\t\t// Example\n\t\t// '2.0'    => array(\n\t\t// 'litespeed_update_site_2_0',\n\t\t// ),\n\t);\n\n\tprivate $_url_file_types = array(\n\t\t'css' => 1,\n\t\t'js' => 2,\n\t\t'ccss' => 3,\n\t\t'ucss' => 4,\n\t);\n\n\tconst TB_IMG_OPTM          = 'litespeed_img_optm';\n\tconst TB_IMG_OPTMING       = 'litespeed_img_optming'; // working table\n\tconst TB_AVATAR            = 'litespeed_avatar';\n\tconst TB_CRAWLER           = 'litespeed_crawler';\n\tconst TB_CRAWLER_BLACKLIST = 'litespeed_crawler_blacklist';\n\tconst TB_URL               = 'litespeed_url';\n\tconst TB_URL_FILE          = 'litespeed_url_file';\n\n\t/**\n\t * Init\n\t *\n\t * @since  1.3.1\n\t */\n\tpublic function __construct() {\n\t}\n\n\t/**\n\t * Correct table existence\n\t *\n\t * Call when activate -> update_confs()\n\t * Call when update_confs()\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function correct_tb_existence() {\n\t\t// Gravatar\n\t\tif ($this->conf(Base::O_DISCUSS_AVATAR_CACHE)) {\n\t\t\t$this->tb_create('avatar');\n\t\t}\n\n\t\t// Crawler\n\t\tif ($this->conf(Base::O_CRAWLER)) {\n\t\t\t$this->tb_create('crawler');\n\t\t\t$this->tb_create('crawler_blacklist');\n\t\t}\n\n\t\t// URL mapping\n\t\t$this->tb_create('url');\n\t\t$this->tb_create('url_file');\n\n\t\t// Image optm is a bit different. Only trigger creation when sending requests. Drop when destroying.\n\t}\n\n\t/**\n\t * Upgrade conf to latest format version from previous versions\n\t *\n\t * NOTE: Only for v3.0+\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic function conf_upgrade( $ver ) {\n\t\t// Skip count check if `Use Primary Site Configurations` is on\n\t\t// Deprecated since v3.0 as network primary site didn't override the subsites conf yet\n\t\t// if ( ! is_main_site() && ! empty ( $this->_site_options[ self::NETWORK_O_USE_PRIMARY ] ) ) {\n\t\t// return;\n\t\t// }\n\n\t\tif ($this->_get_upgrade_lock()) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_set_upgrade_lock(true);\n\n\t\trequire_once LSCWP_DIR . 'src/data.upgrade.func.php';\n\n\t\t// Init log manually\n\t\tif ($this->conf(Base::O_DEBUG)) {\n\t\t\t$this->cls('Debug2')->init();\n\t\t}\n\n\t\tforeach ($this->_db_updater as $k => $v) {\n\t\t\tif (version_compare($ver, $k, '<')) {\n\t\t\t\t// run each callback\n\t\t\t\tforeach ($v as $v2) {\n\t\t\t\t\tself::debug(\"Updating [ori_v] $ver \\t[to] $k \\t[func] $v2\");\n\t\t\t\t\tcall_user_func($v2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Reload options\n\t\t$this->cls('Conf')->load_options();\n\n\t\t$this->correct_tb_existence();\n\n\t\t// Update related files\n\t\t$this->cls('Activation')->update_files();\n\n\t\t// Update version to latest\n\t\tConf::delete_option(Base::_VER);\n\t\tConf::add_option(Base::_VER, Core::VER);\n\n\t\tself::debug('Updated version to ' . Core::VER);\n\n\t\t$this->_set_upgrade_lock(false);\n\n\t\t!defined('LSWCP_EMPTYCACHE') && define('LSWCP_EMPTYCACHE', true); // clear all sites caches\n\t\tPurge::purge_all();\n\n\t\treturn 'upgrade';\n\t}\n\n\t/**\n\t * Upgrade site conf to latest format version from previous versions\n\t *\n\t * NOTE: Only for v3.0+\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic function conf_site_upgrade( $ver ) {\n\t\tif ($this->_get_upgrade_lock()) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_set_upgrade_lock(true);\n\n\t\trequire_once LSCWP_DIR . 'src/data.upgrade.func.php';\n\n\t\tforeach ($this->_db_site_updater as $k => $v) {\n\t\t\tif (version_compare($ver, $k, '<')) {\n\t\t\t\t// run each callback\n\t\t\t\tforeach ($v as $v2) {\n\t\t\t\t\tself::debug(\"Updating site [ori_v] $ver \\t[to] $k \\t[func] $v2\");\n\t\t\t\t\tcall_user_func($v2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Reload options\n\t\t$this->cls('Conf')->load_site_options();\n\n\t\tConf::delete_site_option(Base::_VER);\n\t\tConf::add_site_option(Base::_VER, Core::VER);\n\n\t\tself::debug('Updated site_version to ' . Core::VER);\n\n\t\t$this->_set_upgrade_lock(false);\n\n\t\t!defined('LSWCP_EMPTYCACHE') && define('LSWCP_EMPTYCACHE', true); // clear all sites caches\n\t\tPurge::purge_all();\n\t}\n\n\t/**\n\t * Check if upgrade script is running or not\n\t *\n\t * @since 3.0.1\n\t */\n\tprivate function _get_upgrade_lock() {\n\t\t$is_upgrading = get_option('litespeed.data.upgrading');\n\t\tif (!$is_upgrading) {\n\t\t\t$this->_set_upgrade_lock(false); // set option value to existed to avoid repeated db query next time\n\t\t}\n\t\tif ($is_upgrading && time() - $is_upgrading < 3600) {\n\t\t\treturn $is_upgrading;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Show the upgrading banner if upgrade script is running\n\t *\n\t * @since 3.0.1\n\t */\n\tpublic function check_upgrading_msg() {\n\t\t$is_upgrading = $this->_get_upgrade_lock();\n\t\tif (!$is_upgrading) {\n\t\t\treturn;\n\t\t}\n\n\t\tAdmin_Display::info(\n\t\t\tsprintf(\n\t\t\t\t__('The database has been upgrading in the background since %s. This message will disappear once upgrade is complete.', 'litespeed-cache'),\n\t\t\t\t'<code>' . Utility::readable_time($is_upgrading) . '</code>'\n\t\t\t) . ' [LiteSpeed]',\n\t\t\ttrue\n\t\t);\n\t}\n\n\t/**\n\t * Set lock for upgrade process\n\t *\n\t * @since 3.0.1\n\t */\n\tprivate function _set_upgrade_lock( $lock ) {\n\t\tif (!$lock) {\n\t\t\tupdate_option('litespeed.data.upgrading', -1);\n\t\t} else {\n\t\t\tupdate_option('litespeed.data.upgrading', time());\n\t\t}\n\t}\n\n\t/**\n\t * Get the table name\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function tb( $tb ) {\n\t\tglobal $wpdb;\n\n\t\tswitch ($tb) {\n\t\t\tcase 'img_optm':\n\t\t\t\treturn $wpdb->prefix . self::TB_IMG_OPTM;\n\t\t\t\tbreak;\n\n\t\t\tcase 'img_optming':\n\t\t\t\treturn $wpdb->prefix . self::TB_IMG_OPTMING;\n\t\t\t\tbreak;\n\n\t\t\tcase 'avatar':\n\t\t\t\treturn $wpdb->prefix . self::TB_AVATAR;\n\t\t\t\tbreak;\n\n\t\t\tcase 'crawler':\n\t\t\t\treturn $wpdb->prefix . self::TB_CRAWLER;\n\t\t\t\tbreak;\n\n\t\t\tcase 'crawler_blacklist':\n\t\t\t\treturn $wpdb->prefix . self::TB_CRAWLER_BLACKLIST;\n\t\t\t\tbreak;\n\n\t\t\tcase 'url':\n\t\t\t\treturn $wpdb->prefix . self::TB_URL;\n\t\t\t\tbreak;\n\n\t\t\tcase 'url_file':\n\t\t\t\treturn $wpdb->prefix . self::TB_URL_FILE;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Check if one table exists or not\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function tb_exist( $tb ) {\n\t\tglobal $wpdb;\n\n\t\t$save_state = $wpdb->suppress_errors;\n\t\t$wpdb->suppress_errors(true);\n\t\t$describe = $wpdb->get_var('DESCRIBE `' . $this->tb($tb) . '`');\n\t\t$wpdb->suppress_errors($save_state);\n\n\t\treturn $describe !== null;\n\t}\n\n\t/**\n\t * Get data structure of one table\n\t *\n\t * @since  2.0\n\t * @access private\n\t */\n\tprivate function _tb_structure( $tb ) {\n\t\treturn File::read(LSCWP_DIR . 'src/data_structure/' . $tb . '.sql');\n\t}\n\n\t/**\n\t * Create img optm table and sync data from wp_postmeta\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function tb_create( $tb ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug2('[Data] Checking table ' . $tb);\n\n\t\t// Check if table exists first\n\t\tif ($this->tb_exist($tb)) {\n\t\t\tself::debug2('[Data] Existed');\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Creating ' . $tb);\n\n\t\t$sql = sprintf(\n\t\t\t'CREATE TABLE IF NOT EXISTS `%1$s` (' . $this->_tb_structure($tb) . ') %2$s;',\n\t\t\t$this->tb($tb),\n\t\t\t$wpdb->get_charset_collate() // 'DEFAULT CHARSET=utf8'\n\t\t);\n\n\t\t$res = $wpdb->query($sql);\n\t\tif ($res !== true) {\n\t\t\tself::debug('Warning! Creating table failed!', $sql);\n\t\t\tAdmin_Display::error(Error::msg('failed_tb_creation', array( '<code>' . $tb . '</code>', '<code>' . $sql . '</code>' )));\n\t\t}\n\t}\n\n\t/**\n\t * Drop table\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function tb_del( $tb ) {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->tb_exist($tb)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Deleting table ' . $tb);\n\n\t\t$q = 'DROP TABLE IF EXISTS ' . $this->tb($tb);\n\t\t$wpdb->query($q);\n\t}\n\n\t/**\n\t * Drop generated tables\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function tables_del() {\n\t\t$this->tb_del('avatar');\n\t\t$this->tb_del('crawler');\n\t\t$this->tb_del('crawler_blacklist');\n\t\t$this->tb_del('url');\n\t\t$this->tb_del('url_file');\n\n\t\t// Deleting img_optm only can be done when destroy all optm images\n\t}\n\n\t/**\n\t * Keep table but clear all data\n\t *\n\t * @since  4.0\n\t */\n\tpublic function table_truncate( $tb ) {\n\t\tglobal $wpdb;\n\t\t$q = 'TRUNCATE TABLE ' . $this->tb($tb);\n\t\t$wpdb->query($q);\n\t}\n\n\t/**\n\t * Clean certain type of url_file\n\t *\n\t * @since  4.0\n\t */\n\tpublic function url_file_clean( $file_type ) {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->tb_exist('url_file')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$type = $this->_url_file_types[$file_type];\n\t\t$q    = 'DELETE FROM ' . $this->tb('url_file') . ' WHERE `type` = %d';\n\t\t$wpdb->query($wpdb->prepare($q, $type));\n\n\t\t// Added to cleanup url table. See issue: https://wordpress.org/support/topic/wp_litespeed_url-1-1-gb-in-db-huge-big/\n\t\t$wpdb->query(\n\t\t\t'DELETE d\n\t\t\tFROM `' .\n\t\t\t\t$this->tb('url') .\n\t\t\t\t'` AS d\n\t\t\tLEFT JOIN `' .\n\t\t\t\t$this->tb('url_file') .\n\t\t\t\t'` AS f ON d.`id` = f.`url_id`\n\t\t\tWHERE f.`url_id` IS NULL'\n\t\t);\n\t}\n\n\t/**\n\t * Generate filename based on URL, if content md5 existed, reuse existing file.\n\t *\n\t * @since  4.0\n\t */\n\tpublic function save_url( $request_url, $vary, $file_type, $filecon_md5, $path, $mobile = false, $webp = false ) {\n\t\tglobal $wpdb;\n\n\t\tif (strlen($vary) > 32) {\n\t\t\t$vary = md5($vary);\n\t\t}\n\n\t\t$type = $this->_url_file_types[$file_type];\n\n\t\t$tb_url      = $this->tb('url');\n\t\t$tb_url_file = $this->tb('url_file');\n\t\t$q           = \"SELECT * FROM `$tb_url` WHERE url=%s\";\n\t\t$url_row     = $wpdb->get_row($wpdb->prepare($q, $request_url), ARRAY_A);\n\t\tif (!$url_row) {\n\t\t\t$q = \"INSERT INTO `$tb_url` SET url=%s\";\n\t\t\t$wpdb->query($wpdb->prepare($q, $request_url));\n\t\t\t$url_id = $wpdb->insert_id;\n\t\t} else {\n\t\t\t$url_id = $url_row['id'];\n\t\t}\n\n\t\t$q        = \"SELECT * FROM `$tb_url_file` WHERE url_id=%d AND vary=%s AND type=%d AND expired=0\";\n\t\t$file_row = $wpdb->get_row($wpdb->prepare($q, array( $url_id, $vary, $type )), ARRAY_A);\n\n\t\t// Check if has previous file or not\n\t\tif ($file_row && $file_row['filename'] == $filecon_md5) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If the new $filecon_md5 is marked as expired by previous records, clear those records\n\t\t$q = \"DELETE FROM `$tb_url_file` WHERE filename = %s AND expired > 0\";\n\t\t$wpdb->query($wpdb->prepare($q, $filecon_md5));\n\n\t\t// Check if there is any other record used the same filename or not\n\t\t$q = \"SELECT id FROM `$tb_url_file` WHERE filename = %s AND expired = 0 AND id != %d LIMIT 1\";\n\t\tif ($file_row && $wpdb->get_var($wpdb->prepare($q, array( $file_row['filename'], $file_row['id'] )))) {\n\t\t\t$q = \"UPDATE `$tb_url_file` SET filename=%s WHERE id=%d\";\n\t\t\t$wpdb->query($wpdb->prepare($q, array( $filecon_md5, $file_row['id'] )));\n\t\t\treturn;\n\t\t}\n\n\t\t// New record needed\n\t\t$q = \"INSERT INTO `$tb_url_file` SET url_id=%d, vary=%s, filename=%s, type=%d, mobile=%d, webp=%d, expired=0\";\n\t\t$wpdb->query($wpdb->prepare($q, array( $url_id, $vary, $filecon_md5, $type, $mobile ? 1 : 0, $webp ? 1 : 0 )));\n\n\t\t// Mark existing rows as expired\n\t\tif ($file_row) {\n\t\t\t$q       = \"UPDATE `$tb_url_file` SET expired=%d WHERE id=%d\";\n\t\t\t$expired = time() + 86400 * apply_filters('litespeed_url_file_expired_days', 20);\n\t\t\t$wpdb->query($wpdb->prepare($q, array( $expired, $file_row['id'] )));\n\n\t\t\t// Also check if has other files expired already to be deleted\n\t\t\t$q    = \"SELECT * FROM `$tb_url_file` WHERE url_id = %d AND expired BETWEEN 1 AND %d\";\n\t\t\t$q    = $wpdb->prepare($q, array( $url_id, time() ));\n\t\t\t$list = $wpdb->get_results($q, ARRAY_A);\n\t\t\tif ($list) {\n\t\t\t\tforeach ($list as $v) {\n\t\t\t\t\t$file_to_del = $path . '/' . $v['filename'] . '.' . ($file_type == 'js' ? 'js' : 'css');\n\t\t\t\t\tif (file_exists($file_to_del)) {\n\t\t\t\t\t\t// Safe to delete\n\t\t\t\t\t\tself::debug('Delete expired unused file: ' . $file_to_del);\n\n\t\t\t\t\t\t// Clear related lscache first to avoid cache copy of same URL w/ diff QS\n\t\t\t\t\t\t// Purge::add( Tag::TYPE_MIN . '.' . $file_row[ 'filename' ] . '.' . $file_type );\n\n\t\t\t\t\t\tunlink($file_to_del);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$q = \"DELETE FROM `$tb_url_file` WHERE url_id = %d AND expired BETWEEN 1 AND %d\";\n\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $url_id, time() )));\n\t\t\t}\n\t\t}\n\n\t\t// Purge this URL to avoid cache copy of same URL w/ diff QS\n\t\t// $this->cls( 'Purge' )->purge_url( Utility::make_relative( $request_url ) ?: '/', true, true );\n\t}\n\n\t/**\n\t * Load CCSS related file\n\t *\n\t * @since  4.0\n\t */\n\tpublic function load_url_file( $request_url, $vary, $file_type ) {\n\t\tglobal $wpdb;\n\n\t\tif (strlen($vary) > 32) {\n\t\t\t$vary = md5($vary);\n\t\t}\n\n\t\t$type = $this->_url_file_types[$file_type];\n\n\t\tself::debug2('load url file: ' . $request_url);\n\n\t\t$tb_url  = $this->tb('url');\n\t\t$q       = \"SELECT * FROM `$tb_url` WHERE url=%s\";\n\t\t$url_row = $wpdb->get_row($wpdb->prepare($q, $request_url), ARRAY_A);\n\t\tif (!$url_row) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$url_id = $url_row['id'];\n\n\t\t$tb_url_file = $this->tb('url_file');\n\t\t$q           = \"SELECT * FROM `$tb_url_file` WHERE url_id=%d AND vary=%s AND type=%d AND expired=0\";\n\t\t$file_row    = $wpdb->get_row($wpdb->prepare($q, array( $url_id, $vary, $type )), ARRAY_A);\n\t\tif (!$file_row) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $file_row['filename'];\n\t}\n\n\t/**\n\t * Mark all entries of one URL to expired\n\t *\n\t * @since 4.5\n\t */\n\tpublic function mark_as_expired( $request_url, $auto_q = false ) {\n\t\tglobal $wpdb;\n\t\t$tb_url = $this->tb('url');\n\n\t\tself::debug('Try to mark as expired: ' . $request_url);\n\t\t$q       = \"SELECT * FROM `$tb_url` WHERE url=%s\";\n\t\t$url_row = $wpdb->get_row($wpdb->prepare($q, $request_url), ARRAY_A);\n\t\tif (!$url_row) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Mark url_id=' . $url_row['id'] . ' as expired');\n\n\t\t$tb_url_file = $this->tb('url_file');\n\n\t\t$existing_url_files = array();\n\t\tif ($auto_q) {\n\t\t\t$q                  = \"SELECT a.*, b.url FROM `$tb_url_file` a LEFT JOIN `$tb_url` b ON b.id=a.url_id WHERE a.url_id=%d AND a.type=4 AND a.expired=0\";\n\t\t\t$q                  = $wpdb->prepare($q, $url_row['id']);\n\t\t\t$existing_url_files = $wpdb->get_results($q, ARRAY_A);\n\t\t}\n\t\t$q       = \"UPDATE `$tb_url_file` SET expired=%d WHERE url_id=%d AND type=4 AND expired=0\";\n\t\t$expired = time() + 86400 * apply_filters('litespeed_url_file_expired_days', 20);\n\t\t$wpdb->query($wpdb->prepare($q, array( $expired, $url_row['id'] )));\n\n\t\treturn $existing_url_files;\n\t}\n\n\t/**\n\t * Get list from `data/css_excludes.txt`\n\t *\n\t * @since  3.6\n\t */\n\tpublic function load_css_exc( $list ) {\n\t\t$data = $this->_load_per_line('css_excludes.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/ccss_whitelist.txt`\n\t *\n\t * @since  7.1\n\t */\n\tpublic function load_ccss_whitelist( $list ) {\n\t\t$data = $this->_load_per_line('ccss_whitelist.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/ucss_whitelist.txt`\n\t *\n\t * @since  4.0\n\t */\n\tpublic function load_ucss_whitelist( $list ) {\n\t\t$data = $this->_load_per_line('ucss_whitelist.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/js_excludes.txt`\n\t *\n\t * @since  3.5\n\t */\n\tpublic function load_js_exc( $list ) {\n\t\t$data = $this->_load_per_line('js_excludes.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/js_defer_excludes.txt`\n\t *\n\t * @since  3.6\n\t */\n\tpublic function load_js_defer_exc( $list ) {\n\t\t$data = $this->_load_per_line('js_defer_excludes.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/optm_uri_exc.txt`\n\t *\n\t * @since  5.4\n\t */\n\tpublic function load_optm_uri_exc( $list ) {\n\t\t$data = $this->_load_per_line('optm_uri_exc.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/esi.nonces.txt`\n\t *\n\t * @since  3.5\n\t */\n\tpublic function load_esi_nonces( $list ) {\n\t\t$data = $this->_load_per_line('esi.nonces.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Get list from `data/cache_nocacheable.txt`\n\t *\n\t * @since  6.3.0.1\n\t */\n\tpublic function load_cache_nocacheable( $list ) {\n\t\t$data = $this->_load_per_line('cache_nocacheable.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Load file per line\n\t *\n\t * Support two kinds of comments:\n\t *      1. `# this is comment`\n\t *      2. `##this is comment`\n\t *\n\t * @since  3.5\n\t */\n\tprivate function _load_per_line( $file ) {\n\t\t$data = File::read(LSCWP_DIR . 'data/' . $file);\n\t\t$data = explode(PHP_EOL, $data);\n\t\t$list = array();\n\t\tforeach ($data as $v) {\n\t\t\t// Drop two kinds of comments\n\t\t\tif (strpos($v, '##') !== false) {\n\t\t\t\t$v = trim(substr($v, 0, strpos($v, '##')));\n\t\t\t}\n\t\t\tif (strpos($v, '# ') !== false) {\n\t\t\t\t$v = trim(substr($v, 0, strpos($v, '# ')));\n\t\t\t}\n\n\t\t\tif (!$v) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$list[] = $v;\n\t\t}\n\n\t\treturn $list;\n\t}\n}\n",
    "plugins/litespeed-cache/src/tool.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The tools\n *\n * @since       3.0\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n/**\n * Class Tool\n *\n * Provides utility functions for LiteSpeed Cache, including IP detection and heartbeat control.\n *\n * @since 3.0\n */\nclass Tool extends Root {\n\n\tconst LOG_TAG = '[Tool]';\n\n\t/**\n\t * Get public IP\n\t *\n\t * Retrieves the public IP address of the server.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @return string The public IP address or an error message.\n\t */\n\tpublic function check_ip() {\n\t\tself::debug( '✅ check_ip' );\n\n\t\t$response = wp_safe_remote_get( 'https://cyberpanel.sh/?ip', array(\n\t\t\t'headers' => array(\n\t\t\t\t'User-Agent' => 'curl/8.7.1',\n\t\t\t),\n\t\t) );\n\n\t\tif ( is_wp_error( $response ) ) {\n\t\t\treturn esc_html__( 'Failed to detect IP', 'litespeed-cache' );\n\t\t}\n\n\t\t$ip = trim( $response['body'] );\n\n\t\tself::debug( 'result [ip] ' . $ip );\n\n\t\tif ( Utility::valid_ipv4( $ip ) ) {\n\t\t\treturn $ip;\n\t\t}\n\n\t\treturn esc_html__( 'Failed to detect IP', 'litespeed-cache' );\n\t}\n\n\t/**\n\t * Heartbeat Control\n\t *\n\t * Configures WordPress heartbeat settings for frontend, backend, and editor.\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function heartbeat() {\n\t\tadd_action( 'wp_enqueue_scripts', array( $this, 'heartbeat_frontend' ) );\n\t\tadd_action( 'admin_enqueue_scripts', array( $this, 'heartbeat_backend' ) );\n\t\tadd_filter( 'heartbeat_settings', array( $this, 'heartbeat_settings' ) );\n\t}\n\n\t/**\n\t * Heartbeat Control frontend control\n\t *\n\t * Manages heartbeat settings for the frontend.\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function heartbeat_frontend() {\n\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_FRONT ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_FRONT_TTL ) ) {\n\t\t\twp_deregister_script( 'heartbeat' );\n\t\t\tDebug2::debug( '[Tool] Deregistered frontend heartbeat' );\n\t\t}\n\t}\n\n\t/**\n\t * Heartbeat Control backend control\n\t *\n\t * Manages heartbeat settings for the backend and editor.\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function heartbeat_backend() {\n\t\tif ( $this->is_editor() ) {\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_EDITOR ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_EDITOR_TTL ) ) {\n\t\t\t\twp_deregister_script( 'heartbeat' );\n\t\t\t\tDebug2::debug( '[Tool] Deregistered editor heartbeat' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_BACK ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_BACK_TTL ) ) {\n\t\t\t\twp_deregister_script( 'heartbeat' );\n\t\t\t\tDebug2::debug( '[Tool] Deregistered backend heartbeat' );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Heartbeat Control settings\n\t *\n\t * Adjusts heartbeat interval settings based on configuration.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param array $settings Existing heartbeat settings.\n\t * @return array Modified heartbeat settings.\n\t */\n\tpublic function heartbeat_settings( $settings ) {\n\t\t// Check editor first to make frontend editor valid too\n\t\tif ( $this->is_editor() ) {\n\t\t\tif ( $this->conf( Base::O_MISC_HEARTBEAT_EDITOR ) ) {\n\t\t\t\t$settings['interval'] = $this->conf( Base::O_MISC_HEARTBEAT_EDITOR_TTL );\n\t\t\t\tDebug2::debug( '[Tool] Heartbeat interval set to ' . $this->conf( Base::O_MISC_HEARTBEAT_EDITOR_TTL ) );\n\t\t\t}\n\t\t} elseif ( ! is_admin() ) {\n\t\t\tif ( $this->conf( Base::O_MISC_HEARTBEAT_FRONT ) ) {\n\t\t\t\t$settings['interval'] = $this->conf( Base::O_MISC_HEARTBEAT_FRONT_TTL );\n\t\t\t\tDebug2::debug( '[Tool] Heartbeat interval set to ' . $this->conf( Base::O_MISC_HEARTBEAT_FRONT_TTL ) );\n\t\t\t}\n\t\t} elseif ( $this->conf( Base::O_MISC_HEARTBEAT_BACK ) ) {\n\t\t\t$settings['interval'] = $this->conf( Base::O_MISC_HEARTBEAT_BACK_TTL );\n\t\t\tDebug2::debug( '[Tool] Heartbeat interval set to ' . $this->conf( Base::O_MISC_HEARTBEAT_BACK_TTL ) );\n\t\t}\n\t\treturn $settings;\n\t}\n\n\t/**\n\t * Check if in editor\n\t *\n\t * Determines if the current request is within the WordPress editor.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @return bool True if in editor, false otherwise.\n\t */\n\tpublic function is_editor() {\n\t\t$request_uri = isset( $_SERVER['REQUEST_URI'] ) ? sanitize_text_field( wp_unslash( $_SERVER['REQUEST_URI'] ) ) : '';\n\t\t$res         = is_admin() && Utility::str_hit_array( $request_uri, array( 'post.php', 'post-new.php' ) );\n\n\t\treturn apply_filters( 'litespeed_is_editor', $res );\n\t}\n}\n",
    "plugins/litespeed-cache/src/data.upgrade.func.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * Database upgrade funcs\n *\n * NOTE: whenever called this file, always call Data::get_upgrade_lock and Data::_set_upgrade_lock first.\n *\n * @since  3.0\n */\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Debug2;\nuse LiteSpeed\\Cloud;\n\n/**\n * Table existence check function\n *\n * @since 7.2\n */\nfunction litespeed_table_exists( $table_name ) {\n\tglobal $wpdb;\n\t$save_state = $wpdb->suppress_errors;\n\t$wpdb->suppress_errors(true);\n\t$tb_exists = $wpdb->get_var('DESCRIBE `' . $table_name . '`');\n\t$wpdb->suppress_errors($save_state);\n\n\treturn $tb_exists !== null;\n}\n\n/**\n * Migrate v7.0- url_files URL from no trailing slash to trailing slash\n *\n * @since 7.0.1\n */\nfunction litespeed_update_7_0_1() {\n\tglobal $wpdb;\n\tDebug2::debug('[Data] v7.0.1 upgrade started');\n\n\t$tb_url = $wpdb->prefix . 'litespeed_url';\n\tif (!litespeed_table_exists($tb_url)) {\n\t\tDebug2::debug('[Data] Table `litespeed_url` not found, bypassed migration');\n\t\treturn;\n\t}\n\n\t$q             = \"SELECT * FROM `$tb_url` WHERE url LIKE 'https://%/'\";\n\t$q             = $wpdb->prepare($q);\n\t$list          = $wpdb->get_results($q, ARRAY_A);\n\t$existing_urls = array();\n\tif ($list) {\n\t\tforeach ($list as $v) {\n\t\t\t$existing_urls[] = $v['url'];\n\t\t}\n\t}\n\n\t$q    = \"SELECT * FROM `$tb_url` WHERE url LIKE 'https://%'\";\n\t$q    = $wpdb->prepare($q);\n\t$list = $wpdb->get_results($q, ARRAY_A);\n\tif (!$list) {\n\t\treturn;\n\t}\n\tforeach ($list as $v) {\n\t\tif (substr($v['url'], -1) == '/') {\n\t\t\tcontinue;\n\t\t}\n\t\t$new_url = $v['url'] . '/';\n\t\tif (in_array($new_url, $existing_urls)) {\n\t\t\tcontinue;\n\t\t}\n\t\t$q = \"UPDATE `$tb_url` SET url = %s WHERE id = %d\";\n\t\t$q = $wpdb->prepare($q, $new_url, $v['id']);\n\t\t$wpdb->query($q);\n\t}\n}\n\n/**\n * Migrate from domain key to pk/sk for QC\n *\n * @since 7.0\n */\nfunction litespeed_update_7() {\n\tDebug2::debug('[Data] v7 upgrade started');\n\n\t$__cloud = Cloud::cls();\n\n\t$domain_key = $__cloud->conf('api_key');\n\tif (!$domain_key) {\n\t\tDebug2::debug('[Data] No domain key, bypassed migration');\n\t\treturn;\n\t}\n\n\t$new_prepared = $__cloud->init_qc_prepare();\n\tif (!$new_prepared && $__cloud->activated()) {\n\t\tDebug2::debug('[Data] QC previously activated in v7, bypassed migration');\n\t\treturn;\n\t}\n\t$data = array(\n\t\t'domain_key' => $domain_key,\n\t);\n\t$resp = $__cloud->post(Cloud::SVC_D_V3UPGRADE, $data);\n\tif (!empty($resp['qc_activated'])) {\n\t\tif ($resp['qc_activated'] != 'deleted') {\n\t\t\t$cloud_summary_updates = array( 'qc_activated' => $resp['qc_activated'] );\n\t\t\tif (!empty($resp['main_domain'])) {\n\t\t\t\t$cloud_summary_updates['main_domain'] = $resp['main_domain'];\n\t\t\t}\n\t\t\tCloud::save_summary($cloud_summary_updates);\n\t\t\tDebug2::debug('[Data] Updated QC activated status to ' . $resp['qc_activated']);\n\t\t}\n\t}\n}\n\n/**\n * Append webp/mobile to url_file\n *\n * @since 5.3\n */\nfunction litespeed_update_5_3() {\n\tglobal $wpdb;\n\tDebug2::debug('[Data] Upgrade url_file table');\n\n\t$tb = $wpdb->prefix . 'litespeed_url_file';\n\tif (litespeed_table_exists($tb)) {\n\t\t$q =\n\t\t\t'ALTER TABLE `' .\n\t\t\t$tb .\n\t\t\t'`\n\t\t\t\tADD COLUMN `mobile` tinyint(4) NOT NULL COMMENT \"mobile=1\",\n\t\t\t\tADD COLUMN `webp` tinyint(4) NOT NULL COMMENT \"webp=1\"\n\t\t\t';\n\t\t$wpdb->query($q);\n\t}\n}\n",
    "plugins/litespeed-cache/src/core.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The core plugin class.\n *\n * This is the main class for the LiteSpeed Cache plugin, responsible for initializing\n * the plugin's core functionality, registering hooks, and handling cache-related operations.\n *\n * Note: Core doesn't allow $this->cls( 'Core' )\n *\n * @since 1.0.0\n * @package LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n/**\n * Class Core\n *\n * @since 1.0.0\n */\nclass Core extends Root {\n\n\tconst NAME        = 'LiteSpeed Cache';\n\tconst PLUGIN_NAME = 'litespeed-cache';\n\tconst PLUGIN_FILE = 'litespeed-cache/litespeed-cache.php';\n\tconst VER         = LSCWP_V;\n\n\tconst ACTION_DISMISS             = 'dismiss';\n\tconst ACTION_PURGE_BY            = 'PURGE_BY';\n\tconst ACTION_PURGE_EMPTYCACHE    = 'PURGE_EMPTYCACHE';\n\tconst ACTION_QS_PURGE            = 'PURGE';\n\tconst ACTION_QS_PURGE_SINGLE     = 'PURGESINGLE'; // This will be same as `ACTION_QS_PURGE` (purge single URL only)\n\tconst ACTION_QS_SHOW_HEADERS     = 'SHOWHEADERS';\n\tconst ACTION_QS_PURGE_ALL        = 'purge_all';\n\tconst ACTION_QS_PURGE_EMPTYCACHE = 'empty_all';\n\tconst ACTION_QS_NOCACHE          = 'NOCACHE';\n\n\tconst HEADER_DEBUG = 'X-LiteSpeed-Debug';\n\n\t/**\n\t * Whether to show debug headers.\n\t *\n\t * @var bool\n\t * @since 1.0.0\n\t */\n\tprotected static $debug_show_header = false;\n\n\t/**\n\t * Footer comment buffer.\n\t *\n\t * @var string\n\t * @since 1.0.0\n\t */\n\tprivate $footer_comment = '';\n\n\t/**\n\t * Define the core functionality of the plugin.\n\t *\n\t * Set the plugin name and the plugin version that can be used throughout the plugin.\n\t * Load the dependencies, define the locale, and set the hooks for the admin area and\n\t * the public-facing side of the site.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic function __construct() {\n\t\t! defined( 'LSCWP_TS_0' ) && define( 'LSCWP_TS_0', microtime( true ) );\n\t\t$this->cls( 'Conf' )->init();\n\n\t\t/**\n\t\t * Load API hooks\n\t\t *\n\t\t * @since 3.0\n\t\t */\n\t\t$this->cls( 'API' )->init();\n\n\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t// Load third party detection if lscache enabled.\n\t\t\tinclude_once LSCWP_DIR . 'thirdparty/entry.inc.php';\n\t\t}\n\n\n\t\tif ( $this->conf( Base::O_DEBUG_DISABLE_ALL ) || Debug2::is_tmp_disable() ) {\n\t\t\t! defined( 'LITESPEED_DISABLE_ALL' ) && define( 'LITESPEED_DISABLE_ALL', true );\n\t\t}\n\n\t\t/**\n\t\t * Register plugin activate/deactivate/uninstall hooks\n\t\t * NOTE: this can't be moved under after_setup_theme, otherwise activation will be bypassed\n\t\t *\n\t\t * @since 2.7.1 Disabled admin&CLI check to make frontend able to enable cache too\n\t\t */\n\t\t$plugin_file = LSCWP_DIR . 'litespeed-cache.php';\n\t\tregister_activation_hook( $plugin_file, array( __NAMESPACE__ . '\\Activation', 'register_activation' ) );\n\t\tregister_deactivation_hook( $plugin_file, array( __NAMESPACE__ . '\\Activation', 'register_deactivation' ) );\n\t\tregister_uninstall_hook( $plugin_file, __NAMESPACE__ . '\\Activation::uninstall_litespeed_cache' );\n\n\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t// Register purge_all actions\n\t\t\t$purge_all_events = $this->conf( Base::O_PURGE_HOOK_ALL );\n\n\t\t\t// Purge all on upgrade\n\t\t\tif ( $this->conf( Base::O_PURGE_ON_UPGRADE ) ) {\n\t\t\t\t$purge_all_events[] = 'automatic_updates_complete';\n\t\t\t\t$purge_all_events[] = 'upgrader_process_complete';\n\t\t\t\t$purge_all_events[] = 'admin_action_do-plugin-upgrade';\n\t\t\t}\n\t\t\tforeach ( $purge_all_events as $event ) {\n\t\t\t\t// Don't allow hook to update_option because purge_all will cause infinite loop of update_option\n\t\t\t\tif ( in_array( $event, array( 'update_option' ), true ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tadd_action( $event, __NAMESPACE__ . '\\Purge::purge_all' );\n\t\t\t}\n\n\t\t\t// Add headers to site health check for full page cache\n\t\t\t// @since 5.4\n\t\t\tadd_filter( 'site_status_page_cache_supported_cache_headers', function ( $cache_headers ) {\n\t\t\t\t$is_cache_hit                       = function ( $header_value ) {\n\t\t\t\t\treturn false !== strpos( strtolower( $header_value ), 'hit' );\n\t\t\t\t};\n\t\t\t\t$cache_headers['x-litespeed-cache'] = $is_cache_hit;\n\t\t\t\t$cache_headers['x-lsadc-cache']     = $is_cache_hit;\n\t\t\t\t$cache_headers['x-qc-cache']        = $is_cache_hit;\n\t\t\t\treturn $cache_headers;\n\t\t\t} );\n\t\t}\n\n\t\tadd_action( 'after_setup_theme', array( $this, 'init' ) );\n\n\t\t// Check if there is a purge request in queue\n\t\tif ( ! defined( 'LITESPEED_CLI' ) ) {\n\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE );\n\t\t\tif ( $purge_queue && '-1' !== $purge_queue ) {\n\t\t\t\t$this->http_header( $purge_queue );\n\t\t\t\tDebug2::debug( '[Core] Purge Queue found&sent: ' . $purge_queue );\n\t\t\t}\n\t\t\tif ( '-1' !== $purge_queue ) {\n\t\t\t\tPurge::update_option( Purge::DB_QUEUE, '-1' ); // Use -1 to bypass purge while still enable db update as WP's update_option will check value===false to bypass update\n\t\t\t}\n\n\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE2 );\n\t\t\tif ( $purge_queue && '-1' !== $purge_queue ) {\n\t\t\t\t$this->http_header( $purge_queue );\n\t\t\t\tDebug2::debug( '[Core] Purge2 Queue found&sent: ' . $purge_queue );\n\t\t\t}\n\t\t\tif ( '-1' !== $purge_queue ) {\n\t\t\t\tPurge::update_option( Purge::DB_QUEUE2, '-1' );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Hook internal REST\n\t\t *\n\t\t * @since 2.9.4\n\t\t */\n\t\t$this->cls( 'REST' );\n\n\t\t/**\n\t\t * Hook wpnonce function\n\t\t *\n\t\t * Note: ESI nonce won't be available until hook after_setup_theme ESI init due to Guest Mode concern\n\t\t *\n\t\t * @since 4.1\n\t\t */\n\t\tif ( $this->cls( 'Router' )->esi_enabled() && ! function_exists( 'wp_create_nonce' ) ) {\n\t\t\tDebug2::debug( '[ESI] Overwrite wp_create_nonce()' );\n\t\t\tlitespeed_define_nonce_func();\n\t\t}\n\t}\n\n\t/**\n\t * The plugin initializer.\n\t *\n\t * This function checks if the cache is enabled and ready to use, then determines what actions need to be set up based on the type of user and page accessed. Output is buffered if the cache is enabled.\n\t *\n\t * NOTE: WP user doesn't init yet\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic function init() {\n\t\t/**\n\t\t * Added hook before init\n\t\t * 3rd party preload hooks will be fired here too (e.g. Divi disable all in edit mode)\n\t\t *\n\t\t * @since 1.6.6\n\t\t * @since 2.6 Added filter to all config values in Conf\n\t\t */\n\t\tdo_action( 'litespeed_init' );\n\t\tadd_action( 'wp_ajax_async_litespeed', 'LiteSpeed\\Task::async_litespeed_handler' );\n\t\tadd_action( 'wp_ajax_nopriv_async_litespeed', 'LiteSpeed\\Task::async_litespeed_handler' );\n\n\t\t// In `after_setup_theme`, before `init` hook\n\t\t$this->cls( 'Activation' )->auto_update();\n\n\t\tif ( is_admin() && ! wp_doing_ajax() ) {\n\t\t\t$this->cls( 'Admin' );\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_DISABLE_ALL' ) && LITESPEED_DISABLE_ALL ) {\n\t\t\tDebug2::debug( '[Core] Bypassed due to debug disable all setting' );\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action( 'litespeed_initing' );\n\n\t\tob_start( array( $this, 'send_headers_force' ) );\n\t\tadd_action( 'shutdown', array( $this, 'send_headers' ), 0 );\n\t\tadd_action( 'wp_footer', array( $this, 'footer_hook' ) );\n\n\t\t/**\n\t\t * Check if is non-optimization simulator\n\t\t *\n\t\t * @since 2.9\n\t\t */\n\t\t// phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\tif ( ! empty( $_GET[ Router::ACTION ] ) && 'before_optm' === $_GET[ Router::ACTION ] && ! apply_filters( 'litespeed_qs_forbidden', false ) ) {\n\t\t\tDebug2::debug( '[Core] ⛑️ bypass_optm due to QS CTRL' );\n\t\t\t! defined( 'LITESPEED_NO_OPTM' ) && define( 'LITESPEED_NO_OPTM', true );\n\t\t}\n\n\t\t/**\n\t\t * Register vary filter\n\t\t *\n\t\t * @since 1.6.2\n\t\t */\n\t\t$this->cls( 'Control' )->init();\n\n\t\t// Init Purge hooks\n\t\t$this->cls( 'Purge' )->init();\n\n\t\t$this->cls( 'Tag' )->init();\n\n\t\t// Load hooks that may be related to users\n\t\tadd_action( 'init', array( $this, 'after_user_init' ), 5 );\n\n\t\t// Load 3rd party hooks\n\t\tadd_action( 'wp_loaded', array( $this, 'load_thirdparty' ), 2 );\n\t}\n\n\t/**\n\t * Run hooks after user init\n\t *\n\t * @since 2.9.8\n\t */\n\tpublic function after_user_init() {\n\t\t$this->cls( 'Router' )->is_role_simulation();\n\n\t\t// Detect if is Guest mode or not\n\t\t$this->cls( 'Vary' )->after_user_init();\n\n\t\t// Register attachment delete hook\n\t\t$this->cls( 'Media' )->after_user_init();\n\n\t\t/**\n\t\t * Preload ESI functionality for ESI request URI recovery\n\t\t *\n\t\t * @since 1.8.1\n\t\t * @since 4.0 ESI init needs to be after Guest mode detection to bypass ESI if is under Guest mode\n\t\t */\n\t\t$this->cls( 'ESI' )->init();\n\n\t\tif ( ! is_admin() && ! defined( 'LITESPEED_GUEST_OPTM' ) ) {\n\t\t\t$result = $this->cls( 'Conf' )->in_optm_exc_roles();\n\t\t\tif ( $result ) {\n\t\t\t\tDebug2::debug( '[Core] ⛑️ bypass_optm: hit Role Excludes setting: ' . $result );\n\t\t\t\t! defined( 'LITESPEED_NO_OPTM' ) && define( 'LITESPEED_NO_OPTM', true );\n\t\t\t}\n\t\t}\n\n\t\t// Heartbeat control\n\t\t$this->cls( 'Tool' )->heartbeat();\n\n\t\tif ( ! defined( 'LITESPEED_NO_OPTM' ) || ! LITESPEED_NO_OPTM ) {\n\t\t\t// Check missing static files\n\t\t\t$this->cls( 'Router' )->serve_static();\n\n\t\t\t$this->cls( 'Media' )->init();\n\n\t\t\t$this->cls( 'Placeholder' )->init();\n\n\t\t\t$this->cls( 'Router' )->can_optm() && $this->cls( 'Optimize' )->init();\n\n\t\t\t$this->cls( 'Localization' )->init();\n\n\t\t\t// Hook CDN for attachments\n\t\t\t$this->cls( 'CDN' )->init();\n\n\t\t\t// Load cron tasks\n\t\t\t$this->cls( 'Task' )->init();\n\t\t}\n\n\t\t// Load litespeed actions\n\t\t$action = Router::get_action();\n\t\tif ( $action ) {\n\t\t\t$this->proceed_action( $action );\n\t\t}\n\n\t\t// Load frontend GUI\n\t\tif ( ! is_admin() ) {\n\t\t\t$this->cls( 'GUI' )->init();\n\t\t}\n\t}\n\n\t/**\n\t * Run frontend actions\n\t *\n\t * @since 1.1.0\n\t * @param string $action The action to proceed.\n\t */\n\tpublic function proceed_action( $action ) {\n\t\t$msg = false;\n\t\t// Handle actions\n\t\tswitch ( $action ) {\n\t\t\tcase self::ACTION_QS_SHOW_HEADERS:\n\t\t\t\tself::$debug_show_header = true;\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_QS_PURGE:\n\t\t\tcase self::ACTION_QS_PURGE_SINGLE:\n\t\t\t\tPurge::set_purge_single();\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_QS_PURGE_ALL:\n\t\t\t\tPurge::purge_all();\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_PURGE_EMPTYCACHE:\n\t\t\tcase self::ACTION_QS_PURGE_EMPTYCACHE:\n\t\t\t\tdefine( 'LSWCP_EMPTYCACHE', true ); // Clear all sites caches\n\t\t\t\tPurge::purge_all();\n\t\t\t\t$msg = __( 'Notified LiteSpeed Web Server to purge everything.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_PURGE_BY:\n\t\t\t\t$this->cls( 'Purge' )->purge_list();\n\t\t\t\t$msg = __( 'Notified LiteSpeed Web Server to purge the list.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_DISMISS:\n\t\t\t\tGUI::dismiss();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t$msg = $this->cls( 'Router' )->handler( $action );\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( $msg && ! Router::is_ajax() ) {\n\t\t\tAdmin_Display::add_notice( Admin_Display::NOTICE_GREEN, $msg );\n\t\t\tAdmin::redirect();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Router::is_ajax() ) {\n\t\t\texit();\n\t\t}\n\t}\n\n\t/**\n\t * Callback used to call the detect third party action.\n\t *\n\t * The detect action is used by third party plugin integration classes to determine if they should add the rest of their hooks.\n\t *\n\t * @since 1.0.5\n\t */\n\tpublic function load_thirdparty() {\n\t\tdo_action( 'litespeed_load_thirdparty' );\n\t}\n\n\t/**\n\t * Mark wp_footer called\n\t *\n\t * @since 1.3\n\t */\n\tpublic function footer_hook() {\n\t\tDebug2::debug( '[Core] Footer hook called' );\n\t\tif ( ! defined( 'LITESPEED_FOOTER_CALLED' ) ) {\n\t\t\tdefine( 'LITESPEED_FOOTER_CALLED', true );\n\t\t}\n\t}\n\n\t/**\n\t * Trigger comment info display hook\n\t *\n\t * @since 1.3\n\t * @param string|null $buffer The buffer to check.\n\t * @return void\n\t */\n\tprivate function check_is_html( $buffer = null ) {\n\t\tif ( ! defined( 'LITESPEED_FOOTER_CALLED' ) ) {\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: miss footer const' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( wp_doing_ajax() ) {\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: doing ajax' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( wp_doing_cron() ) {\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: doing cron' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( empty( $_SERVER['REQUEST_METHOD'] ) || 'GET' !== $_SERVER['REQUEST_METHOD'] ) {\n\t\t\t// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: not get method ' . wp_unslash( $_SERVER['REQUEST_METHOD'] ) );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( null === $buffer ) {\n\t\t\t$buffer = ob_get_contents();\n\t\t}\n\n\t\t// Double check to make sure it is an HTML file\n\t\tif ( strlen( $buffer ) > 300 ) {\n\t\t\t$buffer = substr( $buffer, 0, 300 );\n\t\t}\n\t\tif ( false !== strstr( $buffer, '<!--' ) ) {\n\t\t\t$buffer = preg_replace( '/<!--.*?-->/s', '', $buffer );\n\t\t}\n\t\t$buffer = trim( $buffer );\n\n\t\t$buffer = File::remove_zero_space( $buffer );\n\n\t\t$is_html = 0 === stripos( $buffer, '<html' ) || 0 === stripos( $buffer, '<!DOCTYPE' );\n\n\t\tif ( ! $is_html ) {\n\t\t\tDebug2::debug( '[Core] Footer check failed: ' . ob_get_level() . '-' . substr( $buffer, 0, 100 ) );\n\t\t\treturn;\n\t\t}\n\n\t\tDebug2::debug( '[Core] Footer check passed' );\n\n\t\tif ( ! defined( 'LITESPEED_IS_HTML' ) ) {\n\t\t\tdefine( 'LITESPEED_IS_HTML', true );\n\t\t}\n\t}\n\n\t/**\n\t * For compatibility with plugins that have 'Bad' logic that forced all buffer output even if it is NOT their buffer.\n\t *\n\t * Usually this is called after send_headers() if following original WP process\n\t *\n\t * @since 1.1.5\n\t * @param string $buffer The buffer to process.\n\t * @return string The processed buffer.\n\t */\n\tpublic function send_headers_force( $buffer ) {\n\t\t$this->check_is_html( $buffer );\n\n\t\t// Hook to modify buffer before\n\t\t$buffer = apply_filters( 'litespeed_buffer_before', $buffer );\n\n\t\t/**\n\t\t * Media: Image lazyload && WebP\n\t\t * GUI: Clean wrapper mainly for ESI block NOTE: this needs to be before optimizer to avoid wrapper being removed\n\t\t * Optimize\n\t\t * CDN\n\t\t */\n\t\tif ( ! defined( 'LITESPEED_NO_OPTM' ) || ! LITESPEED_NO_OPTM ) {\n\t\t\tDebug2::debug( '[Core] run hook litespeed_buffer_finalize' );\n\t\t\t$buffer = apply_filters( 'litespeed_buffer_finalize', $buffer );\n\t\t}\n\n\t\t/**\n\t\t * Replace ESI preserved list\n\t\t *\n\t\t * @since 3.3 Replace this in the end to avoid `Inline JS Defer` or other Page Optm features encoded ESI tags wrongly, which caused LSWS can't recognize ESI\n\t\t */\n\t\t$buffer = $this->cls( 'ESI' )->finalize( $buffer );\n\n\t\t$this->send_headers( true );\n\n\t\t// Log ESI nonce buffer empty issue\n\t\tif ( defined( 'LSCACHE_IS_ESI' ) && 0 === strlen( $buffer ) && ! empty( $_SERVER['REQUEST_URI'] ) ) {\n\t\t\t// Log ref for debug purpose\n\t\t\t// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.PHP.DevelopmentFunctions.error_log_error_log\n\t\t\terror_log( 'ESI buffer empty ' . wp_unslash( $_SERVER['REQUEST_URI'] ) );\n\t\t}\n\n\t\t// Init comment info\n\t\t$running_info_showing = defined( 'LITESPEED_IS_HTML' ) || defined( 'LSCACHE_IS_ESI' );\n\t\tif ( defined( 'LSCACHE_ESI_SILENCE' ) ) {\n\t\t\t$running_info_showing = false;\n\t\t\tDebug2::debug( '[Core] ESI silence' );\n\t\t}\n\t\t/**\n\t\t * Silence comment for JSON request\n\t\t *\n\t\t * @since 2.9.3\n\t\t */\n\t\tif ( REST::cls()->is_rest() || Router::is_ajax() ) {\n\t\t\t$running_info_showing = false;\n\t\t\tDebug2::debug( '[Core] Silence Comment due to REST/AJAX' );\n\t\t}\n\t\t$running_info_showing = apply_filters( 'litespeed_comment', $running_info_showing );\n\t\tif ( $running_info_showing && $this->footer_comment ) {\n\t\t\t$buffer .= $this->footer_comment;\n\t\t}\n\n\t\t/**\n\t\t * If ESI request is JSON, give the content JSON format\n\t\t *\n\t\t * @since 2.9.3\n\t\t * @since 2.9.4 ESI request could be from internal REST call, so moved json_encode out of this condition\n\t\t */\n\t\tif ( defined( 'LSCACHE_IS_ESI' ) ) {\n\t\t\tDebug2::debug( '[Core] ESI Start 👇' );\n\t\t\tif ( strlen( $buffer ) > 500 ) {\n\t\t\t\tDebug2::debug( trim( substr( $buffer, 0, 500 ) ) . '.....' );\n\t\t\t} else {\n\t\t\t\tDebug2::debug( $buffer );\n\t\t\t}\n\t\t\tDebug2::debug( '[Core] ESI End 👆' );\n\t\t}\n\n\t\tif ( apply_filters( 'litespeed_is_json', false ) ) {\n\t\t\tif ( null === \\json_decode( $buffer, true ) ) {\n\t\t\t\tDebug2::debug( '[Core] Buffer converting to JSON' );\n\t\t\t\t$buffer = wp_json_encode( $buffer );\n\t\t\t\t$buffer = trim( $buffer, '\"' );\n\t\t\t} else {\n\t\t\t\tDebug2::debug( '[Core] JSON Buffer' );\n\t\t\t}\n\t\t}\n\n\t\t// Hook to modify buffer after\n\t\t$buffer = apply_filters( 'litespeed_buffer_after', $buffer );\n\n\t\tDebug2::ended();\n\n\t\treturn $buffer;\n\t}\n\n\t/**\n\t * Sends the headers out at the end of processing the request.\n\t *\n\t * This will send out all LiteSpeed Cache related response headers needed for the post.\n\t *\n\t * @since 1.0.5\n\t * @param bool $is_forced If the header is sent following our normal finalizing logic.\n\t */\n\tpublic function send_headers( $is_forced = false ) {\n\t\t// Make sure header output only runs once\n\t\tif ( defined( 'LITESPEED_DID_' . __FUNCTION__ ) ) {\n\t\t\treturn;\n\t\t}\n\t\tdefine( 'LITESPEED_DID_' . __FUNCTION__, true );\n\n\t\t// Avoid PHP warning for headers sent out already\n\t\tif ( headers_sent() ) {\n\t\t\tself::debug( '❌ !!! Err: Header sent out already' );\n\t\t\treturn;\n\t\t}\n\n\t\t$this->check_is_html();\n\n\t\t// Cache control output needs to be done first, as some varies are added in 3rd party hook `litespeed_api_control`.\n\t\t$this->cls( 'Control' )->finalize();\n\n\t\t$vary_header = $this->cls( 'Vary' )->finalize();\n\n\t\t// If not cacheable but Admin QS is `purge` or `purgesingle`, `tag` still needs to be generated\n\t\t$tag_header = $this->cls( 'Tag' )->output();\n\t\tif ( ! $tag_header && Control::is_cacheable() ) {\n\t\t\tControl::set_nocache( 'empty tag header' );\n\t\t}\n\n\t\t// `Purge` output needs to be after `tag` output as Admin QS may need to send `tag` header\n\t\t$purge_header = Purge::output();\n\n\t\t// Generate `control` header in the end in case control status is changed by other headers\n\t\t$control_header = $this->cls( 'Control' )->output();\n\n\t\t// Give one more break to avoid Firefox crash\n\t\tif ( ! defined( 'LSCACHE_IS_ESI' ) ) {\n\t\t\t$this->footer_comment .= \"\\n\";\n\t\t}\n\n\t\t$cache_support = 'supported';\n\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t$cache_support = Control::is_cacheable() ? 'cached' : 'uncached';\n\t\t}\n\n\t\t$this->comment(\n\t\t\tsprintf(\n\t\t\t\t'%1$s %2$s by LiteSpeed Cache %4$s on %3$s',\n\t\t\t\tdefined( 'LSCACHE_IS_ESI' ) ? 'Block' : 'Page',\n\t\t\t\t$cache_support,\n\t\t\t\tgmdate( 'Y-m-d H:i:s', time() + LITESPEED_TIME_OFFSET ),\n\t\t\t\tself::VER\n\t\t\t)\n\t\t);\n\n\t\t// Send Control header\n\t\tif ( defined( 'LITESPEED_ON' ) && $control_header ) {\n\t\t\t$this->http_header( $control_header );\n\t\t\tif ( ! Control::is_cacheable() && !is_admin() ) {\n\t\t\t\t$ori_wp_header = wp_get_nocache_headers();\n\t\t\t\tif ( isset( $ori_wp_header['Cache-Control'] ) ) {\n\t\t\t\t\t$this->http_header( 'Cache-Control: ' . $ori_wp_header['Cache-Control'] ); // @ref: https://github.com/litespeedtech/lscache_wp/issues/889\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $control_header );\n\t\t\t}\n\t\t}\n\n\t\t// Send PURGE header (Always send regardless of cache setting disabled/enabled)\n\t\tif ( defined( 'LITESPEED_ON' ) && $purge_header ) {\n\t\t\t$this->http_header( $purge_header );\n\t\t\tDebug2::log_purge( $purge_header );\n\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $purge_header );\n\t\t\t}\n\t\t}\n\n\t\t// Send Vary header\n\t\tif ( defined( 'LITESPEED_ON' ) && $vary_header ) {\n\t\t\t$this->http_header( $vary_header );\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $vary_header );\n\t\t\t}\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_ON' ) && defined( 'LSCWP_LOG' ) ) {\n\t\t\t$vary = $this->cls( 'Vary' )->finalize_full_varies();\n\t\t\tif ( $vary ) {\n\t\t\t\t$this->comment( 'Full varies: ' . $vary );\n\t\t\t}\n\t\t}\n\n\t\t// Admin QS show header action\n\t\tif ( self::$debug_show_header ) {\n\t\t\t$debug_header = self::HEADER_DEBUG . ': ';\n\t\t\tif ( $control_header ) {\n\t\t\t\t$debug_header .= $control_header . '; ';\n\t\t\t}\n\t\t\tif ( $purge_header ) {\n\t\t\t\t$debug_header .= $purge_header . '; ';\n\t\t\t}\n\t\t\tif ( $tag_header ) {\n\t\t\t\t$debug_header .= $tag_header . '; ';\n\t\t\t}\n\t\t\tif ( $vary_header ) {\n\t\t\t\t$debug_header .= $vary_header . '; ';\n\t\t\t}\n\t\t\t$this->http_header( $debug_header );\n\t\t} elseif ( defined( 'LITESPEED_ON' ) && Control::is_cacheable() && $tag_header ) {\n\t\t\t$this->http_header( $tag_header );\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $tag_header );\n\t\t\t}\n\t\t}\n\n\t\t// Object cache comment\n\t\tif ( defined( 'LSCWP_LOG' ) && defined( 'LSCWP_OBJECT_CACHE' ) && method_exists( 'WP_Object_Cache', 'debug' ) ) {\n\t\t\t$this->comment( 'Object Cache ' . \\WP_Object_Cache::get_instance()->debug() );\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_GUEST' ) && LITESPEED_GUEST ) {\n\t\t\t$this->comment( 'Guest Mode' );\n\t\t}\n\n\t\tif ( ! empty( $this->footer_comment ) ) {\n\t\t\tself::debug( \"[footer comment]\\n\" . trim( $this->footer_comment ) );\n\t\t}\n\n\t\tif ( $is_forced ) {\n\t\t\tDebug2::debug( '--forced--' );\n\t\t}\n\n\t\t// If CLI and contains Purge Header, issue an HTTP request to Purge\n\t\tif ( defined( 'LITESPEED_CLI' ) ) {\n\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE );\n\t\t\tif ( ! $purge_queue || '-1' === $purge_queue ) {\n\t\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE2 );\n\t\t\t}\n\t\t\tif ( $purge_queue && '-1' !== $purge_queue ) {\n\t\t\t\tself::debug( '[Core] Purge Queue found, issue an HTTP request to purge: ' . $purge_queue );\n\t\t\t\t// Kick off HTTP request\n\t\t\t\t$url  = admin_url( 'admin-ajax.php' );\n\t\t\t\t$resp = wp_safe_remote_get( $url );\n\t\t\t\tif ( is_wp_error( $resp ) ) {\n\t\t\t\t\t$error_message = $resp->get_error_message();\n\t\t\t\t\tself::debug( '[URL]' . $url );\n\t\t\t\t\tself::debug( 'failed to request: ' . $error_message );\n\t\t\t\t} else {\n\t\t\t\t\tself::debug( 'HTTP request response: ' . $resp['body'] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Append one HTML comment\n\t *\n\t * @since 5.5\n\t * @param string $data The comment data.\n\t */\n\tpublic static function comment( $data ) {\n\t\tself::cls()->append_comment( $data );\n\t}\n\n\t/**\n\t * Append one HTML comment\n\t *\n\t * @since 5.5\n\t * @param string $data The comment data.\n\t */\n\tprivate function append_comment( $data ) {\n\t\t$this->footer_comment .= \"\\n<!-- \" . $data . ' -->';\n\t}\n\n\t/**\n\t * Send HTTP header\n\t *\n\t * @since 5.3\n\t * @param string $header The header to send.\n\t */\n\tprivate function http_header( $header ) {\n\t\tif ( defined( 'LITESPEED_CLI' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! headers_sent() ) {\n\t\t\theader( $header );\n\t\t}\n\n\t\tif ( ! defined( 'LSCWP_LOG' ) ) {\n\t\t\treturn;\n\t\t}\n\t\tDebug2::debug( '💰 ' . $header );\n\t}\n}\n",
    "plugins/litespeed-cache/src/optimizer.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The optimize4 class.\n *\n * @since       1.9\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Optimizer extends Root {\n\n\tprivate $_conf_css_font_display;\n\n\t/**\n\t * Init optimizer\n\t *\n\t * @since  1.9\n\t */\n\tpublic function __construct() {\n\t\t$this->_conf_css_font_display = $this->conf(Base::O_OPTM_CSS_FONT_DISPLAY);\n\t}\n\n\t/**\n\t * Run HTML minify process and return final content\n\t *\n\t * @since  1.9\n\t * @access public\n\t */\n\tpublic function html_min( $content, $force_inline_minify = false ) {\n\t\tif (!apply_filters('litespeed_html_min', true)) {\n\t\t\tDebug2::debug2('[Optmer] html_min bypassed via litespeed_html_min filter');\n\t\t\treturn $content;\n\t\t}\n\n\t\t$options = array();\n\n\t\tif ($force_inline_minify) {\n\t\t\t$options['jsMinifier'] = __CLASS__ . '::minify_js';\n\t\t}\n\n\t\t$skip_comments = $this->conf(Base::O_OPTM_HTML_SKIP_COMMENTS);\n\t\tif ($skip_comments) {\n\t\t\t$options['skipComments'] = $skip_comments;\n\t\t}\n\n\t\t/**\n\t\t * Added exception capture when minify\n\t\t *\n\t\t * @since  2.2.3\n\t\t */\n\t\ttry {\n\t\t\t$obj           = new Lib\\HTML_MIN($content, $options);\n\t\t\t$content_final = $obj->process();\n\t\t\t// check if content from minification is empty\n\t\t\tif ($content_final == '') {\n\t\t\t\tDebug2::debug('Failed to minify HTML: HTML minification resulted in empty HTML');\n\t\t\t\treturn $content;\n\t\t\t}\n\t\t\tif (!defined('LSCACHE_ESI_SILENCE')) {\n\t\t\t\t$content_final .= \"\\n\" . '<!-- Page optimized by LiteSpeed Cache @' . date('Y-m-d H:i:s', time() + LITESPEED_TIME_OFFSET) . ' -->';\n\t\t\t}\n\t\t\treturn $content_final;\n\t\t} catch (\\Exception $e) {\n\t\t\tDebug2::debug('******[Optmer] html_min failed: ' . $e->getMessage());\n\t\t\terror_log('****** LiteSpeed Optimizer html_min failed: ' . $e->getMessage());\n\t\t\treturn $content;\n\t\t}\n\t}\n\n\t/**\n\t * Run minify process and save content\n\t *\n\t * @since  1.9\n\t * @access public\n\t */\n\tpublic function serve( $request_url, $file_type, $minify, $src_list ) {\n\t\t// Try Unique CSS\n\t\tif ($file_type == 'css') {\n\t\t\t$content = false;\n\t\t\tif (defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_OPTM_UCSS)) {\n\t\t\t\t$filename = $this->cls('UCSS')->load($request_url);\n\n\t\t\t\tif ($filename) {\n\t\t\t\t\treturn array( $filename, 'ucss' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Before generated, don't know the contented hash filename yet, so used url hash as tmp filename\n\t\t$file_path_prefix = $this->_build_filepath_prefix($file_type);\n\n\t\t$url_tag          = $request_url;\n\t\t$url_tag_for_file = md5($request_url);\n\t\tif (is_404()) {\n\t\t\t$url_tag_for_file = $url_tag = '404';\n\t\t} elseif ($file_type == 'css' && apply_filters('litespeed_ucss_per_pagetype', false)) {\n\t\t\t$url_tag_for_file = $url_tag = Utility::page_type();\n\t\t}\n\n\t\t$static_file = LITESPEED_STATIC_DIR . $file_path_prefix . $url_tag_for_file . '.' . $file_type;\n\n\t\t// Create tmp file to avoid conflict\n\t\t$tmp_static_file = $static_file . '.tmp';\n\t\tif (file_exists($tmp_static_file) && time() - filemtime($tmp_static_file) <= 600) {\n\t\t\t// some other request is generating\n\t\t\treturn false;\n\t\t}\n\t\t// File::save( $tmp_static_file, '/* ' . ( is_404() ? '404' : $request_url ) . ' */', true ); // Can't use this bcos this will get filecon md5 changed\n\t\tFile::save($tmp_static_file, '', true);\n\n\t\t// Load content\n\t\t$real_files = array();\n\t\tforeach ($src_list as $src_info) {\n\t\t\t$is_min = false;\n\t\t\tif (!empty($src_info['inl'])) {\n\t\t\t\t// Load inline\n\t\t\t\t$content = $src_info['src'];\n\t\t\t} else {\n\t\t\t\t// Load file\n\t\t\t\t$content = $this->load_file($src_info['src'], $file_type);\n\n\t\t\t\tif (!$content) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$is_min = $this->is_min($src_info['src']);\n\t\t\t}\n\t\t\t$content = $this->optm_snippet($content, $file_type, $minify && !$is_min, $src_info['src'], !empty($src_info['media']) ? $src_info['media'] : false);\n\t\t\t// Write to file\n\t\t\tFile::save($tmp_static_file, $content, true, true);\n\t\t}\n\n\t\t// if CSS - run the minification on the saved file.\n\t\t// Will move imports to the top of file and remove extra spaces.\n\t\tif ($file_type == 'css') {\n\t\t\t$obj                   = new Lib\\CSS_JS_MIN\\Minify\\CSS();\n\t\t\t$file_content_combined = $obj->moveImportsToTop(File::read($tmp_static_file));\n\n\t\t\tFile::save($tmp_static_file, $file_content_combined);\n\t\t}\n\n\t\t// validate md5\n\t\t$filecon_md5 = md5_file($tmp_static_file);\n\n\t\t$final_file_path = $file_path_prefix . $filecon_md5 . '.' . $file_type;\n\t\t$realfile        = LITESPEED_STATIC_DIR . $final_file_path;\n\t\tif (!file_exists($realfile)) {\n\t\t\trename($tmp_static_file, $realfile);\n\t\t\tDebug2::debug2('[Optmer] Saved static file [path] ' . $realfile);\n\t\t} else {\n\t\t\tunlink($tmp_static_file);\n\t\t}\n\n\t\t$vary = $this->cls('Vary')->finalize_full_varies();\n\t\tDebug2::debug2(\"[Optmer] Save URL to file for [file_type] $file_type [file] $filecon_md5 [vary] $vary \");\n\t\t$this->cls('Data')->save_url($url_tag, $vary, $file_type, $filecon_md5, dirname($realfile));\n\n\t\treturn array( $filecon_md5 . '.' . $file_type, $file_type );\n\t}\n\n\t/**\n\t * Load a single file\n\t *\n\t * @since  4.0\n\t */\n\tpublic function optm_snippet( $content, $file_type, $minify, $src, $media = false ) {\n\t\t// CSS related features\n\t\tif ($file_type == 'css') {\n\t\t\t// Font optimize\n\t\t\tif ($this->_conf_css_font_display) {\n\t\t\t\t$content = preg_replace('#(@font\\-face\\s*\\{)#isU', '${1}font-display:swap;', $content);\n\t\t\t}\n\n\t\t\t$content = preg_replace('/@charset[^;]+;\\\\s*/', '', $content);\n\n\t\t\tif ($media) {\n\t\t\t\t$content = '@media ' . $media . '{' . $content . \"\\n}\";\n\t\t\t}\n\n\t\t\tif ($minify) {\n\t\t\t\t$content = self::minify_css($content);\n\t\t\t}\n\n\t\t\t$content = $this->cls('CDN')->finalize($content);\n\n\t\t\tif ((defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_IMG_OPTM_WEBP)) && $this->cls('Media')->webp_support()) {\n\t\t\t\t$content = $this->cls('Media')->replace_background_webp($content);\n\t\t\t}\n\t\t} else {\n\t\t\tif ($minify) {\n\t\t\t\t$content = self::minify_js($content);\n\t\t\t} else {\n\t\t\t\t$content = $this->_null_minifier($content);\n\t\t\t}\n\n\t\t\t$content .= \"\\n;\";\n\t\t}\n\n\t\t// Add filter\n\t\t$content = apply_filters('litespeed_optm_cssjs', $content, $file_type, $src);\n\n\t\treturn $content;\n\t}\n\n\t/**\n\t * Load remote resource from cache if existed\n\t *\n\t * @since  4.7\n\t */\n\tprivate function load_cached_file( $url, $file_type ) {\n\t\t$file_path_prefix     = $this->_build_filepath_prefix($file_type);\n\t\t$folder_name          = LITESPEED_STATIC_DIR . $file_path_prefix;\n\t\t$to_be_deleted_folder = $folder_name . date('Ymd', strtotime('-2 days'));\n\t\tif (file_exists($to_be_deleted_folder)) {\n\t\t\tDebug2::debug('[Optimizer] ❌ Clearing folder [name] ' . $to_be_deleted_folder);\n\t\t\tFile::rrmdir($to_be_deleted_folder);\n\t\t}\n\n\t\t$today_file = $folder_name . date('Ymd') . '/' . md5($url);\n\t\tif (file_exists($today_file)) {\n\t\t\treturn File::read($today_file);\n\t\t}\n\n\t\t// Write file\n\t\t$res      = wp_safe_remote_get($url);\n\t\t$res_code = wp_remote_retrieve_response_code($res);\n\t\tif (is_wp_error($res) || $res_code != 200) {\n\t\t\tDebug2::debug2('[Optimizer] ❌ Load Remote error [code] ' . $res_code);\n\t\t\treturn false;\n\t\t}\n\t\t$con = wp_remote_retrieve_body($res);\n\t\tif (!$con) {\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug('[Optimizer] ✅ Save remote file to cache [name] ' . $today_file);\n\t\tFile::save($today_file, $con, true);\n\n\t\treturn $con;\n\t}\n\n\t/**\n\t * Load remote/local resource\n\t *\n\t * @since  3.5\n\t */\n\tpublic function load_file( $src, $file_type = 'css' ) {\n\t\t$real_file = Utility::is_internal_file($src);\n\t\t$postfix   = pathinfo(parse_url($src, PHP_URL_PATH), PATHINFO_EXTENSION);\n\t\tif (!$real_file || $postfix != $file_type) {\n\t\t\tDebug2::debug2('[CSS] Load Remote [' . $file_type . '] ' . $src);\n\t\t\t$this_url = substr($src, 0, 2) == '//' ? set_url_scheme($src) : $src;\n\t\t\t$con      = $this->load_cached_file($this_url, $file_type);\n\n\t\t\tif ($file_type == 'css') {\n\t\t\t\t$dirname = dirname($this_url) . '/';\n\n\t\t\t\t$con = Lib\\UriRewriter::prepend($con, $dirname);\n\t\t\t}\n\t\t} else {\n\t\t\tDebug2::debug2('[CSS] Load local [' . $file_type . '] ' . $real_file[0]);\n\t\t\t$con = File::read($real_file[0]);\n\n\t\t\tif ($file_type == 'css') {\n\t\t\t\t$dirname = dirname($real_file[0]);\n\n\t\t\t\t$con = Lib\\UriRewriter::rewrite($con, $dirname);\n\t\t\t}\n\t\t}\n\n\t\treturn $con;\n\t}\n\n\t/**\n\t * Minify CSS\n\t *\n\t * @since  2.2.3\n\t * @access private\n\t */\n\tpublic static function minify_css( $data ) {\n\t\ttry {\n\t\t\t$obj = new Lib\\CSS_JS_MIN\\Minify\\CSS();\n\t\t\t$obj->add($data);\n\n\t\t\treturn $obj->minify();\n\t\t} catch (\\Exception $e) {\n\t\t\tDebug2::debug('******[Optmer] minify_css failed: ' . $e->getMessage());\n\t\t\terror_log('****** LiteSpeed Optimizer minify_css failed: ' . $e->getMessage());\n\t\t\treturn $data;\n\t\t}\n\t}\n\n\t/**\n\t * Minify JS\n\t *\n\t * Added exception capture when minify\n\t *\n\t * @since  2.2.3\n\t * @access private\n\t */\n\tpublic static function minify_js( $data, $js_type = '' ) {\n\t\t// For inline JS optimize, need to check if it's js type\n\t\tif ($js_type) {\n\t\t\tpreg_match('#type=([\\'\"])(.+)\\g{1}#isU', $js_type, $matches);\n\t\t\tif ($matches && $matches[2] != 'text/javascript') {\n\t\t\t\tDebug2::debug('******[Optmer] minify_js bypass due to type: ' . $matches[2]);\n\t\t\t\treturn $data;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\t$obj = new Lib\\CSS_JS_MIN\\Minify\\JS();\n\t\t\t$obj->add($data);\n\n\t\t\treturn $obj->minify();\n\t\t} catch (\\Exception $e) {\n\t\t\tDebug2::debug('******[Optmer] minify_js failed: ' . $e->getMessage());\n\t\t\t// error_log( '****** LiteSpeed Optimizer minify_js failed: ' . $e->getMessage() );\n\t\t\treturn $data;\n\t\t}\n\t}\n\n\t/**\n\t * Basic minifier\n\t *\n\t * @access private\n\t */\n\tprivate function _null_minifier( $content ) {\n\t\t$content = str_replace(\"\\r\\n\", \"\\n\", $content);\n\n\t\treturn trim($content);\n\t}\n\n\t/**\n\t * Check if the file is already min file\n\t *\n\t * @since  1.9\n\t */\n\tpublic function is_min( $filename ) {\n\t\t$basename = basename($filename);\n\t\tif (preg_match('/[-\\.]min\\.(?:[a-zA-Z]+)$/i', $basename)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n",
    "plugins/litespeed-cache/src/admin-settings.cls.php": "<?php\n/**\n * The admin settings handler of the plugin.\n *\n * Handles saving and validating settings from the admin UI and network admin.\n *\n * @since      1.1.0\n * @package    LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n/**\n * Class Admin_Settings\n *\n * Saves, sanitizes, and validates LiteSpeed Cache settings.\n */\nclass Admin_Settings extends Base {\n\tconst LOG_TAG = '[Settings]';\n\n\tconst ENROLL = '_settings-enroll';\n\n\t/**\n\t * Save settings (single site).\n\t *\n\t * Accepts data from $_POST or WP-CLI.\n\t * Importers may call the Conf class directly.\n\t *\n\t * @since 3.0\n\t *\n\t * @param array<string,mixed> $raw_data Raw data from request/CLI.\n\t * @return void\n\t */\n\tpublic function save( $raw_data ) {\n\t\tself::debug( 'saving' );\n\n\t\tif ( empty( $raw_data[ self::ENROLL ] ) ) {\n\t\t\twp_die( esc_html__( 'No fields', 'litespeed-cache' ) );\n\t\t}\n\n\t\t$raw_data = Admin::cleanup_text( $raw_data );\n\n\t\t// Convert data to config format.\n\t\t$the_matrix = [];\n\t\tforeach ( array_unique( $raw_data[ self::ENROLL ] ) as $id ) {\n\t\t\t$child = false;\n\n\t\t\t// Drop array format.\n\t\t\tif ( false !== strpos( $id, '[' ) ) {\n\t\t\t\tif ( 0 === strpos( $id, self::O_CDN_MAPPING ) || 0 === strpos( $id, self::O_CRAWLER_COOKIES ) ) {\n\t\t\t\t\t// CDN child | Cookie Crawler settings.\n\t\t\t\t\t$child = substr( $id, strpos( $id, '[' ) + 1, strpos( $id, ']' ) - strpos( $id, '[' ) - 1 );\n\t\t\t\t\t// Drop ending []; Compatible with xx[0] way from CLI.\n\t\t\t\t\t$id = substr( $id, 0, strpos( $id, '[' ) );\n\t\t\t\t} else {\n\t\t\t\t\t// Drop ending [].\n\t\t\t\t\t$id = substr( $id, 0, strpos( $id, '[' ) );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! array_key_exists( $id, self::$_default_options ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Validate $child.\n\t\t\tif ( self::O_CDN_MAPPING === $id ) {\n\t\t\t\tif ( ! in_array( $child, [ self::CDN_MAPPING_URL, self::CDN_MAPPING_INC_IMG, self::CDN_MAPPING_INC_CSS, self::CDN_MAPPING_INC_JS, self::CDN_MAPPING_FILETYPE ], true ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\tif ( ! in_array( $child, [ self::CRWL_COOKIE_NAME, self::CRWL_COOKIE_VALS ], true ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pull value from request.\n\t\t\tif ( $child ) {\n\t\t\t\t// []=xxx or [0]=xxx\n\t\t\t\t$data = ! empty( $raw_data[ $id ][ $child ] ) ? $raw_data[ $id ][ $child ] : false;\n\t\t\t} else {\n\t\t\t\t$data = ! empty( $raw_data[ $id ] ) ? $raw_data[ $id ] : false;\n\t\t\t}\n\n\t\t\t// Sanitize/normalize complex fields.\n\t\t\tif ( self::O_CDN_MAPPING === $id || self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\t// Use existing queued data if available (only when $child != false).\n\t\t\t\t$data2 = array_key_exists( $id, $the_matrix )\n\t\t\t\t\t? $the_matrix[ $id ]\n\t\t\t\t\t: ( defined( 'WP_CLI' ) && WP_CLI ? $this->conf( $id ) : [] );\n\t\t\t}\n\n\t\t\tswitch ( $id ) {\n\t\t\t\t// Don't allow Editor/admin to be used in crawler role simulator.\n\t\t\t\tcase self::O_CRAWLER_ROLES:\n\t\t\t\t\t$data = Utility::sanitize_lines( $data );\n\t\t\t\t\tif ( $data ) {\n\t\t\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\t\t\tif ( user_can( $v, 'edit_posts' ) ) {\n\t\t\t\t\t\t\t\t/* translators: %s: user id in <code> tags */\n\t\t\t\t\t\t\t\t$msg = sprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'The user with id %s has editor access, which is not allowed for the role simulator.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $v ) . '</code>'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tAdmin_Display::error( $msg );\n\t\t\t\t\t\t\t\tunset( $data[ $k ] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase self::O_CDN_MAPPING:\n\t\t\t\t\t/**\n\t\t\t\t\t * CDN setting\n\t\t\t\t\t *\n\t\t\t\t\t * Raw data format:\n\t\t\t\t\t *  cdn-mapping[url][] = 'xxx'\n\t\t\t\t\t *  cdn-mapping[url][2] = 'xxx2'\n\t\t\t\t\t *  cdn-mapping[inc_js][] = 1\n\t\t\t\t\t *\n\t\t\t\t\t * Final format:\n\t\t\t\t\t *  cdn-mapping[0][url] = 'xxx'\n\t\t\t\t\t *  cdn-mapping[2][url] = 'xxx2'\n\t\t\t\t\t */\n\t\t\t\t\tif ( $data ) {\n\t\t\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\t\t\tif ( self::CDN_MAPPING_FILETYPE === $child ) {\n\t\t\t\t\t\t\t\t$v = Utility::sanitize_lines( $v );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( self::CDN_MAPPING_URL === $child ) {\n\t\t\t\t\t\t\t\t// If not a valid URL, turn off CDN.\n\t\t\t\t\t\t\t\tif ( 0 !== strpos( $v, 'https://' ) ) {\n\t\t\t\t\t\t\t\t\tself::debug( '❌ CDN mapping set to OFF due to invalid URL' );\n\t\t\t\t\t\t\t\t\t$the_matrix[ self::O_CDN ] = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$v = trailingslashit( $v );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( in_array( $child, [ self::CDN_MAPPING_INC_IMG, self::CDN_MAPPING_INC_CSS, self::CDN_MAPPING_INC_JS ], true ) ) {\n\t\t\t\t\t\t\t\t// Because these can't be auto detected in `config->update()`, need to format here.\n\t\t\t\t\t\t\t\t$v = 'false' === $v ? 0 : (bool) $v;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( empty( $data2[ $k ] ) ) {\n\t\t\t\t\t\t\t\t$data2[ $k ] = [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$data2[ $k ][ $child ] = $v;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase self::O_CRAWLER_COOKIES:\n\t\t\t\t\t/**\n\t\t\t\t\t * Cookie Crawler setting\n\t\t\t\t\t * Raw Format:\n\t\t\t\t\t *  crawler-cookies[name][] = xxx\n\t\t\t\t\t *  crawler-cookies[name][2] = xxx2\n\t\t\t\t\t *  crawler-cookies[vals][] = xxx\n\t\t\t\t\t *\n\t\t\t\t\t * Final format:\n\t\t\t\t\t *  crawler-cookie[0][name] = 'xxx'\n\t\t\t\t\t *  crawler-cookie[0][vals] = 'xxx'\n\t\t\t\t\t *  crawler-cookie[2][name] = 'xxx2'\n\t\t\t\t\t *\n\t\t\t\t\t * Empty line for `vals` uses literal `_null`.\n\t\t\t\t\t */\n\t\t\t\t\tif ( $data ) {\n\t\t\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\t\t\tif ( self::CRWL_COOKIE_VALS === $child ) {\n\t\t\t\t\t\t\t\t$v = Utility::sanitize_lines( $v );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( empty( $data2[ $k ] ) ) {\n\t\t\t\t\t\t\t\t$data2[ $k ] = [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$data2[ $k ][ $child ] = $v;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Cache exclude category.\n\t\t\t\tcase self::O_CACHE_EXC_CAT:\n\t\t\t\t\t$data2 = [];\n\t\t\t\t\t$data  = Utility::sanitize_lines( $data );\n\t\t\t\t\tforeach ( $data as $v ) {\n\t\t\t\t\t\t$cat_id = get_cat_ID( $v );\n\t\t\t\t\t\tif ( ! $cat_id ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$data2[] = $cat_id;\n\t\t\t\t\t}\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Cache exclude tag.\n\t\t\t\tcase self::O_CACHE_EXC_TAG:\n\t\t\t\t\t$data2 = [];\n\t\t\t\t\t$data  = Utility::sanitize_lines( $data );\n\t\t\t\t\tforeach ( $data as $v ) {\n\t\t\t\t\t\t$term = get_term_by( 'name', $v, 'post_tag' );\n\t\t\t\t\t\tif ( ! $term ) {\n\t\t\t\t\t\t\t// Could surface an admin error here if desired.\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$data2[] = $term->term_id;\n\t\t\t\t\t}\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$the_matrix[ $id ] = $data;\n\t\t}\n\n\t\t// Special handler for CDN/Crawler 2d list to drop empty rows.\n\t\tforeach ( $the_matrix as $id => $data ) {\n\t\t\t/**\n\t\t\t * Format:\n\t\t\t *  cdn-mapping[0][url] = 'xxx'\n\t\t\t *  cdn-mapping[2][url] = 'xxx2'\n\t\t\t *  crawler-cookie[0][name] = 'xxx'\n\t\t\t *  crawler-cookie[0][vals] = 'xxx'\n\t\t\t *  crawler-cookie[2][name] = 'xxx2'\n\t\t\t */\n\t\t\tif ( self::O_CDN_MAPPING === $id || self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\t// Drop row if all children are empty.\n\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\tforeach ( $v as $v2 ) {\n\t\t\t\t\t\tif ( $v2 ) {\n\t\t\t\t\t\t\tcontinue 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// All empty.\n\t\t\t\t\tunset( $the_matrix[ $id ][ $k ] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Don't allow repeated cookie names.\n\t\t\tif ( self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\t$existed = [];\n\t\t\t\tforeach ( $the_matrix[ $id ] as $k => $v ) {\n\t\t\t\t\tif ( empty( $v[ self::CRWL_COOKIE_NAME ] ) || in_array( $v[ self::CRWL_COOKIE_NAME ], $existed, true ) ) {\n\t\t\t\t\t\t// Filter repeated or empty name.\n\t\t\t\t\t\tunset( $the_matrix[ $id ][ $k ] );\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t$existed[] = $v[ self::CRWL_COOKIE_NAME ];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// tmp fix the 3rd part woo update hook issue when enabling vary cookie.\n\t\t\tif ( 'wc_cart_vary' === $id ) {\n\t\t\t\tif ( $data ) {\n\t\t\t\t\tadd_filter(\n\t\t\t\t\t\t'litespeed_vary_cookies',\n\t\t\t\t\t\tfunction ( $arr ) {\n\t\t\t\t\t\t\t$arr[] = 'woocommerce_cart_hash';\n\t\t\t\t\t\t\treturn array_unique( $arr );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tadd_filter(\n\t\t\t\t\t\t'litespeed_vary_cookies',\n\t\t\t\t\t\tfunction ( $arr ) {\n\t\t\t\t\t\t\t$key = array_search( 'woocommerce_cart_hash', $arr, true );\n\t\t\t\t\t\t\tif ( false !== $key ) {\n\t\t\t\t\t\t\t\tunset( $arr[ $key ] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn array_unique( $arr );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// id validation will be inside.\n\t\t$this->cls( 'Conf' )->update_confs( $the_matrix );\n\n\t\t$msg = __( 'Options saved.', 'litespeed-cache' );\n\t\tAdmin_Display::success( $msg );\n\t}\n\n\t/**\n\t * Parses any changes made by the network admin on the network settings.\n\t *\n\t * @since 3.0\n\t *\n\t * @param array<string,mixed> $raw_data Raw data from request/CLI.\n\t * @return void\n\t */\n\tpublic function network_save( $raw_data ) {\n\t\tself::debug( 'network saving' );\n\n\t\tif ( empty( $raw_data[ self::ENROLL ] ) ) {\n\t\t\twp_die( esc_html__( 'No fields', 'litespeed-cache' ) );\n\t\t}\n\n\t\t$raw_data = Admin::cleanup_text( $raw_data );\n\n\t\tforeach ( array_unique( $raw_data[ self::ENROLL ] ) as $id ) {\n\t\t\t// Append current field to setting save.\n\t\t\tif ( ! array_key_exists( $id, self::$_default_site_options ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$data = ! empty( $raw_data[ $id ] ) ? $raw_data[ $id ] : false;\n\n\t\t\t// id validation will be inside.\n\t\t\t$this->cls( 'Conf' )->network_update( $id, $data );\n\t\t}\n\n\t\t// Update related files.\n\t\tActivation::cls()->update_files();\n\n\t\t$msg = __( 'Options saved.', 'litespeed-cache' );\n\t\tAdmin_Display::success( $msg );\n\t}\n\n\t/**\n\t * Hooked to the wp_redirect filter when saving widgets fails validation.\n\t *\n\t * @since 1.1.3\n\t *\n\t * @param string $location The redirect location.\n\t * @return string Updated location string.\n\t */\n\tpublic static function widget_save_err( $location ) {\n\t\treturn str_replace( '?message=0', '?error=0', $location );\n\t}\n\n\t/**\n\t * Validate the LiteSpeed Cache settings on widget save.\n\t *\n\t * @since 1.1.3\n\t *\n\t * @param array      $instance     The new settings.\n\t * @param array      $new_instance The raw submitted settings.\n\t * @param array      $old_instance The original settings.\n\t * @param \\WP_Widget $widget       The widget instance.\n\t * @return array|false Updated settings on success, false on error.\n\t */\n\tpublic static function validate_widget_save( $instance, $new_instance, $old_instance, $widget ) {\n\t\tif ( empty( $new_instance ) ) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\tif ( ! isset( $new_instance[ ESI::WIDGET_O_ESIENABLE ], $new_instance[ ESI::WIDGET_O_TTL ] ) ) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$esi = (int) $new_instance[ ESI::WIDGET_O_ESIENABLE ] % 3;\n\t\t$ttl = (int) $new_instance[ ESI::WIDGET_O_TTL ];\n\n\t\tif ( 0 !== $ttl && $ttl < 30 ) {\n\t\t\tadd_filter( 'wp_redirect', __CLASS__ . '::widget_save_err' );\n\t\t\treturn false; // Invalid ttl.\n\t\t}\n\n\t\tif ( empty( $instance[ Conf::OPTION_NAME ] ) ) {\n\t\t\t// @todo to be removed.\n\t\t\t$instance[ Conf::OPTION_NAME ] = [];\n\t\t}\n\t\t$instance[ Conf::OPTION_NAME ][ ESI::WIDGET_O_ESIENABLE ] = $esi;\n\t\t$instance[ Conf::OPTION_NAME ][ ESI::WIDGET_O_TTL ]       = $ttl;\n\n\t\t$current = ! empty( $old_instance[ Conf::OPTION_NAME ] ) ? $old_instance[ Conf::OPTION_NAME ] : false;\n\n\t\t// Avoid unsanitized superglobal usage.\n\t\t$referrer = isset( $_SERVER['HTTP_REFERER'] ) ? esc_url_raw( wp_unslash( $_SERVER['HTTP_REFERER'] ) ) : '';\n\n\t\t// Only purge when not in the Customizer.\n\t\tif ( false === strpos( $referrer, '/wp-admin/customize.php' ) ) {\n\t\t\tif ( ! $current || $esi !== (int) $current[ ESI::WIDGET_O_ESIENABLE ] ) {\n\t\t\t\tPurge::purge_all( 'Widget ESI_enable changed' );\n\t\t\t} elseif ( 0 !== $ttl && $ttl !== (int) $current[ ESI::WIDGET_O_TTL ] ) {\n\t\t\t\tPurge::add( Tag::TYPE_WIDGET . $widget->id );\n\t\t\t}\n\n\t\t\tPurge::purge_all( 'Widget saved' );\n\t\t}\n\n\t\treturn $instance;\n\t}\n}\n",
    "plugins/litespeed-cache/src/rest.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The REST related class.\n *\n * @since       2.9.4\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass REST extends Root {\n\n\tconst LOG_TAG                  = '☎️';\n\tprivate $_internal_rest_status = false;\n\n\t/**\n\t * Confructor of ESI\n\t *\n\t * @since    2.9.4\n\t */\n\tpublic function __construct() {\n\t\t// Hook to internal REST call\n\t\tadd_filter('rest_request_before_callbacks', array( $this, 'set_internal_rest_on' ));\n\t\tadd_filter('rest_request_after_callbacks', array( $this, 'set_internal_rest_off' ));\n\n\t\tadd_action('rest_api_init', array( $this, 'rest_api_init' ));\n\t}\n\n\t/**\n\t * Register REST hooks\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function rest_api_init() {\n\t\t// Activate or deactivate a specific crawler callback\n\t\tregister_rest_route('litespeed/v1', '/toggle_crawler_state', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'toggle_crawler_state' ),\n\t\t\t'permission_callback' => function () {\n\t\t\t\treturn current_user_can('manage_network_options') || current_user_can('manage_options');\n\t\t\t},\n\t\t));\n\n\t\tregister_rest_route('litespeed/v1', '/tool/check_ip', array(\n\t\t\t'methods' => 'GET',\n\t\t\t'callback' => array( $this, 'check_ip' ),\n\t\t\t'permission_callback' => function () {\n\t\t\t\treturn current_user_can('manage_network_options') || current_user_can('manage_options');\n\t\t\t},\n\t\t));\n\n\t\t// IP callback validate\n\t\tregister_rest_route('litespeed/v3', '/ip_validate', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'ip_validate' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t// 1.2. WP REST Dryrun Callback\n\t\tregister_rest_route('litespeed/v3', '/wp_rest_echo', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'wp_rest_echo' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\t\tregister_rest_route('litespeed/v3', '/ping', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'ping' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t// CDN setup callback notification\n\t\tregister_rest_route('litespeed/v3', '/cdn_status', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'cdn_status' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t// Image optm notify_img\n\t\t// Need validation\n\t\tregister_rest_route('litespeed/v1', '/notify_img', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_img' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed/v1', '/notify_ccss', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_ccss' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed/v1', '/notify_ucss', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_ucss' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed/v1', '/notify_vpi', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_vpi' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed/v3', '/err_domains', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'err_domains' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t// Image optm check_img\n\t\t// Need validation\n\t\tregister_rest_route('litespeed/v1', '/check_img', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'check_img' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\t}\n\n\t/**\n\t * Call to freeze or melt the crawler clicked\n\t *\n\t * @since  4.3\n\t */\n\tpublic function toggle_crawler_state() {\n\t\tif (isset($_POST['crawler_id'])) {\n\t\t\treturn $this->cls('Crawler')->toggle_activeness($_POST['crawler_id']) ? 1 : 0;\n\t\t}\n\t}\n\n\t/**\n\t * Check if the request is from cloud nodes\n\t *\n\t * @since 4.2\n\t * @since 4.4.7 As there is always token/api key validation, ip validation is redundant\n\t */\n\tpublic function is_from_cloud() {\n\t\t// return true;\n\t\treturn $this->cls('Cloud')->is_from_cloud();\n\t}\n\n\t/**\n\t * Ping pong\n\t *\n\t * @since  3.0.4\n\t */\n\tpublic function ping() {\n\t\treturn $this->cls('Cloud')->ping();\n\t}\n\n\t/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t */\n\tpublic function check_ip() {\n\t\treturn Tool::cls()->check_ip();\n\t}\n\n\t/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t */\n\tpublic function ip_validate() {\n\t\treturn $this->cls('Cloud')->ip_validate();\n\t}\n\n\t/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t */\n\tpublic function wp_rest_echo() {\n\t\treturn $this->cls('Cloud')->wp_rest_echo();\n\t}\n\n\t/**\n\t * Endpoint for QC to notify plugin of CDN status update.\n\t *\n\t * @since  7.0\n\t */\n\tpublic function cdn_status() {\n\t\treturn $this->cls('Cloud')->update_cdn_status();\n\t}\n\n\t/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t */\n\tpublic function notify_img() {\n\t\treturn Img_Optm::cls()->notify_img();\n\t}\n\n\t/**\n\t * @since  7.1\n\t */\n\tpublic function notify_ccss() {\n\t\tself::debug('notify_ccss');\n\t\treturn CSS::cls()->notify();\n\t}\n\n\t/**\n\t * @since  5.2\n\t */\n\tpublic function notify_ucss() {\n\t\tself::debug('notify_ucss');\n\t\treturn UCSS::cls()->notify();\n\t}\n\n\t/**\n\t * @since  4.7\n\t */\n\tpublic function notify_vpi() {\n\t\tself::debug('notify_vpi');\n\t\treturn VPI::cls()->notify();\n\t}\n\n\t/**\n\t * @since  4.7\n\t */\n\tpublic function err_domains() {\n\t\tself::debug('err_domains');\n\t\treturn $this->cls('Cloud')->rest_err_domains();\n\t}\n\n\t/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t */\n\tpublic function check_img() {\n\t\treturn Img_Optm::cls()->check_img();\n\t}\n\n\t/**\n\t * Return error\n\t *\n\t * @since  5.7.0.1\n\t */\n\tpublic static function err( $code ) {\n\t\treturn array(\n\t\t\t'_res' => 'err',\n\t\t\t'_msg' => $code,\n\t\t);\n\t}\n\n\t/**\n\t * Set internal REST tag to ON\n\t *\n\t * @since  2.9.4\n\t * @access public\n\t */\n\tpublic function set_internal_rest_on( $not_used = null ) {\n\t\t$this->_internal_rest_status = true;\n\t\tDebug2::debug2('[REST] ✅ Internal REST ON [filter] rest_request_before_callbacks');\n\n\t\treturn $not_used;\n\t}\n\n\t/**\n\t * Set internal REST tag to OFF\n\t *\n\t * @since  2.9.4\n\t * @access public\n\t */\n\tpublic function set_internal_rest_off( $not_used = null ) {\n\t\t$this->_internal_rest_status = false;\n\t\tDebug2::debug2('[REST] ❎ Internal REST OFF [filter] rest_request_after_callbacks');\n\n\t\treturn $not_used;\n\t}\n\n\t/**\n\t * Get internal REST tag\n\t *\n\t * @since  2.9.4\n\t * @access public\n\t */\n\tpublic function is_internal_rest() {\n\t\treturn $this->_internal_rest_status;\n\t}\n\n\t/**\n\t * Check if an URL or current page is REST req or not\n\t *\n\t * @since  2.9.3\n\t * @since  2.9.4 Moved here from Utility, dropped static\n\t * @access public\n\t */\n\tpublic function is_rest( $url = false ) {\n\t\t// For WP 4.4.0- compatibility\n\t\tif (!function_exists('rest_get_url_prefix')) {\n\t\t\treturn defined('REST_REQUEST') && REST_REQUEST;\n\t\t}\n\n\t\t$prefix = rest_get_url_prefix();\n\n\t\t// Case #1: After WP_REST_Request initialisation\n\t\tif (defined('REST_REQUEST') && REST_REQUEST) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Case #2: Support \"plain\" permalink settings\n\t\tif (isset($_GET['rest_route']) && strpos(trim($_GET['rest_route'], '\\\\/'), $prefix, 0) === 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!$url) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Case #3: URL Path begins with wp-json/ (REST prefix) Safe for subfolder installation\n\t\t$rest_url    = wp_parse_url(site_url($prefix));\n\t\t$current_url = wp_parse_url($url);\n\t\t// Debug2::debug( '[Util] is_rest check [base] ', $rest_url );\n\t\t// Debug2::debug( '[Util] is_rest check [curr] ', $current_url );\n\t\t// Debug2::debug( '[Util] is_rest check [curr2] ', wp_parse_url( add_query_arg( array( ) ) ) );\n\t\tif ($current_url !== false && !empty($current_url['path']) && $rest_url !== false && !empty($rest_url['path'])) {\n\t\t\treturn strpos($current_url['path'], $rest_url['path']) === 0;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n",
    "plugins/litespeed-cache/src/localization.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The localization class.\n *\n * @since       3.3\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Localization extends Base {\n\n\tconst LOG_TAG = '🛍️';\n\n\t/**\n\t * Init optimizer\n\t *\n\t * @since  3.0\n\t * @access protected\n\t */\n\tpublic function init() {\n\t\tadd_filter('litespeed_buffer_finalize', array( $this, 'finalize' ), 23); // After page optm\n\t}\n\n\t/**\n\t * Localize Resources\n\t *\n\t * @since  3.3\n\t */\n\tpublic function serve_static( $uri ) {\n\t\t$url = base64_decode($uri);\n\n\t\tif (!$this->conf(self::O_OPTM_LOCALIZE)) {\n\t\t\t// wp_redirect( $url );\n\t\t\texit('Not supported');\n\t\t}\n\n\t\tif (substr($url, -3) !== '.js') {\n\t\t\t// wp_redirect( $url );\n\t\t\t// exit( 'Not supported ' . $uri );\n\t\t}\n\n\t\t$match   = false;\n\t\t$domains = $this->conf(self::O_OPTM_LOCALIZE_DOMAINS);\n\t\tforeach ($domains as $v) {\n\t\t\tif (!$v || strpos($v, '#') === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$type   = 'js';\n\t\t\t$domain = $v;\n\t\t\t// Try to parse space split value\n\t\t\tif (strpos($v, ' ')) {\n\t\t\t\t$v = explode(' ', $v);\n\t\t\t\tif (!empty($v[1])) {\n\t\t\t\t\t$type   = strtolower($v[0]);\n\t\t\t\t\t$domain = $v[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strpos($domain, 'https://') !== 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($type != 'js') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// if ( strpos( $url, $domain ) !== 0 ) {\n\t\t\tif ($url != $domain) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$match = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!$match) {\n\t\t\t// wp_redirect( $url );\n\t\t\texit('Not supported2');\n\t\t}\n\n\t\theader('Content-Type: application/javascript');\n\n\t\t// Generate\n\t\t$this->_maybe_mk_cache_folder('localres');\n\n\t\t$file = $this->_realpath($url);\n\n\t\tself::debug('localize [url] ' . $url);\n\t\t$response = wp_safe_remote_get($url, array(\n\t\t\t'timeout' => 180,\n\t\t\t'stream' => true,\n\t\t\t'filename' => $file,\n\t\t));\n\n\t\t// Parse response data\n\t\tif (is_wp_error($response)) {\n\t\t\t$error_message = $response->get_error_message();\n\t\t\tfile_exists($file) && unlink($file);\n\t\t\tself::debug('failed to get: ' . $error_message);\n\t\t\twp_redirect($url);\n\t\t\texit();\n\t\t}\n\n\t\t$url = $this->_rewrite($url);\n\n\t\twp_redirect($url);\n\t\texit();\n\t}\n\n\t/**\n\t * Get the final URL of local avatar\n\t *\n\t * @since  4.5\n\t */\n\tprivate function _rewrite( $url ) {\n\t\treturn LITESPEED_STATIC_URL . '/localres/' . $this->_filepath($url);\n\t}\n\n\t/**\n\t * Generate realpath of the cache file\n\t *\n\t * @since  4.5\n\t * @access private\n\t */\n\tprivate function _realpath( $url ) {\n\t\treturn LITESPEED_STATIC_DIR . '/localres/' . $this->_filepath($url);\n\t}\n\n\t/**\n\t * Get filepath\n\t *\n\t * @since  4.5\n\t */\n\tprivate function _filepath( $url ) {\n\t\t$filename = md5($url) . '.js';\n\t\tif (is_multisite()) {\n\t\t\t$filename = get_current_blog_id() . '/' . $filename;\n\t\t}\n\t\treturn $filename;\n\t}\n\n\t/**\n\t * Localize JS/Fonts\n\t *\n\t * @since 3.3\n\t * @access public\n\t */\n\tpublic function finalize( $content ) {\n\t\tif (is_admin()) {\n\t\t\treturn $content;\n\t\t}\n\n\t\tif (!$this->conf(self::O_OPTM_LOCALIZE)) {\n\t\t\treturn $content;\n\t\t}\n\n\t\t$domains = $this->conf(self::O_OPTM_LOCALIZE_DOMAINS);\n\t\tif (!$domains) {\n\t\t\treturn $content;\n\t\t}\n\n\t\tforeach ($domains as $v) {\n\t\t\tif (!$v || strpos($v, '#') === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$type   = 'js';\n\t\t\t$domain = $v;\n\t\t\t// Try to parse space split value\n\t\t\tif (strpos($v, ' ')) {\n\t\t\t\t$v = explode(' ', $v);\n\t\t\t\tif (!empty($v[1])) {\n\t\t\t\t\t$type   = strtolower($v[0]);\n\t\t\t\t\t$domain = $v[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strpos($domain, 'https://') !== 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($type != 'js') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$content = str_replace($domain, LITESPEED_STATIC_URL . '/localres/' . base64_encode($domain), $content);\n\t\t}\n\n\t\treturn $content;\n\t}\n}\n",
    "plugins/litespeed-cache/src/object-cache-wp.cls.php": "<?php\n/**\n * WP Object Cache wrapper for LiteSpeed Cache.\n *\n * Provides a drop-in-compatible object cache implementation that proxies to\n * LiteSpeed's persistent cache while keeping a local runtime cache.\n *\n * @package LiteSpeed\n * @since   1.8\n */\n\n/**\n * Class WP_Object_Cache\n *\n * Implements the WordPress object cache for LiteSpeed Cache.\n *\n * @since 1.8\n * @package LiteSpeed\n */\nclass WP_Object_Cache {\n\n\t/**\n\t * Singleton instance\n\t *\n\t * @since 1.8\n\t * @access protected\n\t * @var WP_Object_Cache|null\n\t */\n\tprotected static $_instance;\n\n\t/**\n\t * Object cache instance\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var \\LiteSpeed\\Object_Cache\n\t */\n\tprivate $_object_cache;\n\n\t/**\n\t * Cache storage\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var array\n\t */\n\tprivate $_cache = array();\n\n\t/**\n\t * Cache for 404 keys\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var array\n\t */\n\tprivate $_cache_404 = array();\n\n\t/**\n\t * Total cache operations\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t */\n\tprivate $cache_total = 0;\n\n\t/**\n\t * Cache hits within call\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t */\n\tprivate $count_hit_incall = 0;\n\n\t/**\n\t * Cache hits\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t */\n\tprivate $count_hit = 0;\n\n\t/**\n\t * Cache misses within call\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t */\n\tprivate $count_miss_incall = 0;\n\n\t/**\n\t * Cache misses\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t */\n\tprivate $count_miss = 0;\n\n\t/**\n\t * Cache set operations\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t */\n\tprivate $count_set = 0;\n\n\t/**\n\t * Global cache groups\n\t *\n\t * @since 1.8\n\t * @access protected\n\t * @var array\n\t */\n\tprotected $global_groups = array();\n\n\t/**\n\t * Blog prefix for cache keys\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var string\n\t */\n\tprivate $blog_prefix;\n\n\t/**\n\t * Multisite flag\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var bool\n\t */\n\tprivate $multisite;\n\n\t/**\n\t * Init.\n\t *\n\t * Initializes the object cache with LiteSpeed settings.\n\t *\n\t * @since  1.8\n\t * @access public\n\t */\n\tpublic function __construct() {\n\t\t$this->_object_cache = \\LiteSpeed\\Object_Cache::cls();\n\n\t\t$this->multisite   = is_multisite();\n\t\t$this->blog_prefix = $this->multisite ? get_current_blog_id() . ':' : '';\n\n\t\t/**\n\t\t * Fix multiple instance using same oc issue\n\t\t *\n\t\t * @since  1.8.2\n\t\t */\n\t\tif ( ! defined( 'LSOC_PREFIX' ) ) {\n\t\t\tdefine( 'LSOC_PREFIX', substr( md5( __FILE__ ), -5 ) );\n\t\t}\n\t}\n\n\t/**\n\t * Makes private properties readable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name Property to get.\n\t * @return mixed Property.\n\t */\n\tpublic function __get( $name ) {\n\t\treturn $this->$name;\n\t}\n\n\t/**\n\t * Makes private properties settable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name  Property to set.\n\t * @param mixed  $value Property value.\n\t * @return mixed Newly-set property.\n\t */\n\tpublic function __set( $name, $value ) {\n\t\t$this->$name = $value;\n\n\t\treturn $this->$name;\n\t}\n\n\t/**\n\t * Makes private properties checkable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name Property to check if set.\n\t * @return bool Whether the property is set.\n\t */\n\tpublic function __isset( $name ) {\n\t\treturn isset( $this->$name );\n\t}\n\n\t/**\n\t * Makes private properties un-settable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name Property to unset.\n\t */\n\tpublic function __unset( $name ) {\n\t\tunset( $this->$name );\n\t}\n\n\t/**\n\t * Serves as a utility function to determine whether a key is valid.\n\t *\n\t * @since 5.4\n\t * @access protected\n\t *\n\t * @param int|string $key Cache key to check for validity.\n\t * @return bool Whether the key is valid.\n\t */\n\tprotected function is_valid_key( $key ) {\n\t\tif ( is_int( $key ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( is_string( $key ) && '' !== trim( $key ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\t$type = gettype( $key );\n\n\t\tif ( ! function_exists( '__' ) ) {\n\t\t\twp_load_translations_early();\n\t\t}\n\n\t\t$message = is_string( $key )\n\t\t\t? __( 'Cache key must not be an empty string.' )\n\t\t\t: sprintf(\n\t\t\t\t/* translators: %s: The type of the given cache key. */\n\t\t\t\t__( 'Cache key must be integer or non-empty string, %s given.' ),\n\t\t\t\t$type\n\t\t\t);\n\n\t\t_doing_it_wrong(\n\t\t\tesc_html( __METHOD__ ),\n\t\t\tesc_html( $message ),\n\t\t\t'6.1.0'\n\t\t);\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Get the final key.\n\t *\n\t * Generates a unique cache key based on group and prefix.\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @param int|string $key   Cache key.\n\t * @param string     $group Optional. Cache group. Default 'default'.\n\t * @return string The final cache key.\n\t */\n\tprivate function _key( $key, $group = 'default' ) {\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$prefix = $this->_object_cache->is_global( $group ) ? '' : $this->blog_prefix;\n\n\t\treturn LSOC_PREFIX . $prefix . $group . '.' . $key;\n\t}\n\n\t/**\n\t * Output debug info.\n\t *\n\t * Returns cache statistics for debugging purposes.\n\t *\n\t * @since  1.8\n\t * @access public\n\t * @return string Cache statistics.\n\t */\n\tpublic function debug() {\n\t\treturn ' [total] ' .\n\t\t\t$this->cache_total .\n\t\t\t' [hit_incall] ' .\n\t\t\t$this->count_hit_incall .\n\t\t\t' [hit] ' .\n\t\t\t$this->count_hit .\n\t\t\t' [miss_incall] ' .\n\t\t\t$this->count_miss_incall .\n\t\t\t' [miss] ' .\n\t\t\t$this->count_miss .\n\t\t\t' [set] ' .\n\t\t\t$this->count_set;\n\t}\n\n\t/**\n\t * Adds data to the cache if it doesn't already exist.\n\t *\n\t * @since 1.8\n\t * @access public\n\t * @see WP_Object_Cache::set()\n\t *\n\t * @param int|string $key    What to call the contents in the cache.\n\t * @param mixed      $data   The contents to store in the cache.\n\t * @param string     $group  Optional. Where to group the cache contents. Default 'default'.\n\t * @param int        $expire Optional. When to expire the cache contents, in seconds.\n\t *                           Default 0 (no expiration).\n\t * @return bool True on success, false if cache key and group already exist.\n\t */\n\tpublic function add( $key, $data, $group = 'default', $expire = 0 ) {\n\t\tif ( wp_suspend_cache_addition() ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( array_key_exists( $id, $this->_cache ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $this->set( $key, $data, $group, (int) $expire );\n\t}\n\n\t/**\n\t * Adds multiple values to the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $data   Array of keys and values to be added.\n\t * @param string $group  Optional. Where the cache contents are grouped. Default empty.\n\t * @param int    $expire Optional. When to expire the cache contents, in seconds.\n\t *                       Default 0 (no expiration).\n\t * @return bool[] Array of return values, grouped by key. Each value is either\n\t *                true on success, or false if cache key and group already exist.\n\t */\n\tpublic function add_multiple( array $data, $group = '', $expire = 0 ) {\n\t\t$values = array();\n\n\t\tforeach ( $data as $key => $value ) {\n\t\t\t$values[ $key ] = $this->add( $key, $value, $group, $expire );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t/**\n\t * Replaces the contents in the cache, if contents already exist.\n\t *\n\t * @since 1.8\n\t * @access public\n\t * @see WP_Object_Cache::set()\n\t *\n\t * @param int|string $key    What to call the contents in the cache.\n\t * @param mixed      $data   The contents to store in the cache.\n\t * @param string     $group  Optional. Where to group the cache contents. Default 'default'.\n\t * @param int        $expire Optional. When to expire the cache contents, in seconds.\n\t *                           Default 0 (no expiration).\n\t * @return bool True if contents were replaced, false if original value does not exist.\n\t */\n\tpublic function replace( $key, $data, $group = 'default', $expire = 0 ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( ! array_key_exists( $id, $this->_cache ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $this->set( $key, $data, $group, (int) $expire );\n\t}\n\n\t/**\n\t * Sets the data contents into the cache.\n\t *\n\t * The cache contents are grouped by the $group parameter followed by the\n\t * $key. This allows for duplicate IDs in unique groups. Therefore, naming of\n\t * the group should be used with care and should follow normal function\n\t * naming guidelines outside of core WordPress usage.\n\t *\n\t * The $expire parameter is not used, because the cache will automatically\n\t * expire for each time a page is accessed and PHP finishes. The method is\n\t * more for cache plugins which use files.\n\t *\n\t * @since 1.8\n\t * @since 5.4 Returns false if cache key is invalid.\n\t * @access public\n\t *\n\t * @param int|string $key    What to call the contents in the cache.\n\t * @param mixed      $data   The contents to store in the cache.\n\t * @param string     $group  Optional. Where to group the cache contents. Default 'default'.\n\t * @param int        $expire Optional. When to expire the cache contents, in seconds.\n\t *                           Default 0 (no expiration).\n\t * @return bool True if contents were set, false if key is invalid.\n\t */\n\tpublic function set( $key, $data, $group = 'default', $expire = 0 ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( is_object( $data ) ) {\n\t\t\t$data = clone $data;\n\t\t}\n\n\t\t$this->_cache[ $id ] = $data;\n\n\t\tif ( array_key_exists( $id, $this->_cache_404 ) ) {\n\t\t\tunset( $this->_cache_404[ $id ] );\n\t\t}\n\n\t\tif ( ! $this->_object_cache->is_non_persistent( $group ) ) {\n\t\t\t// phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions.serialize_serialize\n\t\t\t$this->_object_cache->set( $id, serialize( array( 'data' => $data ) ), (int) $expire );\n\t\t\t++$this->count_set;\n\t\t}\n\n\t\tif ( $this->_object_cache->store_transients( $group ) ) {\n\t\t\t$this->_transient_set( $key, $data, $group, (int) $expire );\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets multiple values to the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $data   Array of key and value to be set.\n\t * @param string $group  Optional. Where the cache contents are grouped. Default empty.\n\t * @param int    $expire Optional. When to expire the cache contents, in seconds.\n\t *                       Default 0 (no expiration).\n\t * @return bool[] Array of return values, grouped by key. Each value is always true.\n\t */\n\tpublic function set_multiple( array $data, $group = '', $expire = 0 ) {\n\t\t$values = array();\n\n\t\tforeach ( $data as $key => $value ) {\n\t\t\t$values[ $key ] = $this->set( $key, $value, $group, $expire );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t/**\n\t * Retrieves the cache contents, if it exists.\n\t *\n\t * The contents will be first attempted to be retrieved by searching by the\n\t * key in the cache group. If the cache is hit (success) then the contents\n\t * are returned.\n\t *\n\t * On failure, the number of cache misses will be incremented.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int|string $key   The key under which the cache contents are stored.\n\t * @param string     $group Optional. Where the cache contents are grouped. Default 'default'.\n\t * @param bool       $force Optional. Unused. Whether to force an update of the local cache\n\t *                          from the persistent cache. Default false.\n\t * @param bool       $found Optional. Whether the key was found in the cache (passed by reference).\n\t *                          Disambiguates a return of false, a storable value. Default null.\n\t * @return mixed|false The cache contents on success, false on failure to retrieve contents.\n\t */\n\tpublic function get( $key, $group = 'default', $force = false, &$found = null ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\t$found       = false;\n\t\t$found_in_oc = false;\n\t\t$cache_val   = false;\n\n\t\tif ( array_key_exists( $id, $this->_cache ) && ! $force ) {\n\t\t\t$found     = true;\n\t\t\t$cache_val = $this->_cache[ $id ];\n\t\t\t++$this->count_hit_incall;\n\t\t} elseif ( ! array_key_exists( $id, $this->_cache_404 ) && ! $this->_object_cache->is_non_persistent( $group ) ) {\n\t\t\t$v = $this->_object_cache->get( $id );\n\n\t\t\tif ( null !== $v ) {\n\t\t\t\t$v = maybe_unserialize( $v );\n\t\t\t}\n\n\t\t\t// To be compatible with false val.\n\t\t\tif ( is_array( $v ) && array_key_exists( 'data', $v ) ) {\n\t\t\t\t++$this->count_hit;\n\t\t\t\t$found       = true;\n\t\t\t\t$found_in_oc = true;\n\t\t\t\t$cache_val   = $v['data'];\n\t\t\t} else {\n\t\t\t\t// Can't find key, cache it to 404.\n\t\t\t\t$this->_cache_404[ $id ] = 1;\n\t\t\t\t++$this->count_miss;\n\t\t\t}\n\t\t} else {\n\t\t\t++$this->count_miss_incall;\n\t\t}\n\n\t\tif ( is_object( $cache_val ) ) {\n\t\t\t$cache_val = clone $cache_val;\n\t\t}\n\n\t\t// If not found but has `Store Transients` cfg on, still need to follow WP's get_transient() logic.\n\t\tif ( ! $found && $this->_object_cache->store_transients( $group ) ) {\n\t\t\t$cache_val = $this->_transient_get( $key, $group );\n\t\t\tif ( $cache_val ) {\n\t\t\t\t$found = true;\n\t\t\t}\n\t\t}\n\n\t\tif ( $found_in_oc ) {\n\t\t\t$this->_cache[ $id ] = $cache_val;\n\t\t}\n\n\t\t++$this->cache_total;\n\n\t\treturn $cache_val;\n\t}\n\n\t/**\n\t * Retrieves multiple values from the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $keys  Array of keys under which the cache contents are stored.\n\t * @param string $group Optional. Where the cache contents are grouped. Default 'default'.\n\t * @param bool   $force Optional. Whether to force an update of the local cache\n\t *                      from the persistent cache. Default false.\n\t * @return array Array of return values, grouped by key. Each value is either\n\t *               the cache contents on success, or false on failure.\n\t */\n\tpublic function get_multiple( $keys, $group = 'default', $force = false ) {\n\t\t$values = array();\n\n\t\tforeach ( $keys as $key ) {\n\t\t\t$values[ $key ] = $this->get( $key, $group, $force );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t/**\n\t * Removes the contents of the cache key in the group.\n\t *\n\t * If the cache key does not exist in the group, then nothing will happen.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int|string $key   What the contents in the cache are called.\n\t * @param string     $group Optional. Where the cache contents are grouped. Default 'default'.\n\t * @return bool True on success, false if the contents were not deleted.\n\t */\n\tpublic function delete( $key, $group = 'default' ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( $this->_object_cache->store_transients( $group ) ) {\n\t\t\t$this->_transient_del( $key, $group );\n\t\t}\n\n\t\tif ( array_key_exists( $id, $this->_cache ) ) {\n\t\t\tunset( $this->_cache[ $id ] );\n\t\t}\n\n\t\tif ( $this->_object_cache->is_non_persistent( $group ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $this->_object_cache->delete( $id );\n\t}\n\n\t/**\n\t * Deletes multiple values from the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $keys  Array of keys to be deleted.\n\t * @param string $group Optional. Where the cache contents are grouped. Default empty.\n\t * @return bool[] Array of return values, grouped by key. Each value is either\n\t *                true on success, or false if the contents were not deleted.\n\t */\n\tpublic function delete_multiple( array $keys, $group = '' ) {\n\t\t$values = array();\n\n\t\tforeach ( $keys as $key ) {\n\t\t\t$values[ $key ] = $this->delete( $key, $group );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t/**\n\t * Increments numeric cache item's value.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param int|string $key    The cache key to increment.\n\t * @param int        $offset Optional. The amount by which to increment the item's value.\n\t *                           Default 1.\n\t * @param string     $group  Optional. The group the key is in. Default 'default'.\n\t * @return int|false The item's new value on success, false on failure.\n\t */\n\tpublic function incr( $key, $offset = 1, $group = 'default' ) {\n\t\treturn $this->incr_desr( $key, $offset, $group, true );\n\t}\n\n\t/**\n\t * Decrements numeric cache item's value.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param int|string $key    The cache key to decrement.\n\t * @param int        $offset Optional. The amount by which to decrement the item's value.\n\t *                           Default 1.\n\t * @param string     $group  Optional. The group the key is in. Default 'default'.\n\t * @return int|false The item's new value on success, false on failure.\n\t */\n\tpublic function decr( $key, $offset = 1, $group = 'default' ) {\n\t\treturn $this->incr_desr( $key, $offset, $group, false );\n\t}\n\n\t/**\n\t * Increments or decrements numeric cache item's value.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int|string $key    The cache key to increment or decrement.\n\t * @param int        $offset The amount by which to adjust the item's value.\n\t * @param string     $group  Optional. The group the key is in. Default 'default'.\n\t * @param bool       $incr   True to increment, false to decrement.\n\t * @return int|false The item's new value on success, false on failure.\n\t */\n\tpublic function incr_desr( $key, $offset = 1, $group = 'default', $incr = true ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$cache_val = $this->get( $key, $group );\n\n\t\tif ( false === $cache_val ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! is_numeric( $cache_val ) ) {\n\t\t\t$cache_val = 0;\n\t\t}\n\n\t\t$offset = (int) $offset;\n\n\t\tif ( $incr ) {\n\t\t\t$cache_val += $offset;\n\t\t} else {\n\t\t\t$cache_val -= $offset;\n\t\t}\n\n\t\tif ( $cache_val < 0 ) {\n\t\t\t$cache_val = 0;\n\t\t}\n\n\t\t$this->set( $key, $cache_val, $group );\n\n\t\treturn $cache_val;\n\t}\n\n\t/**\n\t * Clears the object cache of all data.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @return true Always returns true.\n\t */\n\tpublic function flush() {\n\t\t$this->flush_runtime();\n\n\t\t$this->_object_cache->flush();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Removes all cache items from the in-memory runtime cache.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @return true Always returns true.\n\t */\n\tpublic function flush_runtime() {\n\t\t$this->_cache     = array();\n\t\t$this->_cache_404 = array();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Removes all cache items in a group.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @return true Always returns true.\n\t */\n\tpublic function flush_group() {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets the list of global cache groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups List of groups that are global.\n\t */\n\tpublic function add_global_groups( $groups ) {\n\t\t$groups = (array) $groups;\n\n\t\t$this->_object_cache->add_global_groups( $groups );\n\t}\n\n\t/**\n\t * Sets the list of non-persistent cache groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups A group or an array of groups to add.\n\t */\n\tpublic function add_non_persistent_groups( $groups ) {\n\t\t$groups = (array) $groups;\n\n\t\t$this->_object_cache->add_non_persistent_groups( $groups );\n\t}\n\n\t/**\n\t * Switches the internal blog ID.\n\t *\n\t * This changes the blog ID used to create keys in blog specific groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int $blog_id Blog ID.\n\t */\n\tpublic function switch_to_blog( $blog_id ) {\n\t\t$blog_id           = (int) $blog_id;\n\t\t$this->blog_prefix = $this->multisite ? $blog_id . ':' : '';\n\t}\n\n\t/**\n\t * Get transient from wp table\n\t *\n\t * Retrieves transient data from WordPress options table.\n\t *\n\t * @since 1.8.3\n\t * @access private\n\t * @see `wp-includes/option.php` function `get_transient`/`set_site_transient`\n\t *\n\t * @param string $transient Transient name.\n\t * @param string $group     Transient group ('transient' or 'site-transient').\n\t * @return mixed Transient value or false if not found.\n\t */\n\tprivate function _transient_get( $transient, $group ) {\n\t\tif ( 'transient' === $group ) {\n\t\t\t/**** Ori WP func start */\n\t\t\t$transient_option = '_transient_' . $transient;\n\t\t\tif ( ! wp_installing() ) {\n\t\t\t\t// If option is not in alloptions, it is not autoloaded and thus has a timeout\n\t\t\t\t$alloptions = wp_load_alloptions();\n\t\t\t\tif ( ! isset( $alloptions[ $transient_option ] ) ) {\n\t\t\t\t\t$transient_timeout = '_transient_timeout_' . $transient;\n\t\t\t\t\t$timeout           = get_option( $transient_timeout );\n\t\t\t\t\tif ( false !== $timeout && $timeout < time() ) {\n\t\t\t\t\t\tdelete_option( $transient_option );\n\t\t\t\t\t\tdelete_option( $transient_timeout );\n\t\t\t\t\t\t$value = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! isset( $value ) ) {\n\t\t\t\t$value = get_option( $transient_option );\n\t\t\t}\n\t\t\t/**** Ori WP func end */\n\t\t} elseif ( 'site-transient' === $group ) {\n\t\t\t/**** Ori WP func start */\n\t\t\t$no_timeout       = array( 'update_core', 'update_plugins', 'update_themes' );\n\t\t\t$transient_option = '_site_transient_' . $transient;\n\t\t\tif ( ! in_array( $transient, $no_timeout, true ) ) {\n\t\t\t\t$transient_timeout = '_site_transient_timeout_' . $transient;\n\t\t\t\t$timeout           = get_site_option( $transient_timeout );\n\t\t\t\tif ( false !== $timeout && $timeout < time() ) {\n\t\t\t\t\tdelete_site_option( $transient_option );\n\t\t\t\t\tdelete_site_option( $transient_timeout );\n\t\t\t\t\t$value = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! isset( $value ) ) {\n\t\t\t\t$value = get_site_option( $transient_option );\n\t\t\t}\n\t\t\t/**** Ori WP func end */\n\t\t} else {\n\t\t\t$value = false;\n\t\t}\n\n\t\treturn $value;\n\t}\n\n\t/**\n\t * Set transient to WP table\n\t *\n\t * Stores transient data in WordPress options table.\n\t *\n\t * @since 1.8.3\n\t * @access private\n\t * @see `wp-includes/option.php` function `set_transient`/`set_site_transient`\n\t *\n\t * @param string $transient  Transient name.\n\t * @param mixed  $value      Transient value.\n\t * @param string $group      Transient group ('transient' or 'site-transient').\n\t * @param int    $expiration Time until expiration in seconds.\n\t * @return bool True on success, false on failure.\n\t */\n\tprivate function _transient_set( $transient, $value, $group, $expiration ) {\n\t\tif ( 'transient' === $group ) {\n\t\t\t/**** Ori WP func start */\n\t\t\t$transient_timeout = '_transient_timeout_' . $transient;\n\t\t\t$transient_option  = '_transient_' . $transient;\n\t\t\tif ( false === get_option( $transient_option ) ) {\n\t\t\t\t$autoload = 'yes';\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\t$autoload = 'no';\n\t\t\t\t\tadd_option( $transient_timeout, time() + (int) $expiration, '', 'no' );\n\t\t\t\t}\n\t\t\t\t$result = add_option( $transient_option, $value, '', $autoload );\n\t\t\t} else {\n\t\t\t\t// If expiration is requested, but the transient has no timeout option,\n\t\t\t\t// delete, then re-create transient rather than update.\n\t\t\t\t$update = true;\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\tif ( false === get_option( $transient_timeout ) ) {\n\t\t\t\t\t\tdelete_option( $transient_option );\n\t\t\t\t\t\tadd_option( $transient_timeout, time() + (int) $expiration, '', 'no' );\n\t\t\t\t\t\t$result = add_option( $transient_option, $value, '', 'no' );\n\t\t\t\t\t\t$update = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdate_option( $transient_timeout, time() + (int) $expiration );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( $update ) {\n\t\t\t\t\t$result = update_option( $transient_option, $value );\n\t\t\t\t}\n\t\t\t}\n\t\t\t/**** Ori WP func end */\n\t\t} elseif ( 'site-transient' === $group ) {\n\t\t\t/**** Ori WP func start */\n\t\t\t$transient_timeout = '_site_transient_timeout_' . $transient;\n\t\t\t$option            = '_site_transient_' . $transient;\n\t\t\tif ( false === get_site_option( $option ) ) {\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\tadd_site_option( $transient_timeout, time() + (int) $expiration );\n\t\t\t\t}\n\t\t\t\t$result = add_site_option( $option, $value );\n\t\t\t} else {\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\tupdate_site_option( $transient_timeout, time() + (int) $expiration );\n\t\t\t\t}\n\t\t\t\t$result = update_site_option( $option, $value );\n\t\t\t}\n\t\t\t/**** Ori WP func end */\n\t\t} else {\n\t\t\t$result = null;\n\t\t}\n\n\t\treturn $result;\n\t}\n\n\t/**\n\t * Delete transient from WP table\n\t *\n\t * Removes transient data from WordPress options table.\n\t *\n\t * @since 1.8.3\n\t * @access private\n\t * @see `wp-includes/option.php` function `delete_transient`/`delete_site_transient`\n\t *\n\t * @param string $transient Transient name.\n\t * @param string $group     Transient group ('transient' or 'site-transient').\n\t */\n\tprivate function _transient_del( $transient, $group ) {\n\t\tif ( 'transient' === $group ) {\n\t\t\t/**** Ori WP func start */\n\t\t\t$option_timeout = '_transient_timeout_' . $transient;\n\t\t\t$option         = '_transient_' . $transient;\n\t\t\t$result         = delete_option( $option );\n\t\t\tif ( $result ) {\n\t\t\t\tdelete_option( $option_timeout );\n\t\t\t}\n\t\t\t/**** Ori WP func end */\n\t\t} elseif ( 'site-transient' === $group ) {\n\t\t\t/**** Ori WP func start */\n\t\t\t$option_timeout = '_site_transient_timeout_' . $transient;\n\t\t\t$option         = '_site_transient_' . $transient;\n\t\t\t$result         = delete_site_option( $option );\n\t\t\tif ( $result ) {\n\t\t\t\tdelete_site_option( $option_timeout );\n\t\t\t}\n\t\t\t/**** Ori WP func end */\n\t\t}\n\t}\n\n\t/**\n\t * Get the current instance object.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @return WP_Object_Cache The current instance.\n\t */\n\tpublic static function get_instance() {\n\t\tif ( ! isset( self::$_instance ) ) {\n\t\t\tself::$_instance = new self();\n\t\t}\n\n\t\treturn self::$_instance;\n\t}\n}\n",
    "plugins/litespeed-cache/src/router.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The core plugin router class.\n *\n * This generate the valid action.\n *\n * @since       1.1.0\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Router extends Base {\n\n\tconst LOG_TAG = '[Router]';\n\n\tconst NONCE  = 'LSCWP_NONCE';\n\tconst ACTION = 'LSCWP_CTRL';\n\n\tconst ACTION_SAVE_SETTINGS_NETWORK = 'save-settings-network';\n\tconst ACTION_DB_OPTM               = 'db_optm';\n\tconst ACTION_PLACEHOLDER           = 'placeholder';\n\tconst ACTION_AVATAR                = 'avatar';\n\tconst ACTION_SAVE_SETTINGS         = 'save-settings';\n\tconst ACTION_CLOUD                 = 'cloud';\n\tconst ACTION_IMG_OPTM              = 'img_optm';\n\tconst ACTION_HEALTH                = 'health';\n\tconst ACTION_CRAWLER               = 'crawler';\n\tconst ACTION_PURGE                 = 'purge';\n\tconst ACTION_CONF                  = 'conf';\n\tconst ACTION_ACTIVATION            = 'activation';\n\tconst ACTION_CSS                   = 'css';\n\tconst ACTION_UCSS                  = 'ucss';\n\tconst ACTION_VPI                   = 'vpi';\n\tconst ACTION_PRESET                = 'preset';\n\tconst ACTION_IMPORT                = 'import';\n\tconst ACTION_REPORT                = 'report';\n\tconst ACTION_DEBUG2                = 'debug2';\n\tconst ACTION_CDN_CLOUDFLARE        = 'CDN\\Cloudflare';\n\tconst ACTION_ADMIN_DISPLAY         = 'admin_display';\n\tconst ACTION_TMP_DISABLE          = 'tmp_disable';\n\n\t// List all handlers here\n\tprivate static $_HANDLERS = array(\n\t\tself::ACTION_ADMIN_DISPLAY,\n\t\tself::ACTION_ACTIVATION,\n\t\tself::ACTION_AVATAR,\n\t\tself::ACTION_CDN_CLOUDFLARE,\n\t\tself::ACTION_CLOUD,\n\t\tself::ACTION_CONF,\n\t\tself::ACTION_CRAWLER,\n\t\tself::ACTION_CSS,\n\t\tself::ACTION_UCSS,\n\t\tself::ACTION_VPI,\n\t\tself::ACTION_DB_OPTM,\n\t\tself::ACTION_DEBUG2,\n\t\tself::ACTION_HEALTH,\n\t\tself::ACTION_IMG_OPTM,\n\t\tself::ACTION_PRESET,\n\t\tself::ACTION_IMPORT,\n\t\tself::ACTION_PLACEHOLDER,\n\t\tself::ACTION_PURGE,\n\t\tself::ACTION_REPORT,\n\t);\n\n\tconst TYPE = 'litespeed_type';\n\n\tconst ITEM_HASH       = 'hash';\n\tconst ITEM_FLASH_HASH = 'flash_hash';\n\n\tprivate static $_esi_enabled;\n\tprivate static $_is_ajax;\n\tprivate static $_is_logged_in;\n\tprivate static $_ip;\n\tprivate static $_action;\n\tprivate static $_is_admin_ip;\n\tprivate static $_frontend_path;\n\n\t/**\n\t * Redirect to self to continue operation\n\t *\n\t * Note: must return when use this func. CLI/Cron call won't die in this func.\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic static function self_redirect( $action, $type ) {\n\t\tif (defined('LITESPEED_CLI') || wp_doing_cron()) {\n\t\t\tAdmin_Display::success('To be continued'); // Show for CLI\n\t\t\treturn;\n\t\t}\n\n\t\t// Add i to avoid browser too many redirected warning\n\t\t$i = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t++$i;\n\n\t\t$link = Utility::build_url($action, $type, false, null, array( 'litespeed_i' => $i ));\n\n\t\t$url = html_entity_decode($link);\n\t\texit(\"<meta http-equiv='refresh' content='0;url=$url'>\");\n\t}\n\n\t/**\n\t * Check if can run optimize\n\t *\n\t * @since  1.3\n\t * @since  2.3.1 Relocated from cdn.cls\n\t * @access public\n\t */\n\tpublic function can_optm() {\n\t\t$can = true;\n\n\t\tif (is_user_logged_in() && $this->conf(self::O_OPTM_GUEST_ONLY)) {\n\t\t\t$can = false;\n\t\t} elseif (is_admin()) {\n\t\t\t$can = false;\n\t\t} elseif (is_feed()) {\n\t\t\t$can = false;\n\t\t} elseif (is_preview()) {\n\t\t\t$can = false;\n\t\t} elseif (self::is_ajax()) {\n\t\t\t$can = false;\n\t\t}\n\n\t\tif (self::_is_login_page()) {\n\t\t\tDebug2::debug('[Router] Optm bypassed: login/reg page');\n\t\t\t$can = false;\n\t\t}\n\n\t\t$can_final = apply_filters('litespeed_can_optm', $can);\n\n\t\tif ($can_final != $can) {\n\t\t\tDebug2::debug('[Router] Optm bypassed: filter');\n\t\t}\n\n\t\treturn $can_final;\n\t}\n\n\t/**\n\t * Check referer page to see if its from admin\n\t *\n\t * @since 2.4.2.1\n\t * @access public\n\t */\n\tpublic static function from_admin() {\n\t\treturn !empty($_SERVER['HTTP_REFERER']) && strpos($_SERVER['HTTP_REFERER'], get_admin_url()) === 0;\n\t}\n\n\t/**\n\t * Check if it can use CDN replacement\n\t *\n\t * @since  1.2.3\n\t * @since  2.3.1 Relocated from cdn.cls\n\t * @access public\n\t */\n\tpublic static function can_cdn() {\n\t\t$can = true;\n\n\t\tif (is_admin()) {\n\t\t\tif (!self::is_ajax()) {\n\t\t\t\tDebug2::debug2('[Router] CDN bypassed: is not ajax call');\n\t\t\t\t$can = false;\n\t\t\t}\n\n\t\t\tif (self::from_admin()) {\n\t\t\t\tDebug2::debug2('[Router] CDN bypassed: ajax call from admin');\n\t\t\t\t$can = false;\n\t\t\t}\n\t\t} elseif (is_feed()) {\n\t\t\t$can = false;\n\t\t} elseif (is_preview()) {\n\t\t\t$can = false;\n\t\t}\n\n\t\t/**\n\t\t * Bypass cron to avoid deregister jq notice `Do not deregister the <code>jquery-core</code> script in the administration area.`\n\t\t *\n\t\t * @since  2.7.2\n\t\t */\n\t\tif (wp_doing_cron()) {\n\t\t\t$can = false;\n\t\t}\n\n\t\t/**\n\t\t * Bypass login/reg page\n\t\t *\n\t\t * @since  1.6\n\t\t */\n\t\tif (self::_is_login_page()) {\n\t\t\tDebug2::debug('[Router] CDN bypassed: login/reg page');\n\t\t\t$can = false;\n\t\t}\n\n\t\t/**\n\t\t * Bypass post/page link setting\n\t\t *\n\t\t * @since 2.9.8.5\n\t\t */\n\t\t$rest_prefix = function_exists('rest_get_url_prefix') ? rest_get_url_prefix() : apply_filters('rest_url_prefix', 'wp-json');\n\t\tif (\n\t\t\t!empty($_SERVER['REQUEST_URI']) &&\n\t\t\tstrpos($_SERVER['REQUEST_URI'], $rest_prefix . '/wp/v2/media') !== false &&\n\t\t\tisset($_SERVER['HTTP_REFERER']) &&\n\t\t\tstrpos($_SERVER['HTTP_REFERER'], 'wp-admin') !== false\n\t\t) {\n\t\t\tDebug2::debug('[Router] CDN bypassed: wp-json on admin page');\n\t\t\t$can = false;\n\t\t}\n\n\t\t$can_final = apply_filters('litespeed_can_cdn', $can);\n\n\t\tif ($can_final != $can) {\n\t\t\tDebug2::debug('[Router] CDN bypassed: filter');\n\t\t}\n\n\t\treturn $can_final;\n\t}\n\n\t/**\n\t * Check if is login page or not\n\t *\n\t * @since  2.3.1\n\t * @access protected\n\t */\n\tprotected static function _is_login_page() {\n\t\tif (in_array($GLOBALS['pagenow'], array( 'wp-login.php', 'wp-register.php' ), true)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * UCSS/Crawler role simulator\n\t *\n\t * @since  1.9.1\n\t * @since  3.3 Renamed from `is_crawler_role_simulation`\n\t */\n\tpublic function is_role_simulation() {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (empty($_COOKIE['litespeed_hash']) && empty($_COOKIE['litespeed_flash_hash'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('🪪 starting role validation');\n\n\t\t// Check if is from crawler\n\t\t// if ( empty( $_SERVER[ 'HTTP_USER_AGENT' ] ) || strpos( $_SERVER[ 'HTTP_USER_AGENT' ], Crawler::FAST_USER_AGENT ) !== 0 ) {\n\t\t// Debug2::debug( '[Router] user agent not match' );\n\t\t// return;\n\t\t// }\n\t\t$server_ip = $this->conf(self::O_SERVER_IP);\n\t\tif (!$server_ip || self::get_ip() !== $server_ip) {\n\t\t\tself::debug('❌❌ Role simulate uid denied! Not localhost visit!');\n\t\t\tControl::set_nocache('Role simulate uid denied');\n\t\t\treturn;\n\t\t}\n\n\t\t// Flash hash validation\n\t\tif (!empty($_COOKIE['litespeed_flash_hash'])) {\n\t\t\t$hash_data = self::get_option(self::ITEM_FLASH_HASH, array());\n\t\t\tif ($hash_data && is_array($hash_data) && !empty($hash_data['hash']) && !empty($hash_data['ts']) && !empty($hash_data['uid'])) {\n\t\t\t\tif (time() - $hash_data['ts'] < 120 && $_COOKIE['litespeed_flash_hash'] == $hash_data['hash']) {\n\t\t\t\t\tself::debug('🪪 Role simulator flash hash matched, escalating user to be uid=' . $hash_data['uid']);\n\t\t\t\t\tself::delete_option(self::ITEM_FLASH_HASH);\n\t\t\t\t\twp_set_current_user($hash_data['uid']);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Hash validation\n\t\tif (!empty($_COOKIE['litespeed_hash'])) {\n\t\t\t$hash_data = self::get_option(self::ITEM_HASH, array());\n\t\t\tif ($hash_data && is_array($hash_data) && !empty($hash_data['hash']) && !empty($hash_data['ts']) && !empty($hash_data['uid'])) {\n\t\t\t\t$RUN_DURATION = $this->cls('Crawler')->get_crawler_duration();\n\t\t\t\tif (time() - $hash_data['ts'] < $RUN_DURATION && $_COOKIE['litespeed_hash'] == $hash_data['hash']) {\n\t\t\t\t\tself::debug('🪪 Role simulator hash matched, escalating user to be uid=' . $hash_data['uid']);\n\t\t\t\t\twp_set_current_user($hash_data['uid']);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tself::debug('❌ WARNING: role simulator hash not match');\n\t}\n\n\t/**\n\t * Get a short ttl hash (2mins)\n\t *\n\t * @since  6.4\n\t */\n\tpublic function get_flash_hash( $uid ) {\n\t\t$hash_data = self::get_option(self::ITEM_FLASH_HASH, array());\n\t\tif ($hash_data && is_array($hash_data) && !empty($hash_data['hash']) && !empty($hash_data['ts'])) {\n\t\t\tif (time() - $hash_data['ts'] < 60) {\n\t\t\t\treturn $hash_data['hash'];\n\t\t\t}\n\t\t}\n\n\t\t// Check if this user has editor access or not\n\t\tif (user_can($uid, 'edit_posts')) {\n\t\t\tself::debug('🛑 The user with id ' . $uid . ' has editor access, which is not allowed for the role simulator.');\n\t\t\treturn '';\n\t\t}\n\n\t\t$hash = Str::rrand(32);\n\t\tself::update_option(self::ITEM_FLASH_HASH, array(\n\t\t\t'hash' => $hash,\n\t\t\t'ts' => time(),\n\t\t\t'uid' => $uid,\n\t\t));\n\t\treturn $hash;\n\t}\n\n\t/**\n\t * Get a security hash\n\t *\n\t * @since  3.3\n\t */\n\tpublic function get_hash( $uid ) {\n\t\t// Check if this user has editor access or not\n\t\tif (user_can($uid, 'edit_posts')) {\n\t\t\tself::debug('🛑 The user with id ' . $uid . ' has editor access, which is not allowed for the role simulator.');\n\t\t\treturn '';\n\t\t}\n\n\t\t// As this is called only when starting crawling, not per page, no need to reuse\n\t\t$hash = Str::rrand(32);\n\t\tself::update_option(self::ITEM_HASH, array(\n\t\t\t'hash' => $hash,\n\t\t\t'ts' => time(),\n\t\t\t'uid' => $uid,\n\t\t));\n\t\treturn $hash;\n\t}\n\n\t/**\n\t * Get user role\n\t *\n\t * @since  1.6.2\n\t */\n\tpublic static function get_role( $uid = null ) {\n\t\tif (defined('LITESPEED_WP_ROLE')) {\n\t\t\treturn LITESPEED_WP_ROLE;\n\t\t}\n\n\t\tif ($uid === null) {\n\t\t\t$uid = get_current_user_id();\n\t\t}\n\n\t\t$role = false;\n\t\tif ($uid) {\n\t\t\t$user = get_userdata($uid);\n\t\t\tif (isset($user->roles) && is_array($user->roles)) {\n\t\t\t\t$tmp  = array_values($user->roles);\n\t\t\t\t$role = implode(',', $tmp); // Combine for PHP5.3 const compatibility\n\t\t\t}\n\t\t}\n\t\tDebug2::debug('[Router] get_role: ' . $role);\n\n\t\tif (!$role) {\n\t\t\treturn $role;\n\t\t\t// Guest user\n\t\t\tDebug2::debug('[Router] role: guest');\n\n\t\t\t/**\n\t\t\t * Fix double login issue\n\t\t\t * The previous user init refactoring didn't fix this bcos this is in login process and the user role could change\n\t\t\t *\n\t\t\t * @see  https://github.com/litespeedtech/lscache_wp/commit/69e7bc71d0de5cd58961bae953380b581abdc088\n\t\t\t * @since  2.9.8 Won't assign const if in login process\n\t\t\t */\n\t\t\tif (substr_compare(wp_login_url(), $GLOBALS['pagenow'], -strlen($GLOBALS['pagenow'])) === 0) {\n\t\t\t\treturn $role;\n\t\t\t}\n\t\t}\n\n\t\tdefine('LITESPEED_WP_ROLE', $role);\n\n\t\treturn LITESPEED_WP_ROLE;\n\t}\n\n\t/**\n\t * Get frontend path\n\t *\n\t * @since 1.2.2\n\t * @access public\n\t * @return boolean\n\t */\n\tpublic static function frontend_path() {\n\t\t// todo: move to htaccess.cls ?\n\t\tif (!isset(self::$_frontend_path)) {\n\t\t\t$frontend = rtrim(ABSPATH, '/'); // /home/user/public_html/frontend\n\t\t\t// get home path failed. Trac ticket #37668 (e.g. frontend:/blog backend:/wordpress)\n\t\t\tif (!$frontend) {\n\t\t\t\tDebug2::debug('[Router] No ABSPATH, generating from home option');\n\t\t\t\t$frontend = parse_url(get_option('home'));\n\t\t\t\t$frontend = !empty($frontend['path']) ? $frontend['path'] : '';\n\t\t\t\t$frontend = $_SERVER['DOCUMENT_ROOT'] . $frontend;\n\t\t\t}\n\t\t\t$frontend = realpath($frontend);\n\n\t\t\tself::$_frontend_path = $frontend;\n\t\t}\n\t\treturn self::$_frontend_path;\n\t}\n\n\t/**\n\t * Check if ESI is enabled or not\n\t *\n\t * @since 1.2.0\n\t * @access public\n\t * @return boolean\n\t */\n\tpublic function esi_enabled() {\n\t\tif (!isset(self::$_esi_enabled)) {\n\t\t\tself::$_esi_enabled = defined('LITESPEED_ON') && $this->conf(self::O_ESI);\n\t\t\tif (!empty($_REQUEST[self::ACTION])) {\n\t\t\t\tself::$_esi_enabled = false;\n\t\t\t}\n\t\t}\n\t\treturn self::$_esi_enabled;\n\t}\n\n\t/**\n\t * Check if crawler is enabled on server level\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t */\n\tpublic static function can_crawl() {\n\t\tif (isset($_SERVER['X-LSCACHE']) && strpos($_SERVER['X-LSCACHE'], 'crawler') === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// CLI will bypass this check as crawler library can always do the 428 check\n\t\tif (defined('LITESPEED_CLI')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Check action\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return string\n\t */\n\tpublic static function get_action() {\n\t\tif (!isset(self::$_action)) {\n\t\t\tself::$_action = false;\n\t\t\tself::cls()->verify_action();\n\t\t\tif (self::$_action) {\n\t\t\t\tdefined('LSCWP_LOG') && Debug2::debug('[Router] LSCWP_CTRL verified: ' . var_export(self::$_action, true));\n\t\t\t}\n\t\t}\n\t\treturn self::$_action;\n\t}\n\n\t/**\n\t * Check if is logged in\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return boolean\n\t */\n\tpublic static function is_logged_in() {\n\t\tif (!isset(self::$_is_logged_in)) {\n\t\t\tself::$_is_logged_in = is_user_logged_in();\n\t\t}\n\t\treturn self::$_is_logged_in;\n\t}\n\n\t/**\n\t * Check if is ajax call\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return boolean\n\t */\n\tpublic static function is_ajax() {\n\t\tif (!isset(self::$_is_ajax)) {\n\t\t\tself::$_is_ajax = wp_doing_ajax();\n\t\t}\n\t\treturn self::$_is_ajax;\n\t}\n\n\t/**\n\t * Check if is admin ip\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return boolean\n\t */\n\tpublic function is_admin_ip() {\n\t\tif (!isset(self::$_is_admin_ip)) {\n\t\t\t$ips = $this->conf(self::O_DEBUG_IPS);\n\n\t\t\tself::$_is_admin_ip = $this->ip_access($ips);\n\t\t}\n\t\treturn self::$_is_admin_ip;\n\t}\n\n\t/**\n\t * Get type value\n\t *\n\t * @since 1.6\n\t * @access public\n\t */\n\tpublic static function verify_type() {\n\t\tif (empty($_REQUEST[self::TYPE])) {\n\t\t\tDebug2::debug('[Router] no type', 2);\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug('[Router] parsed type: ' . $_REQUEST[self::TYPE], 2);\n\n\t\treturn $_REQUEST[self::TYPE];\n\t}\n\n\t/**\n\t * Check privilege and nonce for the action\n\t *\n\t * @since 1.1.0\n\t * @access private\n\t */\n\tprivate function verify_action() {\n\t\tif (empty($_REQUEST[self::ACTION])) {\n\t\t\tDebug2::debug2('[Router] LSCWP_CTRL bypassed empty');\n\t\t\treturn;\n\t\t}\n\n\t\t$action = stripslashes($_REQUEST[self::ACTION]);\n\n\t\tif (!$action) {\n\t\t\treturn;\n\t\t}\n\n\t\t$_is_public_action = false;\n\n\t\t// Each action must have a valid nonce unless its from admin ip and is public action\n\t\t// Validate requests nonce (from admin logged in page or cli)\n\t\tif (!$this->verify_nonce($action)) {\n\t\t\t// check if it is from admin ip\n\t\t\tif (!$this->is_admin_ip()) {\n\t\t\t\tDebug2::debug('[Router] LSCWP_CTRL query string - did not match admin IP: ' . $action);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// check if it is public action\n\t\t\tif (\n\t\t\t\t!in_array($action, array(\n\t\t\t\t\tCore::ACTION_QS_NOCACHE,\n\t\t\t\t\tCore::ACTION_QS_PURGE,\n\t\t\t\t\tCore::ACTION_QS_PURGE_SINGLE,\n\t\t\t\t\tCore::ACTION_QS_SHOW_HEADERS,\n\t\t\t\t\tCore::ACTION_QS_PURGE_ALL,\n\t\t\t\t\tCore::ACTION_QS_PURGE_EMPTYCACHE,\n\t\t\t\t))\n\t\t\t) {\n\t\t\t\tDebug2::debug('[Router] LSCWP_CTRL query string - did not match admin IP Actions: ' . $action);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (apply_filters('litespeed_qs_forbidden', false)) {\n\t\t\t\tDebug2::debug('[Router] LSCWP_CTRL forbidden by hook litespeed_qs_forbidden');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$_is_public_action = true;\n\t\t}\n\n\t\t/* Now it is a valid action, lets log and check the permission */\n\t\tDebug2::debug('[Router] LSCWP_CTRL: ' . $action);\n\n\t\t// OK, as we want to do something magic, lets check if its allowed\n\t\t$_is_multisite       = is_multisite();\n\t\t$_is_network_admin   = $_is_multisite && is_network_admin();\n\t\t$_can_network_option = $_is_network_admin && current_user_can('manage_network_options');\n\t\t$_can_option         = current_user_can('manage_options');\n\n\t\tswitch ($action) {\n\t\t\tcase self::ACTION_TMP_DISABLE: // Disable LSC for 24H\n\t\t\t\tDebug2::tmp_disable();\n\t\t\t\tAdmin::redirect(\"?page=litespeed-toolbox#settings-debug\");\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_SAVE_SETTINGS_NETWORK: // Save network settings\n            if ($_can_network_option) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_PURGE_BY:\n            if (defined('LITESPEED_ON') && ($_can_network_option || $_can_option || self::is_ajax())) {\n\t\t\t\t\t// here may need more security\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_DB_OPTM:\n            if ($_can_network_option || $_can_option) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_PURGE_EMPTYCACHE: // todo: moved to purge.cls type action\n            if ((defined('LITESPEED_ON') || $_is_network_admin) && ($_can_network_option || (!$_is_multisite && $_can_option))) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_QS_NOCACHE:\n\t\t\tcase Core::ACTION_QS_PURGE:\n\t\t\tcase Core::ACTION_QS_PURGE_SINGLE:\n\t\t\tcase Core::ACTION_QS_SHOW_HEADERS:\n\t\t\tcase Core::ACTION_QS_PURGE_ALL:\n\t\t\tcase Core::ACTION_QS_PURGE_EMPTYCACHE:\n            if (defined('LITESPEED_ON') && ($_is_public_action || self::is_ajax())) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_ADMIN_DISPLAY:\n\t\t\tcase self::ACTION_PLACEHOLDER:\n\t\t\tcase self::ACTION_AVATAR:\n\t\t\tcase self::ACTION_IMG_OPTM:\n\t\t\tcase self::ACTION_CLOUD:\n\t\t\tcase self::ACTION_CDN_CLOUDFLARE:\n\t\t\tcase self::ACTION_CRAWLER:\n\t\t\tcase self::ACTION_PRESET:\n\t\t\tcase self::ACTION_IMPORT:\n\t\t\tcase self::ACTION_REPORT:\n\t\t\tcase self::ACTION_CSS:\n\t\t\tcase self::ACTION_UCSS:\n\t\t\tcase self::ACTION_VPI:\n\t\t\tcase self::ACTION_CONF:\n\t\t\tcase self::ACTION_ACTIVATION:\n\t\t\tcase self::ACTION_HEALTH:\n\t\t\tcase self::ACTION_SAVE_SETTINGS: // Save settings\n            if ($_can_option && !$_is_network_admin) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_PURGE:\n\t\t\tcase self::ACTION_DEBUG2:\n            if ($_can_network_option || $_can_option) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_DISMISS:\n            /**\n             * Non ajax call can dismiss too\n             *\n             * @since  2.9\n             */\n            // if ( self::is_ajax() ) {\n            self::$_action = $action;\n            // }\n\t\t\t\treturn;\n\n\t\t\tdefault:\n            Debug2::debug('[Router] LSCWP_CTRL match failed: ' . $action);\n\t\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Verify nonce\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @param  string $action\n\t * @return bool\n\t */\n\tpublic function verify_nonce( $action ) {\n\t\tif (!isset($_REQUEST[self::NONCE]) || !wp_verify_nonce($_REQUEST[self::NONCE], $action)) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * Check if the ip is in the range\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic function ip_access( $ip_list ) {\n\t\tif (!$ip_list) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!isset(self::$_ip)) {\n\t\t\tself::$_ip = self::get_ip();\n\t\t}\n\n\t\tif (!self::$_ip) {\n\t\t\treturn false;\n\t\t}\n\t\t// $uip = explode('.', $_ip);\n\t\t// if(empty($uip) || count($uip) != 4) Return false;\n\t\t// foreach($ip_list as $key => $ip) $ip_list[$key] = explode('.', trim($ip));\n\t\t// foreach($ip_list as $key => $ip) {\n\t\t// if(count($ip) != 4) continue;\n\t\t// for($i = 0; $i <= 3; $i++) if($ip[$i] == '*') $ip_list[$key][$i] = $uip[$i];\n\t\t// }\n\t\treturn in_array(self::$_ip, $ip_list);\n\t}\n\n\t/**\n\t * Get client ip\n\t *\n\t * @since 1.1.0\n\t * @since  1.6.5 changed to public\n\t * @access public\n\t * @return string\n\t */\n\tpublic static function get_ip() {\n\t\t$_ip = '';\n\t\t// if ( function_exists( 'apache_request_headers' ) ) {\n\t\t// $apache_headers = apache_request_headers();\n\t\t// $_ip = ! empty( $apache_headers['True-Client-IP'] ) ? $apache_headers['True-Client-IP'] : false;\n\t\t// if ( ! $_ip ) {\n\t\t// $_ip = ! empty( $apache_headers['X-Forwarded-For'] ) ? $apache_headers['X-Forwarded-For'] : false;\n\t\t// $_ip = explode( ',', $_ip );\n\t\t// $_ip = $_ip[ 0 ];\n\t\t// }\n\n\t\t// }\n\n\t\tif (!$_ip) {\n\t\t\t$_ip = !empty($_SERVER['REMOTE_ADDR']) ? $_SERVER['REMOTE_ADDR'] : false;\n\t\t}\n\t\treturn $_ip;\n\t}\n\n\t/**\n\t * Check if opcode cache is enabled\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t */\n\tpublic static function opcache_enabled() {\n\t\treturn function_exists('opcache_reset') && ini_get('opcache.enable');\n\t}\n\n\t/**\n\t * Check if opcode cache is restricted and file that is requesting.\n\t * https://www.php.net/manual/en/opcache.configuration.php#ini.opcache.restrict-api\n\t *\n\t * @since  7.3\n\t * @access public\n\t */\n\tpublic static function opcache_restricted($file)\n\t{\n\t\t$restrict_value = ini_get('opcache.restrict_api');\n\t\tif ($restrict_value) {\n\t\t\tif ( !$file || false === strpos($restrict_value, $file) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Handle static files\n\t *\n\t * @since  3.0\n\t */\n\tpublic function serve_static() {\n\t\tif (!empty($_SERVER['SCRIPT_URI'])) {\n\t\t\tif (strpos($_SERVER['SCRIPT_URI'], LITESPEED_STATIC_URL . '/') !== 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$path = substr($_SERVER['SCRIPT_URI'], strlen(LITESPEED_STATIC_URL . '/'));\n\t\t} elseif (!empty($_SERVER['REQUEST_URI'])) {\n\t\t\t$static_path = parse_url(LITESPEED_STATIC_URL, PHP_URL_PATH) . '/';\n\t\t\tif (strpos($_SERVER['REQUEST_URI'], $static_path) !== 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$path = substr(parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH), strlen($static_path));\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\t$path = explode('/', $path, 2);\n\n\t\tif (empty($path[0]) || empty($path[1])) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ($path[0]) {\n\t\t\tcase 'avatar':\n            $this->cls('Avatar')->serve_static($path[1]);\n\t\t\t\tbreak;\n\n\t\t\tcase 'localres':\n            $this->cls('Localization')->serve_static($path[1]);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Handle all request actions from main cls\n\t *\n\t * This is different than other handlers\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function handler( $cls ) {\n\t\tif (!in_array($cls, self::$_HANDLERS)) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn $this->cls($cls)->handler();\n\t}\n}\n",
    "plugins/litespeed-cache/src/object-cache.cls.php": "<?php\n/**\n * The object cache class.\n *\n * @since       1.8\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\nrequire_once dirname( __DIR__ ) . '/autoload.php';\n\n/**\n * Object cache handler using Redis or Memcached.\n *\n * NOTE: this class may be included without initialized core.\n *\n * @since 1.8\n */\nclass Object_Cache extends Root {\n\tconst LOG_TAG = '[Object_Cache]';\n\n\t/**\n\t * Debug option key.\n\t *\n\t * @var string\n\t */\n\tconst O_DEBUG = 'debug';\n\n\t/**\n\t * Object cache enable key.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT = 'object';\n\n\t/**\n\t * Object kind (Redis/Memcached).\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_KIND = 'object-kind';\n\n\t/**\n\t * Object host.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_HOST = 'object-host';\n\n\t/**\n\t * Object port.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_PORT = 'object-port';\n\n\t/**\n\t * Object life/TTL.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_LIFE = 'object-life';\n\n\t/**\n\t * Persistent connection flag.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_PERSISTENT = 'object-persistent';\n\n\t/**\n\t * Admin cache flag.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_ADMIN = 'object-admin';\n\n\t/**\n\t * Transients store flag.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_TRANSIENTS = 'object-transients';\n\n\t/**\n\t * DB index for Redis.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_DB_ID = 'object-db_id';\n\n\t/**\n\t * Username for auth.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_USER = 'object-user';\n\n\t/**\n\t * Password for auth.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_PSWD = 'object-pswd';\n\n\t/**\n\t * Global groups list.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_GLOBAL_GROUPS = 'object-global_groups';\n\n\t/**\n\t * Non-persistent groups list.\n\t *\n\t * @var string\n\t */\n\tconst O_OBJECT_NON_PERSISTENT_GROUPS = 'object-non_persistent_groups';\n\n\t/**\n\t * Connection instance.\n\t *\n\t * @var \\Redis|\\Memcached|null\n\t */\n\tprivate $_conn;\n\n\t/**\n\t * Debug config.\n\t *\n\t * @var bool\n\t */\n\tprivate $_cfg_debug;\n\n\t/**\n\t * Whether OC is enabled.\n\t *\n\t * @var bool\n\t */\n\tprivate $_cfg_enabled;\n\n\t/**\n\t * True => Redis, false => Memcached.\n\t *\n\t * @var bool\n\t */\n\tprivate $_cfg_method;\n\n\t/**\n\t * Host name.\n\t *\n\t * @var string\n\t */\n\tprivate $_cfg_host;\n\n\t/**\n\t * Port number.\n\t *\n\t * @var int|string\n\t */\n\tprivate $_cfg_port;\n\n\t/**\n\t * TTL in seconds.\n\t *\n\t * @var int\n\t */\n\tprivate $_cfg_life;\n\n\t/**\n\t * Use persistent connection.\n\t *\n\t * @var bool\n\t */\n\tprivate $_cfg_persistent;\n\n\t/**\n\t * Cache admin pages.\n\t *\n\t * @var bool\n\t */\n\tprivate $_cfg_admin;\n\n\t/**\n\t * Store transients.\n\t *\n\t * @var bool\n\t */\n\tprivate $_cfg_transients;\n\n\t/**\n\t * Redis DB index.\n\t *\n\t * @var int\n\t */\n\tprivate $_cfg_db;\n\n\t/**\n\t * Auth username.\n\t *\n\t * @var string\n\t */\n\tprivate $_cfg_user;\n\n\t/**\n\t * Auth password.\n\t *\n\t * @var string\n\t */\n\tprivate $_cfg_pswd;\n\n\t/**\n\t * Default TTL in seconds.\n\t *\n\t * @var int\n\t */\n\tprivate $_default_life = 360;\n\n\t/**\n\t * 'Redis' or 'Memcached'.\n\t *\n\t * @var string\n\t */\n\tprivate $_oc_driver = 'Memcached'; // Redis or Memcached.\n\n\t/**\n\t * Global groups.\n\t *\n\t * @var array\n\t */\n\tprivate $_global_groups = array();\n\n\t/**\n\t * Non-persistent groups.\n\t *\n\t * @var array\n\t */\n\tprivate $_non_persistent_groups = array();\n\n\t/**\n\t * Init.\n\t *\n\t * NOTE: this class may be included without initialized core.\n\t *\n\t * @since  1.8\n\t *\n\t * @param array|false $cfg Optional configuration to bootstrap without core.\n\t */\n\tpublic function __construct( $cfg = false ) {\n\t\tif ( $cfg ) {\n\t\t\tif ( ! is_array( $cfg[ Base::O_OBJECT_GLOBAL_GROUPS ] ) ) {\n\t\t\t\t$cfg[ Base::O_OBJECT_GLOBAL_GROUPS ] = explode( \"\\n\", $cfg[ Base::O_OBJECT_GLOBAL_GROUPS ] );\n\t\t\t}\n\t\t\tif ( ! is_array( $cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ] ) ) {\n\t\t\t\t$cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ] = explode( \"\\n\", $cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ] );\n\t\t\t}\n\t\t\t$this->_cfg_debug             = $cfg[ Base::O_DEBUG ] ? $cfg[ Base::O_DEBUG ] : false;\n\t\t\t$this->_cfg_method            = $cfg[ Base::O_OBJECT_KIND ] ? true : false;\n\t\t\t$this->_cfg_host              = $cfg[ Base::O_OBJECT_HOST ];\n\t\t\t$this->_cfg_port              = $cfg[ Base::O_OBJECT_PORT ];\n\t\t\t$this->_cfg_life              = $cfg[ Base::O_OBJECT_LIFE ];\n\t\t\t$this->_cfg_persistent        = $cfg[ Base::O_OBJECT_PERSISTENT ];\n\t\t\t$this->_cfg_admin             = $cfg[ Base::O_OBJECT_ADMIN ];\n\t\t\t$this->_cfg_transients        = $cfg[ Base::O_OBJECT_TRANSIENTS ];\n\t\t\t$this->_cfg_db                = $cfg[ Base::O_OBJECT_DB_ID ];\n\t\t\t$this->_cfg_user              = $cfg[ Base::O_OBJECT_USER ];\n\t\t\t$this->_cfg_pswd              = $cfg[ Base::O_OBJECT_PSWD ];\n\t\t\t$this->_global_groups         = $cfg[ Base::O_OBJECT_GLOBAL_GROUPS ];\n\t\t\t$this->_non_persistent_groups = $cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ];\n\n\t\t\tif ( $this->_cfg_method ) {\n\t\t\t\t$this->_oc_driver = 'Redis';\n\t\t\t}\n\t\t\t$this->_cfg_enabled = $cfg[ Base::O_OBJECT ] && class_exists( $this->_oc_driver ) && $this->_cfg_host;\n\t\t} elseif ( defined( 'LITESPEED_CONF_LOADED' ) ) { // If OC is OFF, will hit here to init OC after conf initialized\n\t\t\t$this->_cfg_debug             = $this->conf( Base::O_DEBUG ) ? $this->conf( Base::O_DEBUG ) : false;\n\t\t\t$this->_cfg_method            = $this->conf( Base::O_OBJECT_KIND ) ? true : false;\n\t\t\t$this->_cfg_host              = $this->conf( Base::O_OBJECT_HOST );\n\t\t\t$this->_cfg_port              = $this->conf( Base::O_OBJECT_PORT );\n\t\t\t$this->_cfg_life              = $this->conf( Base::O_OBJECT_LIFE );\n\t\t\t$this->_cfg_persistent        = $this->conf( Base::O_OBJECT_PERSISTENT );\n\t\t\t$this->_cfg_admin             = $this->conf( Base::O_OBJECT_ADMIN );\n\t\t\t$this->_cfg_transients        = $this->conf( Base::O_OBJECT_TRANSIENTS );\n\t\t\t$this->_cfg_db                = $this->conf( Base::O_OBJECT_DB_ID );\n\t\t\t$this->_cfg_user              = $this->conf( Base::O_OBJECT_USER );\n\t\t\t$this->_cfg_pswd              = $this->conf( Base::O_OBJECT_PSWD );\n\t\t\t$this->_global_groups         = $this->conf( Base::O_OBJECT_GLOBAL_GROUPS );\n\t\t\t$this->_non_persistent_groups = $this->conf( Base::O_OBJECT_NON_PERSISTENT_GROUPS );\n\n\t\t\tif ( $this->_cfg_method ) {\n\t\t\t\t$this->_oc_driver = 'Redis';\n\t\t\t}\n\t\t\t$this->_cfg_enabled = $this->conf( Base::O_OBJECT ) && class_exists( $this->_oc_driver ) && $this->_cfg_host;\n\t\t} elseif ( defined( 'self::CONF_FILE' ) && file_exists( WP_CONTENT_DIR . '/' . self::CONF_FILE ) ) {\n\t\t\t// Get cfg from _data_file.\n\t\t\t// Use self::const to avoid loading more classes.\n\t\t\t$cfg = \\json_decode( file_get_contents( WP_CONTENT_DIR . '/' . self::CONF_FILE ), true );\n\t\t\tif ( ! empty( $cfg[ self::O_OBJECT_HOST ] ) ) {\n\t\t\t\t$this->_cfg_debug             = ! empty( $cfg[ Base::O_DEBUG ] ) ? $cfg[ Base::O_DEBUG ] : false;\n\t\t\t\t$this->_cfg_method            = ! empty( $cfg[ self::O_OBJECT_KIND ] ) ? $cfg[ self::O_OBJECT_KIND ] : false;\n\t\t\t\t$this->_cfg_host              = $cfg[ self::O_OBJECT_HOST ];\n\t\t\t\t$this->_cfg_port              = $cfg[ self::O_OBJECT_PORT ];\n\t\t\t\t$this->_cfg_life              = ! empty( $cfg[ self::O_OBJECT_LIFE ] ) ? $cfg[ self::O_OBJECT_LIFE ] : $this->_default_life;\n\t\t\t\t$this->_cfg_persistent        = ! empty( $cfg[ self::O_OBJECT_PERSISTENT ] ) ? $cfg[ self::O_OBJECT_PERSISTENT ] : false;\n\t\t\t\t$this->_cfg_admin             = ! empty( $cfg[ self::O_OBJECT_ADMIN ] ) ? $cfg[ self::O_OBJECT_ADMIN ] : false;\n\t\t\t\t$this->_cfg_transients        = ! empty( $cfg[ self::O_OBJECT_TRANSIENTS ] ) ? $cfg[ self::O_OBJECT_TRANSIENTS ] : false;\n\t\t\t\t$this->_cfg_db                = ! empty( $cfg[ self::O_OBJECT_DB_ID ] ) ? $cfg[ self::O_OBJECT_DB_ID ] : 0;\n\t\t\t\t$this->_cfg_user              = ! empty( $cfg[ self::O_OBJECT_USER ] ) ? $cfg[ self::O_OBJECT_USER ] : '';\n\t\t\t\t$this->_cfg_pswd              = ! empty( $cfg[ self::O_OBJECT_PSWD ] ) ? $cfg[ self::O_OBJECT_PSWD ] : '';\n\t\t\t\t$this->_global_groups         = ! empty( $cfg[ self::O_OBJECT_GLOBAL_GROUPS ] ) ? $cfg[ self::O_OBJECT_GLOBAL_GROUPS ] : array();\n\t\t\t\t$this->_non_persistent_groups = ! empty( $cfg[ self::O_OBJECT_NON_PERSISTENT_GROUPS ] ) ? $cfg[ self::O_OBJECT_NON_PERSISTENT_GROUPS ] : array();\n\n\t\t\t\tif ( $this->_cfg_method ) {\n\t\t\t\t\t$this->_oc_driver = 'Redis';\n\t\t\t\t}\n\t\t\t\t$this->_cfg_enabled = class_exists( $this->_oc_driver ) && $this->_cfg_host;\n\t\t\t} else {\n\t\t\t\t$this->_cfg_enabled = false;\n\t\t\t}\n\t\t} else {\n\t\t\t$this->_cfg_enabled = false;\n\t\t}\n\t}\n\n\t/**\n\t * Add debug.\n\t *\n\t * @since  6.3\n\t * @access private\n\t *\n\t * @param string $text Log text.\n\t * @return void\n\t */\n\tprivate function debug_oc( $text ) {\n\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\tself::debug( $text );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Base::VAL_ON2 !== $this->_cfg_debug ) {\n\t\t\treturn;\n\t\t}\n\n\t\t$litespeed_data_folder = defined( 'LITESPEED_DATA_FOLDER' ) ? LITESPEED_DATA_FOLDER : 'litespeed';\n\t\t$lscwp_content_dir     = defined( 'LSCWP_CONTENT_DIR' ) ? LSCWP_CONTENT_DIR : WP_CONTENT_DIR;\n\t\t$litespeed_static_dir  = $lscwp_content_dir . '/' . $litespeed_data_folder;\n\t\t$log_path_prefix       = $litespeed_static_dir . '/debug/';\n\t\t$log_file              = $log_path_prefix . Debug2::FilePath( 'debug' );\n\n\t\tif ( file_exists( $log_path_prefix . 'index.php' ) && file_exists( $log_file ) ) {\n\t\t\t// phpcs:ignore WordPress.PHP.DevelopmentFunctions.error_log_error_log\n\t\t\terror_log(gmdate('m/d/y H:i:s') . ' - OC - ' . $text . PHP_EOL, 3, $log_file);\n\t\t}\n\t}\n\n\t/**\n\t * Get `Store Transients` setting value.\n\t *\n\t * @since  1.8.3\n\t * @access public\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t */\n\tpublic function store_transients( $group ) {\n\t\treturn $this->_cfg_transients && $this->_is_transients_group( $group );\n\t}\n\n\t/**\n\t * Check if the group belongs to transients or not.\n\t *\n\t * @since  1.8.3\n\t * @access private\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t */\n\tprivate function _is_transients_group( $group ) {\n\t\treturn in_array( $group, array( 'transient', 'site-transient' ), true );\n\t}\n\n\t/**\n\t * Update WP object cache file config.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param array $options Options to apply after update.\n\t * @return void\n\t */\n\tpublic function update_file( $options ) {\n\t\t$changed = false;\n\n\t\t// NOTE: When included in oc.php, `LSCWP_DIR` will show undefined, so this must be assigned/generated when used.\n\t\t$_oc_ori_file = LSCWP_DIR . 'lib/object-cache.php';\n\t\t$_oc_wp_file  = WP_CONTENT_DIR . '/object-cache.php';\n\n\t\t// Update cls file.\n\t\tif ( ! file_exists( $_oc_wp_file ) || md5_file( $_oc_wp_file ) !== md5_file( $_oc_ori_file ) ) {\n\t\t\t$this->debug_oc( 'copying object-cache.php file to ' . $_oc_wp_file );\n\t\t\tcopy( $_oc_ori_file, $_oc_wp_file );\n\t\t\t$changed = true;\n\t\t}\n\n\t\t/**\n\t\t * Clear object cache.\n\t\t */\n\t\tif ( $changed ) {\n\t\t\t$this->_reconnect( $options );\n\t\t}\n\t}\n\n\t/**\n\t * Remove object cache file.\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t *\n\t * @return void\n\t */\n\tpublic function del_file() {\n\t\t// NOTE: When included in oc.php, `LSCWP_DIR` will show undefined, so this must be assigned/generated when used.\n\t\t$_oc_ori_file = LSCWP_DIR . 'lib/object-cache.php';\n\t\t$_oc_wp_file  = WP_CONTENT_DIR . '/object-cache.php';\n\n\t\tif ( file_exists( $_oc_wp_file ) && md5_file( $_oc_wp_file ) === md5_file( $_oc_ori_file ) ) {\n\t\t\t$this->debug_oc( 'removing ' . $_oc_wp_file );\n\t\t\twp_delete_file( $_oc_wp_file );\n\t\t}\n\t}\n\n\t/**\n\t * Try to build connection.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @return bool|null False on failure, true on success, null if unsupported.\n\t */\n\tpublic function test_connection() {\n\t\treturn $this->_connect();\n\t}\n\n\t/**\n\t * Force to connect with this setting.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @param array $cfg Reconnect configuration.\n\t * @return void\n\t */\n\tprivate function _reconnect( $cfg ) {\n\t\t$this->debug_oc( 'Reconnecting' );\n\t\tif ( isset( $this->_conn ) ) {\n\t\t\t// error_log( 'Object: Quitting existing connection!' );\n\t\t\t$this->debug_oc( 'Quitting existing connection' );\n\t\t\t$this->flush();\n\t\t\t$this->_conn = null;\n\t\t\t$this->cls( false, true );\n\t\t}\n\n\t\t$cls = $this->cls( false, false, $cfg );\n\t\t$cls->_connect();\n\t\tif ( isset( $cls->_conn ) ) {\n\t\t\t$cls->flush();\n\t\t}\n\t}\n\n\t/**\n\t * Connect to Memcached/Redis server.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return bool|null False on failure, true on success, null if driver missing.\n\t */\n\tprivate function _connect() {\n\t\tif ( isset( $this->_conn ) ) {\n\t\t\t// error_log( 'Object: _connected' );\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( ! class_exists( $this->_oc_driver ) || ! $this->_cfg_host ) {\n\t\t\t$this->debug_oc( '_oc_driver cls non existed or _cfg_host missed: ' . $this->_oc_driver . ' [_cfg_host] ' . $this->_cfg_host . ':' . $this->_cfg_port );\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_OC_FAILURE' ) ) {\n\t\t\t$this->debug_oc( 'LITESPEED_OC_FAILURE const defined' );\n\t\t\treturn false;\n\t\t}\n\n\t\t$this->debug_oc( 'Init ' . $this->_oc_driver . ' connection to ' . $this->_cfg_host . ':' . $this->_cfg_port );\n\n\t\t$failed = false;\n\n\t\t/**\n\t\t * Connect to Redis.\n\t\t *\n\t\t * @since  1.8.1\n\t\t * @see https://github.com/phpredis/phpredis/#example-1\n\t\t */\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\t// phpcs:ignore WordPress.PHP.DevelopmentFunctions.error_log_set_error_handler\n\t\t\tset_error_handler( 'litespeed_exception_handler' );\n\t\t\ttry {\n\t\t\t\t$this->_conn = new \\Redis();\n\t\t\t\t// error_log( 'Object: _connect Redis' );\n\n\t\t\t\tif ( $this->_cfg_persistent ) {\n\t\t\t\t\tif ( $this->_cfg_port ) {\n\t\t\t\t\t\t$this->_conn->pconnect( $this->_cfg_host, $this->_cfg_port );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this->_conn->pconnect( $this->_cfg_host );\n\t\t\t\t\t}\n\t\t\t\t} elseif ( $this->_cfg_port ) {\n\t\t\t\t\t$this->_conn->connect( $this->_cfg_host, $this->_cfg_port );\n\t\t\t\t} else {\n\t\t\t\t\t$this->_conn->connect( $this->_cfg_host );\n\t\t\t\t}\n\n\t\t\t\tif ( $this->_cfg_pswd ) {\n\t\t\t\t\tif ( $this->_cfg_user ) {\n\t\t\t\t\t\t$this->_conn->auth( array( $this->_cfg_user, $this->_cfg_pswd ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this->_conn->auth( $this->_cfg_pswd );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (defined('Redis::OPT_REPLY_LITERAL')) {\n\t\t\t\t\t$this->debug_oc( 'Redis set OPT_REPLY_LITERAL' );\n\t\t\t\t\t$this->_conn->setOption(\\Redis::OPT_REPLY_LITERAL, true);\n\t\t\t\t}\n\n\t\t\t\tif ( $this->_cfg_db ) {\n\t\t\t\t\t$this->_conn->select( $this->_cfg_db );\n\t\t\t\t}\n\n\t\t\t\t$res = $this->_conn->rawCommand('PING');\n\n\t\t\t\tif ( 'PONG' !== $res ) {\n\t\t\t\t\t$this->debug_oc( 'Redis resp is wrong: ' . $res );\n\t\t\t\t\t$failed = true;\n\t\t\t\t}\n\t\t\t} catch ( \\Exception $e ) {\n\t\t\t\t$this->debug_oc( 'Redis connect exception: ' . $e->getMessage() );\n\t\t\t\t$failed = true;\n\t\t\t} catch ( \\ErrorException $e ) {\n\t\t\t\t$this->debug_oc( 'Redis connect error: ' . $e->getMessage() );\n\t\t\t\t$failed = true;\n\t\t\t}\n\t\t\trestore_error_handler();\n\t\t} else {\n\t\t\t// Connect to Memcached.\n\t\t\tif ( $this->_cfg_persistent ) {\n\t\t\t\t$this->_conn = new \\Memcached( $this->_get_mem_id() );\n\n\t\t\t\t// Check memcached persistent connection.\n\t\t\t\tif ( $this->_validate_mem_server() ) {\n\t\t\t\t\t// error_log( 'Object: _validate_mem_server' );\n\t\t\t\t\t$this->debug_oc( 'Got persistent ' . $this->_oc_driver . ' connection' );\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t$this->debug_oc( 'No persistent ' . $this->_oc_driver . ' server list!' );\n\t\t\t} else {\n\t\t\t\t// error_log( 'Object: new memcached!' );\n\t\t\t\t$this->_conn = new \\Memcached();\n\t\t\t}\n\n\t\t\t$this->_conn->addServer( $this->_cfg_host, (int) $this->_cfg_port );\n\n\t\t\t/**\n\t\t\t * Add SASL auth.\n\t\t\t *\n\t\t\t * @since  1.8.1\n\t\t\t * @since  2.9.6 Fixed SASL connection @see https://www.litespeedtech.com/support/wiki/doku.php/litespeed_wiki:lsmcd:new_sasl\n\t\t\t */\n\t\t\tif ( $this->_cfg_user && $this->_cfg_pswd && method_exists( $this->_conn, 'setSaslAuthData' ) ) {\n\t\t\t\t$this->_conn->setOption( \\Memcached::OPT_BINARY_PROTOCOL, true );\n\t\t\t\t$this->_conn->setOption( \\Memcached::OPT_COMPRESSION, false );\n\t\t\t\t$this->_conn->setSaslAuthData( $this->_cfg_user, $this->_cfg_pswd );\n\t\t\t}\n\n\t\t\t// Check connection.\n\t\t\tif ( ! $this->_validate_mem_server() ) {\n\t\t\t\t$failed = true;\n\t\t\t}\n\t\t}\n\n\t\t// If failed to connect.\n\t\tif ( $failed ) {\n\t\t\t$this->debug_oc( '❌ Failed to connect ' . $this->_oc_driver . ' server!' );\n\t\t\t$this->_conn        = null;\n\t\t\t$this->_cfg_enabled = false;\n\t\t\t! defined( 'LITESPEED_OC_FAILURE' ) && define( 'LITESPEED_OC_FAILURE', true );\n\t\t\t// error_log( 'Object: false!' );\n\t\t\treturn false;\n\t\t}\n\n\t\t$this->debug_oc( '✅ Connected to ' . $this->_oc_driver . ' server.' );\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Check if the connected memcached host is the one in cfg.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return bool\n\t */\n\tprivate function _validate_mem_server() {\n\t\t$mem_list = $this->_conn->getStats();\n\t\tif ( empty( $mem_list ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tforeach ( $mem_list as $k => $v ) {\n\t\t\tif ( substr( $k, 0, strlen( $this->_cfg_host ) ) !== $this->_cfg_host ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif ( ! empty( $v['pid'] ) || ! empty( $v['curr_connections'] ) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Get memcached unique id to be used for connecting.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return string\n\t */\n\tprivate function _get_mem_id() {\n\t\t$mem_id = 'litespeed';\n\t\tif ( is_multisite() ) {\n\t\t\t$mem_id .= '_' . get_current_blog_id();\n\t\t}\n\n\t\treturn $mem_id;\n\t}\n\n\t/**\n\t * Get cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param string $key Cache key.\n\t * @return mixed|null\n\t */\n\tpublic function get( $key ) {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_can_cache() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t$res = $this->_conn->get( $key );\n\n\t\treturn $res;\n\t}\n\n\t/**\n\t * Set cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param string $key    Cache key.\n\t * @param mixed  $data   Data to store.\n\t * @param int    $expire TTL seconds.\n\t * @return bool|null\n\t */\n\tpublic function set( $key, $data, $expire ) {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * To fix the Cloud callback cached as its frontend call but the hash is generated in backend\n\t\t * Bug found by Stan at Jan/10/2020\n\t\t */\n\t\t// if ( ! $this->_can_cache() ) {\n\t\t// return null;\n\t\t// }\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t$ttl = $expire ? $expire : $this->_cfg_life;\n\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\ttry {\n\t\t\t\t$res = $this->_conn->setEx( $key, $ttl, $data );\n\t\t\t} catch ( \\RedisException $ex ) {\n\t\t\t\t$res = false;\n\t\t\t\t$msg = sprintf( __( 'Redis encountered a fatal error: %1$s (code: %2$d)', 'litespeed-cache' ), $ex->getMessage(), $ex->getCode() );\n\t\t\t\t$this->debug_oc( $msg );\n\t\t\t\tAdmin_Display::error( $msg );\n\t\t\t}\n\t\t} else {\n\t\t\t$res = $this->_conn->set( $key, $data, $ttl );\n\t\t}\n\n\t\treturn $res;\n\t}\n\n\t/**\n\t * Check if can cache or not.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return bool\n\t */\n\tprivate function _can_cache() {\n\t\tif ( ! $this->_cfg_admin && defined( 'WP_ADMIN' ) ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Delete cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param string $key Cache key.\n\t * @return bool|null\n\t */\n\tpublic function delete( $key ) {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\t$res = $this->_conn->del( $key );\n\t\t} else {\n\t\t\t$res = $this->_conn->delete( $key );\n\t\t}\n\n\t\treturn (bool) $res;\n\t}\n\n\t/**\n\t * Clear all cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @return bool|null\n\t */\n\tpublic function flush() {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\t$this->debug_oc( 'bypass flushing' );\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t$this->debug_oc( 'flush!' );\n\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\t$res = $this->_conn->flushDb();\n\t\t} else {\n\t\t\t$res = $this->_conn->flush();\n\t\t\t$this->_conn->resetServerList();\n\t\t}\n\n\t\treturn $res;\n\t}\n\n\t/**\n\t * Add global groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups Group(s) to add.\n\t * @return void\n\t */\n\tpublic function add_global_groups( $groups ) {\n\t\tif ( ! is_array( $groups ) ) {\n\t\t\t$groups = array( $groups );\n\t\t}\n\n\t\t$this->_global_groups = array_merge( $this->_global_groups, $groups );\n\t\t$this->_global_groups = array_unique( $this->_global_groups );\n\t}\n\n\t/**\n\t * Check if is in global groups or not.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t */\n\tpublic function is_global( $group ) {\n\t\treturn in_array( $group, $this->_global_groups, true );\n\t}\n\n\t/**\n\t * Add non persistent groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups Group(s) to add.\n\t * @return void\n\t */\n\tpublic function add_non_persistent_groups( $groups ) {\n\t\tif ( ! is_array( $groups ) ) {\n\t\t\t$groups = array( $groups );\n\t\t}\n\n\t\t$this->_non_persistent_groups = array_merge( $this->_non_persistent_groups, $groups );\n\t\t$this->_non_persistent_groups = array_unique( $this->_non_persistent_groups );\n\t}\n\n\t/**\n\t * Check if is in non persistent groups or not.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t */\n\tpublic function is_non_persistent( $group ) {\n\t\treturn in_array( $group, $this->_non_persistent_groups, true );\n\t}\n}\n",
    "plugins/litespeed-cache/src/cdn/quic.cls.php": "<?php\n/**\n * The quic.cloud class.\n *\n * @since       2.4.1\n * @package     LiteSpeed\n * @subpackage  LiteSpeed/src/cdn\n */\n\nnamespace LiteSpeed\\CDN;\n\nuse LiteSpeed\\Cloud;\nuse LiteSpeed\\Base;\n\ndefined('WPINC') || exit();\n\n/**\n * Class Quic\n *\n * Handles Quic.cloud CDN integration.\n *\n * @since 2.4.1\n */\nclass Quic extends Base {\n\tconst LOG_TAG  = '☁️';\n\tconst TYPE_REG = 'reg';\n\n\t/**\n\t * Force sync flag.\n\t *\n\t * @var bool\n\t */\n\tprivate $force = false;\n\n\t/**\n\t * Notify CDN new config updated\n\t *\n\t * Syncs configuration with Quic.cloud CDN.\n\t *\n\t * @since 2.4.1\n\t * @access public\n\t * @param bool $force Whether to force sync.\n\t * @return bool|void\n\t */\n\tpublic function try_sync_conf( $force = false ) {\n\t\t$cloud_summary = Cloud::get_summary();\n\t\tif ($force) {\n\t\t\t$this->force = $force;\n\t\t}\n\n\t\tif (!$this->conf(self::O_CDN_QUIC)) {\n\t\t\tif (!empty($cloud_summary['conf_md5'])) {\n\t\t\t\tself::debug('❌ No QC CDN, clear conf md5!');\n\t\t\t\tCloud::save_summary(array( 'conf_md5' => '' ));\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\t// Notice: Sync conf must be after `wp_loaded` hook, to get 3rd party vary injected (e.g. `woocommerce_cart_hash`).\n\t\tif (!did_action('wp_loaded')) {\n\t\t\tadd_action('wp_loaded', array( $this, 'try_sync_conf' ), 999);\n\t\t\tself::debug('WP not loaded yet, delay sync to wp_loaded:999');\n\t\t\treturn;\n\t\t}\n\n\t\t$options                = $this->get_options();\n\t\t$options['_tp_cookies'] = apply_filters('litespeed_vary_cookies', array());\n\n\t\t// Build necessary options only\n\t\t$options_needed  = array(\n\t\t\tself::O_CACHE_DROP_QS,\n\t\t\tself::O_CACHE_EXC_COOKIES,\n\t\t\tself::O_CACHE_EXC_USERAGENTS,\n\t\t\tself::O_CACHE_LOGIN_COOKIE,\n\t\t\tself::O_CACHE_VARY_COOKIES,\n\t\t\tself::O_CACHE_MOBILE_RULES,\n\t\t\tself::O_CACHE_MOBILE,\n\t\t\tself::O_CACHE_BROWSER,\n\t\t\tself::O_CACHE_TTL_BROWSER,\n\t\t\tself::O_IMG_OPTM_WEBP,\n\t\t\tself::O_GUEST,\n\t\t\t'_tp_cookies',\n\t\t);\n\t\t$consts_needed   = array( 'LSWCP_TAG_PREFIX' );\n\t\t$options_for_md5 = array();\n\t\tforeach ($options_needed as $v) {\n\t\t\tif (isset($options[$v])) {\n\t\t\t\t$options_for_md5[$v] = $options[$v];\n\t\t\t\t// Remove overflow multi lines fields\n\t\t\t\tif (is_array($options_for_md5[$v]) && count($options_for_md5[$v]) > 30) {\n\t\t\t\t\t$options_for_md5[$v] = array_slice($options_for_md5[$v], 0, 30);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t$server_vars = $this->server_vars();\n\t\tforeach ($consts_needed as $v) {\n\t\t\tif (isset($server_vars[$v])) {\n\t\t\t\tif (empty($options_for_md5['_server'])) {\n\t\t\t\t\t$options_for_md5['_server'] = array();\n\t\t\t\t}\n\t\t\t\t$options_for_md5['_server'][$v] = $server_vars[$v];\n\t\t\t}\n\t\t}\n\n\t\t$conf_md5 = md5(wp_json_encode($options_for_md5));\n\t\tif (!empty($cloud_summary['conf_md5'])) {\n\t\t\tif ($conf_md5 === $cloud_summary['conf_md5']) {\n\t\t\t\tif (!$this->force) {\n\t\t\t\t\tself::debug('Bypass sync conf to QC due to same md5', $conf_md5);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tself::debug('!!!Force sync conf even same md5');\n\t\t\t} else {\n\t\t\t\tself::debug('[conf_md5] ' . $conf_md5 . ' [existing_conf_md5] ' . $cloud_summary['conf_md5']);\n\t\t\t}\n\t\t}\n\n\t\tCloud::save_summary(array( 'conf_md5' => $conf_md5 ));\n\t\tself::debug('sync conf to QC');\n\n\t\tCloud::post(Cloud::SVC_D_SYNC_CONF, $options_for_md5);\n\t}\n}\n",
    "plugins/litespeed-cache/src/cdn/cloudflare.cls.php": "<?php\n/**\n * The cloudflare CDN class.\n *\n * @since       2.1\n * @package     LiteSpeed\n * @subpackage  LiteSpeed/src/cdn\n * @author      LiteSpeed Technologies <info@litespeedtech.com>\n */\n\nnamespace LiteSpeed\\CDN;\n\nuse LiteSpeed\\Base;\nuse LiteSpeed\\Debug2;\nuse LiteSpeed\\Router;\nuse LiteSpeed\\Admin;\nuse LiteSpeed\\Admin_Display;\n\ndefined('WPINC') || exit();\n\n/**\n * Class Cloudflare\n *\n * @since 2.1\n */\nclass Cloudflare extends Base {\n\n\tconst TYPE_PURGE_ALL       = 'purge_all';\n\tconst TYPE_GET_DEVMODE     = 'get_devmode';\n\tconst TYPE_SET_DEVMODE_ON  = 'set_devmode_on';\n\tconst TYPE_SET_DEVMODE_OFF = 'set_devmode_off';\n\n\tconst ITEM_STATUS = 'status';\n\n\t/**\n\t * Update zone&name based on latest settings\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function try_refresh_zone() {\n\t\tif (!$this->conf(self::O_CDN_CLOUDFLARE)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$zone = $this->fetch_zone();\n\t\tif ($zone) {\n\t\t\t$this->cls('Conf')->update(self::O_CDN_CLOUDFLARE_NAME, $zone['name']);\n\n\t\t\t$this->cls('Conf')->update(self::O_CDN_CLOUDFLARE_ZONE, $zone['id']);\n\n\t\t\tDebug2::debug(\"[Cloudflare] Get zone successfully \\t\\t[ID] \" . $zone['id']);\n\t\t} else {\n\t\t\t$this->cls('Conf')->update(self::O_CDN_CLOUDFLARE_ZONE, '');\n\t\t\tDebug2::debug('[Cloudflare] ❌ Get zone failed, clean zone');\n\t\t}\n\t}\n\n\t/**\n\t * Get Cloudflare development mode\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t * @param bool $show_msg Whether to show success/error message.\n\t */\n\tprivate function get_devmode( $show_msg = true ) {\n\t\tDebug2::debug('[Cloudflare] get_devmode');\n\n\t\t$zone = $this->zone();\n\t\tif (!$zone) {\n\t\t\treturn;\n\t\t}\n\n\t\t$url = 'https://api.cloudflare.com/client/v4/zones/' . $zone . '/settings/development_mode';\n\t\t$res = $this->cloudflare_call($url, 'GET', false, $show_msg);\n\n\t\tif (!$res) {\n\t\t\treturn;\n\t\t}\n\t\tDebug2::debug('[Cloudflare] get_devmode result ', $res);\n\n\t\t// Make sure is array: #992174\n\t\t$curr_status = self::get_option(self::ITEM_STATUS, array());\n\t\tif ( ! is_array( $curr_status ) ) {\n\t\t\t$curr_status = array();\n\t\t}\n\t\t$curr_status['devmode']         = $res['value'];\n\t\t$curr_status['devmode_expired'] = $res['time_remaining'] + time();\n\n\t\t// update status\n\t\tself::update_option(self::ITEM_STATUS, $curr_status);\n\t}\n\n\t/**\n\t * Set Cloudflare development mode\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t * @param string $type The type of development mode to set (on/off).\n\t */\n\tprivate function set_devmode( $type ) {\n\t\tDebug2::debug('[Cloudflare] set_devmode');\n\n\t\t$zone = $this->zone();\n\t\tif (!$zone) {\n\t\t\treturn;\n\t\t}\n\n\t\t$url     = 'https://api.cloudflare.com/client/v4/zones/' . $zone . '/settings/development_mode';\n\t\t$new_val = self::TYPE_SET_DEVMODE_ON === $type ? 'on' : 'off';\n\t\t$data    = array( 'value' => $new_val );\n\t\t$res     = $this->cloudflare_call($url, 'PATCH', $data);\n\n\t\tif (!$res) {\n\t\t\treturn;\n\t\t}\n\n\t\t$res = $this->get_devmode(false);\n\n\t\tif ($res) {\n\t\t\t$msg = sprintf(__('Notified Cloudflare to set development mode to %s successfully.', 'litespeed-cache'), strtoupper($new_val));\n\t\t\tAdmin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Shortcut to purge Cloudflare\n\t *\n\t * @since  7.1\n\t * @access public\n\t * @param string|bool $reason The reason for purging, or false if none.\n\t */\n\tpublic static function purge_all( $reason = false ) {\n\t\tif ($reason) {\n\t\t\tDebug2::debug('[Cloudflare] purge call because: ' . $reason);\n\t\t}\n\t\tself::cls()->purge_all_private();\n\t}\n\n\t/**\n\t * Purge Cloudflare cache\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t */\n\tprivate function purge_all_private() {\n\t\tDebug2::debug('[Cloudflare] purge_all_private');\n\n\t\t$cf_on = $this->conf(self::O_CDN_CLOUDFLARE);\n\t\tif (!$cf_on) {\n\t\t\t$msg = __('Cloudflare API is set to off.', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn;\n\t\t}\n\n\t\t$zone = $this->zone();\n\t\tif (!$zone) {\n\t\t\treturn;\n\t\t}\n\n\t\t$url  = 'https://api.cloudflare.com/client/v4/zones/' . $zone . '/purge_cache';\n\t\t$data = array( 'purge_everything' => true );\n\n\t\t$res = $this->cloudflare_call($url, 'DELETE', $data);\n\n\t\tif ($res) {\n\t\t\t$msg = __('Notified Cloudflare to purge all successfully.', 'litespeed-cache');\n\t\t\tAdmin_Display::success($msg);\n\t\t}\n\t}\n\n\t/**\n\t * Get current Cloudflare zone from cfg\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t */\n\tprivate function zone() {\n\t\t$zone = $this->conf(self::O_CDN_CLOUDFLARE_ZONE);\n\t\tif (!$zone) {\n\t\t\t$msg = __('No available Cloudflare zone', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $zone;\n\t}\n\n\t/**\n\t * Get Cloudflare zone settings\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t */\n\tprivate function fetch_zone() {\n\t\t$kw = $this->conf(self::O_CDN_CLOUDFLARE_NAME);\n\n\t\t$url = 'https://api.cloudflare.com/client/v4/zones?status=active&match=all';\n\n\t\t// Try exact match first\n\t\tif ($kw && false !== strpos($kw, '.')) {\n\t\t\t$zones = $this->cloudflare_call($url . '&name=' . $kw, 'GET', false, false);\n\t\t\tif ($zones) {\n\t\t\t\tDebug2::debug('[Cloudflare] fetch_zone exact matched');\n\t\t\t\treturn $zones[0];\n\t\t\t}\n\t\t}\n\n\t\t// Can't find, try to get default one\n\t\t$zones = $this->cloudflare_call($url, 'GET', false, false);\n\n\t\tif (!$zones) {\n\t\t\tDebug2::debug('[Cloudflare] fetch_zone no zone');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$kw) {\n\t\t\tDebug2::debug('[Cloudflare] fetch_zone no set name, use first one by default');\n\t\t\treturn $zones[0];\n\t\t}\n\n\t\tforeach ($zones as $v) {\n\t\t\tif (false !== strpos($v['name'], $kw)) {\n\t\t\t\tDebug2::debug('[Cloudflare] fetch_zone matched ' . $kw . ' [name] ' . $v['name']);\n\t\t\t\treturn $v;\n\t\t\t}\n\t\t}\n\n\t\t// Can't match current name, return default one\n\t\tDebug2::debug('[Cloudflare] fetch_zone failed match name, use first one by default');\n\t\treturn $zones[0];\n\t}\n\n\t/**\n\t * Cloudflare API\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t * @param string     $url      The API URL to call.\n\t * @param string     $method   The HTTP method to use (GET, POST, etc.).\n\t * @param array|bool $data     The data to send with the request, or false if none.\n\t * @param bool       $show_msg Whether to show success/error message.\n\t */\n\tprivate function cloudflare_call( $url, $method = 'GET', $data = false, $show_msg = true ) {\n\t\tDebug2::debug(\"[Cloudflare] cloudflare_call \\t\\t[URL] $url\");\n\n\t\tif (strlen($this->conf(self::O_CDN_CLOUDFLARE_KEY)) === 40) {\n\t\t\t$headers = array(\n\t\t\t\t'Content-Type'  => 'application/json',\n\t\t\t\t'Authorization' => 'Bearer ' . $this->conf(self::O_CDN_CLOUDFLARE_KEY),\n\t\t\t);\n\t\t} else {\n\t\t\t$headers = array(\n\t\t\t\t'Content-Type'  => 'application/json',\n\t\t\t\t'X-Auth-Email' => $this->conf(self::O_CDN_CLOUDFLARE_EMAIL),\n\t\t\t\t'X-Auth-Key'   => $this->conf(self::O_CDN_CLOUDFLARE_KEY),\n\t\t\t);\n\t\t}\n\n\t\t$wp_args = array(\n\t\t\t'method'  => $method,\n\t\t\t'headers' => $headers,\n\t\t);\n\n\t\tif ($data) {\n\t\t\tif (is_array($data)) {\n\t\t\t\t$data = wp_json_encode($data);\n\t\t\t}\n\t\t\t$wp_args['body'] = $data;\n\t\t}\n\t\t$resp = wp_remote_request($url, $wp_args);\n\t\tif (is_wp_error($resp)) {\n\t\t\tDebug2::debug('[Cloudflare] error in response');\n\t\t\tif ($show_msg) {\n\t\t\t\t$msg = __('Failed to communicate with Cloudflare', 'litespeed-cache');\n\t\t\t\tAdmin_Display::error($msg);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\t$result = wp_remote_retrieve_body($resp);\n\n\t\t$json = \\json_decode($result, true);\n\n\t\tif ($json && $json['success'] && $json['result']) {\n\t\t\tDebug2::debug('[Cloudflare] cloudflare_call called successfully');\n\t\t\tif ($show_msg) {\n\t\t\t\t$msg = __('Communicated with Cloudflare successfully.', 'litespeed-cache');\n\t\t\t\tAdmin_Display::success($msg);\n\t\t\t}\n\n\t\t\treturn $json['result'];\n\t\t}\n\n\t\tDebug2::debug(\"[Cloudflare] cloudflare_call called failed: $result\");\n\t\tif ($show_msg) {\n\t\t\t$msg = __('Failed to communicate with Cloudflare', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  1.7.2\n\t * @access public\n\t */\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_PURGE_ALL:\n\t\t\t\t$this->purge_all_private();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_GET_DEVMODE:\n\t\t\t\t$this->get_devmode();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_SET_DEVMODE_ON:\n\t\t\tcase self::TYPE_SET_DEVMODE_OFF:\n\t\t\t\t$this->set_devmode($type);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n",
    "plugins/litespeed-cache/src/lang.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The language class.\n *\n * @since       3.0\n * @package     LiteSpeed_Cache\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Lang extends Base {\n\n\t/**\n\t * Get image status per status bit\n\t *\n\t * @since  3.0\n\t */\n\tpublic static function img_status( $status = null ) {\n\t\t$list = array(\n\t\t\tImg_Optm::STATUS_NEW => __('Images not requested', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_RAW => __('Images ready to request', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_REQUESTED => __('Images requested', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_NOTIFIED => __('Images notified to pull', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_PULLED => __('Images optimized and pulled', 'litespeed-cache'),\n\t\t);\n\n\t\tif ($status !== null) {\n\t\t\treturn !empty($list[$status]) ? $list[$status] : 'N/A';\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t/**\n\t * Try translating a string\n\t *\n\t * @since  4.7\n\t */\n\tpublic static function maybe_translate( $raw_string ) {\n\t\t$map = array(\n\t\t\t'auto_alias_failed_cdn' =>\n\t\t\t\t__('Unable to automatically add %1$s as a Domain Alias for main %2$s domain, due to potential CDN conflict.', 'litespeed-cache') .\n\t\t\t\t' ' .\n\t\t\t\tDoc::learn_more('https://quic.cloud/docs/cdn/dns/how-to-setup-domain-alias/', false, false, false, true),\n\n\t\t\t'auto_alias_failed_uid' =>\n\t\t\t\t__('Unable to automatically add %1$s as a Domain Alias for main %2$s domain.', 'litespeed-cache') .\n\t\t\t\t' ' .\n\t\t\t\t__('Alias is in use by another QUIC.cloud account.', 'litespeed-cache') .\n\t\t\t\t' ' .\n\t\t\t\tDoc::learn_more('https://quic.cloud/docs/cdn/dns/how-to-setup-domain-alias/', false, false, false, true),\n\t\t);\n\n\t\t// Maybe has placeholder\n\t\tif (strpos($raw_string, '::')) {\n\t\t\t$replacements = explode('::', $raw_string);\n\t\t\tif (empty($map[$replacements[0]])) {\n\t\t\t\treturn $raw_string;\n\t\t\t}\n\t\t\t$tpl = $map[$replacements[0]];\n\t\t\tunset($replacements[0]);\n\t\t\treturn vsprintf($tpl, array_values($replacements));\n\t\t}\n\n\t\t// Direct translation only\n\t\tif (empty($map[$raw_string])) {\n\t\t\treturn $raw_string;\n\t\t}\n\n\t\treturn $map[$raw_string];\n\t}\n\n\t/**\n\t * Get the title of id\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic static function title( $id ) {\n\t\t$_lang_list = array(\n\t\t\tself::O_SERVER_IP => __('Server IP', 'litespeed-cache'),\n\t\t\tself::O_GUEST_UAS => __('Guest Mode User Agents', 'litespeed-cache'),\n\t\t\tself::O_GUEST_IPS => __('Guest Mode IPs', 'litespeed-cache'),\n\n\t\t\tself::O_CACHE => __('Enable Cache', 'litespeed-cache'),\n\t\t\tself::O_CACHE_BROWSER => __('Browser Cache', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_PUB => __('Default Public Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_PRIV => __('Default Private Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_FRONTPAGE => __('Default Front Page TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_FEED => __('Default Feed TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_REST => __('Default REST TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_STATUS => __('Default HTTP Status Code Page TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_BROWSER => __('Browser Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_AJAX_TTL => __('AJAX Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_AUTO_UPGRADE => __('Automatically Upgrade', 'litespeed-cache'),\n\t\t\tself::O_GUEST => __('Guest Mode', 'litespeed-cache'),\n\t\t\tself::O_GUEST_OPTM => __('Guest Optimization', 'litespeed-cache'),\n\t\t\tself::O_NEWS => __('Notifications', 'litespeed-cache'),\n\t\t\tself::O_CACHE_PRIV => __('Cache Logged-in Users', 'litespeed-cache'),\n\t\t\tself::O_CACHE_COMMENTER => __('Cache Commenters', 'litespeed-cache'),\n\t\t\tself::O_CACHE_REST => __('Cache REST API', 'litespeed-cache'),\n\t\t\tself::O_CACHE_PAGE_LOGIN => __('Cache Login Page', 'litespeed-cache'),\n\t\t\tself::O_CACHE_MOBILE => __('Cache Mobile', 'litespeed-cache'),\n\t\t\tself::O_CACHE_MOBILE_RULES => __('List of Mobile User Agents', 'litespeed-cache'),\n\t\t\tself::O_CACHE_PRIV_URI => __('Private Cached URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_DROP_QS => __('Drop Query String', 'litespeed-cache'),\n\n\t\t\tself::O_OBJECT => __('Object Cache', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_KIND => __('Method', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_HOST => __('Host', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_PORT => __('Port', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_LIFE => __('Default Object Lifetime', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_USER => __('Username', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_PSWD => __('Password', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_DB_ID => __('Redis Database ID', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_GLOBAL_GROUPS => __('Global Groups', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_NON_PERSISTENT_GROUPS => __('Do Not Cache Groups', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_PERSISTENT => __('Persistent Connection', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_ADMIN => __('Cache WP-Admin', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_TRANSIENTS => __('Store Transients', 'litespeed-cache'),\n\n\t\t\tself::O_PURGE_ON_UPGRADE => __('Purge All On Upgrade', 'litespeed-cache'),\n\t\t\tself::O_PURGE_STALE => __('Serve Stale', 'litespeed-cache'),\n\t\t\tself::O_PURGE_TIMED_URLS => __('Scheduled Purge URLs', 'litespeed-cache'),\n\t\t\tself::O_PURGE_TIMED_URLS_TIME => __('Scheduled Purge Time', 'litespeed-cache'),\n\t\t\tself::O_CACHE_FORCE_URI => __('Force Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_FORCE_PUB_URI => __('Force Public Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC => __('Do Not Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_QS => __('Do Not Cache Query Strings', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_CAT => __('Do Not Cache Categories', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_TAG => __('Do Not Cache Tags', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_ROLES => __('Do Not Cache Roles', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_MIN => __('CSS Minify', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_COMB => __('CSS Combine', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_COMB_EXT_INL => __('CSS Combine External and Inline', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS => __('Generate UCSS', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_INLINE => __('UCSS Inline', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_SELECTOR_WHITELIST => __('UCSS Selector Allowlist', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_FILE_EXC_INLINE => __('UCSS Inline Excluded Files', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_EXC => __('UCSS URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_MIN => __('JS Minify', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_COMB => __('JS Combine', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_COMB_EXT_INL => __('JS Combine External and Inline', 'litespeed-cache'),\n\t\t\tself::O_OPTM_HTML_MIN => __('HTML Minify', 'litespeed-cache'),\n\t\t\tself::O_OPTM_HTML_LAZY => __('HTML Lazy Load Selectors', 'litespeed-cache'),\n\t\t\tself::O_OPTM_HTML_SKIP_COMMENTS => __('HTML Keep Comments', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_ASYNC => __('Load CSS Asynchronously', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_PER_URL => __('CCSS Per URL', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_ASYNC_INLINE => __('Inline CSS Async Lib', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_FONT_DISPLAY => __('Font Display Optimization', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_DEFER => __('Load JS Deferred', 'litespeed-cache'),\n\t\t\tself::O_OPTM_LOCALIZE => __('Localize Resources', 'litespeed-cache'),\n\t\t\tself::O_OPTM_LOCALIZE_DOMAINS => __('Localization Files', 'litespeed-cache'),\n\t\t\tself::O_OPTM_DNS_PREFETCH => __('DNS Prefetch', 'litespeed-cache'),\n\t\t\tself::O_OPTM_DNS_PREFETCH_CTRL => __('DNS Prefetch Control', 'litespeed-cache'),\n\t\t\tself::O_OPTM_DNS_PRECONNECT => __('DNS Preconnect', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_EXC => __('CSS Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_DELAY_INC => __('JS Delayed Includes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_EXC => __('JS Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_QS_RM => __('Remove Query Strings', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GGFONTS_ASYNC => __('Load Google Fonts Asynchronously', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GGFONTS_RM => __('Remove Google Fonts', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_CON => __('Critical CSS Rules', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_SEP_POSTTYPE => __('Separate CCSS Cache Post Types', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_SEP_URI => __('Separate CCSS Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_SELECTOR_WHITELIST => __('CCSS Selector Allowlist', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_DEFER_EXC => __('JS Deferred / Delayed Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GM_JS_EXC => __('Guest Mode JS Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_EMOJI_RM => __('Remove WordPress Emoji', 'litespeed-cache'),\n\t\t\tself::O_OPTM_NOSCRIPT_RM => __('Remove Noscript Tags', 'litespeed-cache'),\n\t\t\tself::O_OPTM_EXC => __('URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GUEST_ONLY => __('Optimize for Guests Only', 'litespeed-cache'),\n\t\t\tself::O_OPTM_EXC_ROLES => __('Role Excludes', 'litespeed-cache'),\n\n\t\t\tself::O_DISCUSS_AVATAR_CACHE => __('Gravatar Cache', 'litespeed-cache'),\n\t\t\tself::O_DISCUSS_AVATAR_CRON => __('Gravatar Cache Cron', 'litespeed-cache'),\n\t\t\tself::O_DISCUSS_AVATAR_CACHE_TTL => __('Gravatar Cache TTL', 'litespeed-cache'),\n\n\t\t\tself::O_MEDIA_LAZY => __('Lazy Load Images', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_EXC => __('Lazy Load Image Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_CLS_EXC => __('Lazy Load Image Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_PARENT_CLS_EXC => __('Lazy Load Image Parent Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_IFRAME_LAZY_CLS_EXC => __('Lazy Load Iframe Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC => __('Lazy Load Iframe Parent Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_URI_EXC => __('Lazy Load URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP_EXC => __('LQIP Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_PLACEHOLDER => __('Basic Image Placeholder', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP => __('Responsive Placeholder', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP_COLOR => __('Responsive Placeholder Color', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP_SVG => __('Responsive Placeholder SVG', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP => __('LQIP Cloud Generator', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP_QUAL => __('LQIP Quality', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP_MIN_W => __('LQIP Minimum Dimensions', 'litespeed-cache'),\n\t\t\t// self::O_MEDIA_LQIP_MIN_H         => __( 'LQIP Minimum Height', 'litespeed-cache' ),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP_ASYNC => __('Generate LQIP In Background', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_IFRAME_LAZY => __('Lazy Load Iframes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_ADD_MISSING_SIZES => __('Add Missing Sizes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_VPI => __('Viewport Images', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_VPI_CRON => __('Viewport Images Cron', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_AUTO_RESCALE_ORI => __('Auto Rescale Original Images', 'litespeed-cache'),\n\n\t\t\tself::O_IMG_OPTM_AUTO => __('Auto Request Cron', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_ORI => __('Optimize Original Images', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_RM_BKUP => __('Remove Original Backups', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_WEBP => __('Next-Gen Image Format', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_LOSSLESS => __('Optimize Losslessly', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_EXIF => __('Preserve EXIF/XMP data', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_WEBP_ATTR => __('WebP/AVIF Attribute To Replace', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_WEBP_REPLACE_SRCSET => __('WebP/AVIF For Extra srcset', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_JPG_QUALITY => __('WordPress Image Quality Control', 'litespeed-cache'),\n\t\t\tself::O_ESI => __('Enable ESI', 'litespeed-cache'),\n\t\t\tself::O_ESI_CACHE_ADMBAR => __('Cache Admin Bar', 'litespeed-cache'),\n\t\t\tself::O_ESI_CACHE_COMMFORM => __('Cache Comment Form', 'litespeed-cache'),\n\t\t\tself::O_ESI_NONCE => __('ESI Nonces', 'litespeed-cache'),\n\t\t\tself::O_CACHE_VARY_GROUP => __('Vary Group', 'litespeed-cache'),\n\t\t\tself::O_PURGE_HOOK_ALL => __('Purge All Hooks', 'litespeed-cache'),\n\t\t\tself::O_UTIL_NO_HTTPS_VARY => __('Improve HTTP/HTTPS Compatibility', 'litespeed-cache'),\n\t\t\tself::O_UTIL_INSTANT_CLICK => __('Instant Click', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_COOKIES => __('Do Not Cache Cookies', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_USERAGENTS => __('Do Not Cache User Agents', 'litespeed-cache'),\n\t\t\tself::O_CACHE_LOGIN_COOKIE => __('Login Cookie', 'litespeed-cache'),\n\t\t\tself::O_CACHE_VARY_COOKIES => __('Vary Cookies', 'litespeed-cache'),\n\n\t\t\tself::O_MISC_HEARTBEAT_FRONT => __('Frontend Heartbeat Control', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_FRONT_TTL => __('Frontend Heartbeat TTL', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_BACK => __('Backend Heartbeat Control', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_BACK_TTL => __('Backend Heartbeat TTL', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_EDITOR => __('Editor Heartbeat', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_EDITOR_TTL => __('Editor Heartbeat TTL', 'litespeed-cache'),\n\n\t\t\tself::O_CDN => __('Use CDN Mapping', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_URL => __('CDN URL', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_INC_IMG => __('Include Images', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_INC_CSS => __('Include CSS', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_INC_JS => __('Include JS', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_FILETYPE => __('Include File Types', 'litespeed-cache'),\n\t\t\tself::O_CDN_ATTR => __('HTML Attribute To Replace', 'litespeed-cache'),\n\t\t\tself::O_CDN_ORI => __('Original URLs', 'litespeed-cache'),\n\t\t\tself::O_CDN_ORI_DIR => __('Included Directories', 'litespeed-cache'),\n\t\t\tself::O_CDN_EXC => __('Exclude Path', 'litespeed-cache'),\n\t\t\tself::O_CDN_CLOUDFLARE => __('Cloudflare API', 'litespeed-cache'),\n\t\t\tself::O_CDN_CLOUDFLARE_CLEAR => __('Clear Cloudflare cache', 'litespeed-cache'),\n\n\t\t\tself::O_CRAWLER => __('Crawler', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_CRAWL_INTERVAL => __('Crawl Interval', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_LOAD_LIMIT => __('Server Load Limit', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_ROLES => __('Role Simulation', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_COOKIES => __('Cookie Simulation', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_SITEMAP => __('Custom Sitemap', 'litespeed-cache'),\n\n\t\t\tself::O_DEBUG_DISABLE_ALL => __('Disable All Features', 'litespeed-cache'),\n\t\t\tself::O_DEBUG => __('Debug Log', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_IPS => __('Admin IPs', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_LEVEL => __('Debug Level', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_FILESIZE => __('Log File Size Limit', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_COLLAPSE_QS => __('Collapse Query Strings', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_INC => __('Debug URI Includes', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_EXC => __('Debug URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_EXC_STRINGS => __('Debug String Excludes', 'litespeed-cache'),\n\n\t\t\tself::O_DB_OPTM_REVISIONS_MAX => __('Revisions Max Number', 'litespeed-cache'),\n\t\t\tself::O_DB_OPTM_REVISIONS_AGE => __('Revisions Max Age', 'litespeed-cache'),\n\t\t);\n\n\t\tif (array_key_exists($id, $_lang_list)) {\n\t\t\treturn $_lang_list[$id];\n\t\t}\n\n\t\treturn 'N/A';\n\t}\n}\n",
    "plugins/litespeed-cache/src/esi.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The ESI class.\n *\n * This is used to define all esi related functions.\n *\n * @since       1.1.3\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass ESI extends Root {\n\n\tconst LOG_TAG = '⏺';\n\n\tprivate static $has_esi      = false;\n\tprivate static $_combine_ids = array();\n\tprivate $esi_args            = null;\n\tprivate $_esi_preserve_list  = array();\n\tprivate $_nonce_actions      = array( -1 => '' ); // val is cache control\n\n\tconst QS_ACTION = 'lsesi';\n\tconst QS_PARAMS = 'esi';\n\tconst COMBO     = '__combo'; // ESI include combine='main' handler\n\n\tconst PARAM_ARGS     = 'args';\n\tconst PARAM_ID       = 'id';\n\tconst PARAM_INSTANCE = 'instance';\n\tconst PARAM_NAME     = 'name';\n\n\tconst WIDGET_O_ESIENABLE = 'widget_esi_enable';\n\tconst WIDGET_O_TTL       = 'widget_ttl';\n\n\t/**\n\t * Confructor of ESI\n\t *\n\t * @since  1.2.0\n\t * @since  4.0 Change to be after Vary init in hook 'after_setup_theme'\n\t */\n\tpublic function init() {\n\t\t/**\n\t\t * Bypass ESI related funcs if disabled ESI to fix potential DIVI compatibility issue\n\t\t *\n\t\t * @since  2.9.7.2\n\t\t */\n\t\tif (Router::is_ajax() || !$this->cls('Router')->esi_enabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Guest mode, don't need to use ESI\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If page is not cacheable\n\t\tif (defined('DONOTCACHEPAGE') && apply_filters('litespeed_const_DONOTCACHEPAGE', DONOTCACHEPAGE)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Init ESI in `after_setup_theme` hook after detected if LITESPEED_DISABLE_ALL is ON or not\n\t\t$this->_hooks();\n\n\t\t/**\n\t\t * Overwrite wp_create_nonce func\n\t\t *\n\t\t * @since  2.9.5\n\t\t */\n\t\t$this->_transform_nonce();\n\n\t\t!defined('LITESPEED_ESI_INITED') && define('LITESPEED_ESI_INITED', true);\n\t}\n\n\t/**\n\t * Init ESI related hooks\n\t *\n\t * Load delayed by hook to give the ability to bypass by LITESPEED_DISABLE_ALL const\n\t *\n\t * @since 2.9.7.2\n\t * @since  4.0 Changed to private from public\n\t * @access private\n\t */\n\tprivate function _hooks() {\n\t\tadd_filter('template_include', array( $this, 'esi_template' ), 99999);\n\n\t\tadd_action('load-widgets.php', __NAMESPACE__ . '\\Purge::purge_widget');\n\t\tadd_action('wp_update_comment_count', __NAMESPACE__ . '\\Purge::purge_comment_widget');\n\n\t\t/**\n\t\t * Recover REQUEST_URI\n\t\t *\n\t\t * @since  1.8.1\n\t\t */\n\t\tif (!empty($_GET[self::QS_ACTION])) {\n\t\t\tself::debug('ESI req');\n\t\t\t$this->_register_esi_actions();\n\t\t}\n\n\t\t/**\n\t\t * Shortcode ESI\n\t\t *\n\t\t * To use it, just change the original shortcode as below:\n\t\t *      old: [someshortcode aa='bb']\n\t\t *      new: [esi someshortcode aa='bb' cache='private,no-vary' ttl='600']\n\t\t *\n\t\t *  1. `cache` attribute is optional, default to 'public,no-vary'.\n\t\t *  2. `ttl` attribute is optional, default is your public TTL setting.\n\t\t *  3. `_ls_silence` attribute is optional, default is false.\n\t\t *\n\t\t * @since  2.8\n\t\t * @since  2.8.1 Check is_admin for Elementor compatibility #726013\n\t\t */\n\t\tif (!is_admin()) {\n\t\t\tadd_shortcode('esi', array( $this, 'shortcode' ));\n\t\t}\n\t}\n\n\t/**\n\t * Take over all nonce calls and transform to ESI\n\t *\n\t * @since  2.9.5\n\t */\n\tprivate function _transform_nonce() {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Load ESI nonces in conf\n\t\t$nonces = $this->conf(Base::O_ESI_NONCE);\n\t\tadd_filter('litespeed_esi_nonces', array( $this->cls('Data'), 'load_esi_nonces' ));\n\t\tif ($nonces = apply_filters('litespeed_esi_nonces', $nonces)) {\n\t\t\tforeach ($nonces as $action) {\n\t\t\t\t$this->nonce_action($action);\n\t\t\t}\n\t\t}\n\n\t\tadd_action('litespeed_nonce', array( $this, 'nonce_action' ));\n\t}\n\n\t/**\n\t * Register a new nonce action to convert it to ESI\n\t *\n\t * @since  2.9.5\n\t */\n\tpublic function nonce_action( $action ) {\n\t\t// Split the Cache Control\n\t\t$action  = explode(' ', $action);\n\t\t$control = !empty($action[1]) ? $action[1] : '';\n\t\t$action  = $action[0];\n\n\t\t// Wildcard supported\n\t\t$action = Utility::wildcard2regex($action);\n\n\t\tif (array_key_exists($action, $this->_nonce_actions)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_nonce_actions[$action] = $control;\n\n\t\t// Debug2::debug('[ESI] Appended nonce action to nonce list [action] ' . $action);\n\t}\n\n\t/**\n\t * Check if an action is registered to replace ESI\n\t *\n\t * @since 2.9.5\n\t */\n\tpublic function is_nonce_action( $action ) {\n\t\t// If GM not run yet, then ESI not init yet, then ESI nonce will not be allowed even nonce func replaced.\n\t\tif (!defined('LITESPEED_ESI_INITED')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tforeach ($this->_nonce_actions as $k => $v) {\n\t\t\tif (strpos($k, '*') !== false) {\n\t\t\t\tif (preg_match('#' . $k . '#iU', $action)) {\n\t\t\t\t\treturn $v;\n\t\t\t\t}\n\t\t\t} elseif ($k == $action) {\n\t\t\t\treturn $v;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Shortcode ESI\n\t *\n\t * @since 2.8\n\t * @access public\n\t */\n\tpublic function shortcode( $atts ) {\n\t\tif (empty($atts[0])) {\n\t\t\tDebug2::debug('[ESI] ===shortcode wrong format', $atts);\n\t\t\treturn 'Wrong shortcode esi format';\n\t\t}\n\n\t\t$cache = 'public,no-vary';\n\t\tif (!empty($atts['cache'])) {\n\t\t\t$cache = $atts['cache'];\n\t\t\tunset($atts['cache']);\n\t\t}\n\n\t\t$silence = false;\n\t\tif (!empty($atts['_ls_silence'])) {\n\t\t\t$silence = true;\n\t\t}\n\n\t\tdo_action('litespeed_esi_shortcode-' . $atts[0]);\n\n\t\t// Show ESI link\n\t\treturn $this->sub_esi_block('esi', 'esi-shortcode', $atts, $cache, $silence);\n\t}\n\n\t/**\n\t * Check if the requested page has esi elements. If so, return esi on\n\t * header.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return string Esi On header if request has esi, empty string otherwise.\n\t */\n\tpublic static function has_esi() {\n\t\treturn self::$has_esi;\n\t}\n\n\t/**\n\t * Sets that the requested page has esi elements.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function set_has_esi() {\n\t\tself::$has_esi = true;\n\t}\n\n\t/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page IS an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t */\n\tprivate function _register_esi_actions() {\n\t\t/**\n\t\t * This hook is in `init`\n\t\t * For any plugin need to check if page is ESI, use `LSCACHE_IS_ESI` check after `init` hook\n\t\t */\n\t\t!defined('LSCACHE_IS_ESI') && define('LSCACHE_IS_ESI', $_GET[self::QS_ACTION]); // Reused this to ESI block ID\n\n\t\t!empty($_SERVER['ESI_REFERER']) && defined('LSCWP_LOG') && Debug2::debug('[ESI] ESI_REFERER: ' . $_SERVER['ESI_REFERER']);\n\n\t\t/**\n\t\t * Only when ESI's parent is not REST, replace REQUEST_URI to avoid breaking WP5 editor REST call\n\t\t *\n\t\t * @since 2.9.3\n\t\t */\n\t\tif (!empty($_SERVER['ESI_REFERER']) && !$this->cls('REST')->is_rest($_SERVER['ESI_REFERER'])) {\n\t\t\tself::debug('overwrite REQUEST_URI to ESI_REFERER [from] ' . $_SERVER['REQUEST_URI'] . ' [to] ' . $_SERVER['ESI_REFERER']);\n\t\t\tif (!empty($_SERVER['ESI_REFERER'])) {\n\t\t\t\t$_SERVER['REQUEST_URI'] = $_SERVER['ESI_REFERER'];\n\t\t\t\tif (substr(get_option('permalink_structure'), -1) === '/' && strpos($_SERVER['ESI_REFERER'], '?') === false) {\n\t\t\t\t\t$_SERVER['REQUEST_URI'] = trailingslashit($_SERVER['ESI_REFERER']);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Prevent from 301 redirecting\n\t\t\tif (!empty($_SERVER['SCRIPT_URI'])) {\n\t\t\t\t$SCRIPT_URI         = parse_url($_SERVER['SCRIPT_URI']);\n\t\t\t\t$SCRIPT_URI['path'] = $_SERVER['REQUEST_URI'];\n\t\t\t\tUtility::compatibility();\n\t\t\t\t$_SERVER['SCRIPT_URI'] = http_build_url($SCRIPT_URI);\n\t\t\t}\n\t\t}\n\n\t\tif (!empty($_SERVER['ESI_CONTENT_TYPE']) && strpos($_SERVER['ESI_CONTENT_TYPE'], 'application/json') === 0) {\n\t\t\tadd_filter('litespeed_is_json', '__return_true');\n\t\t}\n\n\t\t/**\n\t\t * Make REST call be able to parse ESI\n\t\t * NOTE: Not effective due to ESI req are all to `/` yet\n\t\t *\n\t\t * @since 2.9.4\n\t\t */\n\t\tadd_action('rest_api_init', array( $this, 'load_esi_block' ), 101);\n\n\t\t// Register ESI blocks\n\t\tadd_action('litespeed_esi_load-widget', array( $this, 'load_widget_block' ));\n\t\tadd_action('litespeed_esi_load-admin-bar', array( $this, 'load_admin_bar_block' ));\n\t\tadd_action('litespeed_esi_load-comment-form', array( $this, 'load_comment_form_block' ));\n\n\t\tadd_action('litespeed_esi_load-nonce', array( $this, 'load_nonce_block' ));\n\t\tadd_action('litespeed_esi_load-esi', array( $this, 'load_esi_shortcode' ));\n\n\t\tadd_action('litespeed_esi_load-' . self::COMBO, array( $this, 'load_combo' ));\n\t}\n\n\t/**\n\t * Hooked to the template_include action.\n\t * Selects the esi template file when the post type is a LiteSpeed ESI page.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param string $template The template path filtered.\n\t * @return string The new template path.\n\t */\n\tpublic function esi_template( $template ) {\n\t\t// Check if is an ESI request\n\t\tif (defined('LSCACHE_IS_ESI')) {\n\t\t\tself::debug('calling ESI template');\n\n\t\t\treturn LSCWP_DIR . 'tpl/esi.tpl.php';\n\t\t}\n\t\tself::debug('calling default template');\n\t\t$this->_register_not_esi_actions();\n\t\treturn $template;\n\t}\n\n\t/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page is NOT an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t */\n\tprivate function _register_not_esi_actions() {\n\t\tdo_action('litespeed_tpl_normal');\n\n\t\tif (!Control::is_cacheable()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Router::is_ajax()) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('widget_display_callback', array( $this, 'sub_widget_block' ), 0, 3);\n\n\t\t// Add admin_bar esi\n\t\tif (Router::is_logged_in()) {\n\t\t\tremove_action('wp_body_open', 'wp_admin_bar_render', 0); // Remove default Admin bar. Fix https://github.com/elementor/elementor/issues/25198\n\t\t\tremove_action('wp_footer', 'wp_admin_bar_render', 1000);\n\t\t\tadd_action('wp_footer', array( $this, 'sub_admin_bar_block' ), 1000);\n\t\t}\n\n\t\t// Add comment forum esi for logged-in user or commenter\n\t\tif (!Router::is_ajax() && Vary::has_vary()) {\n\t\t\tadd_filter('comment_form_defaults', array( $this, 'register_comment_form_actions' ));\n\t\t}\n\t}\n\n\t/**\n\t * Set an ESI to be combine='sub'\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic static function combine( $block_id ) {\n\t\tif (!isset($_SERVER['X-LSCACHE']) || strpos($_SERVER['X-LSCACHE'], 'combine') === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (in_array($block_id, self::$_combine_ids)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::$_combine_ids[] = $block_id;\n\t}\n\n\t/**\n\t * Load combined ESI\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic function load_combo() {\n\t\tControl::set_nocache('ESI combine request');\n\n\t\tif (empty($_POST['esi_include'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::set_has_esi();\n\n\t\tDebug2::debug('[ESI] 🍔 Load combo', $_POST['esi_include']);\n\n\t\t$output = '';\n\t\tforeach ($_POST['esi_include'] as $url) {\n\t\t\t$qs = parse_url(htmlspecialchars_decode($url), PHP_URL_QUERY);\n\t\t\tparse_str($qs, $qs);\n\t\t\tif (empty($qs[self::QS_ACTION])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$esi_id       = $qs[self::QS_ACTION];\n\t\t\t$esi_param    = !empty($qs[self::QS_PARAMS]) ? $this->_parse_esi_param($qs[self::QS_PARAMS]) : false;\n\t\t\t$inline_param = apply_filters('litespeed_esi_inline-' . $esi_id, array(), $esi_param); // Returned array need to be [ val, control, tag ]\n\t\t\tif ($inline_param) {\n\t\t\t\t$output .= self::_build_inline($url, $inline_param);\n\t\t\t}\n\t\t}\n\n\t\techo $output;\n\t}\n\n\t/**\n\t * Build a whole inline segment\n\t *\n\t * @since  3.4.2\n\t */\n\tprivate static function _build_inline( $url, $inline_param ) {\n\t\tif (!$url || empty($inline_param['val']) || empty($inline_param['control']) || empty($inline_param['tag'])) {\n\t\t\treturn '';\n\t\t}\n\n\t\t$url     = esc_attr($url);\n\t\t$control = esc_attr($inline_param['control']);\n\t\t$tag     = esc_attr($inline_param['tag']);\n\n\t\treturn \"<esi:inline name='$url' cache-control='\" . $control . \"' cache-tag='\" . $tag . \"'>\" . $inline_param['val'] . '</esi:inline>';\n\t}\n\n\t/**\n\t * Build the esi url. This method will build the html comment wrapper as well as serialize and encode the parameter array.\n\t *\n\t * The block_id parameter should contain alphanumeric and '-_' only.\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param string $block_id     The id to use to display the correct esi block.\n\t * @param string $wrapper      The wrapper for the esi comments.\n\t * @param array  $params       The esi parameters.\n\t * @param string $control      The cache control attribute if any.\n\t * @param bool   $silence      If generate wrapper comment or not\n\t * @param bool   $preserved    If this ESI block is used in any filter, need to temporarily convert it to a string to avoid the HTML tag being removed/filtered.\n\t * @param bool   $svar         If store the value in memory or not, in memory will be faster\n\t * @param array  $inline_param If show the current value for current request( this can avoid multiple esi requests in first time cache generating process )\n\t */\n\tpublic function sub_esi_block(\n\t\t$block_id,\n\t\t$wrapper,\n\t\t$params = array(),\n\t\t$control = 'private,no-vary',\n\t\t$silence = false,\n\t\t$preserved = false,\n\t\t$svar = false,\n\t\t$inline_param = array()\n\t) {\n\t\tif (empty($block_id) || !is_array($params) || preg_match('/[^\\w-]/', $block_id)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\tDebug2::debug('[ESI] ESI OFF so force loading [block_id] ' . $block_id);\n\t\t\tdo_action('litespeed_esi_load-' . $block_id, $params);\n\t\t\treturn;\n\t\t}\n\n\t\tif ($silence) {\n\t\t\t// Don't add comment to esi block ( original for nonce used in tag property data-nonce='esi_block' )\n\t\t\t$params['_ls_silence'] = true;\n\t\t}\n\n\t\tif ($this->cls('REST')->is_rest() || $this->cls('REST')->is_internal_rest()) {\n\t\t\t$params['is_json'] = 1;\n\t\t}\n\n\t\t$params  = apply_filters('litespeed_esi_params', $params, $block_id);\n\t\t$control = apply_filters('litespeed_esi_control', $control, $block_id);\n\n\t\tif (!is_array($params) || !is_string($control)) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug(\"[ESI] 🛑 Sub hooks returned Params: \\n\" . var_export($params, true) . \"\\ncache control: \\n\" . var_export($control, true));\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Build params for URL\n\t\t$appended_params = array(\n\t\t\tself::QS_ACTION => $block_id,\n\t\t);\n\t\tif (!empty($control)) {\n\t\t\t$appended_params['_control'] = $control;\n\t\t}\n\t\tif ($params) {\n\t\t\t$appended_params[self::QS_PARAMS] = base64_encode(\\json_encode($params));\n\t\t\tDebug2::debug2('[ESI] param ', $params);\n\t\t}\n\n\t\t// Append hash\n\t\t$appended_params['_hash'] = $this->_gen_esi_md5($appended_params);\n\n\t\t/**\n\t\t * Escape potential chars\n\t\t *\n\t\t * @since 2.9.4\n\t\t */\n\t\t$appended_params = array_map('urlencode', $appended_params);\n\n\t\t// Generate ESI URL\n\t\t$url = add_query_arg($appended_params, trailingslashit(wp_make_link_relative(home_url())));\n\n\t\t$output = '';\n\t\tif ($inline_param) {\n\t\t\t$output .= self::_build_inline($url, $inline_param);\n\t\t}\n\n\t\t$output .= \"<esi:include src='$url'\";\n\t\tif (!empty($control)) {\n\t\t\t$control = esc_attr($control);\n\t\t\t$output .= \" cache-control='$control'\";\n\t\t}\n\t\tif ($svar) {\n\t\t\t$output .= \" as-var='1'\";\n\t\t}\n\t\tif (in_array($block_id, self::$_combine_ids)) {\n\t\t\t$output .= \" combine='sub'\";\n\t\t}\n\t\tif ($block_id == self::COMBO && isset($_SERVER['X-LSCACHE']) && strpos($_SERVER['X-LSCACHE'], 'combine') !== false) {\n\t\t\t$output .= \" combine='main'\";\n\t\t}\n\t\t$output .= ' />';\n\n\t\tif (!$silence) {\n\t\t\t$output = \"<!-- lscwp $wrapper -->$output<!-- lscwp $wrapper esi end -->\";\n\t\t}\n\n\t\tself::debug(\"💕  [BLock_ID] $block_id \\t[wrapper] $wrapper \\t\\t[Control] $control\");\n\t\tself::debug2($output);\n\n\t\tself::set_has_esi();\n\n\t\t// Convert to string to avoid html chars filter when using\n\t\t// Will reverse the buffer when output in self::finalize()\n\t\tif ($preserved) {\n\t\t\t$hash                            = md5($output);\n\t\t\t$this->_esi_preserve_list[$hash] = $output;\n\t\t\tself::debug(\"Preserved to $hash\");\n\n\t\t\treturn $hash;\n\t\t}\n\n\t\treturn $output;\n\t}\n\n\t/**\n\t * Generate ESI hash md5\n\t *\n\t * @since  2.9.6\n\t * @access private\n\t */\n\tprivate function _gen_esi_md5( $params ) {\n\t\t$keys = array( self::QS_ACTION, '_control', self::QS_PARAMS );\n\n\t\t$str = '';\n\t\tforeach ($keys as $v) {\n\t\t\tif (isset($params[$v]) && is_string($params[$v])) {\n\t\t\t\t$str .= $params[$v];\n\t\t\t}\n\t\t}\n\t\tDebug2::debug2('[ESI] md5_string=' . $str);\n\n\t\treturn md5($this->conf(Base::HASH) . $str);\n\t}\n\n\t/**\n\t * Parses the request parameters on an ESI request\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t */\n\tprivate function _parse_esi_param( $qs_params = false ) {\n\t\t$req_params = false;\n\t\tif ($qs_params) {\n\t\t\t$req_params = $qs_params;\n\t\t} elseif (isset($_REQUEST[self::QS_PARAMS])) {\n\t\t\t$req_params = $_REQUEST[self::QS_PARAMS];\n\t\t}\n\n\t\tif (!$req_params) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$unencrypted = base64_decode($req_params);\n\t\tif ($unencrypted === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug2('[ESI] params', $unencrypted);\n\t\t// $unencoded = urldecode($unencrypted); no need to do this as $_GET is already parsed\n\t\t$params = \\json_decode($unencrypted, true);\n\n\t\treturn $params;\n\t}\n\n\t/**\n\t * Select the correct esi output based on the parameters in an ESI request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function load_esi_block() {\n\t\t/**\n\t\t * Validate if is a legal ESI req\n\t\t *\n\t\t * @since 2.9.6\n\t\t */\n\t\tif (empty($_GET['_hash']) || $this->_gen_esi_md5($_GET) != $_GET['_hash']) {\n\t\t\tDebug2::debug('[ESI] ❌ Failed to validate _hash');\n\t\t\treturn;\n\t\t}\n\n\t\t$params = $this->_parse_esi_param();\n\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\t$logInfo = '[ESI] ⭕ ';\n\t\t\tif (!empty($params[self::PARAM_NAME])) {\n\t\t\t\t$logInfo .= ' Name: ' . $params[self::PARAM_NAME] . ' ----- ';\n\t\t\t}\n\t\t\t$logInfo .= ' [ID] ' . LSCACHE_IS_ESI;\n\t\t\tDebug2::debug($logInfo);\n\t\t}\n\n\t\tif (!empty($params['_ls_silence'])) {\n\t\t\t!defined('LSCACHE_ESI_SILENCE') && define('LSCACHE_ESI_SILENCE', true);\n\t\t}\n\n\t\t/**\n\t\t * Buffer needs to be JSON format\n\t\t *\n\t\t * @since  2.9.4\n\t\t */\n\t\tif (!empty($params['is_json'])) {\n\t\t\tadd_filter('litespeed_is_json', '__return_true');\n\t\t}\n\n\t\tTag::add(rtrim(Tag::TYPE_ESI, '.'));\n\t\tTag::add(Tag::TYPE_ESI . LSCACHE_IS_ESI);\n\n\t\t// Debug2::debug(var_export($params, true ));\n\n\t\t/**\n\t\t * Handle default cache control 'private,no-vary' for sub_esi_block()   @ticket #923505\n\t\t *\n\t\t * @since  2.2.3\n\t\t */\n\t\tif (!empty($_GET['_control'])) {\n\t\t\t$control = explode(',', $_GET['_control']);\n\t\t\tif (in_array('private', $control)) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\n\t\t\tif (in_array('no-vary', $control)) {\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\n\t\tdo_action('litespeed_esi_load-' . LSCACHE_IS_ESI, $params);\n\t}\n\n\t// The *_sub_* functions are helpers for the sub_* functions.\n\t// The *_load_* functions are helpers for the load_* functions.\n\n\t/**\n\t * Loads the default options for default WordPress widgets.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function widget_default_options( $options, $widget ) {\n\t\tif (!is_array($options)) {\n\t\t\treturn $options;\n\t\t}\n\n\t\t$widget_name = get_class($widget);\n\t\tswitch ($widget_name) {\n\t\t\tcase 'WP_Widget_Recent_Posts':\n\t\t\tcase 'WP_Widget_Recent_Comments':\n            $options[self::WIDGET_O_ESIENABLE] = Base::VAL_OFF;\n            $options[self::WIDGET_O_TTL]       = 86400;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn $options;\n\t}\n\n\t/**\n\t * Hooked to the widget_display_callback filter.\n\t * If the admin configured the widget to display via esi, this function\n\t * will set up the esi request and cancel the widget display.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param array      $instance Parameter used to build the widget.\n\t * @param \\WP_Widget $widget The widget to build.\n\t * @param array      $args Parameter used to build the widget.\n\t * @return mixed Return false if display through esi, instance otherwise.\n\t */\n\tpublic function sub_widget_block( $instance, $widget, $args ) {\n\t\t// #210407\n\t\tif (!is_array($instance)) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$name = get_class($widget);\n\t\tif (!isset($instance[Base::OPTION_NAME])) {\n\t\t\treturn $instance;\n\t\t}\n\t\t$options = $instance[Base::OPTION_NAME];\n\t\tif (!isset($options) || !$options[self::WIDGET_O_ESIENABLE]) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI 0 ' . $name . ': ' . (!isset($options) ? 'not set' : 'set off'));\n\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$esi_private = $options[self::WIDGET_O_ESIENABLE] == Base::VAL_ON2 ? 'private,' : '';\n\n\t\t$params = array(\n\t\t\tself::PARAM_NAME => $name,\n\t\t\tself::PARAM_ID => $widget->id,\n\t\t\tself::PARAM_INSTANCE => $instance,\n\t\t\tself::PARAM_ARGS => $args,\n\t\t);\n\n\t\techo $this->sub_esi_block('widget', 'widget ' . $name, $params, $esi_private . 'no-vary');\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Hooked to the wp_footer action.\n\t * Sets up the ESI request for the admin bar.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global type $wp_admin_bar\n\t */\n\tpublic function sub_admin_bar_block() {\n\t\tglobal $wp_admin_bar;\n\n\t\tif (!is_admin_bar_showing() || !is_object($wp_admin_bar)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// To make each admin bar ESI request different for `Edit` button different link\n\t\t$params = array(\n\t\t\t'ref' => $_SERVER['REQUEST_URI'],\n\t\t);\n\n\t\techo $this->sub_esi_block('admin-bar', 'adminbar', $params);\n\t}\n\n\t/**\n\t * Parses the esi input parameters and generates the widget for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global $wp_widget_factory\n\t * @param array $params Input parameters needed to correctly display widget\n\t */\n\tpublic function load_widget_block( $params ) {\n\t\t// global $wp_widget_factory;\n\t\t// $widget = $wp_widget_factory->widgets[ $params[ self::PARAM_NAME ] ];\n\t\t$option = $params[self::PARAM_INSTANCE];\n\t\t$option = $option[Base::OPTION_NAME];\n\n\t\t// Since we only reach here via esi, safe to assume setting exists.\n\t\t$ttl = $option[self::WIDGET_O_TTL];\n\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI widget render: name ' . $params[self::PARAM_NAME] . ', id ' . $params[self::PARAM_ID] . ', ttl ' . $ttl);\n\t\tif ($ttl == 0) {\n\t\t\tControl::set_nocache('ESI Widget time to live set to 0');\n\t\t} else {\n\t\t\tControl::set_custom_ttl($ttl);\n\n\t\t\tif ($option[self::WIDGET_O_ESIENABLE] == Base::VAL_ON2) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\t\t\tControl::set_no_vary();\n\t\t\tTag::add(Tag::TYPE_WIDGET . $params[self::PARAM_ID]);\n\t\t}\n\t\tthe_widget($params[self::PARAM_NAME], $params[self::PARAM_INSTANCE], $params[self::PARAM_ARGS]);\n\t}\n\n\t/**\n\t * Generates the admin bar for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic function load_admin_bar_block( $params ) {\n\t\tglobal $wp_the_query;\n\n\t\tif (!empty($params['ref'])) {\n\t\t\t$ref_qs = parse_url($params['ref'], PHP_URL_QUERY);\n\t\t\tif (!empty($ref_qs)) {\n\t\t\t\tparse_str($ref_qs, $ref_qs_arr);\n\n\t\t\t\tif (!empty($ref_qs_arr)) {\n\t\t\t\t\tforeach ($ref_qs_arr as $k => $v) {\n\t\t\t\t\t\t$_GET[$k] = $v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Needed when permalink structure is \"Plain\"\n\t\tif (!isset($wp_the_query)) {\n\t\t\twp();\n\t\t}\n\n\t\twp_admin_bar_render();\n\t\tif (!$this->conf(Base::O_ESI_CACHE_ADMBAR)) {\n\t\t\tControl::set_nocache('build-in set to not cacheable');\n\t\t} else {\n\t\t\tControl::set_private();\n\t\t\tControl::set_no_vary();\n\t\t}\n\n\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI: adminbar ref: ' . $_SERVER['REQUEST_URI']);\n\t}\n\n\t/**\n\t * Parses the esi input parameters and generates the comment form for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @param array $params Input parameters needed to correctly display comment form\n\t */\n\tpublic function load_comment_form_block( $params ) {\n\t\tcomment_form($params[self::PARAM_ARGS], $params[self::PARAM_ID]);\n\n\t\tif (!$this->conf(Base::O_ESI_CACHE_COMMFORM)) {\n\t\t\tControl::set_nocache('build-in set to not cacheable');\n\t\t} else {\n\t\t\t// by default comment form is public\n\t\t\tif (Vary::has_vary()) {\n\t\t\t\tControl::set_private();\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate nonce for certain action\n\t *\n\t * @access public\n\t * @since 2.6\n\t */\n\tpublic function load_nonce_block( $params ) {\n\t\t$action = $params['action'];\n\n\t\tDebug2::debug('[ESI] load_nonce_block [action] ' . $action);\n\n\t\t// set nonce TTL to half day\n\t\tControl::set_custom_ttl(43200);\n\n\t\tif (Router::is_logged_in()) {\n\t\t\tControl::set_private();\n\t\t}\n\n\t\tif (function_exists('wp_create_nonce_litespeed_esi')) {\n\t\t\techo wp_create_nonce_litespeed_esi($action);\n\t\t} else {\n\t\t\techo wp_create_nonce($action);\n\t\t}\n\t}\n\n\t/**\n\t * Show original shortcode\n\t *\n\t * @access public\n\t * @since 2.8\n\t */\n\tpublic function load_esi_shortcode( $params ) {\n\t\tif (isset($params['ttl'])) {\n\t\t\tif (!$params['ttl']) {\n\t\t\t\tControl::set_nocache('ESI shortcode att ttl=0');\n\t\t\t} else {\n\t\t\t\tControl::set_custom_ttl($params['ttl']);\n\t\t\t}\n\t\t\tunset($params['ttl']);\n\t\t}\n\n\t\t// Replace to original shortcode\n\t\t$shortcode = $params[0];\n\t\t$atts_ori  = array();\n\t\tforeach ($params as $k => $v) {\n\t\t\tif ($k === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$atts_ori[] = is_string($k) ? \"$k='\" . addslashes($v) . \"'\" : $v;\n\t\t}\n\n\t\tTag::add(Tag::TYPE_ESI . \"esi.$shortcode\");\n\n\t\t// Output original shortcode final content\n\t\techo do_shortcode(\"[$shortcode \" . implode(' ', $atts_ori) . ' ]');\n\t}\n\n\t/**\n\t * Hooked to the comment_form_defaults filter.\n\t * Stores the default comment form settings.\n\t * If sub_comment_form_block is triggered, the output buffer is cleared and an esi block is added. The remaining comment form is also buffered and cleared.\n\t * Else there is no need to make the comment form ESI.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function register_comment_form_actions( $defaults ) {\n\t\t$this->esi_args = $defaults;\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_filter('comment_form_submit_button', array( $this, 'sub_comment_form_btn' ), 1000, 2); // To save the params passed in\n\t\tadd_action('comment_form', array( $this, 'sub_comment_form_block' ), 1000);\n\t\treturn $defaults;\n\t}\n\n\t/**\n\t * Store the args passed in comment_form for the ESI comment param usage in `$this->sub_comment_form_block()`\n\t *\n\t * @since  3.4\n\t * @access public\n\t */\n\tpublic function sub_comment_form_btn( $unused, $args ) {\n\t\tif (empty($args) || empty($this->esi_args)) {\n\t\t\tDebug2::debug('comment form args empty?');\n\t\t\treturn $unused;\n\t\t}\n\t\t$esi_args = array();\n\n\t\t// compare current args with default ones\n\t\tforeach ($args as $k => $v) {\n\t\t\tif (!isset($this->esi_args[$k])) {\n\t\t\t\t$esi_args[$k] = $v;\n\t\t\t} elseif (is_array($v)) {\n\t\t\t\t$diff = array_diff_assoc($v, $this->esi_args[$k]);\n\t\t\t\tif (!empty($diff)) {\n\t\t\t\t\t$esi_args[$k] = $diff;\n\t\t\t\t}\n\t\t\t} elseif ($v !== $this->esi_args[$k]) {\n\t\t\t\t$esi_args[$k] = $v;\n\t\t\t}\n\t\t}\n\n\t\t$this->esi_args = $esi_args;\n\n\t\treturn $unused;\n\t}\n\n\t/**\n\t * Hooked to the comment_form_submit_button filter.\n\t *\n\t * This method will compare the used comment form args against the default args. The difference will be passed to the esi request.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic function sub_comment_form_block( $post_id ) {\n\t\techo GUI::clean_wrapper_end();\n\t\t$params = array(\n\t\t\tself::PARAM_ID => $post_id,\n\t\t\tself::PARAM_ARGS => $this->esi_args,\n\t\t);\n\n\t\techo $this->sub_esi_block('comment-form', 'comment form', $params);\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_action('comment_form_after', array( $this, 'comment_form_sub_clean' ));\n\t}\n\n\t/**\n\t * Hooked to the comment_form_after action.\n\t * Cleans up the remaining comment form output.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function comment_form_sub_clean() {\n\t\techo GUI::clean_wrapper_end();\n\t}\n\n\t/**\n\t * Replace preserved blocks\n\t *\n\t * @since  2.6\n\t * @access public\n\t */\n\tpublic function finalize( $buffer ) {\n\t\t// Prepend combo esi block\n\t\tif (self::$_combine_ids) {\n\t\t\tDebug2::debug('[ESI] 🍔 Enabled combo');\n\t\t\t$esi_block = $this->sub_esi_block(self::COMBO, '__COMBINE_MAIN__', array(), 'no-cache', true);\n\t\t\t$buffer    = $esi_block . $buffer;\n\t\t}\n\n\t\t// Bypass if no preserved list to be replaced\n\t\tif (!$this->_esi_preserve_list) {\n\t\t\treturn $buffer;\n\t\t}\n\n\t\t$keys = array_keys($this->_esi_preserve_list);\n\n\t\tDebug2::debug('[ESI] replacing preserved blocks', $keys);\n\n\t\t$buffer = str_replace($keys, $this->_esi_preserve_list, $buffer);\n\n\t\treturn $buffer;\n\t}\n\n\t/**\n\t * Check if the content contains preserved list or not\n\t *\n\t * @since  3.3\n\t */\n\tpublic function contain_preserve_esi( $content ) {\n\t\t$hit_list = array();\n\t\tforeach ($this->_esi_preserve_list as $k => $v) {\n\t\t\tif (strpos($content, '\"' . $k . '\"') !== false) {\n\t\t\t\t$hit_list[] = '\"' . $k . '\"';\n\t\t\t}\n\t\t\tif (strpos($content, \"'\" . $k . \"'\") !== false) {\n\t\t\t\t$hit_list[] = \"'\" . $k . \"'\";\n\t\t\t}\n\t\t}\n\t\treturn $hit_list;\n\t}\n}\n",
    "plugins/litespeed-cache/src/vary.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The plugin vary class to manage X-LiteSpeed-Vary\n *\n * @since       1.1.3\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Vary extends Root {\n\n\tconst LOG_TAG  = '🔱';\n\tconst X_HEADER = 'X-LiteSpeed-Vary';\n\n\tprivate static $_vary_name       = '_lscache_vary'; // this default vary cookie is used for logged in status check\n\tprivate static $_can_change_vary = false; // Currently only AJAX used this\n\n\t/**\n\t * Adds the actions used for setting up cookies on log in/out.\n\t *\n\t * Also checks if the database matches the rewrite rule.\n\t *\n\t * @since 1.0.4\n\t */\n\t// public function init()\n\t// {\n\t// $this->_update_vary_name();\n\t// }\n\n\t/**\n\t * Update the default vary name if changed\n\t *\n\t * @since  4.0\n\t * @since 7.0 Moved to after_user_init to allow ESI no-vary no conflict w/ LSCACHE_VARY_COOKIE/O_CACHE_LOGIN_COOKIE\n\t */\n\tprivate function _update_vary_name() {\n\t\t$db_cookie = $this->conf(Base::O_CACHE_LOGIN_COOKIE); // [3.0] todo: check if works in network's sites\n\t\t// If no vary set in rewrite rule\n\t\tif (!isset($_SERVER['LSCACHE_VARY_COOKIE'])) {\n\t\t\tif ($db_cookie) {\n\t\t\t\t// Check if is from ESI req or not. If from ESI no-vary, no need to set no-cache\n\t\t\t\t$something_wrong = true;\n\t\t\t\tif (!empty($_GET[ESI::QS_ACTION]) && !empty($_GET['_control'])) {\n\t\t\t\t\t// Have to manually build this checker bcoz ESI is not init yet.\n\t\t\t\t\t$control = explode(',', $_GET['_control']);\n\t\t\t\t\tif (in_array('no-vary', $control)) {\n\t\t\t\t\t\tself::debug('no-vary control existed, bypass vary_name update');\n\t\t\t\t\t\t$something_wrong  = false;\n\t\t\t\t\t\tself::$_vary_name = $db_cookie;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (defined('LITESPEED_CLI') || wp_doing_cron()) {\n\t\t\t\t\t$something_wrong = false;\n\t\t\t\t}\n\n\t\t\t\tif ($something_wrong) {\n\t\t\t\t\t// Display cookie error msg to admin\n\t\t\t\t\tif (is_multisite() ? is_network_admin() : is_admin()) {\n\t\t\t\t\t\tAdmin_Display::show_error_cookie();\n\t\t\t\t\t}\n\t\t\t\t\tControl::set_nocache('❌❌ vary cookie setting error');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t// If db setting does not exist, skip checking db value\n\t\tif (!$db_cookie) {\n\t\t\treturn;\n\t\t}\n\n\t\t// beyond this point, need to make sure db vary setting is in $_SERVER env.\n\t\t$vary_arr = explode(',', $_SERVER['LSCACHE_VARY_COOKIE']);\n\n\t\tif (in_array($db_cookie, $vary_arr)) {\n\t\t\tself::$_vary_name = $db_cookie;\n\t\t\treturn;\n\t\t}\n\n\t\tif (is_multisite() ? is_network_admin() : is_admin()) {\n\t\t\tAdmin_Display::show_error_cookie();\n\t\t}\n\t\tControl::set_nocache('vary cookie setting lost error');\n\t}\n\n\t/**\n\t * Hooks after user init\n\t *\n\t * @since  4.0\n\t */\n\tpublic function after_user_init() {\n\t\t$this->_update_vary_name();\n\n\t\t// logged in user\n\t\tif (Router::is_logged_in()) {\n\t\t\t// If not esi, check cache logged-in user setting\n\t\t\tif (!$this->cls('Router')->esi_enabled()) {\n\t\t\t\t// If cache logged-in, then init cacheable to private\n\t\t\t\tif ($this->conf(Base::O_CACHE_PRIV) && !is_admin()) {\n\t\t\t\t\tadd_action('wp_logout', __NAMESPACE__ . '\\Purge::purge_on_logout');\n\n\t\t\t\t\t$this->cls('Control')->init_cacheable();\n\t\t\t\t\tControl::set_private('logged in user');\n\t\t\t\t}\n\t\t\t\t// No cache for logged-in user\n\t\t\t\telse {\n\t\t\t\t\tControl::set_nocache('logged in user');\n\t\t\t\t}\n\t\t\t}\n\t\t\t// ESI is on, can be public cache\n\t\t\telseif (!is_admin()) {\n\t\t\t\t// Need to make sure vary is using group id\n\t\t\t\t$this->cls('Control')->init_cacheable();\n\t\t\t}\n\n\t\t\t// register logout hook to clear login status\n\t\t\tadd_action('clear_auth_cookie', array( $this, 'remove_logged_in' ));\n\t\t} else {\n\t\t\t// Only after vary init, can detect if is Guest mode or not\n\t\t\t// Here need `self::$_vary_name` to be set first.\n\t\t\t$this->_maybe_guest_mode();\n\n\t\t\t// Set vary cookie for logging in user, otherwise the user will hit public with vary=0 (guest version)\n\t\t\tadd_action('set_logged_in_cookie', array( $this, 'add_logged_in' ), 10, 4);\n\t\t\tadd_action('wp_login', __NAMESPACE__ . '\\Purge::purge_on_logout');\n\n\t\t\t$this->cls('Control')->init_cacheable();\n\n\t\t\t// Check `login page` cacheable setting because they don't go through main WP logic\n\t\t\tadd_action('login_init', array( $this->cls('Tag'), 'check_login_cacheable' ), 5);\n\n\t\t\tif (!empty($_GET['litespeed_guest'])) {\n\t\t\t\tadd_action('wp_loaded', array( $this, 'update_guest_vary' ), 20);\n\t\t\t}\n\t\t}\n\n\t\t// Add comment list ESI\n\t\tadd_filter('comments_array', array( $this, 'check_commenter' ));\n\n\t\t// Set vary cookie for commenter.\n\t\tadd_action('set_comment_cookies', array( $this, 'append_commenter' ));\n\n\t\t/**\n\t\t * Don't change for REST call because they don't carry on user info usually\n\t\t *\n\t\t * @since 1.6.7\n\t\t */\n\t\tadd_action('rest_api_init', function () {\n\t\t\t// this hook is fired in `init` hook\n\t\t\tself::debug('Rest API init disabled vary change');\n\t\t\tadd_filter('litespeed_can_change_vary', '__return_false');\n\t\t});\n\t}\n\n\t/**\n\t * Check if is Guest mode or not\n\t *\n\t * @since  4.0\n\t */\n\tprivate function _maybe_guest_mode() {\n\t\tif (defined('LITESPEED_GUEST')) {\n\t\t\tself::debug('👒👒 Guest mode ' . (LITESPEED_GUEST ? 'predefined' : 'turned off'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$this->conf(Base::O_GUEST)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If vary is set, then not a guest\n\t\tif (self::has_vary()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If has admin QS, then no guest\n\t\tif (!empty($_GET[Router::ACTION])) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (wp_doing_ajax()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (wp_doing_cron()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If is the request to update vary, then no guest\n\t\t// Don't need anymore as it is always ajax call\n\t\t// Still keep it in case some WP blocked the lightweight guest vary update script, WP can still update the vary\n\t\tif (!empty($_GET['litespeed_guest'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t/* @ref https://wordpress.org/support/topic/checkout-add-to-cart-executed-twice/ */\n\t\tif (!empty($_GET['litespeed_guest_off'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('👒👒 Guest mode');\n\n\t\t!defined('LITESPEED_GUEST') && define('LITESPEED_GUEST', true);\n\n\t\tif ($this->conf(Base::O_GUEST_OPTM)) {\n\t\t\t!defined('LITESPEED_GUEST_OPTM') && define('LITESPEED_GUEST_OPTM', true);\n\t\t}\n\t}\n\n\t/**\n\t * Update Guest vary\n\t *\n\t * @since  4.0\n\t * @deprecated 4.1 Use independent lightweight guest.vary.php as a replacement\n\t */\n\tpublic function update_guest_vary() {\n\t\t// This process must not be cached\n\t\t!defined('LSCACHE_NO_CACHE') && define('LSCACHE_NO_CACHE', true);\n\n\t\t$_guest = new Lib\\Guest();\n\t\tif ($_guest->always_guest() || self::has_vary()) {\n\t\t\t// If contains vary already, don't reload to avoid infinite loop when parent page having browser cache\n\t\t\t!defined('LITESPEED_GUEST') && define('LITESPEED_GUEST', true); // Reuse this const to bypass set vary in vary finalize\n\t\t\tself::debug('🤠🤠 Guest');\n\t\t\techo '[]';\n\t\t\texit();\n\t\t}\n\n\t\tself::debug('Will update guest vary in finalize');\n\n\t\t// return json\n\t\techo \\json_encode(array( 'reload' => 'yes' ));\n\t\texit();\n\t}\n\n\t/**\n\t * Hooked to the comments_array filter.\n\t *\n\t * Check if the user accessing the page has the commenter cookie.\n\t *\n\t * If the user does not want to cache commenters, just check if user is commenter.\n\t * Otherwise if the vary cookie is set, unset it. This is so that when the page is cached, the page will appear as if the user was a normal user.\n\t * Normal user is defined as not a logged in user and not a commenter.\n\t *\n\t * @since 1.0.4\n\t * @access public\n\t * @global type $post\n\t * @param array $comments The current comments to output\n\t * @return array The comments to output.\n\t */\n\tpublic function check_commenter( $comments ) {\n\t\t/**\n\t\t * Hook to bypass pending comment check for comment related plugins compatibility\n\t\t *\n\t\t * @since 2.9.5\n\t\t */\n\t\tif (apply_filters('litespeed_vary_check_commenter_pending', true)) {\n\t\t\t$pending = false;\n\t\t\tforeach ($comments as $comment) {\n\t\t\t\tif (!$comment->comment_approved) {\n\t\t\t\t\t// current user has pending comment\n\t\t\t\t\t$pending = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No pending comments, don't need to add private cache\n\t\t\tif (!$pending) {\n\t\t\t\tself::debug('No pending comment');\n\t\t\t\t$this->remove_commenter();\n\n\t\t\t\t// Remove commenter prefilled info if exists, for public cache\n\t\t\t\tforeach ($_COOKIE as $cookie_name => $cookie_value) {\n\t\t\t\t\tif (strlen($cookie_name) >= 15 && strpos($cookie_name, 'comment_author_') === 0) {\n\t\t\t\t\t\tunset($_COOKIE[$cookie_name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn $comments;\n\t\t\t}\n\t\t}\n\n\t\t// Current user/visitor has pending comments\n\t\t// set vary=2 for next time vary lookup\n\t\t$this->add_commenter();\n\n\t\tif ($this->conf(Base::O_CACHE_COMMENTER)) {\n\t\t\tControl::set_private('existing commenter');\n\t\t} else {\n\t\t\tControl::set_nocache('existing commenter');\n\t\t}\n\n\t\treturn $comments;\n\t}\n\n\t/**\n\t * Check if default vary has a value\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function has_vary() {\n\t\tif (empty($_COOKIE[self::$_vary_name])) {\n\t\t\treturn false;\n\t\t}\n\t\treturn $_COOKIE[self::$_vary_name];\n\t}\n\n\t/**\n\t * Append user status with logged in\n\t *\n\t * @since 1.1.3\n\t * @since 1.6.2 Removed static referral\n\t * @access public\n\t */\n\tpublic function add_logged_in( $logged_in_cookie = false, $expire = false, $expiration = false, $uid = false ) {\n\t\tself::debug('add_logged_in');\n\n\t\t/**\n\t\t * NOTE: Run before `$this->_update_default_vary()` to make vary changeable\n\t\t *\n\t\t * @since  2.2.2\n\t\t */\n\t\tself::can_ajax_vary();\n\n\t\t// If the cookie is lost somehow, set it\n\t\t$this->_update_default_vary($uid, $expire);\n\t}\n\n\t/**\n\t * Remove user logged in status\n\t *\n\t * @since 1.1.3\n\t * @since 1.6.2 Removed static referral\n\t * @access public\n\t */\n\tpublic function remove_logged_in() {\n\t\tself::debug('remove_logged_in');\n\n\t\t/**\n\t\t * NOTE: Run before `$this->_update_default_vary()` to make vary changeable\n\t\t *\n\t\t * @since  2.2.2\n\t\t */\n\t\tself::can_ajax_vary();\n\n\t\t// Force update vary to remove login status\n\t\t$this->_update_default_vary(-1);\n\t}\n\n\t/**\n\t * Allow vary can be changed for ajax calls\n\t *\n\t * @since 2.2.2\n\t * @since 2.6 Changed to static\n\t * @access public\n\t */\n\tpublic static function can_ajax_vary() {\n\t\tself::debug('_can_change_vary -> true');\n\t\tself::$_can_change_vary = true;\n\t}\n\n\t/**\n\t * Check if can change default vary\n\t *\n\t * @since 1.6.2\n\t * @access private\n\t */\n\tprivate function can_change_vary() {\n\t\t// Don't change for ajax due to ajax not sending webp header\n\t\tif (Router::is_ajax()) {\n\t\t\tif (!self::$_can_change_vary) {\n\t\t\t\tself::debug('can_change_vary bypassed due to ajax call');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * POST request can set vary to fix #820789 login \"loop\" guest cache issue\n\t\t *\n\t\t * @since 1.6.5\n\t\t */\n\t\tif (isset($_SERVER['REQUEST_METHOD']) && $_SERVER['REQUEST_METHOD'] !== 'GET' && $_SERVER['REQUEST_METHOD'] !== 'POST') {\n\t\t\tself::debug('can_change_vary bypassed due to method not get/post');\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Disable vary change if is from crawler\n\t\t *\n\t\t * @since  2.9.8 To enable woocommerce cart not empty warm up (@Taba)\n\t\t */\n\t\tif (!empty($_SERVER['HTTP_USER_AGENT']) && strpos($_SERVER['HTTP_USER_AGENT'], Crawler::FAST_USER_AGENT) === 0) {\n\t\t\tself::debug('can_change_vary bypassed due to crawler');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!apply_filters('litespeed_can_change_vary', true)) {\n\t\t\tself::debug('can_change_vary bypassed due to litespeed_can_change_vary hook');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Update default vary\n\t *\n\t * @since 1.6.2\n\t * @since  1.6.6.1 Add ran check to make it only run once ( No run multiple times due to login process doesn't have valid uid )\n\t * @access private\n\t */\n\tprivate function _update_default_vary( $uid = false, $expire = false ) {\n\t\t// Make sure header output only run once\n\t\tif (!defined('LITESPEED_DID_' . __FUNCTION__)) {\n\t\t\tdefine('LITESPEED_DID_' . __FUNCTION__, true);\n\t\t} else {\n\t\t\tself::debug2('_update_default_vary bypassed due to run already');\n\t\t\treturn;\n\t\t}\n\n\t\t// ESI shouldn't change vary (Let main page do only)\n\t\tif (defined('LSCACHE_IS_ESI') && LSCACHE_IS_ESI) {\n\t\t\tself::debug2('_update_default_vary bypassed due to ESI');\n\t\t\treturn;\n\t\t}\n\n\t\t// If the cookie is lost somehow, set it\n\t\t$vary         = $this->finalize_default_vary($uid);\n\t\t$current_vary = self::has_vary();\n\t\tif ($current_vary !== $vary && $current_vary !== 'commenter' && $this->can_change_vary()) {\n\t\t\t// $_COOKIE[ self::$_vary_name ] = $vary; // not needed\n\n\t\t\t// save it\n\t\t\tif (!$expire) {\n\t\t\t\t$expire = time() + 2 * DAY_IN_SECONDS;\n\t\t\t}\n\t\t\t$this->_cookie($vary, $expire);\n\t\t\t// Control::set_nocache( 'changing default vary' . \" $current_vary => $vary\" );\n\t\t}\n\t}\n\n\t/**\n\t * Get vary name\n\t *\n\t * @since 1.9.1\n\t * @access public\n\t */\n\tpublic function get_vary_name() {\n\t\treturn self::$_vary_name;\n\t}\n\n\t/**\n\t * Check if one user role is in vary group settings\n\t *\n\t * @since 1.2.0\n\t * @since  3.0 Moved here from conf.cls\n\t * @access public\n\t * @param  string $role The user role\n\t * @return int       The set value if already set\n\t */\n\tpublic function in_vary_group( $role ) {\n\t\t$group       = 0;\n\t\t$vary_groups = $this->conf(Base::O_CACHE_VARY_GROUP);\n\n\t\t$roles = explode(',', $role);\n\t\tif ($found = array_intersect($roles, array_keys($vary_groups))) {\n\t\t\t$groups = array();\n\t\t\tforeach ($found as $curr_role) {\n\t\t\t\t$groups[] = $vary_groups[$curr_role];\n\t\t\t}\n\t\t\t$group = implode(',', array_unique($groups));\n\t\t} elseif (in_array('administrator', $roles)) {\n\t\t\t$group = 99;\n\t\t}\n\n\t\tif ($group) {\n\t\t\tself::debug2('role in vary_group [group] ' . $group);\n\t\t}\n\n\t\treturn $group;\n\t}\n\n\t/**\n\t * Finalize default Vary Cookie\n\t *\n\t *  Get user vary tag based on admin_bar & role\n\t *\n\t * NOTE: Login process will also call this because it does not call wp hook as normal page loading\n\t *\n\t * @since 1.6.2\n\t * @access public\n\t */\n\tpublic function finalize_default_vary( $uid = false ) {\n\t\t// Must check this to bypass vary generation for guests\n\t\t// Must check this to avoid Guest page's CSS/JS/CCSS/UCSS get non-guest vary filename\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$vary = array();\n\n\t\tif ($this->conf(Base::O_GUEST)) {\n\t\t\t$vary['guest_mode'] = 1;\n\t\t}\n\n\t\tif (!$uid) {\n\t\t\t$uid = get_current_user_id();\n\t\t} else {\n\t\t\tself::debug('uid: ' . $uid);\n\t\t}\n\n\t\t// get user's group id\n\t\t$role = Router::get_role($uid);\n\n\t\tif ($uid > 0 && $role) {\n\t\t\t$vary['logged-in'] = 1;\n\n\t\t\t// parse role group from settings\n\t\t\tif ($role_group = $this->in_vary_group($role)) {\n\t\t\t\t$vary['role'] = $role_group;\n\t\t\t}\n\n\t\t\t// Get admin bar set\n\t\t\t// see @_get_admin_bar_pref()\n\t\t\t$pref = get_user_option('show_admin_bar_front', $uid);\n\t\t\tself::debug2('show_admin_bar_front: ' . $pref);\n\t\t\t$admin_bar = $pref === false || $pref === 'true';\n\n\t\t\tif ($admin_bar) {\n\t\t\t\t$vary['admin_bar'] = 1;\n\t\t\t\tself::debug2('admin bar : true');\n\t\t\t}\n\t\t} else {\n\t\t\t// Guest user\n\t\t\tself::debug('role id: failed, guest');\n\t\t}\n\n\t\t/**\n\t\t * Add filter\n\t\t *\n\t\t * @since 1.6 Added for Role Excludes for optimization cls\n\t\t * @since 1.6.2 Hooked to webp (checked in v4, no webp anymore)\n\t\t * @since 3.0 Used by 3rd hooks too\n\t\t */\n\t\t$vary = apply_filters('litespeed_vary', $vary);\n\n\t\tif (!$vary) {\n\t\t\treturn false;\n\t\t}\n\n\t\tksort($vary);\n\t\t$res = array();\n\t\tforeach ($vary as $key => $val) {\n\t\t\t$res[] = $key . ':' . $val;\n\t\t}\n\n\t\t$res = implode(';', $res);\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\treturn $res;\n\t\t}\n\t\t// Encrypt in production\n\t\treturn md5($this->conf(Base::HASH) . $res);\n\t}\n\n\t/**\n\t * Get the hash of all vary related values\n\t *\n\t * @since  4.0\n\t */\n\tpublic function finalize_full_varies() {\n\t\t$vary  = $this->_finalize_curr_vary_cookies(true);\n\t\t$vary .= $this->finalize_default_vary(get_current_user_id());\n\t\t$vary .= $this->get_env_vary();\n\t\treturn $vary;\n\t}\n\n\t/**\n\t * Get request environment Vary\n\t *\n\t * @since  4.0\n\t */\n\tpublic function get_env_vary() {\n\t\t$env_vary = isset($_SERVER['LSCACHE_VARY_VALUE']) ? $_SERVER['LSCACHE_VARY_VALUE'] : false;\n\t\tif (!$env_vary) {\n\t\t\t$env_vary = isset($_SERVER['HTTP_X_LSCACHE_VARY_VALUE']) ? $_SERVER['HTTP_X_LSCACHE_VARY_VALUE'] : false;\n\t\t}\n\t\treturn $env_vary;\n\t}\n\n\t/**\n\t * Append user status with commenter\n\t *\n\t * This is ONLY used when submit a comment\n\t *\n\t * @since 1.1.6\n\t * @access public\n\t */\n\tpublic function append_commenter() {\n\t\t$this->add_commenter(true);\n\t}\n\n\t/**\n\t * Correct user status with commenter\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param  boolean $from_redirect If the request is from redirect page or not\n\t */\n\tprivate function add_commenter( $from_redirect = false ) {\n\t\t// If the cookie is lost somehow, set it\n\t\tif (self::has_vary() !== 'commenter') {\n\t\t\tself::debug('Add commenter');\n\t\t\t// $_COOKIE[ self::$_vary_name ] = 'commenter'; // not needed\n\n\t\t\t// save it\n\t\t\t// only set commenter status for current domain path\n\t\t\t$this->_cookie('commenter', time() + apply_filters('comment_cookie_lifetime', 30000000), self::_relative_path($from_redirect));\n\t\t\t// Control::set_nocache( 'adding commenter status' );\n\t\t}\n\t}\n\n\t/**\n\t * Remove user commenter status\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t */\n\tprivate function remove_commenter() {\n\t\tif (self::has_vary() === 'commenter') {\n\t\t\tself::debug('Remove commenter');\n\t\t\t// remove logged in status from global var\n\t\t\t// unset( $_COOKIE[ self::$_vary_name ] ); // not needed\n\n\t\t\t// save it\n\t\t\t$this->_cookie(false, false, self::_relative_path());\n\t\t\t// Control::set_nocache( 'removing commenter status' );\n\t\t}\n\t}\n\n\t/**\n\t * Generate relative path for cookie\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param  boolean $from_redirect If the request is from redirect page or not\n\t */\n\tprivate static function _relative_path( $from_redirect = false ) {\n\t\t$path = false;\n\t\t$tag  = $from_redirect ? 'HTTP_REFERER' : 'SCRIPT_URL';\n\t\tif (!empty($_SERVER[$tag])) {\n\t\t\t$path = parse_url($_SERVER[$tag]);\n\t\t\t$path = !empty($path['path']) ? $path['path'] : false;\n\t\t\tself::debug('Cookie Vary path: ' . $path);\n\t\t}\n\t\treturn $path;\n\t}\n\n\t/**\n\t * Builds the vary header.\n\t *\n\t * NOTE: Non caccheable page can still set vary ( for logged in process )\n\t *\n\t * Currently, this only checks post passwords and 3rd party.\n\t *\n\t * @since 1.0.13\n\t * @access public\n\t * @global $post\n\t * @return mixed false if the user has the postpass cookie. Empty string if the post is not password protected. Vary header otherwise.\n\t */\n\tpublic function finalize() {\n\t\t// Finalize default vary\n\t\tif (!defined('LITESPEED_GUEST') || !LITESPEED_GUEST) {\n\t\t\t$this->_update_default_vary();\n\t\t}\n\n\t\t$tp_cookies = $this->_finalize_curr_vary_cookies();\n\n\t\tif (!$tp_cookies) {\n\t\t\tself::debug2('no custimzed vary');\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('finalized 3rd party cookies', $tp_cookies);\n\n\t\treturn self::X_HEADER . ': ' . implode(',', $tp_cookies);\n\t}\n\n\t/**\n\t * Gets vary cookies or their values unique hash that are already added for the current page.\n\t *\n\t * @since 1.0.13\n\t * @access private\n\t * @return array List of all vary cookies currently added.\n\t */\n\tprivate function _finalize_curr_vary_cookies( $values_json = false ) {\n\t\tglobal $post;\n\n\t\t$cookies = array(); // No need to append default vary cookie name\n\n\t\tif (!empty($post->post_password)) {\n\t\t\t$postpass_key = 'wp-postpass_' . COOKIEHASH;\n\t\t\tif ($this->_get_cookie_val($postpass_key)) {\n\t\t\t\tself::debug('finalize bypassed due to password protected vary ');\n\t\t\t\t// If user has password cookie, do not cache & ignore existing vary cookies\n\t\t\t\tControl::set_nocache('password protected vary');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$cookies[] = $values_json ? $this->_get_cookie_val($postpass_key) : $postpass_key;\n\t\t}\n\n\t\t$cookies = apply_filters('litespeed_vary_curr_cookies', $cookies);\n\t\tif ($cookies) {\n\t\t\t$cookies = array_filter(array_unique($cookies));\n\t\t\tself::debug('vary cookies changed by filter litespeed_vary_curr_cookies', $cookies);\n\t\t}\n\n\t\tif (!$cookies) {\n\t\t\treturn false;\n\t\t}\n\t\t// Format cookie name data or value data\n\t\tsort($cookies); // This is to maintain the cookie val orders for $values_json=true case.\n\t\tforeach ($cookies as $k => $v) {\n\t\t\t$cookies[$k] = $values_json ? $this->_get_cookie_val($v) : 'cookie=' . $v;\n\t\t}\n\n\t\treturn $values_json ? \\json_encode($cookies) : $cookies;\n\t}\n\n\t/**\n\t * Get one vary cookie value\n\t *\n\t * @since  4.0\n\t */\n\tprivate function _get_cookie_val( $key ) {\n\t\tif (!empty($_COOKIE[$key])) {\n\t\t\treturn $_COOKIE[$key];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Set the vary cookie.\n\t *\n\t * If vary cookie changed, must set non cacheable.\n\t *\n\t * @since 1.0.4\n\t * @access private\n\t * @param int|false $val    The value to update.\n\t * @param int       $expire Expire time.\n\t * @param bool      $path   False if use wp root path as cookie path\n\t */\n\tprivate function _cookie( $val = false, $expire = 0, $path = false ) {\n\t\tif (!$val) {\n\t\t\t$expire = 1;\n\t\t}\n\n\t\t/**\n\t\t * Add HTTPS bypass in case clients use both HTTP and HTTPS version of site\n\t\t *\n\t\t * @since 1.7\n\t\t */\n\t\t$is_ssl = $this->conf(Base::O_UTIL_NO_HTTPS_VARY) ? false : is_ssl();\n\n\t\tsetcookie(self::$_vary_name, $val, $expire, $path ?: COOKIEPATH, COOKIE_DOMAIN, $is_ssl, true);\n\t\tself::debug('set_cookie ---> [k] ' . self::$_vary_name . \" [v] $val [ttl] \" . ($expire - time()));\n\t}\n}\n",
    "plugins/litespeed-cache/src/placeholder.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The PlaceHolder class\n *\n * @since       3.0\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Placeholder extends Base {\n\n\tconst TYPE_GENERATE = 'generate';\n\tconst TYPE_CLEAR_Q  = 'clear_q';\n\n\tprivate $_conf_placeholder_resp;\n\tprivate $_conf_placeholder_resp_svg;\n\tprivate $_conf_lqip;\n\tprivate $_conf_lqip_qual;\n\tprivate $_conf_lqip_min_w;\n\tprivate $_conf_lqip_min_h;\n\tprivate $_conf_placeholder_resp_color;\n\tprivate $_conf_placeholder_resp_async;\n\tprivate $_conf_ph_default;\n\tprivate $_placeholder_resp_dict = array();\n\tprivate $_ph_queue              = array();\n\n\tprotected $_summary;\n\n\t/**\n\t * Init\n\t *\n\t * @since  3.0\n\t */\n\tpublic function __construct() {\n\t\t$this->_conf_placeholder_resp       = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_MEDIA_PLACEHOLDER_RESP);\n\t\t$this->_conf_placeholder_resp_svg   = $this->conf(self::O_MEDIA_PLACEHOLDER_RESP_SVG);\n\t\t$this->_conf_lqip                   = !defined('LITESPEED_GUEST_OPTM') && $this->conf(self::O_MEDIA_LQIP);\n\t\t$this->_conf_lqip_qual              = $this->conf(self::O_MEDIA_LQIP_QUAL);\n\t\t$this->_conf_lqip_min_w             = $this->conf(self::O_MEDIA_LQIP_MIN_W);\n\t\t$this->_conf_lqip_min_h             = $this->conf(self::O_MEDIA_LQIP_MIN_H);\n\t\t$this->_conf_placeholder_resp_async = $this->conf(self::O_MEDIA_PLACEHOLDER_RESP_ASYNC);\n\t\t$this->_conf_placeholder_resp_color = $this->conf(self::O_MEDIA_PLACEHOLDER_RESP_COLOR);\n\t\t$this->_conf_ph_default             = $this->conf(self::O_MEDIA_LAZY_PLACEHOLDER) ?: LITESPEED_PLACEHOLDER;\n\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t/**\n\t * Init Placeholder\n\t */\n\tpublic function init() {\n\t\tDebug2::debug2('[LQIP] init');\n\n\t\tadd_action('litespeed_after_admin_init', array( $this, 'after_admin_init' ));\n\t}\n\n\t/**\n\t * Display column in Media\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function after_admin_init() {\n\t\tif ($this->_conf_lqip) {\n\t\t\tadd_filter('manage_media_columns', array( $this, 'media_row_title' ));\n\t\t\tadd_filter('manage_media_custom_column', array( $this, 'media_row_actions' ), 10, 2);\n\t\t\tadd_action('litespeed_media_row_lqip', array( $this, 'media_row_con' ));\n\t\t}\n\t}\n\n\t/**\n\t * Media Admin Menu -> LQIP col\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic function media_row_title( $posts_columns ) {\n\t\t$posts_columns['lqip'] = __('LQIP', 'litespeed-cache');\n\n\t\treturn $posts_columns;\n\t}\n\n\t/**\n\t * Media Admin Menu -> LQIP Column\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic function media_row_actions( $column_name, $post_id ) {\n\t\tif ($column_name !== 'lqip') {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_media_row_lqip', $post_id);\n\t}\n\n\t/**\n\t * Display LQIP column\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function media_row_con( $post_id ) {\n\t\t$meta_value = wp_get_attachment_metadata($post_id);\n\n\t\tif (empty($meta_value['file'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$total_files = 0;\n\n\t\t// List all sizes\n\t\t$all_sizes = array( $meta_value['file'] );\n\t\t$size_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\tforeach ($meta_value['sizes'] as $v) {\n\t\t\t$all_sizes[] = $size_path . $v['file'];\n\t\t}\n\n\t\tforeach ($all_sizes as $short_path) {\n\t\t\t$lqip_folder = LITESPEED_STATIC_DIR . '/lqip/' . $short_path;\n\n\t\t\tif (is_dir($lqip_folder)) {\n\t\t\t\tDebug2::debug('[LQIP] Found folder: ' . $short_path);\n\n\t\t\t\t// List all files\n\t\t\t\tforeach (scandir($lqip_folder) as $v) {\n\t\t\t\t\tif ($v == '.' || $v == '..') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($total_files == 0) {\n\t\t\t\t\t\techo '<div class=\"litespeed-media-lqip\"><img src=\"' .\n\t\t\t\t\t\t\tStr::trim_quotes(File::read($lqip_folder . '/' . $v)) .\n\t\t\t\t\t\t\t'\" alt=\"' .\n\t\t\t\t\t\t\tsprintf(__('LQIP image preview for size %s', 'litespeed-cache'), $v) .\n\t\t\t\t\t\t\t'\"></div>';\n\t\t\t\t\t}\n\n\t\t\t\t\techo '<div class=\"litespeed-media-size\"><a href=\"' . Str::trim_quotes(File::read($lqip_folder . '/' . $v)) . '\" target=\"_blank\">' . $v . '</a></div>';\n\n\t\t\t\t\t++$total_files;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ($total_files == 0) {\n\t\t\techo '—';\n\t\t}\n\t}\n\n\t/**\n\t * Replace image with placeholder\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function replace( $html, $src, $size ) {\n\t\t// Check if need to enable responsive placeholder or not\n\t\t$this_placeholder = $this->_placeholder($src, $size) ?: $this->_conf_ph_default;\n\n\t\t$additional_attr = '';\n\t\tif ($this->_conf_lqip && $this_placeholder != $this->_conf_ph_default) {\n\t\t\tDebug2::debug2('[LQIP] Use resp LQIP [size] ' . $size);\n\t\t\t$additional_attr = ' data-placeholder-resp=\"' . Str::trim_quotes($size) . '\"';\n\t\t}\n\n\t\t$snippet = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_NOSCRIPT_RM) ? '' : '<noscript>' . $html . '</noscript>';\n\t\t$html    = str_replace(array( ' src=', ' srcset=', ' sizes=' ), array( ' data-src=', ' data-srcset=', ' data-sizes=' ), $html);\n\t\t$html    = str_replace('<img ', '<img data-lazyloaded=\"1\"' . $additional_attr . ' src=\"' . Str::trim_quotes($this_placeholder) . '\" ', $html);\n\t\t$snippet = $html . $snippet;\n\n\t\treturn $snippet;\n\t}\n\n\t/**\n\t * Generate responsive placeholder\n\t *\n\t * @since  2.5.1\n\t * @access private\n\t */\n\tprivate function _placeholder( $src, $size ) {\n\t\t// Low Quality Image Placeholders\n\t\tif (!$size) {\n\t\t\tDebug2::debug2('[LQIP] no size ' . $src);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$this->_conf_placeholder_resp) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If use local generator\n\t\tif (!$this->_conf_lqip || !$this->_lqip_size_check($size)) {\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\tDebug2::debug2('[LQIP] Resp LQIP process [src] ' . $src . ' [size] ' . $size);\n\n\t\t$arr_key = $size . ' ' . $src;\n\n\t\t// Check if its already in dict or not\n\t\tif (!empty($this->_placeholder_resp_dict[$arr_key])) {\n\t\t\tDebug2::debug2('[LQIP] already in dict');\n\n\t\t\treturn $this->_placeholder_resp_dict[$arr_key];\n\t\t}\n\n\t\t// Need to generate the responsive placeholder\n\t\t$placeholder_realpath = $this->_placeholder_realpath($src, $size); // todo: give offload API\n\t\tif (file_exists($placeholder_realpath)) {\n\t\t\tDebug2::debug2('[LQIP] file exists');\n\t\t\t$this->_placeholder_resp_dict[$arr_key] = File::read($placeholder_realpath);\n\n\t\t\treturn $this->_placeholder_resp_dict[$arr_key];\n\t\t}\n\n\t\t// Add to cron queue\n\n\t\t// Prevent repeated requests\n\t\tif (in_array($arr_key, $this->_ph_queue)) {\n\t\t\tDebug2::debug2('[LQIP] file bypass generating due to in queue');\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\tif ($hit = Utility::str_hit_array($src, $this->conf(self::O_MEDIA_LQIP_EXC))) {\n\t\t\tDebug2::debug2('[LQIP] file bypass generating due to exclude setting [hit] ' . $hit);\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\t$this->_ph_queue[] = $arr_key;\n\n\t\t// Send request to generate placeholder\n\t\tif (!$this->_conf_placeholder_resp_async) {\n\t\t\t// If requested recently, bypass\n\t\t\tif ($this->_summary && !empty($this->_summary['curr_request']) && time() - $this->_summary['curr_request'] < 300) {\n\t\t\t\tDebug2::debug2('[LQIP] file bypass generating due to interval limit');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Generate immediately\n\t\t\t$this->_placeholder_resp_dict[$arr_key] = $this->_generate_placeholder($arr_key);\n\n\t\t\treturn $this->_placeholder_resp_dict[$arr_key];\n\t\t}\n\n\t\t// Prepare default svg placeholder as tmp placeholder\n\t\t$tmp_placeholder = $this->_generate_placeholder_locally($size);\n\n\t\t// Store it to prepare for cron\n\t\t$queue = $this->load_queue('lqip');\n\t\tif (in_array($arr_key, $queue)) {\n\t\t\tDebug2::debug2('[LQIP] already in queue');\n\n\t\t\treturn $tmp_placeholder;\n\t\t}\n\n\t\tif (count($queue) > 500) {\n\t\t\tDebug2::debug2('[LQIP] queue is full');\n\n\t\t\treturn $tmp_placeholder;\n\t\t}\n\n\t\t$queue[] = $arr_key;\n\t\t$this->save_queue('lqip', $queue);\n\t\tDebug2::debug('[LQIP] Added placeholder queue');\n\n\t\treturn $tmp_placeholder;\n\t}\n\n\t/**\n\t * Generate realpath of placeholder file\n\t *\n\t * @since  2.5.1\n\t * @access private\n\t */\n\tprivate function _placeholder_realpath( $src, $size ) {\n\t\t// Use LQIP Cloud generator, each image placeholder will be separately stored\n\n\t\t// Compatibility with WebP and AVIF\n\t\t$src = Utility::drop_webp($src);\n\n\t\t$filepath_prefix = $this->_build_filepath_prefix('lqip');\n\n\t\t// External images will use cache folder directly\n\t\t$domain = parse_url($src, PHP_URL_HOST);\n\t\tif ($domain && !Utility::internal($domain)) {\n\t\t\t// todo: need to improve `util:internal()` to include `CDN::internal()`\n\t\t\t$md5 = md5($src);\n\n\t\t\treturn LITESPEED_STATIC_DIR . $filepath_prefix . 'remote/' . substr($md5, 0, 1) . '/' . substr($md5, 1, 1) . '/' . $md5 . '.' . $size;\n\t\t}\n\n\t\t// Drop domain\n\t\t$short_path = Utility::att_short_path($src);\n\n\t\treturn LITESPEED_STATIC_DIR . $filepath_prefix . $short_path . '/' . $size;\n\t}\n\n\t/**\n\t * Cron placeholder generation\n\t *\n\t * @since  2.5.1\n\t * @access public\n\t */\n\tpublic static function cron( $continue = false ) {\n\t\t$_instance = self::cls();\n\n\t\t$queue = $_instance->load_queue('lqip');\n\n\t\tif (empty($queue)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For cron, need to check request interval too\n\t\tif (!$continue) {\n\t\t\tif (!empty($_instance->_summary['curr_request']) && time() - $_instance->_summary['curr_request'] < 300) {\n\t\t\t\tDebug2::debug('[LQIP] Last request not done');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tforeach ($queue as $v) {\n\t\t\tDebug2::debug('[LQIP] cron job [size] ' . $v);\n\n\t\t\t$res = $_instance->_generate_placeholder($v, true);\n\n\t\t\t// Exit queue if out of quota\n\t\t\tif ($res === 'out_of_quota') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// only request first one\n\t\t\tif (!$continue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate placeholder locally\n\t *\n\t * @since  3.0\n\t * @access private\n\t */\n\tprivate function _generate_placeholder_locally( $size ) {\n\t\tDebug2::debug2('[LQIP] _generate_placeholder local [size] ' . $size);\n\n\t\t$size = explode('x', $size);\n\n\t\t$svg = str_replace(array( '{width}', '{height}', '{color}' ), array( $size[0], $size[1], $this->_conf_placeholder_resp_color ), $this->_conf_placeholder_resp_svg);\n\n\t\treturn 'data:image/svg+xml;base64,' . base64_encode($svg);\n\t}\n\n\t/**\n\t * Send to LiteSpeed API to generate placeholder\n\t *\n\t * @since  2.5.1\n\t * @access private\n\t */\n\tprivate function _generate_placeholder( $raw_size_and_src, $from_cron = false ) {\n\t\t// Parse containing size and src info\n\t\t$size_and_src = explode(' ', $raw_size_and_src, 2);\n\t\t$size         = $size_and_src[0];\n\n\t\tif (empty($size_and_src[1])) {\n\t\t\t$this->_popup_and_save($raw_size_and_src);\n\t\t\tDebug2::debug('[LQIP] ❌ No src [raw] ' . $raw_size_and_src);\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\t$src = $size_and_src[1];\n\n\t\t$file = $this->_placeholder_realpath($src, $size);\n\n\t\t// Local generate SVG to serve ( Repeatedly doing this here to remove stored cron queue in case the setting _conf_lqip is changed )\n\t\tif (!$this->_conf_lqip || !$this->_lqip_size_check($size)) {\n\t\t\t$data = $this->_generate_placeholder_locally($size);\n\t\t} else {\n\t\t\t$err       = false;\n\t\t\t$allowance = Cloud::cls()->allowance(Cloud::SVC_LQIP, $err);\n\t\t\tif (!$allowance) {\n\t\t\t\tDebug2::debug('[LQIP] ❌ No credit: ' . $err);\n\t\t\t\t$err && Admin_Display::error(Error::msg($err));\n\n\t\t\t\tif ($from_cron) {\n\t\t\t\t\treturn 'out_of_quota';\n\t\t\t\t}\n\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\t// Generate LQIP\n\t\t\tlist($width, $height) = explode('x', $size);\n\t\t\t$req_data             = array(\n\t\t\t\t'width' => $width,\n\t\t\t\t'height' => $height,\n\t\t\t\t'url' => Utility::drop_webp($src),\n\t\t\t\t'quality' => $this->_conf_lqip_qual,\n\t\t\t);\n\n\t\t\t// CHeck if the image is 404 first\n\t\t\tif (File::is_404($req_data['url'])) {\n\t\t\t\t$this->_popup_and_save($raw_size_and_src, true);\n\t\t\t\t$this->_append_exc($src);\n\t\t\t\tDebug2::debug('[LQIP] 404 before request [src] ' . $req_data['url']);\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\t// Update request status\n\t\t\t$this->_summary['curr_request'] = time();\n\t\t\tself::save_summary();\n\n\t\t\t$json = Cloud::post(Cloud::SVC_LQIP, $req_data, 120);\n\t\t\tif (!is_array($json)) {\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\tif (empty($json['lqip']) || strpos($json['lqip'], 'data:image/svg+xml') !== 0) {\n\t\t\t\t// image error, pop up the current queue\n\t\t\t\t$this->_popup_and_save($raw_size_and_src, true);\n\t\t\t\t$this->_append_exc($src);\n\t\t\t\tDebug2::debug('[LQIP] wrong response format', $json);\n\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\t$data = $json['lqip'];\n\n\t\t\tDebug2::debug('[LQIP] _generate_placeholder LQIP');\n\t\t}\n\n\t\t// Write to file\n\t\tFile::save($file, $data, true);\n\n\t\t// Save summary data\n\t\t$this->_summary['last_spent']   = time() - $this->_summary['curr_request'];\n\t\t$this->_summary['last_request'] = $this->_summary['curr_request'];\n\t\t$this->_summary['curr_request'] = 0;\n\t\tself::save_summary();\n\t\t$this->_popup_and_save($raw_size_and_src);\n\n\t\tDebug2::debug('[LQIP] saved LQIP ' . $file);\n\n\t\treturn $data;\n\t}\n\n\t/**\n\t * Check if the size is valid to send LQIP request or not\n\t *\n\t * @since  3.0\n\t */\n\tprivate function _lqip_size_check( $size ) {\n\t\t$size = explode('x', $size);\n\t\tif ($size[0] >= $this->_conf_lqip_min_w || $size[1] >= $this->_conf_lqip_min_h) {\n\t\t\treturn true;\n\t\t}\n\n\t\tDebug2::debug2('[LQIP] Size too small');\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Add to LQIP exclude list\n\t *\n\t * @since  3.4\n\t */\n\tprivate function _append_exc( $src ) {\n\t\t$val   = $this->conf(self::O_MEDIA_LQIP_EXC);\n\t\t$val[] = $src;\n\t\t$this->cls('Conf')->update(self::O_MEDIA_LQIP_EXC, $val);\n\t\tDebug2::debug('[LQIP] Appended to LQIP Excludes [URL] ' . $src);\n\t}\n\n\t/**\n\t * Pop up the current request and save\n\t *\n\t * @since  3.0\n\t */\n\tprivate function _popup_and_save( $raw_size_and_src, $append_to_exc = false ) {\n\t\t$queue = $this->load_queue('lqip');\n\t\tif (!empty($queue) && in_array($raw_size_and_src, $queue)) {\n\t\t\tunset($queue[array_search($raw_size_and_src, $queue)]);\n\t\t}\n\n\t\tif ($append_to_exc) {\n\t\t\t$size_and_src = explode(' ', $raw_size_and_src, 2);\n\t\t\t$this_src     = $size_and_src[1];\n\n\t\t\t// Append to lqip exc setting first\n\t\t\t$this->_append_exc($this_src);\n\n\t\t\t// Check if other queues contain this src or not\n\t\t\tif ($queue) {\n\t\t\t\tforeach ($queue as $k => $raw_size_and_src) {\n\t\t\t\t\t$size_and_src = explode(' ', $raw_size_and_src, 2);\n\t\t\t\t\tif (empty($size_and_src[1])) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($size_and_src[1] == $this_src) {\n\t\t\t\t\t\tunset($queue[$k]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t$this->save_queue('lqip', $queue);\n\t}\n\n\t/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  2.5.1\n\t * @access public\n\t */\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_GENERATE:\n            self::cron(true);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CLEAR_Q:\n            $this->clear_q('lqip');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n",
    "plugins/litespeed-cache/src/img-optm.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The class to optimize image.\n *\n * @since       2.0\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\nuse WpOrg\\Requests\\Autoload;\nuse WpOrg\\Requests\\Requests;\n\ndefined('WPINC') || exit();\n\nclass Img_Optm extends Base {\n\n\tconst LOG_TAG = '🗜️';\n\n\tconst CLOUD_ACTION_NEW_REQ         = 'new_req';\n\tconst CLOUD_ACTION_TAKEN           = 'taken';\n\tconst CLOUD_ACTION_REQUEST_DESTROY = 'imgoptm_destroy';\n\tconst CLOUD_ACTION_CLEAN           = 'clean';\n\n\tconst TYPE_NEW_REQ           = 'new_req';\n\tconst TYPE_RESCAN            = 'rescan';\n\tconst TYPE_DESTROY           = 'destroy';\n\tconst TYPE_RESET_COUNTER     = 'reset_counter';\n\tconst TYPE_CLEAN             = 'clean';\n\tconst TYPE_PULL              = 'pull';\n\tconst TYPE_BATCH_SWITCH_ORI  = 'batch_switch_ori';\n\tconst TYPE_BATCH_SWITCH_OPTM = 'batch_switch_optm';\n\tconst TYPE_CALC_BKUP         = 'calc_bkup';\n\tconst TYPE_RESET_ROW         = 'reset_row';\n\tconst TYPE_RM_BKUP           = 'rm_bkup';\n\n\tconst STATUS_NEW        = 0; // 'new';\n\tconst STATUS_RAW        = 1; // 'raw';\n\tconst STATUS_REQUESTED  = 3; // 'requested';\n\tconst STATUS_NOTIFIED   = 6; // 'notified';\n\tconst STATUS_DUPLICATED = 8; // 'duplicated';\n\tconst STATUS_PULLED     = 9; // 'pulled';\n\tconst STATUS_FAILED     = -1; // 'failed';\n\tconst STATUS_MISS       = -3; // 'miss';\n\tconst STATUS_ERR_FETCH  = -5; // 'err_fetch';\n\tconst STATUS_ERR_404    = -6; // 'err_404';\n\tconst STATUS_ERR_OPTM   = -7; // 'err_optm';\n\tconst STATUS_XMETA      = -8; // 'xmeta';\n\tconst STATUS_ERR        = -9; // 'err';\n\tconst DB_SIZE           = 'litespeed-optimize-size';\n\tconst DB_SET            = 'litespeed-optimize-set';\n\n\tconst DB_NEED_PULL = 'need_pull';\n\n\tprivate $wp_upload_dir;\n\tprivate $tmp_pid;\n\tprivate $tmp_type;\n\tprivate $tmp_path;\n\tprivate $_img_in_queue     = array();\n\tprivate $_existed_src_list = array();\n\tprivate $_pids_set         = array();\n\tprivate $_thumbnail_set    = '';\n\tprivate $_table_img_optm;\n\tprivate $_table_img_optming;\n\tprivate $_cron_ran = false;\n\n\tprivate $__media;\n\tprivate $__data;\n\tprotected $_summary;\n\tprivate $_format = '';\n\n\t/**\n\t * Init\n\t *\n\t * @since  2.0\n\t */\n\tpublic function __construct() {\n\t\tDebug2::debug2('[ImgOptm] init');\n\n\t\t$this->wp_upload_dir      = wp_upload_dir();\n\t\t$this->__media            = $this->cls('Media');\n\t\t$this->__data             = $this->cls('Data');\n\t\t$this->_table_img_optm    = $this->__data->tb('img_optm');\n\t\t$this->_table_img_optming = $this->__data->tb('img_optming');\n\n\t\t$this->_summary = self::get_summary();\n\t\tif (empty($this->_summary['next_post_id'])) {\n\t\t\t$this->_summary['next_post_id'] = 0;\n\t\t}\n\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP)) {\n\t\t\t$this->_format = 'webp';\n\t\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP) == 2) {\n\t\t\t\t$this->_format = 'avif';\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Gather images auto when update attachment meta\n\t * This is to optimize new uploaded images first. Stored in img_optm table.\n\t * Later normal process will auto remove these records when trying to optimize these images again\n\t *\n\t * @since  4.0\n\t */\n\tpublic function wp_update_attachment_metadata( $meta_value, $post_id ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug2('🖌️ Auto update attachment meta [id] ' . $post_id);\n\t\tif (empty($meta_value['file'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Load gathered images\n\t\tif (!$this->_existed_src_list) {\n\t\t\t// To aavoid extra query when recalling this function\n\t\t\tself::debug('SELECT src from img_optm table');\n\t\t\tif ($this->__data->tb_exist('img_optm')) {\n\t\t\t\t$q    = \"SELECT src FROM `$this->_table_img_optm` WHERE post_id = %d\";\n\t\t\t\t$list = $wpdb->get_results($wpdb->prepare($q, $post_id));\n\t\t\t\tforeach ($list as $v) {\n\t\t\t\t\t$this->_existed_src_list[] = $post_id . '.' . $v->src;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($this->__data->tb_exist('img_optming')) {\n\t\t\t\t$q    = \"SELECT src FROM `$this->_table_img_optming` WHERE post_id = %d\";\n\t\t\t\t$list = $wpdb->get_results($wpdb->prepare($q, $post_id));\n\t\t\t\tforeach ($list as $v) {\n\t\t\t\t\t$this->_existed_src_list[] = $post_id . '.' . $v->src;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$this->__data->tb_create('img_optming');\n\t\t\t}\n\t\t}\n\n\t\t// Prepare images\n\t\t$this->tmp_pid  = $post_id;\n\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t$this->_append_img_queue($meta_value, true);\n\t\tif (!empty($meta_value['sizes'])) {\n\t\t\tarray_map(array( $this, '_append_img_queue' ), $meta_value['sizes']);\n\t\t}\n\n\t\tif (!$this->_img_in_queue) {\n\t\t\tself::debug('auto update attachment meta 2 bypass: empty _img_in_queue');\n\t\t\treturn;\n\t\t}\n\n\t\t// Save to DB\n\t\t$this->_save_raw();\n\n\t\t// $this->_send_request();\n\t}\n\n\t/**\n\t * Auto send optm request\n\t *\n\t * @since  2.4.1\n\t * @access public\n\t */\n\tpublic static function cron_auto_request() {\n\t\tif (!wp_doing_cron()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$instance = self::cls();\n\t\t$instance->new_req();\n\t}\n\n\t/**\n\t * Calculate wet run allowance\n\t *\n\t * @since 3.0\n\t */\n\tpublic function wet_limit() {\n\t\t$wet_limit = 1;\n\t\tif (!empty($this->_summary['img_taken'])) {\n\t\t\t$wet_limit = pow($this->_summary['img_taken'], 2);\n\t\t}\n\n\t\tif ($wet_limit == 1 && !empty($this->_summary['img_status.' . self::STATUS_ERR_OPTM])) {\n\t\t\t$wet_limit = pow($this->_summary['img_status.' . self::STATUS_ERR_OPTM], 2);\n\t\t}\n\n\t\tif ($wet_limit < Cloud::IMG_OPTM_DEFAULT_GROUP) {\n\t\t\treturn $wet_limit;\n\t\t}\n\n\t\t// No limit\n\t\treturn false;\n\t}\n\n\t/**\n\t * Push raw img to image optm server\n\t *\n\t * @since 1.6\n\t * @access public\n\t */\n\tpublic function new_req() {\n\t\tglobal $wpdb;\n\n\t\t// check if is running\n\t\tif (!empty($this->_summary['is_running']) && time() - $this->_summary['is_running'] < apply_filters('litespeed_imgoptm_new_req_interval', 3600)) {\n\t\t\tself::debug('The previous req was in 3600s.');\n\t\t\treturn;\n\t\t}\n\t\t$this->_summary['is_running'] = time();\n\t\tself::save_summary();\n\n\t\t// Check if has credit to push\n\t\t$err       = false;\n\t\t$allowance = Cloud::cls()->allowance(Cloud::SVC_IMG_OPTM, $err);\n\n\t\t$wet_limit = $this->wet_limit();\n\n\t\tself::debug(\"allowance_max $allowance wet_limit $wet_limit\");\n\t\tif ($wet_limit && $wet_limit < $allowance) {\n\t\t\t$allowance = $wet_limit;\n\t\t}\n\n\t\tif (!$allowance) {\n\t\t\tself::debug('❌ No credit');\n\t\t\tAdmin_Display::error(Error::msg($err));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('preparing images to push');\n\n\t\t$this->__data->tb_create('img_optming');\n\n\t\t$q               = \"SELECT COUNT(1) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t$q               = $wpdb->prepare($q, array( self::STATUS_REQUESTED ));\n\t\t$total_requested = $wpdb->get_var($q);\n\t\t$max_requested   = $allowance * 1;\n\n\t\tif ($total_requested > $max_requested) {\n\t\t\tself::debug('❌ Too many queued images (' . $total_requested . ' > ' . $max_requested . ')');\n\t\t\tAdmin_Display::error(Error::msg('too_many_requested'));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\t$allowance -= $total_requested;\n\n\t\tif ($allowance < 1) {\n\t\t\tself::debug('❌ Too many requested images ' . $total_requested);\n\t\t\tAdmin_Display::error(Error::msg('too_many_requested'));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\t// Limit maximum number of items waiting to be pulled\n\t\t$q              = \"SELECT COUNT(1) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t$q              = $wpdb->prepare($q, array( self::STATUS_NOTIFIED ));\n\t\t$total_notified = $wpdb->get_var($q);\n\t\tif ($total_notified > 0) {\n\t\t\tself::debug('❌ Too many notified images (' . $total_notified . ')');\n\t\t\tAdmin_Display::error(Error::msg('too_many_notified'));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\t$q         = \"SELECT COUNT(1) FROM `$this->_table_img_optming` WHERE optm_status IN (%d, %d)\";\n\t\t$q         = $wpdb->prepare($q, array( self::STATUS_NEW, self::STATUS_RAW ));\n\t\t$total_new = $wpdb->get_var($q);\n\t\t// $allowance -= $total_new;\n\n\t\t// May need to get more images\n\t\t$list = array();\n\t\t$more = $allowance - $total_new;\n\t\tif ($more > 0) {\n\t\t\t$q    = \"SELECT b.post_id, b.meta_value\n\t\t\t\tFROM `$wpdb->posts` a\n\t\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\t\tAND a.ID>%d\n\t\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\t\tORDER BY a.ID\n\t\t\t\tLIMIT %d\n\t\t\t\t\";\n\t\t\t$q    = $wpdb->prepare($q, array( $this->_summary['next_post_id'], $more ));\n\t\t\t$list = $wpdb->get_results($q);\n\t\t\tforeach ($list as $v) {\n\t\t\t\tif (!$v->post_id) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$this->_summary['next_post_id'] = $v->post_id;\n\n\t\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\t\tif (!$meta_value) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$meta_value['file'] = wp_normalize_path($meta_value['file']);\n\t\t\t\t$basedir            = $this->wp_upload_dir['basedir'] . '/';\n\t\t\t\tif (strpos($meta_value['file'], $basedir) === 0) {\n\t\t\t\t\t$meta_value['file'] = substr($meta_value['file'], strlen($basedir));\n\t\t\t\t}\n\n\t\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t\t$this->_append_img_queue($meta_value, true);\n\t\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\t\tarray_map(array( $this, '_append_img_queue' ), $meta_value['sizes']);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself::save_summary();\n\n\t\t\t$num_a = count($this->_img_in_queue);\n\t\t\tself::debug('Images found: ' . $num_a);\n\t\t\t$this->_filter_duplicated_src();\n\t\t\tself::debug('Images after duplicated: ' . count($this->_img_in_queue));\n\t\t\t$this->_filter_invalid_src();\n\t\t\tself::debug('Images after invalid: ' . count($this->_img_in_queue));\n\t\t\t// Check w/ legacy imgoptm table, bypass finished images\n\t\t\t$this->_filter_legacy_src();\n\n\t\t\t$num_b = count($this->_img_in_queue);\n\t\t\tif ($num_b != $num_a) {\n\t\t\t\tself::debug('Images after filtered duplicated/invalid/legacy src: ' . $num_b);\n\t\t\t}\n\n\t\t\t// Save to DB\n\t\t\t$this->_save_raw();\n\t\t}\n\n\t\t// Push to Cloud server\n\t\t$accepted_imgs = $this->_send_request($allowance);\n\n\t\t$this->_finished_running();\n\t\tif (!$accepted_imgs) {\n\t\t\treturn;\n\t\t}\n\n\t\t$placeholder1 = Admin_Display::print_plural($accepted_imgs[0], 'image');\n\t\t$placeholder2 = Admin_Display::print_plural($accepted_imgs[1], 'image');\n\t\t$msg          = sprintf(__('Pushed %1$s to Cloud server, accepted %2$s.', 'litespeed-cache'), $placeholder1, $placeholder2);\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Set running to done\n\t */\n\tprivate function _finished_running() {\n\t\t$this->_summary['is_running'] = 0;\n\t\tself::save_summary();\n\t}\n\n\t/**\n\t * Add a new img to queue which will be pushed to request\n\t *\n\t * @since 1.6\n\t * @access private\n\t */\n\tprivate function _append_img_queue( $meta_value, $is_ori_file = false ) {\n\t\tif (empty($meta_value['file']) || empty($meta_value['width']) || empty($meta_value['height'])) {\n\t\t\tself::debug2('bypass image due to lack of file/w/h: pid ' . $this->tmp_pid, $meta_value);\n\t\t\treturn;\n\t\t}\n\n\t\t$short_file_path = $meta_value['file'];\n\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t// Check if src is gathered already or not\n\t\tif (in_array($this->tmp_pid . '.' . $short_file_path, $this->_existed_src_list)) {\n\t\t\t// Debug2::debug2( '[Img_Optm] bypass image due to gathered: pid ' . $this->tmp_pid . ' ' . $short_file_path );\n\t\t\treturn;\n\t\t} else {\n\t\t\t// Append handled images\n\t\t\t$this->_existed_src_list[] = $this->tmp_pid . '.' . $short_file_path;\n\t\t}\n\n\t\t// check file exists or not\n\t\t$_img_info = $this->__media->info($short_file_path, $this->tmp_pid);\n\n\t\t$extension = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\tif (!$_img_info || !in_array($extension, array( 'jpg', 'jpeg', 'png', 'gif' ))) {\n\t\t\tself::debug2('bypass image due to file not exist: pid ' . $this->tmp_pid . ' ' . $short_file_path);\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if optimized file exists or not\n\t\t$target_needed = false;\n\t\tif ($this->_format) {\n\t\t\t$target_file_path = $short_file_path . '.' . $this->_format;\n\t\t\tif (!$this->__media->info($target_file_path, $this->tmp_pid)) {\n\t\t\t\t$target_needed = true;\n\t\t\t}\n\t\t}\n\t\tif ($this->conf(self::O_IMG_OPTM_ORI)) {\n\t\t\t$target_file_path = substr($short_file_path, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\tif (!$this->__media->info($target_file_path, $this->tmp_pid)) {\n\t\t\t\t$target_needed = true;\n\t\t\t}\n\t\t}\n\t\tif (!$target_needed) {\n\t\t\tself::debug2('bypass image due to optimized file exists: pid ' . $this->tmp_pid . ' ' . $short_file_path);\n\t\t\treturn;\n\t\t}\n\n\t\t// Debug2::debug2( '[Img_Optm] adding image: pid ' . $this->tmp_pid );\n\n\t\t$this->_img_in_queue[] = array(\n\t\t\t'pid' => $this->tmp_pid,\n\t\t\t'md5' => $_img_info['md5'],\n\t\t\t'url' => $_img_info['url'],\n\t\t\t'src' => $short_file_path, // not needed in LiteSpeed IAPI, just leave for local storage after post\n\t\t\t'mime_type' => !empty($meta_value['mime-type']) ? $meta_value['mime-type'] : '',\n\t\t);\n\t}\n\n\t/**\n\t * Save gathered image raw data\n\t *\n\t * @since  3.0\n\t */\n\tprivate function _save_raw() {\n\t\tif (empty($this->_img_in_queue)) {\n\t\t\treturn;\n\t\t}\n\t\t$data     = array();\n\t\t$pid_list = array();\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\t$_img_info = $this->__media->info($v['src'], $v['pid']);\n\n\t\t\t// attachment doesn't exist, delete the record\n\t\t\tif (empty($_img_info['url']) || empty($_img_info['md5'])) {\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$pid_list[] = (int) $v['pid'];\n\n\t\t\t$data[] = $v['pid'];\n\t\t\t$data[] = self::STATUS_RAW;\n\t\t\t$data[] = $v['src'];\n\t\t}\n\n\t\tglobal $wpdb;\n\t\t$fields = 'post_id, optm_status, src';\n\t\t$q      = \"INSERT INTO `$this->_table_img_optming` ( $fields ) VALUES \";\n\n\t\t// Add placeholder\n\t\t$q .= Utility::chunk_placeholder($data, $fields);\n\n\t\t// Store data\n\t\t$wpdb->query($wpdb->prepare($q, $data));\n\n\t\t$count = count($this->_img_in_queue);\n\t\tself::debug('Added raw images [total] ' . $count);\n\n\t\t$this->_img_in_queue = array();\n\n\t\t// Save thumbnail groups for future rescan index\n\t\t$this->_gen_thumbnail_set();\n\n\t\t$pid_list = array_unique($pid_list);\n\t\tself::debug('pid list to append to postmeta', $pid_list);\n\t\t$pid_list        = array_diff($pid_list, $this->_pids_set);\n\t\t$this->_pids_set = array_merge($this->_pids_set, $pid_list);\n\n\t\t$existed_meta = $wpdb->get_results(\"SELECT * FROM `$wpdb->postmeta` WHERE post_id IN ('\" . implode(\"','\", $pid_list) . \"') AND meta_key='\" . self::DB_SET . \"'\");\n\t\t$existed_pid  = array();\n\t\tif ($existed_meta) {\n\t\t\tforeach ($existed_meta as $v) {\n\t\t\t\t$existed_pid[] = $v->post_id;\n\t\t\t}\n\t\t\tself::debug('pid list to update postmeta', $existed_pid);\n\t\t\t$wpdb->query(\n\t\t\t\t$wpdb->prepare(\"UPDATE `$wpdb->postmeta` SET meta_value=%s WHERE post_id IN ('\" . implode(\"','\", $existed_pid) . \"') AND meta_key=%s\", array(\n\t\t\t\t\t$this->_thumbnail_set,\n\t\t\t\t\tself::DB_SET,\n\t\t\t\t))\n\t\t\t);\n\t\t}\n\n\t\t// Add new meta\n\t\t$new_pids = $existed_pid ? array_diff($pid_list, $existed_pid) : $pid_list;\n\t\tif ($new_pids) {\n\t\t\tself::debug('pid list to update postmeta', $new_pids);\n\t\t\tforeach ($new_pids as $v) {\n\t\t\t\tself::debug('New group set info [pid] ' . $v);\n\t\t\t\t$q = \"INSERT INTO `$wpdb->postmeta` (post_id, meta_key, meta_value) VALUES (%d, %s, %s)\";\n\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $v, self::DB_SET, $this->_thumbnail_set )));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate thumbnail sets of current image group\n\t *\n\t * @since 5.4\n\t */\n\tprivate function _gen_thumbnail_set() {\n\t\tif ($this->_thumbnail_set) {\n\t\t\treturn;\n\t\t}\n\t\t$set = array();\n\t\tforeach (Media::cls()->get_image_sizes() as $size) {\n\t\t\t$curr_size = $size['width'] . 'x' . $size['height'];\n\t\t\tif (in_array($curr_size, $set)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$set[] = $curr_size;\n\t\t}\n\t\t$this->_thumbnail_set = implode(PHP_EOL, $set);\n\t}\n\n\t/**\n\t * Filter duplicated src in work table and $this->_img_in_queue, then mark them as duplicated\n\t *\n\t * @since 2.0\n\t * @access private\n\t */\n\tprivate function _filter_duplicated_src() {\n\t\tglobal $wpdb;\n\n\t\t$srcpath_list = array();\n\n\t\t$list = $wpdb->get_results(\"SELECT src FROM `$this->_table_img_optming`\");\n\t\tforeach ($list as $v) {\n\t\t\t$srcpath_list[] = $v->src;\n\t\t}\n\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\tif (in_array($v['src'], $srcpath_list)) {\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$srcpath_list[] = $v['src'];\n\t\t}\n\t}\n\n\t/**\n\t * Filter legacy finished ones\n\t *\n\t * @since 5.4\n\t */\n\tprivate function _filter_legacy_src() {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->__data->tb_exist('img_optm')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$this->_img_in_queue) {\n\t\t\treturn;\n\t\t}\n\n\t\t$finished_ids = array();\n\n\t\tUtility::compatibility();\n\t\t$post_ids = array_unique(array_column($this->_img_in_queue, 'pid'));\n\t\t$list     = $wpdb->get_results(\"SELECT post_id FROM `$this->_table_img_optm` WHERE post_id in (\" . implode(',', $post_ids) . ') GROUP BY post_id');\n\t\tforeach ($list as $v) {\n\t\t\t$finished_ids[] = $v->post_id;\n\t\t}\n\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\tif (in_array($v['pid'], $finished_ids)) {\n\t\t\t\tself::debug('Legacy image optimized [pid] ' . $v['pid']);\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// Drop all existing legacy records\n\t\t$wpdb->query(\"DELETE FROM `$this->_table_img_optm` WHERE post_id in (\" . implode(',', $post_ids) . ')');\n\t}\n\n\t/**\n\t * Filter the invalid src before sending\n\t *\n\t * @since 3.0.8.3\n\t * @access private\n\t */\n\tprivate function _filter_invalid_src() {\n\t\t$img_in_queue_invalid = array();\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\tif ($v['src']) {\n\t\t\t\t$extension = pathinfo($v['src'], PATHINFO_EXTENSION);\n\t\t\t}\n\t\t\tif (!$v['src'] || empty($extension) || !in_array($extension, array( 'jpg', 'jpeg', 'png', 'gif' ))) {\n\t\t\t\t$img_in_queue_invalid[] = $v['id'];\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tif (!$img_in_queue_invalid) {\n\t\t\treturn;\n\t\t}\n\n\t\t$count = count($img_in_queue_invalid);\n\t\t$msg   = sprintf(__('Cleared %1$s invalid images.', 'litespeed-cache'), $count);\n\t\tAdmin_Display::success($msg);\n\n\t\tself::debug('Found invalid src [total] ' . $count);\n\t}\n\n\t/**\n\t * Push img request to Cloud server\n\t *\n\t * @since 1.6.7\n\t * @access private\n\t */\n\tprivate function _send_request( $allowance ) {\n\t\tglobal $wpdb;\n\n\t\t$q             = \"SELECT id, src, post_id FROM `$this->_table_img_optming` WHERE optm_status=%d LIMIT %d\";\n\t\t$q             = $wpdb->prepare($q, array( self::STATUS_RAW, $allowance ));\n\t\t$_img_in_queue = $wpdb->get_results($q);\n\t\tif (!$_img_in_queue) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Load img in queue [total] ' . count($_img_in_queue));\n\n\t\t$list = array();\n\t\tforeach ($_img_in_queue as $v) {\n\t\t\t$_img_info = $this->__media->info($v->src, $v->post_id);\n\t\t\t// If record is invalid, remove from img_optming table\n\t\t\tif (empty($_img_info['url']) || empty($_img_info['md5'])) {\n\t\t\t\t$wpdb->query($wpdb->prepare(\"DELETE FROM `$this->_table_img_optming` WHERE id=%d\", $v->id));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$img = array(\n\t\t\t\t'id' => $v->id,\n\t\t\t\t'url' => $_img_info['url'],\n\t\t\t\t'md5' => $_img_info['md5'],\n\t\t\t);\n\t\t\t// Build the needed image types for request as we now support soft reset counter\n\t\t\tif ($this->_format) {\n\t\t\t\t$target_file_path = $v->src . '.' . $this->_format;\n\t\t\t\tif ($this->__media->info($target_file_path, $v->post_id)) {\n\t\t\t\t\t$img['optm_' . $this->_format] = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($this->conf(self::O_IMG_OPTM_ORI)) {\n\t\t\t\t$extension        = pathinfo($v->src, PATHINFO_EXTENSION);\n\t\t\t\t$target_file_path = substr($v->src, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\t\tif ($this->__media->info($target_file_path, $v->post_id)) {\n\t\t\t\t\t$img['optm_ori'] = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$list[] = $img;\n\t\t}\n\n\t\tif (!$list) {\n\t\t\t$msg = __('No valid image found in the current request.', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn;\n\t\t}\n\n\t\t$data = array(\n\t\t\t'action' => self::CLOUD_ACTION_NEW_REQ,\n\t\t\t'list' => \\json_encode($list),\n\t\t\t'optm_ori' => $this->conf(self::O_IMG_OPTM_ORI) ? 1 : 0,\n\t\t\t'optm_lossless' => $this->conf(self::O_IMG_OPTM_LOSSLESS) ? 1 : 0,\n\t\t\t'keep_exif' => $this->conf(self::O_IMG_OPTM_EXIF) ? 1 : 0,\n\t\t);\n\t\tif ($this->_format) {\n\t\t\t$data['optm_' . $this->_format] = 1;\n\t\t}\n\n\t\t// Push to Cloud server\n\t\t$json = Cloud::post(Cloud::SVC_IMG_OPTM, $data);\n\t\tif (!$json) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check data format\n\t\tif (empty($json['ids'])) {\n\t\t\tself::debug('Failed to parse response data from Cloud server ', $json);\n\t\t\t$msg = __('No valid image found by Cloud server in the current request.', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Returned data from Cloud server count: ' . count($json['ids']));\n\n\t\t$ids = implode(',', array_map('intval', $json['ids']));\n\t\t// Update img table\n\t\t$q = \"UPDATE `$this->_table_img_optming` SET optm_status = '\" . self::STATUS_REQUESTED . \"' WHERE id IN ( $ids )\";\n\t\t$wpdb->query($q);\n\n\t\t$this->_summary['last_requested'] = time();\n\t\tself::save_summary();\n\n\t\treturn array( count($list), count($json['ids']) );\n\t}\n\n\t/**\n\t * Cloud server notify Client img status changed\n\t *\n\t * @access public\n\t */\n\tpublic function notify_img() {\n\t\t// Interval validation to avoid hacking domain_key\n\t\tif (!empty($this->_summary['notify_ts_err']) && time() - $this->_summary['notify_ts_err'] < 3) {\n\t\t\treturn Cloud::err('too_often');\n\t\t}\n\n\t\t$post_data = \\json_decode(file_get_contents('php://input'), true);\n\t\tif (is_null($post_data)) {\n\t\t\t$post_data = $_POST;\n\t\t}\n\n\t\tglobal $wpdb;\n\n\t\t$notified_data = $post_data['data'];\n\t\tif (empty($notified_data) || !is_array($notified_data)) {\n\t\t\tself::debug('❌ notify exit: no notified data');\n\t\t\treturn Cloud::err('no notified data');\n\t\t}\n\n\t\tif (empty($post_data['server']) || (substr($post_data['server'], -11) !== '.quic.cloud' && substr($post_data['server'], -15) !== '.quicserver.com')) {\n\t\t\tself::debug('notify exit: no/wrong server');\n\t\t\treturn Cloud::err('no/wrong server');\n\t\t}\n\n\t\tif (empty($post_data['status'])) {\n\t\t\tself::debug('notify missing status');\n\t\t\treturn Cloud::err('no status');\n\t\t}\n\n\t\t$status = $post_data['status'];\n\t\tself::debug('notified status=' . $status);\n\n\t\t$last_log_pid = 0;\n\n\t\tif (empty($this->_summary['reduced'])) {\n\t\t\t$this->_summary['reduced'] = 0;\n\t\t}\n\n\t\tif ($status == self::STATUS_NOTIFIED) {\n\t\t\t// Notified data format: [ img_optm_id => [ id=>, src_size=>, ori=>, ori_md5=>, ori_reduced=>, webp=>, webp_md5=>, webp_reduced=> ] ]\n\t\t\t$q                               =\n\t\t\t\t\"SELECT a.*, b.meta_id as b_meta_id, b.meta_value AS b_optm_info\n\t\t\t\t\tFROM `$this->_table_img_optming` a\n\t\t\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.post_id AND b.meta_key = %s\n\t\t\t\t\tWHERE a.id IN ( \" .\n\t\t\t\timplode(',', array_fill(0, count($notified_data), '%d')) .\n\t\t\t\t' )';\n\t\t\t$list                            = $wpdb->get_results($wpdb->prepare($q, array_merge(array( self::DB_SIZE ), array_keys($notified_data))));\n\t\t\t$ls_optm_size_row_exists_postids = array();\n\t\t\tforeach ($list as $v) {\n\t\t\t\t$json = $notified_data[$v->id];\n\t\t\t\t// self::debug('Notified data for [id] ' . $v->id, $json);\n\n\t\t\t\t$server = !empty($json['server']) ? $json['server'] : $post_data['server'];\n\n\t\t\t\t$server_info = array(\n\t\t\t\t\t'server' => $server,\n\t\t\t\t);\n\n\t\t\t\t// Save server side ID to send taken notification after pulled\n\t\t\t\t$server_info['id'] = $json['id'];\n\t\t\t\tif (!empty($json['file_id'])) {\n\t\t\t\t\t$server_info['file_id'] = $json['file_id'];\n\t\t\t\t}\n\n\t\t\t\t// Optm info array\n\t\t\t\t$postmeta_info = array(\n\t\t\t\t\t'ori_total' => 0,\n\t\t\t\t\t'ori_saved' => 0,\n\t\t\t\t\t'webp_total' => 0,\n\t\t\t\t\t'webp_saved' => 0,\n\t\t\t\t\t'avif_total' => 0,\n\t\t\t\t\t'avif_saved' => 0,\n\t\t\t\t);\n\t\t\t\t// Init postmeta_info for the first one\n\t\t\t\tif (!empty($v->b_meta_id)) {\n\t\t\t\t\tforeach (maybe_unserialize($v->b_optm_info) as $k2 => $v2) {\n\t\t\t\t\t\t$postmeta_info[$k2] += $v2;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!empty($json['ori'])) {\n\t\t\t\t\t$server_info['ori_md5'] = $json['ori_md5'];\n\t\t\t\t\t$server_info['ori']     = $json['ori'];\n\n\t\t\t\t\t// Append meta info\n\t\t\t\t\t$postmeta_info['ori_total'] += $json['src_size'];\n\t\t\t\t\t$postmeta_info['ori_saved'] += $json['ori_reduced']; // optimized image size info in img_optm tb will be updated when pull\n\n\t\t\t\t\t$this->_summary['reduced'] += $json['ori_reduced'];\n\t\t\t\t}\n\n\t\t\t\tif (!empty($json['webp'])) {\n\t\t\t\t\t$server_info['webp_md5'] = $json['webp_md5'];\n\t\t\t\t\t$server_info['webp']     = $json['webp'];\n\n\t\t\t\t\t// Append meta info\n\t\t\t\t\t$postmeta_info['webp_total'] += $json['src_size'];\n\t\t\t\t\t$postmeta_info['webp_saved'] += $json['webp_reduced'];\n\n\t\t\t\t\t$this->_summary['reduced'] += $json['webp_reduced'];\n\t\t\t\t}\n\n\t\t\t\tif (!empty($json['avif'])) {\n\t\t\t\t\t$server_info['avif_md5'] = $json['avif_md5'];\n\t\t\t\t\t$server_info['avif']     = $json['avif'];\n\n\t\t\t\t\t// Append meta info\n\t\t\t\t\t$postmeta_info['avif_total'] += $json['src_size'];\n\t\t\t\t\t$postmeta_info['avif_saved'] += $json['avif_reduced'];\n\n\t\t\t\t\t$this->_summary['reduced'] += $json['avif_reduced'];\n\t\t\t\t}\n\n\t\t\t\t// Update status and data in working table\n\t\t\t\t$q = \"UPDATE `$this->_table_img_optming` SET optm_status = %d, server_info = %s WHERE id = %d \";\n\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $status, \\json_encode($server_info), $v->id )));\n\n\t\t\t\t// Update postmeta for optm summary\n\t\t\t\t$postmeta_info = serialize($postmeta_info);\n\t\t\t\tif (empty($v->b_meta_id) && !in_array($v->post_id, $ls_optm_size_row_exists_postids)) {\n\t\t\t\t\tself::debug('New size info [pid] ' . $v->post_id);\n\t\t\t\t\t$q = \"INSERT INTO `$wpdb->postmeta` ( post_id, meta_key, meta_value ) VALUES ( %d, %s, %s )\";\n\t\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $v->post_id, self::DB_SIZE, $postmeta_info )));\n\t\t\t\t\t$ls_optm_size_row_exists_postids[] = $v->post_id;\n\t\t\t\t} else {\n\t\t\t\t\t$q = \"UPDATE `$wpdb->postmeta` SET meta_value = %s WHERE meta_id = %d \";\n\t\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $postmeta_info, $v->b_meta_id )));\n\t\t\t\t}\n\n\t\t\t\t// write log\n\t\t\t\t$pid_log = $last_log_pid == $v->post_id ? '.' : $v->post_id;\n\t\t\t\tself::debug('notify_img [status] ' . $status . \" \\t\\t[pid] \" . $pid_log . \" \\t\\t[id] \" . $v->id);\n\t\t\t\t$last_log_pid = $v->post_id;\n\t\t\t}\n\n\t\t\tself::save_summary();\n\n\t\t\t// Mark need_pull tag for cron\n\t\t\tself::update_option(self::DB_NEED_PULL, self::STATUS_NOTIFIED);\n\t\t} else {\n\t\t\t// Other errors will directly remove the working records\n\t\t\t// Delete from working table\n\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id IN ( \" . implode(',', array_fill(0, count($notified_data), '%d')) . ' ) ';\n\t\t\t$wpdb->query($wpdb->prepare($q, $notified_data));\n\t\t}\n\n\t\treturn Cloud::ok(array( 'count' => count($notified_data) ));\n\t}\n\n\t/**\n\t * Cron start async req\n\t *\n\t * @since 5.5\n\t */\n\tpublic static function start_async_cron() {\n\t\tTask::async_call('imgoptm');\n\t}\n\n\t/**\n\t * Manually start async req\n\t *\n\t * @since 5.5\n\t */\n\tpublic static function start_async() {\n\t\tTask::async_call('imgoptm_force');\n\n\t\t$msg = __('Started async image optimization request', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Check if need to pull or not\n\t *\n\t * @since 7.2\n\t */\n\tpublic static function need_pull() {\n\t\t$tag = self::get_option(self::DB_NEED_PULL);\n\t\tif (!$tag || $tag != self::STATUS_NOTIFIED) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Ajax req handler\n\t *\n\t * @since 5.5\n\t */\n\tpublic static function async_handler( $force = false ) {\n\t\tself::debug('------------async-------------start_async_handler');\n\n\t\tif (!self::need_pull()) {\n\t\t\tself::debug('❌ no need pull');\n\t\t\treturn;\n\t\t}\n\n\t\tif (defined('LITESPEED_IMG_OPTM_PULL_CRON') && !LITESPEED_IMG_OPTM_PULL_CRON) {\n\t\t\tself::debug('Cron disabled [define] LITESPEED_IMG_OPTM_PULL_CRON');\n\t\t\treturn;\n\t\t}\n\n\t\tself::cls()->pull($force);\n\t}\n\n\t/**\n\t * Calculate pull threads\n\t *\n\t * @since  5.8\n\t * @access private\n\t */\n\tprivate function _calc_pull_threads() {\n\t\tglobal $wpdb;\n\n\t\tif (defined('LITESPEED_IMG_OPTM_PULL_THREADS')) {\n\t\t\treturn LITESPEED_IMG_OPTM_PULL_THREADS;\n\t\t}\n\n\t\t// Tune number of images per request based on number of images waiting and cloud packages\n\t\t$imgs_per_req = 1; // base 1, ramp up to ~50 max\n\n\t\t// Ramp up the request rate based on how many images are waiting\n\t\t$c              = \"SELECT count(id) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t$_c             = $wpdb->prepare($c, array( self::STATUS_NOTIFIED ));\n\t\t$images_waiting = $wpdb->get_var($_c);\n\t\tif ($images_waiting && $images_waiting > 0) {\n\t\t\t$imgs_per_req = ceil($images_waiting / 1000); // ie. download 5/request if 5000 images are waiting\n\t\t}\n\n\t\t// Cap the request rate at 50 images per request\n\t\t$imgs_per_req = min(50, $imgs_per_req);\n\n\t\tself::debug('Pulling images at rate: ' . $imgs_per_req . ' Images per request.');\n\n\t\treturn $imgs_per_req;\n\t}\n\n\t/**\n\t * Pull optimized img\n\t *\n\t * @since  1.6\n\t * @access public\n\t */\n\tpublic function pull( $manual = false ) {\n\t\tglobal $wpdb;\n\t\t$timeoutLimit = ini_get('max_execution_time');\n\t\t$endts        = time() + $timeoutLimit;\n\n\t\tself::debug('' . ($manual ? 'Manually' : 'Cron') . ' pull started [timeout: ' . $timeoutLimit . 's]');\n\n\t\tif ($this->cron_running()) {\n\t\t\tself::debug('Pull cron is running');\n\n\t\t\t$msg = __('Pull Cron is running', 'litespeed-cache');\n\t\t\tAdmin_Display::note($msg);\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_summary['last_pulled']         = time();\n\t\t$this->_summary['last_pulled_by_cron'] = !$manual;\n\t\tself::save_summary();\n\n\t\t$imgs_per_req = $this->_calc_pull_threads();\n\t\t$q            = \"SELECT * FROM `$this->_table_img_optming` WHERE optm_status = %d ORDER BY id LIMIT %d\";\n\t\t$_q           = $wpdb->prepare($q, array( self::STATUS_NOTIFIED, $imgs_per_req ));\n\n\t\t$rm_ori_bkup = $this->conf(self::O_IMG_OPTM_RM_BKUP);\n\n\t\t$total_pulled_ori  = 0;\n\t\t$total_pulled_webp = 0;\n\t\t$total_pulled_avif = 0;\n\n\t\t$server_list = array();\n\n\t\ttry {\n\t\t\twhile ($img_rows = $wpdb->get_results($_q)) {\n\t\t\t\tself::debug('timeout left: ' . ($endts - time()) . 's');\n\t\t\t\tif (function_exists('set_time_limit')) {\n\t\t\t\t\t$endts += 600;\n\t\t\t\t\tself::debug('Endtime extended to ' . date('Ymd H:i:s', $endts));\n\t\t\t\t\tset_time_limit(600); // This will be no more important as we use noabort now\n\t\t\t\t}\n\t\t\t\t// Disabled as we use noabort\n\t\t\t\t// if ($endts - time() < 10) {\n\t\t\t\t// self::debug(\"🚨 End loop due to timeout limit reached \" . $timeoutLimit . \"s\");\n\t\t\t\t// break;\n\t\t\t\t// }\n\n\t\t\t\t/**\n\t\t\t\t * Update cron timestamp to avoid duplicated running\n\t\t\t\t *\n\t\t\t\t * @since  1.6.2\n\t\t\t\t */\n\t\t\t\t$this->_update_cron_running();\n\n\t\t\t\t// Run requests in parallel\n\t\t\t\t$requests    = array(); // store each request URL for Requests::request_multiple()\n\t\t\t\t$imgs_by_req = array(); // store original request data so that we can reference it in the response\n\t\t\t\t$req_counter = 0;\n\t\t\t\tforeach ($img_rows as $row_img) {\n\t\t\t\t\t// request original image\n\t\t\t\t\t$server_info = \\json_decode($row_img->server_info, true);\n\t\t\t\t\tif (!empty($server_info['ori'])) {\n\t\t\t\t\t\t$image_url = $server_info['server'] . '/' . $server_info['ori'];\n\t\t\t\t\t\tself::debug('Queueing pull: ' . $image_url);\n\t\t\t\t\t\t$requests[$req_counter]      = array(\n\t\t\t\t\t\t\t'url' => $image_url,\n\t\t\t\t\t\t\t'type' => 'GET',\n\t\t\t\t\t\t);\n\t\t\t\t\t\t$imgs_by_req[$req_counter++] = array(\n\t\t\t\t\t\t\t'type' => 'ori',\n\t\t\t\t\t\t\t'data' => $row_img,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// request webp image\n\t\t\t\t\t$webp_size = 0;\n\t\t\t\t\tif (!empty($server_info['webp'])) {\n\t\t\t\t\t\t$image_url = $server_info['server'] . '/' . $server_info['webp'];\n\t\t\t\t\t\tself::debug('Queueing pull WebP: ' . $image_url);\n\t\t\t\t\t\t$requests[$req_counter]      = array(\n\t\t\t\t\t\t\t'url' => $image_url,\n\t\t\t\t\t\t\t'type' => 'GET',\n\t\t\t\t\t\t);\n\t\t\t\t\t\t$imgs_by_req[$req_counter++] = array(\n\t\t\t\t\t\t\t'type' => 'webp',\n\t\t\t\t\t\t\t'data' => $row_img,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// request avif image\n\t\t\t\t\t$avif_size = 0;\n\t\t\t\t\tif (!empty($server_info['avif'])) {\n\t\t\t\t\t\t$image_url = $server_info['server'] . '/' . $server_info['avif'];\n\t\t\t\t\t\tself::debug('Queueing pull AVIF: ' . $image_url);\n\t\t\t\t\t\t$requests[$req_counter]      = array(\n\t\t\t\t\t\t\t'url' => $image_url,\n\t\t\t\t\t\t\t'type' => 'GET',\n\t\t\t\t\t\t);\n\t\t\t\t\t\t$imgs_by_req[$req_counter++] = array(\n\t\t\t\t\t\t\t'type' => 'avif',\n\t\t\t\t\t\t\t'data' => $row_img,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself::debug('Loaded images count: ' . $req_counter);\n\n\t\t\t\t$complete_action = function ( $response, $req_count ) use ( $imgs_by_req, $rm_ori_bkup, &$total_pulled_ori, &$total_pulled_webp, &$total_pulled_avif, &$server_list ) {\n\t\t\t\t\tglobal $wpdb;\n\t\t\t\t\t$row_data = isset($imgs_by_req[$req_count]) ? $imgs_by_req[$req_count] : false;\n\t\t\t\t\tif (false === $row_data) {\n\t\t\t\t\t\tself::debug('❌ failed to pull image: Request not found in lookup variable.');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$row_type    = isset($row_data['type']) ? $row_data['type'] : 'ori';\n\t\t\t\t\t$row_img     = $row_data['data'];\n\t\t\t\t\t$local_file  = $this->wp_upload_dir['basedir'] . '/' . $row_img->src;\n\t\t\t\t\t$server_info = \\json_decode($row_img->server_info, true);\n\n\t\t\t\t\t// Handle status_code 404/5xx too as its success=true\n\t\t\t\t\tif ( empty( $response->success ) || empty( $response->status_code ) || 200 !== $response->status_code ) {\n\t\t\t\t\t\t$this->_step_back_image($row_img->id);\n\n\t\t\t\t\t\t$msg = __('Some optimized image file(s) has expired and was cleared.', 'litespeed-cache');\n\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ('webp' === $row_type) {\n\t\t\t\t\t\tfile_put_contents($local_file . '.webp', $response->body);\n\n\t\t\t\t\t\tif (!file_exists($local_file . '.webp') || !filesize($local_file . '.webp') || md5_file($local_file . '.webp') !== $server_info['webp_md5']) {\n\t\t\t\t\t\t\tself::debug('❌ Failed to pull optimized webp img: file md5 mismatch, server md5: ' . $server_info['webp_md5']);\n\n\t\t\t\t\t\t\t// Delete working table\n\t\t\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\t\t$msg = __('Pulled WebP image md5 does not match the notified WebP image md5.', 'litespeed-cache');\n\t\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself::debug('Pulled optimized img WebP: ' . $local_file . '.webp');\n\n\t\t\t\t\t\t$webp_size = filesize($local_file . '.webp');\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * API for WebP\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @since 2.9.5\n\t\t\t\t\t\t * @since  3.0 $row_img less elements (see above one)\n\t\t\t\t\t\t * @see #751737  - API docs for WEBP generation\n\t\t\t\t\t\t */\n\t\t\t\t\t\tdo_action('litespeed_img_pull_webp', $row_img, $local_file . '.webp');\n\n\t\t\t\t\t\t++$total_pulled_webp;\n\t\t\t\t\t} elseif ('avif' === $row_type) {\n\t\t\t\t\t\tfile_put_contents($local_file . '.avif', $response->body);\n\n\t\t\t\t\t\tif (!file_exists($local_file . '.avif') || !filesize($local_file . '.avif') || md5_file($local_file . '.avif') !== $server_info['avif_md5']) {\n\t\t\t\t\t\t\tself::debug('❌ Failed to pull optimized avif img: file md5 mismatch, server md5: ' . $server_info['avif_md5']);\n\n\t\t\t\t\t\t\t// Delete working table\n\t\t\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\t\t$msg = __('Pulled AVIF image md5 does not match the notified AVIF image md5.', 'litespeed-cache');\n\t\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself::debug('Pulled optimized img AVIF: ' . $local_file . '.avif');\n\n\t\t\t\t\t\t$avif_size = filesize($local_file . '.avif');\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * API for AVIF\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @since 7.0\n\t\t\t\t\t\t */\n\t\t\t\t\t\tdo_action('litespeed_img_pull_avif', $row_img, $local_file . '.avif');\n\n\t\t\t\t\t\t++$total_pulled_avif;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// \"ori\" image type\n\t\t\t\t\t\tfile_put_contents($local_file . '.tmp', $response->body);\n\n\t\t\t\t\t\tif (!file_exists($local_file . '.tmp') || !filesize($local_file . '.tmp') || md5_file($local_file . '.tmp') !== $server_info['ori_md5']) {\n\t\t\t\t\t\t\tself::debug(\n\t\t\t\t\t\t\t\t'❌ Failed to pull optimized img: file md5 mismatch [url] ' .\n\t\t\t\t\t\t\t\t\t$server_info['server'] .\n\t\t\t\t\t\t\t\t\t'/' .\n\t\t\t\t\t\t\t\t\t$server_info['ori'] .\n\t\t\t\t\t\t\t\t\t' [server_md5] ' .\n\t\t\t\t\t\t\t\t\t$server_info['ori_md5']\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Delete working table\n\t\t\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\t\t$msg = __('One or more pulled images does not match with the notified image md5', 'litespeed-cache');\n\t\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Backup ori img\n\t\t\t\t\t\tif (!$rm_ori_bkup) {\n\t\t\t\t\t\t\t$extension = pathinfo($local_file, PATHINFO_EXTENSION);\n\t\t\t\t\t\t\t$bk_file   = substr($local_file, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\t\t\t\t\tfile_exists($local_file) && rename($local_file, $bk_file);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Replace ori img\n\t\t\t\t\t\trename($local_file . '.tmp', $local_file);\n\n\t\t\t\t\t\tself::debug('Pulled optimized img: ' . $local_file);\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * API Hook\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @since  2.9.5\n\t\t\t\t\t\t * @since  3.0 $row_img has less elements now. Most useful ones are `post_id`/`src`\n\t\t\t\t\t\t */\n\t\t\t\t\t\tdo_action('litespeed_img_pull_ori', $row_img, $local_file);\n\n\t\t\t\t\t\tself::debug2('Remove _table_img_optming record [id] ' . $row_img->id);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Delete working table\n\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t// Save server_list to notify taken\n\t\t\t\t\tif (empty($server_list[$server_info['server']])) {\n\t\t\t\t\t\t$server_list[$server_info['server']] = array();\n\t\t\t\t\t}\n\n\t\t\t\t\t$server_info_id                        = !empty($server_info['file_id']) ? $server_info['file_id'] : $server_info['id'];\n\t\t\t\t\t$server_list[$server_info['server']][] = $server_info_id;\n\n\t\t\t\t\t++$total_pulled_ori;\n\t\t\t\t};\n\n\t\t\t\t$force_wp_remote_get = defined('LITESPEED_FORCE_WP_REMOTE_GET') && LITESPEED_FORCE_WP_REMOTE_GET;\n\t\t\t\tif (!$force_wp_remote_get && class_exists('\\WpOrg\\Requests\\Requests') && class_exists('\\WpOrg\\Requests\\Autoload') && version_compare(PHP_VERSION, '5.6.0', '>=')) {\n\t\t\t\t\t// Make sure Requests can load internal classes.\n\t\t\t\t\tAutoload::register();\n\n\t\t\t\t\t// Run pull requests in parallel\n\t\t\t\t\tRequests::request_multiple($requests, array(\n\t\t\t\t\t\t'timeout' => 60,\n\t\t\t\t\t\t'connect_timeout' => 60,\n\t\t\t\t\t\t'complete' => $complete_action,\n\t\t\t\t\t));\n\t\t\t\t} else {\n\t\t\t\t\tforeach ($requests as $cnt => $req) {\n\t\t\t\t\t\t$wp_response      = wp_safe_remote_get($req['url'], array( 'timeout' => 60 ));\n\t\t\t\t\t\t$request_response = array(\n\t\t\t\t\t\t\t'success' => false,\n\t\t\t\t\t\t\t'status_code' => 0,\n\t\t\t\t\t\t\t'body' => null,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (is_wp_error($wp_response)) {\n\t\t\t\t\t\t\t$error_message = $wp_response->get_error_message();\n\t\t\t\t\t\t\tself::debug('❌ failed to pull image: ' . $error_message);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$request_response['success']     = true;\n\t\t\t\t\t\t\t$request_response['status_code'] = $wp_response['response']['code'];\n\t\t\t\t\t\t\t$request_response['body']        = $wp_response['body'];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself::debug('response code [code] ' . $wp_response['response']['code'] . ' [url] ' . $req['url']);\n\n\t\t\t\t\t\t$request_response = (object) $request_response;\n\n\t\t\t\t\t\t$complete_action($request_response, $cnt);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself::debug('Current batch pull finished');\n\t\t\t}\n\t\t} catch (\\Exception $e) {\n\t\t\tAdmin_Display::error('Image pull process failure: ' . $e->getMessage());\n\t\t}\n\n\t\t// Notify IAPI images taken\n\t\tforeach ($server_list as $server => $img_list) {\n\t\t\t$data = array(\n\t\t\t\t'action' => self::CLOUD_ACTION_TAKEN,\n\t\t\t\t'list' => $img_list,\n\t\t\t\t'server' => $server,\n\t\t\t);\n\t\t\t// TODO: improve this so we do not call once per server, but just once and then filter on the server side\n\t\t\tCloud::post(Cloud::SVC_IMG_OPTM, $data);\n\t\t}\n\n\t\tif (empty($this->_summary['img_taken'])) {\n\t\t\t$this->_summary['img_taken'] = 0;\n\t\t}\n\t\t$this->_summary['img_taken'] += $total_pulled_ori + $total_pulled_webp + $total_pulled_avif;\n\t\tself::save_summary();\n\n\t\t// Manually running needs to roll back timestamp for next running\n\t\tif ($manual) {\n\t\t\t$this->_update_cron_running(true);\n\t\t}\n\n\t\t// $msg = sprintf(__('Pulled %d image(s)', 'litespeed-cache'), $total_pulled_ori + $total_pulled_webp);\n\t\t// Admin_Display::success($msg);\n\n\t\t// Check if there is still task in queue\n\t\t$q               = \"SELECT * FROM `$this->_table_img_optming` WHERE optm_status = %d LIMIT 1\";\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($q, self::STATUS_NOTIFIED));\n\t\tif ($to_be_continued) {\n\t\t\tself::debug('Task in queue, to be continued...');\n\t\t\treturn;\n\t\t\t// return Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_PULL);\n\t\t}\n\n\t\t// If all pulled, update tag to done\n\t\tself::debug('Marked pull status to all pulled');\n\t\tself::update_option(self::DB_NEED_PULL, self::STATUS_PULLED);\n\t}\n\n\t/**\n\t * Push image back to previous status\n\t *\n\t * @since  3.0\n\t * @access private\n\t */\n\tprivate function _step_back_image( $id ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug('Push image back to new status [id] ' . $id);\n\n\t\t// Reset the image to gathered status\n\t\t$q = \"UPDATE `$this->_table_img_optming` SET optm_status = %d WHERE id = %d \";\n\t\t$wpdb->query($wpdb->prepare($q, array( self::STATUS_RAW, $id )));\n\t}\n\n\t/**\n\t * Parse wp's meta value\n\t *\n\t * @since 1.6.7\n\t * @access private\n\t */\n\tprivate function _parse_wp_meta_value( $v ) {\n\t\tif (empty($v)) {\n\t\t\tself::debug('bypassed parsing meta due to null value');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$v->meta_value) {\n\t\t\tself::debug('bypassed parsing meta due to no meta_value: pid ' . $v->post_id);\n\t\t\treturn false;\n\t\t}\n\n\t\t$meta_value = @maybe_unserialize($v->meta_value);\n\t\tif (!is_array($meta_value)) {\n\t\t\tself::debug('bypassed parsing meta due to meta_value not json: pid ' . $v->post_id);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (empty($meta_value['file'])) {\n\t\t\tself::debug('bypassed parsing meta due to no ori file: pid ' . $v->post_id);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $meta_value;\n\t}\n\n\t/**\n\t * Clean up all unfinished queue locally and to Cloud server\n\t *\n\t * @since 2.1.2\n\t * @access public\n\t */\n\tpublic function clean() {\n\t\tglobal $wpdb;\n\n\t\t// Reset img_optm table's queue\n\t\tif ($this->__data->tb_exist('img_optming')) {\n\t\t\t// Get min post id to mark\n\t\t\t$q       = \"SELECT MIN(post_id) FROM `$this->_table_img_optming`\";\n\t\t\t$min_pid = $wpdb->get_var($q) - 1;\n\t\t\tif ($this->_summary['next_post_id'] > $min_pid) {\n\t\t\t\t$this->_summary['next_post_id'] = $min_pid;\n\t\t\t\tself::save_summary();\n\t\t\t}\n\n\t\t\t$q = \"DELETE FROM `$this->_table_img_optming`\";\n\t\t\t$wpdb->query($q);\n\t\t}\n\n\t\t$msg = __('Cleaned up unfinished data successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Reset image counter\n\t *\n\t * @since 7.0\n\t * @access private\n\t */\n\tprivate function _reset_counter() {\n\t\tself::debug('reset image optm counter');\n\t\t$this->_summary['next_post_id'] = 0;\n\t\tself::save_summary();\n\n\t\t$this->clean();\n\n\t\t$msg = __('Reset image optimization counter successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Destroy all optimized images\n\t *\n\t * @since 3.0\n\t * @access private\n\t */\n\tprivate function _destroy() {\n\t\tglobal $wpdb;\n\n\t\tself::debug('executing DESTROY process');\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t/**\n\t\t * Limit images each time before redirection to fix Out of memory issue. #665465\n\t\t *\n\t\t * @since  2.9.8\n\t\t */\n\t\t// Start deleting files\n\t\t$limit = apply_filters('litespeed_imgoptm_destroy_max_rows', 500);\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\t$i     = 0;\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t++$i;\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t$this->_destroy_optm_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_destroy_optm_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tself::debug('batch switched images total: ' . $i);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\t\tif ($to_be_continued) {\n\t\t\t// Check if post_id is beyond next_post_id\n\t\t\tself::debug('[next_post_id] ' . $this->_summary['next_post_id'] . ' [cursor post id] ' . $to_be_continued->post_id);\n\t\t\tif ($to_be_continued->post_id <= $this->_summary['next_post_id']) {\n\t\t\t\tself::debug('redirecting to next');\n\t\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_DESTROY);\n\t\t\t}\n\t\t\tself::debug('🎊 Finished destroying');\n\t\t}\n\n\t\t// Delete postmeta info\n\t\t$q = \"DELETE FROM `$wpdb->postmeta` WHERE meta_key = %s\";\n\t\t$wpdb->query($wpdb->prepare($q, self::DB_SIZE));\n\t\t$wpdb->query($wpdb->prepare($q, self::DB_SET));\n\n\t\t// Delete img_optm table\n\t\t$this->__data->tb_del('img_optm');\n\t\t$this->__data->tb_del('img_optming');\n\n\t\t// Clear options table summary info\n\t\tself::delete_option('_summary');\n\t\tself::delete_option(self::DB_NEED_PULL);\n\n\t\t$msg = __('Destroy all optimization data successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Destroy optm file\n\t */\n\tprivate function _destroy_optm_file( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\t\tself::debug('deleting ' . $short_file_path);\n\n\t\t// del webp\n\t\t$this->__media->info($short_file_path . '.webp', $this->tmp_pid) && $this->__media->del($short_file_path . '.webp', $this->tmp_pid);\n\t\t$this->__media->info($short_file_path . '.optm.webp', $this->tmp_pid) && $this->__media->del($short_file_path . '.optm.webp', $this->tmp_pid);\n\n\t\t// del avif\n\t\t$this->__media->info($short_file_path . '.avif', $this->tmp_pid) && $this->__media->del($short_file_path . '.avif', $this->tmp_pid);\n\t\t$this->__media->info($short_file_path . '.optm.avif', $this->tmp_pid) && $this->__media->del($short_file_path . '.optm.avif', $this->tmp_pid);\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\t\t$bk_optm_file   = $local_filename . '.bk.optm.' . $extension;\n\n\t\t// del optimized ori\n\t\tif ($this->__media->info($bk_file, $this->tmp_pid)) {\n\t\t\tself::debug('deleting optim ori');\n\t\t\t$this->__media->del($short_file_path, $this->tmp_pid);\n\t\t\t$this->__media->rename($bk_file, $short_file_path, $this->tmp_pid);\n\t\t}\n\t\t$this->__media->info($bk_optm_file, $this->tmp_pid) && $this->__media->del($bk_optm_file, $this->tmp_pid);\n\t}\n\n\t/**\n\t * Rescan to find new generated images\n\t *\n\t * @since 1.6.7\n\t * @access private\n\t */\n\tprivate function _rescan() {\n\t\tglobal $wpdb;\n\t\texit('tobedone');\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t$limit  = 500;\n\n\t\tself::debug('rescan images');\n\n\t\t// Get images\n\t\t$q    = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a, `$wpdb->postmeta` b\n\t\t\tWHERE a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\t\tAND a.ID = b.post_id\n\t\t\t\tAND b.meta_key = '_wp_attachment_metadata'\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d, %d\n\t\t\t\";\n\t\t$list = $wpdb->get_results($wpdb->prepare($q, $offset * $limit, $limit + 1)); // last one is the seed for next batch\n\n\t\tif (!$list) {\n\t\t\t$msg = __('Rescanned successfully.', 'litespeed-cache');\n\t\t\tAdmin_Display::success($msg);\n\n\t\t\tself::debug('rescan bypass: no gathered image found');\n\t\t\treturn;\n\t\t}\n\n\t\tif (count($list) == $limit + 1) {\n\t\t\t$to_be_continued = true;\n\t\t\tarray_pop($list); // last one is the seed for next round, discard here.\n\t\t} else {\n\t\t\t$to_be_continued = false;\n\t\t}\n\n\t\t// Prepare post_ids to inquery gathered images\n\t\t$pid_set      = array();\n\t\t$scanned_list = array();\n\t\tforeach ($list as $v) {\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$scanned_list[] = array(\n\t\t\t\t'pid' => $v->post_id,\n\t\t\t\t'meta' => $meta_value,\n\t\t\t);\n\n\t\t\t$pid_set[] = $v->post_id;\n\t\t}\n\n\t\t// Build gathered images\n\t\t$q    = \"SELECT src, post_id FROM `$this->_table_img_optm` WHERE post_id IN (\" . implode(',', array_fill(0, count($pid_set), '%d')) . ')';\n\t\t$list = $wpdb->get_results($wpdb->prepare($q, $pid_set));\n\t\tforeach ($list as $v) {\n\t\t\t$this->_existed_src_list[] = $v->post_id . '.' . $v->src;\n\t\t}\n\n\t\t// Find new images\n\t\tforeach ($scanned_list as $v) {\n\t\t\t$meta_value = $v['meta'];\n\t\t\t// Parse all child src and put them into $this->_img_in_queue, missing ones to $this->_img_in_queue_missed\n\t\t\t$this->tmp_pid  = $v['pid'];\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t$this->_append_img_queue($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_append_img_queue' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tself::debug('rescanned [img] ' . count($this->_img_in_queue));\n\n\t\t$count = count($this->_img_in_queue);\n\t\tif ($count > 0) {\n\t\t\t// Save to DB\n\t\t\t$this->_save_raw();\n\t\t}\n\n\t\tif ($to_be_continued) {\n\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_RESCAN);\n\t\t}\n\n\t\t$msg = $count ? sprintf(__('Rescanned %d images successfully.', 'litespeed-cache'), $count) : __('Rescanned successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Calculate bkup original images storage\n\t *\n\t * @since 2.2.6\n\t * @access private\n\t */\n\tprivate function _calc_bkup() {\n\t\tglobal $wpdb;\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t$limit  = 500;\n\n\t\tif (!$offset) {\n\t\t\t$this->_summary['bk_summary'] = array(\n\t\t\t\t'date' => time(),\n\t\t\t\t'count' => 0,\n\t\t\t\t'sum' => 0,\n\t\t\t);\n\t\t}\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t$this->_get_bk_size($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_get_bk_size' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\t$this->_summary['bk_summary']['date'] = time();\n\t\tself::save_summary();\n\n\t\tself::debug('_calc_bkup total: ' . $this->_summary['bk_summary']['count'] . ' [size] ' . $this->_summary['bk_summary']['sum']);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\n\t\tif ($to_be_continued) {\n\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_CALC_BKUP);\n\t\t}\n\n\t\t$msg = __('Calculated backups successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Calculate single size\n\t */\n\tprivate function _get_bk_size( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\n\t\t$img_info = $this->__media->info($bk_file, $this->tmp_pid);\n\t\tif (!$img_info) {\n\t\t\treturn;\n\t\t}\n\n\t\t++$this->_summary['bk_summary']['count'];\n\t\t$this->_summary['bk_summary']['sum'] += $img_info['size'];\n\t}\n\n\t/**\n\t * Delete bkup original images storage\n\t *\n\t * @since  2.5\n\t * @access public\n\t */\n\tpublic function rm_bkup() {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->__data->tb_exist('img_optming')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t$limit  = 500;\n\n\t\tif (empty($this->_summary['rmbk_summary'])) {\n\t\t\t$this->_summary['rmbk_summary'] = array(\n\t\t\t\t'date' => time(),\n\t\t\t\t'count' => 0,\n\t\t\t\t'sum' => 0,\n\t\t\t);\n\t\t}\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t$this->_del_bk_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_del_bk_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\t$this->_summary['rmbk_summary']['date'] = time();\n\t\tself::save_summary();\n\n\t\tself::debug('rm_bkup total: ' . $this->_summary['rmbk_summary']['count'] . ' [size] ' . $this->_summary['rmbk_summary']['sum']);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\n\t\tif ($to_be_continued) {\n\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_RM_BKUP);\n\t\t}\n\n\t\t$msg = __('Removed backups successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Delete single file\n\t */\n\tprivate function _del_bk_file( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\n\t\t$img_info = $this->__media->info($bk_file, $this->tmp_pid);\n\t\tif (!$img_info) {\n\t\t\treturn;\n\t\t}\n\n\t\t++$this->_summary['rmbk_summary']['count'];\n\t\t$this->_summary['rmbk_summary']['sum'] += $img_info['size'];\n\n\t\t$this->__media->del($bk_file, $this->tmp_pid);\n\t}\n\n\t/**\n\t * Count images\n\t *\n\t * @since 1.6\n\t * @access public\n\t */\n\tpublic function img_count() {\n\t\tglobal $wpdb;\n\n\t\t$q           = \"SELECT count(*)\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\t\";\n\t\t$groups_all  = $wpdb->get_var($q);\n\t\t$groups_new  = $wpdb->get_var($q . ' AND ID>' . (int) $this->_summary['next_post_id'] . ' ORDER BY ID');\n\t\t$groups_done = $wpdb->get_var($q . ' AND ID<=' . (int) $this->_summary['next_post_id'] . ' ORDER BY ID');\n\n\t\t$q      = \"SELECT b.post_id\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\tORDER BY a.ID DESC\n\t\t\tLIMIT 1\n\t\t\t\";\n\t\t$max_id = $wpdb->get_var($q);\n\n\t\t$count_list = array(\n\t\t\t'max_id' => $max_id,\n\t\t\t'groups_all' => $groups_all,\n\t\t\t'groups_new' => $groups_new,\n\t\t\t'groups_done' => $groups_done,\n\t\t);\n\n\t\t// images count from work table\n\t\tif ($this->__data->tb_exist('img_optming')) {\n\t\t\t$q               = \"SELECT COUNT(DISTINCT post_id),COUNT(*) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t\t$groups_to_check = array( self::STATUS_RAW, self::STATUS_REQUESTED, self::STATUS_NOTIFIED, self::STATUS_ERR_FETCH );\n\t\t\tforeach ($groups_to_check as $v) {\n\t\t\t\t$count_list['img.' . $v]                                   = $count_list['group.' . $v] = 0;\n\t\t\t\tlist($count_list['group.' . $v], $count_list['img.' . $v]) = $wpdb->get_row($wpdb->prepare($q, $v), ARRAY_N);\n\t\t\t}\n\t\t}\n\n\t\treturn $count_list;\n\t}\n\n\t/**\n\t * Check if fetch cron is running\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t */\n\tpublic function cron_running( $bool_res = true ) {\n\t\t$last_run = !empty($this->_summary['last_pull']) ? $this->_summary['last_pull'] : 0;\n\n\t\t$is_running = $last_run && time() - $last_run < 120;\n\n\t\tif ($bool_res) {\n\t\t\treturn $is_running;\n\t\t}\n\n\t\treturn array( $last_run, $is_running );\n\t}\n\n\t/**\n\t * Update fetch cron timestamp tag\n\t *\n\t * @since  1.6.2\n\t * @access private\n\t */\n\tprivate function _update_cron_running( $done = false ) {\n\t\t$this->_summary['last_pull'] = time();\n\n\t\tif ($done) {\n\t\t\t// Only update cron tag when its from the active running cron\n\t\t\tif ($this->_cron_ran) {\n\t\t\t\t// Rollback for next running\n\t\t\t\t$this->_summary['last_pull'] -= 120;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tself::save_summary();\n\n\t\t$this->_cron_ran = true;\n\t}\n\n\t/**\n\t * Batch switch images to ori/optm version\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t */\n\tpublic function batch_switch( $type ) {\n\t\tglobal $wpdb;\n\n\t\tif (defined('LITESPEED_CLI') || wp_doing_cron()) {\n\t\t\t$offset = 0;\n\t\t\twhile ($offset !== 'done') {\n\t\t\t\tAdmin_Display::info(\"Starting switch to $type [offset] $offset\");\n\t\t\t\t$offset = $this->_batch_switch($type, $offset);\n\t\t\t}\n\t\t} else {\n\t\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\n\t\t\t$newOffset = $this->_batch_switch($type, $offset);\n\t\t\tif ($newOffset !== 'done') {\n\t\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, $type);\n\t\t\t}\n\t\t}\n\n\t\t$msg = __('Switched images successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Switch images per offset\n\t */\n\tprivate function _batch_switch( $type, $offset ) {\n\t\tglobal $wpdb;\n\t\t$limit          = 500;\n\t\t$this->tmp_type = $type;\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image/jpeg', 'image/png', 'image/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\t$i     = 0;\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t++$i;\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t$this->_switch_bk_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_switch_bk_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tself::debug('batch switched images total: ' . $i . ' [type] ' . $type);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\t\tif ($to_be_continued) {\n\t\t\treturn $offset;\n\t\t}\n\t\treturn 'done';\n\t}\n\n\t/**\n\t * Delete single file\n\t */\n\tprivate function _switch_bk_file( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\t\t$bk_optm_file   = $local_filename . '.bk.optm.' . $extension;\n\n\t\t// self::debug('_switch_bk_file ' . $bk_file . ' [type] ' . $this->tmp_type);\n\t\t// switch to ori\n\t\tif ($this->tmp_type === self::TYPE_BATCH_SWITCH_ORI || $this->tmp_type == 'orig') {\n\t\t\t// self::debug('switch to orig ' . $bk_file);\n\t\t\tif (!$this->__media->info($bk_file, $this->tmp_pid)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this->__media->rename($local_filename . '.' . $extension, $bk_optm_file, $this->tmp_pid);\n\t\t\t$this->__media->rename($bk_file, $local_filename . '.' . $extension, $this->tmp_pid);\n\t\t}\n\t\t// switch to optm\n\t\telseif ($this->tmp_type === self::TYPE_BATCH_SWITCH_OPTM || $this->tmp_type == 'optm') {\n\t\t\t// self::debug('switch to optm ' . $bk_file);\n\t\t\tif (!$this->__media->info($bk_optm_file, $this->tmp_pid)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this->__media->rename($local_filename . '.' . $extension, $bk_file, $this->tmp_pid);\n\t\t\t$this->__media->rename($bk_optm_file, $local_filename . '.' . $extension, $this->tmp_pid);\n\t\t}\n\t}\n\n\t/**\n\t * Switch image between original one and optimized one\n\t *\n\t * @since 1.6.2\n\t * @access private\n\t */\n\tprivate function _switch_optm_file( $type ) {\n\t\tAdmin_Display::success(__('Switched to optimized file successfully.', 'litespeed-cache'));\n\t\treturn;\n\t\tglobal $wpdb;\n\n\t\t$pid         = substr($type, 4);\n\t\t$switch_type = substr($type, 0, 4);\n\n\t\t$q    = \"SELECT src,post_id FROM `$this->_table_img_optm` WHERE post_id = %d AND optm_status = %d\";\n\t\t$list = $wpdb->get_results($wpdb->prepare($q, array( $pid, self::STATUS_PULLED )));\n\n\t\t$msg = 'Unknown Msg';\n\n\t\tforeach ($list as $v) {\n\t\t\t// to switch webp file\n\t\t\tif ($switch_type === 'webp') {\n\t\t\t\tif ($this->__media->info($v->src . '.webp', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.webp', $v->src . '.optm.webp', $v->post_id);\n\t\t\t\t\tself::debug('Disabled WebP: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Disabled WebP file successfully.', 'litespeed-cache');\n\t\t\t\t} elseif ($this->__media->info($v->src . '.optm.webp', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.optm.webp', $v->src . '.webp', $v->post_id);\n\t\t\t\t\tself::debug('Enable WebP: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Enabled WebP file successfully.', 'litespeed-cache');\n\t\t\t\t}\n\t\t\t}\n\t\t\t// to switch avif file\n\t\t\telseif ($switch_type === 'avif') {\n\t\t\t\tif ($this->__media->info($v->src . '.avif', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.avif', $v->src . '.optm.avif', $v->post_id);\n\t\t\t\t\tself::debug('Disabled AVIF: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Disabled AVIF file successfully.', 'litespeed-cache');\n\t\t\t\t} elseif ($this->__media->info($v->src . '.optm.avif', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.optm.avif', $v->src . '.avif', $v->post_id);\n\t\t\t\t\tself::debug('Enable AVIF: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Enabled AVIF file successfully.', 'litespeed-cache');\n\t\t\t\t}\n\t\t\t}\n\t\t\t// to switch original file\n\t\t\telse {\n\t\t\t\t$extension      = pathinfo($v->src, PATHINFO_EXTENSION);\n\t\t\t\t$local_filename = substr($v->src, 0, -strlen($extension) - 1);\n\t\t\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\t\t\t\t$bk_optm_file   = $local_filename . '.bk.optm.' . $extension;\n\n\t\t\t\t// revert ori back\n\t\t\t\tif ($this->__media->info($bk_file, $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src, $bk_optm_file, $v->post_id);\n\t\t\t\t\t$this->__media->rename($bk_file, $v->src, $v->post_id);\n\t\t\t\t\tself::debug('Restore original img: ' . $bk_file);\n\n\t\t\t\t\t$msg = __('Restored original file successfully.', 'litespeed-cache');\n\t\t\t\t} elseif ($this->__media->info($bk_optm_file, $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src, $bk_file, $v->post_id);\n\t\t\t\t\t$this->__media->rename($bk_optm_file, $v->src, $v->post_id);\n\t\t\t\t\tself::debug('Switch to optm img: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Switched to optimized file successfully.', 'litespeed-cache');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Delete one optm data and recover original file\n\t *\n\t * @since 2.4.2\n\t * @access public\n\t */\n\tpublic function reset_row( $post_id ) {\n\t\tglobal $wpdb;\n\n\t\tif (!$post_id) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Gathered image don't have DB_SIZE info yet\n\t\t// $size_meta = get_post_meta( $post_id, self::DB_SIZE, true );\n\n\t\t// if ( ! $size_meta ) {\n\t\t// return;\n\t\t// }\n\n\t\tself::debug('_reset_row [pid] ' . $post_id);\n\n\t\t// TODO: Load image sub files\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->postmeta` b\n\t\t\tWHERE b.post_id =%d  AND b.meta_key = '_wp_attachment_metadata'\";\n\t\t$q     = $wpdb->prepare($img_q, array( $post_id ));\n\t\t$v     = $wpdb->get_row($q);\n\n\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\tif ($meta_value) {\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '/';\n\t\t\t$this->_destroy_optm_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_destroy_optm_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tdelete_post_meta($post_id, self::DB_SIZE);\n\t\tdelete_post_meta($post_id, self::DB_SET);\n\n\t\t$msg = __('Reset the optimized data successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t/**\n\t * Show an image's optm status\n\t *\n\t * @since  1.6.5\n\t * @access public\n\t */\n\tpublic function check_img() {\n\t\tglobal $wpdb;\n\n\t\t$pid = $_POST['data'];\n\n\t\tself::debug('Check image [ID] ' . $pid);\n\n\t\t$data = array();\n\n\t\t$data['img_count']    = $this->img_count();\n\t\t$data['optm_summary'] = self::get_summary();\n\n\t\t$data['_wp_attached_file']       = get_post_meta($pid, '_wp_attached_file', true);\n\t\t$data['_wp_attachment_metadata'] = get_post_meta($pid, '_wp_attachment_metadata', true);\n\n\t\t// Get img_optm data\n\t\t$q        = \"SELECT * FROM `$this->_table_img_optm` WHERE post_id = %d\";\n\t\t$list     = $wpdb->get_results($wpdb->prepare($q, $pid));\n\t\t$img_data = array();\n\t\tif ($list) {\n\t\t\tforeach ($list as $v) {\n\t\t\t\t$img_data[] = array(\n\t\t\t\t\t'id' => $v->id,\n\t\t\t\t\t'optm_status' => $v->optm_status,\n\t\t\t\t\t'src' => $v->src,\n\t\t\t\t\t'srcpath_md5' => $v->srcpath_md5,\n\t\t\t\t\t'src_md5' => $v->src_md5,\n\t\t\t\t\t'server_info' => $v->server_info,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t$data['img_data'] = $img_data;\n\n\t\treturn array(\n\t\t\t'_res' => 'ok',\n\t\t\t'data' => $data,\n\t\t);\n\t}\n\n\t/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  2.0\n\t * @access public\n\t */\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_RESET_ROW:\n            $this->reset_row(!empty($_GET['id']) ? $_GET['id'] : false);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CALC_BKUP:\n            $this->_calc_bkup();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RM_BKUP:\n            $this->rm_bkup();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_NEW_REQ:\n            $this->new_req();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESCAN:\n            $this->_rescan();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESET_COUNTER:\n            $this->_reset_counter();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_DESTROY:\n            $this->_destroy();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CLEAN:\n            $this->clean();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PULL:\n            self::start_async();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_BATCH_SWITCH_ORI:\n\t\t\tcase self::TYPE_BATCH_SWITCH_OPTM:\n            $this->batch_switch($type);\n\t\t\t\tbreak;\n\n\t\t\tcase substr($type, 0, 4) === 'avif':\n\t\t\tcase substr($type, 0, 4) === 'webp':\n\t\t\tcase substr($type, 0, 4) === 'orig':\n            $this->_switch_optm_file($type);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n",
    "plugins/litespeed-cache/src/tag.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The plugin cache-tag class for X-LiteSpeed-Tag\n *\n * @since       1.1.3\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Tag extends Root {\n\n\tconst TYPE_FEED                    = 'FD';\n\tconst TYPE_FRONTPAGE               = 'F';\n\tconst TYPE_HOME                    = 'H';\n\tconst TYPE_PAGES                   = 'PGS';\n\tconst TYPE_PAGES_WITH_RECENT_POSTS = 'PGSRP';\n\tconst TYPE_HTTP                    = 'HTTP.';\n\tconst TYPE_POST                    = 'Po.'; // Post. Cannot use P, reserved for litemage.\n\tconst TYPE_ARCHIVE_POSTTYPE        = 'PT.';\n\tconst TYPE_ARCHIVE_TERM            = 'T.'; // for is_category|is_tag|is_tax\n\tconst TYPE_AUTHOR                  = 'A.';\n\tconst TYPE_ARCHIVE_DATE            = 'D.';\n\tconst TYPE_BLOG                    = 'B.';\n\tconst TYPE_LOGIN                   = 'L';\n\tconst TYPE_URL                     = 'URL.';\n\tconst TYPE_WIDGET                  = 'W.';\n\tconst TYPE_ESI                     = 'ESI.';\n\tconst TYPE_REST                    = 'REST';\n\tconst TYPE_AJAX                    = 'AJAX.';\n\tconst TYPE_LIST                    = 'LIST';\n\tconst TYPE_MIN                     = 'MIN';\n\tconst TYPE_LOCALRES                = 'LOCALRES';\n\n\tconst X_HEADER = 'X-LiteSpeed-Tag';\n\n\tprivate static $_tags          = array();\n\tprivate static $_tags_priv     = array( 'tag_priv' );\n\tpublic static $error_code_tags = array( 403, 404, 500 );\n\n\t/**\n\t * Initialize\n\t *\n\t * @since 4.0\n\t */\n\tpublic function init() {\n\t\t// register recent posts widget tag before theme renders it to make it work\n\t\tadd_filter('widget_posts_args', array( $this, 'add_widget_recent_posts' ));\n\t}\n\n\t/**\n\t * Check if the login page is cacheable.\n\t * If not, unset the cacheable member variable.\n\t *\n\t * NOTE: This is checked separately because login page doesn't go through WP logic.\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t */\n\tpublic function check_login_cacheable() {\n\t\tif (!$this->conf(Base::O_CACHE_PAGE_LOGIN)) {\n\t\t\treturn;\n\t\t}\n\t\tif (Control::isset_notcacheable()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!empty($_GET)) {\n\t\t\tControl::set_nocache('has GET request');\n\t\t\treturn;\n\t\t}\n\n\t\t$this->cls('Control')->set_cacheable();\n\n\t\tself::add(self::TYPE_LOGIN);\n\n\t\t// we need to send lsc-cookie manually to make it be sent to all other users when is cacheable\n\t\t$list = headers_list();\n\t\tif (empty($list)) {\n\t\t\treturn;\n\t\t}\n\t\tforeach ($list as $hdr) {\n\t\t\tif (strncasecmp($hdr, 'set-cookie:', 11) == 0) {\n\t\t\t\t$cookie = substr($hdr, 12);\n\t\t\t\t@header('lsc-cookie: ' . $cookie, false);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Register purge tag for pages with recent posts widget\n\t * of the plugin.\n\t *\n\t * @since    1.0.15\n\t * @access   public\n\t * @param array $params [WordPress params for widget_posts_args]\n\t */\n\tpublic function add_widget_recent_posts( $params ) {\n\t\tself::add(self::TYPE_PAGES_WITH_RECENT_POSTS);\n\t\treturn $params;\n\t}\n\n\t/**\n\t * Adds cache tags to the list of cache tags for the current page.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param mixed $tags A string or array of cache tags to add to the current list.\n\t */\n\tpublic static function add( $tags ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\tDebug2::debug('💰 [Tag] Add ', $tags);\n\n\t\tself::$_tags = array_merge(self::$_tags, $tags);\n\n\t\t// Send purge header immediately\n\t\t$tag_header = self::cls()->output(true);\n\t\t@header($tag_header);\n\t}\n\n\t/**\n\t * Add a post id to cache tag\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function add_post( $pid ) {\n\t\tself::add(self::TYPE_POST . $pid);\n\t}\n\n\t/**\n\t * Add a widget id to cache tag\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function add_widget( $id ) {\n\t\tself::add(self::TYPE_WIDGET . $id);\n\t}\n\n\t/**\n\t * Add a private ESI to cache tag\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function add_private_esi( $tag ) {\n\t\tself::add_private(self::TYPE_ESI . $tag);\n\t}\n\n\t/**\n\t * Adds private cache tags to the list of cache tags for the current page.\n\t *\n\t * @since 1.6.3\n\t * @access public\n\t * @param mixed $tags A string or array of cache tags to add to the current list.\n\t */\n\tpublic static function add_private( $tags ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\tself::$_tags_priv = array_merge(self::$_tags_priv, $tags);\n\t}\n\n\t/**\n\t * Return tags for Admin QS\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function output_tags() {\n\t\treturn self::$_tags;\n\t}\n\n\t/**\n\t * Will get a hash of the URI. Removes query string and appends a '/' if it is missing.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t * @param string  $uri The uri to get the hash of.\n\t * @param boolean $ori Return the original url or not\n\t * @return bool|string False on input error, hash otherwise.\n\t */\n\tpublic static function get_uri_tag( $uri, $ori = false ) {\n\t\t$no_qs = strtok($uri, '?');\n\t\tif (empty($no_qs)) {\n\t\t\treturn false;\n\t\t}\n\t\t$slashed = trailingslashit($no_qs);\n\n\t\t// If only needs uri tag\n\t\tif ($ori) {\n\t\t\treturn $slashed;\n\t\t}\n\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\treturn self::TYPE_URL . $slashed;\n\t\t}\n\t\treturn self::TYPE_URL . md5($slashed);\n\t}\n\n\t/**\n\t * Get the unique tag based on self url.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param boolean $ori Return the original url or not\n\t */\n\tpublic static function build_uri_tag( $ori = false ) {\n\t\treturn self::get_uri_tag(urldecode($_SERVER['REQUEST_URI']), $ori);\n\t}\n\n\t/**\n\t * Gets the cache tags to set for the page.\n\t *\n\t * This includes site wide post types (e.g. front page) as well as\n\t * any third party plugin specific cache tags.\n\t *\n\t * @since 1.0.0\n\t * @access private\n\t * @return array The list of cache tags to set.\n\t */\n\tprivate static function _build_type_tags() {\n\t\t$tags = array();\n\n\t\t$tags[] = Utility::page_type();\n\n\t\t$tags[] = self::build_uri_tag();\n\n\t\tif (is_front_page()) {\n\t\t\t$tags[] = self::TYPE_FRONTPAGE;\n\t\t} elseif (is_home()) {\n\t\t\t$tags[] = self::TYPE_HOME;\n\t\t}\n\n\t\tglobal $wp_query;\n\t\tif (isset($wp_query)) {\n\t\t\t$queried_obj_id = get_queried_object_id();\n\t\t\tif (is_archive()) {\n\t\t\t\t// An Archive is a Category, Tag, Author, Date, Custom Post Type or Custom Taxonomy based pages.\n\t\t\t\tif (is_category() || is_tag() || is_tax()) {\n\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_TERM . $queried_obj_id;\n\t\t\t\t} elseif (is_post_type_archive() && ($post_type = get_post_type())) {\n\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_POSTTYPE . $post_type;\n\t\t\t\t} elseif (is_author()) {\n\t\t\t\t\t$tags[] = self::TYPE_AUTHOR . $queried_obj_id;\n\t\t\t\t} elseif (is_date()) {\n\t\t\t\t\tglobal $post;\n\n\t\t\t\t\tif ($post && isset($post->post_date)) {\n\t\t\t\t\t\t$date = $post->post_date;\n\t\t\t\t\t\t$date = strtotime($date);\n\t\t\t\t\t\tif (is_day()) {\n\t\t\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_DATE . date('Ymd', $date);\n\t\t\t\t\t\t} elseif (is_month()) {\n\t\t\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_DATE . date('Ym', $date);\n\t\t\t\t\t\t} elseif (is_year()) {\n\t\t\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_DATE . date('Y', $date);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} elseif (is_singular()) {\n\t\t\t\t// $this->is_singular = $this->is_single || $this->is_page || $this->is_attachment;\n\t\t\t\t$tags[] = self::TYPE_POST . $queried_obj_id;\n\n\t\t\t\tif (is_page()) {\n\t\t\t\t\t$tags[] = self::TYPE_PAGES;\n\t\t\t\t}\n\t\t\t} elseif (is_feed()) {\n\t\t\t\t$tags[] = self::TYPE_FEED;\n\t\t\t}\n\t\t}\n\n\t\t// Check REST API\n\t\tif (REST::cls()->is_rest()) {\n\t\t\t$tags[] = self::TYPE_REST;\n\n\t\t\t$path = !empty($_SERVER['SCRIPT_URL']) ? $_SERVER['SCRIPT_URL'] : false;\n\t\t\tif ($path) {\n\t\t\t\t// posts collections tag\n\t\t\t\tif (substr($path, -6) == '/posts') {\n\t\t\t\t\t$tags[] = self::TYPE_LIST; // Not used for purge yet\n\t\t\t\t}\n\n\t\t\t\t// single post tag\n\t\t\t\tglobal $post;\n\t\t\t\tif (!empty($post->ID) && substr($path, -strlen($post->ID) - 1) === '/' . $post->ID) {\n\t\t\t\t\t$tags[] = self::TYPE_POST . $post->ID;\n\t\t\t\t}\n\n\t\t\t\t// pages collections & single page tag\n\t\t\t\tif (stripos($path, '/pages') !== false) {\n\t\t\t\t\t$tags[] = self::TYPE_PAGES;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Append AJAX action tag\n\t\tif (Router::is_ajax() && !empty($_REQUEST['action'])) {\n\t\t\t$tags[] = self::TYPE_AJAX . $_REQUEST['action'];\n\t\t}\n\n\t\treturn $tags;\n\t}\n\n\t/**\n\t * Generate all cache tags before output\n\t *\n\t * @access private\n\t * @since 1.1.3\n\t */\n\tprivate static function _finalize() {\n\t\t// run 3rdparty hooks to tag\n\t\tdo_action('litespeed_tag_finalize');\n\t\t// generate wp tags\n\t\tif (!defined('LSCACHE_IS_ESI')) {\n\t\t\t$type_tags   = self::_build_type_tags();\n\t\t\tself::$_tags = array_merge(self::$_tags, $type_tags);\n\t\t}\n\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\tself::$_tags[] = 'guest';\n\t\t}\n\n\t\t// append blog main tag\n\t\tself::$_tags[] = '';\n\t\t// removed duplicates\n\t\tself::$_tags = array_unique(self::$_tags);\n\t}\n\n\t/**\n\t * Sets up the Cache Tags header.\n\t * ONLY need to run this if is cacheable\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return string empty string if empty, otherwise the cache tags header.\n\t */\n\tpublic function output( $no_finalize = false ) {\n\t\tif (defined('LSCACHE_NO_CACHE') && LSCACHE_NO_CACHE) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$no_finalize) {\n\t\t\tself::_finalize();\n\t\t}\n\n\t\t$prefix_tags = array();\n\t\t/**\n\t\t * Only append blog_id when is multisite\n\t\t *\n\t\t * @since 2.9.3\n\t\t */\n\t\t$prefix = LSWCP_TAG_PREFIX . (is_multisite() ? get_current_blog_id() : '') . '_';\n\n\t\t// If is_private and has private tags, append them first, then specify prefix to `public` for public tags\n\t\tif (Control::is_private()) {\n\t\t\tforeach (self::$_tags_priv as $priv_tag) {\n\t\t\t\t$prefix_tags[] = $prefix . $priv_tag;\n\t\t\t}\n\t\t\t$prefix = 'public:' . $prefix;\n\t\t}\n\n\t\tforeach (self::$_tags as $tag) {\n\t\t\t$prefix_tags[] = $prefix . $tag;\n\t\t}\n\n\t\t$hdr = self::X_HEADER . ': ' . implode(',', $prefix_tags);\n\n\t\treturn $hdr;\n\t}\n}\n",
    "plugins/litespeed-cache/src/str.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * LiteSpeed String Operator Library Class\n *\n * @since 1.3\n * @package LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n/**\n * Class Str\n *\n * Provides string manipulation utilities for LiteSpeed Cache.\n *\n * @since 1.3\n */\nclass Str {\n\n\t/**\n\t * Translate QC HTML links from html.\n\t *\n\t * Converts `<a href=\"{#xxx#}\">xxxx</a>` to `<a href=\"xxx\">xxxx</a>`.\n\t *\n\t * @since 7.0\n\t * @access public\n\t * @param string $html The HTML string to process.\n\t * @return string The processed HTML string.\n\t */\n\tpublic static function translate_qc_apis( $html ) {\n\t\tpreg_match_all( '/<a href=\"{#(\\w+)#}\"/U', $html, $matches );\n\t\tif ( ! $matches ) {\n\t\t\treturn $html;\n\t\t}\n\n\t\tforeach ( $matches[0] as $k => $html_to_be_replaced ) {\n\t\t\t$link = '<a href=\"' . Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_API, false, null, array( 'action2' => $matches[1][ $k ] ) ) . '\"';\n\t\t\t$html = str_replace( $html_to_be_replaced, $link, $html );\n\t\t}\n\t\treturn $html;\n\t}\n\n\t/**\n\t * Return safe HTML\n\t *\n\t * Sanitizes HTML to allow only specific tags and attributes.\n\t *\n\t * @since 7.0\n\t * @access public\n\t * @param string $html The HTML string to sanitize.\n\t * @return string The sanitized HTML string.\n\t */\n\tpublic static function safe_html( $html ) {\n\t\t$common_attrs = array(\n\t\t\t'style'  => array(),\n\t\t\t'class'  => array(),\n\t\t\t'target' => array(),\n\t\t\t'src'    => array(),\n\t\t\t'color'  => array(),\n\t\t\t'href'   => array(),\n\t\t);\n\t\t$tags         = array( 'hr', 'h3', 'h4', 'h5', 'ul', 'li', 'br', 'strong', 'p', 'span', 'img', 'a', 'div', 'font' );\n\t\t$allowed_tags = array();\n\t\tforeach ( $tags as $tag ) {\n\t\t\t$allowed_tags[ $tag ] = $common_attrs;\n\t\t}\n\n\t\treturn wp_kses( $html, $allowed_tags );\n\t}\n\n\t/**\n\t * Generate random string\n\t *\n\t * Creates a random string of specified length and character type.\n\t *\n\t * @since  1.3\n\t * @access public\n\t * @param int $len  Length of string.\n\t * @param int $type Character type: 1-Number, 2-LowerChar, 4-UpperChar, 7-All.\n\t * @return string Randomly generated string.\n\t */\n\tpublic static function rrand( $len, $type = 7 ) {\n\t\tswitch ( $type ) {\n\t\t\tcase 0:\n\t\t\t\t$charlist = '012';\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t$charlist = '0123456789';\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\t$charlist = 'abcdefghijklmnopqrstuvwxyz';\n\t\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\t$charlist = '0123456789abcdefghijklmnopqrstuvwxyz';\n\t\t\t\tbreak;\n\n\t\t\tcase 4:\n\t\t\t\t$charlist = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\n\t\t\tcase 5:\n\t\t\t\t$charlist = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\n\t\t\tcase 6:\n\t\t\t\t$charlist = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\n\t\t\tcase 7:\n\t\t\t\t$charlist = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\t\t}\n\n\t\t$str = '';\n\n\t\t$max = strlen( $charlist ) - 1;\n\t\tfor ( $i = 0; $i < $len; $i++ ) {\n\t\t\t$str .= $charlist[ random_int( 0, $max ) ];\n\t\t}\n\n\t\treturn $str;\n\t}\n\n\t/**\n\t * Trim double quotes from a string\n\t *\n\t * Removes double quotes from a string for use as a preformatted src in HTML.\n\t *\n\t * @since 6.5.3\n\t * @access public\n\t * @param string $text The string to process.\n\t * @return string The string with double quotes removed.\n\t */\n\tpublic static function trim_quotes( $text ) {\n\t\treturn str_replace( '\"', '', $text );\n\t}\n}\n",
    "plugins/litespeed-cache/src/error.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The error class.\n *\n * @since       3.0\n * @package     LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n/**\n * Class Error\n *\n * Handles error message translation and throwing for LiteSpeed Cache.\n *\n * @since 3.0\n */\nclass Error {\n\n\t/**\n\t * Error code mappings to numeric values.\n\t *\n\t * @since 3.0\n\t * @var array\n\t */\n\tprivate static $CODE_SET = array(\n\t\t'HTA_LOGIN_COOKIE_INVALID' => 4300, // .htaccess did not find.\n\t\t'HTA_DNF'                 => 4500, // .htaccess did not find.\n\t\t'HTA_BK'                  => 9010, // backup\n\t\t'HTA_R'                   => 9041, // read htaccess\n\t\t'HTA_W'                   => 9042, // write\n\t\t'HTA_GET'                 => 9030, // failed to get\n\t);\n\n\t/**\n\t * Throw an error with message\n\t *\n\t * Throws an exception with the translated error message.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param string $code Error code.\n\t * @param mixed  $args Optional arguments for message formatting.\n\t * @throws \\Exception Always throws an exception with the error message.\n\t */\n\tpublic static function t( $code, $args = null ) {\n\t\tthrow new \\Exception( wp_kses_post( self::msg( $code, $args ) ) );\n\t}\n\n\t/**\n\t * Translate an error to description\n\t *\n\t * Converts error codes to human-readable messages.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param string $code Error code.\n\t * @param mixed  $args Optional arguments for message formatting.\n\t * @return string Translated error message.\n\t */\n\tpublic static function msg( $code, $args = null ) {\n\t\tswitch ( $code ) {\n\t\t\tcase 'qc_setup_required':\n\t\t\t\t$msg =\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t__( 'You will need to finish %s setup to use the online services.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<strong>QUIC.cloud</strong>'\n\t\t\t\t\t) .\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\tadmin_url( 'admin.php?page=litespeed-general' ),\n\t\t\t\t\t\t__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'out_of_daily_quota':\n\t\t\t\t$msg  = __( 'You have used all of your daily quota for today.', 'litespeed-cache' );\n\t\t\t\t$msg .=\n\t\t\t\t\t' ' .\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t'https://docs.quic.cloud/billing/services/#daily-limits-on-free-quota-usage',\n\t\t\t\t\t\t__( 'Learn more or purchase additional quota.', 'litespeed-cache' ),\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'out_of_quota':\n\t\t\t\t$msg  = __( 'You have used all of your quota left for current service this month.', 'litespeed-cache' );\n\t\t\t\t$msg .=\n\t\t\t\t\t' ' .\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t'https://docs.quic.cloud/billing/services/#daily-limits-on-free-quota-usage',\n\t\t\t\t\t\t__( 'Learn more or purchase additional quota.', 'litespeed-cache' ),\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'too_many_requested':\n\t\t\t\t$msg = __( 'You have too many requested images, please try again in a few minutes.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'too_many_notified':\n\t\t\t\t$msg = __( 'You have images waiting to be pulled. Please wait for the automatic pull to complete, or pull them down manually now.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'empty_list':\n\t\t\t\t$msg = __( 'The image list is empty.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'lack_of_param':\n\t\t\t\t$msg = __( 'Not enough parameters. Please check if the QUIC.cloud connection is set correctly', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'unfinished_queue':\n\t\t\t\t$msg = __( 'There is proceeding queue not pulled yet.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 0 === strpos( $code, 'unfinished_queue ' ):\n\t\t\t\t$msg = sprintf(\n\t\t\t\t\t__( 'There is proceeding queue not pulled yet. Queue info: %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . substr( $code, strlen( 'unfinished_queue ' ) ) . '</code>'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_alias':\n\t\t\t\t$msg = __( 'The site is not a valid alias on QUIC.cloud.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'site_not_registered':\n\t\t\t\t$msg = __( 'The site is not registered on QUIC.cloud.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_key':\n\t\t\t\t$msg = __( 'The QUIC.cloud connection is not correct. Please try to sync your QUIC.cloud connection again.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'heavy_load':\n\t\t\t\t$msg = __( 'The current server is under heavy load.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'redetect_node':\n\t\t\t\t$msg = __( 'Online node needs to be redetected.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_overdraw':\n\t\t\t\t$msg = __( 'Credits are not enough to proceed the current request.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'W':\n\t\t\t\t$msg = __( '%s file not writable.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_DNF':\n\t\t\t\tif ( ! is_array( $args ) ) {\n\t\t\t\t\t$args = array( '<code>' . $args . '</code>' );\n\t\t\t\t}\n\t\t\t\t$args[] = '.htaccess';\n\t\t\t\t$msg    = __( 'Could not find %1$s in %2$s.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_LOGIN_COOKIE_INVALID':\n\t\t\t\t$msg = sprintf( __( 'Invalid login cookie. Please check the %s file.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_BK':\n\t\t\t\t$msg = sprintf( __( 'Failed to back up %s file, aborted changes.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_R':\n\t\t\t\t$msg = sprintf( __( '%s file not readable.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_W':\n\t\t\t\t$msg = sprintf( __( '%s file not writable.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_GET':\n\t\t\t\t$msg = sprintf( __( 'Failed to get %s file contents.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'failed_tb_creation':\n\t\t\t\t$msg = __( 'Failed to create table %1$s! SQL: %2$s.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'crawler_disabled':\n\t\t\t\t$msg = __( 'Crawler disabled by the server admin.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'try_later': // QC error code\n\t\t\t\t$msg = __( 'Previous request too recent. Please try again later.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 0 === strpos( $code, 'try_later ' ):\n\t\t\t\t$msg = sprintf(\n\t\t\t\t\t__( 'Previous request too recent. Please try again after %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . Utility::readable_time( substr( $code, strlen( 'try_later ' ) ), 3600, true ) . '</code>'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'waiting_for_approval':\n\t\t\t\t$msg = __( 'Your application is waiting for approval.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'callback_fail_hash':\n\t\t\t\t$msg = __( 'The callback validation to your domain failed due to hash mismatch.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'callback_fail':\n\t\t\t\t$msg = __( 'The callback validation to your domain failed. Please make sure there is no firewall blocking our servers.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase substr( $code, 0, 14 ) === 'callback_fail ':\n\t\t\t\t$msg =\n\t\t\t\t\t__( 'The callback validation to your domain failed. Please make sure there is no firewall blocking our servers. Response code: ', 'litespeed-cache' ) .\n\t\t\t\t\tsubstr( $code, 14 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'forbidden':\n\t\t\t\t$msg = __( 'Your domain has been forbidden from using our services due to a previous policy violation.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_dns_active':\n\t\t\t\t$msg = __(\n\t\t\t\t\t'You cannot remove this DNS zone, because it is still in use. Please update the domain\\'s nameservers, then try to delete this zone again, otherwise your site will become inaccessible.',\n\t\t\t\t\t'litespeed-cache'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t$msg = __( 'Unknown error', 'litespeed-cache' ) . ': ' . $code;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( null !== $args ) {\n\t\t\t$msg = is_array( $args ) ? vsprintf( $msg, $args ) : sprintf( $msg, $args );\n\t\t}\n\n\t\tif ( isset( self::$CODE_SET[ $code ] ) ) {\n\t\t\t$msg = 'ERROR ' . self::$CODE_SET[ $code ] . ': ' . $msg;\n\t\t}\n\n\t\treturn $msg;\n\t}\n}\n",
    "plugins/litespeed-cache/package-lock.json": "{\n\t\"name\": \"litespeed-cache\",\n\t\"lockfileVersion\": 3,\n\t\"requires\": true,\n\t\"packages\": {\n\t\t\"\": {\n\t\t\t\"name\": \"litespeed-cache\",\n\t\t\t\"license\": \"GPLv3\",\n\t\t\t\"devDependencies\": {\n\t\t\t\t\"@prettier/plugin-php\": \"^0.21.0\",\n\t\t\t\t\"prettier\": \"^3.0.3\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules/@prettier/plugin-php\": {\n\t\t\t\"version\": \"0.21.0\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/@prettier/plugin-php/-/plugin-php-0.21.0.tgz\",\n\t\t\t\"integrity\": \"sha512-vWC6HIUUfhvl/7F5IxVQ0ItGB/7ZY+jDlX7KsTqvfKMODW/zvzj8r1Ab4harS22+O3xxHykVVd5jvylmxMMctg==\",\n\t\t\t\"dev\": true,\n\t\t\t\"dependencies\": {\n\t\t\t\t\"linguist-languages\": \"^7.21.0\",\n\t\t\t\t\"mem\": \"^9.0.2\",\n\t\t\t\t\"php-parser\": \"^3.1.5\"\n\t\t\t},\n\t\t\t\"peerDependencies\": {\n\t\t\t\t\"prettier\": \"^3.0.0\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules/linguist-languages\": {\n\t\t\t\"version\": \"7.27.0\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/linguist-languages/-/linguist-languages-7.27.0.tgz\",\n\t\t\t\"integrity\": \"sha512-Wzx/22c5Jsv2ag+uKy+ITanGA5hzvBZngrNGDXLTC7ZjGM6FLCYGgomauTkxNJeP9of353OM0pWqngYA180xgw==\",\n\t\t\t\"dev\": true\n\t\t},\n\t\t\"node_modules/map-age-cleaner\": {\n\t\t\t\"version\": \"0.1.3\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/map-age-cleaner/-/map-age-cleaner-0.1.3.tgz\",\n\t\t\t\"integrity\": \"sha512-bJzx6nMoP6PDLPBFmg7+xRKeFZvFboMrGlxmNj9ClvX53KrmvM5bXFXEWjbz4cz1AFn+jWJ9z/DJSz7hrs0w3w==\",\n\t\t\t\"dev\": true,\n\t\t\t\"dependencies\": {\n\t\t\t\t\"p-defer\": \"^1.0.0\"\n\t\t\t},\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=6\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules/mem\": {\n\t\t\t\"version\": \"9.0.2\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/mem/-/mem-9.0.2.tgz\",\n\t\t\t\"integrity\": \"sha512-F2t4YIv9XQUBHt6AOJ0y7lSmP1+cY7Fm1DRh9GClTGzKST7UWLMx6ly9WZdLH/G/ppM5RL4MlQfRT71ri9t19A==\",\n\t\t\t\"dev\": true,\n\t\t\t\"dependencies\": {\n\t\t\t\t\"map-age-cleaner\": \"^0.1.3\",\n\t\t\t\t\"mimic-fn\": \"^4.0.0\"\n\t\t\t},\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=12.20\"\n\t\t\t},\n\t\t\t\"funding\": {\n\t\t\t\t\"url\": \"https://github.com/sindresorhus/mem?sponsor=1\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules/mimic-fn\": {\n\t\t\t\"version\": \"4.0.0\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/mimic-fn/-/mimic-fn-4.0.0.tgz\",\n\t\t\t\"integrity\": \"sha512-vqiC06CuhBTUdZH+RYl8sFrL096vA45Ok5ISO6sE/Mr1jRbGH4Csnhi8f3wKVl7x8mO4Au7Ir9D3Oyv1VYMFJw==\",\n\t\t\t\"dev\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=12\"\n\t\t\t},\n\t\t\t\"funding\": {\n\t\t\t\t\"url\": \"https://github.com/sponsors/sindresorhus\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules/p-defer\": {\n\t\t\t\"version\": \"1.0.0\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/p-defer/-/p-defer-1.0.0.tgz\",\n\t\t\t\"integrity\": \"sha512-wB3wfAxZpk2AzOfUMJNL+d36xothRSyj8EXOa4f6GMqYDN9BJaaSISbsk+wS9abmnebVw95C2Kb5t85UmpCxuw==\",\n\t\t\t\"dev\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=4\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules/php-parser\": {\n\t\t\t\"version\": \"3.1.5\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/php-parser/-/php-parser-3.1.5.tgz\",\n\t\t\t\"integrity\": \"sha512-jEY2DcbgCm5aclzBdfW86GM6VEIWcSlhTBSHN1qhJguVePlYe28GhwS0yoeLYXpM2K8y6wzLwrbq814n2PHSoQ==\",\n\t\t\t\"dev\": true\n\t\t},\n\t\t\"node_modules/prettier\": {\n\t\t\t\"version\": \"3.0.3\",\n\t\t\t\"resolved\": \"https://registry.npmjs.org/prettier/-/prettier-3.0.3.tgz\",\n\t\t\t\"integrity\": \"sha512-L/4pUDMxcNa8R/EthV08Zt42WBO4h1rarVtK0K+QJG0X187OLo7l699jWw0GKuwzkPQ//jMFA/8Xm6Fh3J/DAg==\",\n\t\t\t\"dev\": true,\n\t\t\t\"bin\": {\n\t\t\t\t\"prettier\": \"bin/prettier.cjs\"\n\t\t\t},\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=14\"\n\t\t\t},\n\t\t\t\"funding\": {\n\t\t\t\t\"url\": \"https://github.com/prettier/prettier?sponsor=1\"\n\t\t\t}\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/package.json": "{\n\t\"name\": \"litespeed-cache\",\n\t\"description\": \"High-performance page caching and site optimization from LiteSpeed\",\n\t\"license\": \"GPLv3\",\n\t\"scripts\": {\n\t\t\"format-check\": \"vendor/bin/phpcs --standard=phpcs.ruleset.xml cli/ lib/ src/ tpl/ thirdparty autoload.php litespeed-cache.php\",\n\t\t\"install-composer-packages\": \"composer require --dev squizlabs/php_codesniffer:^3.12 wp-coding-standards/wpcs:^3.1 dealerdirect/phpcodesniffer-composer-installer:^1.0 && vendor/bin/phpcs --config-set installed_paths vendor/wp-coding-standards/wpcs,vendor/phpcsstandards/phpcsutils,vendor/phpcsstandards/phpcsextra\",\n\t\t\"sniff-check\": \"vendor/bin/phpcs --standard=phpcs.ruleset.xml cli/ lib/ src/ tpl/ thirdparty autoload.php litespeed-cache.php\",\n\t\t\"wpformat\": \"vendor/bin/phpcbf --standard=phpcs.ruleset.xml cli/ lib/ src/ tpl/ thirdparty autoload.php litespeed-cache.php\"\n\t},\n\t\"devDependencies\": {\n\t\t\"@prettier/plugin-php\": \"^0.21.0\",\n\t\t\"prettier\": \"^3.0.3\"\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/beaver-builder.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the Beaver Builder plugin.\n *\n * @since       3.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Beaver_Builder {\n\n\t/**\n\t * Detects if Beaver_Builder is active.\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (!defined('FL_BUILDER_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Purge All hooks\n\t\t *\n\t\t * @see  beaver-builder/extensions/fi-builder-cache-helper/classes/class-fi-builder-cache-helper.php\n\t\t */\n\t\t$actions = array( 'fl_builder_cache_cleared', 'fl_builder_after_save_layout', 'fl_builder_after_save_user_template', 'upgrader_process_complete' );\n\n\t\tforeach ($actions as $val) {\n\t\t\tadd_action($val, __CLASS__ . '::purge');\n\t\t}\n\t}\n\n\t/**\n\t * Purges the cache when Beaver_Builder's cache is purged.\n\t *\n\t * @since 3.0\n\t * @access public\n\t */\n\tpublic static function purge() {\n\t\tdo_action('litespeed_purge_all', '3rd Beaver_Builder');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/nextgengallery.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the NextGen Gallery plugin.\n *\n * @since       1.0.5\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\n// Try preload instead\n// todo: need test\n// add_action('load_nextgen_gallery_modules', 'NextGenGallery::detect') ;\n\nclass NextGenGallery {\n\n\tconst CACHETAG_ALBUMS    = 'NGG_A.';\n\tconst CACHETAG_GALLERIES = 'NGG_G.';\n\tconst CACHETAG_TAGS      = 'NGG_T.';\n\n\t/**\n\t * Detect is triggered at the load_nextgen_gallery_modules action.\n\t *\n\t * If this action is triggered, assume NextGen Gallery is used.\n\t *\n\t * @since   1.0.5\n\t * @access  public\n\t */\n\tpublic static function preload() {\n\t\tadd_action('ngg_added_new_image', __CLASS__ . '::add_image');\n\t\tadd_action('ngg_ajax_image_save', __CLASS__ . '::update_image');\n\t\tadd_action('ngg_delete_picture', __CLASS__ . '::delete_image');\n\t\tadd_action('ngg_moved_images', __CLASS__ . '::move_image', 10, 3);\n\t\tadd_action('ngg_copied_images', __CLASS__ . '::copy_image', 10, 3);\n\t\tadd_action('ngg_generated_image', __CLASS__ . '::gen_image');\n\t\tadd_action('ngg_recovered_image', __CLASS__ . '::gen_image');\n\n\t\tadd_action('ngg_gallery_sort', __CLASS__ . '::update_gallery');\n\t\tadd_action('ngg_delete_gallery', __CLASS__ . '::update_gallery');\n\n\t\tadd_action('ngg_update_album', __CLASS__ . '::update_album');\n\t\tadd_action('ngg_delete_album', __CLASS__ . '::update_album');\n\n\t\tadd_filter('ngg_displayed_gallery_cache_params', __CLASS__ . '::add_container');\n\t}\n\n\t/**\n\t * When an image is added, need to purge all pages that displays its gallery.\n\t *\n\t * @since   1.0.5\n\t * @access  public\n\t * @param   string $image  The image object added.\n\t */\n\tpublic static function add_image( $image ) {\n\t\tif (!$image || !method_exists($image, 'get_gallery')) {\n\t\t\treturn;\n\t\t}\n\t\t$gallery = $image->get_gallery();\n\t\tif ($gallery && $gallery->pageid) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $gallery->pageid);\n\t\t}\n\t}\n\n\t/**\n\t * When an image is updated, need to purge all pages that displays its gallery.\n\t *\n\t * @since 1.0.5\n\t * @access  public\n\t */\n\tpublic static function update_image() {\n\t\tif (isset($_REQUEST['gallery_id'])) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . sanitize_key($_REQUEST['gallery_id']));\n\t\t\treturn;\n\t\t}\n\n\t\tif (isset($_POST['task_list'])) {\n\t\t\t$task_list = str_replace('\\\\', '', $_POST['task_list']);\n\t\t\t$task_list = json_decode($task_list, true);\n\n\t\t\tif (!empty($task_list[0]['query']['id'])) {\n\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . sanitize_key($task_list[0]['query']['id']));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (isset($_POST['id'])) {\n\t\t\t$id = (int) $_POST['id'];\n\t\t} elseif (isset($_POST['image'])) {\n\t\t\t$id = (int) $_POST['image'];\n\t\t} elseif (isset($_GET['pid'])) {\n\t\t\t$id = (int) $_GET['pid'];\n\t\t} else {\n\t\t\terror_log('LiteSpeed_Cache hit ngg_ajax_image_save with no post image id.');\n\t\t\treturn;\n\t\t}\n\t\t$image = \\C_Image_Mapper::get_instance()->find($id);\n\t\tif ($image) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $image->galleryid);\n\t\t}\n\t}\n\n\t/**\n\t * When an image is deleted, need to purge all pages that displays its gallery.\n\t *\n\t * @since 1.0.5\n\t * @access  public\n\t */\n\tpublic static function delete_image() {\n\t\tif (isset($_GET['gid'])) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . sanitize_key($_GET['gid']));\n\t\t}\n\t}\n\n\t/**\n\t * When an image is moved, need to purge all old galleries and the new gallery.\n\t *\n\t * @since 1.0.8\n\t * @access  public\n\t * @param array   $images unused\n\t * @param array   $old_gallery_ids Source gallery ids for the images.\n\t * @param integer $new_gallery_id Destination gallery id.\n\t */\n\tpublic static function move_image( $images, $old_gallery_ids, $new_gallery_id ) {\n\t\tforeach ($old_gallery_ids as $gid) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $gid);\n\t\t}\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $new_gallery_id);\n\t}\n\n\t/**\n\t * When an image is copied, need to purge the destination gallery.\n\t *\n\t * @param array   $image_pid_map unused\n\t * @param array   $old_gallery_ids unused\n\t * @param integer $new_gallery_id Destination gallery id.\n\t */\n\tpublic static function copy_image( $image_pid_map, $old_gallery_ids, $new_gallery_id ) {\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $new_gallery_id);\n\t}\n\n\t/**\n\t * When an image is re-generated, need to purge the gallery it belongs to.\n\t * Also applies to recovered images.\n\t *\n\t * @param Image $image The re-generated image.\n\t */\n\tpublic static function gen_image( $image ) {\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $image->galleryid);\n\t}\n\n\t/**\n\t * When a gallery is updated, need to purge all pages that display the gallery.\n\t *\n\t * @since 1.0.5\n\t * @access  public\n\t * @param   integer $gid    The gallery id of the gallery updated.\n\t */\n\tpublic static function update_gallery( $gid ) {\n\t\t// New version input will be an object with gid value\n\t\tif (is_object($gid) && !empty($gid->gid)) {\n\t\t\t$gid = $gid->gid;\n\t\t}\n\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $gid);\n\t}\n\n\t/**\n\t * When an album is updated, need to purge all pages that display the album.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param   integer $aid    The album id of the album updated.\n\t */\n\tpublic static function update_album( $aid ) {\n\t\tdo_action('litespeed_purge', self::CACHETAG_ALBUMS . $aid);\n\t}\n\n\t/**\n\t * When rendering a page, if the page has a gallery, album or tag cloud,\n\t * it needs to be tagged appropriately.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param object $render_parms Parameters used to render the associated part of the page.\n\t * @return mixed Null if passed in null, $render_parms otherwise.\n\t */\n\tpublic static function add_container( $render_parms ) {\n\t\t// Check if null. If it is null, can't continue.\n\t\tif (is_null($render_parms)) {\n\t\t\treturn null;\n\t\t}\n\t\t$src           = $render_parms[0]->source;\n\t\t$container_ids = $render_parms[0]->container_ids;\n\t\t// Can switch on first char if we end up with more sources.\n\t\tswitch ($src) {\n\t\t\tcase 'albums':\n            $tag = self::CACHETAG_ALBUMS;\n\t\t\t\tbreak;\n\t\t\tcase 'galleries':\n            $tag = self::CACHETAG_GALLERIES;\n\t\t\t\tbreak;\n\t\t\tcase 'tags':\n            $tag = self::CACHETAG_TAGS;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn $render_parms;\n\t\t}\n\n\t\tforeach ($container_ids as $id) {\n\t\t\tdo_action('litespeed_tag_add', $tag . $id);\n\t\t}\n\n\t\treturn $render_parms;\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/yith-wishlist.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the YITH WooCommerce Wishlist plugin.\n *\n * @since       1.1.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Tag;\nuse LiteSpeed\\Conf;\nuse LiteSpeed\\Base;\n\nclass Yith_Wishlist {\n\n\tconst ESI_PARAM_POSTID = 'yith_pid';\n\tprivate static $_post_id;\n\n\t/**\n\t * Detects if YITH WooCommerce Wishlist and WooCommerce are installed.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (!defined('WOOCOMMERCE_VERSION') || !defined('YITH_WCWL')) {\n\t\t\treturn;\n\t\t}\n\t\tif (apply_filters('litespeed_esi_status', false)) {\n\t\t\tadd_action('litespeed_tpl_normal', __CLASS__ . '::is_not_esi');\n\t\t\tadd_action('litespeed_esi_load-yith_wcwl_add', __CLASS__ . '::load_add_to_wishlist');\n\t\t\tadd_filter('litespeed_esi_inline-yith_wcwl_add', __CLASS__ . '::inline_add_to_wishlist', 20, 2);\n\n\t\t\t// hook to add/delete wishlist\n\t\t\tadd_action('yith_wcwl_added_to_wishlist', __CLASS__ . '::purge');\n\t\t\tadd_action('yith_wcwl_removed_from_wishlist', __CLASS__ . '::purge');\n\t\t}\n\t}\n\n\t/**\n\t * Purge ESI yith cache when add/remove items\n\t *\n\t * @since 1.2.0\n\t * @access public\n\t */\n\tpublic static function purge() {\n\t\tdo_action('litespeed_purge_esi', 'yith_wcwl_add');\n\t}\n\n\t/**\n\t * Hooked to the litespeed_is_not_esi_template action.\n\t *\n\t * If the request is not an ESI request, hook to the add to wishlist button\n\t * filter to replace it as an esi block.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function is_not_esi() {\n\t\tadd_filter('yith_wcwl_add_to_wishlist_params', __CLASS__ . '::add_to_wishlist_params', 999, 2);\n\n\t\tadd_filter('yith_wcwl_add_to_wishlisth_button_html', __CLASS__ . '::sub_add_to_wishlist', 999);\n\t}\n\n\t/**\n\t * Store the post id for later shortcode usage\n\t *\n\t * @since  3.4.1\n\t */\n\tpublic static function add_to_wishlist_params( $defaults, $atts ) {\n\t\tself::$_post_id = !empty($atts['product_id']) ? $atts['product_id'] : $defaults['product_id'];\n\n\t\treturn $defaults;\n\t}\n\n\t/**\n\t * Hooked to the yith_wcwl_add_to_wishlisth_button_html filter.\n\t *\n\t * The add to wishlist button displays a different output when the item is already in the wishlist/cart.\n\t * For this reason, the button must be an ESI block. This function replaces the normal html with the ESI block.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function sub_add_to_wishlist( $template ) {\n\t\t$params = array(\n\t\t\tself::ESI_PARAM_POSTID => self::$_post_id,\n\t\t);\n\n\t\t$inline_tags  = array( '', rtrim(Tag::TYPE_ESI, '.'), Tag::TYPE_ESI . 'yith_wcwl_add' );\n\t\t$inline_tags  = implode(\n\t\t\t',',\n\t\t\tarray_map(function ( $val ) {\n\t\t\t\treturn 'public:' . LSWCP_TAG_PREFIX . '_' . $val;\n\t\t\t}, $inline_tags)\n\t\t);\n\t\t$inline_tags .= ',' . LSWCP_TAG_PREFIX . '_tag_priv';\n\n\t\tdo_action('litespeed_esi_combine', 'yith_wcwl_add');\n\n\t\t$inline_params = array(\n\t\t\t'val' => $template,\n\t\t\t'tag' => $inline_tags,\n\t\t\t'control' => 'private,no-vary,max-age=' . Conf::cls()->conf(Base::O_CACHE_TTL_PRIV),\n\t\t);\n\n\t\treturn apply_filters('litespeed_esi_url', 'yith_wcwl_add', 'YITH ADD TO WISHLIST', $params, 'private,no-vary', false, false, false, $inline_params);\n\t}\n\n\t/**\n\t * Hooked to the litespeed_esi_load-yith_wcwl_add action.\n\t *\n\t * This will load the add to wishlist button html for output.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function load_add_to_wishlist( $params ) {\n\t\t// global $post, $wp_query;\n\t\t// $post = get_post( $params[ self::ESI_PARAM_POSTID ] );\n\t\t// $wp_query->setup_postdata( $post );\n\t\techo \\YITH_WCWL_Shortcode::add_to_wishlist(array( 'product_id' => $params[self::ESI_PARAM_POSTID] ));\n\t\tdo_action('litespeed_control_set_private', 'yith wishlist');\n\t\tdo_action('litespeed_vary_no');\n\t}\n\n\t/**\n\t * Generate ESI inline value\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic static function inline_add_to_wishlist( $res, $params ) {\n\t\tif (!is_array($res)) {\n\t\t\t$res = array();\n\t\t}\n\n\t\t$pid = $params[self::ESI_PARAM_POSTID];\n\n\t\t$res['val'] = \\YITH_WCWL_Shortcode::add_to_wishlist(array( 'product_id' => $pid ));\n\n\t\t$res['control'] = 'private,no-vary,max-age=' . Conf::cls()->conf(Base::O_CACHE_TTL_PRIV);\n\n\t\t$inline_tags  = array( '', rtrim(Tag::TYPE_ESI, '.'), Tag::TYPE_ESI . 'yith_wcwl_add' );\n\t\t$inline_tags  = implode(\n\t\t\t',',\n\t\t\tarray_map(function ( $val ) {\n\t\t\t\treturn 'public:' . LSWCP_TAG_PREFIX . '_' . $val;\n\t\t\t}, $inline_tags)\n\t\t);\n\t\t$inline_tags .= ',' . LSWCP_TAG_PREFIX . '_tag_priv';\n\n\t\t$res['tag'] = $inline_tags;\n\n\t\treturn $res;\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/woocommerce.content.tpl.php": "<?php\n// phpcs:ignoreFile\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined( 'WPINC' ) || exit;\n\nuse LiteSpeed\\API;\nuse LiteSpeed\\Doc;\nuse LiteSpeed\\Admin_Display;\nuse LiteSpeed\\Lang;\nuse LiteSpeed\\Base;\n?>\n\n<div data-litespeed-layout='woocommerce'>\n\n\t<h3 class=\"litespeed-title-short\">\n\t\t<?php echo __( 'WooCommerce Settings', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/cache/#woocommerce-tab' ); ?>\n\t</h3>\n\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php echo __( 'NOTICE:', 'litespeed-cache' ); ?></h4>\n\t\t<p><?php echo __( 'After verifying that the cache works in general, please test the cart.', 'litespeed-cache' ); ?></p>\n\t\t<p><?php printf( __( 'To test the cart, visit the <a %s>FAQ</a>.', 'litespeed-cache' ), 'href=\"https://docs.litespeedtech.com/lscache/lscwp/installation/#non-cacheable-pages\" target=\"_blank\"' ); ?></p>\n\t\t<p><?php echo __( 'By default, the My Account, Checkout, and Cart pages are automatically excluded from caching. Misconfiguration of page associations in WooCommerce settings may cause some pages to be erroneously excluded.', 'litespeed-cache' ); ?></p>\n\t</div>\n\n\t<table class=\"wp-list-table striped litespeed-table\">\n\t\t<tbody>\n\t\t\t<tr>\n\t\t\t\t<th>\n\t\t\t\t\t<?php $id = self::O_UPDATE_INTERVAL; ?>\n\t\t\t\t\t<?php echo __( 'Product Update Interval', 'litespeed-cache' ); ?>\n\t\t\t\t</th>\n\t\t\t\t<td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$options = array(\n\t\t\t\t\t\tself::O_PQS_CS  => __( 'Purge product on changes to the quantity or stock status.', 'litespeed-cache' ) . ' ' . __( 'Purge categories only when stock status changes.', 'litespeed-cache' ),\n\t\t\t\t\t\tself::O_PS_CS   => __( 'Purge product and categories only when the stock status changes.', 'litespeed-cache' ),\n\t\t\t\t\t\tself::O_PS_CN   => __( 'Purge product only when the stock status changes.', 'litespeed-cache' ) . ' ' . __( 'Do not purge categories on changes to the quantity or stock status.', 'litespeed-cache' ),\n\t\t\t\t\t\tself::O_PQS_CQS => __( 'Always purge both product and categories on changes to the quantity or stock status.', 'litespeed-cache' ),\n\t\t\t\t\t);\n\t\t\t\t\t$conf    = (int) apply_filters( 'litespeed_conf', $id );\n\t\t\t\t\tforeach ( $options as $k => $v ) :\n\t\t\t\t\t\t$checked = (int) $k === $conf ? ' checked ' : '';\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<?php do_action( 'litespeed_setting_enroll', $id ); ?>\n\t\t\t\t\t\t<div class='litespeed-radio-row'>\n\t\t\t\t\t\t\t<input type='radio' autocomplete='off' name='<?php echo $id; ?>' id='conf_<?php echo $id; ?>_<?php echo $k; ?>' value='<?php echo $k; ?>' <?php echo $checked; ?> />\n\t\t\t\t\t\t\t<label for='conf_<?php echo $id; ?>_<?php echo $k; ?>'><?php echo $v; ?></label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php echo __( 'Determines how changes in product quantity and product stock status affect product pages and their associated category pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\n\t\t\t<tr>\n\t\t\t\t<th>\n\t\t\t\t\t<?php $id = self::O_CART_VARY; ?>\n\t\t\t\t\t<?php echo __( 'Vary for Mini Cart', 'litespeed-cache' ); ?>\n\t\t\t\t</th>\n\t\t\t\t<td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$conf = (int) apply_filters( 'litespeed_conf', $id );\n\t\t\t\t\t$this->cls( 'Admin_Display' )->build_switch( $id );\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php echo __( 'Generate a separate vary cache copy for the mini cart when the cart is not empty.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php echo __( 'If your theme does not use JS to update the mini cart, you must enable this option to display the correct cart contents.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<br /><?php Doc::notice_htaccess(); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\n\t\t</tbody>\n\t</table>\n</div>",
    "plugins/litespeed-cache/thirdparty/facetwp.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with FacetWP.\n *\n * @since       2.9.9\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Facetwp {\n\n\tpublic static function detect() {\n\t\tif (!defined('FACETWP_VERSION')) {\n\t\t\treturn;\n\t\t}\n\t\t/**\n\t\t * For Facetwp, if the template is \"wp\", return the buffered HTML\n\t\t * So marked as rest call to put is_json to ESI\n\t\t */\n\t\tif (!empty($_POST['action']) && !empty($_POST['data']) && !empty($_POST['data']['template']) && $_POST['data']['template'] === 'wp') {\n\t\t\tadd_filter('litespeed_esi_params', __CLASS__ . '::set_is_json');\n\t\t}\n\t}\n\n\tpublic static function set_is_json( $params ) {\n\t\t$params['is_json'] = 1;\n\t\treturn $params;\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wpml.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with WPML.\n *\n * @since       2.9.4\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WPML {\n\n\tpublic static function detect() {\n\t\tif (!defined('WPML_PLUGIN_BASENAME')) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('litespeed_internal_domains', __CLASS__ . '::append_domains');\n\t}\n\n\t/**\n\t * Take language domains as internal domains\n\t */\n\tpublic static function append_domains( $domains ) {\n\t\t$wpml_domains = apply_filters('wpml_setting', false, 'language_domains');\n\t\tif ($wpml_domains) {\n\t\t\t$domains = array_merge($domains, array_values($wpml_domains));\n\t\t}\n\n\t\treturn $domains;\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/autoptimize.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the Autoptimize plugin.\n *\n * @since       1.0.12\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Autoptimize {\n\n\t/**\n\t * Detects if Autoptimize is active.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (defined('AUTOPTIMIZE_PLUGIN_DIR')) {\n\t\t\tadd_action('litespeed_purge_finalize', __CLASS__ . '::purge');\n\t\t}\n\t}\n\n\t/**\n\t * Purges the cache when Autoptimize's cache is purged.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t */\n\tpublic static function purge() {\n\t\tif (defined('AUTOPTIMIZE_PURGE') || has_action('shutdown', 'autoptimize_do_cachepurged_action', 11)) {\n\t\t\tdo_action('litespeed_purge_all', '3rd Autoptimize');\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/user-switching.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with User Switching.\n *\n * @since       3.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass User_Switching {\n\n\tpublic static function detect() {\n\t\tif (!class_exists('user_switching')) {\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Register switch back URL nonce\n\t\t *\n\t\t * @since  3.0 @Robert Staddon\n\t\t */\n\t\tif (function_exists('current_user_switched') && ($old_user = current_user_switched())) {\n\t\t\tdo_action('litespeed_nonce', 'switch_to_olduser_' . $old_user->ID);\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/litespeed-check.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * Check if any plugins that could conflict with LiteSpeed Cache are active.\n *\n * @since       4.7\n */\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass LiteSpeed_Check {\n\n\tpublic static $_incompatible_plugins = array(\n\t\t// 'autoptimize/autoptimize.php',\n\t\t'breeze/breeze.php',\n\t\t'cache-enabler/cache-enabler.php',\n\t\t'cachify/cachify.php',\n\t\t'cloudflare/cloudflare.php',\n\t\t'comet-cache/comet-cache.php',\n\t\t'docket-cache/docket-cache.php',\n\t\t'fast-velocity-minify/fvm.php',\n\t\t'hummingbird-performance/wp-hummingbird.php',\n\t\t'nginx-cache/nginx-cache.php',\n\t\t'nitropack/main.php',\n\t\t'pantheon-advanced-page-cache/pantheon-advanced-page-cache.php',\n\t\t'powered-cache/powered-cache.php',\n\t\t'psn-pagespeed-ninja/pagespeedninja.php',\n\t\t'sg-cachepress/sg-cachepress.php',\n\t\t'simple-cache/simple-cache.php',\n\t\t// 'redis-cache/redis-cache.php',\n\t\t'w3-total-cache/w3-total-cache.php',\n\t\t'wp-cloudflare-page-cache/wp-cloudflare-page-cache.php',\n\t\t'wp-fastest-cache/wpFastestCache.php',\n\t\t'wp-meteor/wp-meteor.php',\n\t\t'wp-optimize/wp-optimize.php',\n\t\t'wp-performance-score-booster/wp-performance-score-booster.php',\n\t\t'wp-rocket/wp-rocket.php',\n\t\t'wp-super-cache/wp-cache.php',\n\t);\n\n\tprivate static $_option = 'thirdparty_litespeed_check';\n\tprivate static $_msg_id = 'id=\"lscwp-incompatible-plugin-notice\"';\n\n\tpublic static function detect() {\n\t\tif (!is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Check for incompatible plugins when `litespeed-cache` is first activated.\n\t\t */\n\t\t$plugin = basename(LSCWP_DIR) . '/litespeed-cache.php';\n\t\tregister_deactivation_hook($plugin, function ( $_network_wide ) {\n\t\t\t\\LiteSpeed\\Admin_Display::delete_option(self::$_option);\n\t\t});\n\t\tif (!\\LiteSpeed\\Admin_Display::get_option(self::$_option)) {\n\t\t\tself::activated_plugin($plugin, null);\n\t\t\t\\LiteSpeed\\Admin_Display::add_option(self::$_option, true);\n\t\t}\n\n\t\t/**\n\t\t * Check for incompatible plugins when any plugin is (de)activated.\n\t\t */\n\t\tadd_action('activated_plugin', __CLASS__ . '::activated_plugin', 10, 2);\n\t\tadd_action('deactivated_plugin', __CLASS__ . '::deactivated_plugin', 10, 2);\n\n\t\tif (class_exists('PagespeedNinja')) {\n\t\t\t\\LiteSpeed\\Admin_Display::error(\n\t\t\t\t'<div ' .\n\t\t\t\t\tself::$_msg_id .\n\t\t\t\t\t'>' .\n\t\t\t\t\t__('Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', 'litespeed-cache') .\n\t\t\t\t\t'<p style=\"color: red; font-weight: 700;\">' .\n\t\t\t\t\t'PageSpeed Ninja' .\n\t\t\t\t\t'</p>' .\n\t\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic static function activated_plugin( $plugin, $network_wide ) {\n\t\tself::incompatible_plugin_notice($plugin, $network_wide, 'activated');\n\t}\n\n\tpublic static function deactivated_plugin( $plugin, $network_wide ) {\n\t\tself::incompatible_plugin_notice($plugin, $network_wide, 'deactivated');\n\t}\n\n\t/**\n\t * Detect any incompatible plugins that are currently `active` and `valid`.\n\t * Show a notification if there are any.\n\t */\n\tpublic static function incompatible_plugin_notice( $plugin, $_network_wide, $action ) {\n\t\tself::update_messages();\n\n\t\t/**\n\t\t * The 'deactivated_plugin' action fires before\n\t\t * `wp_get_active_and_valid_plugins` can see the change, so we'll need to\n\t\t * remove `$plugin` from the list.\n\t\t */\n\t\t$deactivated = 'deactivated' === $action ? array( $plugin ) : array();\n\n\t\t$incompatible_plugins = array_map(function ( $plugin ) {\n\t\t\treturn WP_PLUGIN_DIR . '/' . $plugin;\n\t\t}, array_diff(self::$_incompatible_plugins, $deactivated));\n\n\t\t$active_incompatible_plugins = array_map(function ( $plugin ) {\n\t\t\t$plugin = get_plugin_data($plugin, false, true);\n\t\t\treturn $plugin['Name'];\n\t\t}, array_intersect($incompatible_plugins, wp_get_active_and_valid_plugins()));\n\n\t\tif (empty($active_incompatible_plugins)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\\LiteSpeed\\Admin_Display::error(\n\t\t\t'<div ' .\n\t\t\t\tself::$_msg_id .\n\t\t\t\t'>' .\n\t\t\t\t__('Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', 'litespeed-cache') .\n\t\t\t\t'<p style=\"color: red; font-weight: 700;\">' .\n\t\t\t\timplode(', ', $active_incompatible_plugins) .\n\t\t\t\t'</p>' .\n\t\t\t\t'</div>',\n\t\t\tfalse,\n\t\t\ttrue\n\t\t);\n\t}\n\n\t/**\n\t * Prevent multiple incompatible plugin notices, in case an admin (de)activates\n\t * a number of incompatible plugins in succession without dismissing the\n\t * notice(s).\n\t */\n\tprivate static function update_messages() {\n\t\t$messages = \\LiteSpeed\\Admin_Display::get_option(\\LiteSpeed\\Admin_Display::DB_MSG_PIN, array());\n\t\tif (is_array($messages)) {\n\t\t\tforeach ($messages as $index => $message) {\n\t\t\t\tif (strpos($message, self::$_msg_id) !== false) {\n\t\t\t\t\tunset($messages[$index]);\n\t\t\t\t\tif (!$messages) {\n\t\t\t\t\t\t$messages = -1;\n\t\t\t\t\t}\n\t\t\t\t\t\\LiteSpeed\\Admin_Display::update_option(\\LiteSpeed\\Admin_Display::DB_MSG_PIN, $messages);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/gravity-forms.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with Gravity Forms.\n *\n * @since       4.1.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Gravity_Forms {\n\n\t/**\n\t * Check if GF is enabled and disable LSCWP on gf-download and gf-signature URI\n\t *\n\t * @since 4.1.0 #900899 #827184\n\t */\n\tpublic static function preload() {\n\t\tif (class_exists('GFCommon')) {\n\t\t\tif (isset($_GET['gf-download']) || isset($_GET['gf-signature'])) {\n\t\t\t\tdo_action('litespeed_disable_all', 'Stopped for Gravity Form');\n\t\t\t}\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/theme-my-login.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the Theme My Login plugin.\n *\n * @since       1.0.15\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Theme_My_Login {\n\n\t/**\n\t * Detects if Better Theme My Login is active.\n\t *\n\t * @since 1.0.15\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (defined('THEME_MY_LOGIN_PATH')) {\n\t\t\tadd_action('litespeed_control_finalize', __CLASS__ . '::set_control');\n\t\t}\n\t}\n\n\t/**\n\t * This filter is used to let the cache know if a page is cacheable.\n\t *\n\t * @access public\n\t * @since 1.0.15\n\t */\n\tpublic static function set_control() {\n\t\tif (!apply_filters('litespeed_control_cacheable', false)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// check if this page is TML page or not\n\t\tif (class_exists('Theme_My_Login') && \\Theme_My_Login::is_tml_page()) {\n\t\t\tdo_action('litespeed_control_set_nocache', 'Theme My Login');\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/entry.inc.php": "<?php\n// phpcs:ignoreFile\n/**\n * The registry for Third Party Plugins Integration files.\n *\n * This file is only used to include the integration files/classes.\n * This works as an entry point for the initial add_action for the\n * detect function.\n *\n * It is not required to add all integration files here, this just provides\n * a common place for plugin authors to append their file to.\n */\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\n$third_cls = array(\n\t'Aelia_CurrencySwitcher',\n\t'Autoptimize',\n\t'Avada',\n\t'BBPress',\n\t'Beaver_Builder',\n\t'Caldera_Forms',\n\t'Divi_Theme_Builder',\n\t'Facetwp',\n\t'LiteSpeed_Check',\n\t'Theme_My_Login',\n\t'User_Switching',\n\t'WCML',\n\t'WooCommerce',\n\t'WC_PDF_Product_Vouchers',\n\t'Woo_Paypal',\n\t'Wp_Polls',\n\t'WP_PostRatings',\n\t'Wpdiscuz',\n\t'WPLister',\n\t'WPML',\n\t'WpTouch',\n\t'Yith_Wishlist',\n);\n\nforeach ($third_cls as $cls) {\n\tadd_action('litespeed_load_thirdparty', 'LiteSpeed\\Thirdparty\\\\' . $cls . '::detect');\n}\n\n// Preload needed for certain thirdparty\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Divi_Theme_Builder::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\WooCommerce::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\NextGenGallery::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\AMP::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Elementor::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Gravity_Forms::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Perfmatters::preload');\n",
    "plugins/litespeed-cache/thirdparty/wp-polls.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the WP-Polls plugin.\n *\n * @since       1.0.7\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\n// todo: need test\n\nclass Wp_Polls {\n\n\tpublic static function detect() {\n\t\tadd_filter('wp_polls_display_pollvote', __CLASS__ . '::set_control');\n\t\tadd_filter('wp_polls_display_pollresult', __CLASS__ . '::set_control');\n\t}\n\n\tpublic static function set_control() {\n\t\tdo_action('litespeed_control_set_nocache', 'wp polls');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wplister.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the WPLister plugin.\n *\n * @since        1.1.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WPLister {\n\n\t/**\n\t * Detects if WooCommerce and WPLister are installed.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (defined('WOOCOMMERCE_VERSION') && defined('WPLISTER_VERSION')) {\n\t\t\t// User reported this will sync correctly.\n\t\t\tadd_action('wplister_revise_inventory_status', array( WooCommerce::cls(), 'backend_purge' ));\n\t\t\t// Added as a safety measure for WPLister Pro only.\n\t\t\tadd_action('wplister_inventory_status_changed', array( WooCommerce::cls(), 'backend_purge' ));\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/bbpress.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the bbPress plugin.\n *\n * @since       1.0.5\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Router;\n\nclass BBPress {\n\n\t/**\n\t * Detect if bbPress is installed and if the page is a bbPress page.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (function_exists('is_bbpress')) {\n\t\t\tadd_action('litespeed_api_purge_post', __CLASS__ . '::on_purge'); // todo\n\t\t\tif (apply_filters('litespeed_esi_status', false)) {\n\t\t\t\t// don't consider private cache yet (will do if any feedback)\n\t\t\t\tadd_action('litespeed_control_finalize', __CLASS__ . '::set_control');\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * This filter is used to let the cache know if a page is cacheable.\n\t *\n\t * @access public\n\t * @since 1.2.0\n\t */\n\tpublic static function set_control() {\n\t\tif (!apply_filters('litespeed_control_cacheable', false)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// set non ESI public\n\t\tif (is_bbpress() && Router::is_logged_in()) {\n\t\t\tdo_action('litespeed_control_set_nocache', 'bbpress nocache due to loggedin');\n\t\t}\n\t}\n\n\t/**\n\t * When a bbPress page is purged, need to purge the forums list and\n\t * any/all ancestor pages.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param integer $post_id The post id of the page being purged.\n\t */\n\tpublic static function on_purge( $post_id ) {\n\t\tif (!is_bbpress()) {\n\t\t\tif (!function_exists('bbp_is_forum') || !function_exists('bbp_is_topic') || !function_exists('bbp_is_reply')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!bbp_is_forum($post_id) && !bbp_is_topic($post_id) && !bbp_is_reply($post_id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Need to purge base forums page, bbPress page was updated.\n\t\tdo_action('litespeed_purge_posttype', bbp_get_forum_post_type());\n\t\t$ancestors = get_post_ancestors($post_id);\n\n\t\t// If there are ancestors, need to purge them as well.\n\t\tif (!empty($ancestors)) {\n\t\t\tforeach ($ancestors as $ancestor) {\n\t\t\t\tdo_action('litespeed_purge_post', $ancestor);\n\t\t\t}\n\t\t}\n\n\t\tglobal $wp_widget_factory;\n\t\t$replies_widget = $wp_widget_factory->get_widget_object('BBP_Replies_Widget');\n\t\tif (bbp_is_reply($post_id) && $replies_widget) {\n\t\t\tdo_action('litespeed_purge_widget', $replies_widget->id);\n\t\t}\n\n\t\t$topic_widget = $wp_widget_factory->get_widget_object('BBP_Topics_Widget');\n\t\tif (bbp_is_topic($post_id) && $topic_widget) {\n\t\t\tdo_action('litespeed_purge_widget', $topic_widget->id);\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wp-postratings.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the WP-PostRatings plugin.\n *\n * @since       1.1.1\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WP_PostRatings {\n\n\t/**\n\t * Detects if plugin is installed.\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (defined('WP_POSTRATINGS_VERSION')) {\n\t\t\tadd_action('rate_post', __CLASS__ . '::flush', 10, 3);\n\t\t}\n\t}\n\n\t/**\n\t * Purges the cache\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t */\n\tpublic static function flush( $uid, $post_id, $post_ratings_score ) {\n\t\tdo_action('litespeed_purge_post', $post_id);\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wpdiscuz.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with Wpdiscuz.\n *\n * @since       2.9.5\n * @package     LiteSpeed\n * @subpackage  LiteSpeed_Cache/thirdparty\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\nclass Wpdiscuz {\n\n\tpublic static function detect() {\n\t\tif (!defined('WPDISCUZ_DS')) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::check_commenter();\n\t\tadd_action('wpdiscuz_add_comment', __CLASS__ . '::add_comment');\n\t}\n\n\tpublic static function add_comment() {\n\t\tAPI::vary_append_commenter();\n\t}\n\n\tpublic static function check_commenter() {\n\t\t$commentor = wp_get_current_commenter();\n\n\t\tif (strlen($commentor['comment_author']) > 0) {\n\t\t\tadd_filter('litespeed_vary_check_commenter_pending', '__return_false');\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/caldera-forms.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with Caldera Forms.\n *\n * @since       3.2.2\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Caldera_Forms {\n\n\tpublic static function detect() {\n\t\tif (!defined('CFCORE_VER')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// plugins/caldera-forms/classes/render/nonce.php -> class Caldera_Forms_Render_Nonce\n\t\tdo_action('litespeed_nonce', 'caldera_forms_front_*');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wc-pdf-product-vouchers.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with WooCommerce PDF Product Vouchers.\n *\n * @since       5.1.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WC_PDF_Product_Vouchers {\n\n\t/**\n\t * Do not cache generated vouchers\n\t *\n\t * @since 5.1.0\n\t */\n\tpublic static function detect() {\n\t\tif (!class_exists('\\WC_PDF_Product_Vouchers_Loader')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$is_voucher = !empty($_GET['post_type']) && 'wc_voucher' === $_GET['post_type'];\n\t\t$has_key    = !empty($_GET['voucher_key']) || !empty($_GET['key']);\n\n\t\tif ($is_voucher && $has_key) {\n\t\t\tdo_action('litespeed_control_set_nocache', '3rd WC PDF Product Voucher');\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/perfmatters.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The Third Party integration with the Perfmatters plugin.\n *\n * @since       4.4.5\n */\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Perfmatters {\n\n\tpublic static function preload() {\n\t\tif (!defined('PERFMATTERS_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (has_action('shutdown', 'perfmatters_script_manager') !== false) {\n\t\t\tadd_action('init', __CLASS__ . '::disable_litespeed_esi', 4);\n\t\t}\n\t}\n\n\tpublic static function disable_litespeed_esi() {\n\t\tdefined('LITESPEED_ESI_OFF') || define('LITESPEED_ESI_OFF', true);\n\t\tdo_action('litespeed_debug', 'Disable ESI due to Perfmatters script manager');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/amp.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with AMP plugin.\n *\n * @since       2.9.8.6\n * @package     LiteSpeed\n * @subpackage  LiteSpeed_Cache/thirdparty\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\nclass AMP {\n\n\t/**\n\t * @since 4.2\n\t */\n\tprivate static function _maybe_amp( $amp_function ) {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!isset($_GET['amp']) && (!function_exists($amp_function) || !$amp_function())) {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_debug', '[3rd] ❌ AMP disabled page optm/lazy');\n\n\t\t!defined('LITESPEED_NO_PAGEOPTM') && define('LITESPEED_NO_PAGEOPTM', true);\n\t\t!defined('LITESPEED_NO_LAZY') && define('LITESPEED_NO_LAZY', true);\n\t\t!defined('LITESPEED_NO_OPTM') && define('LITESPEED_NO_OPTM', true);\n\t\t// ! defined( 'LITESPEED_GUEST' ) && define( 'LITESPEED_GUEST', false );\n\t}\n\n\t/**\n\t * ampforwp_is_amp_endpoint() from Accelerated Mobile Pages\n\t *\n\t * @since 4.2\n\t */\n\tpublic static function maybe_acc_mob_pages() {\n\t\tself::_maybe_amp('ampforwp_is_amp_endpoint');\n\t}\n\n\t/**\n\t * Google AMP fix\n\t *\n\t * @since 4.2.0.1\n\t */\n\tpublic static function maybe_google_amp() {\n\t\tself::_maybe_amp('amp_is_request');\n\t}\n\n\t/**\n\t * CSS async will affect AMP result and\n\t * Lazyload will inject JS library which AMP not allowed\n\t * need to force set false before load\n\t *\n\t * @since 2.9.8.6\n\t * @access public\n\t */\n\tpublic static function preload() {\n\t\tadd_action('wp', __CLASS__ . '::maybe_acc_mob_pages');\n\t\tadd_action('wp', __CLASS__ . '::maybe_google_amp');\n\n\t\t// amp_is_request() from AMP\n\t\t// self::maybe_amp( 'amp_is_request' );\n\t\t// add_filter( 'litespeed_can_optm', '__return_false' );\n\t\t// do_action( 'litespeed_conf_force', API::O_OPTM_CSS_ASYNC, false );\n\t\t// do_action( 'litespeed_conf_force', API::O_MEDIA_LAZY, false );\n\t\t// do_action( 'litespeed_conf_force', API::O_MEDIA_IFRAME_LAZY, false );\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/woo-paypal.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with WooCommerce PayPal Checkout Gateway\n *\n * @ref https://wordpress.org/plugins/woocommerce-gateway-paypal-express-checkout/\n *\n * @since       3.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Woo_Paypal {\n\n\tpublic static function detect() {\n\t\tif (!defined('WC_GATEWAY_PPEC_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_nonce', '_wc_ppec_update_shipping_costs_nonce private');\n\t\tdo_action('litespeed_nonce', '_wc_ppec_start_checkout_nonce private');\n\t\tdo_action('litespeed_nonce', '_wc_ppec_generate_cart_nonce private');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/divi-theme-builder.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with DIVI Theme.\n *\n * @since       2.9.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Divi_Theme_Builder {\n\n\t// private static $js_comment_box = false;\n\n\t/**\n\t * Check if is Edit mode in frontend, disable all LSCWP features to avoid breaking page builder\n\t *\n\t * @since 2.9.7.2 #435538 #581740 #977284\n\t * @since  2.9.9.1 Added 'et_pb_preview' for loading image from library in divi page edit\n\t */\n\tpublic static function preload() {\n\t\tif (!function_exists('et_setup_theme')) {\n\t\t\treturn;\n\t\t}\n\t\tif (!empty($_GET['et_fb']) || !empty($_GET['et_pb_preview']) || (!empty($_GET['p']) && !empty($_GET['preview']) && $_GET['preview'] === 'true')) {\n\t\t\tdo_action('litespeed_disable_all', 'divi edit mode');\n\t\t}\n\t}\n\n\tpublic static function detect() {\n\t\tif (!defined('ET_CORE')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// As DIVI will set page to non-cacheable for the 1st visit to generate CCSS, will need to ignore that no-cache for crawler\n\t\tdefined('LITESPEED_CRAWLER_IGNORE_NONCACHEABLE') || define('LITESPEED_CRAWLER_IGNORE_NONCACHEABLE', true);\n\n\t\t/**\n\t\t * Add contact form to nonce\n\t\t *\n\t\t * @since  2.9.7.1 #475461\n\t\t */\n\t\tdo_action('litespeed_nonce', 'et-pb-contact-form-submit');\n\n\t\t/**\n\t\t * Subscribe module and A/B logging\n\t\t *\n\t\t * @since  3.0 @Robert Staddon\n\t\t */\n\t\tdo_action('litespeed_nonce', 'et_frontend_nonce');\n\t\tdo_action('litespeed_nonce', 'et_ab_log_nonce');\n\n\t\t/*\n\t\t// the comment box fix is for user using theme builder, ESI will load the wrong json string\n\t\t// As we disabled all for edit mode, this is no more needed\n\t\tadd_action( 'et_fb_before_comments_template', 'Divi_Theme_Builder::js_comment_box_on' );\n\t\tadd_action( 'et_fb_after_comments_template', 'Divi_Theme_Builder::js_comment_box_off' );\n\t\tadd_filter( 'litespeed_esi_params-comment-form', 'Divi_Theme_Builder::esi_comment_add_slash' );// Note: this is changed in v2.9.8.1\n\t\t*/\n\t}\n\n\t/*\n\tpublic static function js_comment_box_on() {\n\t\tself::$js_comment_box = true;\n\t}\n\n\tpublic static function js_comment_box_off() {\n\t\tself::$js_comment_box = false;\n\t}\n\n\tpublic static function esi_comment_add_slash( $params )\n\t{\n\t\tif ( self::$js_comment_box ) {\n\t\t\t$params[ 'is_json' ] = 1;\n\t\t\t$params[ '_ls_silence' ] = 1;\n\t\t}\n\n\t\treturn $params;\n\t}\n\t*/\n}\n",
    "plugins/litespeed-cache/thirdparty/aelia-currencyswitcher.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the Aelia CurrencySwitcher plugin.\n *\n * @since       1.0.13\n * @since       2.6     Removed hook_vary as OLS supports vary header already\n * @package     LiteSpeed\n * @subpackage  LiteSpeed_Cache/thirdparty\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\nclass Aelia_CurrencySwitcher {\n\n\tprivate static $_cookies = array( 'aelia_cs_selected_currency', 'aelia_customer_country', 'aelia_customer_state', 'aelia_tax_exempt' );\n\n\t/**\n\t * Detects if WooCommerce is installed.\n\t *\n\t * @since 1.0.13\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (defined('WOOCOMMERCE_VERSION') && isset($GLOBALS['woocommerce-aelia-currencyswitcher']) && is_object($GLOBALS['woocommerce-aelia-currencyswitcher'])) {\n\t\t\t// Not all pages need to add vary, so need to use this API to set conditions\n\t\t\tself::$_cookies = apply_filters('litespeed_3rd_aelia_cookies', self::$_cookies);\n\t\t\tadd_filter('litespeed_vary_curr_cookies', __CLASS__ . '::check_cookies'); // this is for vary response headers, only add when needed\n\t\t\tadd_filter('litespeed_vary_cookies', __CLASS__ . '::register_cookies'); // this is for rewrite rules, so always add\n\t\t}\n\t}\n\n\tpublic static function register_cookies( $list ) {\n\t\treturn array_merge($list, self::$_cookies);\n\t}\n\n\t/**\n\t * If the page is not a woocommerce page, ignore the logic.\n\t * Else check cookies. If cookies are set, set the vary headers, else do not cache the page.\n\t *\n\t * @since 1.0.13\n\t * @access public\n\t */\n\tpublic static function check_cookies( $list ) {\n\t\t// NOTE: is_cart and is_checkout should also be checked, but will be checked by woocommerce anyway.\n\t\tif (!is_woocommerce()) {\n\t\t\treturn $list;\n\t\t}\n\n\t\treturn array_merge($list, self::$_cookies);\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/avada.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the Avada plugin.\n *\n * @since       1.1.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Avada {\n\n\t/**\n\t * Detects if Avada is installed.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (!defined('AVADA_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_action('update_option_avada_dynamic_css_posts', __CLASS__ . '::flush');\n\t\tadd_action('update_option_fusion_options', __CLASS__ . '::flush');\n\t}\n\n\t/**\n\t * Purges the cache\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic static function flush() {\n\t\tdo_action('litespeed_purge_all', '3rd avada');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/woocommerce.tab.tpl.php": "<?php\n/**\n * WooCommerce tab template for LiteSpeed Cache plugin.\n *\n * @package LiteSpeed\n */\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<a class='litespeed-tab nav-tab' href='#woocommerce' data-litespeed-tab='woocommerce'>WooCommerce</a>\n",
    "plugins/litespeed-cache/thirdparty/elementor.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the bbPress plugin.\n *\n * @since       2.9.8.8\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Debug2;\n\nclass Elementor {\n\n\tpublic static function preload() {\n\t\tif (!defined('ELEMENTOR_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!is_admin()) {\n\t\t\t// add_action( 'init', __CLASS__ . '::disable_litespeed_esi', 4 ); // temporarily comment out this line for backward compatibility\n\t\t}\n\n\t\tif (isset($_GET['action']) && $_GET['action'] === 'elementor') {\n\t\t\tdo_action('litespeed_disable_all', 'elementor edit mode');\n\t\t}\n\n\t\tif (!empty($_SERVER['HTTP_REFERER']) && strpos($_SERVER['HTTP_REFERER'], 'action=elementor')) {\n\t\t\tif (!empty($_REQUEST['actions'])) {\n\t\t\t\t$json = json_decode(stripslashes($_REQUEST['actions']), true);\n\t\t\t\t// Debug2::debug( '3rd Elementor', $json );\n\t\t\t\tif (\n\t\t\t\t\t!empty($json['save_builder']['action']) &&\n\t\t\t\t\t$json['save_builder']['action'] == 'save_builder' &&\n\t\t\t\t\t!empty($json['save_builder']['data']['status']) &&\n\t\t\t\t\t$json['save_builder']['data']['status'] == 'publish'\n\t\t\t\t) {\n\t\t\t\t\treturn; // Save post, don't disable all in case we will allow fire crawler right away after purged\n\t\t\t\t}\n\t\t\t}\n\t\t\tdo_action('litespeed_disable_all', 'elementor edit mode in HTTP_REFERER');\n\t\t}\n\n\t\t// Clear LSC cache on Elementor Regenerate CSS & Data\n\t\tadd_action('elementor/core/files/clear_cache', __CLASS__ . '::regenerate_litespeed_cache');\n\t}\n\n\tpublic static function disable_litespeed_esi() {\n\t\tdefine('LITESPEED_ESI_OFF', true);\n\t}\n\n\tpublic static function regenerate_litespeed_cache() {\n\t\tdo_action('litespeed_purge_all', 'Elementor - Regenerate CSS & Data');\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/woocommerce.cls.php": "<?php\n// phpcs:ignoreFile\n\n/**\n * The Third Party integration with the WooCommerce plugin.\n *\n * @since         1.0.5\n * @since  1.6.6 Added function_exists check for compatibility\n * @package       LiteSpeed\n * @subpackage    LiteSpeed_Cache/thirdparty\n */\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\nuse LiteSpeed\\Base;\nuse LiteSpeed\\ESI;\n\nclass WooCommerce extends Base {\n\n\tconst O_CACHE_TTL_FRONTPAGE = Base::O_CACHE_TTL_FRONTPAGE;\n\n\tconst CACHETAG_SHOP     = 'WC_S';\n\tconst CACHETAG_TERM     = 'WC_T.';\n\tconst O_UPDATE_INTERVAL = 'wc_update_interval';\n\tconst O_CART_VARY       = 'wc_cart_vary';\n\tconst O_PQS_CS          = 0; // flush product on quantity + stock change, categories on stock change\n\tconst O_PS_CS           = 1; // flush product and categories on stock change\n\tconst O_PS_CN           = 2; // flush product on stock change, categories no flush\n\tconst O_PQS_CQS         = 3; // flush product and categories on quantity + stock change\n\n\tconst ESI_PARAM_ARGS    = 'wc_args';\n\tconst ESI_PARAM_POSTID  = 'wc_post_id';\n\tconst ESI_PARAM_NAME    = 'wc_name';\n\tconst ESI_PARAM_PATH    = 'wc_path';\n\tconst ESI_PARAM_LOCATED = 'wc_located';\n\n\tprivate $esi_enabled;\n\n\t/**\n\t * Detects if WooCommerce is installed.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tif (!defined('WOOCOMMERCE_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::cls()->add_hooks();\n\t}\n\n\t/**\n\t * Add hooks to woo actions\n\t *\n\t * @since  1.6.3\n\t * @access public\n\t */\n\tpublic function add_hooks() {\n\t\t$this->_option_append();\n\n\t\t$this->esi_enabled = apply_filters('litespeed_esi_status', false);\n\n\t\tadd_action('litespeed_control_finalize', array( $this, 'set_control' ));\n\t\tadd_action('litespeed_tag_finalize', array( $this, 'set_tag' ));\n\n\t\t// Purging a product on stock change should only occur during product purchase. This function will add the purging callback when an order is complete.\n\t\tadd_action('woocommerce_product_set_stock', array( $this, 'purge_product' ));\n\t\tadd_action('woocommerce_variation_set_stock', array( $this, 'purge_product' )); // #984479 Update variations stock\n\n\t\tadd_action('comment_post', array( $this, 'add_review' ), 10, 3);\n\n\t\tif ($this->esi_enabled) {\n\t\t\tif (function_exists('is_shop') && !is_shop()) {\n\t\t\t\tadd_action('litespeed_tpl_normal', array( $this, 'set_block_template' ));\n\t\t\t\t// No need for add-to-cart button\n\t\t\t\t// add_action( 'litespeed_esi_load-wc-add-to-cart-form', array( $this, 'load_add_to_cart_form_block' ) ) ;\n\n\t\t\t\tadd_action('litespeed_esi_load-storefront-cart-header', array( $this, 'load_cart_header' ));\n\t\t\t\tadd_action('litespeed_esi_load-widget', array( $this, 'register_post_view' ));\n\t\t\t}\n\n\t\t\tif (function_exists('is_product') && is_product()) {\n\t\t\t\tadd_filter('litespeed_esi_params', array( $this, 'add_post_id' ), 10, 2);\n\t\t\t}\n\n\t\t\t// #612331 - remove WooCommerce geolocation redirect on ESI page (PR#708)\n\t\t\tif (!empty($_GET[ESI::QS_ACTION]) && !empty($_GET[ESI::QS_PARAMS])) {\n\t\t\t\tremove_action( 'template_redirect', array( 'WC_Cache_Helper', 'geolocation_ajax_redirect' ), 10 );\n\t\t\t}\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\tadd_action('litespeed_api_purge_post', array( $this, 'backend_purge' )); // todo\n\t\t\tadd_action('delete_term_relationships', array( $this, 'delete_rel' ), 10, 2);\n\t\t\tadd_action('litespeed_settings_tab', array( $this, 'settings_add_tab' ));\n\t\t\tadd_action('litespeed_settings_content', array( $this, 'settings_add_content' ));\n\t\t\tadd_filter('litespeed_widget_default_options', array( $this, 'wc_widget_default' ), 10, 2);\n\t\t}\n\n\t\tif (apply_filters('litespeed_conf', self::O_CART_VARY)) {\n\t\t\tadd_filter('litespeed_vary_cookies', function ( $list ) {\n\t\t\t\t$list[] = 'woocommerce_cart_hash';\n\t\t\t\treturn array_unique($list);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Purge esi private tag\n\t *\n\t * @since  1.6.3\n\t * @access public\n\t */\n\tpublic function purge_esi() {\n\t\tdo_action('litespeed_debug', '3rd woo purge ESI in action: ' . current_filter());\n\t\tdo_action('litespeed_purge_private_esi', 'storefront-cart-header');\n\t}\n\n\t/**\n\t * Purge private all\n\t *\n\t * @since  3.0\n\t * @access public\n\t */\n\tpublic function purge_private_all() {\n\t\tdo_action('litespeed_purge_private_all');\n\t}\n\n\t/**\n\t * Check if need to give an ESI block for cart\n\t *\n\t * @since  1.7.2\n\t * @access public\n\t */\n\tpublic function check_if_need_esi( $template ) {\n\t\tif ($this->vary_needed()) {\n\t\t\tdo_action('litespeed_debug', 'API: 3rd woo added ESI');\n\t\t\tadd_action('litespeed_tpl_normal', array( $this, 'set_swap_header_cart' ));\n\t\t}\n\n\t\treturn $template;\n\t}\n\n\t/**\n\t * Keep vary on if cart is not empty\n\t *\n\t * @since  1.7.2\n\t * @access public\n\t */\n\tpublic function vary_maintain( $vary ) {\n\t\tif ($this->vary_needed()) {\n\t\t\tdo_action('litespeed_debug', 'API: 3rd woo added vary due to cart not empty');\n\t\t\t$vary['woo_cart'] = 1;\n\t\t}\n\n\t\treturn $vary;\n\t}\n\n\t/**\n\t * Check if vary need to be on based on cart\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t */\n\tprivate function vary_needed() {\n\t\tif (!function_exists('WC')) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$woocom = WC();\n\t\tif (!$woocom) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (is_null($woocom->cart)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn $woocom->cart->get_cart_contents_count() > 0;\n\t}\n\n\t/**\n\t * Hooked to the litespeed_is_not_esi_template action.\n\t * If the request is not an esi request, I want to set my own hook in woocommerce_before_template_part to see if it's something I can ESI.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic function set_block_template() {\n\t\tadd_action('woocommerce_before_template_part', array( $this, 'block_template' ), 999, 4);\n\t}\n\n\t/**\n\t * Hooked to the litespeed_is_not_esi_template action.\n\t * If the request is not an esi request, I want to set my own hook\n\t * in storefront_header to see if it's something I can ESI.\n\t *\n\t * Will remove storefront_header_cart in storefront_header.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t */\n\tpublic function set_swap_header_cart() {\n\t\t$priority = has_action('storefront_header', 'storefront_header_cart');\n\t\tif ($priority !== false) {\n\t\t\tremove_action('storefront_header', 'storefront_header_cart', $priority);\n\t\t\tadd_action('storefront_header', array( $this, 'esi_cart_header' ), $priority);\n\t\t}\n\t}\n\n\t/**\n\t * Hooked to the woocommerce_before_template_part action.\n\t * Checks if the template contains 'add-to-cart'. If so, and if I want to ESI the request, block it and build my esi code block.\n\t *\n\t * The function parameters will be passed to the esi request.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic function block_template( $template_name, $template_path, $located, $args ) {\n\t\tif (strpos($template_name, 'add-to-cart') === false) {\n\t\t\tif (strpos($template_name, 'related.php') !== false) {\n\t\t\t\tremove_action('woocommerce_before_template_part', array( $this, 'block_template' ), 999);\n\t\t\t\tadd_filter('woocommerce_related_products_args', array( $this, 'add_related_tags' ));\n\t\t\t\tadd_action('woocommerce_after_template_part', array( $this, 'end_template' ), 999);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\treturn;\n\n\t\t// todo: wny not use?\n\n\t\tglobal $post;\n\t\t$params = array(\n\t\t\tself::ESI_PARAM_ARGS => $args,\n\t\t\tself::ESI_PARAM_NAME => $template_name,\n\t\t\tself::ESI_PARAM_POSTID => $post->ID,\n\t\t\tself::ESI_PARAM_PATH => $template_path,\n\t\t\tself::ESI_PARAM_LOCATED => $located,\n\t\t);\n\t\tadd_action('woocommerce_after_add_to_cart_form', array( $this, 'end_form' ));\n\t\tadd_action('woocommerce_after_template_part', array( $this, 'end_form' ), 999);\n\t\techo apply_filters('litespeed_esi_url', 'wc-add-to-cart-form', 'WC_CART_FORM', $params);\n\t\techo apply_filters('litespeed_clean_wrapper_begin', '');\n\t}\n\n\t/**\n\t * Hooked to the woocommerce_after_add_to_cart_form action.\n\t * If this is hit first, clean the buffer and remove this function and\n\t * end_template.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t */\n\tpublic function end_form( $template_name = '' ) {\n\t\tif (!empty($template_name) && strpos($template_name, 'add-to-cart') === false) {\n\t\t\treturn;\n\t\t}\n\t\techo apply_filters('litespeed_clean_wrapper_end', '');\n\t\tremove_action('woocommerce_after_add_to_cart_form', array( $this, 'end_form' ));\n\t\tremove_action('woocommerce_after_template_part', array( $this, 'end_form' ), 999);\n\t}\n\n\t/**\n\t * If related products are loaded, need to add the extra product ids.\n\t *\n\t * The page will be purged if any of the products are changed.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param array $args The arguments used to build the related products section.\n\t * @return array The unchanged arguments.\n\t */\n\tpublic function add_related_tags( $args ) {\n\t\tif (empty($args) || !isset($args['post__in'])) {\n\t\t\treturn $args;\n\t\t}\n\t\t$related_posts = $args['post__in'];\n\t\tforeach ($related_posts as $related) {\n\t\t\tdo_action('litespeed_tag_add_post', $related);\n\t\t}\n\t\treturn $args;\n\t}\n\n\t/**\n\t * Hooked to the woocommerce_after_template_part action.\n\t * If the template contains 'add-to-cart', clean the buffer.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param type $template_name\n\t */\n\tpublic function end_template( $template_name ) {\n\t\tif (strpos($template_name, 'related.php') !== false) {\n\t\t\tremove_action('woocommerce_after_template_part', array( $this, 'end_template' ), 999);\n\t\t\t$this->set_block_template();\n\t\t}\n\t}\n\n\t/**\n\t * Hooked to the storefront_header header.\n\t * If I want to ESI the request, block it and build my esi code block.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t */\n\tpublic function esi_cart_header() {\n\t\techo apply_filters('litespeed_esi_url', 'storefront-cart-header', 'STOREFRONT_CART_HEADER');\n\t}\n\n\t/**\n\t * Hooked to the litespeed_esi_load-storefront-cart-header action.\n\t * Generates the cart header for esi display.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t */\n\tpublic function load_cart_header() {\n\t\tstorefront_header_cart();\n\t}\n\n\t/**\n\t * Hooked to the litespeed_esi_load-wc-add-to-cart-form action.\n\t * Parses the esi input parameters and generates the add to cart form\n\t * for esi display.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @global type $post\n\t * @global type $wp_query\n\t * @param type $params\n\t */\n\tpublic function load_add_to_cart_form_block( $params ) {\n\t\tglobal $post, $wp_query;\n\t\t$post = get_post($params[self::ESI_PARAM_POSTID]);\n\t\t$wp_query->setup_postdata($post);\n\t\tfunction_exists('wc_get_template') && wc_get_template($params[self::ESI_PARAM_NAME], $params[self::ESI_PARAM_ARGS], $params[self::ESI_PARAM_PATH]);\n\t}\n\n\t/**\n\t * Update woocommerce when someone visits a product and has the\n\t * recently viewed products widget.\n\t *\n\t * Currently, this widget should not be cached.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param array $params Widget parameter array\n\t */\n\tpublic function register_post_view( $params ) {\n\t\tif ($params[API::PARAM_NAME] !== 'WC_Widget_Recently_Viewed') {\n\t\t\treturn;\n\t\t}\n\t\tif (!isset($params[self::ESI_PARAM_POSTID])) {\n\t\t\treturn;\n\t\t}\n\t\t$id       = $params[self::ESI_PARAM_POSTID];\n\t\t$esi_post = get_post($id);\n\t\t$product  = function_exists('wc_get_product') ? wc_get_product($esi_post) : false;\n\n\t\tif (empty($product)) {\n\t\t\treturn;\n\t\t}\n\n\t\tglobal $post;\n\t\t$post = $esi_post;\n\t\tfunction_exists('wc_track_product_view') && wc_track_product_view();\n\t}\n\n\t/**\n\t * Adds the post id to the widget ESI parameters for the Recently Viewed widget.\n\t *\n\t * This is needed in the ESI request to update the cookie properly.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic function add_post_id( $params, $block_id ) {\n\t\tif ($block_id == 'widget') {\n\t\t\tif ($params[API::PARAM_NAME] == 'WC_Widget_Recently_Viewed') {\n\t\t\t\t$params[self::ESI_PARAM_POSTID] = get_the_ID();\n\t\t\t}\n\t\t}\n\n\t\treturn $params;\n\t}\n\n\t/**\n\t * Hooked to the litespeed_widget_default_options filter.\n\t *\n\t * The recently viewed widget must be esi to function properly.\n\t * This function will set it to enable and no cache by default.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t */\n\tpublic function wc_widget_default( $options, $widget ) {\n\t\tif (!is_array($options)) {\n\t\t\treturn $options;\n\t\t}\n\t\t$widget_name = get_class($widget);\n\t\tif ($widget_name === 'WC_Widget_Recently_Viewed') {\n\t\t\t$options[API::WIDGET_O_ESIENABLE] = API::VAL_ON2;\n\t\t\t$options[API::WIDGET_O_TTL]       = 0;\n\t\t} elseif ($widget_name === 'WC_Widget_Recent_Reviews') {\n\t\t\t$options[API::WIDGET_O_ESIENABLE] = API::VAL_ON;\n\t\t\t$options[API::WIDGET_O_TTL]       = 86400;\n\t\t}\n\t\treturn $options;\n\t}\n\n\t/**\n\t * Set WooCommerce cache tags based on page type.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t */\n\tpublic function set_tag() {\n\t\t$id = get_the_ID();\n\t\tif ($id === false) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if product has a cache ttl limit or not\n\t\t$sale_from = (int) get_post_meta($id, '_sale_price_dates_from', true);\n\t\t$sale_to   = (int) get_post_meta($id, '_sale_price_dates_to', true);\n\t\t$now       = current_time('timestamp');\n\t\t$ttl       = false;\n\t\tif ($sale_from && $now < $sale_from) {\n\t\t\t$ttl = $sale_from - $now;\n\t\t} elseif ($sale_to && $now < $sale_to) {\n\t\t\t$ttl = $sale_to - $now;\n\t\t}\n\t\tif ($ttl && $ttl < apply_filters('litespeed_control_ttl', 0)) {\n\t\t\tdo_action('litespeed_control_set_ttl', $ttl, \"WooCommerce set scheduled TTL to $ttl\");\n\t\t}\n\n\t\tif (function_exists('is_shop') && is_shop()) {\n\t\t\tdo_action('litespeed_tag_add', self::CACHETAG_SHOP);\n\t\t}\n\t\tif (function_exists('is_product_taxonomy') && !is_product_taxonomy()) {\n\t\t\treturn;\n\t\t}\n\t\tif (isset($GLOBALS['product_cat']) && is_string($GLOBALS['product_cat'])) {\n\t\t\t// todo: need to check previous woo version to find if its from old woo versions or not!\n\t\t\t$term = get_term_by('slug', $GLOBALS['product_cat'], 'product_cat');\n\t\t} elseif (isset($GLOBALS['product_tag']) && is_string($GLOBALS['product_tag'])) {\n\t\t\t$term = get_term_by('slug', $GLOBALS['product_tag'], 'product_tag');\n\t\t} else {\n\t\t\t$term = false;\n\t\t}\n\n\t\tif ($term === false) {\n\t\t\treturn;\n\t\t}\n\t\twhile (isset($term)) {\n\t\t\tdo_action('litespeed_tag_add', self::CACHETAG_TERM . $term->term_id);\n\t\t\tif ($term->parent == 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$term = get_term($term->parent);\n\t\t}\n\t}\n\n\t/**\n\t * Check if the page is cacheable according to WooCommerce.\n\t *\n\t * @since 1.0.5\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param string $esi_id        The ESI block id if a request is an ESI request.\n\t * @return boolean              True if cacheable, false if not.\n\t */\n\tpublic function set_control( $esi_id ) {\n\t\tif (!apply_filters('litespeed_control_cacheable', false)) {\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Avoid possible 500 issue\n\t\t *\n\t\t * @since 1.6.2.1\n\t\t */\n\t\tif (!function_exists('WC')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$woocom = WC();\n\t\tif (!$woocom || empty($woocom->session)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For later versions, DONOTCACHEPAGE should be set.\n\t\t// No need to check uri/qs.\n\t\tif (version_compare($woocom->version, '1.4.2', '>=')) {\n\t\t\tif (version_compare($woocom->version, '3.2.0', '<') && defined('DONOTCACHEPAGE') && DONOTCACHEPAGE) {\n\t\t\t\tdo_action('litespeed_control_set_nocache', '3rd party woocommerce not cache by constant');\n\t\t\t\treturn;\n\t\t\t} elseif (version_compare($woocom->version, '2.1.0', '>=')) {\n\t\t\t\t$err = false;\n\n\t\t\t\tif (!function_exists('wc_get_page_id')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t/**\n\t\t\t\t * From woo/inc/class-wc-cache-helper.php:prevent_caching()\n\t\t\t\t *\n\t\t\t\t * @since  1.4\n\t\t\t\t */\n\t\t\t\t$page_ids = array_filter(array( wc_get_page_id('cart'), wc_get_page_id('checkout'), wc_get_page_id('myaccount') ));\n\t\t\t\tif (isset($_GET['download_file']) || isset($_GET['add-to-cart']) || is_page($page_ids)) {\n\t\t\t\t\t$err = 'woo non cacheable pages';\n\t\t\t\t} elseif (function_exists('wc_notice_count') && wc_notice_count() > 0) {\n\t\t\t\t\t$err = 'has wc notice';\n\t\t\t\t}\n\n\t\t\t\tif ($err) {\n\t\t\t\t\tdo_action('litespeed_control_set_nocache', '3rd party woocommerce not cache due to ' . $err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t$uri     = esc_url($_SERVER['REQUEST_URI']);\n\t\t$uri_len = strlen($uri);\n\t\tif ($uri_len < 5) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (in_array($uri, array( 'cart/', 'checkout/', 'my-account/', 'addons/', 'logout/', 'lost-password/', 'product/' ))) {\n\t\t\t// why contains `product`?\n\t\t\tdo_action('litespeed_control_set_nocache', 'uri in cart/account/user pages');\n\t\t\treturn;\n\t\t}\n\n\t\t$qs     = sanitize_text_field($_SERVER['QUERY_STRING']);\n\t\t$qs_len = strlen($qs);\n\t\tif (!empty($qs) && $qs_len >= 12 && strpos($qs, 'add-to-cart=') === 0) {\n\t\t\tdo_action('litespeed_control_set_nocache', 'qs contains add-to-cart');\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Purge a product page and related pages (based on settings) on checkout.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param WC_Product $product\n\t */\n\tpublic function purge_product( $product ) {\n\t\tdo_action('litespeed_debug', '[3rd] Woo Purge [pid] ' . $product->get_id());\n\n\t\t$do_purge = function ( $action, $debug = '' ) use ( $product ) {\n\t\t\t$config = apply_filters('litespeed_conf', self::O_UPDATE_INTERVAL);\n\t\t\tif (is_null($config)) {\n\t\t\t\t$config = self::O_PQS_CS;\n\t\t\t}\n\n\t\t\tif ($config === self::O_PQS_CQS) {\n\t\t\t\t$action();\n\t\t\t\tif ($debug) {\n\t\t\t\t\tdo_action('litespeed_debug', $debug);\n\t\t\t\t}\n\t\t\t} elseif ($config !== self::O_PQS_CS && $product->is_in_stock()) {\n\t\t\t\tdo_action('litespeed_debug', '[3rd] Woo No purge needed [option] ' . $config);\n\t\t\t\treturn false;\n\t\t\t} elseif ($config !== self::O_PS_CN && !$product->is_in_stock()) {\n\t\t\t\t$action();\n\t\t\t\tif ($debug) {\n\t\t\t\t\tdo_action('litespeed_debug', $debug);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\tif (\n\t\t\t!$do_purge(function () use ( $product ) {\n\t\t\t\t$this->backend_purge($product->get_id());\n\t\t\t})\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_purge_post', $product->get_id());\n\n\t\t// Check if is variation, purge stock too #984479\n\t\tif ($product->is_type('variation')) {\n\t\t\tdo_action('litespeed_purge_post', $product->get_parent_id());\n\t\t}\n\n\t\t// Check if WPML is enabled ##972971\n\t\tif (defined('WPML_PLUGIN_BASENAME')) {\n\t\t\t// Check if it is a variable product and get post/parent ID\n\t\t\t$wpml_purge_id = $product->is_type('variation') ? $product->get_parent_id() : $product->get_id();\n\t\t\t$type          = apply_filters('wpml_element_type', get_post_type($wpml_purge_id));\n\t\t\t$trid          = apply_filters('wpml_element_trid', false, $wpml_purge_id, $type);\n\t\t\t$translations  = apply_filters('wpml_get_element_translations', array(), $trid, $type);\n\t\t\tforeach ($translations as $lang => $translation) {\n\t\t\t\tdo_action('litespeed_debug', '[3rd] Woo WPML purge language: ' . $translation->language_code . ' , post ID: ' . $translation->element_id);\n\t\t\t\tdo_action('litespeed_purge_post', $translation->element_id);\n\t\t\t\t// use the $translation->element_id as it is post ID of other languages\n\t\t\t}\n\n\t\t\t// Check other languages category and purge if configured.\n\t\t\t// wp_get_post_terms() only returns default language category ID\n\t\t\t$default_cats = wp_get_post_terms($wpml_purge_id, 'product_cat');\n\t\t\t$languages    = apply_filters('wpml_active_languages', null);\n\n\t\t\tforeach ($default_cats as $default_cat) {\n\t\t\t\tforeach ($languages as $language) {\n\t\t\t\t\t$tr_cat_id = icl_object_id($default_cat->term_id, 'product_cat', false, $language['code']);\n\t\t\t\t\t$do_purge(function () use ( $tr_cat_id ) {\n\t\t\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $tr_cat_id);\n\t\t\t\t\t}, '[3rd] Woo Purge WPML category [language] ' . $language['code'] . ' [cat] ' . $tr_cat_id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Delete object-term relationship. If the post is a product and\n\t * the term ids array is not empty, will add purge tags to the deleted\n\t * terms.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param int   $post_id Object ID.\n\t * @param array $term_ids An array of term taxonomy IDs.\n\t */\n\tpublic function delete_rel( $post_id, $term_ids ) {\n\t\tif (!function_exists('wc_get_product')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (empty($term_ids) || wc_get_product($post_id) === false) {\n\t\t\treturn;\n\t\t}\n\t\tforeach ($term_ids as $term_id) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $term_id);\n\t\t}\n\t}\n\n\t/**\n\t * Purge a product's categories and tags pages in case they are affected.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param int $post_id Post id that is about to be purged\n\t */\n\tpublic function backend_purge( $post_id ) {\n\t\tif (!function_exists('wc_get_product')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isset($post_id) || wc_get_product($post_id) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\t$cats = $this->get_cats($post_id);\n\t\tif (!empty($cats)) {\n\t\t\tforeach ($cats as $cat) {\n\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $cat);\n\t\t\t}\n\t\t}\n\n\t\tif (!function_exists('wc_get_product_terms')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$tags = wc_get_product_terms($post_id, 'product_tag', array( 'fields' => 'ids' ));\n\t\tif (!empty($tags)) {\n\t\t\tforeach ($tags as $tag) {\n\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $tag);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * When a product has a new review added, purge the recent reviews widget.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param $unused\n\t * @param integer $comment_approved Whether the comment is approved or not.\n\t * @param array   $commentdata Information about the comment.\n\t */\n\tpublic function add_review( $unused, $comment_approved, $commentdata ) {\n\t\tif (!function_exists('wc_get_product')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$post_id = $commentdata['comment_post_ID'];\n\t\tif ($comment_approved !== 1 || !isset($post_id) || wc_get_product($post_id) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tglobal $wp_widget_factory;\n\t\tif (!isset($wp_widget_factory->widgets['WC_Widget_Recent_Reviews'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$recent_reviews = $wp_widget_factory->widgets['WC_Widget_Recent_Reviews'];\n\t\tif (!is_null($recent_reviews)) {\n\t\t\tdo_action('litespeed_tag_add_widget', $recent_reviews->id);\n\t\t}\n\t}\n\n\t/**\n\t * Append new options\n\t *\n\t * @since 1.6.3 Removed static\n\t * @since  3.0 new API\n\t */\n\tprivate function _option_append() {\n\t\t// Append option save value filter\n\t\tdo_action('litespeed_conf_multi_switch', self::O_UPDATE_INTERVAL, 3); // This need to be before conf_append\n\n\t\tdo_action('litespeed_conf_append', self::O_UPDATE_INTERVAL, false);\n\t\tdo_action('litespeed_conf_append', self::O_CART_VARY, false);\n\t}\n\n\t/**\n\t * Hooked to `litespeed_settings_tab` action.\n\t * Adds the integration configuration options (currently, to determine purge rules)\n\t *\n\t * @since 1.6.3 Removed static\n\t */\n\tpublic function settings_add_tab( $setting_page ) {\n\t\tif ($setting_page != 'cache') {\n\t\t\treturn;\n\t\t}\n\n\t\trequire 'woocommerce.tab.tpl.php';\n\t}\n\n\t/**\n\t * Hook to show config content\n\t *\n\t * @since  3.0\n\t */\n\tpublic function settings_add_content( $setting_page ) {\n\t\tif ($setting_page != 'cache') {\n\t\t\treturn;\n\t\t}\n\n\t\trequire 'woocommerce.content.tpl.php';\n\t}\n\n\t/**\n\t * Helper function to select the function(s) to use to get the product\n\t * category ids.\n\t *\n\t * @since 1.0.10\n\t * @since 1.6.3 Removed static\n\t * @access private\n\t * @param int $product_id The product id\n\t * @return array An array of category ids.\n\t */\n\tprivate function get_cats( $product_id ) {\n\t\tif (!function_exists('WC')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$woocom = WC();\n\t\tif (isset($woocom) && version_compare($woocom->version, '2.5.0', '>=') && function_exists('wc_get_product_cat_ids')) {\n\t\t\treturn wc_get_product_cat_ids($product_id);\n\t\t}\n\t\t$product_cats = wp_get_post_terms($product_id, 'product_cat', array( 'fields' => 'ids' ));\n\t\tforeach ($product_cats as $product_cat) {\n\t\t\t$product_cats = array_merge($product_cats, get_ancestors($product_cat, 'product_cat'));\n\t\t}\n\n\t\treturn $product_cats;\n\t}\n\n\t/**\n\t * 3rd party prepload\n\t *\n\t * @since  2.9.8.4\n\t */\n\tpublic static function preload() {\n\t\t/**\n\t\t * Auto puge for WooCommerce Advanced Bulk Edit plugin,\n\t\t * Bulk edit hook need to add to preload as it will die before detect.\n\t\t */\n\t\tadd_action('wp_ajax_wpmelon_adv_bulk_edit', __CLASS__ . '::bulk_edit_purge', 1);\n\t}\n\n\t/**\n\t * Auto puge for WooCommerce Advanced Bulk Edit plugin,\n\t *\n\t * @since  2.9.8.4\n\t */\n\tpublic static function bulk_edit_purge() {\n\t\tif (empty($_POST['type']) || $_POST['type'] != 'saveproducts' || empty($_POST['data'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t/*\n\t\t * admin-ajax form-data structure\n\t\t * array(\n\t\t *      \"type\" => \"saveproducts\",\n\t\t *      \"data\" => array(\n\t\t *          \"column1\" => \"464$###0$###2#^#463$###0$###4#^#462$###0$###6#^#\",\n\t\t *          \"column2\" => \"464$###0$###2#^#463$###0$###4#^#462$###0$###6#^#\"\n\t\t *      )\n\t\t *  )\n\t\t */\n\t\t$stock_string_arr = array();\n\t\tforeach ($_POST['data'] as $stock_value) {\n\t\t\t$stock_string_arr = array_merge($stock_string_arr, explode('#^#', $stock_value));\n\t\t}\n\n\t\t$lscwp_3rd_woocommerce = new self();\n\n\t\tif (count($stock_string_arr) < 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tforeach ($stock_string_arr as $edited_stock) {\n\t\t\t$product_id = strtok($edited_stock, '$');\n\t\t\t$product    = wc_get_product($product_id);\n\n\t\t\tif (empty($product)) {\n\t\t\t\tdo_action('litespeed_debug', '3rd woo purge: ' . $product_id . ' not found.');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$lscwp_3rd_woocommerce->purge_product($product);\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wptouch.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with the WPTouch Mobile plugin.\n *\n * @since       1.0.7\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WpTouch {\n\n\t/**\n\t * Detects if WPTouch is installed.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t */\n\tpublic static function detect() {\n\t\tglobal $wptouch_pro;\n\t\tif (isset($wptouch_pro)) {\n\t\t\tadd_action('litespeed_control_finalize', __CLASS__ . '::set_control');\n\t\t}\n\t}\n\n\t/**\n\t * Check if the device is mobile. If so, set mobile.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t */\n\tpublic static function set_control() {\n\t\tglobal $wptouch_pro;\n\t\tif ($wptouch_pro->is_mobile_device) {\n\t\t\tadd_filter('litespeed_is_mobile', '__return_true');\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/thirdparty/wcml.cls.php": "<?php\n// phpcs:ignoreFile\n/**\n * The Third Party integration with WCML.\n *\n * @since       3.0\n */\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WCML {\n\n\tprivate static $_currency = '';\n\n\tpublic static function detect() {\n\t\tif (!defined('WCML_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('wcml_client_currency', __CLASS__ . '::apply_client_currency');\n\t\tadd_action('wcml_set_client_currency', __CLASS__ . '::set_client_currency');\n\t}\n\n\tpublic static function set_client_currency( $currency ) {\n\t\tself::apply_client_currency($currency);\n\n\t\tdo_action('litespeed_vary_ajax_force');\n\t}\n\n\tpublic static function apply_client_currency( $currency ) {\n\t\tif ($currency !== wcml_get_woocommerce_currency_option()) {\n\t\t\tself::$_currency = $currency;\n\t\t\tadd_filter('litespeed_vary', __CLASS__ . '::apply_vary');\n\t\t}\n\n\t\treturn $currency;\n\t}\n\n\tpublic static function apply_vary( $list ) {\n\t\t$list['wcml_currency'] = self::$_currency;\n\t\treturn $list;\n\t}\n}\n",
    "plugins/litespeed-cache/data/cache_nocacheable.txt": "# Predefined list for Do Not Cache URIs #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/cache_nocacheable.txt We will merge into next plugin release\n\n\n# WP v6.6 Official Site Editor (Appearance >> Editor)\n^/wp-json/wp/v2",
    "plugins/litespeed-cache/data/css_excludes.txt": "# Predefined list for excluding CSS files or inline CSS codes #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/css_excludes.txt We will merge into next plugin release\n\n# CSS file URL excludes\n\n\n\n# Inline CSS excludes\n\n########## Flatsome theme random string excludes ############\n#row-\n#col-\n#cats-\n#stack-\n#timer-\n#gap-\n#portfolio-\n#image_\n#banner-\n#map-\n#text-\n#page-header-\n#section_\n\n.tdi_ # Theme: Newspaper by tagDiv.com 2020\n\n######### WoodMart - Responsive WooCommerce WordPress Theme ########\n.tabs-wd-\n#wd-",
    "plugins/litespeed-cache/data/esi.nonces.txt": "## To predefine more list, please submit a PR to https://github.com/litespeedtech/lscache_wp/blob/dev/data/esi.nonces.txt\n## \t Comment Format:\n## \t\t1. `# this is comment`\n## \t\t2. `##this is comment`\n\n\n## Predefined elsewhere so not needed here:\n\n## WordPress core\n# stats_nonce\n# subscribe_nonce\n\n# Divi Theme Builder\n# et-pb-contact-form-submit\n# et_frontend_nonce\n# et_ab_log_nonce\n\n# WooCommerce PayPal Checkout\n# _wc_ppec_update_shipping_costs_nonce private\n# _wc_ppec_start_checkout_nonce private\n# _wc_ppec_generate_cart_nonce private\n\n# User Switching\n# switch_to_olduser_'<ID>'\n\n# Caldera Forms\n# caldera_forms_front_*\n\n\n## Predefined list of ESI nonces:\n\n# WordPress REST nonce\nwp_rest\n\n# CM Registration Pro\ncmreg_registration_nonce private\nrole_nonce private\n\n# WooCommerce Delivery Area Pro #16843635\nwdap-call-nonce private\n\n# SEOpress Cookie Consent\nseopress_cookies_user_consent_nonce\n\n# SearchWP Metrics\nswpmtxnonce\n\n# The Events Calendar\n_tec_view_rest_nonce_primary\n_tec_view_rest_nonce_secondary\n\n# wpDataTables #986128\nwdt*\n\n# WPBakery gallery\n_vcnonce\ndata-vc-public-nonce\n\n# Extra Theme\nrating_nonce\ntimeline_nonce\nblog_feed_nonce\n\n# WS Form\nwsf_post\n\n# Easy Digital Download (EDD)\nedd-* private\nedd_* private\n\n# WP Menu Cart\nwpmenucart private\n\n# Advanced Custom Fields + Advanced Forms\nacf_nonce\naf_form_nonce\naf_submission_*\n\n# Woo nonce\nwoocommerce-login\n\n# Premium Addons for Elementor\npa-blog-widget-nonce\n\n# WPUF User Frontend\nwpuf* private\n\n# MetForm\nform_nonce\n\n# Mobile hamburger menu - jetMenu #306983 #163710 PR#419\ntgmpa-*\nbulk-*\n\n# WP Data Access\nwpda-*\n\n# Elementor\nelementor-pro-frontend\nelementor-conversion-center-click",
    "plugins/litespeed-cache/data/js_defer_excludes.txt": "# Predefined list for excluding deferred JS files or inline JS codes #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/js_defer_excludes.txt We will merge into next plugin release\n\n# JS file URL excludes\nadsbygoogle\n\n## JetPack Stats\nstats.wp.com/e-\n_stq\n\n# Cloudflare turnstile - Tobolo\nturnstile\nchallenges.cloudflare.com",
    "plugins/litespeed-cache/data/esi.nonce.txt": "# !!!!! Legacy file for v3.5.1- !!!!!\n\n## Predefined elsewhere so not needed here:\n\n## WordPress core\n#stats_nonce\n#subscribe_nonce\n\n# Divi Theme Builder\n#et-pb-contact-form-submit\n#et_frontend_nonce\n#et_ab_log_nonce\n\n# WooCommerce PayPal Checkout\n#_wc_ppec_update_shipping_costs_nonce private\n#_wc_ppec_start_checkout_nonce private\n#_wc_ppec_generate_cart_nonce private\n\n# User Switching\n#switch_to_olduser_'<ID>'\n\n# Caldera Forms\n#caldera_forms_front_*\n\n## Predefined list of ESI nonces:\n\n# CM Registration Pro\ncmreg_registration_nonce private\nrole_nonce private\n\n# WooCommerce Delivery Area Pro #16843635\nwdap-call-nonce private\n\n# SEOpress Cookie Consent\nseopress_cookies_user_consent_nonce\n\n#SearchWP Metrics\nswpmtxnonce\n\n#wpDataTables #986128\nwdt*\n",
    "plugins/litespeed-cache/data/const.default.json": "{\n\t\"auto_upgrade\": \"\",\n\t\"server_ip\": \"\",\n\t\"guest\": \"\",\n\t\"guest_optm\": \"\",\n\t\"news\": \"1\",\n\t\"guest_uas\": \"Lighthouse\\nGTmetrix\\nGoogle\\nPingdom\\nbot\\nspider\\nPTST\\nHeadlessChrome\",\n\t\"guest_ips\": \"208.70.247.157\\n172.255.48.130\\n172.255.48.131\\n172.255.48.132\\n172.255.48.133\\n172.255.48.134\\n172.255.48.135\\n172.255.48.136\\n172.255.48.137\\n172.255.48.138\\n172.255.48.139\\n172.255.48.140\\n172.255.48.141\\n172.255.48.142\\n172.255.48.143\\n172.255.48.144\\n172.255.48.145\\n172.255.48.146\\n172.255.48.147\\n52.229.122.240\\n104.214.72.101\\n13.66.7.11\\n13.85.24.83\\n13.85.24.90\\n13.85.82.26\\n40.74.242.253\\n40.74.243.13\\n40.74.243.176\\n104.214.48.247\\n157.55.189.189\\n104.214.110.135\\n70.37.83.240\\n65.52.36.250\\n13.78.216.56\\n52.162.212.163\\n23.96.34.105\\n65.52.113.236\\n172.255.61.34\\n172.255.61.35\\n172.255.61.36\\n172.255.61.37\\n172.255.61.38\\n172.255.61.39\\n172.255.61.40\\n104.41.2.19\\n191.235.98.164\\n191.235.99.221\\n191.232.194.51\\n52.237.235.185\\n52.237.250.73\\n52.237.236.145\\n104.211.143.8\\n104.211.165.53\\n52.172.14.87\\n40.83.89.214\\n52.175.57.81\\n20.188.63.151\\n20.52.36.49\\n52.246.165.153\\n51.144.102.233\\n13.76.97.224\\n102.133.169.66\\n52.231.199.170\\n13.53.162.7\\n40.123.218.94\",\n\t\"cache-priv\": \"1\",\n\t\"cache-commenter\": \"1\",\n\t\"cache-rest\": \"1\",\n\t\"cache-page_login\": \"1\",\n\t\"cache-resources\": \"1\",\n\t\"cache-browser\": \"\",\n\t\"cache-mobile\": \"\",\n\t\"cache-mobile_rules\": \"Mobile\\nAndroid\\nSilk/\\nKindle\\nBlackBerry\\nOpera Mini\\nOpera Mobi\",\n\t\"cache-exc_useragents\": \"\",\n\t\"cache-exc_cookies\": \"\",\n\t\"cache-exc_qs\": \"\",\n\t\"cache-exc_cat\": \"\",\n\t\"cache-exc_tag\": \"\",\n\t\"cache-force_uri\": \"\",\n\t\"cache-force_pub_uri\": \"\",\n\t\"cache-priv_uri\": \"\",\n\t\"cache-exc\": \"\",\n\t\"cache-exc_roles\": \"\",\n\t\"cache-drop_qs\": \"fbclid\\ngclid\\nutm*\\n_ga\",\n\t\"cache-ttl_pub\": \"604800\",\n\t\"cache-ttl_priv\": \"1800\",\n\t\"cache-ttl_frontpage\": \"604800\",\n\t\"cache-ttl_feed\": \"604800\",\n\t\"cache-ttl_rest\": \"604800\",\n\t\"cache-ttl_browser\": \"31557600\",\n\t\"cache-login_cookie\": \"\",\n\t\"cache-vary_group\": \"\",\n\t\"cache-ttl_status\": \"404 3600\\n500 600\",\n\t\"purge-upgrade\": \"0\",\n\t\"purge-stale\": \"\",\n\t\"purge-post_all\": \"\",\n\t\"purge-post_f\": \"1\",\n\t\"purge-post_h\": \"1\",\n\t\"purge-post_p\": \"1\",\n\t\"purge-post_pwrp\": \"1\",\n\t\"purge-post_a\": \"1\",\n\t\"purge-post_y\": \"\",\n\t\"purge-post_m\": \"1\",\n\t\"purge-post_d\": \"\",\n\t\"purge-post_t\": \"1\",\n\t\"purge-post_pt\": \"1\",\n\t\"purge-timed_urls\": \"\",\n\t\"purge-timed_urls_time\": \"\",\n\t\"purge-hook_all\": \"switch_theme\\nwp_create_nav_menu\\nwp_update_nav_menu\\nwp_delete_nav_menu\\ncreate_term\\nedit_terms\\ndelete_term\\nadd_link\\nedit_link\\ndelete_link\",\n\t\"esi\": \"\",\n\t\"esi-cache_admbar\": \"1\",\n\t\"esi-cache_commform\": \"1\",\n\t\"esi-nonce\": \"stats_nonce\\nsubscribe_nonce\",\n\t\"util-heartbeat\": \"1\",\n\t\"util-instant_click\": \"\",\n\t\"util-no_https_vary\": \"\",\n\t\"debug-disable_all\": \"\",\n\t\"debug\": \"\",\n\t\"debug-ips\": \"127.0.0.1\",\n\t\"debug-level\": \"\",\n\t\"debug-filesize\": \"3\",\n\t\"debug-collapse_qs\": \"\",\n\t\"debug-inc\": \"\",\n\t\"debug-exc\": \"\",\n\t\"debug-exc_strings\": \"\",\n\t\"db_optm-revisions_max\": \"0\",\n\t\"db_optm-revisions_age\": \"0\",\n\t\"optm-css_min\": \"\",\n\t\"optm-css_comb\": \"\",\n\t\"optm-css_comb_ext_inl\": \"1\",\n\t\"optm-ucss\": \"\",\n\t\"optm-ucss_inline\": \"\",\n\t\"optm-ucss_file_exc_inline\": \"\",\n\t\"optm-ucss_whitelist\": \"\",\n\t\"optm-ucss_exc\": \"\",\n\t\"optm-css_exc\": \"\",\n\t\"optm-js_min\": \"\",\n\t\"optm-js_comb\": \"\",\n\t\"optm-js_comb_ext_inl\": \"1\",\n\t\"optm-js_exc\": \"jquery.js\\njquery.min.js\",\n\t\"optm-html_min\": \"\",\n\t\"optm-html_lazy\": \"\",\n\t\"optm-qs_rm\": \"\",\n\t\"optm-ggfonts_rm\": \"\",\n\t\"optm-css_async\": \"\",\n\t\"optm-ccss_per_url\": \"\",\n\t\"optm-ccss_whitelist\": \"\",\n\t\"optm-css_async_inline\": \"1\",\n\t\"optm-css_font_display\": \"\",\n\t\"optm-js_defer\": \"\",\n\t\"optm-emoji_rm\": \"\",\n\t\"optm-noscript_rm\": \"\",\n\t\"optm-ggfonts_async\": \"\",\n\t\"optm-exc_roles\": \"\",\n\t\"optm-ccss_con\": \"\",\n\t\"optm-ccss_sep_posttype\": \"page\",\n\t\"optm-ccss_sep_uri\": \"\",\n\t\"optm-js_defer_exc\": \"jquery.js\\njquery.min.js\\ngtm.js\\nanalytics.js\",\n\t\"optm-gm_js_exc\": \"\",\n\t\"optm-dns_prefetch\": \"\",\n\t\"optm-dns_prefetch_ctrl\": \"\",\n\t\"optm-dns_preconnect\": \"\",\n\t\"optm-exc\": \"\",\n\t\"optm-guest_only\": \"1\",\n\t\"object\": \"\",\n\t\"object-kind\": \"\",\n\t\"object-host\": \"localhost\",\n\t\"object-port\": \"11211\",\n\t\"object-life\": \"360\",\n\t\"object-persistent\": \"1\",\n\t\"object-admin\": \"1\",\n\t\"object-transients\": \"1\",\n\t\"object-db_id\": \"0\",\n\t\"object-user\": \"\",\n\t\"object-pswd\": \"\",\n\t\"object-global_groups\": \"users\\nuserlogins\\nuseremail\\nuserslugs\\nusermeta\\nuser_meta\\nsite-transient\\nsite-options\\nsite-lookup\\nsite-details\\nblog-lookup\\nblog-details\\nblog-id-cache\\nrss\\nglobal-posts\\nglobal-cache-test\",\n\t\"object-non_persistent_groups\": \"comment\\ncounts\\nplugins\\nwc_session_id\",\n\t\"discuss-avatar_cache\": \"\",\n\t\"discuss-avatar_cron\": \"\",\n\t\"discuss-avatar_cache_ttl\": \"604800\",\n\t\"optm-localize\": \"\",\n\t\"optm-localize_domains\": \"### Popular scripts ###\\nhttps://platform.twitter.com/widgets.js\\nhttps://connect.facebook.net/en_US/fbevents.js\",\n\t\"media-lazy\": \"\",\n\t\"media-lazy_placeholder\": \"\",\n\t\"media-placeholder_resp\": \"\",\n\t\"media-placeholder_resp_color\": \"#cfd4db\",\n\t\"media-placeholder_resp_svg\": \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"{width}\\\" height=\\\"{height}\\\" viewBox=\\\"0 0 {width} {height}\\\"><rect width=\\\"100%\\\" height=\\\"100%\\\" style=\\\"fill:{color};fill-opacity: 0.1;\\\"/></svg>\",\n\t\"media-lqip\": \"\",\n\t\"media-lqip_qual\": \"4\",\n\t\"media-lqip_min_w\": \"150\",\n\t\"media-lqip_min_h\": \"150\",\n\t\"media-placeholder_resp_async\": \"1\",\n\t\"media-iframe_lazy\": \"\",\n\t\"media-add_missing_sizes\": \"\",\n\t\"media-lazy_exc\": \"\",\n\t\"media-lazy_cls_exc\": \"wmu-preview-img\",\n\t\"media-lazy_parent_cls_exc\": \"\",\n\t\"media-iframe_lazy_cls_exc\": \"\",\n\t\"media-iframe_lazy_parent_cls_exc\": \"\",\n\t\"media-lazy_uri_exc\": \"\",\n\t\"media-lqip_exc\": \"\",\n\t\"media-vpi\": \"\",\n\t\"media-vpi_cron\": \"\",\n\t\"img_optm-auto\": \"\",\n\t\"img_optm-ori\": \"1\",\n\t\"img_optm-rm_bkup\": \"\",\n\t\"img_optm-webp\": \"\",\n\t\"img_optm-lossless\": \"\",\n\t\"img_optm-exif\": \"1\",\n\t\"img_optm-webp_attr\": \"img.src\\ndiv.data-thumb\\nimg.data-src\\nimg.data-lazyload\\ndiv.data-large_image\\nimg.retina_logo_url\\ndiv.data-parallax-image\\ndiv.data-vc-parallax-image\\nvideo.poster\",\n\t\"img_optm-webp_replace_srcset\": \"\",\n\t\"img_optm-jpg_quality\": \"82\",\n\t\"crawler\": \"\",\n\t\"crawler-crawl_interval\": \"302400\",\n\t\"crawler-load_limit\": \"1\",\n\t\"crawler-sitemap\": \"\",\n\t\"crawler-roles\": \"\",\n\t\"crawler-cookies\": \"\",\n\t\"misc-heartbeat_front\": \"\",\n\t\"misc-heartbeat_front_ttl\": \"60\",\n\t\"misc-heartbeat_back\": \"\",\n\t\"misc-heartbeat_back_ttl\": \"60\",\n\t\"misc-heartbeat_editor\": \"\",\n\t\"misc-heartbeat_editor_ttl\": \"15\",\n\t\"cdn\": \"\",\n\t\"cdn-attr\": \".src\\n.data-src\\n.href\\n.poster\\nsource.srcset\",\n\t\"cdn-ori\": \"\",\n\t\"cdn-ori_dir\": \"\",\n\t\"cdn-exc\": \"\",\n\t\"cdn-quic\": \"\",\n\t\"cdn-quic_email\": \"\",\n\t\"cdn-quic_key\": \"\",\n\t\"cdn-cloudflare\": \"\",\n\t\"cdn-cloudflare_email\": \"\",\n\t\"cdn-cloudflare_key\": \"\",\n\t\"cdn-cloudflare_name\": \"\",\n\t\"cdn-cloudflare_zone\": \"\",\n\t\"cdn-cloudflare_clear\": \"\",\n\t\"cdn-mapping\": {\n\t\t\"url\": [\"\"],\n\t\t\"inc_js\": [\"1\"],\n\t\t\"inc_css\": [\"1\"],\n\t\t\"inc_img\": [\"1\"],\n\t\t\"filetype\": [\".aac\\n.css\\n.eot\\n.gif\\n.jpeg\\n.jpg\\n.js\\n.less\\n.mp3\\n.mp4\\n.ogg\\n.otf\\n.pdf\\n.png\\n.svg\\n.ttf\\n.webp\\n.woff\\n.woff2\"]\n\t}\n}\n",
    "plugins/litespeed-cache/data/js_excludes.txt": "# Predefined list for excluding JS files or inline JS codes #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/js_excludes.txt We will merge into next plugin release\n\n# JS file URL excludes\nmaps-api-ssl.google.com\nmaps.google.com/maps\nmaps.googleapis.com\ngoogle.com/recaptcha\ngoogle-analytics.com/analytics.js\nstats.wp.com\njs.stripe.com\npaypal.com/sdk/js\ncse.google.com/cse.js\n/syntaxhighlighter/\nspotlight-social-photo-feeds ## https://docs.spotlightwp.com/article/757-autoptimize-compatibility @Tobolo\nuserway.org\n\n# Inline JS excludes\ndocument.write\ngtag\ngtm\ndataLayer\nadsbygoogle\n\nblock_tdi_ ## Theme: Newspaper by tagDiv.com\n\ndata-view-breakpoint-pointer ## Plugin: The Events Calendar by Modern Tribe (https://theeventscalendar.com/)\n\nwp-json/wp-statistics ## WP Statistics\n\n## JetPack Stats\nstats.wp.com/e-\n_stq\n\n# Cloudflare turnstile - Tobolo\nturnstile\nchallenges.cloudflare.com",
    "plugins/litespeed-cache/data/ccss_whitelist.txt": "# Predefined list for CCSS whitelist #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/ccss_whitelist.txt We will merge into next plugin release\n\n\n############# DoBar compatibility #############\n.pace-inactive\n\n############# DIVI ################\n.et_pb_number_counter.active\n",
    "plugins/litespeed-cache/data/const.network_default.json": "{\n\t\"cache\": false,\n\t\"use_primary_settings\": false,\n\t\"auto_upgrade\": false,\n\t\"cache-resources\": true,\n\t\"cache-browser\": false,\n\t\"cache-mobile\": false,\n\t\"cache-mobile_rules\": \"Mobile\\nAndroid\\nSilk/\\nKindle\\nBlackBerry\\nOpera Mini\\nOpera Mobi\",\n\t\"cache-login_cookie\": \"\",\n\t\"cache-exc_cookies\": \"\",\n\t\"cache-exc_useragents\": \"\",\n\t\"cache-ttl_browser\": 31557600,\n\t\"purge-upgrade\": false,\n\t\"object\": false,\n\t\"object-kind\": false,\n\t\"object-host\": \"localhost\",\n\t\"object-port\": 11211,\n\t\"object-life\": 360,\n\t\"object-persistent\": true,\n\t\"object-admin\": true,\n\t\"object-transients\": true,\n\t\"object-db_id\": 0,\n\t\"object-user\": \"\",\n\t\"object-pswd\": \"\",\n\t\"object-global_groups\": \"users\\nuserlogins\\nusermeta\\nuser_meta\\nuseremail\\nuserslugs\\nsites\\nsite-details\\nsite-transient\\nsite-options\\nsite-lookup\\nblog-lookup\\nblog-id-cache\\nblog-details\\nnetworks\\nrss\\nglobal-posts\\nglobal-cache-test\",\n\t\"object-non_persistent_groups\": \"comment\\ncounts\\nplugins\",\n\t\"debug-disable_all\": false,\n\t\"debug\": false,\n\t\"debug-ips\": \"127.0.0.1\",\n\t\"debug-level\": false,\n\t\"debug-filesize\": 3,\n\t\"debug-collapse_qs\": false,\n\t\"debug-inc\": \"\",\n\t\"debug-exc\": \"\",\n\t\"debug-exc_strings\": \"\",\n\t\"img_optm-webp\": false\n}\n",
    "plugins/litespeed-cache/data/ucss_whitelist.txt": "# Predefined list for UCSS whitelist #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/ucss_whitelist.txt We will merge into next plugin release\n\n\n############# DoBar compatibility #############\n.pace-inactive\n\n############# DIVI ################\n.et_pb_number_counter.active",
    "plugins/litespeed-cache/data/optm_uri_exc.txt": "# Predefined list for excluding URI from page optimization #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https://github.com/litespeedtech/lscache_wp/blob/dev/data/optm_uri_exc.txt We will merge into next plugin release\n\n# URI excludes\n.well-known",
    "plugins/litespeed-cache/tpl/toolbox/report.tpl.php": "<?php\n/**\n * LiteSpeed Cache Report Interface\n *\n * Renders the report interface for LiteSpeed Cache, allowing users to generate and send environment reports to LiteSpeed Support.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$_report = Report::cls();\n$report  = $_report->generate_environment_report();\n\n$env_ref = Report::get_summary();\n\n// Detect passwordless plugin\n$dologin_link        = '';\n$has_pswdless_plugin = false;\nif ( function_exists( 'dologin_gen_link' ) ) {\n\t$has_pswdless_plugin = true;\n\tif ( ! empty( $_GET['dologin_gen_link'] ) && ! empty( $_GET['litespeed_purge_nonce'] ) && wp_verify_nonce( sanitize_text_field( wp_unslash( $_GET['litespeed_purge_nonce'] ) ), 'litespeed_purge_action' ) ) {\n\t\tunset( $_GET['dologin_gen_link'] );\n\t\t$dologin_link = dologin_gen_link( 'Litespeed Report' );\n\t\t?>\n\t\t<script>\n\t\t\twindow.history.pushState('remove_gen_link', document.title, window.location.href.replace('&dologin_gen_link=1', ''));\n\t\t</script>\n\t\t<?php\n\t}\n}\n\n$install_link = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_INSTALL_3RD, false, null, array( 'plugin' => 'dologin' ) );\n\n$btn_title = esc_html__( 'Send to LiteSpeed', 'litespeed-cache' );\nif ( ! empty( $env_ref['num'] ) ) {\n\t$btn_title = esc_html__( 'Regenerate and Send a New Report', 'litespeed-cache' );\n}\n?>\n\n<?php if ( ! $has_pswdless_plugin ) : ?>\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?></h4>\n\t\t<p>\n\t\t\t<?php printf( esc_html__( 'To generate a passwordless link for LiteSpeed Support Team access, you must install %s.', 'litespeed-cache' ), '<a href=\"https://wordpress.org/plugins/dologin/\" target=\"_blank\">DoLogin Security</a>' ); ?>\n\t\t</p>\n\t\t<p>\n\t\t\t<a href=\"<?php echo esc_url( $install_link ); ?>\" class=\"button litespeed-btn litespeed-right20\"><?php esc_html_e( 'Install DoLogin Security', 'litespeed-cache' ); ?></a>\n\t\t\t<a href=\"<?php echo esc_url( admin_url( 'plugin-install.php?s=dologin+security&tab=search&type=term' ) ); ?>\" target=\"_blank\"><?php esc_html_e( 'Go to plugins list', 'litespeed-cache' ); ?></a>\n\t\t</p>\n\t</div>\n<?php endif; ?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'LiteSpeed Report', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#report-tab' ); ?>\n</h3>\n\n<p><?php esc_html_e( 'Last Report Number', 'litespeed-cache' ); ?>: <b><?php echo ! empty( $env_ref['num'] ) ? '<span id=\"report_span\" style=\"cursor: pointer;\" onClick=\"litespeed_copy_to_clipboard(\\'report_span\\', this)\" aria-label=\"' . esc_attr__( 'Click to copy', 'litespeed-cache' ) . '\" data-balloon-pos=\"down\" class=\"litespeed-wrap\">' . esc_html( $env_ref['num'] ) . '</span>' : '-'; ?></b></p>\n<p><?php esc_html_e( 'Last Report Date', 'litespeed-cache' ); ?>: <b><?php echo ! empty( $env_ref['dateline'] ) ? esc_html( gmdate( 'm/d/Y H:i:s', $env_ref['dateline'] ) ) : '-'; ?></b></p>\n\n<p class=\"litespeed-desc\">\n\t<?php esc_html_e( 'The environment report contains detailed information about the WordPress configuration.', 'litespeed-cache' ); ?>\n\t<br />\n\t<?php esc_html_e( 'If you run into any issues, please refer to the report number in your support message.', 'litespeed-cache' ); ?>\n</p>\n\n<?php $this->form_action( Router::ACTION_REPORT, Report::TYPE_SEND_REPORT ); ?>\n\t<table class=\"wp-list-table striped litespeed-table\">\n\t\t<tbody>\n\t\t\t<tr>\n\t\t\t\t<th><?php esc_html_e( 'System Information', 'litespeed-cache' ); ?></th>\n\t\t\t\t<td>\n\t\t\t\t\t<textarea id=\"litespeed-report\" rows=\"20\" cols=\"100\" readonly><?php echo esc_textarea( $report ); ?></textarea>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<th></th>\n\t\t\t\t<td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$this->build_checkbox(\n\t\t\t\t\t\t'attach_php',\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\tesc_html__( 'Attach PHP info to report. Check this box to insert relevant data from %s.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<a href=\"https://www.php.net/manual/en/function.phpinfo.php\" target=\"_blank\">phpinfo()</a>'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<th><?php esc_html_e( 'Passwordless Link', 'litespeed-cache' ); ?></th>\n\t\t\t\t<td>\n\t\t\t\t\t<input type=\"text\" class=\"litespeed-regular-text\" id=\"litespeed-report-link\" name=\"link\" value=\"<?php echo esc_attr( $dologin_link ); ?>\" style=\"width:500px;\" />\n\t\t\t\t\t<?php if ( $has_pswdless_plugin ) : ?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( wp_nonce_url( admin_url( 'admin.php?page=litespeed-toolbox&dologin_gen_link=1' ), 'litespeed_purge_action', 'litespeed_purge_nonce' ) ); ?>\" class=\"button button-secondary\"><?php esc_html_e( 'Generate Link for Current User', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<button type=\"button\" class=\"button button-secondary\" disabled><?php esc_html_e( 'Generate Link for Current User', 'litespeed-cache' ); ?></button>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php esc_html_e( 'To grant wp-admin access to the LiteSpeed Support Team, please generate a passwordless link for the current logged-in user to be sent with the report.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php if ( $dologin_link ) : ?>\n\t\t\t\t\t\t\t<br /><strong>🚨 <?php esc_html_e( 'Please do NOT share the above passwordless link with anyone.', 'litespeed-cache' ); ?></strong>\n\t\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t/* translators: %s: Link tags */\n\t\t\t\t\t\t\t\t\tesc_html__( 'Generated links may be managed under %sSettings%s.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<a href=\"' . esc_url( menu_page_url( 'dologin', false ) ) . '#pswdless\">',\n\t\t\t\t\t\t\t\t\t'</a>' );\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<th><?php esc_html_e( 'Notes', 'litespeed-cache' ); ?></th>\n\t\t\t\t<td>\n\t\t\t\t\t<textarea name=\"notes\" rows=\"10\" cols=\"100\"></textarea>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php esc_html_e( 'Optional', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php esc_html_e( 'provide more information here to assist the LiteSpeed team with debugging.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</tbody>\n\t</table>\n\n\t<div class=\"litespeed-top20\"></div>\n\t<button class=\"button button-primary\" type=\"submit\"><?php echo esc_html( $btn_title ); ?></button>\n\t<button class=\"button button-primary litespeed-float-submit\" type=\"submit\"><?php echo esc_html( $btn_title ); ?></button>\n\n\t<p class=\"litespeed-top30 litespeed-left10 litespeed-desc\">\n\t\t<?php esc_html_e( 'Send this report to LiteSpeed. Refer to this report number when posting in the WordPress support forum.', 'litespeed-cache' ); ?>\n\t</p>\n</form>",
    "plugins/litespeed-cache/tpl/toolbox/import_export.tpl.php": "<?php\n/**\n * LiteSpeed Cache Import/Export Settings\n *\n * Renders the import/export settings interface for LiteSpeed Cache, allowing users to export, import, or reset plugin settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$summary = Import::get_summary();\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Export Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#importexport-tab' ); ?>\n</h3>\n\n<div>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMPORT, Import::TYPE_EXPORT ) ); ?>\" class=\"button button-primary\">\n\t\t<?php esc_html_e( 'Export', 'litespeed-cache' ); ?>\n\t</a>\n</div>\n\n<?php if ( ! empty( $summary['export_file'] ) ) : ?>\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Last exported', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $summary['export_file'] ); ?></code> <?php echo esc_html( Utility::readable_time( $summary['export_time'] ) ); ?>\n\t</div>\n<?php endif; ?>\n\n<div class=\"litespeed-desc\">\n\t<?php esc_html_e( 'This will export all current LiteSpeed Cache settings and save them as a file.', 'litespeed-cache' ); ?>\n</div>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Import Settings', 'litespeed-cache' ); ?>\n</h3>\n\n<?php $this->form_action( Router::ACTION_IMPORT, Import::TYPE_IMPORT, true ); ?>\n\t<div class=\"litespeed-div\">\n\t\t<input type=\"file\" name=\"ls_file\" class=\"litespeed-input\" />\n\t</div>\n\t<div class=\"litespeed-div\">\n\t\t<?php submit_button( esc_html__( 'Import', 'litespeed-cache' ), 'button button-primary', 'litespeed-submit' ); ?>\n\t</div>\n</form>\n\n<?php if ( ! empty( $summary['import_file'] ) ) : ?>\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Last imported', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $summary['import_file'] ); ?></code> <?php echo esc_html( Utility::readable_time( $summary['import_time'] ) ); ?>\n\t</div>\n<?php endif; ?>\n\n<div class=\"litespeed-desc\">\n\t<?php esc_html_e( 'This will import settings from a file and override all current LiteSpeed Cache settings.', 'litespeed-cache' ); ?>\n</div>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Reset All Settings', 'litespeed-cache' ); ?>\n</h3>\n\n<div>\n\t<p class=\"litespeed-danger\">🚨 <?php esc_html_e( 'This will reset all settings to default settings.', 'litespeed-cache' ); ?></p>\n</div>\n<div>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMPORT, Import::TYPE_RESET ) ); ?>\" data-litespeed-cfm=\"<?php echo esc_attr( __( 'Are you sure you want to reset all settings back to the default settings?', 'litespeed-cache' ) ); ?>\" class=\"button litespeed-btn-danger-bg\">\n\t\t<?php esc_html_e( 'Reset Settings', 'litespeed-cache' ); ?>\n\t</a>\n</div>",
    "plugins/litespeed-cache/tpl/toolbox/settings-debug.tpl.php": "<?php\n/**\n * LiteSpeed Cache Debug Settings Interface\n *\n * Renders the debug settings interface for LiteSpeed Cache, allowing users to configure debugging options and view the site with specific settings bypassed.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action( $this->_is_network_admin ? Router::ACTION_SAVE_SETTINGS_NETWORK : false );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Debug Helpers', 'litespeed-cache' ); ?>\n</h3>\n\n<a href=\"<?php echo esc_url( home_url( '/' ) . '?' . Router::ACTION . '=before_optm' ); ?>\" class=\"button button-success\" target=\"_blank\">\n\t<?php esc_html_e( 'View Site Before Optimization', 'litespeed-cache' ); ?>\n</a>\n\n<a href=\"<?php echo esc_url( home_url( '/' ) . '?' . Router::ACTION . '=' . Core::ACTION_QS_NOCACHE ); ?>\" class=\"button button-success\" target=\"_blank\">\n\t<?php esc_html_e( 'View Site Before Cache', 'litespeed-cache' ); ?>\n</a>\n\n\n<?php\n$temp_disabled_time = $this->conf( Base::DEBUG_TMP_DISABLE );\n$temp_disabled      = Debug2::is_tmp_disable();\nif ( !$temp_disabled ) {\n?>\n\t<a href=\"<?php echo wp_kses_post( Utility::build_url(Router::ACTION_TMP_DISABLE, false, false, '_ori') ); ?>\" class=\"button litespeed-btn-danger\">\n\t\t<?php esc_html_e( 'Disable All Features for 24 Hours', 'litespeed-cache' ); ?>\n\t</a>\n<?php\n} else {\n\t$date = wp_date( get_option('date_format') . ' ' . get_option( 'time_format' ), $temp_disabled_time );\n?>\n\t<a href=\"<?php echo wp_kses_post( Utility::build_url(Router::ACTION_TMP_DISABLE, false, false, '_ori') ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Remove `Disable All Feature` Flag Now', 'litespeed-cache' ); ?>\n\t</a>\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?></h4>\n\t\t<p><?php echo wp_kses_post( sprintf ( __( 'LiteSpeed Cache is temporarily disabled until: %s.', 'litespeed-cache' ), '<strong>' . $date . '</strong>' ) ); ?></p>\n\t</div>\n<?php\n}\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Debug Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#debug-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_DISABLE_ALL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'This will disable LSCache and all optimization features for debug purpose.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), esc_html__( 'ON', 'litespeed-cache' ), esc_html__( 'Admin IP Only', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Outputs to a series of files in the %s directory.', 'litespeed-cache' ), '<code>wp-content/litespeed/debug</code>' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'To prevent filling up the disk, this setting should be OFF when everything is working.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'The Admin IP option will only output log messages on requests from admin IPs listed below.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_IPS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id, 50 ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Allows listed IPs (one per line) to perform certain actions from their browsers.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Your IP', 'litespeed-cache' ); ?>: <code><?php echo esc_html( Router::get_ip() ); ?></code>\n\t\t\t\t\t<?php $this->_validate_ip( $option_id ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<?php\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t'https://docs.litespeedtech.com/lscache/lscwp/admin/#admin-ip-commands',\n\t\t\t\t\t\tesc_html__( 'More information about the available commands can be found here.', 'litespeed-cache' )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_LEVEL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'Basic', 'litespeed-cache' ), esc_html__( 'Advanced', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Advanced level will log more details.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_FILESIZE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php esc_html_e( 'MB', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the maximum size of the log file.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 3, 3000 ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_COLLAPSE_QS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Shorten query strings in the debug log to improve readability.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_INC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Only log listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent any debug log of listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_EXC_STRINGS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent writing log entries that include listed strings.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<?php $this->form_end(); ?>",
    "plugins/litespeed-cache/tpl/toolbox/beta_test.tpl.php": "<?php\n/**\n * LiteSpeed Cache Beta Test\n *\n * Renders the beta test interface for LiteSpeed Cache, allowing users to switch plugin versions or test GitHub commits.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n// List of available public versions\n$v_list = array(\n\t'7.4',\n\t'7.3.0.1',\n\t'7.3',\n\t'7.2',\n\t'7.1',\n\t'7.0.1',\n\t'6.5.4',\n\t'5.7.0.1',\n\t'4.6',\n\t'3.6.4',\n);\n?>\n\n<?php $this->form_action( Router::ACTION_DEBUG2, Debug2::TYPE_BETA_TEST ); ?>\n\n\t<h3 class=\"litespeed-title\">\n\t\t<?php esc_html_e( 'Try GitHub Version', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#beta-test-tab' ); ?>\n\t</h3>\n\n\t<?php if ( defined( 'LITESPEED_DISABLE_ALL' ) && LITESPEED_DISABLE_ALL ) : ?>\n\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?></h4>\n\t\t\t<p><?php esc_html_e( 'LiteSpeed Cache is disabled. This functionality will not work.', 'litespeed-cache' ); ?></p>\n\t\t</div>\n\t<?php endif; ?>\n\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Use this section to switch plugin versions. To beta test a GitHub commit, enter the commit URL in the field below.', 'litespeed-cache' ); ?>\n\t</div>\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Example', 'litespeed-cache' ); ?>: <code>https://github.com/litespeedtech/lscache_wp/commit/example_comment_hash_d3ebec0535aaed5c932c0</code>\n\t</div>\n\n\t<input type=\"text\" name=\"<?php echo esc_attr( Debug2::BETA_TEST_URL ); ?>\" class=\"litespeed-input-long\" id=\"litespeed-beta-test\" value=\"\">\n\n\t<p>\n\t\t<a href=\"javascript:;\" class=\"button litespeed-btn-success\" onclick=\"document.getElementById('litespeed-beta-test').value='dev';\"><?php esc_html_e( 'Use latest GitHub Dev commit', 'litespeed-cache' ); ?></a> <code>dev</code>\n\t</p>\n\n\t<p>\n\t\t<a href=\"javascript:;\" class=\"button litespeed-btn-success\" onclick=\"document.getElementById('litespeed-beta-test').value='master';\"><?php esc_html_e( 'Use latest GitHub Master commit', 'litespeed-cache' ); ?></a> <code>master</code>\n\t</p>\n\n\t<p>\n\t\t<a href=\"javascript:;\" class=\"button litespeed-btn-success\" onclick=\"document.getElementById('litespeed-beta-test').value='latest';\"><?php esc_html_e( 'Use latest WordPress release version', 'litespeed-cache' ); ?></a> <code><?php echo esc_attr( Debug2::BETA_TEST_URL_WP ); ?></code> <?php esc_html_e( 'OR', 'litespeed-cache' ); ?> <code>latest</code>\n\t</p>\n\n\t<p>\n\t\t<?php foreach ( $v_list as $v ) : ?>\n\t\t\t<a href=\"javascript:;\" class=\"button <?php echo '3.6.4' === $v ? 'litespeed-btn-danger' : 'litespeed-btn-success'; ?>\" onclick=\"document.getElementById('litespeed-beta-test').value='<?php echo esc_attr( $v ); ?>';\"><?php echo esc_html( $v ); ?></a>\n\t\t<?php endforeach; ?>\n\t\t<span class=\"litespeed-danger\">\n\t\t\t🚨 <?php esc_html_e( 'Downgrade not recommended. May cause fatal error due to refactored code.', 'litespeed-cache' ); ?>\n\t\t</span>\n\t</p>\n\n\t<div class=\"litespeed-desc\">\n\t\t<?php printf( esc_html__( 'Press the %s button to use the most recent GitHub commit. Master is for release candidate & Dev is for experimental testing.', 'litespeed-cache' ), '<code>' . esc_html__( 'Use latest GitHub Dev/Master commit', 'litespeed-cache' ) . '</code>' ); ?>\n\t</div>\n\t<div class=\"litespeed-desc\">\n\t\t<?php printf( esc_html__( 'Press the %s button to stop beta testing and go back to the current release from the WordPress Plugin Directory.', 'litespeed-cache' ), '<code>' . esc_html__( 'Use latest WordPress release version', 'litespeed-cache' ) . '</code>' ); ?>\n\t</div>\n\n\t<p class=\"litespeed-danger\">\n\t\t🚨 <?php printf( esc_html__( 'In order to avoid an upgrade error, you must be using %1$s or later before you can upgrade to %2$s versions.', 'litespeed-cache' ), '<code>v3.6.4</code>', '<code>dev/master/v4+</code>' ); ?>\n\t</p>\n\n\t<button type=\"submit\" class=\"button button-primary\"><?php esc_html_e( 'Upgrade', 'litespeed-cache' ); ?></button>\n</form>",
    "plugins/litespeed-cache/tpl/toolbox/heartbeat.tpl.php": "<?php\n/**\n * LiteSpeed Cache Heartbeat Control\n *\n * Renders the heartbeat control settings interface for LiteSpeed Cache, allowing configuration of WordPress heartbeat intervals.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Heartbeat Control', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#heartbeat-tab' ); ?>\n</h3>\n\n<div class=\"litespeed-callout notice notice-warning inline\">\n\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?></h4>\n\t<p>\n\t\t<?php esc_html_e( 'Disable WordPress interval heartbeat to reduce server load.', 'litespeed-cache' ); ?>\n\t\t<span class=\"litespeed-warning\">\n\t\t\t🚨 <?php esc_html_e( 'Disabling this may cause WordPress tasks triggered by AJAX to stop working.', 'litespeed-cache' ); ?>\n\t\t</span>\n\t</p>\n</div>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_FRONT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Turn ON to control heartbeat on frontend.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_FRONT_TTL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Specify the %s heartbeat interval in seconds.', 'litespeed-cache' ), 'frontend' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'WordPress valid interval is %s seconds.', 'litespeed-cache' ), '<code>15</code> - <code>120</code>' ); ?><br />\n\t\t\t\t\t<?php printf( esc_html__( 'Set to %1$s to forbid heartbeat on %2$s.', 'litespeed-cache' ), '<code>0</code>', 'frontend' ); ?><br />\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 15, 120, true ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_BACK; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Turn ON to control heartbeat on backend.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_BACK_TTL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Specify the %s heartbeat interval in seconds.', 'litespeed-cache' ), 'backend' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'WordPress valid interval is %s seconds.', 'litespeed-cache' ), '<code>15</code> - <code>120</code>' ); ?><br />\n\t\t\t\t\t<?php printf( esc_html__( 'Set to %1$s to forbid heartbeat on %2$s.', 'litespeed-cache' ), '<code>0</code>', 'backend' ); ?><br />\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 15, 120, true ); ?>\n</div>\n</td>\n</tr>\n\n<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_EDITOR; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Turn ON to control heartbeat in backend editor.', 'litespeed-cache' ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_EDITOR_TTL; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t<?php printf( esc_html__( 'Specify the %s heartbeat interval in seconds.', 'litespeed-cache' ), 'backend editor' ); ?>\n\t\t<?php printf( esc_html__( 'WordPress valid interval is %s seconds.', 'litespeed-cache' ), '<code>15</code> - <code>120</code>' ); ?><br />\n\t\t<?php printf( esc_html__( 'Set to %1$s to forbid heartbeat on %2$s.', 'litespeed-cache' ), '<code>0</code>', 'backend editor' ); ?><br />\n\t\t<?php $this->recommended( $option_id ); ?>\n\t\t<?php $this->_validate_ttl( $option_id, 15, 120, true ); ?>\n\t</div>\n</td>\n</tr>\n\n</tbody>\n</table>\n\n<?php $this->form_end(); ?>",
    "plugins/litespeed-cache/tpl/toolbox/log_viewer.tpl.php": "<?php\n/**\n * LiteSpeed Cache Log Viewer\n *\n * Renders the log viewer interface for LiteSpeed Cache, displaying debug, purge, and crawler logs with options to copy or clear logs.\n *\n * @package LiteSpeed\n * @since 4.7\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$logs = array(\n\tarray(\n\t\t'name'      => 'debug',\n\t\t'label'     => esc_html__( 'Debug Log', 'litespeed-cache' ),\n\t\t'accesskey' => 'A',\n\t),\n\tarray(\n\t\t'name'      => 'purge',\n\t\t'label'     => esc_html__( 'Purge Log', 'litespeed-cache' ),\n\t\t'accesskey' => 'B',\n\t),\n\tarray(\n\t\t'name'      => 'crawler',\n\t\t'label'     => esc_html__( 'Crawler Log', 'litespeed-cache' ),\n\t\t'accesskey' => 'C',\n\t),\n);\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'LiteSpeed Logs', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#log-view-tab' ); ?>\n</h3>\n\n<div class=\"litespeed-log-subnav-wrapper\">\n\t<?php foreach ( $logs as $log ) : ?>\n\t\t<a href=\"#<?php echo esc_attr( $log['name'] ); ?>_log\" class=\"button button-secondary\" data-litespeed-subtab=\"<?php echo esc_attr( $log['name'] ); ?>_log\" litespeed-accesskey=\"<?php echo esc_attr( $log['accesskey'] ); ?>\">\n\t\t\t<?php echo esc_html( $log['label'] ); ?>\n\t\t</a>\n\t<?php endforeach; ?>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_DEBUG2, Debug2::TYPE_CLEAR_LOG ) ); ?>\" class=\"button button-primary\" litespeed-accesskey=\"D\">\n\t\t<?php esc_html_e( 'Clear Logs', 'litespeed-cache' ); ?>\n\t</a>\n</div>\n\n<?php\nforeach ( $logs as $log ) :\n\t$file      = $this->cls( 'Debug2' )->path( $log['name'] );\n\t$lines     = File::count_lines( $file );\n\t$max_lines = apply_filters( 'litespeed_debug_show_max_lines', 1000 );\n\t$start     = $lines > $max_lines ? $lines - $max_lines : 0;\n\t$lines     = File::read( $file, $start );\n\t$lines     = $lines ? trim( implode( \"\\n\", $lines ) ) : '';\n\n\t$log_body_id = 'litespeed-log-' . esc_attr( $log['name'] );\n?>\n\t<div class=\"litespeed-log-view-wrapper\" data-litespeed-sublayout=\"<?php echo esc_attr( $log['name'] ); ?>_log\">\n\t\t<h3 class=\"litespeed-title\">\n\t\t\t<?php echo esc_html( $log['label'] ); ?>\n\t\t\t<a href=\"#<?php echo esc_attr( $log['name'] ); ?>_log\" class=\"button litespeed-info-button litespeed-wrap\" onClick=\"litespeed_copy_to_clipboard('<?php echo esc_js( $log_body_id ); ?>', this)\" aria-label=\"<?php esc_attr_e( 'Click to copy', 'litespeed-cache' ); ?>\" data-balloon-pos=\"down\">\n\t\t\t\t<?php esc_html_e( 'Copy Log', 'litespeed-cache' ); ?>\n\t\t\t</a>\n\t\t</h3>\n\t\t<div class=\"litespeed-log-body\" id=\"<?php echo esc_attr( $log_body_id ); ?>\">\n\t\t\t<?php echo nl2br( esc_html( $lines ) ); ?>\n\t\t</div>\n\t</div>\n<?php endforeach; ?>\n\n<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_DEBUG2, Debug2::TYPE_CLEAR_LOG ) ); ?>\" class=\"button button-primary\">\n\t<?php esc_html_e( 'Clear Logs', 'litespeed-cache' ); ?>\n</a>",
    "plugins/litespeed-cache/tpl/toolbox/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Toolbox\n *\n * Renders the toolbox interface for LiteSpeed Cache, providing access to various administrative tools and settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'purge' => esc_html__( 'Purge', 'litespeed-cache' ),\n);\n\nif ( ! $this->_is_network_admin ) {\n\t$menu_list['import_export'] = esc_html__( 'Import / Export', 'litespeed-cache' );\n}\n\nif ( ! $this->_is_multisite || $this->_is_network_admin ) {\n\t$menu_list['edit_htaccess'] = esc_html__( 'View .htaccess', 'litespeed-cache' );\n}\n\nif ( ! $this->_is_network_admin ) {\n\t$menu_list['heartbeat'] = esc_html__( 'Heartbeat', 'litespeed-cache' );\n\t$menu_list['report']    = esc_html__( 'Report', 'litespeed-cache' );\n}\n\nif ( ! $this->_is_multisite || $this->_is_network_admin ) {\n\t$menu_list['settings-debug'] = esc_html__( 'Debug Settings', 'litespeed-cache' );\n\t$menu_list['log_viewer']     = esc_html__( 'Log View', 'litespeed-cache' );\n\t$menu_list['beta_test']      = esc_html__( 'Beta Test', 'litespeed-cache' );\n}\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Toolbox', 'litespeed-cache' ); ?>\n\t</h1>\n\t<span class=\"litespeed-desc\">\n\t\tv<?php echo esc_html( Core::VER ); ?>\n\t</span>\n\t<hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t</h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php foreach ( $menu_list as $curr_tab => $val ) : ?>\n\t\t\t<div data-litespeed-layout=\"<?php echo esc_attr( $curr_tab ); ?>\">\n\t\t\t\t<?php require LSCWP_DIR . \"tpl/toolbox/$curr_tab.tpl.php\"; ?>\n\t\t\t</div>\n\t\t<?php endforeach; ?>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/toolbox/purge.tpl.php": "<?php\n/**\n * LiteSpeed Cache Purge Interface\n *\n * Renders the purge interface for LiteSpeed Cache, allowing users to clear various cache types and purge specific content.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$_panels = array(\n\tarray(\n\t\t'title'      => esc_html__( 'Purge Front Page', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will Purge Front Page only', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-front',\n\t\t'append_url' => Purge::TYPE_PURGE_FRONTPAGE,\n\t),\n\tarray(\n\t\t'title'      => esc_html__( 'Purge Pages', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will Purge Pages only', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-pages',\n\t\t'append_url' => Purge::TYPE_PURGE_PAGES,\n\t),\n);\n\nforeach ( Tag::$error_code_tags as $code ) {\n\t$_panels[] = array(\n\t\t'title'      => sprintf( esc_html__( 'Purge %s Error', 'litespeed-cache' ), esc_html( $code ) ),\n\t\t'desc'       => sprintf( esc_html__( 'Purge %s error pages', 'litespeed-cache' ), esc_html( $code ) ),\n\t\t'icon'       => 'purge-' . esc_attr( $code ),\n\t\t'append_url' => Purge::TYPE_PURGE_ERROR . esc_attr( $code ),\n\t);\n}\n\n$_panels[] = array(\n\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - LSCache',\n\t'desc'       => esc_html__( 'Purge the LiteSpeed cache entries created by this plugin', 'litespeed-cache' ),\n\t'icon'       => 'purge-all',\n\t'append_url' => Purge::TYPE_PURGE_ALL_LSCACHE,\n);\n\n$_panels[] = array(\n\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'CSS/JS Cache', 'litespeed-cache' ),\n\t'desc'       => esc_html__( 'This will purge all minified/combined CSS/JS entries only', 'litespeed-cache' ),\n\t'icon'       => 'purge-cssjs',\n\t'append_url' => Purge::TYPE_PURGE_ALL_CSSJS,\n);\n\nif ( defined( 'LSCWP_OBJECT_CACHE' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Object Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'Purge all the object caches', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-object',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_OBJECT,\n\t);\n}\n\nif ( Router::opcache_enabled() ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Opcode Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'Reset the entire opcode cache', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-opcache',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_OPCACHE,\n\t);\n}\n\nif ( $this->has_cache_folder( 'ccss' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Critical CSS', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all generated critical CSS files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_CCSS,\n\t);\n}\n\nif ( $this->has_cache_folder( 'ucss' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Unique CSS', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all generated unique CSS files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_UCSS,\n\t);\n}\n\nif ( $this->has_cache_folder( 'localres' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Localized Resources', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all localized resources', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_LOCALRES,\n\t);\n}\n\nif ( $this->has_cache_folder( 'lqip' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'LQIP Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all generated image LQIP placeholder files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-front',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_LQIP,\n\t);\n}\n\nif ( $this->has_cache_folder( 'avatar' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Gravatar Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all cached Gravatar files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_AVATAR,\n\t);\n}\n\n$_panels[] = array(\n\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ),\n\t'desc'       => esc_html__( 'Purge the cache entries created by this plugin except for Critical CSS & Unique CSS & LQIP caches', 'litespeed-cache' ),\n\t'icon'       => 'purge-all',\n\t'title_cls'  => 'litespeed-warning',\n\t'newline'    => true,\n\t'append_url' => Purge::TYPE_PURGE_ALL,\n);\n\nif ( ! is_multisite() || is_network_admin() ) {\n\t$_panels[] = array(\n\t\t'title'     => esc_html__( 'Empty Entire Cache', 'litespeed-cache' ),\n\t\t'desc'      => esc_html__( 'Clears all cache entries related to this site, including other web applications.', 'litespeed-cache' ) . ' <b>' . esc_html__( 'This action should only be used if things are cached incorrectly.', 'litespeed-cache' ) . '</b>',\n\t\t'tag'       => Core::ACTION_PURGE_EMPTYCACHE,\n\t\t'icon'      => 'empty-cache',\n\t\t'title_cls' => 'litespeed-danger',\n\t\t'cfm'       => esc_html__( 'This will clear EVERYTHING inside the cache.', 'litespeed-cache' ) . ' ' . esc_html__( 'This may cause heavy load on the server.', 'litespeed-cache' ) . ' ' . esc_html__( 'If only the WordPress site should be purged, use Purge All.', 'litespeed-cache' ),\n\t);\n}\n\n?>\n\n<?php require_once LSCWP_DIR . 'tpl/inc/check_cache_disabled.php'; ?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Purge', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#purge-tab' ); ?>\n</h3>\n\n<div class=\"litespeed-panel-wrapper litespeed-cards-wrapper\">\n\t<?php foreach ( $_panels as $panel ) : ?>\n\t\t<?php\n\t\t$action_tag = ! empty( $panel['tag'] ) ? $panel['tag'] : Router::ACTION_PURGE;\n\t\t$append_url = ! empty( $panel['append_url'] ) ? $panel['append_url'] : false;\n\t\t$cfm        = ! empty( $panel['cfm'] ) ? Str::trim_quotes( $panel['cfm'] ) : false;\n\t\t?>\n\t\t<?php if ( ! empty( $panel['newline'] ) ) : ?>\n\t\t\t<div class=\"litespeed-col-br\"></div>\n\t\t<?php endif; ?>\n\t\t<a class=\"litespeed-panel postbox\" href=\"<?php echo esc_url( Utility::build_url( $action_tag, $append_url ) ); ?>\" data-litespeed-cfm=\"<?php echo esc_attr( $cfm ); ?>\">\n\t\t\t<section class=\"litespeed-panel-wrapper-icon\">\n\t\t\t\t<span class=\"litespeed-panel-icon-<?php echo esc_attr( $panel['icon'] ); ?>\"></span>\n\t\t\t</section>\n\t\t\t<section class=\"litespeed-panel-content\">\n\t\t\t\t<div class=\"litespeed-h3 <?php echo ! empty( $panel['title_cls'] ) ? esc_attr( $panel['title_cls'] ) : ''; ?>\">\n\t\t\t\t\t<?php echo esc_html( $panel['title'] ); ?>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"litespeed-panel-para\"><?php echo wp_kses_post( $panel['desc'] ); ?></span>\n\t\t\t</section>\n\t\t</a>\n\t<?php endforeach; ?>\n</div>\n\n<?php\nif ( is_multisite() && is_network_admin() ) {\n\treturn;\n}\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Purge By...', 'litespeed-cache' ); ?>\n</h3>\n<p class=\"litespeed-description\">\n\t<?php esc_html_e( 'Select below for \"Purge by\" options.', 'litespeed-cache' ); ?>\n\t<?php Doc::one_per_line(); ?>\n</p>\n\n<?php $this->form_action( Core::ACTION_PURGE_BY ); ?>\n\t<div class=\"litespeed-row\">\n\t\t<div class=\"litespeed-switch litespeed-mini litespeed-right20 litespeed-margin-bottom10\">\n\t\t\t<?php $val = Admin_Display::PURGEBY_CAT; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_category\" value=\"<?php echo esc_attr( $val ); ?>\" checked />\n\t\t\t<label for=\"purgeby_option_category\"><?php esc_html_e( 'Category', 'litespeed-cache' ); ?></label>\n\n\t\t\t<?php $val = Admin_Display::PURGEBY_PID; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_postid\" value=\"<?php echo esc_attr( $val ); ?>\" />\n\t\t\t<label for=\"purgeby_option_postid\"><?php esc_html_e( 'Post ID', 'litespeed-cache' ); ?></label>\n\n\t\t\t<?php $val = Admin_Display::PURGEBY_TAG; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_tag\" value=\"<?php echo esc_attr( $val ); ?>\" />\n\t\t\t<label for=\"purgeby_option_tag\"><?php esc_html_e( 'Tag', 'litespeed-cache' ); ?></label>\n\n\t\t\t<?php $val = Admin_Display::PURGEBY_URL; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_url\" value=\"<?php echo esc_attr( $val ); ?>\" />\n\t\t\t<label for=\"purgeby_option_url\"><?php esc_html_e( 'URL', 'litespeed-cache' ); ?></label>\n\t\t</div>\n\n\t\t<div class=\"litespeed-cache-purgeby-text litespeed-desc\">\n\t\t\t<div class=\"\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_CAT ); ?>\">\n\t\t\t\t<?php printf( esc_html__( 'Purge pages by category name - e.g. %2$s should be used for the URL %1$s.', 'litespeed-cache' ), '<code>http://example.com/category/category-name/</code>', '<code>category-name</code>' ); ?>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-hide\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_PID ); ?>\">\n\t\t\t\t<?php esc_html_e( 'Purge pages by post ID.', 'litespeed-cache' ); ?>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-hide\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_TAG ); ?>\">\n\t\t\t\t<?php printf( esc_html__( 'Purge pages by tag name - e.g. %2$s should be used for the URL %1$s.', 'litespeed-cache' ), '<code>http://example.com/tag/tag-name/</code>', '<code>tag-name</code>' ); ?>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-hide\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_URL ); ?>\">\n\t\t\t\t<?php esc_html_e( 'Purge pages by relative or full URL.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php printf( esc_html__( 'e.g. Use %1$s or %2$s.', 'litespeed-cache' ), '<code>/2016/02/24/hello-world/</code>', '<code>http://example.com/2016/02/24/hello-world/</code>' ); ?>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<p>\n\t\t<textarea name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_LIST ); ?>\" rows=\"5\" class=\"litespeed-textarea\"></textarea>\n\t</p>\n\n\t<p>\n\t\t<button type=\"submit\" class=\"button button-primary\"><?php esc_html_e( 'Purge List', 'litespeed-cache' ); ?></button>\n\t</p>\n</form>\n<script>\n(function ($) {\n\tfunction setCookie(name, value, days) {\n\t\tvar expires = \"\";\n\t\tif (days) {\n\t\t\tvar date = new Date();\n\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\texpires = \"; expires=\" + date.toUTCString();\n\t\t}\n\t\tdocument.cookie = name + \"=\" + (value || \"\") + expires + \"; path=/; SameSite=Strict\";\n\t}\n\n\tfunction getCookie(name) {\n\t\tvar nameEQ = name + \"=\";\n\t\tvar ca = document.cookie.split(';');\n\t\tfor (var i = 0; i < ca.length; i++) {\n\t\t\tvar c = ca[i];\n\t\t\twhile (c.charAt(0) == ' ') {\n\t\t\t\tc = c.substring(1, c.length);\n\t\t\t}\n\t\t\tif (c.indexOf(nameEQ) == 0) {\n\t\t\t\treturn c.substring(nameEQ.length, c.length);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tjQuery(document).ready(function () {\n\t\tvar savedPurgeBy = getCookie('litespeed_purgeby_option');\n\t\tif (savedPurgeBy) {\n\t\t\t$('input[name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\"][value=\"' + savedPurgeBy + '\"]').prop('checked', true);\n\t\t\t$('[data-purgeby]').addClass('litespeed-hide');\n\t\t\t$('[data-purgeby=\"' + savedPurgeBy + '\"]').removeClass('litespeed-hide');\n\t\t}\n\t\t// Manage page -> purge by\n\t\t$('[name=purgeby]').on('change', function (event) {\n\t\t\t$('[data-purgeby]').addClass('litespeed-hide');\n\t\t\t$('[data-purgeby=' + this.value + ']').removeClass('litespeed-hide');\n\t\t\tsetCookie('litespeed_purgeby_option', this.value, 30);\n\t\t});\n\t});\n})(jQuery);\n</script>",
    "plugins/litespeed-cache/tpl/toolbox/edit_htaccess.tpl.php": "<?php\n/**\n * LiteSpeed Cache View .htaccess\n *\n * Renders the .htaccess view interface for LiteSpeed Cache, displaying the contents and paths of frontend and backend .htaccess files.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$content = null;\ntry {\n\t$content = Htaccess::cls()->htaccess_read();\n} catch ( \\Exception $e ) {\n\t?>\n\t<div class=\"notice notice-error is-dismissible\">\n\t\t<p><?php echo wp_kses_post( $e->getMessage() ); ?></p>\n\t</div>\n\t<?php\n}\n\n$htaccess_path = Htaccess::get_frontend_htaccess();\n\n// Check for `ExpiresDefault` in .htaccess when LiteSpeed is enabled\nif ( defined( 'LITESPEED_ON' ) && $content && stripos( $content, \"\\nExpiresDefault\" ) !== false ) {\n\t$is_dismissed = GUI::get_option( self::DB_DISMISS_MSG );\n\tif ( self::RULECONFLICT_DISMISSED !== $is_dismissed ) {\n\t\tif ( self::RULECONFLICT_ON !== $is_dismissed ) {\n\t\t\tGUI::update_option( self::DB_DISMISS_MSG, self::RULECONFLICT_ON );\n\t\t}\n\t\trequire_once LSCWP_DIR . 'tpl/inc/show_rule_conflict.php';\n\t}\n}\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'LiteSpeed Cache View .htaccess', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/toolbox/#view-htaccess-tab' ); ?>\n</h3>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( '.htaccess Path', 'litespeed-cache' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php esc_html_e( 'Frontend .htaccess Path', 'litespeed-cache' ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<code><?php echo esc_html( $htaccess_path ); ?></code>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Default path is', 'litespeed-cache' ); ?>: <code><?php echo esc_html( Htaccess::get_frontend_htaccess( true ) ); ?></code>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'PHP Constant %s is supported.', 'litespeed-cache' ), '<code>LITESPEED_CFG_HTACCESS</code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'You can use this code %1$s in %2$s to specify the htaccess file path.', 'litespeed-cache' ), '<code>defined(\"LITESPEED_CFG_HTACCESS\") || define(\"LITESPEED_CFG_HTACCESS\", \"your path on server\");</code>', '<code>wp-config.php</code>' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php esc_html_e( 'Backend .htaccess Path', 'litespeed-cache' ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<code><?php echo esc_html( Htaccess::get_backend_htaccess() ); ?></code>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Default path is', 'litespeed-cache' ); ?>: <code><?php echo esc_html( Htaccess::get_backend_htaccess( true ) ); ?></code>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'PHP Constant %s is supported.', 'litespeed-cache' ), '<code>LITESPEED_CFG_HTACCESS_BACKEND</code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'You can use this code %1$s in %2$s to specify the htaccess file path.', 'litespeed-cache' ), '<code>defined(\"LITESPEED_CFG_HTACCESS_BACKEND\") || define(\"LITESPEED_CFG_HTACCESS_BACKEND\", \"your path on server\");</code>', '<code>wp-config.php</code>' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<?php if ( null !== $content ) : ?>\n\t<h3 class=\"litespeed-title\">\n\t\t<?php printf( esc_html__( 'Current %s Contents', 'litespeed-cache' ), '.htaccess' ); ?>\n\t</h3>\n\n\t<h4><?php echo esc_html( $htaccess_path ); ?></h4>\n\n\t<textarea readonly wrap=\"off\" rows=\"50\" class=\"large-text\"><?php echo esc_textarea( $content ); ?></textarea>\n<?php endif; ?>",
    "plugins/litespeed-cache/tpl/general/settings_inc.auto_upgrade.tpl.php": "<?php\n/**\n * LiteSpeed Cache Auto Upgrade Setting\n *\n * Manages the auto-upgrade setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n\t<!-- build_setting_auto_upgrade -->\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_AUTO_UPGRADE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Turn this option ON to have LiteSpeed Cache updated automatically, whenever a new version is released. If OFF, update manually as usual.', 'litespeed-cache' ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>",
    "plugins/litespeed-cache/tpl/general/online.tpl.php": "<?php\n/**\n * LiteSpeed Cache QUIC.cloud Online Services\n *\n * Manages QUIC.cloud online services integration for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$cloud_summary = Cloud::get_summary();\n\n$cloud_instance = Cloud::cls();\n$cloud_instance->finish_qc_activation( 'online' );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'QUIC.cloud Online Services', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://www.quic.cloud/quic-cloud-services-and-features/' ); ?>\n</h3>\n\n<div class=\"litespeed-desc\"><?php esc_html_e( 'QUIC.cloud provides CDN and online optimization services, and is not required. You may use many features of this plugin without QUIC.cloud.', 'litespeed-cache' ); ?></div>\n\n<?php if ( $cloud_instance->activated() ) : ?>\n\t<div class=\"litespeed-callout notice notice-success inline\">\n\t\t<h4><?php esc_html_e( 'Current Cloud Nodes in Service', 'litespeed-cache' ); ?>\n\t\t\t<a class=\"litespeed-right litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_CLEAR_CLOUD, false, null, array( 'ref' => 'online' ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label='<?php esc_html_e( 'Click to clear all nodes for further redetection.', 'litespeed-cache' ); ?>' data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to clear all cloud nodes?', 'litespeed-cache' ); ?>\"><i class='litespeed-quic-icon'></i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></a>\n\t\t</h4>\n\t\t<p>\n\t\t\t<?php\n\t\t\t$has_service = false;\n\t\t\tforeach ( Cloud::$services as $svc ) {\n\t\t\t\tif ( isset( $cloud_summary[ 'server.' . $svc ] ) ) {\n\t\t\t\t\t$has_service = true;\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t'<p><strong>%1$s</strong> <code>%2$s</code> <strong>%3$s</strong> <code>%4$s</code> <strong>%5$s</strong> <code>%6$s</code></p>',\n\t\t\t\t\t\tesc_html__( 'Service:', 'litespeed-cache' ),\n\t\t\t\t\t\tesc_html( $svc ),\n\t\t\t\t\t\tesc_html__( 'Node:', 'litespeed-cache' ),\n\t\t\t\t\t\tesc_html( $cloud_summary[ 'server.' . $svc ] ),\n\t\t\t\t\t\tesc_html__( 'Connected Date:', 'litespeed-cache' ),\n\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary[ 'server_date.' . $svc ] ) )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( ! $has_service ) {\n\t\t\t\tesc_html_e( 'No cloud services currently in use', 'litespeed-cache' );\n\t\t\t}\n\t\t\t?>\n\t\t</p>\n\t</div>\n<?php endif; ?>\n\n<?php if ( ! $cloud_instance->activated() ) : ?>\n\t<h4 class=\"litespeed-text-md litespeed-top30\"><span class=\"dashicons dashicons-no-alt litespeed-danger\"></span> <?php esc_html_e( 'QUIC.cloud Integration Disabled', 'litespeed-cache' ); ?></h4>\n\t<p><?php esc_html_e( 'Speed up your WordPress site even further with QUIC.cloud Online Services and CDN.', 'litespeed-cache' ); ?></p>\n\t<div class=\"litespeed-desc\"><?php esc_html_e( 'Free monthly quota available.', 'litespeed-cache' ); ?></div>\n\t<p><a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'online' ) ) ); ?>\">\n\t\t\t<span class=\"dashicons dashicons-yes\"></span>\n\t\t\t<?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t</a></p>\n\n\t<div>\n\t\t<h3 class=\"litespeed-title-section\"><?php esc_html_e( 'Online Services', 'litespeed-cache' ); ?></h3>\n\t\t<p><?php esc_html_e( \"QUIC.cloud's Online Services improve your site in the following ways:\", 'litespeed-cache' ); ?></p>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( '<strong>Image Optimization</strong> gives you smaller image file sizes that transmit faster.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( '<strong>Page Optimization</strong> streamlines page styles and visual elements for faster loading.', 'litespeed-cache' ) ); ?></li>\n\t\t</ul>\n\n\t\t<h4 class=\"litespeed-text-md litespeed-margin-bottom-remove\"><?php esc_html_e( 'Image Optimization', 'litespeed-cache' ); ?></h4>\n\t\t<p><?php esc_html_e( \"QUIC.cloud's Image Optimization service does the following:\", 'litespeed-cache' ); ?></p>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php esc_html_e( \"Processes your uploaded PNG and JPG images to produce smaller versions that don't sacrifice quality.\", 'litespeed-cache' ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php esc_html_e( 'Optionally creates next-generation WebP or AVIF image files.', 'litespeed-cache' ); ?></li>\n\t\t</ul>\n\t\t<p><?php esc_html_e( 'Processing for PNG, JPG, and WebP image formats is free. AVIF is available for a fee.', 'litespeed-cache' ); ?> <a href=\"https://www.quic.cloud/quic-cloud-services-and-features/image-optimization-service/\" target=\"_blank\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a></p>\n\n\t\t<h4 class=\"litespeed-text-md litespeed-margin-bottom-remove\"><?php esc_html_e( 'Page Optimization', 'litespeed-cache' ); ?></h4>\n\t\t<p><?php esc_html_e( \"QUIC.cloud's Page Optimization services address CSS bloat, and improve the user experience during page load, which can lead to improved page speed scores.\", 'litespeed-cache' ); ?></p>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( '<strong>Critical CSS (CCSS)</strong> loads visible above-the-fold content faster and with full styling.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( '<strong>Unique CSS (UCSS)</strong> removes unused style definitions for a speedier page load overall.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( '<strong>Low Quality Image Placeholder (LQIP)</strong> gives your imagery a more pleasing look as it lazy loads.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( '<strong>Viewport Images (VPI)</strong> provides a well-polished fully-loaded view above the fold.', 'litespeed-cache' ) ); ?></li>\n\t\t</ul>\n\n\t\t<div>\n\t\t\t<a href=\"https://www.quic.cloud/quic-cloud-services-and-features/page-optimization/\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<h3 class=\"litespeed-title-section\"><?php esc_html_e( 'Content Delivery Network', 'litespeed-cache' ); ?></h3>\n\n\t\t<h4 class=\"litespeed-text-md litespeed-margin-bottom-remove\"><?php esc_html_e( 'QUIC.cloud CDN:', 'litespeed-cache' ); ?></h4>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( 'Caches your entire site, including dynamic content and <strong>ESI blocks</strong>.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( 'Delivers global coverage with a growing <strong>network of 80+ PoPs</strong>.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( 'Provides <strong>security at the CDN level</strong>, protecting your server from attack.', 'litespeed-cache' ) ); ?></li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"></span> <?php echo wp_kses_post( __( 'Offers optional <strong>built-in DNS service</strong> to simplify CDN onboarding.', 'litespeed-cache' ) ); ?></li>\n\t\t</ul>\n\n\t\t<div>\n\t\t\t<a href=\"https://www.quic.cloud/quic-cloud-services-and-features/quic-cloud-cdn-service/\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a>\n\t\t</div>\n\n\t\t<hr class=\"litespeed-hr-with-space\">\n\n\t\t<p class=\"litespeed-desc\"><?php esc_html_e( 'In order to use most QUIC.cloud services, you need quota. QUIC.cloud gives you free quota every month, but if you need more, you can purchase it.', 'litespeed-cache' ); ?> <a href=\"https://docs.quic.cloud/billing/services/\" target=\"_blank\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a></p>\n\n\t\t<div class=\"litespeed-flex litespeed-flex-align-center\">\n\t\t\t<a class=\"button button-secondary litespeed-right20\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'online' ) ) ); ?>\">\n\t\t\t\t<span class=\"dashicons dashicons-yes\"></span>\n\t\t\t\t<?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\n<?php elseif ( ! empty( $cloud_summary['qc_activated'] ) && ( 'linked' === $cloud_summary['qc_activated'] || 'cdn' === $cloud_summary['qc_activated'] ) ) : ?>\n\t<h4 class=\"litespeed-text-md litespeed-top30\"><span class=\"dashicons dashicons-saved litespeed-success\"></span> <?php esc_html_e( 'QUIC.cloud Integration Enabled', 'litespeed-cache' ); ?></h4>\n\t<p><?php esc_html_e( 'Your site is connected and ready to use QUIC.cloud Online Services.', 'litespeed-cache' ); ?>\n\t\t<?php if ( empty( $cloud_summary['partner'] ) ) : ?>\n\t\t\t<a href=\"<?php echo esc_url( $cloud_instance->qc_link() ); ?>\" class=\"litespeed-link-with-icon\" target=\"_blank\"><?php esc_html_e( 'Go to QUIC.cloud dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"></span></a>\n\t\t<?php endif; ?>\n\t</p>\n\n\t<ul>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"></span> <?php esc_html_e( 'Page Optimization', 'litespeed-cache' ); ?></li>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"></span> <?php esc_html_e( 'Image Optimization', 'litespeed-cache' ); ?></li>\n\t\t<?php if ( 'cdn' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"></span> <?php esc_html_e( 'CDN - Enabled', 'litespeed-cache' ); ?></li>\n\t\t<?php else : ?>\n\t\t\t<li><span class=\"dashicons dashicons-no-alt litespeed-default\"></span> <span class=\"litespeed-default\"><?php esc_html_e( 'CDN - Disabled', 'litespeed-cache' ); ?></span></li>\n\t\t<?php endif; ?>\n\t</ul>\n\n<?php else : ?>\n\t<h4 class=\"litespeed-text-md litespeed-top30\"><span class=\"dashicons dashicons-saved litespeed-success\"></span> <?php esc_html_e( 'QUIC.cloud Integration Enabled with limitations', 'litespeed-cache' ); ?></h4>\n\t<p><?php echo wp_kses_post( __( 'Your site is connected and using QUIC.cloud Online Services as an <strong>anonymous user</strong>. The CDN function and certain features of optimization services are not available for anonymous users. Link to QUIC.cloud to use the CDN and all available Online Services features.', 'litespeed-cache' ) ); ?></p>\n\t<div class=\"litespeed-desc\"><?php esc_html_e( 'Free monthly quota available.', 'litespeed-cache' ); ?></div>\n\n\t<ul>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"></span> <?php esc_html_e( 'Page Optimization', 'litespeed-cache' ); ?></li>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"></span> <?php esc_html_e( 'Image Optimization', 'litespeed-cache' ); ?></li>\n\t\t<li><span class=\"dashicons dashicons-no-alt litespeed-danger\"></span> <?php esc_html_e( 'CDN - not available for anonymous users', 'litespeed-cache' ); ?></li>\n\t</ul>\n\n\t<p><a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'online' ) ) ); ?>\"><span class=\"dashicons dashicons-yes\"></span><?php esc_html_e( 'Link to QUIC.cloud', 'litespeed-cache' ); ?></a></p>\n<?php endif; ?>\n\n<?php if ( $cloud_instance->activated() ) : ?>\n\t<div class=\"litespeed-empty-space-medium\"></div>\n\t<div class=\"litespeed-column-with-boxes-footer\">\n\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_RESET, false, null, array( 'ref' => 'online' ) ) ); ?>\" class=\"litespeed-link-with-icon litespeed-danger\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to disconnect from QUIC.cloud? This will not remove any data from the QUIC.cloud dashboard.', 'litespeed-cache' ); ?>\"><span class=\"dashicons dashicons-dismiss\"></span><?php esc_html_e( 'Disconnect from QUIC.cloud', 'litespeed-cache' ); ?></a>\n\t\t<div class=\"litespeed-desc litespeed-margin-bottom-remove\"><?php esc_html_e( 'Remove QUIC.cloud integration from this site. Note: QUIC.cloud data will be preserved so you can re-enable services at any time. If you want to fully remove your site from QUIC.cloud, delete the domain through the QUIC.cloud Dashboard first.', 'litespeed-cache' ); ?></div>\n\t</div>\n<?php endif; ?>",
    "plugins/litespeed-cache/tpl/general/settings.tpl.php": "<?php\n/**\n * LiteSpeed Cache General Settings\n *\n * Manages general settings for LiteSpeed Cache, including Guest Mode optimization, server IP, and news settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$cloud_instance = Cloud::cls();\n$cloud_summary  = Cloud::get_summary();\n\n$ajax_url_get_ip = function_exists('get_rest_url') ? get_rest_url(null, 'litespeed/v1/tool/check_ip') : '/';\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'General Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/general/' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl/general/settings_inc.auto_upgrade.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl/general/settings_inc.guest.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_GUEST_OPTM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<span class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t🚨\n\t\t\t\t\t\t<?php esc_html_e( 'This option enables maximum optimization for Guest Mode visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/general/#guest-optimization', esc_html__( 'Please read all warnings before enabling this option.', 'litespeed-cache' ), false, 'litespeed-danger' ); ?>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<?php\n\t\t\t\t\t$type_list = array();\n\t\t\t\t\tif ( $this->conf( Base::O_GUEST ) && ! $this->conf( Base::O_OPTM_UCSS ) ) {\n\t\t\t\t\t\t$type_list[] = 'UCSS';\n\t\t\t\t\t}\n\t\t\t\t\tif ( $this->conf( Base::O_GUEST ) && ! $this->conf( Base::O_OPTM_CSS_ASYNC ) ) {\n\t\t\t\t\t\t$type_list[] = 'CCSS';\n\t\t\t\t\t}\n\t\t\t\t\tif ( ! empty( $type_list ) ) {\n\t\t\t\t\t\t$the_type = implode( '/', $type_list );\n\t\t\t\t\t\techo '<br />';\n\t\t\t\t\t\techo '<font class=\"litespeed-info\">';\n\t\t\t\t\t\techo '⚠️ ' . sprintf( esc_html__( 'Your %1$s quota on %2$s will still be in use.', 'litespeed-cache' ), esc_html( $the_type ), 'QUIC.cloud' );\n\t\t\t\t\t\techo '</font>';\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_GUEST ) ) : ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<font class=\"litespeed-warning litespeed-left10\">\n\t\t\t\t\t\t\t⚠️ <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( '%s must be turned ON for this setting to work.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_GUEST ) ) . '</code>' ); ?>\n\t\t\t\t\t\t</font>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_CACHE_MOBILE ) ) : ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<font class=\"litespeed-primary litespeed-left10\">\n\t\t\t\t\t\t\t⚠️ <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'You need to turn %s on to get maximum result.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_CACHE_MOBILE ) ) . '</code>' ); ?>\n\t\t\t\t\t\t</font>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_IMG_OPTM_WEBP ) ) : ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<font class=\"litespeed-primary litespeed-left10\">\n\t\t\t\t\t\t\t⚠️ <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'You need to turn %s on and finish all WebP generation to get maximum result.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_IMG_OPTM_WEBP ) ) . '</code>' ); ?>\n\t\t\t\t\t\t</font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_SERVER_IP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( \"Enter this site's IP address to allow cloud services directly call IP instead of domain name. This eliminates the overhead of DNS and CDN lookups.\", 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( 'Your server IP', 'litespeed-cache' ); ?>: <code id='litespeed_server_ip'>-</code> <a href=\"javascript:;\" class=\"button button-link\" id=\"litespeed_get_ip\"><?php esc_html_e( 'Check my public IP from', 'litespeed-cache' ); ?> CyberPanel.sh</a>\n\t\t\t\t\t⚠️ <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php esc_html_e( 'the auto-detected IP may not be accurate if you have an additional outgoing IP set, or you have multiple IPs configured on your server.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( 'Please make sure this IP is the correct one for visiting your site.', 'litespeed-cache' ); ?>\n\n\t\t\t\t\t<?php $this->_validate_ip( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_NEWS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Turn this option ON to show latest news automatically, including hotfixes, new releases, available beta versions, and promotions.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t</tbody>\n</table>\n\n<?php $this->form_end(); ?>\n\n<script>\n(function ($) {\n\tjQuery(document).ready(function () {\n\t\t/**\n\t\t * Get server IP\n\t\t * @since  3.0\n\t\t */\n\t\t$('#litespeed_get_ip').on('click', function (e) {\n\t\t\tconsole.log('[litespeed] get server IP');\n\t\t\t$.ajax({\n\t\t\t\turl: '<?php echo $ajax_url_get_ip; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>',\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\txhr.setRequestHeader('X-WP-Nonce', '<?php echo esc_js(wp_create_nonce('wp_rest')); ?>');\n\t\t\t\t\t$('#litespeed_server_ip').html('Detecting...');\n\t\t\t\t},\n\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t$('#litespeed_server_ip').html('Done');\n\t\t\t\t\tconsole.log('[litespeed] get server IP response: ' + data);\n\t\t\t\t\t$('#litespeed_server_ip').html(data);\n\t\t\t\t},\n\t\t\t\terror: function (xhr, error) {\n\t\t\t\t\tconsole.log('[litespeed] get server IP error', error);\n\t\t\t\t\t$('#litespeed_server_ip').html('Failed to detect IP');\n\t\t\t\t},\n\t\t\t\tcomplete: function (xhr, status) {\n\t\t\t\t\tconsole.log('[litespeed] AJAX complete', status, xhr);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t});\n})(jQuery);\n</script>",
    "plugins/litespeed-cache/tpl/general/settings_tuning.tpl.php": "<?php\n/**\n * LiteSpeed Cache Tuning Settings\n *\n * Manages tuning settings for LiteSpeed Cache, including Guest Mode configurations.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Tuning Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/general/#tuning-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_GUEST_UAS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id, 30 ); ?>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed User Agents will be considered as Guest Mode visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_GUEST_IPS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id, 50 ); ?>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed IPs will be considered as Guest Mode visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n</tbody></table>\n\n<?php $this->form_end(); ?>",
    "plugins/litespeed-cache/tpl/general/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache General Settings\n *\n * Manages general settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n    'online'          => esc_html__( 'Online Services', 'litespeed-cache' ),\n    'settings'        => esc_html__( 'General Settings', 'litespeed-cache' ),\n    'settings_tuning' => esc_html__( 'Tuning', 'litespeed-cache' ),\n);\n\nif ( is_network_admin() ) {\n    $menu_list = array(\n        'network_settings' => esc_html__( 'General Settings', 'litespeed-cache' ),\n    );\n}\n\n?>\n\n<div class=\"wrap\">\n    <h1 class=\"litespeed-h1\">\n        <?php esc_html_e( 'LiteSpeed Cache General Settings', 'litespeed-cache' ); ?>\n    </h1>\n    <span class=\"litespeed-desc\">\n        v<?php echo esc_html( Core::VER ); ?>\n    </span>\n    <hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n    <h2 class=\"litespeed-header nav-tab-wrapper\">\n        <?php GUI::display_tab_list( $menu_list ); ?>\n    </h2>\n\n    <div class=\"litespeed-body\">\n        <?php\n        foreach ( $menu_list as $menu_key => $val ) {\n            echo '<div data-litespeed-layout=\"' . esc_attr( $menu_key ) . '\">';\n            require LSCWP_DIR . 'tpl/general/' . $menu_key . '.tpl.php';\n            echo '</div>';\n        }\n        ?>\n    </div>\n\n</div>",
    "plugins/litespeed-cache/tpl/general/settings_inc.guest.tpl.php": "<?php\n/**\n * LiteSpeed Cache Guest Mode Setting\n *\n * Manages the Guest Mode setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$guest_update_url = wp_parse_url( LSWCP_PLUGIN_URL . GUI::PHP_GUEST, PHP_URL_PATH );\n\n?>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_GUEST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( \"Guest Mode provides an always cacheable landing page for an automated guest's first time visit, and then attempts to update cache varies via AJAX.\", 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'This option can help to correct the cache vary for certain advanced mobile or tablet visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/general/#guest-mode' ); ?>\n\t\t\t\t<br /><?php Doc::notice_htaccess(); ?>\n\t\t\t\t<br /><?php Doc::crawler_affected(); ?>\n\t\t\t</div>\n\t\t\t<?php if ( $this->conf( $option_id ) ) : ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Guest Mode testing result', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<font id='litespeed_gm_status'><?php esc_html_e( 'Testing', 'litespeed-cache' ); ?>...</font>\n\t\t\t\t</div>\n\t\t\t\t<script>\n\t\t\t\t\t(function ($) {\n\t\t\t\t\t\tjQuery(document).ready(function () {\n\t\t\t\t\t\t\t$.post( '<?php echo $guest_update_url; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>', function(data){\n\t\t\t\t\t\t\t\tif ( data === '[]' || data === '{\"reload\":\"yes\"}' ) {\n\t\t\t\t\t\t\t\t\t$('#litespeed_gm_status').html('<font class=\"litespeed-success\"><?php esc_html_e( 'Guest Mode passed testing.', 'litespeed-cache' ); ?></font>');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$('#litespeed_gm_status').html('<font class=\"litespeed-danger\"><?php esc_html_e( 'Guest Mode failed to test.', 'litespeed-cache' ); ?></font>');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).fail( function(){\n\t\t\t\t\t\t\t\t$('#litespeed_gm_status').html('<font class=\"litespeed-danger\"><?php esc_html_e( 'Guest Mode failed to test.', 'litespeed-cache' ); ?></font>');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t})(jQuery);\n\t\t\t\t</script>\n\t\t\t<?php endif; ?>\n\t\t</td>\n\t</tr>",
    "plugins/litespeed-cache/tpl/general/network_settings.tpl.php": "<?php\n/**\n * LiteSpeed Cache Network General Settings\n *\n * Manages network-wide general settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'General Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/general/' ); ?>\n</h3>\n\n<?php\n$this->form_action( Router::ACTION_SAVE_SETTINGS_NETWORK );\n?>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<?php require LSCWP_DIR . 'tpl/general/settings_inc.auto_upgrade.tpl.php'; ?>\n\n\t<tr>\n\t\t<th><?php esc_html_e( 'Use Primary Site Configuration', 'litespeed-cache' ); ?></th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( Base::NETWORK_O_USE_PRIMARY ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( \"Check this option to use the primary site's configuration for all subsites.\", 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'This will disable the settings page on all subsites.', 'litespeed-cache' ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<?php require LSCWP_DIR . 'tpl/general/settings_inc.guest.tpl.php'; ?>\n\n</tbody></table>\n\n<?php\n$this->form_end();\n?>",
    "plugins/litespeed-cache/tpl/presets/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Configuration Presets\n *\n * Renders the configuration presets interface for LiteSpeed Cache, including standard presets and import/export functionality.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'standard'      => esc_html__( 'Standard Presets', 'litespeed-cache' ),\n\t'import_export' => esc_html__( 'Import / Export', 'litespeed-cache' ),\n);\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Configuration Presets', 'litespeed-cache' ); ?>\n\t</h1>\n\t<span class=\"litespeed-desc\">\n\t\tv<?php echo esc_html( Core::VER ); ?>\n\t</span>\n\t<hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t</h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php\n\t\tforeach ( $menu_list as $curr_tab => $val ) :\n\t\t\t?>\n\t\t\t<div data-litespeed-layout=\"<?php echo esc_attr( $curr_tab ); ?>\">\n\t\t\t\t<?php\n\t\t\t\tif ( 'import_export' === $curr_tab ) {\n\t\t\t\t\trequire LSCWP_DIR . \"tpl/toolbox/$curr_tab.tpl.php\";\n\t\t\t\t} else {\n\t\t\t\t\trequire LSCWP_DIR . \"tpl/presets/$curr_tab.tpl.php\";\n\t\t\t\t}\n\t\t\t\t?>\n\t\t\t</div>\n\t\t\t<?php\n\t\tendforeach;\n\t\t?>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/presets/standard.tpl.php": "<?php\n/**\n * LiteSpeed Cache Standard Presets\n *\n * Renders the standard presets interface for LiteSpeed Cache, allowing users to apply predefined configuration presets.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$presets = array(\n\t'essentials' => array(\n\t\t'title'  => esc_html__( 'Essentials', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Default Cache', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Higher TTL', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Browser Cache', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This no-risk preset is appropriate for all websites. Good for new users, simple websites, or cache-oriented development.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is not required to use this preset. Only basic caching features are enabled.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'basic' => array(\n\t\t'title'  => esc_html__( 'Basic', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Essentials, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Image Optimization', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Mobile Cache', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This low-risk preset introduces basic optimizations for speed and user experience. Appropriate for enthusiastic beginners.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Includes optimizations known to improve site score in page speed measurement tools.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'advanced' => array(\n\t\t'title'  => esc_html__( 'Advanced (Recommended)', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Basic, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Guest Mode and Guest Optimization', 'litespeed-cache' ),\n\t\t\tesc_html__( 'CSS, JS and HTML Minification', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Font Display Optimization', 'litespeed-cache' ),\n\t\t\tesc_html__( 'JS Defer for both external and inline JS', 'litespeed-cache' ),\n\t\t\tesc_html__( 'DNS Prefetch for static files', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Gravatar Cache', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Remove Query Strings from Static Files', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Remove WordPress Emoji', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Remove Noscript Tags', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This preset is good for most websites, and is unlikely to cause conflicts. Any CSS or JS conflicts may be resolved with Page Optimization > Tuning tools.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Includes many optimizations known to improve page speed scores.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'aggressive' => array(\n\t\t'title'  => esc_html__( 'Aggressive', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Advanced, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'CSS & JS Combine', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Asynchronous CSS Loading with Critical CSS', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Removed Unused CSS for Users', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Lazy Load for Iframes', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This preset might work out of the box for some websites, but be sure to test! Some CSS or JS exclusions may be necessary in Page Optimization > Tuning.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Includes many optimizations known to improve page speed scores.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'extreme' => array(\n\t\t'title'  => esc_html__( 'Extreme', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Aggressive, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Lazy Load for Images', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Viewport Image Generation', 'litespeed-cache' ),\n\t\t\tesc_html__( 'JS Delayed', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Inline JS added to Combine', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Inline CSS added to Combine', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This preset almost certainly will require testing and exclusions for some CSS, JS and Lazy Loaded images. Pay special attention to logos, or HTML-based slider images.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Enables the maximum level of optimizations for improved page speed scores.', 'litespeed-cache' ),\n\t\t),\n\t),\n);\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'LiteSpeed Cache Standard Presets', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/presets/#standard-tab' ); ?>\n</h3>\n\n<p><?php esc_html_e( 'Use an official LiteSpeed-designed Preset to configure your site in one click. Try no-risk caching essentials, extreme optimization, or something in between.', 'litespeed-cache' ); ?></p>\n\n<div class=\"litespeed-comparison-cards\">\n\t<?php\n\tforeach ( array_keys( $presets ) as $name ) :\n\t\t$curr_title   = $presets[ $name ]['title'];\n\t\t$recommend    = 'advanced' === $name;\n\t\t$card_class   = $recommend ? 'litespeed-comparison-card-rec' : '';\n\t\t$button_class = $recommend ? 'button-primary' : 'button-secondary';\n\t\t?>\n\t\t<div class=\"litespeed-comparison-card postbox <?php echo esc_attr( $card_class ); ?>\">\n\t\t\t<div class=\"litespeed-card-content\">\n\t\t\t\t<div class=\"litespeed-card-header\">\n\t\t\t\t\t<h3 class=\"litespeed-h3\">\n\t\t\t\t\t\t<?php echo esc_html( $curr_title ); ?>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-card-body\">\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<?php foreach ( $presets[ $name ]['body'] as $line ) : ?>\n\t\t\t\t\t\t\t<li><?php echo esc_html( $line ); ?></li>\n\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-card-footer\">\n\t\t\t\t\t<h4><?php esc_html_e( 'Who should use this preset?', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t<?php foreach ( $presets[ $name ]['footer'] as $line ) : ?>\n\t\t\t\t\t\t<p><?php echo esc_html( $line ); ?></p>\n\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-card-action\">\n\t\t\t\t<a\n\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PRESET, Preset::TYPE_APPLY, false, null, array( 'preset' => $name ) ) ); ?>\"\n\t\t\t\t\tclass=\"button <?php echo esc_attr( $button_class ); ?>\"\n\t\t\t\t\tdata-litespeed-cfm=\"<?php echo esc_attr( sprintf( __( 'This will back up your current settings and replace them with the %1$s preset settings. Do you want to continue?', 'litespeed-cache' ), $curr_title ) ); ?>\"\n\t\t\t\t>\n\t\t\t\t\t<?php esc_html_e( 'Apply Preset', 'litespeed-cache' ); ?>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t<?php endforeach; ?>\n</div>\n\n<?php\n$summary = Preset::get_summary();\n$backups = array();\nforeach ( Preset::get_backups() as $backup ) {\n\t$backup = explode( '-', $backup );\n\tif ( empty( $backup[1] ) ) {\n\t\tcontinue;\n\t}\n\t$timestamp  = $backup[1];\n\t$time       = trim( Utility::readable_time( $timestamp ) );\n\t$name       = empty( $backup[3] ) ? null : $backup[3];\n\t$curr_title = empty( $presets[ $name ]['title'] ) ? $name : $presets[ $name ]['title'];\n\t$curr_title = null === $curr_title ? esc_html__( 'unknown', 'litespeed-cache' ) : $curr_title;\n\t$backups[]  = array(\n\t\t'timestamp' => $timestamp,\n\t\t'time'      => $time,\n\t\t'title'     => $curr_title,\n\t);\n}\n\nif ( ! empty( $summary['preset'] ) || ! empty( $backups ) ) :\n\t?>\n\t<h3 class=\"litespeed-title-short\">\n\t\t<?php esc_html_e( 'History', 'litespeed-cache' ); ?>\n\t</h3>\n<?php endif; ?>\n\n<?php if ( ! empty( $summary['preset'] ) ) : ?>\n\t<p>\n\t\t<?php\n\t\t$name = strtolower( $summary['preset'] );\n\t\t$time = trim( Utility::readable_time( $summary['preset_timestamp'] ) );\n\t\tif ( 'error' === $name ) {\n\t\t\tprintf( esc_html__( 'Error: Failed to apply the settings %1$s', 'litespeed-cache' ), esc_html( $time ) );\n\t\t} elseif ( 'backup' === $name ) {\n\t\t\tprintf( esc_html__( 'Restored backup settings %1$s', 'litespeed-cache' ), esc_html( $time ) );\n\t\t} else {\n\t\t\tprintf(\n\t\t\t\tesc_html__( 'Applied the %1$s preset %2$s', 'litespeed-cache' ),\n\t\t\t\t'<strong>' . esc_html( $presets[ $name ]['title'] ) . '</strong>',\n\t\t\t\tesc_html( $time )\n\t\t\t);\n\t\t}\n\t\t?>\n\t</p>\n<?php endif; ?>\n\n<?php foreach ( $backups as $backup ) : ?>\n\t<p>\n\t\t<?php printf( esc_html__( 'Backup created %1$s before applying the %2$s preset', 'litespeed-cache' ), esc_html( $backup['time'] ), esc_html( $backup['title'] ) ); ?>\n\t\t<a\n\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PRESET, Preset::TYPE_RESTORE, false, null, array( 'timestamp' => $backup['timestamp'] ) ) ); ?>\"\n\t\t\tclass=\"litespeed-left10\"\n\t\t\tdata-litespeed-cfm=\"<?php echo esc_attr( sprintf( __( 'This will restore the backup settings created %1$s before applying the %2$s preset. Any changes made since then will be lost. Do you want to continue?', 'litespeed-cache' ), $backup['time'], $backup['title'] ) ); ?>\"\n\t\t>\n\t\t\t<?php esc_html_e( 'Restore Settings', 'litespeed-cache' ); ?>\n\t\t</a>\n\t</p>\n<?php endforeach; ?>",
    "plugins/litespeed-cache/tpl/banner/cloud_promo.tpl.php": "<?php\n/**\n * QUIC.cloud Promotion Banner\n *\n * Displays a promotional banner for QUIC.cloud services with a tweet option to earn credits.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n?>\n\n<div class=\"litespeed-wrap notice notice-success litespeed-banner-promo-qc\">\n\n\t<div class=\"litespeed-banner-promo-qc-content\">\n\n\t\t<div class=\"litespeed-banner-promo-qc-description\">\n\t\t\t<h2><?php esc_html_e( 'You just unlocked a promotion from QUIC.cloud!', 'litespeed-cache' ); ?></h2>\n\t\t\t<p>\n\t\t\t\t<?php\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Spread the love and earn %s credits to use in our QUIC.cloud online services.', 'litespeed-cache' ),\n\t\t\t\t\t'<strong>' . absint($this->_summary['promo'][0]['quota']) . '</strong>'\n\t\t\t\t);\n\t\t\t\t?>\n\t\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<a class=\"button button-primary\" href=\"<?php echo esc_url($this->_summary['promo'][0]['url']); ?>\" target=\"_blank\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Send to twitter to get %s bonus', 'litespeed-cache' ),\n\t\t\t\t\t\tabsint($this->_summary['promo'][0]['quota'])\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</a>\n\t\t\t\t<a href=\"https://www.quic.cloud/faq/#credit\" target=\"_blank\"><?php esc_html_e( 'Learn more', 'litespeed-cache' ); ?></a>\n\t\t\t</p>\n\t\t</div>\n\n\t\t<div class=\"litespeed-banner-promo-qc-preview\">\n\t\t\t<h4 class=\"litespeed-tweet-preview-title\"><?php esc_html_e( 'Tweet preview', 'litespeed-cache' ); ?></h4>\n\t\t\t<div class=\"litespeed-tweet-preview\">\n\n\t\t\t\t<div class=\"litespeed-tweet-img\"><img src=\"<?php echo esc_url($this->_summary['promo'][0]['image']); ?>\"></div>\n\n\t\t\t\t<div class=\"litespeed-tweet-preview-content\">\n\t\t\t\t\t<p class=\"litespeed-tweet-text\"><?php echo esc_html($this->_summary['promo'][0]['content']); ?></p>\n\n\t\t\t\t\t<div class=\"litespeed-tweet-cta\">\n\t\t\t\t\t\t<a href=\"<?php echo esc_url($this->_summary['promo'][0]['url']); ?>\" class=\"litespeed-tweet-btn\" target=\"_blank\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 250 250\" xml:space=\"preserve\">\n\t\t\t\t\t\t\t\t<path class=\"st0\" d=\"M78.6,226.6c94.3,0,145.9-78.2,145.9-145.9c0-2.2,0-4.4-0.1-6.6c10-7.3,18.7-16.3,25.6-26.5\n\t\t\t\t\t\t\t\tc-9.4,4.1-19.3,6.9-29.5,8.1c10.7-6.4,18.7-16.5,22.5-28.4c-10.1,6-21.1,10.2-32.6,12.4c-19.4-20.7-51.9-21.7-72.6-2.2\n\t\t\t\t\t\t\t\tc-13.3,12.5-19,31.2-14.8,49C81.9,84.3,43.4,64.8,17.4,32.8c-13.6,23.4-6.7,53.4,15.9,68.5c-8.2-0.2-16.1-2.4-23.3-6.4\n\t\t\t\t\t\t\t\tc0,0.2,0,0.4,0,0.6c0,24.4,17.2,45.4,41.2,50.3c-7.6,2.1-15.5,2.4-23.2,0.9c6.7,20.9,26,35.2,47.9,35.6c-18.2,14.3-40.6,22-63.7,22\n\t\t\t\t\t\t\t\tc-4.1,0-8.2-0.3-12.2-0.7C23.5,218.6,50.7,226.6,78.6,226.6\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Tweet this', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<?php $dismiss_url = Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_CLEAR_PROMO ); ?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice', 'litespeed-cache' ); ?>.</span>\n\t\t<a href=\"<?php echo esc_url($dismiss_url); ?>\" class=\"litespeed-notice-dismiss\">X</a>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/banner/score.php": "<?php\n/**\n * LiteSpeed Cache Performance Review Banner\n *\n * Displays a promotional banner showing page load time and PageSpeed score improvements.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$health_scores = Health::cls()->scores();\n\n// Exit if speed is not significantly improved or score is reduced.\nif ( $health_scores['speed_before'] <= $health_scores['speed_after'] * 2 || $health_scores['score_before'] >= $health_scores['score_after'] ) {\n\treturn;\n}\n\n// Banner can be shown now.\n$this->_promo_true = true;\n\nif ( $check_only ) {\n\treturn;\n}\n\n$ajax_url_promo = Utility::build_url(Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PROMO, true, null, array( 'promo_tag' => $promo_tag ), true);\n?>\n\n<div class=\"litespeed-wrap notice notice-info litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-logo\"></div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-banner-promo-content\"><?php esc_html_e( 'Thank You for Using the LiteSpeed Cache Plugin!', 'litespeed-cache' ); ?></h3>\n\n\t\t<div class=\"litespeed-row-flex litespeed-banner-promo-content litespeed-margin-left-remove litespeed-flex-wrap\">\n\t\t\t<div class=\"litespeed-right50 litespeed-margin-bottom20\">\n\t\t\t\t<h2 class=\"litespeed-text-grey litespeed-margin-bottom-remove litespeed-top10\"><?php esc_html_e( 'Page Load Time', 'litespeed-cache' ); ?></h2>\n\t\t\t\t<hr class=\"litespeed-margin-bottom-remove\" />\n\t\t\t\t<div class=\"litespeed-row-flex\" style=\"margin-left: -10px;\">\n\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\"><?php esc_html_e( 'Before', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-text-grey\">\n\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_before'] ); ?><span class=\"litespeed-text-large\">s</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\"><?php esc_html_e( 'After', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_after'] ); ?><span class=\"litespeed-text-large\">s</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-text-fern\">\n\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_improved'] ); ?><span class=\"litespeed-text-large\">%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<?php if ( $health_scores['score_before'] < $health_scores['score_after'] ) : ?>\n\t\t\t\t<div class=\"litespeed-margin-bottom20\">\n\t\t\t\t\t<h2 class=\"litespeed-text-grey litespeed-margin-bottom-remove litespeed-top10\"><?php esc_html_e( 'PageSpeed Score', 'litespeed-cache' ); ?></h2>\n\t\t\t\t\t<hr class=\"litespeed-margin-bottom-remove\" />\n\t\t\t\t\t<div class=\"litespeed-row-flex\" style=\"margin-left: -10px;\">\n\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center litespeed-margin-y-remove\"><?php esc_html_e( 'Before', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\" style=\"margin-top: -5px;\">\n\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( esc_html( $health_scores['score_before'] ), 45, false, true, 'litespeed-pie-' . esc_attr( $this->get_cls_of_pagescore( $health_scores['score_before'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center litespeed-margin-y-remove\"><?php esc_html_e( 'After', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\" style=\"margin-top: -5px;\">\n\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( esc_html( $health_scores['score_after'] ), 45, false, true, 'litespeed-pie-' . esc_attr( $this->get_cls_of_pagescore( $health_scores['score_after'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-text-fern\">\n\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['score_improved'] ); ?><span class=\"litespeed-text-large\">%</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t<?php endif; ?>\n\t\t</div>\n\n\t\t<div class=\"litespeed-row-flex litespeed-flex-wrap litespeed-margin-y5\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<a href=\"https://wordpress.org/support/plugin/litespeed-cache/reviews/?filter=5#new-post\" target=\"_blank\" rel=\"noopener\" style=\"text-decoration: none;\">\n\t\t\t\t\t<button class=\"button litespeed-btn-success litespeed-btn-mini\">\n\t\t\t\t\t\t<?php esc_html_e( \"Sure I'd love to review!\", 'litespeed-cache' ); ?>\n\t\t\t\t\t\t⭐⭐⭐⭐⭐\n\t\t\t\t\t</button>\n\t\t\t\t</a>\n\t\t\t\t<button type=\"button\" class=\"button litespeed-btn-primary litespeed-btn-mini\" id=\"litespeed-promo-done\"><?php esc_html_e( \"I've already left a review\", 'litespeed-cache' ); ?></button>\n\t\t\t\t<button type=\"button\" class=\"button litespeed-btn-warning litespeed-btn-mini\" id=\"litespeed-promo-later\"><?php esc_html_e( 'Maybe later', 'litespeed-cache' ); ?></button>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<p class=\"litespeed-text-small\">\n\t\t\t\t\t<?php esc_html_e( 'Created with ❤️ by LiteSpeed team.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<a href=\"https://wordpress.org/support/plugin/litespeed-cache\" target=\"_blank\" rel=\"noopener\"><?php esc_html_e( 'Support forum', 'litespeed-cache' ); ?></a> | <a href=\"https://www.litespeedtech.com/support\" target=\"_blank\" rel=\"noopener\"><?php esc_html_e( 'Submit a ticket', 'litespeed-cache' ); ?></a>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<?php\n\t\t$dismiss_url = Utility::build_url(\n\t\t\tCore::ACTION_DISMISS,\n\t\t\tGUI::TYPE_DISMISS_PROMO,\n\t\t\tfalse,\n\t\t\tnull,\n\t\t\tarray(\n\t\t\t\t'promo_tag' => 'score',\n\t\t\t\t'later'     => 1,\n\t\t\t)\n\t\t);\n\t\t?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice.', 'litespeed-cache' ); ?></span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\"><?php esc_html_e( 'Dismiss', 'litespeed-cache' ); ?></a>\n\t</div>\n</div>\n\n<script>\n(function ($) {\n\tjQuery(document).ready(function () {\n\t\t/** Promo banner **/\n\t\t$('#litespeed-promo-done').on('click', function (event) {\n\t\t\t$('.litespeed-banner-promo-full').slideUp();\n\t\t\t$.get('<?php echo $ajax_url_promo;// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>&done=1');\n\t\t});\n\t\t$('#litespeed-promo-later').on('click', function (event) {\n\t\t\t$('.litespeed-banner-promo-full').slideUp();\n\t\t\t$.get('<?php echo $ajax_url_promo;// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>');\n\t\t});\n\t});\n})(jQuery);\n</script>",
    "plugins/litespeed-cache/tpl/banner/cloud_news.tpl.php": "<?php\n/**\n * LiteSpeed Cache Promotion Banner\n *\n * Displays a promotional banner with news and installation options.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<div class=\"litespeed-wrap notice notice-success litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-top15\"><?php echo wp_kses_post( $this->_summary['news.title'] ); ?></h3>\n\t\t<div class=\"litespeed-banner-description\" style=\"flex-direction: column;\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php echo wp_kses_post( $this->_summary['news.content'] ); ?>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-inline\">\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15 litespeed-margin-bottom10\">\n\t\t\t\t\t<?php if ( ! empty( $this->_summary['news.plugin'] ) ) : ?>\n\t\t\t\t\t\t<?php $install_link = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_INSTALL_3RD, false, null, array( 'plugin' => $this->_summary['news.plugin'] ) ); ?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( $install_link ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Install', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tif ( ! empty( $this->_summary['news.plugin_name'] ) ) {\n\t\t\t\t\t\t\t\techo esc_html( $this->_summary['news.plugin_name'] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( ! empty( $this->_summary['news.zip'] ) ) : ?>\n\t\t\t\t\t\t<?php $install_link = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_INSTALL_ZIP ); ?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( $install_link ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Install', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<?php $dismiss_url = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_DISMISS_RECOMMENDED ); ?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice', 'litespeed-cache' ); ?></span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\">X</a>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/banner/slack.php": "<?php\n/**\n * LiteSpeed Cache Slack Community Banner\n *\n * Displays a promotional banner inviting users to join the LiteSpeed Slack community.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<div class=\"litespeed-wrap notice notice-info litespeed-banner-promo-full\" id=\"litespeed-banner-promo-slack\">\n\t<div class=\"litespeed-banner-promo-logo\"></div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title\"><?php esc_html_e( 'Welcome to LiteSpeed', 'litespeed-cache' ); ?></h3>\n\t\t<div class=\"litespeed-banner-description\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php esc_html_e( 'Want to connect with other LiteSpeed users?', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t/* translators: %s: Link to LiteSpeed Slack community */\n\t\t\t\t\t\tesc_html__( 'Join the %s community.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<a href=\"https://join.slack.com/t/golitespeed/shared_invite/enQtMzE5ODgxMTUyNTgzLTNiNWQ1MWZlYmI4YjEzNTM4NjdiODY2YTQ0OWVlMzBlNGZkY2E3Y2E4MjIzNmNmZmU0ZjIyNWM1ZmNmMWRlOTk\" target=\"_blank\" class=\"litespeed-banner-promo-slack-textlink\" rel=\"noopener\">LiteSpeed Slack</a>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</p>\n\t\t\t\t<p class=\"litespeed-banner-promo-slack-line2\">\n\t\t\t\t\tgolitespeed.slack.com\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<h3 class=\"litespeed-banner-button-link\">\n\t\t\t\t\t<a href=\"https://join.slack.com/t/golitespeed/shared_invite/enQtMzE5ODgxMTUyNTgzLTNiNWQ1MWZlYmI4YjEzNTM4NjdiODY2YTQ0OWVlMzBlNGZkY2E3Y2E4MjIzNmNmZmU0ZjIyNWM1ZmNmMWRlOTk\" target=\"_blank\" rel=\"noopener\">\n\t\t\t\t\t\t<?php esc_html_e( 'Join Us on Slack', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</h3>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div>\n\t\t<?php $dismiss_url = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PROMO, false, null, array( 'promo_tag' => 'slack' ) ); ?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice.', 'litespeed-cache' ); ?></span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\"><?php esc_html_e( 'Dismiss', 'litespeed-cache' ); ?></a>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/banner/ajax.php": "<?php\n/**\n * Health Check Script\n *\n * Triggers a health check request for speed when the document is loaded.\n *\n * @package LiteSpeed\n * @since 1.0.0\n * @deprecated 3.3 Will only show banner after user manually checked score\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$url = Utility::build_url( Router::ACTION_HEALTH, Health::TYPE_SPEED, true, null, array(), true );\n?>\n<script>\ndocument.addEventListener('DOMContentLoaded', function() {\n\tjQuery(document).ready( function() {\n\t\t\tjQuery.get( '<?php echo $url; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>' ) ;\n\t\t} ) ;\n});\n</script>",
    "plugins/litespeed-cache/tpl/banner/new_version_dev.tpl.php": "<?php\n/**\n * LiteSpeed Cache Developer Version Banner\n *\n * Displays a promotional banner for a new developer version of LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<div class=\"litespeed-wrap notice notice-warning litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-logo\"></div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-top15\">\n\t\t\t<?php esc_html_e( 'LiteSpeed Cache', 'litespeed-cache' ); ?>:\n\t\t\t<?php esc_html_e( 'New Developer Version Available!', 'litespeed-cache' ); ?>\n\t\t</h3>\n\t\t<div class=\"litespeed-banner-description\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php\n\t\t\t\t\t/* translators: %s: Developer version number */\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'New developer version %s is available now.', 'litespeed-cache' ),\n\t\t\t\t\t\t'v' . esc_html( $this->_summary['version.dev'] )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-row-flex litespeed-banner-description\">\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php $url = Utility::build_url( Router::ACTION_DEBUG2, Debug2::TYPE_BETA_TEST, false, null, array( Debug2::BETA_TEST_URL => 'dev' ) ); ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-success litespeed-btn-mini\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-image-rotate\"></span>\n\t\t\t\t\t\t<?php esc_html_e( 'Upgrade', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/banner/new_version.php": "<?php\n/**\n * LiteSpeed Cache New Version Banner\n *\n * Displays a promotional banner for a new version of LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n * @note Only shown for single site installations.\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n// Exit if multisite or auto-upgrade is enabled.\nif ( is_multisite() || $this->conf( Base::O_AUTO_UPGRADE ) ) {\n\treturn;\n}\n\n$current = get_site_transient( 'update_plugins' );\nif ( ! isset( $current->response[ Core::PLUGIN_FILE ] ) ) {\n\treturn;\n}\n\n// Check for new version every 12 hours.\n$last_check = empty( $this->_summary['new_version.last_check'] ) ? 0 : $this->_summary['new_version.last_check'];\nif ( time() - $last_check > 43200 ) {\n\tGUI::save_summary( array( 'new_version.last_check' => time() ) );\n\n\t// Detect version\n\t$auto_v = Cloud::version_check( 'new_version_banner' );\n\tif ( ! empty( $auto_v['latest'] ) ) {\n\t\tGUI::save_summary( array( 'new_version.v' => $auto_v['latest'] ) );\n\t}\n\t// After detect, don't show, just return and show next time\n\treturn;\n}\n\nif ( ! isset( $this->_summary['new_version.v'] ) || version_compare( Core::VER, $this->_summary['new_version.v'], '>=' ) ) {\n\treturn;\n}\n\n// Banner can be shown now.\n$this->_promo_true = true;\n\nif ( $check_only ) {\n\treturn;\n}\n?>\n\n<div class=\"litespeed-wrap notice notice-success litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-logo\"></div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-top15\">\n\t\t\t<?php esc_html_e( 'LiteSpeed Cache', 'litespeed-cache' ); ?>:\n\t\t\t<?php esc_html_e( 'New Version Available!', 'litespeed-cache' ); ?>\n\t\t</h3>\n\t\t<div class=\"litespeed-banner-description\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php\n\t\t\t\t\t/* translators: %s: New version number */\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'New release %s is available now.', 'litespeed-cache' ),\n\t\t\t\t\t\t'v' . esc_html( $this->_summary['new_version.v'] )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"litespeed-row-flex litespeed-banner-description\">\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php $url = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_UPGRADE ); ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-success litespeed-btn-mini\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-image-rotate\"></span>\n\t\t\t\t\t\t<?php esc_html_e( 'Upgrade', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php\n\t\t\t\t\t$cfg = array( Conf::TYPE_SET . '[' . Base::O_AUTO_UPGRADE . ']' => 1 );\n\t\t\t\t\t$url = Utility::build_url( Router::ACTION_CONF, Conf::TYPE_SET, false, null, $cfg );\n\t\t\t\t\t?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-primary litespeed-btn-mini\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span>\n\t\t\t\t\t\t<?php esc_html_e( 'Turn On Auto Upgrade', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php $url = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PROMO, false, null, array( 'promo_tag' => 'new_version' ) ); ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-warning litespeed-btn-mini\">\n\t\t\t\t\t\t<?php esc_html_e( 'Maybe Later', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<?php\n\t\t$dismiss_url = Utility::build_url(\n\t\t\tCore::ACTION_DISMISS,\n\t\t\tGUI::TYPE_DISMISS_PROMO,\n\t\t\tfalse,\n\t\t\tnull,\n\t\t\tarray(\n\t\t\t\t'promo_tag' => 'new_version',\n\t\t\t\t'later'     => 1,\n\t\t\t)\n\t\t);\n\t\t?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice.', 'litespeed-cache' ); ?></span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\"><?php esc_html_e( 'Dismiss', 'litespeed-cache' ); ?></a>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/inc/metabox.php": "<?php\n/**\n * LiteSpeed Cache Post Meta Settings\n *\n * Renders the post meta settings interface for LiteSpeed Cache, allowing configuration of post-specific options.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nwp_nonce_field( self::POST_NONCE_ACTION, Router::NONCE );\n\n$pid = get_the_ID();\n\nforeach ( $this->_postmeta_settings as $key => $label ) {\n\t$existing_val = get_post_meta( $pid, $key, true );\n\n\tif ( in_array( $key, array( 'litespeed_vpi_list', 'litespeed_vpi_list_mobile' ), true ) ) {\n\t\tif ( is_array( $existing_val ) ) {\n\t\t\t$existing_val = implode( PHP_EOL, $existing_val );\n\t\t}\n\t\t?>\n\t\t<div style=\"margin-bottom:10px;\">\n\t\t\t<label for=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\"><?php echo esc_html( $label ); ?></label>\n\t\t\t<textarea style=\"width:100%\" rows=\"5\" id=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\" name=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\"><?php echo esc_textarea( $existing_val ); ?></textarea>\n\t\t</div>\n\t\t<?php\n\t} else {\n\t\t?>\n\t\t<div style=\"display:flex;margin-bottom:10px;align-items: center;gap: 2ch;justify-content: space-between;\">\n\t\t\t<label for=\"<?php echo esc_attr( $key ); ?>\"><?php echo esc_html( $label ); ?></label>\n\t\t\t<input class=\"litespeed-tiny-toggle\" id=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\" name=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\" type=\"checkbox\" value=\"1\" <?php echo $existing_val ? 'checked' : ''; ?> />\n\t\t</div>\n\t\t<?php\n\t}\n}\n?>\n\n<div style=\"text-align:right;\">\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/metabox/' ); ?>\n</div>",
    "plugins/litespeed-cache/tpl/inc/check_cache_disabled.php": "<?php\n/**\n * LiteSpeed Cache Warning Notice\n *\n * Displays warnings if LiteSpeed Cache functionality is unavailable due to server or plugin configuration issues.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$reasons = array();\n\nif ( ! defined( 'LITESPEED_ALLOWED' ) ) {\n    if ( defined( 'LITESPEED_SERVER_TYPE' ) && LITESPEED_SERVER_TYPE === 'NONE' ) {\n        $reasons[] = array(\n            'title' => esc_html__( 'To use the caching functions you must have a LiteSpeed web server or be using QUIC.cloud CDN.', 'litespeed-cache' ),\n            'link'  => 'https://docs.litespeedtech.com/lscache/lscwp/faq/#why-do-the-cache-features-require-a-litespeed-server',\n        );\n    } else {\n        $reasons[] = array(\n            'title' => esc_html__( 'Please enable the LSCache Module at the server level, or ask your hosting provider.', 'litespeed-cache' ),\n            'link'  => 'https://docs.litespeedtech.com/lscache/lscwp/#server-level-prerequisites',\n        );\n    }\n} elseif ( ! defined( 'LITESPEED_ON' ) ) {\n    $reasons[] = array(\n        'title' => esc_html__( 'Please enable LiteSpeed Cache in the plugin settings.', 'litespeed-cache' ),\n        'link'  => 'https://docs.litespeedtech.com/lscache/lscwp/cache/#enable-cache',\n    );\n}\n\nif ( $reasons ) : ?>\n    <div class=\"litespeed-callout notice notice-error inline\">\n        <h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n        <p>\n            <?php esc_html_e( 'LSCache caching functions on this page are currently unavailable!', 'litespeed-cache' ); ?>\n        </p>\n        <ul class=\"litespeed-list\">\n            <?php foreach ( $reasons as $reason ) : ?>\n                <li>\n                    <?php echo esc_html( $reason['title'] ); ?>\n                    <a href=\"<?php echo esc_url( $reason['link'] ); ?>\" target=\"_blank\" class=\"litespeed-learn-more\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a>\n                </li>\n            <?php endforeach; ?>\n        </ul>\n    </div>\n<?php endif; ?>\n",
    "plugins/litespeed-cache/tpl/inc/show_display_installed.php": "<?php\n/**\n * LiteSpeed Cache Installation Notice\n *\n * Displays a notice informing users that the LiteSpeed Cache plugin was installed by the server admin.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$buf  = sprintf(\n\t'<h3>%s</h3>\n\t<p>%s</p>\n\t<p>%s</p>\n\t<p>%s</p>\n\t<p>%s</p>\n\t<p>%s</p>\n\t<ul>\n\t\t<li>%s</li>\n\t\t<li>%s</li>\n\t</ul>',\n\tesc_html__( 'LiteSpeed Cache plugin is installed!', 'litespeed-cache' ),\n\tesc_html__( 'This message indicates that the plugin was installed by the server admin.', 'litespeed-cache' ),\n\tesc_html__( 'The LiteSpeed Cache plugin is used to cache pages - a simple way to improve the performance of the site.', 'litespeed-cache' ),\n\tesc_html__( 'However, there is no way of knowing all the possible customizations that were implemented.', 'litespeed-cache' ),\n\tesc_html__( 'For that reason, please test the site to make sure everything still functions properly.', 'litespeed-cache' ),\n\tesc_html__( 'Examples of test cases include:', 'litespeed-cache' ),\n\tesc_html__( 'Visit the site while logged out.', 'litespeed-cache' ),\n\tesc_html__( 'Create a post, make sure the front page is accurate.', 'litespeed-cache' )\n);\n$buf .= sprintf(\n\t/* translators: %s: Link tags */\n\tesc_html__( 'If there are any questions, the team is always happy to answer any questions on the %ssupport forum%s.', 'litespeed-cache' ),\n\t'<a href=\"https://wordpress.org/support/plugin/litespeed-cache\" rel=\"noopener noreferrer\" target=\"_blank\">',\n\t'</a>'\n);\n$buf .= '<p>' . esc_html__( 'If you would rather not move at litespeed, you can deactivate this plugin.', 'litespeed-cache' ) . '</p>';\n\nself::add_notice( self::NOTICE_BLUE . ' lscwp-whm-notice', $buf );\n",
    "plugins/litespeed-cache/tpl/inc/show_rule_conflict.php": "<?php\n/**\n * LiteSpeed Cache Unexpected Cache Rule Notice\n *\n * Displays a warning notice about conflicting cache rules in .htaccess that may cause stale content.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\n$err = sprintf(\n\tesc_html__(\n\t\t'Unexpected cache rule %2$s found in %1$s file. This rule may cause visitors to see old versions of pages due to the browser caching HTML pages. If you are sure that HTML pages are not being browser cached, this message can be dismissed. (%3$sLearn More%4$s)',\n\t\t'litespeed-cache'\n\t),\n\t'.htaccess',\n\t'<code>ExpiresDefault</code>',\n\t'<a href=\"https://docs.litespeedtech.com/lscache/lscwp/troubleshoot/#browser-displays-stale-content\" target=\"_blank\">',\n\t'</a>'\n);\n\n// Other plugin left cache expired rules in .htaccess which will cause conflicts\necho wp_kses_post( self::build_notice(self::NOTICE_YELLOW . ' lscwp-notice-ruleconflict', $err) );\n",
    "plugins/litespeed-cache/tpl/inc/in_upgrading.php": "<?php\n/**\n * LiteSpeed Cache Upgrade Notice\n *\n * Displays a notice informing the user that the LiteSpeed Cache plugin has been upgraded and a page refresh is needed to complete the configuration data upgrade.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$message = esc_html__( 'LiteSpeed cache plugin upgraded. Please refresh the page to complete the configuration data upgrade.', 'litespeed-cache' );\n\necho wp_kses_post( self::build_notice( self::NOTICE_BLUE, $message ) );\n",
    "plugins/litespeed-cache/tpl/inc/modal.deactivation.php": "<?php\n/**\n * LiteSpeed Cache Deactivation Modal\n *\n * Renders the deactivation modal interface for LiteSpeed Cache, allowing users to send reason of deactivation.\n *\n * @package LiteSpeed\n * @since 7.3\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n// Modal data\n$_title = esc_html__('Deactivate LiteSpeed Cache', 'litespeed');\n$_id    = 'litespeed-modal-deactivate';\n\n$reasons = array(\n\tarray(\n\t\t'value' => 'Temporary',\n\t\t'text' => esc_html__('The deactivation is temporary', 'litespeed-cache'),\n\t\t'id' => 'temp',\n\t\t'selected' => true,\n\t),\n\tarray(\n\t\t'value' => 'Performance worse',\n\t\t'text' => esc_html__('Site performance is worse', 'litespeed-cache'),\n\t\t'id' => 'performance',\n\t),\n\tarray(\n\t\t'value' => 'Plugin complicated',\n\t\t'text' => esc_html__('Plugin is too complicated', 'litespeed-cache'),\n\t\t'id' => 'complicated',\n\t),\n\tarray(\n\t\t'value' => 'Other',\n\t\t'text' => esc_html__('Other', 'litespeed-cache'),\n\t\t'id' => 'other',\n\t),\n);\n?>\n<div style=\"display: none\">\n    <div id=\"litespeed-deactivation\" class=\"iziModal\">\n        <div id=\"litespeed-modal-deactivate\">\n            <form id=\"litespeed-deactivation-form\" method=\"post\">\n                <p><?php esc_attr_e('Why are you deactivating the plugin?', 'litespeed-cache'); ?></p>\n                <div class=\"deactivate-reason-wrapper\">\n                    <?php foreach ($reasons as $reason) : ?>\n                    <label for=\"litespeed-deactivate-reason-<?php esc_attr_e( $reason['id'] ); ?>\">\n                        <input type=\"radio\" id=\"litespeed-deactivate-reason-<?php esc_attr_e( $reason['id'] ); ?>\" value=\"<?php esc_attr_e( $reason['value'] ); ?>\"\n                            <?php isset($reason['selected']) && $reason['selected'] ? ' checked=\"checked\"' : ''; ?> name=\"litespeed-reason\" />\n                        <?php esc_html_e( $reason['text'] ); ?>\n                    </label>\n                    <?php endforeach; ?>\n                </div>\n                <div class=\"deactivate-clear-settings-wrapper\">\n                    <i style=\"font-size: 0.9em;\">\n                        <?php\n                            esc_html_e('On uninstall, all plugin settings will be deleted.', 'litespeed-cache');\n                        ?>\n                    </i>\n                    <br />\n                    <i style=\"font-size: 0.9em;\">\n\n                        <?php\n                            printf(\n                                esc_html__('If you have used Image Optimization, please %sDestroy All Optimization Data%s first. NOTE: this does not remove your optimized images.', 'litespeed-cache'),\n                                '<a href=\"admin.php?page=litespeed-img_optm#litespeed-imageopt-destroy\" target=\"_blank\">',\n                                '</a>'\n                            );\n                        ?>\n                    </i>\n                </div>\n                <div class=\"deactivate-actions\">\n                    <input type=\"submit\" id=\"litespeed-deactivation-form-submit\" class=\"button button-primary\" value=\"<?php esc_attr_e('Deactivate', 'litespeed-cache'); ?>\" title=\"<?php esc_attr_e('Deactivate plugin', 'litespeed-cache'); ?>\" />\n                    <input type=\"button\" id=\"litespeed-deactivation-form-cancel\" class=\"button litespeed-btn-warning\" value=\"<?php esc_attr_e('Cancel', 'litespeed-cache'); ?>\" title=\"<?php esc_attr_e('Close popup', 'litespeed-cache'); ?>\" />\n                </div>\n            </form>\n        </div>\n    </div>\n</div>\n<script>\n    (function ($) {\n    'use strict';\n        jQuery(document).ready(function () {\n            var lscId = '<?php echo home_url(); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>';\n            var modalesc_attr_element = $('#litespeed-deactivation');\n            var deactivateesc_attr_element = $('#deactivate-litespeed-cache');\n\n            if (deactivateesc_attr_element.length > 0 && modalesc_attr_element.length > 0) {\n                // Variables\n                var modal_formElement = $('#litespeed-deactivation-form');\n\n                deactivateesc_attr_element.on('click', function (e) {\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                    modal_formElement.attr('action', decodeURI($(this).attr('href')));\n                    modalesc_attr_element.iziModal({\n                        radius: '.5rem',\n                        width: 550,\n                        autoOpen: true,\n                    });\n                });\n\n                $(document).on('submit', '#litespeed-deactivation-form', function (e) {\n                    e.preventDefault();\n                    $('#litespeed-deactivation-form-submit').attr('disabled', true);\n                    var container = $('#litespeed-deactivation-form');\n\n                    // Save selected data\n                    var data = {\n                        id: lscId,\n                        siteLink: window.location.hostname,\n                        reason: $(container).find('[name=litespeed-reason]:checked').val()\n                    };\n\n                    $.ajax({\n                        url: 'https://wpapi.quic.cloud/survey',\n                        dataType: 'json',\n                        method: 'POST',\n                        cache: false,\n                        data: data,\n                        success: function (data) {\n                            console.log('QC data sent.');\n                        },\n                        error: function (xhr, error) {\n                            console.log('Error sending data to QC.');\n                        },\n                    });\n\n                    $('#litespeed-deactivation-form')[0].submit();\n                });\n                $(document).on('click', '#litespeed-deactivation-form-cancel', function (e) {\n                    modalesc_attr_element.iziModal('close');\n                });\n            }\n        });\n    })(jQuery);\n</script>\n",
    "plugins/litespeed-cache/tpl/inc/admin_footer.php": "<?php\n/**\n * LiteSpeed Cache Admin Footer\n *\n * Customizes the admin footer text for LiteSpeed Cache with links to rate, documentation, support forum, and community.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$stars = '<span class=\"wporg-ratings rating-stars\"><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"></span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"></span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"></span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"></span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"></span></span>';\n\n$rate_us = '<a href=\"https://wordpress.org/support/plugin/litespeed-cache/reviews/?filter=5#new-post\" rel=\"noopener noreferrer\" target=\"_blank\">' . sprintf( esc_html__( 'Rate %1$s on %2$s', 'litespeed-cache' ), '<strong>' . esc_html__( 'LiteSpeed Cache', 'litespeed-cache' ) . $stars . '</strong>', 'WordPress.org' ) . '</a>';\n\n$wiki = '<a href=\"https://docs.litespeedtech.com/lscache/lscwp/\" target=\"_blank\">' . esc_html__( 'Read LiteSpeed Documentation', 'litespeed-cache' ) . '</a>';\n\n$forum = '<a href=\"https://wordpress.org/support/plugin/litespeed-cache\" target=\"_blank\">' . esc_html__( 'Visit LSCWP support forum', 'litespeed-cache' ) . '</a>';\n\n$community = '<a href=\"https://litespeedtech.com/slack\" target=\"_blank\">' . esc_html__( 'Join LiteSpeed Slack community', 'litespeed-cache' ) . '</a>';\n\n// Change the footer text\nif ( ! is_multisite() || is_network_admin() ) {\n\t$footer_text = $rate_us . ' | ' . $wiki . ' | ' . $forum . ' | ' . $community;\n} else {\n\t$footer_text = $wiki . ' | ' . $forum . ' | ' . $community;\n}\n",
    "plugins/litespeed-cache/tpl/inc/show_error_cookie.php": "<?php\n/**\n * LiteSpeed Cache Database Login Cookie Notice\n *\n * Displays a notice about mismatched login cookies for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\n$err =\n\tesc_html__('NOTICE: Database login cookie did not match your login cookie.', 'litespeed-cache') .\n\t' ' .\n\tesc_html__('If the login cookie was recently changed in the settings, please log out and back in.', 'litespeed-cache') .\n\t' ' .\n\tsprintf(\n\t\tesc_html__('If not, please verify the setting in the %sAdvanced tab%s.', 'litespeed-cache'),\n\t\t\"<a href='\" . esc_url(admin_url('admin.php?page=litespeed-cache#advanced')) . '\">',\n\t\t'</a>'\n\t);\n\nif (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t$err .= ' ' . esc_html__('If using OpenLiteSpeed, the server must be restarted once for the changes to take effect.', 'litespeed-cache');\n}\n\nself::add_notice(self::NOTICE_YELLOW, $err);\n",
    "plugins/litespeed-cache/tpl/inc/check_if_network_disable_all.php": "<?php\n/**\n * LiteSpeed Cache Network Primary Site Configuration Warning\n *\n * Displays a warning notice on subsite admin pages when the network admin has enforced primary site configurations.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nif ( ! is_multisite() ) {\n    return;\n}\n\nif ( get_current_blog_id() === BLOG_ID_CURRENT_SITE ) {\n    return;\n}\n\nif ( ! $this->network_conf( Base::NETWORK_O_USE_PRIMARY ) ) {\n    return;\n}\n?>\n<div class=\"litespeed-callout notice notice-error inline\">\n    <h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n    <p>\n        <?php esc_html_e( 'The network admin selected use primary site configs for all subsites.', 'litespeed-cache' ); ?>\n        <?php esc_html_e( 'The following options are selected, but are not editable in this settings page.', 'litespeed-cache' ); ?>\n    </p>\n</div>",
    "plugins/litespeed-cache/tpl/esi.tpl.php": "<?php\n/**\n * LiteSpeed Cache ESI Block Loader\n *\n * Loads the ESI block for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\ndefined( 'WPINC' ) || exit;\n\n\\LiteSpeed\\ESI::cls()->load_esi_block();\n",
    "plugins/litespeed-cache/tpl/page_optm/settings_media_exc.tpl.php": "<?php\n/**\n * LiteSpeed Cache Media Excludes Settings\n *\n * Renders the media excludes settings interface for LiteSpeed Cache, allowing configuration of exclusions for lazy loading and LQIP.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Media Excludes', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#media-excludes-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed images will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br /><?php esc_html_e( 'Useful for above-the-fold images causing CLS (a Core Web Vitals metric).', 'litespeed-cache' ); ?>\n\t\t\t\t<br /><font class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_media_lazy_img_excludes</code>' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-lazy=\"1\"</code>' ); ?>\n\t\t\t\t</font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Images containing these class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url( true ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_PARENT_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Images having these parent class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_IFRAME_LAZY_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Iframes containing these class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url( true ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Iframes having these parent class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_URI_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Prevent any lazy load of listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LQIP_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'These images will not generate LQIP.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n</tbody></table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_html.tpl.php": "<?php\n/**\n * LiteSpeed Cache HTML Settings\n *\n * Renders the HTML optimization settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'HTML Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#html-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_HTML_MIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Minify HTML content.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_DNS_PREFETCH; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prefetching DNS can reduce latency for visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'For example', 'litespeed-cache' ); ?>: <code>//www.example.com</code>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#dns-prefetch' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_DNS_PREFETCH_CTRL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically enable DNS prefetching for all URLs in the document, including images, CSS, JavaScript, and so forth.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve the page loading speed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_DNS_PRECONNECT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Preconnecting speeds up future loads from a given origin.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'For example', 'litespeed-cache' ); ?>: <code>https://example.com</code>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/preconnect' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_HTML_LAZY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Delay rendering off-screen HTML elements by its selector.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#html-lazyload-selectors' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_HTML_SKIP_COMMENTS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'When minifying HTML do not discard comments that match a specified pattern.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<?php printf( esc_html__( 'If comment to be kept is like: %1$s write: %2$s', 'litespeed-cache' ), '<code>&lt;!-- A comment that needs to be here --&gt;</code>', '<code>A comment that needs to be here</code>' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_QS_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Remove query strings from internal static resources.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\t\t⚠️\n\t\t\t\t\t\t<?php esc_html_e( 'Google reCAPTCHA will be bypassed automatically.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Append query string %s to the resources to bypass this action.', 'litespeed-cache' ), '<code>&amp;_litespeed_rm_qs=0</code>' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GGFONTS_ASYNC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Use Web Font Loader library to load Google Fonts asynchronously while leaving other CSS intact.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will also add a preconnect to Google Fonts to establish a connection earlier.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#load-google-fonts-asynchronously' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GGFONTS_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent Google Fonts from loading on all pages.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_EMOJI_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Stop loading WordPress.org emoji. Browser default emoji will be displayed instead.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_NOSCRIPT_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'This option will remove all %s tags from HTML.', 'litespeed-cache' ), '<code>&lt;noscript&gt;</code>' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#remove-noscript-tags' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t</tbody>\n</table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_js.tpl.php": "<?php\n/**\n * LiteSpeed Cache JS Settings\n *\n * Renders the JS optimization settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'JS Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#js-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_MIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Minify JS files and inline JS codes.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_COMB; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Combine all local JS files into a single file.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<a href=\"https://docs.litespeedtech.com/lscache/lscwp/ts-optimize/\" target=\"_blank\"><?php esc_html_e( 'How to Fix Problems Caused by CSS/JS Optimization.', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t🚨 <?php esc_html_e( 'This option may result in a JS error or layout issue on frontend pages with certain themes/plugins.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php esc_html_e( 'JS error can be found from the developer console of browser by right clicking and choosing Inspect.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_COMB_EXT_INL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Include external JS and inline JS in combined file when %1$s is also enabled. This option helps maintain the priorities of JS execution, which should minimize potential errors caused by JS Combine.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_JS_COMB ) ) . '</code>' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_DEFER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), esc_html__( 'Deferred', 'litespeed-cache' ), esc_html__( 'Delayed', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Deferring until page is parsed or delaying till interaction can help reduce resource contention and improve performance causing a lower FID (Core Web Vitals metric).', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#load-js-deferred' ); ?><br />\n\t\t\t\t\t<?php esc_html_e( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://web.dev/fid/#what-is-fid' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t🚨 <?php esc_html_e( 'This option may result in a JS error or layout issue on frontend pages with certain themes/plugins.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t</tbody>\n</table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_localization.tpl.php": "<?php\n/**\n * LiteSpeed Cache Localization Settings\n *\n * Renders the localization settings interface for LiteSpeed Cache, including Gravatar caching and resource localization.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$last_generated = Avatar::get_summary();\n$avatar_queue   = Avatar::cls()->queue_count();\n?>\n\n<?php if ( $this->cls( 'Avatar' )->need_db() && ! $this->cls( 'Data' )->tb_exist( 'avatar' ) ) : ?>\n<div class=\"litespeed-callout notice notice-error inline\">\n\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n\t<p><?php printf( esc_html__( 'Failed to create Avatar table. Please follow <a %s>Table Creation guidance from LiteSpeed Wiki</a> to finish setup.', 'litespeed-cache' ), 'href=\"https://www.litespeedtech.com/support/wiki/doku.php/litespeed_wiki:cache:lscwp:installation\" target=\"_blank\"' ); ?></p>\n</div>\n<?php endif; ?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Localization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#localization-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_DISCUSS_AVATAR_CACHE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Store Gravatar locally.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'Accelerates the speed by caching Gravatar (Globally Recognized Avatars).', 'litespeed-cache' ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th class=\"litespeed-padding-left\">\n\t\t\t<?php $option_id = Base::O_DISCUSS_AVATAR_CRON; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Refresh Gravatar cache by cron.', 'litespeed-cache' ); ?>\n\t\t\t</div>\n\n\t\t\t<?php if ( $last_generated ) : ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php if ( ! empty( $last_generated['last_request'] ) ) : ?>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo esc_html__( 'Last ran', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $last_generated['last_request'] ) ) . '</code>'; ?>\n\t\t\t\t\t</p>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php if ( $avatar_queue ) : ?>\n\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Avatar list in queue waiting for update', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php echo esc_html( $avatar_queue ); ?>\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_AVATAR, Avatar::TYPE_GENERATE ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'Run Queue Manually', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t<?php endif; ?>\n\t\t\t</div>\n\t\t\t<?php endif; ?>\n\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th class=\"litespeed-padding-left\">\n\t\t\t<?php $option_id = Base::O_DISCUSS_AVATAR_CACHE_TTL; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Specify how long, in seconds, Gravatar files are cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 3600 ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_LOCALIZE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Localize external resources.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#localize' ); ?>\n\n\t\t\t\t<br /><font class=\"litespeed-danger\">\n\t\t\t\t\t🚨 <?php printf( esc_html__( 'Please thoroughly test all items in %s to ensure they function as expected.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_LOCALIZE_DOMAINS ) ) . '</code>' ); ?>\n\t\t\t\t</font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th class=\"litespeed-padding-left\">\n\t\t\t<?php $option_id = Base::O_OPTM_LOCALIZE_DOMAINS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id, true ); ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Resources listed here will be copied and replaced with local URLs.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'HTTPS sources only.', 'litespeed-cache' ); ?>\n\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\n\t\t\t\t<br /><?php printf( esc_html__( 'Comments are supported. Start a line with a %s to turn it into a comment line.', 'litespeed-cache' ), '<code>#</code>' ); ?>\n\n\t\t\t\t<br /><?php esc_html_e( 'Example', 'litespeed-cache' ); ?>: <code>https://www.example.com/one.js</code>\n\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#localization-files' ); ?>\n\n\t\t\t\t<br /><font class=\"litespeed-danger\">\n\t\t\t\t\t🚨 <?php esc_html_e( 'Please thoroughly test each JS file you add to ensure it functions as expected.', 'litespeed-cache' ); ?>\n\t\t\t\t</font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n</tbody></table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_css.tpl.php": "<?php\n/**\n * LiteSpeed Cache CSS Settings\n *\n * Renders the CSS optimization settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__admin_display     = Admin_Display::cls();\n$css_summary         = CSS::get_summary();\n$ucss_summary        = UCSS::get_summary();\n$closest_server_ucss = Cloud::get_summary( 'server.' . Cloud::SVC_UCSS );\n$closest_server      = Cloud::get_summary( 'server.' . Cloud::SVC_CCSS );\n\n$ccss_queue = $this->load_queue( 'ccss' );\n$ucss_queue = $this->load_queue( 'ucss' );\n\n$next_gen = '<code class=\"litespeed-success\">' . $this->cls( 'Media' )->next_gen_image_title() . '</code>';\n\n$ucss_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_UCSS );\n$ccss_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_CCSS );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'CSS Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_MIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Minify CSS files and inline CSS code.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_COMB; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Combine CSS files and inline CSS code.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<a href=\"https://docs.litespeedtech.com/lscache/lscwp/ts-optimize/\" target=\"_blank\"><?php esc_html_e( 'How to Fix Problems Caused by CSS/JS Optimization.', 'litespeed-cache' ); ?></a>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_UCSS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php if ( ! $this->cls( 'Cloud' )->activated() ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t\t\t<?php echo wp_kses_post( Error::msg( 'qc_setup_required' ) ); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php esc_html_e( 'Use QUIC.cloud online service to generate unique CSS.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will drop the unused CSS on each page from the combined file.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#generate-ucss' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( 'Automatic generation of unique CSS is in the background via a cron-based queue.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\"><?php esc_html_e( 'API', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'Filter %s available for UCSS per page type generation.', 'litespeed-cache' ), '<code>add_filter( \"litespeed_ucss_per_pagetype\", \"__return_true\" );</code>' ); ?></font>\n\t\t\t\t\t<?php $__admin_display->_check_overwritten( 'optm-ucss_per_pagetype' ); ?>\n\n\t\t\t\t\t<?php if ( $this->conf( Base::O_OPTM_UCSS ) && ! $this->conf( Base::O_OPTM_CSS_COMB ) ) : ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'This option is bypassed because %1$s option is %2$s.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_CSS_COMB ) ) . '</code>', '<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '</code>' ); ?>\n\t\t\t\t\t\t</font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t<?php if ( $ucss_summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $ucss_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $ucss_summary['last_request'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last requested cost', 'litespeed-cache' ) . ': <code>' . esc_html( $ucss_summary['last_spent'] ) . 's</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server_ucss ) : ?>\n\t\t\t\t\t\t<a class=\"litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_UCSS ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label=\"<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server_ucss ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class=\"litespeed-quic-icon\"></i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $ucss_queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'URL list in %s queue waiting for cron', 'litespeed-cache' ), 'UCSS' ); ?> ( <?php echo esc_html( count( $ucss_queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_UCSS, UCSS::TYPE_CLEAR_Q ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $ucss_queue as $queue_key => $queue_val ) :\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) :\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tendif;\n\t\t\t\t\t\t\t\t\tif ( ! is_array( $queue_val ) ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<span class=\"litespeed-success\">';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $queue_val['url'] );\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$pos = strpos( $queue_key, ' ' );\n\t\t\t\t\t\t\t\t\tif ( $pos ) {\n\t\t\t\t\t\t\t\t\t\techo ' (' . esc_html__( 'Vary Group', 'litespeed-cache' ) . ':' . esc_html( substr( $queue_key, 0, $pos ) ) . ')';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( $queue_val['is_mobile'] ) {\n\t\t\t\t\t\t\t\t\t\techo ' <span data-balloon-pos=\"up\" aria-label=\"mobile\">📱</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['is_webp'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo ' ' . wp_kses_post( $next_gen );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo '<br />';\n\t\t\t\t\t\t\t\tendforeach;\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( $ucss_service_hot ) : ?>\n\t\t\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'UCSS' ); ?>\n\t\t\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $ucss_service_hot ) ); ?>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_UCSS, UCSS::TYPE_GEN ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'UCSS' ); ?>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_UCSS_INLINE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Inline UCSS to reduce the extra CSS file loading. This option will not be automatically turned on for %1$s pages. To use it on %1$s pages, please set it to ON.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_GUEST ) ) . '</code>' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-info\">\n\t\t\t\t\t\t<?php printf( esc_html__( 'This option will automatically bypass %s option.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_CSS_ASYNC ) ) . '</code>' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_COMB_EXT_INL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Include external CSS and inline CSS in combined file when %1$s is also enabled. This option helps maintain the priorities of CSS, which should minimize potential errors caused by CSS Combine.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_CSS_COMB ) ) . '</code>' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_ASYNC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php if ( ! $this->cls( 'Cloud' )->activated() ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t\t\t<?php echo wp_kses_post( Error::msg( 'qc_setup_required' ) ); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php esc_html_e( 'Optimize CSS delivery.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?><br />\n\t\t\t\t\t<?php esc_html_e( 'Use QUIC.cloud online service to generate critical CSS and load remaining CSS asynchronously.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#load-css-asynchronously' ); ?><br />\n\t\t\t\t\t<?php esc_html_e( 'Automatic generation of critical CSS is in the background via a cron-based queue.', 'litespeed-cache' ); ?><br />\n\t\t\t\t\t<?php printf( esc_html__( 'When this option is turned %s, it will also load Google Fonts asynchronously.', 'litespeed-cache' ), '<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '</code>' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in HTML code will be excluded.', 'litespeed-cache' ), '<code>data-no-async=\"1\"</code>' ); ?>\n\t\t\t\t\t</font>\n\n\t\t\t\t\t<?php if ( $this->conf( Base::O_OPTM_CSS_ASYNC ) && $this->conf( Base::O_OPTM_CSS_COMB ) && $this->conf( Base::O_OPTM_UCSS ) && $this->conf( Base::O_OPTM_UCSS_INLINE ) ) : ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'This option is bypassed due to %s option.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_UCSS_INLINE ) ) . '</code>' ); ?>\n\t\t\t\t\t\t</font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t<?php if ( $css_summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $css_summary['last_request_ccss'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $css_summary['last_request_ccss'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last requested cost', 'litespeed-cache' ) . ': <code>' . esc_html( $css_summary['last_spent_ccss'] ) . 's</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t<a class=\"litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_CCSS ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label=\"<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class=\"litespeed-quic-icon\"></i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $ccss_queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'URL list in %s queue waiting for cron', 'litespeed-cache' ), 'CCSS' ); ?> ( <?php echo esc_html( count( $ccss_queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CSS, CSS::TYPE_CLEAR_Q_CCSS ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $ccss_queue as $queue_key => $queue_val ) :\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) :\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tendif;\n\t\t\t\t\t\t\t\t\tif ( ! is_array( $queue_val ) ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<span class=\"litespeed-success\">';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $queue_val['url'] );\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$pos = strpos( $queue_key, ' ' );\n\t\t\t\t\t\t\t\t\tif ( $pos ) {\n\t\t\t\t\t\t\t\t\t\techo ' (' . esc_html__( 'Vary Group', 'litespeed-cache' ) . ':' . esc_html( substr( $queue_key, 0, $pos ) ) . ')';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( $queue_val['is_mobile'] ) {\n\t\t\t\t\t\t\t\t\t\techo ' <span data-balloon-pos=\"up\" aria-label=\"mobile\">📱</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['is_webp'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo ' ' . wp_kses_post( $next_gen );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo '<br />';\n\t\t\t\t\t\t\t\tendforeach;\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( $ccss_service_hot ) : ?>\n\t\t\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'CCSS' ); ?>\n\t\t\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $ccss_service_hot ) ); ?>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CSS, CSS::TYPE_GEN_CCSS ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'CCSS' ); ?>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_CCSS_PER_URL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Disable this option to generate CCSS per Post Type instead of per page. This can save significant CCSS quota, however it may result in incorrect CSS styling if your site uses a page builder.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_ASYNC_INLINE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'This will inline the asynchronous CSS library to avoid render blocking.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_FONT_DISPLAY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'Default', 'litespeed-cache' ), 'Swap' ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Set this to append %1$s to all %2$s rules before caching CSS to specify how fonts should be displayed while being downloaded.', 'litespeed-cache' ), '<code>font-display</code>', '<code>@font-face</code>' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( '%s is recommended.', 'litespeed-cache' ), '<code>' . esc_html__( 'Swap', 'litespeed-cache' ) . '</code>' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_tuning.tpl.php": "<?php\n/**\n * LiteSpeed Cache Tuning Settings\n *\n * Renders the tuning settings interface for LiteSpeed Cache, allowing configuration of optimization exclusions and role-based settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nglobal $wp_roles;\n$wp_orig_roles = $wp_roles;\nif ( ! isset( $wp_roles ) ) {\n\t$wp_orig_roles = new \\WP_Roles();\n}\n\n$roles = array();\nforeach ( $wp_orig_roles->roles as $k => $v ) {\n\t$roles[ $k ] = $v['name'];\n}\nksort( $roles );\n\n?>\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Tuning Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#tuning-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_DELAY_INC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Listed JS files or inline JS code will be delayed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_js_delay_inc</code>' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Listed JS files or inline JS code will not be minified or combined.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optimize_js_excludes</code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-optimize=\"1\"</code>' ); ?>\n\t\t\t\t\t\t<br /><?php esc_html_e( 'Predefined list will also be combined with the above settings.', 'litespeed-cache' ); ?>: <a href=\"https://github.com/litespeedtech/lscache_wp/blob/dev/data/js_excludes.txt\" target=\"_blank\">https://github.com/litespeedtech/lscache_wp/blob/dev/data/js_excludes.txt</a>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_DEFER_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Listed JS files or inline JS code will not be deferred or delayed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br /><span class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_js_defer_exc</code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-defer=\"1\"</code>' ); ?>\n\t\t\t\t\t\t<br /><?php esc_html_e( 'Predefined list will also be combined with the above settings.', 'litespeed-cache' ); ?>: <a href=\"https://github.com/litespeedtech/lscache_wp/blob/dev/data/js_defer_excludes.txt\" target=\"_blank\">https://github.com/litespeedtech/lscache_wp/blob/dev/data/js_defer_excludes.txt</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GM_JS_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Listed JS files or inline JS code will not be optimized by %s.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_GUEST ) ) . '</code>' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br /><span class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_gm_js_exc</code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-defer=\"1\"</code>' ); ?>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent any optimization of listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t\t<br /><span class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_uri_exc</code>' ); ?>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GUEST_ONLY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Only optimize pages for guest (not logged in) visitors. If turned this OFF, CSS/JS/CCSS files will be doubled by each user group.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_EXC_ROLES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Selected roles will be excluded from all optimizations.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-tick-list\">\n\t\t\t\t\t<?php\n\t\t\t\t\tforeach ( $roles as $role_id => $role_title ) {\n\t\t\t\t\t\t$this->build_checkbox( $option_id . '[]', $role_title, $this->cls( 'Conf' )->in_optm_exc_roles( $role_id ), $role_id );\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t</tbody>\n</table>",
    "plugins/litespeed-cache/tpl/page_optm/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Page Optimization Interface\n *\n * Renders the page optimization settings interface for LiteSpeed Cache with tabbed navigation.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'settings_css'          => esc_html__( 'CSS Settings', 'litespeed-cache' ),\n\t'settings_js'           => esc_html__( 'JS Settings', 'litespeed-cache' ),\n\t'settings_html'         => esc_html__( 'HTML Settings', 'litespeed-cache' ),\n\t'settings_media'        => esc_html__( 'Media Settings', 'litespeed-cache' ),\n\t'settings_vpi'          => esc_html__( 'VPI', 'litespeed-cache' ),\n\t'settings_media_exc'    => esc_html__( 'Media Excludes', 'litespeed-cache' ),\n\t'settings_localization' => esc_html__( 'Localization', 'litespeed-cache' ),\n\t'settings_tuning'       => esc_html__( 'Tuning', 'litespeed-cache' ),\n\t'settings_tuning_css'   => esc_html__( 'Tuning', 'litespeed-cache' ) . ' - CSS',\n);\n\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Page Optimization', 'litespeed-cache' ); ?>\n\t</h1>\n\t<span class=\"litespeed-desc\">\n\t\tv<?php echo esc_html( Core::VER ); ?>\n\t</span>\n\t<hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?></h4>\n\t\t<p><?php esc_html_e( 'Please test thoroughly when enabling any option in this list. After changing Minify/Combine settings, please do a Purge All action.', 'litespeed-cache' ); ?></p>\n\t</div>\n\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t</h2>\n\n\t<div class=\"litespeed-body\">\n\t<?php\n\t\t$this->form_action();\n\n\t\t// Include all tpl for faster UE\n\t\tforeach ( $menu_list as $tab_key => $tab_val ) {\n\t\t\t?>\n\t\t\t<div data-litespeed-layout='<?php echo esc_attr( $tab_key ); ?>'>\n\t\t\t\t<?php require LSCWP_DIR . 'tpl/page_optm/' . $tab_key . '.tpl.php'; ?>\n\t\t\t</div>\n\t\t\t<?php\n\t\t}\n\n\t\t$this->form_end();\n\t?>\n\t</div>\n\n</div>",
    "plugins/litespeed-cache/tpl/page_optm/settings_media.tpl.php": "<?php\n/**\n * LiteSpeed Cache Media Settings\n *\n * Renders the media settings interface for LiteSpeed Cache, including lazy loading, placeholders, and image optimization options.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__admin_display     = Admin_Display::cls();\n$placeholder_summary = Placeholder::get_summary();\n$closest_server      = Cloud::get_summary( 'server.' . Cloud::SVC_LQIP );\n\n$lqip_queue = $this->load_queue( 'lqip' );\n\n$scaled_size = apply_filters( 'big_image_size_threshold', 2560 ) . 'px';\n\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Media Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#media-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LAZY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Load images only when they enter the viewport.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve page loading time by reducing initial HTTP requests.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t💡\n\t\t\t\t\t\t<a href=\"https://docs.litespeedtech.com/lscache/lscwp/pageopt/#lazy-load-images\" target=\"_blank\"><?php esc_html_e( 'Adding Style to Your Lazy-Loaded Images', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_PLACEHOLDER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-long' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify a base64 image to be used as a simple placeholder while images finish loading.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( 'This can be predefined in %2$s as well using constant %1$s, with this setting taking priority.', 'litespeed-cache' ), '<code>LITESPEED_PLACEHOLDER</code>', '<code>wp-config.php</code>' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( 'By default a gray image placeholder %s will be used.', 'litespeed-cache' ), '<code>data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=</code>' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( 'For example, %s can be used for a transparent placeholder.', 'litespeed-cache' ), '<code>data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7</code>' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Responsive image placeholders can help to reduce layout reshuffle when images are loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will generate the placeholder with same dimensions as the image if it has the width and height attributes.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP_SVG; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-long' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify an SVG to be used as a placeholder when generating locally.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'It will be converted to a base64 SVG placeholder on-the-fly.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( 'Variables %s will be replaced with the corresponding image properties.', 'litespeed-cache' ), '<code>{width} {height}</code>' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( 'Variables %s will be replaced with the configured background color.', 'litespeed-cache' ), '<code>{color}</code>' ); ?>\n\t\t\t\t\t<br /><?php $this->recommended( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP_COLOR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, null, null, 'color' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the responsive placeholder SVG color.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LQIP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Use QUIC.cloud LQIP (Low Quality Image Placeholder) generator service for responsive image previews while loading.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( 'Keep this off to use plain color placeholders.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#lqip-cloud-generator' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LQIP_QUAL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the quality when generating LQIP.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( 'Larger number will generate higher resolution quality placeholder, but will result in larger files which will increase page size and consume more points.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 1, 20 ); ?>\n\t\t\t\t\t<br />💡 <?php printf( esc_html__( 'Changes to this setting do not apply to already-generated LQIPs. To regenerate existing LQIPs, please %s first from the admin bar menu.', 'litespeed-cache' ), '<code>' . esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'LQIP Cache', 'litespeed-cache' ) . '</code>' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LQIP_MIN_W; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> x\n\t\t\t\t<?php $this->build_input( Base::O_MEDIA_LQIP_MIN_H, 'litespeed-input-short' ); ?>\n\t\t\t\t<?php esc_html_e( 'pixels', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'LQIP requests will not be sent for images where both width and height are smaller than these dimensions.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 10, 800 ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( Base::O_MEDIA_LQIP_MIN_H, 10, 800 ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP_ASYNC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically generate LQIP in the background via a cron-based queue.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'If set to %1$s, before the placeholder is localized, the %2$s configuration will be used.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '</code>',\n\t\t\t\t\t\t'<code>' . esc_html( Lang::title( Base::O_MEDIA_PLACEHOLDER_RESP_SVG ) ) . '</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php printf( esc_html__( 'If set to %s this is done in the foreground, which may slow down page load.', 'litespeed-cache' ), '<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '</code>' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#generate-lqip-in-background' ); ?>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php if ( $placeholder_summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $placeholder_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $placeholder_summary['last_request'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t<a class=\"litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_LQIP ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label='<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>' data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class='litespeed-quic-icon'></i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $lqip_queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Size list in queue waiting for cron', 'litespeed-cache' ); ?> ( <?php echo esc_html( count( $lqip_queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PLACEHOLDER, Placeholder::TYPE_CLEAR_Q ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $lqip_queue as $k => $v ) {\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) {\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $v );\n\t\t\t\t\t\t\t\t\techo '<br />';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PLACEHOLDER, Placeholder::TYPE_GENERATE ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Run Queue Manually', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_IFRAME_LAZY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Load iframes only when they enter the viewport.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve page loading time by reducing initial HTTP requests.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_ADD_MISSING_SIZES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Set an explicit width and height on image elements to reduce layout shifts and improve CLS (a Core Web Vitals metric).', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://web.dev/optimize-cls/#images-without-dimensions' ); ?>\n\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-warning litespeed-left10\">\n\t\t\t\t\t\t⚠️ <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( '%s must be turned ON for this setting to work.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_MEDIA_LAZY ) ) . '</code>' ); ?>\n\t\t\t\t\t</font>\n\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Use %1$s to bypass remote image dimension check when %2$s is ON.', 'litespeed-cache' ), '<code>add_filter( \"litespeed_media_ignore_remote_missing_sizes\", \"__return_true\" );</code>', '<code>' . esc_html( Lang::title( Base::O_MEDIA_ADD_MISSING_SIZES ) ) . '</code>' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t\t<?php $__admin_display->_check_overwritten( Base::O_MEDIA_ADD_MISSING_SIZES ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_JPG_QUALITY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The image compression quality setting of WordPress out of 100.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 0, 100 ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_AUTO_RESCALE_ORI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically replace large images with scaled versions.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Scaled size threshold', 'litespeed-cache' ); ?>: <code><?php echo wp_kses_post( $scaled_size ); ?></code>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class=\"litespeed-success\">\n\t\t\t\t\t\tAPI:\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\tesc_html__( 'Filter %s available to change threshold.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<code>big_image_size_threshold</code>'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<a href=\"https://developer.wordpress.org/reference/hooks/big_image_size_threshold/\" target=\"_blank\" class=\"litespeed-learn-more\">\n\t\t\t\t\t\t\t<?php esc_html_e('Learn More', 'litespeed-cache'); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t🚨\n\t\t\t\t\t\t<?php esc_html_e( 'This is irreversible.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_vpi.tpl.php": "<?php\n/**\n * LiteSpeed Cache Viewport Images Settings\n *\n * Renders the Viewport Images settings interface for LiteSpeed Cache, allowing configuration of viewport image detection and exclusions.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$summary        = VPI::get_summary();\n$closest_server = Cloud::get_summary( 'server.' . Cloud::SVC_VPI );\n\n$queue           = $this->load_queue( 'vpi' );\n$vpi_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_VPI );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Viewport Images', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#vpi-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_VPI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'When you use Lazy Load, it will delay the loading of all images on a page.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( 'The Viewport Images service detects which images appear above the fold, and excludes them from lazy load.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php esc_html_e( \"This enables the page's initial screenful of imagery to be fully displayed without delay.\", 'litespeed-cache' ); ?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_MEDIA_LAZY ) ) : ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<font class=\"litespeed-warning litespeed-left10\">\n\t\t\t\t\t\t\t⚠️ <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( '%s must be turned ON for this setting to work.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_MEDIA_LAZY ) ) . '</code>' ); ?>\n\t\t\t\t\t\t</font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t<?php if ( $summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $summary['last_request'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t<a class='litespeed-redetect' href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_VPI ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label='<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>' data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class='litespeed-quic-icon'></i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'URL list in %s queue waiting for cron', 'litespeed-cache' ), 'VPI' ); ?> ( <?php echo esc_html( count( $queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_VPI, VPI::TYPE_CLEAR_Q ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $queue as $k => $v ) {\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) {\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! is_array( $v ) ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $v['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<span class=\"litespeed-success\">';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $v['url'] );\n\t\t\t\t\t\t\t\t\tif ( ! empty( $v['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$pos = strpos( $k, ' ' );\n\t\t\t\t\t\t\t\t\tif ( $pos ) {\n\t\t\t\t\t\t\t\t\t\techo ' (' . esc_html__( 'Vary Group', 'litespeed-cache' ) . ':' . esc_html( substr( $k, 0, $pos ) ) . ')';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( $v['is_mobile'] ) {\n\t\t\t\t\t\t\t\t\t\techo ' <span data-balloon-pos=\"up\" aria-label=\"mobile\">📱</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo '<br />';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( $vpi_service_hot ) : ?>\n\t\t\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'VPI' ); ?>\n\t\t\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $vpi_service_hot ) ); ?>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_VPI, VPI::TYPE_GEN ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'VPI' ); ?>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_VPI_CRON; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Enable Viewport Images auto generation cron.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>",
    "plugins/litespeed-cache/tpl/page_optm/settings_tuning_css.tpl.php": "<?php\n/**\n * LiteSpeed Cache Tuning CSS Settings\n *\n * Renders the Tuning CSS settings interface for LiteSpeed Cache, allowing configuration of CSS exclusions and optimizations.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n?>\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Tuning CSS Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#tuning-css-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n<tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CSS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed CSS files or inline CSS code will not be minified or combined.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br /><font class=\"litespeed-success\">\n\t\t\t\t\t<?php echo esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optimize_css_excludes</code>' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-optimize=\"1\"</code>' ); ?>\n\t\t\t\t\t<br /><?php echo esc_html_e( 'Predefined list will also be combined with the above settings', 'litespeed-cache' ); ?>: <a href=\"https://github.com/litespeedtech/lscache_wp/blob/dev/data/css_excludes.txt\" target=\"_blank\">https://github.com/litespeedtech/lscache_wp/blob/dev/data/css_excludes.txt</a>\n\t\t\t\t</font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_UCSS_FILE_EXC_INLINE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed CSS files will be excluded from UCSS and saved to inline.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_UCSS_SELECTOR_WHITELIST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'List the CSS selectors whose styles should always be included in UCSS.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#ucss-selector-allowlist', esc_html__( 'Learn more', 'litespeed-cache' ) ); ?>.\n\t\t\t\t<br /><?php printf( esc_html__( 'Wildcard %s supported.', 'litespeed-cache' ), '<code>*</code>' ); ?>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'The selector must exist in the CSS. Parent classes in the HTML will not work.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'Predefined list will also be combined w/ the above settings', 'litespeed-cache' ); ?>: <a href=\"https://github.com/litespeedtech/lscache_wp/blob/dev/data/ucss_whitelist.txt\" target=\"_blank\">https://github.com/litespeedtech/lscache_wp/blob/dev/data/ucss_whitelist.txt</a>\n\t\t\t\t</font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_UCSS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed URI will not generate UCSS.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br /><span class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_ucss_exc</code>' ); ?>\n\t\t\t\t</span>\n\t\t\t\t<br /><font class=\"litespeed-success\"><?php esc_html_e( 'API', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'Use %1$s to generate one single UCSS for the pages which page type is %2$s while other page types still per URL.', 'litespeed-cache' ), \"<code>add_filter( 'litespeed_ucss_per_pagetype', function(){return get_post_type() == 'page';} );</code>\", '<code>page</code>' ); ?></font>\n\t\t\t\t<br /><font class=\"litespeed-success\"><?php esc_html_e( 'API', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'Use %1$s to bypass UCSS for the pages which page type is %2$s.', 'litespeed-cache' ), \"<code>add_action( 'litespeed_optm', function(){get_post_type() == 'page' && do_action( 'litespeed_conf_force', 'optm-ucss', false );});</code>\", '<code>page</code>' ); ?></font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_SEP_POSTTYPE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'List post types where each item of that type should have its own CCSS generated.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php printf( esc_html__( 'For example, if every Page on the site has different formatting, enter %s in the box. Separate critical CSS files will be stored for every Page on the site.', 'litespeed-cache' ), '<code>page</code>' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#separate-ccss-cache-post-types_1' ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_SEP_URI; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Separate critical CSS files will be generated for paths containing these strings.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_SELECTOR_WHITELIST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'List the CSS selectors whose styles should always be included in CCSS.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#ccss-selector-allowlist', esc_html__( 'Learn more', 'litespeed-cache' ) ); ?>.\n\t\t\t\t<br /><?php printf( esc_html__( 'Wildcard %s supported.', 'litespeed-cache' ), '<code>*</code>' ); ?>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'Selectors must exist in the CSS. Parent classes in the HTML will not work.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'Predefined list will also be combined w/ the above settings', 'litespeed-cache' ); ?>: <a href=\"https://github.com/litespeedtech/lscache_wp/blob/dev/data/ccss_whitelist.txt\" target=\"_blank\">https://github.com/litespeedtech/lscache_wp/blob/dev/data/ccss_whitelist.txt</a>\n\t\t\t\t</font>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_CON; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php printf( esc_html__( 'Specify critical CSS rules for above-the-fold content when enabling %s.', 'litespeed-cache' ), esc_html__( 'Load CSS Asynchronously', 'litespeed-cache' ) ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n</tbody></table>",
    "plugins/litespeed-cache/tpl/esi_widget_edit.php": "<?php\n/**\n * LiteSpeed Cache Widget Settings\n *\n * Configures ESI settings for widgets in LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$options = ! empty( $instance[ Base::OPTION_NAME ] ) ? $instance[ Base::OPTION_NAME ] : array();\n\nif ( empty( $options ) ) {\n\t$options = array(\n\t\tESI::WIDGET_O_ESIENABLE => Base::VAL_OFF,\n\t\tESI::WIDGET_O_TTL       => '28800',\n\t);\n\n\tadd_filter( 'litespeed_widget_default_options', 'LiteSpeed\\ESI::widget_default_options', 10, 2 );\n\n\t$options = apply_filters( 'litespeed_widget_default_options', $options, $widget );\n}\n\nif ( empty( $options ) ) {\n\t$esi = Base::VAL_OFF;\n\t$ttl = '28800';\n} else {\n\t$esi = $options[ ESI::WIDGET_O_ESIENABLE ];\n\t$ttl = $options[ ESI::WIDGET_O_TTL ];\n}\n\n$display = Admin_Display::cls();\n\n?>\n<div class=\"litespeed-widget-setting\">\n\n\t<h4><?php esc_html_e( 'LiteSpeed Cache', 'litespeed-cache' ); ?>:</h4>\n\n\t<b><?php esc_html_e( 'Enable ESI', 'litespeed-cache' ); ?>:</b>\n\t&nbsp;\n\t<div class=\"litespeed-inline\">\n\t\t<div class=\"litespeed-switch litespeed-mini\">\n\t\t<?php\n\t\t\t$esi_option = ESI::WIDGET_O_ESIENABLE;\n\t\t\t$name       = $widget->get_field_name( $esi_option );\n\n\t\t\t$cache_status_list = array(\n\t\t\t\tarray( Base::VAL_ON, esc_html__( 'Public', 'litespeed-cache' ) ),\n\t\t\t\tarray( Base::VAL_ON2, esc_html__( 'Private', 'litespeed-cache' ) ),\n\t\t\t\tarray( Base::VAL_OFF, esc_html__( 'Disable', 'litespeed-cache' ) ),\n\t\t\t);\n\n\t\t\tforeach ( $cache_status_list as $v ) {\n\t\t\t\tlist( $value, $label ) = $v;\n\t\t\t\t$id_attr               = $widget->get_field_id( $esi_option ) . '_' . $value;\n\t\t\t\t$checked               = $esi === $value ? 'checked' : '';\n\t\t\t\t?>\n\t\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr($name); ?>\" id=\"<?php echo esc_attr($id_attr); ?>\" value=\"<?php echo esc_attr( $value ); ?>\" <?php echo esc_attr($checked); ?> />\n\t\t\t\t<label for=\"<?php echo esc_attr($id_attr); ?>\"><?php echo esc_html( $label ); ?></label>\n\t\t\t\t<?php\n\t\t\t}\n\t\t?>\n\t\t</div>\n\t</div>\n\t<br /><br />\n\n\t<b><?php esc_html_e( 'Widget Cache TTL', 'litespeed-cache' ); ?>:</b>\n\t&nbsp;\n\t<?php\n\t\t$ttl_option = ESI::WIDGET_O_TTL;\n\t\t$name       = $widget->get_field_name( $ttl_option );\n\t\t?>\n\t\t<input type=\"text\" class=\"regular-text litespeed-reset\" name=\"<?php echo esc_attr($name); ?>\" value=\"<?php echo esc_attr($ttl); ?>\" size=\"7\" />\n\t<?php esc_html_e( 'seconds', 'litespeed-cache' ); ?>\n\n\t<p class=\"install-help\">\n\t\t<?php esc_html_e( 'Recommended value: 28800 seconds (8 hours).', 'litespeed-cache' ); ?>\n\t\t<?php esc_html_e( 'A TTL of 0 indicates do not cache.', 'litespeed-cache' ); ?>\n\t</p>\n</div>\n\n<br />",
    "plugins/litespeed-cache/tpl/img_optm/summary.tpl.php": "<?php\n/**\n * LiteSpeed Cache Image Optimization Summary\n *\n * Manages the image optimization summary interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$closest_server = Cloud::get_summary( 'server.' . Cloud::SVC_IMG_OPTM );\n$usage_cloud    = Cloud::get_summary( 'usage.' . Cloud::SVC_IMG_OPTM );\n$allowance      = Cloud::cls()->allowance( Cloud::SVC_IMG_OPTM );\n\n$img_optm = Img_Optm::cls();\n\n$wet_limit = $img_optm->wet_limit();\n$img_count = $img_optm->img_count();\n\n$optm_summary = Img_Optm::get_summary();\n\nlist($last_run, $is_running) = $img_optm->cron_running( false );\n$finished_percentage         = 0;\nif ( $img_count['groups_all'] ) {\n\t$finished_percentage = 100 - floor( $img_count['groups_new'] * 100 / $img_count['groups_all'] );\n}\nif ( 100 === $finished_percentage && $img_count['groups_new'] ) {\n\t$finished_percentage = 99;\n}\n\n$unfinished_num = 0;\nif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ] ) ) {\n\t$unfinished_num += $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ];\n}\nif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ] ) ) {\n\t$unfinished_num += $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ];\n}\nif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_ERR_FETCH ] ) ) {\n\t$unfinished_num += $img_count[ 'img.' . Img_Optm::STATUS_ERR_FETCH ];\n}\n\n$imgoptm_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_IMG_OPTM . '-' . Img_Optm::CLOUD_ACTION_NEW_REQ );\n?>\n<div class=\"litespeed-flex-container litespeed-column-with-boxes\">\n\t<div class=\"litespeed-width-7-10 litespeed-column-left litespeed-image-optim-summary-wrapper\">\n\t\t<div class=\"litespeed-image-optim-summary\">\n\n\t\t\t<h3>\n\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_IMG_OPTM ) ) ); ?>\" class=\"litespeed-info-button litespeed-redetect\" data-balloon-pos=\"right\" data-balloon-break aria-label=\"<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><span class=\"litespeed-quic-icon\"></span> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></a>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<span class=\"litespeed-quic-icon\"></span> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php esc_html_e( 'Optimize images with our QUIC.cloud server', 'litespeed-cache' ); ?>\n\t\t\t\t<a href=\"https://docs.litespeedtech.com/lscache/lscwp/imageopt/#image-optimization-summary-tab\" target=\"_blank\" class=\"litespeed-right litespeed-learn-more\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a>\n\t\t\t</h3>\n\n\t\t\t<p>\n\t\t\t\t<?php printf( esc_html__( 'You can request a maximum of %s images at once.', 'litespeed-cache' ), '<strong>' . intval( $allowance ) . '</strong>' ); ?>\n\t\t\t</p>\n\n\t\t\t<?php if ( $wet_limit ) : ?>\n\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'To make sure our server can communicate with your server without any issues and everything works fine, for the few first requests the number of image groups allowed in a single request is limited.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php echo esc_html__( 'Current limit is', 'litespeed-cache' ) . ': <strong>' . esc_html( $wet_limit ) . '</strong>'; ?>\n\t\t\t\t</p>\n\t\t\t<?php endif; ?>\n\n\t\t\t<div class=\"litespeed-img-optim-actions\">\n\t\t\t\t<?php if ( $imgoptm_service_hot ) : ?>\n\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t<span class=\"dashicons dashicons-images-alt2\"></span> <?php esc_html_e( 'Send Optimization Request', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $imgoptm_service_hot ) ); ?>\n\t\t\t\t\t</button>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<a data-litespeed-onlyonce class=\"button button-primary\"\n\t\t\t\t\t<?php\n\t\t\t\t\tif ( ! empty( $img_count['groups_new'] ) || ! empty( $img_count[ 'group.' . Img_Optm::STATUS_RAW ] ) ) :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_NEW_REQ ) ); ?>\"\n\t\t\t\t\t\t<?php\n\t\t\t\t\telse :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"javascript:;\" disabled <?php endif; ?>>\n\t\t\t\t\t\t<span class=\"dashicons dashicons-images-alt2\"></span> <?php esc_html_e( 'Send Optimization Request', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t<?php endif; ?>\n\n\t\t\t\t<a data-litespeed-onlyonce class=\"button button-secondary\" data-balloon-length=\"large\" data-balloon-pos=\"right\" aria-label=\"<?php esc_html_e( 'Only press the button if the pull cron job is disabled.', 'litespeed-cache' ); ?> <?php esc_html_e( 'Images will be pulled automatically if the cron job is running.', 'litespeed-cache' ); ?>\"\n\t\t\t\t\t<?php\n\t\t\t\t\tif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ] ) && ! $is_running ) :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_PULL ) ); ?>\"\n\t\t\t\t\t\t<?php\n\t\t\t\t\telse :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"javascript:;\" disabled <?php endif; ?>>\n\t\t\t\t\t<?php esc_html_e( 'Pull Images', 'litespeed-cache' ); ?>\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<h3 class=\"litespeed-title-section\">\n\t\t\t\t\t<?php esc_html_e( 'Optimization Status', 'litespeed-cache' ); ?>\n\t\t\t\t</h3>\n\n\t\t\t\t<div class=\"litespeed-light-code\">\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_NEW ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_NEW ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count['group_new'] ) ); ?>\n\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_RAW ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_RAW ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_RAW ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_RAW ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_REQUESTED ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'After the QUIC.cloud Image Optimization server finishes optimization, it will notify your site to pull the optimized images.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'This process is automatic.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_NOTIFIED ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php if ( $last_run ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Last pull initiated by cron at %s.', 'litespeed-cache' ), '<code>' . esc_html( Utility::readable_time( $last_run ) ) . '</code>' ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_PULLED ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_PULLED ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_PULLED ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_PULLED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<p>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t'<a href=\"%1$s\" class=\"button button-secondary litespeed-btn-warning\" data-balloon-pos=\"right\" aria-label=\"%2$s\" %3$s><span class=\"dashicons dashicons-editor-removeformatting\"></span> %4$s</a>',\n\t\t\t\t\t\t( $unfinished_num ? esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_CLEAN ) ) : 'javascript:;' ),\n\t\t\t\t\t\tesc_html__( 'Remove all previous unfinished image optimization requests.', 'litespeed-cache' ),\n\t\t\t\t\t\t( $unfinished_num ? '' : ' disabled' ),\n\t\t\t\t\t\tesc_html__( 'Clean Up Unfinished Data', 'litespeed-cache' ) . ( $unfinished_num ? ': ' . esc_html( Admin_Display::print_plural( $unfinished_num, 'image' ) ) : '' )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<h3 class=\"litespeed-title-section\">\n\t\t\t\t\t\t<?php esc_html_e( 'Storage Optimization', 'litespeed-cache' ); ?>\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'A backup of each image is saved before it is optimized.', 'litespeed-cache' ); ?>\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<?php if ( ! empty( $optm_summary['bk_summary'] ) ) : ?>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last calculated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $optm_summary['bk_summary']['date'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php if ( $optm_summary['bk_summary']['count'] ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Files', 'litespeed-cache' ) . ': <code>' . intval( $optm_summary['bk_summary']['count'] ) . '</code>'; ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Total', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::real_size( $optm_summary['bk_summary']['sum'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a class=\"button button-secondary\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'Calculate Original Image Storage', 'litespeed-cache' ); ?>\"\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tif ( $finished_percentage > 0 ) :\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_CALC_BKUP ) ); ?>\"\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\telse :\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\thref=\"javascript:;\" disabled <?php endif; ?>>\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span> <?php esc_html_e( 'Calculate Backups Disk Space', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<h4><?php esc_html_e( 'Image Thumbnail Group Sizes', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tforeach ( Media::cls()->get_image_sizes() as $size_title => $size ) {\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<div>%1$s ( %2$s x %3$s )</div>',\n\t\t\t\t\t\t\t\tesc_html( $size_title ),\n\t\t\t\t\t\t\t\t$size['width'] ? esc_html( $size['width'] ) . 'px' : '*',\n\t\t\t\t\t\t\t\t$size['height'] ? esc_html( $size['height'] ) . 'px' : '*'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"litespeed-hr-with-space\">\n\t\t\t\t<div>\n\t\t\t\t\t<h4><?php esc_html_e( 'Delete all backups of the original images', 'litespeed-cache' ); ?></h4>\n\t\t\t\t\t<div class=\"notice notice-error litespeed-callout-bg inline\">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t🚨 <?php esc_html_e( 'This is irreversible.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'You will be unable to Revert Optimization once the backups are deleted!', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<?php if ( ! empty( $optm_summary['rmbk_summary'] ) ) : ?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Last ran', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $optm_summary['rmbk_summary']['date'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Files', 'litespeed-cache' ) . ': <code>' . esc_html( $optm_summary['rmbk_summary']['count'] ) . '</code>'; ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Saved', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::real_size( $optm_summary['rmbk_summary']['sum'] ) ) . '</code>'; ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<div class=\"litespeed-image-optim-summary-footer\">\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RM_BKUP ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to remove all image backups?', 'litespeed-cache' ); ?>\" class=\"litespeed-link-with-icon litespeed-danger\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-trash\"></span><?php esc_html_e( 'Remove Original Image Backups', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"litespeed-width-3-10 litespeed-column-right\">\n\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-imgopt-info\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t<?php esc_html_e( 'Image Information', 'litespeed-cache' ); ?>\n\t\t\t\t</h3>\n\n\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle\">\n\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $finished_percentage, 70, true ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Image groups total', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php if ( $img_count['groups_new'] ) : ?>\n\t\t\t\t\t\t\t\t<code><?php echo esc_html( Admin_Display::print_plural( $img_count['groups_new'], 'group' ) ); ?></code>\n\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t<font class=\"litespeed-congratulate\"><?php esc_html_e( 'Congratulations, all gathered!', 'litespeed-cache' ); ?></font>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<a href=\"https://docs.litespeedtech.com/lscache/lscwp/imageopt/#what-is-an-image-group\" target=\"_blank\" class=\"litespeed-desc litespeed-help-btn-icon\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'What is a group?', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-editor-help\"></span>\n\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'What is an image group?', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Current image post id position', 'litespeed-cache' ); ?>: <?php echo ! empty( $optm_summary['next_post_id'] ) ? esc_html( $optm_summary['next_post_id'] ) : '-'; ?><br>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Maximum image post id', 'litespeed-cache' ); ?>: <?php echo esc_html( $img_count['max_id'] ); ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\" style=\"display: none;\">\n\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RESCAN ) ); ?>\" class=\"\" data-balloon-pos=\"up\" data-balloon-length=\"large\" aria-label=\"<?php esc_html_e( 'Scan for any new unoptimized image thumbnail sizes and resend necessary image optimization requests.', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t<?php esc_html_e( 'Rescan New Thumbnails', 'litespeed-cache' ); ?>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t<?php esc_html_e( 'Optimization Summary', 'litespeed-cache' ); ?>\n\t\t\t\t</h3>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Total Reduction', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['reduced'] ) ? esc_html( Utility::real_size( $optm_summary['reduced'] ) ) : '-'; ?></code>\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Images Pulled', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['img_taken'] ) ? esc_html( $optm_summary['img_taken'] ) : '-'; ?></code>\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Last Request', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['last_requested'] ) ? esc_html( Utility::readable_time( $optm_summary['last_requested'] ) ) : '-'; ?></code>\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Last Pulled', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['last_pulled'] ) ? esc_html( Utility::readable_time( $optm_summary['last_pulled'] ) ) : '-'; ?></code>\n\t\t\t\t\t<?php\n\t\t\t\t\tif ( isset( $optm_summary['last_pulled_by_cron'] ) && $optm_summary['last_pulled_by_cron'] ) {\n\t\t\t\t\t\techo '(Cron)';\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact litespeed-desc\">\n\t\t\t\t<?php\n\t\t\t\tprintf(\n\t\t\t\t\t/* translators: %s: Link tags */\n\t\t\t\t\tesc_html__( 'Results can be checked in %sMedia Library%s.', 'litespeed-cache' ),\n\t\t\t\t\t'<a href=\"upload.php?mode=list\">',\n\t\t\t\t\t'</a>'\n\t\t\t\t);\n\t\t\t\t?>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\"><?php esc_html_e( 'Optimization Tools', 'litespeed-cache' ); ?></h3>\n\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'You can quickly switch between using original (unoptimized versions) and optimized image files. It will affect all images on your website, both regular and webp versions if available.', 'litespeed-cache' ); ?>\n\t\t\t\t</p>\n\n\t\t\t\t<div class=\"litespeed-links-group\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_BATCH_SWITCH_ORI ) ); ?>\" class=\"litespeed-link-with-icon\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'Use original images (unoptimized) on your site', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-undo\"></span><?php esc_html_e( 'Use Original Files', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span><span>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_BATCH_SWITCH_OPTM ) ); ?>\" class=\"litespeed-link-with-icon litespeed-icon-right\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'Switch back to using optimized images on your site', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Use Optimized Files', 'litespeed-cache' ); ?><span class=\"dashicons dashicons-redo\"></span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t<p>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RESET_COUNTER ) ); ?>\" class=\"litespeed-link-with-icon litespeed-warning\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-dismiss\"></span><?php esc_html_e( 'Soft Reset Optimization Counter', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'This will reset the %1$s. If you changed WebP/AVIF settings and want to generate %2$s for the previously optimized images, use this action.', 'litespeed-cache' ), '<code>' . esc_html__( 'Current image post id position', 'litespeed-cache' ) . '</code>', 'WebP/AVIF' ); ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t<p>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_DESTROY ) ); ?>\" class=\"litespeed-link-with-icon litespeed-danger\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure to destroy all optimized images?', 'litespeed-cache' ); ?>\" id=\"litespeed-imageopt-destroy\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-dismiss\"></span><?php esc_html_e( 'Destroy All Optimization Data', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Remove all previous image optimization requests/results, revert completed optimizations, and delete all optimization files.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/img_optm/settings.media_webp.tpl.php": "<?php\n/**\n * LiteSpeed Cache Image Optimization WebP/AVIF Setting\n *\n * Manages the WebP and AVIF optimization settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th>\n\t\t<?php $option_id = Base::O_IMG_OPTM_WEBP; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t</th>\n\t<td>\n\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), 'WebP', 'AVIF' ) ); ?>\n\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php esc_html_e( 'Request WebP/AVIF versions of original images when doing optimization.', 'litespeed-cache' ); ?>\n\t\t\t<?php printf( esc_html__( 'Significantly improve load time by replacing images with their optimized %s versions.', 'litespeed-cache' ), '.webp/.avif' ); ?>\n\t\t\t<br /><?php Doc::notice_htaccess(); ?>\n\t\t\t<br /><?php Doc::crawler_affected(); ?>\n\t\t\t<br />\n\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t⚠️ <?php printf( esc_html__( '%1$s is a %2$s paid feature.', 'litespeed-cache' ), 'AVIF', 'QUIC.cloud' ); ?></font>\n\t\t\t<br />\n\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t⚠️ <?php printf( esc_html__( 'When switching formats, please %1$s or %2$s to apply this new choice to previously optimized images.', 'litespeed-cache' ), esc_html__( 'Destroy All Optimization Data', 'litespeed-cache' ), esc_html__( 'Soft Reset Optimization Counter', 'litespeed-cache' ) ); ?></font>\n\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/imageopt/#soft-reset-optimization-counter' ); ?>\n\t\t</div>\n\t</td>\n</tr>",
    "plugins/litespeed-cache/tpl/img_optm/settings.tpl.php": "<?php\n/**\n * LiteSpeed Cache Image Optimization Settings\n *\n * Manages image optimization settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Image Optimization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/imageopt/#image-optimization-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_AUTO; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically request optimization via cron job.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_ORI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Optimize images and save backups of the originals in the same folder.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_RM_BKUP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically remove the original image backups after fetching optimized images.', 'litespeed-cache' ); ?>\n\n\t\t\t\t\t<br />\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t🚨\n\t\t\t\t\t\t<?php esc_html_e( 'This is irreversible.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php esc_html_e( 'You will be unable to Revert Optimization once the backups are deleted!', 'litespeed-cache' ); ?>\n\t\t\t\t\t</font>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_LOSSLESS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Optimize images using lossless compression.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve quality but may result in larger images than lossy compression will.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_EXIF; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Preserve EXIF data (copyright, GPS, comments, keywords, etc) when optimizing.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will increase the size of optimized files.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<?php\n\t\tif ( ! is_multisite() ) :\n\t\t\t// webp\n\t\t\trequire LSCWP_DIR . 'tpl/img_optm/settings.media_webp.tpl.php';\n\t\tendif;\n\t\t?>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_WEBP_ATTR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify which element attributes will be replaced with WebP/AVIF.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Only attributes listed here will be replaced.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br /><?php printf( esc_html__( 'Use the format %1$s or %2$s (element is optional).', 'litespeed-cache' ), '<code>element.attribute</code>', '<code>.attribute</code>' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_WEBP_REPLACE_SRCSET; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Enable replacement of WebP/AVIF in %s elements that were generated outside of WordPress logic.', 'litespeed-cache' ), '<code>srcset</code>' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/imageopt/#webp-for-extra-srcset' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t</tbody>\n</table>\n\n<?php\n$this->form_end();\n",
    "plugins/litespeed-cache/tpl/img_optm/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Image Optimization\n *\n * Manages the image optimization interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n    'summary'  => esc_html__( 'Image Optimization Summary', 'litespeed-cache' ),\n    'settings' => esc_html__( 'Image Optimization Settings', 'litespeed-cache' ),\n);\n\nif ( is_network_admin() ) {\n    $menu_list = array(\n        'network_settings' => esc_html__( 'Image Optimization Settings', 'litespeed-cache' ),\n    );\n}\n\n?>\n\n<div class=\"wrap\">\n    <h1 class=\"litespeed-h1\">\n        <?php esc_html_e( 'LiteSpeed Cache Image Optimization', 'litespeed-cache' ); ?>\n    </h1>\n    <span class=\"litespeed-desc\">\n        v<?php echo esc_html( Core::VER ); ?>\n    </span>\n    <hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n    <h2 class=\"litespeed-header nav-tab-wrapper\">\n        <?php GUI::display_tab_list( $menu_list ); ?>\n    </h2>\n\n    <div class=\"litespeed-body\">\n        <?php\n        foreach ( $menu_list as $menu_key => $val ) {\n            echo '<div data-litespeed-layout=\"' . esc_attr( $menu_key ) . '\">';\n            require LSCWP_DIR . 'tpl/img_optm/' . $menu_key . '.tpl.php';\n            echo '</div>';\n        }\n        ?>\n    </div>\n\n</div>",
    "plugins/litespeed-cache/tpl/img_optm/network_settings.tpl.php": "<?php\n/**\n * LiteSpeed Cache Image Optimization Network Settings\n *\n * Manages network-wide image optimization settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action( Router::ACTION_SAVE_SETTINGS_NETWORK );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Image Optimization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/imageopt/#image-optimization-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<?php require LSCWP_DIR . 'tpl/img_optm/settings.media_webp.tpl.php'; ?>\n\n</tbody></table>\n\n<?php\n$this->form_end();",
    "plugins/litespeed-cache/tpl/dash/network_dash.tpl.php": "<?php\n/**\n * LiteSpeed Cache Network Dashboard\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$cloud_summaries = array();\n$blogs           = Activation::get_network_ids();\nforeach ( $blogs as $network_blog_id ) {\n\tswitch_to_blog( $network_blog_id );\n\t$cloud_summaries[ home_url() ] = Cloud::get_summary();\n\t// May need restore_current_blog();\n}\n\n?>\n\n<div class=\"litespeed-dashboard\">\n<?php foreach ( $cloud_summaries as $home_url => $cloud_summary ) : ?>\n\n\t<div class=\"litespeed-dashboard-header\">\n\t\t<h3 class=\"litespeed-dashboard-title\">\n\t\t\t<?php echo esc_html( sprintf( __( 'Usage Statistics: %s', 'litespeed-cache' ), $home_url ) ); ?>\n\t\t</h3>\n\t\t<hr>\n\t</div>\n\n\t<div class=\"litespeed-dashboard-stats-wrapper\">\n\t\t<?php\n\t\t$cat_list = array(\n\t\t\t'img_optm'  => esc_html__( 'Image Optimization', 'litespeed-cache' ),\n\t\t\t'page_optm' => esc_html__( 'Page Optimization', 'litespeed-cache' ),\n\t\t\t'cdn'       => esc_html__( 'CDN Bandwidth', 'litespeed-cache' ),\n\t\t\t'lqip'      => esc_html__( 'Low Quality Image Placeholder', 'litespeed-cache' ),\n\t\t);\n\n\t\tforeach ( $cat_list as $svc => $svc_title ) :\n\t\t\t$finished_percentage = 0;\n\t\t\t$total_used          = '-';\n\t\t\t$used                = '-';\n\t\t\t$quota               = '-';\n\t\t\t$pag_used            = '-';\n\t\t\t$pag_total           = '-';\n\t\t\t$pag_width           = 0;\n\t\t\t$pag_bal             = 0;\n\n\t\t\tif ( ! empty( $cloud_summary[ 'usage.' . $svc ] ) ) {\n\t\t\t\t$usage               = $cloud_summary[ 'usage.' . $svc ];\n\t\t\t\t$finished_percentage = floor( $usage['used'] * 100 / $usage['quota'] );\n\t\t\t\t$used                = $usage['used'];\n\t\t\t\t$quota               = $usage['quota'];\n\t\t\t\t$pag_used            = ! empty( $usage['pag_used'] ) ? $usage['pag_used'] : 0;\n\t\t\t\t$pag_bal             = ! empty( $usage['pag_bal'] ) ? $usage['pag_bal'] : 0;\n\t\t\t\t$pag_total           = $pag_used + $pag_bal;\n\n\t\t\t\tif ( $pag_total ) {\n\t\t\t\t\t$pag_width = round( $pag_used / $pag_total * 100 ) . '%';\n\t\t\t\t}\n\n\t\t\t\tif ( 'cdn' === $svc ) {\n\t\t\t\t\t$used      = Utility::real_size( $used * 1024 * 1024 );\n\t\t\t\t\t$quota     = Utility::real_size( $quota * 1024 * 1024 );\n\t\t\t\t\t$pag_used  = Utility::real_size( $pag_used * 1024 * 1024 );\n\t\t\t\t\t$pag_total = Utility::real_size( $pag_total * 1024 * 1024 );\n\t\t\t\t}\n\n\t\t\t\tif ( ! empty( $usage['total_used'] ) ) {\n\t\t\t\t\t$total_used = $usage['total_used'];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$percentage_bg = 'success';\n\t\t\tif ( 95 < $finished_percentage ) {\n\t\t\t\t$percentage_bg = 'danger';\n\t\t\t} elseif ( 85 < $finished_percentage ) {\n\t\t\t\t$percentage_bg = 'warning';\n\t\t\t}\n\t\t\t?>\n\n\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t<h3 class=\"litespeed-title\"><?php echo esc_html( $svc_title ); ?></h3>\n\n\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle litespeed-pie-<?php echo esc_attr( $percentage_bg ); ?>\">\n\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $finished_percentage, 60, false ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"litespeed-dashboard-stats\">\n\t\t\t\t\t\t\t\t<h3><?php echo esc_html( 'img_optm' === $svc ? __( 'Fast Queue Usage', 'litespeed-cache' ) : __( 'Usage', 'litespeed-cache' ) ); ?></h3>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<strong><?php echo esc_html( $used ); ?></strong>\n\t\t\t\t\t\t\t\t\t<?php if ( $quota !== $used ) : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-desc\"> / <?php echo esc_html( $quota ); ?></span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<?php if ( 0 < $pag_total ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-payg\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr__( 'Pay as You Go', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'PAYG Balance', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $pag_bal ); ?></strong>\n\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr( sprintf( __( 'This Month Usage: %s', 'litespeed-cache' ), esc_html( $pag_used ) ) ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"></span>\n\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Pay as You Go Usage Statistics', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( 'img_optm' === $svc ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Total Usage', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $total_used ); ?> / ∞</strong>\n\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr__( 'Total images optimized in this month', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t<?php endforeach; ?>\n\t</div>\n\n<?php endforeach; ?>\n</div>",
    "plugins/litespeed-cache/tpl/dash/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Dashboard Wrapper\n *\n * Renders the main dashboard page for the LiteSpeed Cache plugin in the WordPress admin area.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'dashboard' => esc_html__( 'Dashboard', 'litespeed-cache' ),\n);\n\nif ( $this->_is_network_admin ) {\n\t$menu_list = array(\n\t\t'network_dash' => esc_html__( 'Network Dashboard', 'litespeed-cache' ),\n\t);\n}\n\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php echo esc_html__( 'LiteSpeed Cache Dashboard', 'litespeed-cache' ); ?>\n\t</h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t</span>\n\t<hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n\t<?php\n\tforeach ( $menu_list as $tab_key => $tab_val ) {\n\t\techo '<div data-litespeed-layout=\"' . esc_attr( $tab_key ) . '\">';\n\t\trequire LSCWP_DIR . 'tpl/dash/' . $tab_key . '.tpl.php';\n\t\techo '</div>';\n\t}\n\t?>\n</div>",
    "plugins/litespeed-cache/tpl/dash/dashboard.tpl.php": "<?php\n/**\n * LiteSpeed Cache Dashboard\n *\n * Displays the dashboard for LiteSpeed Cache plugin, including cache status,\n * crawler status, QUIC.cloud service usage, and optimization statistics.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$health_scores   = Health::cls()->scores();\n$crawler_summary = Crawler::get_summary();\n\n// Image related info\n$img_optm_summary        = Img_Optm::get_summary();\n$img_count               = Img_Optm::cls()->img_count();\n$img_finished_percentage = 0;\nif ( ! empty( $img_count['groups_all'] ) ) {\n\t$img_finished_percentage = 100 - floor( $img_count['groups_new'] * 100 / $img_count['groups_all'] );\n}\nif ( 100 === $img_finished_percentage && ! empty( $img_count['groups_new'] ) ) {\n\t$img_finished_percentage = 99;\n}\n\n$cloud_instance = Cloud::cls();\n$cloud_instance->finish_qc_activation();\n\n$cloud_summary           = Cloud::get_summary();\n$css_summary             = CSS::get_summary();\n$ucss_summary            = UCSS::get_summary();\n$placeholder_summary     = Placeholder::get_summary();\n$vpi_summary             = VPI::get_summary();\n$ccss_count              = count( $this->load_queue( 'ccss' ) );\n$ucss_count              = count( $this->load_queue( 'ucss' ) );\n$placeholder_queue_count = count( $this->load_queue( 'lqip' ) );\n$vpi_queue_count         = count( $this->load_queue( 'vpi' ) );\n$can_page_load_time      = defined( 'LITESPEED_SERVER_TYPE' ) && 'NONE' !== LITESPEED_SERVER_TYPE;\n\n?>\n\n<div class=\"litespeed-dashboard\">\n\t<?php if ( ! $cloud_instance->activated() && ! Admin_Display::has_qc_hide_banner() ) : ?>\n\t\t<div class=\"litespeed-dashboard-group\">\n\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-cache\">\n\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Cache Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-cache' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$cache_list = array(\n\t\t\t\t\t\t\tBase::O_CACHE         => esc_html__( 'Public Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\tBase::O_CACHE_PRIV    => esc_html__( 'Private Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\tBase::O_OBJECT        => esc_html__( 'Object Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\tBase::O_CACHE_BROWSER => esc_html__( 'Browser Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tforeach ( $cache_list as $cache_option => $cache_title ) :\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php if ( $this->conf( $cache_option ) ) : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php echo esc_html( $cache_title ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-crawler\">\n\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Crawler Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<code><?php echo esc_html( count( Crawler::cls()->list_crawlers() ) ); ?></code> <?php esc_html_e( 'Crawler(s)', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Currently active crawler', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $crawler_summary['curr_crawler'] ); ?></code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['curr_crawler_beginning_time'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Current crawler started at', 'litespeed-cache' ); ?>:</span>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['curr_crawler_beginning_time'] ) ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_start_time'] ) ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Last interval', 'litespeed-cache' ); ?>:</span>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['last_start_time'] ) ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['end_reason'] ) ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Ended reason', 'litespeed-cache' ); ?>:</span>\n\t\t\t\t\t\t\t\t<?php echo esc_html( $crawler_summary['end_reason'] ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_crawled'] ) ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( '%1$s %2$d item(s)', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<span class=\"litespeed-bold\">' . esc_html__( 'Last crawled:', 'litespeed-cache' ) . '</span>',\n\t\t\t\t\t\t\t\t\tesc_html( $crawler_summary['last_crawled'] )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<?php\n\t\t\t\t$news = $cloud_instance->load_qc_status_for_dash( 'news_dash_guest' );\n\t\t\t\tif ( ! empty( $news ) ) :\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t\t\t<div class=\"inside litespeed-text-center\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'News', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t\t\t\t\t<?php echo wp_kses_post( $news ); ?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t<?php endif; ?>\n\t\t\t</div>\n\t\t</div>\n\t<?php endif; ?>\n\n\t<div class=\"litespeed-dashboard-qc\">\n\t\t<?php if ( ! $cloud_instance->activated() && ! Admin_Display::has_qc_hide_banner() ) : ?>\n\t\t\t<div class=\"litespeed-dashboard-unlock\">\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"litespeed-dashboard-unlock-title\">\n\t\t\t\t\t\t<strong class=\"litespeed-qc-text-gradient\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Accelerate, Optimize, Protect', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</h3>\n\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-desc\">\n\t\t\t\t\t\t<?php echo wp_kses_post( __( 'Speed up your WordPress site even further with <strong>QUIC.cloud Online Services and CDN</strong>.', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'Free monthly quota available. Can also be used anonymously (no email required).', 'litespeed-cache' ); ?>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE ) ); ?>\">\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-yes\"></span>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<a class=\"button button-link litespeed-top10\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_ADMIN_DISPLAY, Admin_Display::TYPE_QC_HIDE_BANNER ) ); ?>\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Do not show this again', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-footer\">\n\t\t\t\t\t\t<?php esc_html_e( 'QUIC.cloud provides CDN and online optimization services, and is not required. You may use many features of this plugin without QUIC.cloud.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t\t<a href=\"https://www.quic.cloud/\" target=\"_blank\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Learn More about QUIC.cloud', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t<?php endif; ?>\n\n\t\t<div class=\"litespeed-dashboard-qc-enable\">\n\t\t\t<div class=\"litespeed-dashboard-header\">\n\t\t\t\t<h3 class=\"litespeed-dashboard-title litespeed-dashboard-title--w-btn\">\n\t\t\t\t\t<span class=\"litespeed-right10\"><?php esc_html_e( 'QUIC.cloud Service Usage Statistics', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_SYNC_USAGE ) ); ?>\" class=\"button button-secondary button-small\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span> <?php esc_html_e( 'Refresh Usage', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Sync data from Cloud', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t</a>\n\t\t\t\t</h3>\n\t\t\t\t<hr>\n\t\t\t\t<a href=\"https://docs.litespeedtech.com/lscache/lscwp/dashboard/#usage-statistics\" target=\"_blank\" class=\"litespeed-learn-more\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a>\n\t\t\t</div>\n\n\t\t\t<?php if ( ! $cloud_instance->activated() && Admin_Display::has_qc_hide_banner() ) : ?>\n\t\t\t\t<p class=\"litespeed-desc litespeed-margin-top-remove\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'The features below are provided by %s', 'litespeed-cache' ),\n\t\t\t\t\t\t'<a href=\"https://quic.cloud\" target=\"_blank\">QUIC.cloud</a>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</p>\n\t\t\t<?php endif; ?>\n\n\t\t\t<div class=\"litespeed-dashboard-stats-wrapper\">\n\t\t\t\t<?php\n\t\t\t\t$cat_list = array(\n\t\t\t\t\t'img_optm'  => esc_html__( 'Image Optimization', 'litespeed-cache' ),\n\t\t\t\t\t'page_optm' => esc_html__( 'Page Optimization', 'litespeed-cache' ),\n\t\t\t\t\t'cdn'       => esc_html__( 'CDN Bandwidth', 'litespeed-cache' ),\n\t\t\t\t\t'lqip'      => esc_html__( 'Low Quality Image Placeholder', 'litespeed-cache' ),\n\t\t\t\t);\n\n\t\t\t\tforeach ( $cat_list as $svc => $svc_title ) :\n\t\t\t\t\t$finished_percentage = 0;\n\t\t\t\t\t$total_used          = '-';\n\t\t\t\t\t$used                = '-';\n\t\t\t\t\t$quota               = '-';\n\t\t\t\t\t$pag_used            = '-';\n\t\t\t\t\t$pag_total           = '-';\n\t\t\t\t\t$pag_width           = 0;\n\t\t\t\t\t$percentage_bg       = 'success';\n\t\t\t\t\t$pag_txt_color       = '';\n\t\t\t\t\t$usage               = false;\n\n\t\t\t\t\tif ( ! empty( $cloud_summary[ 'usage.' . $svc ] ) ) {\n\t\t\t\t\t\t$usage               = $cloud_summary[ 'usage.' . $svc ];\n\t\t\t\t\t\t$finished_percentage = floor( $usage['used'] * 100 / $usage['quota'] );\n\t\t\t\t\t\t$used                = (int) $usage['used'];\n\t\t\t\t\t\t$quota               = (int) $usage['quota'];\n\t\t\t\t\t\t$pag_used            = ! empty( $usage['pag_used'] ) ? (int) $usage['pag_used'] : 0;\n\t\t\t\t\t\t$pag_bal             = ! empty( $usage['pag_bal'] ) ? (int) $usage['pag_bal'] : 0;\n\t\t\t\t\t\t$pag_total           = $pag_used + $pag_bal;\n\t\t\t\t\t\tif ( ! empty( $usage['total_used'] ) ) {\n\t\t\t\t\t\t\t$total_used = (int) $usage['total_used'];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( $pag_total ) {\n\t\t\t\t\t\t\t$pag_width = round( $pag_used / $pag_total * 100 ) . '%';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( $finished_percentage > 85 ) {\n\t\t\t\t\t\t\t$percentage_bg = 'warning';\n\t\t\t\t\t\t\tif ( $finished_percentage > 95 ) {\n\t\t\t\t\t\t\t\t$percentage_bg = 'danger';\n\t\t\t\t\t\t\t\tif ( $pag_bal ) {\n\t\t\t\t\t\t\t\t\t$percentage_bg = 'warning';\n\t\t\t\t\t\t\t\t\t$pag_txt_color = 'litespeed-success';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\"><?php echo esc_html( $svc_title ); ?></h3>\n\t\t\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle litespeed-pie-<?php echo esc_attr( $percentage_bg ); ?>\">\n\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $finished_percentage, 60, false ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-dashboard-stats\">\n\t\t\t\t\t\t\t\t\t\t<h3><?php echo 'img_optm' === $svc ? esc_html__( 'Fast Queue Usage', 'litespeed-cache' ) : esc_html__( 'Usage', 'litespeed-cache' ); ?></h3>\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<strong><?php echo esc_html( $used ); ?></strong>\n\t\t\t\t\t\t\t\t\t\t\t<?php if ( $used !== $quota ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-desc\"> / <?php echo esc_html( $quota ); ?></span>\n\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<?php if ( $pag_total > 0 ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-payg <?php echo esc_attr( $pag_txt_color ); ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'PAYG Balance', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $pag_bal ); ?></strong>\n\t\t\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr( sprintf( esc_html__( 'PAYG used this month: %s. PAYG balance and usage not included in above quota calculation.', 'litespeed-cache' ), $pag_used ) ); ?>\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"></span>\n\t\t\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Pay as You Go Usage Statistics', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( 'page_optm' === $svc && ! empty( $usage['sub_svc'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\t\tforeach ( $usage['sub_svc'] as $sub_svc => $sub_usage ) :\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"<?php echo $i++ > 0 ? 'litespeed-left10' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( strtoupper( $sub_svc ) ); ?>: <strong><?php echo (int) $sub_usage; ?></strong>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( 'img_optm' === $svc ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Total Usage', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $total_used ); ?> / ∞</strong>\n\t\t\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php esc_attr_e( 'Total images optimized in this month', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"></span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( isset( $usage['remaining_daily_quota'] ) && $usage['remaining_daily_quota'] >= 0 && isset( $usage['daily_quota'] ) && $usage['daily_quota'] >= 0 ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Remaining Daily Quota', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $usage['remaining_daily_quota'] ); ?> / <?php echo esc_html( $usage['daily_quota'] ); ?></strong>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t<?php endforeach; ?>\n\t\t\t\t<?php if ( ! empty( $cloud_summary['partner'] ) ) : ?>\n\t\t\t\t\t<div class=\"litespeed-postbox litespeed-postbox-partner\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\"><?php esc_html_e( 'Partner Benefits Provided by', 'litespeed-cache' ); ?></h3>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['logo'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php elseif ( ! empty( $cloud_summary['partner']['name'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?></span>\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?></span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t<?php endif; ?>\n\t\t\t</div>\n\n\t\t\t<p class=\"litespeed-right litespeed-qc-dashboard-link\">\n\t\t\t\t<?php\n\t\t\t\tif ( ! empty( $cloud_summary['partner'] ) && ! empty( $cloud_summary['partner']['login_title'] ) && ! empty( $cloud_summary['partner']['login_link'] ) ) :\n\t\t\t\t\tDoc::learn_more( $cloud_summary['partner']['login_link'], $cloud_summary['partner']['login_title'], true, 'button litespeed-btn-warning' );\n\t\t\t\telseif ( ! empty( $cloud_summary['partner'] ) && ! empty( $cloud_summary['partner']['disable_qc_login'] ) ) :\n\t\t\t\t\t// Skip rendering any link or button.\n\t\t\t\t\techo '';\n\t\t\t\telse :\n\t\t\t\t\tif ( ! $cloud_instance->activated() ) :\n\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\tUtility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE ),\n\t\t\t\t\t\t\tesc_html__( 'Enable QUIC.cloud Services', 'litespeed-cache' ),\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t'button litespeed-btn-warning'\n\t\t\t\t\t\t);\n\t\t\t\t\telseif ( ! empty( $cloud_summary['qc_activated'] ) && 'anonymous' !== $cloud_summary['qc_activated'] ) :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_instance->qc_link() ); ?>\" class=\"litespeed-link-with-icon\" target=\"qc\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Go to QUIC.cloud dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"></span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\tUtility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_LINK ),\n\t\t\t\t\t\t\tesc_html__( 'Link to QUIC.cloud', 'litespeed-cache' ),\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t'button litespeed-btn-warning'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t</p>\n\n\t\t\t<div class=\"litespeed-dashboard-group\">\n\t\t\t\t<hr>\n\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-pagetime\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Page Load Time', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php if ( $can_page_load_time ) : ?>\n\t\t\t\t\t\t\t\t\t<?php $closest_server = Cloud::get_summary( 'server.' . Cloud::SVC_HEALTH ); ?>\n\t\t\t\t\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_HEALTH ) ) ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\tdata-balloon-pos=\"up\"\n\t\t\t\t\t\t\t\t\t\t\tdata-balloon-break\n\t\t\t\t\t\t\t\t\t\t\taria-label=\"<?php echo esc_attr( sprintf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ) ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\tdata-litespeed-cfm=\"<?php esc_attr_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"litespeed-title-right-icon\">\n\t\t\t\t\t\t\t\t\t\t\t<i class='litespeed-quic-icon'></i> <small><?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?></small>\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t\t\t\t<?php if ( $can_page_load_time && ! empty( $health_scores['speed_before'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-score-col\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Before', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-text-md litespeed-text-grey\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_before'] ); ?><span class=\"litespeed-text-large\">s</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-score-col\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'After', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-text-md litespeed-text-success\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_after'] ); ?><span class=\"litespeed-text-large\">s</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-score-col litespeed-score-col--imp\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-text-jumbo litespeed-text-success\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_improved'] ); ?><span class=\"litespeed-text-large\">%</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<p><?php esc_html_e( 'You must be using one of the following products in order to measure Page Load Time:', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https://www.litespeedtech.com/products/litespeed-web-server\" target=\"_blank\"><?php esc_html_e( 'LiteSpeed Web Server', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https://openlitespeed.org/\" target=\"_blank\"><?php esc_html_e( 'OpenLiteSpeed Web Server', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https://www.litespeedtech.com/products/litespeed-web-adc\" target=\"_blank\"><?php esc_html_e( 'LiteSpeed Web ADC', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https://quic.cloud\" target=\"_blank\"><?php esc_html_e( 'QUIC.cloud CDN', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( $can_page_load_time ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.health-speed'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-right10\">\n\t\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\t\tesc_html__( 'Requested: %s ago', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t\t'<span data-balloon-pos=\"up\" aria-label=\"' . esc_attr( Utility::readable_time( $cloud_summary['last_request.health-speed'] ) ) . '\">' . esc_html( human_time_diff( $cloud_summary['last_request.health-speed'] ) ) . '</span>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_HEALTH, Health::TYPE_SPEED ) ); ?>\" class=\"button button-secondary button-small\">\n\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span>\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Refresh', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Refresh page load time', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-pagespeed\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'PageSpeed Score', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php $guest_option = Base::O_GUEST; ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-general#settings' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php echo esc_html( Lang::title( $guest_option ) ); ?></a>\n\t\t\t\t\t\t\t\t<?php if ( $this->conf( $guest_option ) ) : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-margin-bottom20\">\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-row-flex\" style=\"margin-left: -10px;\">\n\t\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $health_scores['score_before'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Before', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $health_scores['score_before'], 45, false, true, 'litespeed-pie-' . esc_attr( GUI::cls()->get_cls_of_pagescore( $health_scores['score_before'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'After', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $health_scores['score_after'], 45, false, true, 'litespeed-pie-' . esc_attr( GUI::cls()->get_cls_of_pagescore( $health_scores['score_after'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-postbox-score-improve litespeed-text-fern\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['score_improved'] ); ?><span class=\"litespeed-text-large\">%</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.health-score'] ) ) : ?>\n\t\t\t\t\t\t\t\t<span class=\"litespeed-right10\">\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Requested: %s ago', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<span data-balloon-pos=\"up\" aria-label=\"' . esc_attr( Utility::readable_time( $cloud_summary['last_request.health-score'] ) ) . '\">' . esc_html( human_time_diff( $cloud_summary['last_request.health-score'] ) ) . '</span>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_HEALTH, Health::TYPE_SCORE ) ); ?>\" class=\"button button-secondary button-small\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Refresh', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Refresh page score', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-double litespeed-postbox-imgopt\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Image Optimization Summary', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-img_optm' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div class=\"litespeed-postbox-double-content\">\n\t\t\t\t\t\t\t\t<div class=\"litespeed-postbox-double-col\">\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle\">\n\t\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $img_finished_percentage, 70, true ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-dashboard-stats\">\n\t\t\t\t\t\t\t\t\t\t\t\t<a data-litespeed-onlyonce class=\"button button-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $img_count['groups_new'] ) || ! empty( $img_count[ 'groups.' . Img_Optm::STATUS_RAW ] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_NEW_REQ ) ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"javascript:;\" disabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-images-alt2\"></span><?php esc_html_e( 'Send Optimization Request', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Total Reduction', 'litespeed-cache' ); ?>: <code><?php echo isset( $img_optm_summary['reduced'] ) ? esc_html( Utility::real_size( $img_optm_summary['reduced'] ) ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Images Pulled', 'litespeed-cache' ); ?>: <code><?php echo isset( $img_optm_summary['img_taken'] ) ? esc_html( $img_optm_summary['img_taken'] ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-postbox-double-col\">\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Images requested', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Images notified to pull', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Last Request', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $img_optm_summary['last_requested'] ) ? esc_html( Utility::readable_time( $img_optm_summary['last_requested'] ) ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Last Pull', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $img_optm_summary['last_pull'] ) ? esc_html( Utility::readable_time( $img_optm_summary['last_pull'] ) ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t$opt_list = array(\n\t\t\t\t\t\t\t\t\t\tBase::O_IMG_OPTM_AUTO => Lang::title( Base::O_IMG_OPTM_AUTO ),\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tforeach ( $opt_list as $opt_id => $opt_title ) :\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<?php if ( $this->conf( $opt_id ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-img_optm#settings' ) ); ?>\"><?php echo esc_html( $opt_title ); ?></a>\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-cache\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Cache Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-cache' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t$cache_list = array(\n\t\t\t\t\t\t\t\tBase::O_CACHE         => esc_html__( 'Public Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tBase::O_CACHE_PRIV    => esc_html__( 'Private Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tBase::O_OBJECT        => esc_html__( 'Object Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tBase::O_CACHE_BROWSER => esc_html__( 'Browser Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tforeach ( $cache_list as $cache_option => $cache_title ) :\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php if ( $this->conf( $cache_option ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( $cache_title ); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-ccss\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Critical CSS', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_css' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $css_summary['last_request_ccss'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $css_summary['last_request_ccss'] ) ) . '</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $css_summary['last_spent_ccss'] ) . 's</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $ccss_count ) ? esc_html( $ccss_count ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $ccss_count ) ? esc_url( Utility::build_url( Router::ACTION_CSS, CSS::TYPE_GEN_CCSS ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $ccss_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.ccss'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.ccss'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-ucss\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Unique CSS', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_css' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $ucss_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $ucss_summary['last_request'] ) ) . '</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $ucss_summary['last_spent'] ) . 's</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $ucss_count ) ? esc_html( $ucss_count ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $ucss_count ) ? esc_url( Utility::build_url( Router::ACTION_UCSS, UCSS::TYPE_GEN ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $ucss_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.ucss'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.ucss'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-lqip\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Low Quality Image Placeholder', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_media' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $placeholder_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $placeholder_summary['last_request'] ) ) . '</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $placeholder_summary['last_spent'] ) . 's</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $placeholder_queue_count ) ? esc_html( $placeholder_queue_count ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $placeholder_queue_count ) ? esc_url( Utility::build_url( Router::ACTION_PLACEHOLDER, Placeholder::TYPE_GENERATE ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $placeholder_queue_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.lqip'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.lqip'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-vpi\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Viewport Image', 'litespeed-cache' ); ?> (VPI)\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_vpi' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $vpi_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $vpi_summary['last_request'] ) ) . '</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $vpi_summary['last_spent'] ) . 's</code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $vpi_queue_count ) ? esc_html( $vpi_queue_count ) : '-'; ?></code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $vpi_queue_count ) ? esc_url( Utility::build_url( Router::ACTION_VPI, VPI::TYPE_GEN ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $vpi_queue_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.vpi'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.vpi'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-crawler\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Crawler Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<code><?php echo esc_html( count( Crawler::cls()->list_crawlers() ) ); ?></code> <?php esc_html_e( 'Crawler(s)', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Currently active crawler', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $crawler_summary['curr_crawler'] ); ?></code>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['curr_crawler_beginning_time'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Current crawler started at', 'litespeed-cache' ); ?>:</span>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['curr_crawler_beginning_time'] ) ); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_start_time'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Last interval', 'litespeed-cache' ); ?>:</span>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['last_start_time'] ) ); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['end_reason'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Ended reason', 'litespeed-cache' ); ?>:</span>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( $crawler_summary['end_reason'] ); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_crawled'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( '%1$s %2$d item(s)', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<span class=\"litespeed-bold\">' . esc_html__( 'Last crawled:', 'litespeed-cache' ) . '</span>',\n\t\t\t\t\t\t\t\t\t\tesc_html( $crawler_summary['last_crawled'] )\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-quiccloud <?php echo empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ? 'litespeed-postbox--quiccloud' : ''; ?>\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title litespeed-dashboard-title--w-btn\">\n\t\t\t\t\t\t\t\t<span class=\"litespeed-quic-icon\"></span><?php esc_html_e( 'QUIC.cloud CDN', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php if ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t\t\t\t<a href=\"https://www.quic.cloud/quic-cloud-services-and-features/litespeed-cache-service/\" class=\"litespeed-title-right-icon\" target=\"_blank\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-cdn' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<?php if ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-text-center litespeed-empty-space-medium\">\n\t\t\t\t\t\t\t\t\t<p class=\"litespeed-margin-bottom20\">\n\t\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\t\t\t\tesc_url( Utility::build_url( Router::ACTION_CLOUD, $cloud_instance->activated() ? Cloud::TYPE_ENABLE_CDN : Cloud::TYPE_ACTIVATE ) ),\n\t\t\t\t\t\t\t\t\t\t\t'<span class=\"dashicons dashicons-saved\"></span>' . esc_html__( 'Enable QUIC.cloud CDN', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\t\t'button button-primary litespeed-button-cta'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p class=\"litespeed-margin-bottom10 litespeed-top20 litespeed-text-md\">\n\t\t\t\t\t\t\t\t\t\t<strong class=\"litespeed-qc-text-gradient\"><?php esc_html_e( 'Best available WordPress performance', 'litespeed-cache' ); ?></strong>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p class=\"litespeed-margin-bottom20 litespeed-margin-top-remove\">\n\t\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\t\tesc_html__( 'Globally fast TTFB, easy setup, and %s!', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t\t'<a href=\"https://www.quic.cloud/quic-cloud-services-and-features/litespeed-cache-service/\" target=\"_blank\">' . esc_html__( 'more', 'litespeed-cache' ) . '</a>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t<?php echo wp_kses_post( $cloud_instance->load_qc_status_for_dash( 'cdn_dash_mini' ) ); ?>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php if ( $cloud_instance->activated() ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_SYNC_STATUS ) ); ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-<?php echo 'cdn' !== $cloud_summary['qc_activated'] ? 'link' : 'secondary'; ?> button-small\">\n\t\t\t\t\t\t\t\t\t<?php if ( 'cdn' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Refresh Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Refresh QUIC.cloud status', 'litespeed-cache' ); ?></span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<?php\n\t\t\t\t\t$promo_mini = $cloud_instance->load_qc_status_for_dash( 'promo_mini' );\n\t\t\t\t\tif ( $promo_mini ) :\n\t\t\t\t\t\techo wp_kses_post( $promo_mini );\n\t\t\t\t\tendif;\n\t\t\t\t\t?>\n\n\t\t\t\t\t<?php if ( $cloud_instance->activated() ) : ?>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$news = $cloud_instance->load_qc_status_for_dash( 'news_dash' );\n\t\t\t\t\t\tif ( $news ) :\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t\t\t\t\t<div class=\"inside litespeed-text-center\">\n\t\t\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'News', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses_post( $news ); ?>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
    "plugins/litespeed-cache/tpl/crawler/summary.tpl.php": "<?php\n/**\n * LiteSpeed Cache Crawler Summary\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__crawler    = Crawler::cls();\n$crawler_list = $__crawler->list_crawlers();\n$summary      = Crawler::get_summary();\n\nif ( $summary['curr_crawler'] >= count( $crawler_list ) ) {\n\t$summary['curr_crawler'] = 0;\n}\n\n$is_running = time() - $summary['is_running'] <= 900;\n\n$disabled     = Router::can_crawl() ? '' : 'disabled';\n$disabled_tip = '';\nif ( ! $this->conf( Base::O_CRAWLER_SITEMAP ) ) {\n\t$disabled     = 'disabled';\n\t$disabled_tip = '<span class=\"litespeed-callout notice notice-error inline litespeed-left20\">' . sprintf(\n\t\tesc_html__( 'You need to set the %s in Settings first before using the crawler', 'litespeed-cache' ),\n\t\t'<code>' . esc_html( Lang::title( Base::O_CRAWLER_SITEMAP ) ) . '</code>'\n\t) . '</span>';\n}\n\n$crawler_run_interval = defined( 'LITESPEED_CRAWLER_RUN_INTERVAL' ) ? LITESPEED_CRAWLER_RUN_INTERVAL : 600;\nif ( $crawler_run_interval > 0 ) :\n\t$recurrence = '';\n\t$hours      = (int) floor( $crawler_run_interval / 3600 );\n\tif ( $hours ) {\n\t\t$recurrence .= sprintf(\n\t\t\t$hours > 1 ? esc_html__( '%d hours', 'litespeed-cache' ) : esc_html__( '%d hour', 'litespeed-cache' ),\n\t\t\t$hours\n\t\t);\n\t}\n\t$minutes = (int) floor( ( $crawler_run_interval % 3600 ) / 60 );\n\tif ( $minutes ) {\n\t\t$recurrence .= ' ';\n\t\t$recurrence .= sprintf(\n\t\t\t$minutes > 1 ? esc_html__( '%d minutes', 'litespeed-cache' ) : esc_html__( '%d minute', 'litespeed-cache' ),\n\t\t\t$minutes\n\t\t);\n\t}\n?>\n\n\t<h3 class=\"litespeed-title litespeed-relative\">\n\t\t<?php esc_html_e( 'Crawler Cron', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/crawler/' ); ?>\n\t</h3>\n\n\t<?php if ( ! Router::can_crawl() ) : ?>\n\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n\t\t\t<p><?php esc_html_e( 'The crawler feature is not enabled on the LiteSpeed server. Please consult your server admin or hosting provider.', 'litespeed-cache' ); ?></p>\n\t\t\t<p>\n\t\t\t\t<?php\n\t\t\t\tprintf(\n\t\t\t\t\t/* translators: %s: Link tags */\n\t\t\t\t\tesc_html__( 'See %sIntroduction for Enabling the Crawler%s for detailed information.', 'litespeed-cache' ),\n\t\t\t\t\t'<a href=\"https://docs.litespeedtech.com/lscache/lscwp/admin/#enabling-and-limiting-the-crawler\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t\t'</a>'\n\t\t\t\t);\n\t\t\t\t?>\n\t\t\t</p>\n\t\t</div>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['this_full_beginning_time'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Current sitemap crawl started at', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php echo esc_html( Utility::readable_time( $summary['this_full_beginning_time'] ) ); ?>\n\t\t</p>\n\t\t<?php if ( ! $is_running ) : ?>\n\t\t\t<p>\n\t\t\t\t<b><?php esc_html_e( 'The next complete sitemap crawl will start at', 'litespeed-cache' ); ?>:</b>\n\t\t\t\t<?php echo esc_html( gmdate( 'm/d/Y H:i:s', $summary['this_full_beginning_time'] + LITESPEED_TIME_OFFSET + (int) $summary['last_full_time_cost'] + $this->conf( Base::O_CRAWLER_CRAWL_INTERVAL ) ) ); ?>\n\t\t\t</p>\n\t\t<?php endif; ?>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['last_full_time_cost'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Last complete run time for all crawlers', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php printf( esc_html__( '%d seconds', 'litespeed-cache' ), (int) $summary['last_full_time_cost'] ); ?>\n\t\t</p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['last_crawler_total_cost'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Run time for previous crawler', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php printf( esc_html__( '%d seconds', 'litespeed-cache' ), (int) $summary['last_crawler_total_cost'] ); ?>\n\t\t</p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['curr_crawler_beginning_time'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Current crawler started at', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php echo esc_html( Utility::readable_time( $summary['curr_crawler_beginning_time'] ) ); ?>\n\t\t</p>\n\t<?php endif; ?>\n\n\t<p>\n\t\t<b><?php esc_html_e( 'Current server load', 'litespeed-cache' ); ?>:</b>\n\t\t<?php echo esc_html( $__crawler->get_server_load() ); ?>\n\t</p>\n\n\t<?php if ( $summary['last_start_time'] ) : ?>\n\t\t<p class=\"litespeed-desc\">\n\t\t\t<b><?php esc_html_e( 'Last interval', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php echo esc_html( Utility::readable_time( $summary['last_start_time'] ) ); ?>\n\t\t</p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['end_reason'] ) : ?>\n\t\t<p class=\"litespeed-desc\">\n\t\t\t<b><?php esc_html_e( 'Ended reason', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php echo esc_html( $summary['end_reason'] ); ?>\n\t\t</p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['last_crawled'] ) : ?>\n\t\t<p class=\"litespeed-desc\">\n\t\t\t<b><?php esc_html_e( 'Last crawled', 'litespeed-cache' ); ?>:</b>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\tesc_html__( '%d item(s)', 'litespeed-cache' ),\n\t\t\t\tesc_html( $summary['last_crawled'] )\n\t\t\t);\n\t\t\t?>\n\t\t</p>\n\t<?php endif; ?>\n\n\t<p>\n\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_RESET ) ); ?>\" class=\"button litespeed-btn-warning\"><?php esc_html_e( 'Reset position', 'litespeed-cache' ); ?></a>\n\t\t<a href=\"<?php echo Router::can_crawl() ? esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_START ) ) : 'javascript:;'; ?>\" id=\"litespeed_manual_trigger\" class=\"button litespeed-btn-success\" litespeed-accesskey=\"R\" <?php echo wp_kses_post( $disabled ); ?>><?php esc_html_e( 'Manually run', 'litespeed-cache' ); ?></a>\n\t\t<?php echo wp_kses_post( $disabled_tip ); ?>\n\t</p>\n\n\t<div class=\"litespeed-table-responsive\">\n\t\t<table class=\"wp-list-table widefat striped\" data-crawler-list>\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th scope=\"col\">#</th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Cron Name', 'litespeed-cache' ); ?></th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Run Frequency', 'litespeed-cache' ); ?></th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Status', 'litespeed-cache' ); ?></th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Activate', 'litespeed-cache' ); ?></th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Running', 'litespeed-cache' ); ?></th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t<?php\n\t\t\t\tforeach ( $crawler_list as $i => $v ) :\n\t\t\t\t\t$hit          = ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_HIT ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_HIT ] : 0;\n\t\t\t\t\t$miss         = ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_MISS ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_MISS ] : 0;\n\t\t\t\t\t$blacklisted  = ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_BLACKLIST ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_BLACKLIST ] : 0;\n\t\t\t\t\t$blacklisted += ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_NOCACHE ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_NOCACHE ] : 0;\n\t\t\t\t\t$waiting      = isset( $summary['crawler_stats'][ $i ][ Crawler::STATUS_WAIT ] )\n\t\t\t\t\t\t? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_WAIT ]\n\t\t\t\t\t\t: (int) ( $summary['list_size'] - $hit - $miss - $blacklisted );\n\t\t\t\t?>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\techo esc_html( $i + 1 );\n\t\t\t\t\t\t\tif ( $i === $summary['curr_crawler'] ) {\n\t\t\t\t\t\t\t\techo '<img class=\"litespeed-crawler-curr\" src=\"' . esc_url( LSWCP_PLUGIN_URL . 'assets/img/Litespeed.icon.svg' ) . '\" alt=\"Current Crawler\">';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td><?php echo wp_kses_post( $v['title'] ); ?></td>\n\t\t\t\t\t\t<td><?php echo esc_html( $recurrence ); ?></td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-default\" data-balloon-pos=\"up\" aria-label=\"%s\">%s</i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Waiting', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $waiting > 0 ? $waiting : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-success\" data-balloon-pos=\"up\" aria-label=\"%s\">%s</i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Hit', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $hit > 0 ? $hit : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-primary\" data-balloon-pos=\"up\" aria-label=\"%s\">%s</i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Miss', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $miss > 0 ? $miss : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-danger\" data-balloon-pos=\"up\" aria-label=\"%s\">%s</i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Blocklisted', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $blacklisted > 0 ? $blacklisted : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php $this->build_toggle( 'litespeed-crawler-' . $i, $__crawler->is_active( $i ) ); ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $v['uid'] ) && empty( $this->conf( Base::O_SERVER_IP ) ) ) : ?>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\t\t\t🚨 <?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'You must set %s before using this feature.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\tesc_html( Lang::title( Base::O_SERVER_IP ) )\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\t\t\tesc_url( admin_url( 'admin.php?page=litespeed-general#settings' ) ),\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tif ( $i === $summary['curr_crawler'] ) {\n\t\t\t\t\t\t\t\techo esc_html__( 'Position: ', 'litespeed-cache' ) . esc_html( $summary['last_pos'] + 1 );\n\t\t\t\t\t\t\t\tif ( $is_running ) {\n\t\t\t\t\t\t\t\t\techo ' <span class=\"litespeed-label-success\">' . esc_html__( 'running', 'litespeed-cache' ) . '</span>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t<?php endforeach; ?>\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n\n\t<p>\n\t\t<i class=\"litespeed-badge litespeed-bg-default\"></i> = <?php esc_html_e( 'Waiting to be Crawled', 'litespeed-cache' ); ?><br>\n\t\t<i class=\"litespeed-badge litespeed-bg-success\"></i> = <?php esc_html_e( 'Already Cached', 'litespeed-cache' ); ?><br>\n\t\t<i class=\"litespeed-badge litespeed-bg-primary\"></i> = <?php esc_html_e( 'Successfully Crawled', 'litespeed-cache' ); ?><br>\n\t\t<i class=\"litespeed-badge litespeed-bg-danger\"></i> = <?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><br>\n\t</p>\n\n\t<div class=\"litespeed-desc\">\n\t\t<div><?php esc_html_e( 'Run frequency is set by the Interval Between Runs setting.', 'litespeed-cache' ); ?></div>\n\t\t<div>\n\t\t\t<?php\n\t\t\tesc_html_e( 'Crawlers cannot run concurrently. If both the cron and a manual run start at similar times, the first to be started will take precedence.', 'litespeed-cache' );\n\t\t\t?>\n\t\t</div>\n\t\t<div>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t/* translators: %s: Link tags */\n\t\t\t\tesc_html__( 'Please see %sHooking WP-Cron Into the System Task Scheduler%s to learn how to create the system cron task.', 'litespeed-cache' ),\n\t\t\t\t'<a href=\"https://developer.wordpress.org/plugins/cron/hooking-wp-cron-into-the-system-task-scheduler/\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t'</a>'\n\t\t\t);\n\t\t\t?>\n\t\t</div>\n\t</div>\n<?php\nendif;\n?>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Watch Crawler Status', 'litespeed-cache' ); ?></h3>\n\n<?php\n$ajax_url = $__crawler->json_path();\nif ( $ajax_url ) :\n?>\n\t<input type=\"button\" id=\"litespeed-crawl-url-btn\" value=\"<?php esc_attr_e( 'Show crawler status', 'litespeed-cache' ); ?>\" class=\"button button-secondary\" data-url=\"<?php echo esc_url( $ajax_url ); ?>\" />\n\t<div class=\"litespeed-shell litespeed-hide\">\n\t\t<div class=\"litespeed-shell-header-bar\"></div>\n\t\t<div class=\"litespeed-shell-header\">\n\t\t\t<div class=\"litespeed-shell-header-bg\"></div>\n\t\t\t<div class=\"litespeed-shell-header-icon-container\">\n\t\t\t\t<img id=\"litespeed-shell-icon\" src=\"<?php echo esc_url( LSWCP_PLUGIN_URL . 'assets/img/Litespeed.icon.svg' ); ?>\" alt=\"LiteSpeed Icon\" />\n\t\t\t</div>\n\t\t</div>\n\t\t<ul class=\"litespeed-shell-body\">\n\t\t\t<li><?php esc_html_e( 'Start watching...', 'litespeed-cache' ); ?></li>\n\t\t\t<li id=\"litespeed-loading-dot\"></li>\n\t\t</ul>\n\t</div>\n<?php else : ?>\n\t<p><?php esc_html_e( 'No crawler meta file generated yet', 'litespeed-cache' ); ?></p>\n<?php endif; ?>\n\n<script>\nvar _litespeed_meta;\nvar _litespeed_shell_interval = 3; // seconds\nvar _litespeed_shell_interval_range = [3, 60];\nvar _litespeed_shell_handle;\nvar _litespeed_shell_display_handle;\nvar _litespeed_crawler_url;\nvar _litespeed_dots;\n\n\n(function ($) {\n\t'use strict';\n\tjQuery(document).ready(function () {\n\t\t$('#litespeed-crawl-url-btn').on('click', function () {\n\t\t\tif (!$(this).data('url')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$('.litespeed-shell').removeClass('litespeed-hide');\n\t\t\t_litespeed_dots = window.setInterval(_litespeed_loading_dots, 300);\n\t\t\t_litespeed_crawler_url = $(this).data('url');\n\t\t\tlitespeed_fetch_meta();\n\t\t\t$(this).hide();\n\t\t});\n\n\t\t$('#litespeed_manual_trigger').on('click', function (event) {\n\t\t\t$('#litespeed-loading-dot').before('<li>Manually Started</li>');\n\t\t\t_litespeed_shell_interval = _litespeed_shell_interval_range[0];\n\t\t\tlitespeed_fetch_meta();\n\t\t});\n\n\t\t/**\n\t\t * Freeze or melt a specific crawler\n\t\t * @since  4.3\n\t\t */\n\t\tif ($('[data-crawler-list] [data-litespeed_toggle_id]').length > 0) {\n\t\t\t$('[data-crawler-list] [data-litespeed_toggle_id]').on('click', function (e) {\n\t\t\t\tvar crawler_id = $(this).attr('data-litespeed_toggle_id');\n\t\t\t\tvar crawler_id = Number(crawler_id.split('-').pop());\n\t\t\t\tvar that = this;\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: '<?php echo function_exists('get_rest_url') ? get_rest_url(null, 'litespeed/v1/toggle_crawler_state') : '/'; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>',\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcache: false,\n\t\t\t\t\tdata: { crawler_id: crawler_id },\n\t\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\t\txhr.setRequestHeader('X-WP-Nonce', '<?php echo esc_js( wp_create_nonce('wp_rest') ); ?>');\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\t$(that)\n\t\t\t\t\t\t\t.toggleClass('litespeed-toggle-btn-default litespeed-toggleoff', data == 0)\n\t\t\t\t\t\t\t.toggleClass('litespeed-toggle-btn-primary', data == 1);\n\t\t\t\t\t\tconsole.log('litespeed-crawler-ajax: change Activate option');\n\t\t\t\t\t},\n\t\t\t\t\terror: function (xhr, error) {\n\t\t\t\t\t\tconsole.log(xhr);\n\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t\tconsole.log('litespeed-crawler-ajax: option failed to save due to some error');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n})(jQuery);\n\n\nfunction litespeed_fetch_meta() {\n\twindow.clearTimeout(_litespeed_shell_handle);\n\tjQuery('#litespeed-loading-dot').text('');\n\tjQuery.ajaxSetup({ cache: false });\n\tjQuery.getJSON(_litespeed_crawler_url, function (meta) {\n\t\tlitespeed_pulse();\n\t\tvar changed = false;\n\t\tif (meta && 'list_size' in meta) {\n\t\t\tnew_meta =\n\t\t\t\tmeta.list_size + ' ' + meta.file_time + ' ' + meta.curr_crawler + ' ' + meta.last_pos + ' ' + meta.last_count + ' ' + meta.last_start_time + ' ' + meta.is_running;\n\t\t\tif (new_meta != _litespeed_meta) {\n\t\t\t\t_litespeed_meta = new_meta;\n\t\t\t\tchanged = true;\n\t\t\t\tstring = _litespeed_build_meta(meta);\n\t\t\t\tjQuery('#litespeed-loading-dot').before(string);\n\t\t\t\t// remove first log elements\n\t\t\t\tlog_length = jQuery('.litespeed-shell-body li').length;\n\t\t\t\tif (log_length > 50) {\n\t\t\t\t\tjQuery('.litespeed-shell-body li:lt(' + (log_length - 50) + ')').remove();\n\t\t\t\t}\n\t\t\t\t// scroll to end\n\t\t\t\tjQuery('.litespeed-shell-body')\n\t\t\t\t\t.stop()\n\t\t\t\t\t.animate(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscrollTop: jQuery('.litespeed-shell-body')[0].scrollHeight,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t800,\n\t\t\t\t\t);\n\t\t\t}\n\n\t\t\t// dynamic adjust the interval length\n\t\t\t_litespeed_adjust_interval(changed);\n\t\t}\n\t\t// display interval counting\n\t\tlitespeed_display_interval_reset();\n\t\t_litespeed_shell_handle = window.setTimeout(_litespeed_dynamic_timeout, _litespeed_shell_interval * 1000);\n\t});\n}\n\nfunction _litespeed_loading_dots() {\n\tjQuery('#litespeed-loading-dot').append('.');\n}\n\n/**\n * Dynamic adjust interval\n */\nfunction _litespeed_adjust_interval(changed) {\n\tif (changed) {\n\t\t_litespeed_shell_interval -= Math.ceil(_litespeed_shell_interval / 2);\n\t} else {\n\t\t_litespeed_shell_interval++;\n\t}\n\n\tif (_litespeed_shell_interval < _litespeed_shell_interval_range[0]) {\n\t\t_litespeed_shell_interval = _litespeed_shell_interval_range[0];\n\t}\n\tif (_litespeed_shell_interval > _litespeed_shell_interval_range[1]) {\n\t\t_litespeed_shell_interval = _litespeed_shell_interval_range[1];\n\t}\n}\n\nfunction _litespeed_build_meta(meta) {\n\tvar string =\n\t\t'<li>' +\n\t\tlitespeed_date(meta.last_update_time) +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size: ' +\n\t\tmeta.list_size +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Crawler: #' +\n\t\t(meta.curr_crawler * 1 + 1) +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Position: ' +\n\t\t(meta.last_pos * 1 + 1) +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Threads: ' +\n\t\tmeta.last_count +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Status: ';\n\tif (meta.is_running) {\n\t\tstring += 'crawling, ' + meta.last_status;\n\t} else {\n\t\tstring += meta.end_reason ? meta.end_reason : '-';\n\t}\n\tstring += '</li>';\n\treturn string;\n}\n\nfunction _litespeed_dynamic_timeout() {\n\tlitespeed_fetch_meta();\n}\n\nfunction litespeed_display_interval_reset() {\n\twindow.clearInterval(_litespeed_shell_display_handle);\n\tjQuery('.litespeed-shell-header-bar').data('num', _litespeed_shell_interval);\n\t_litespeed_shell_display_handle = window.setInterval(_litespeed_display_interval, 1000);\n\n\tjQuery('.litespeed-shell-header-bar')\n\t\t.stop()\n\t\t.animate({ width: '100%' }, 500, function () {\n\t\t\tjQuery('.litespeed-shell-header-bar').css('width', '0%');\n\t\t});\n}\n\nfunction _litespeed_display_interval() {\n\tvar num = jQuery('.litespeed-shell-header-bar').data('num');\n\tjQuery('.litespeed-shell-header-bar')\n\t\t.stop()\n\t\t.animate({ width: litespeed_get_percent(num, _litespeed_shell_interval) + '%' }, 1000);\n\tif (num > 0) num--;\n\tif (num < 0) num = 0;\n\tjQuery('.litespeed-shell-header-bar').data('num', num);\n}\n\nfunction litespeed_get_percent(num1, num2) {\n\tnum1 = num1 * 1;\n\tnum2 = num2 * 1;\n\tnum = (num2 - num1) / num2;\n\treturn num * 100;\n}\n\nfunction litespeed_date(timestamp) {\n\tvar a = new Date(timestamp * 1000);\n\tvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\tvar year = a.getFullYear();\n\tvar month = months[a.getMonth()];\n\tvar date = litespeed_add_zero(a.getDate());\n\tvar hour = litespeed_add_zero(a.getHours());\n\tvar min = litespeed_add_zero(a.getMinutes());\n\tvar sec = litespeed_add_zero(a.getSeconds());\n\tvar time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;\n\treturn time;\n}\n\nfunction litespeed_add_zero(i) {\n\tif (i < 10) {\n\t\ti = '0' + i;\n\t}\n\treturn i;\n}\n\nfunction litespeed_pulse() {\n\tjQuery('#litespeed-shell-icon').animate(\n\t\t{\n\t\t\twidth: 27,\n\t\t\theight: 34,\n\t\t\topacity: 1,\n\t\t},\n\t\t700,\n\t\tfunction () {\n\t\t\tjQuery('#litespeed-shell-icon').animate(\n\t\t\t\t{\n\t\t\t\t\twidth: 23,\n\t\t\t\t\theight: 29,\n\t\t\t\t\topacity: 0.5,\n\t\t\t\t},\n\t\t\t\t700,\n\t\t\t);\n\t\t},\n\t);\n}\n\n</script>",
    "plugins/litespeed-cache/tpl/crawler/settings.tpl.php": "<?php\n/**\n * LiteSpeed Cache Crawler General Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Crawler General Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/crawler/#general-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'This will enable crawler cron.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br><?php Doc::notice_htaccess(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_CRAWL_INTERVAL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?> <?php esc_html_e( 'seconds', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify how long in seconds before the crawler should initiate crawling the entire sitemap again.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_SITEMAP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The crawler will use your XML sitemap or sitemap index. Enter the full URL to your sitemap here.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_LOAD_LIMIT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The maximum average server load allowed while crawling. The number of crawler threads in use will be actively reduced until average server load falls under this limit. If this cannot be achieved with a single thread, the current crawler run will be terminated.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php if ( ! empty( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE ] ) ) : ?>\n\t\t\t\t\t\t<span class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'Server enforced value: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t'<code>' . esc_html( sanitize_text_field( wp_unslash( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE ] ) ) ) . '</code>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t<?php elseif ( ! empty( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT ] ) ) : ?>\n\t\t\t\t\t\t<span class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'Server allowed max value: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t'<code>' . esc_html( sanitize_text_field( wp_unslash( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT ] ) ) ) . '</code>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php $this->_api_env_var( Base::ENV_CRAWLER_LOAD_LIMIT, Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_ROLES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id, 20 ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'To crawl the site as a logged-in user, enter the user ids to be simulated.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php if ( empty( $this->conf( Base::O_SERVER_IP ) ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\t🚨 <?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'You must set %s before using this feature.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( Lang::title( Base::O_SERVER_IP ) )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\tesc_url( admin_url( 'admin.php?page=litespeed-general#settings' ) ),\n\t\t\t\t\t\t\t\tesc_html__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( empty( $this->conf( Base::O_ESI ) ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\t🚨 <?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'You must set %1$s to %2$s before using this feature.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( Lang::title( Base::O_ESI ) ),\n\t\t\t\t\t\t\t\tesc_html__( 'ON', 'litespeed-cache' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\tesc_url( admin_url( 'admin.php?page=litespeed-cache#esi' ) ),\n\t\t\t\t\t\t\t\tesc_html__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_COOKIES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->enroll( $option_id . '[name][]' ); ?>\n\t\t\t\t<?php $this->enroll( $option_id . '[vals][]' ); ?>\n\t\t\t\t<div id=\"litespeed_crawler_simulation_div\"></div>\n\t\t\t\t<script type=\"text/babel\">\n\t\t\t\t\tReactDOM.render(\n\t\t\t\t\t\t<CrawlerSimulate list={ <?php echo wp_json_encode( $this->conf( $option_id ) ); ?> } />,\n\t\t\t\t\t\tdocument.getElementById( 'litespeed_crawler_simulation_div' )\n\t\t\t\t\t);\n\t\t\t\t</script>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'To crawl for a particular cookie, enter the cookie name, and the values you wish to crawl for. Values should be one per line. There will be one crawler created per cookie value, per simulated role.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/crawler/#cookie-simulation' ); ?>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\tesc_html__( 'Use %1$s in %2$s to indicate this cookie has not been set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<code>_null</code>',\n\t\t\t\t\t\t\tesc_html__( 'Cookie Values', 'litespeed-cache' )\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<?php $this->form_end(); ?>",
    "plugins/litespeed-cache/tpl/crawler/blacklist.tpl.php": "<?php\n/**\n * LiteSpeed Cache Crawler Blocklist\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$crawler_summary = Crawler::get_summary();\n$__map           = Crawler_Map::cls();\n$__admin_display = Admin_Display::cls();\n$list            = $__map->list_blacklist( 30 );\n$count           = $__map->count_blacklist();\n$pagination      = Utility::pagination( $count, 30 );\n?>\n\n<p class=\"litespeed-right\">\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_BLACKLIST_EMPTY ) ); ?>\" class=\"button litespeed-btn-warning\" data-litespeed-cfm=\"<?php esc_attr_e( 'Are you sure to delete all existing blocklist items?', 'litespeed-cache' ); ?>\">\n\t\t<?php esc_html_e( 'Empty blocklist', 'litespeed-cache' ); ?>\n\t</a>\n</p>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Blocklist', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/crawler/#blocklist-tab' ); ?>\n</h3>\n\n<?php echo esc_html__( 'Total', 'litespeed-cache' ) . ': ' . esc_html( $count ); ?>\n\n<?php echo wp_kses_post( $pagination ); ?>\n\n<div class=\"litespeed-table-responsive\">\n\t<table class=\"wp-list-table widefat striped\">\n\t\t<thead>\n\t\t\t<tr>\n\t\t\t\t<th scope=\"col\">#</th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'URL', 'litespeed-cache' ); ?></th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Status', 'litespeed-cache' ); ?></th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Operation', 'litespeed-cache' ); ?></th>\n\t\t\t</tr>\n\t\t</thead>\n\t\t<tbody>\n\t\t\t<?php foreach ( $list as $i => $v ) : ?>\n\t\t\t<tr>\n\t\t\t\t<td><?php echo esc_html( $i + 1 ); ?></td>\n\t\t\t\t<td><?php echo esc_html( $v['url'] ); ?></td>\n\t\t\t\t<td><?php echo wp_kses_post( Crawler::cls()->display_status( $v['res'], $v['reason'] ) ); ?></td>\n\t\t\t\t<td>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_BLACKLIST_DEL, false, null, array( 'id' => $v['id'] ) ) ); ?>\" class=\"button button-secondary\">\n\t\t\t\t\t\t<?php esc_html_e( 'Remove from Blocklist', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<?php endforeach; ?>\n\t\t</tbody>\n\t</table>\n</div>\n\n<?php echo wp_kses_post( $pagination ); ?>\n\n<p>\n\t<span class=\"litespeed-success\">\n\t\t<?php\n\t\tprintf(\n\t\t\tesc_html__( 'API: PHP Constant %s available to disable blocklist.', 'litespeed-cache' ),\n\t\t\t'<code>LITESPEED_CRAWLER_DISABLE_BLOCKLIST</code>'\n\t\t);\n\t\t?>\n\t</span>\n</p>\n<p>\n\t<span class=\"litespeed-success\">\n\t\t<?php\n\t\tprintf(\n\t\t\tesc_html__( 'API: Filter %s available to disable blocklist.', 'litespeed-cache' ),\n\t\t\t'<code>add_filter( \\'litespeed_crawler_disable_blocklist\\', \\'__return_true\\' );</code>'\n\t\t);\n\t\t?>\n\t</span>\n</p>\n<?php $__admin_display->_check_overwritten( 'crawler-blocklist' ); ?>\n<p>\n\t<i class=\"litespeed-dot litespeed-bg-default\"></i> = <?php esc_html_e( 'Not blocklisted', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-warning\"></i> = <?php esc_html_e( 'Blocklisted due to not cacheable', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-danger\"></i> = <?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><br>\n</p>\n",
    "plugins/litespeed-cache/tpl/crawler/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Crawler Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = [\n\t'summary'   => esc_html__( 'Summary', 'litespeed-cache' ),\n\t'map'       => esc_html__( 'Map', 'litespeed-cache' ),\n\t'blacklist' => esc_html__( 'Blocklist', 'litespeed-cache' ),\n\t'settings'  => esc_html__( 'Settings', 'litespeed-cache' ),\n];\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Crawler', 'litespeed-cache' ); ?>\n\t</h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t</span>\n\t<hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t</h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php\n\t\tforeach ( $menu_list as $menu_key => $menu_value ) {\n\t\t\tprintf(\n\t\t\t\t'<div data-litespeed-layout=\"%s\">',\n\t\t\t\tesc_attr( $menu_key )\n\t\t\t);\n\t\t\trequire LSCWP_DIR . \"tpl/crawler/$menu_key.tpl.php\";\n\t\t\techo '</div>';\n\t\t}\n\t\t?>\n\t</div>\n</div>\n\n<iframe name=\"litespeedHiddenIframe\" src=\"\" width=\"0\" height=\"0\" frameborder=\"0\"></iframe>\n",
    "plugins/litespeed-cache/tpl/crawler/map.tpl.php": "<?php\n/**\n * LiteSpeed Cache Crawler Sitemap List\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$crawler_summary = Crawler::get_summary();\n$__map           = Crawler_Map::cls();\n$list            = $__map->list_map( 30 );\n$count           = $__map->count_map();\n$pagination      = Utility::pagination( $count, 30 );\n$kw              = '';\nif (! empty( $_POST['kw'] ) && ! empty( $_POST['_wpnonce'] )) {\n\t$nonce = sanitize_text_field(wp_unslash($_POST['_wpnonce']));\n\tif (wp_verify_nonce($nonce)) {\n\t\t$kw = sanitize_text_field(wp_unslash($_POST['kw']));\n\t}\n}\n?>\n\n<p class=\"litespeed-right\">\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_EMPTY ) ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Clean Crawler Map', 'litespeed-cache' ); ?>\n\t</a>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_REFRESH_MAP ) ); ?>\" class=\"button button-secondary\">\n\t\t<?php esc_html_e( 'Refresh Crawler Map', 'litespeed-cache' ); ?>\n\t</a>\n</p>\n\n<p>\n\t<?php\n\tif ( ! empty( $crawler_summary['sitemap_time'] ) ) {\n\t\tprintf(\n\t\t\tesc_html__( 'Generated at %s', 'litespeed-cache' ),\n\t\t\tesc_html( Utility::readable_time( $crawler_summary['sitemap_time'] ) )\n\t\t);\n\t}\n\t?>\n</p>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Sitemap List', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/crawler/#map-tab' ); ?>\n</h3>\n\n<?php echo esc_html__( 'Sitemap Total', 'litespeed-cache' ) . ': ' . esc_html( $count ); ?>\n\n<div style=\"display: flex; justify-content: space-between;\">\n\t<div style=\"margin-top:10px;\">\n\t\t<form action=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler' ) ); ?>\" method=\"post\">\n\t\t<?php wp_nonce_field(); ?>\n\t\t\t<input type=\"text\" name=\"kw\" value=\"<?php echo esc_attr( $kw ); ?>\" placeholder=\"<?php esc_attr_e( 'URL Search', 'litespeed-cache' ); ?>\" style=\"width: 600px;\" />\n\t\t</form>\n\t</div>\n\t<div>\n\t\t<a style=\"padding-right:10px;\" href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler&' . Router::TYPE . '=hit' ) ); ?>\"><?php esc_html_e( 'Cache Hit', 'litespeed-cache' ); ?></a>\n\t\t<a style=\"padding-right:10px;\" href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler&' . Router::TYPE . '=miss' ) ); ?>\"><?php esc_html_e( 'Cache Miss', 'litespeed-cache' ); ?></a>\n\t\t<a style=\"padding-right:10px;\" href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler&' . Router::TYPE . '=blacklisted' ) ); ?>\"><?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?></a>\n\t</div>\n\t<div>\n\t\t<?php echo wp_kses_post( $pagination ); ?>\n\t</div>\n</div>\n\n<div class=\"litespeed-table-responsive\">\n\t<table class=\"wp-list-table widefat striped\">\n\t\t<thead>\n\t\t\t<tr>\n\t\t\t\t<th scope=\"col\">#</th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'URL', 'litespeed-cache' ); ?></th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Crawler Status', 'litespeed-cache' ); ?></th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Operation', 'litespeed-cache' ); ?></th>\n\t\t\t</tr>\n\t\t</thead>\n\t\t<tbody>\n\t\t\t<?php foreach ( $list as $i => $v ) : ?>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><?php echo esc_html( $i + 1 ); ?></td>\n\t\t\t\t\t<td><?php echo esc_html( $v['url'] ); ?></td>\n\t\t\t\t\t<td><?php echo wp_kses_post( Crawler::cls()->display_status( $v['res'], $v['reason'] ) ); ?></td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_BLACKLIST_ADD, false, null, array( 'id' => $v['id'] ) ) ); ?>\" class=\"button button-secondary\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Add to Blocklist', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t<?php endforeach; ?>\n\t\t</tbody>\n\t</table>\n</div>\n\n<?php echo wp_kses_post( $pagination ); ?>\n\n<p>\n\t<i class=\"litespeed-dot litespeed-bg-success\"></i> = <?php esc_html_e( 'Cache Hit', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-primary\"></i> = <?php esc_html_e( 'Cache Miss', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-warning\"></i> = <?php esc_html_e( 'Blocklisted due to not cacheable', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-danger\"></i> = <?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><br>\n</p>\n",
    "plugins/litespeed-cache/tpl/db_optm/manage.tpl.php": "<?php\n/**\n * LiteSpeed Cache Database Optimization\n *\n * Manages database optimization options and displays table engine conversion tools.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$_panels = array(\n    'all' => array(\n        'title' => esc_html__( 'Clean All', 'litespeed-cache' ),\n        'desc'  => '',\n    ),\n    'revision' => array(\n        'title' => esc_html__( 'Post Revisions', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all post revisions', 'litespeed-cache' ),\n    ),\n    'orphaned_post_meta' => array(\n        'title' => esc_html__( 'Orphaned Post Meta', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all orphaned post meta records', 'litespeed-cache' ),\n    ),\n    'auto_draft' => array(\n        'title' => esc_html__( 'Auto Drafts', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all auto saved drafts', 'litespeed-cache' ),\n    ),\n    'trash_post' => array(\n        'title' => esc_html__( 'Trashed Posts', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all trashed posts and pages', 'litespeed-cache' ),\n    ),\n    'spam_comment' => array(\n        'title' => esc_html__( 'Spam Comments', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all spam comments', 'litespeed-cache' ),\n    ),\n    'trash_comment' => array(\n        'title' => esc_html__( 'Trashed Comments', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all trashed comments', 'litespeed-cache' ),\n    ),\n    'trackback-pingback' => array(\n        'title' => esc_html__( 'Trackbacks/Pingbacks', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all trackbacks and pingbacks', 'litespeed-cache' ),\n    ),\n    'expired_transient' => array(\n        'title' => esc_html__( 'Expired Transients', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean expired transient options', 'litespeed-cache' ),\n    ),\n    'all_transients' => array(\n        'title' => esc_html__( 'All Transients', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all transient options', 'litespeed-cache' ),\n    ),\n    'optimize_tables' => array(\n        'title' => esc_html__( 'Optimize Tables', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Optimize all tables in your database', 'litespeed-cache' ),\n    ),\n);\n\n$rev_max = $this->conf( Base::O_DB_OPTM_REVISIONS_MAX );\n$rev_age = $this->conf( Base::O_DB_OPTM_REVISIONS_AGE );\nif ( $rev_max || $rev_age ) {\n    $_panels['revision']['desc'] = sprintf(\n\t\tesc_html__( 'Clean revisions older than %1$s day(s), excluding %2$s latest revisions', 'litespeed-cache' ),\n\t\t'<strong>' . esc_html( $rev_age ) . '</strong>',\n\t\t'<strong>' . esc_html( $rev_max ) . '</strong>'\n\t);\n}\n\n$total = 0;\nforeach ( $_panels as $key => $v ) {\n    if ( 'all' !== $key ) {\n        $_panels[ $key ]['count'] = $this->cls( 'DB_Optm' )->db_count( $key );\n        if ( ! in_array( $key, array( 'optimize_tables' ), true ) ) {\n            $total += $_panels[ $key ]['count'];\n        }\n    }\n    $_panels[ $key ]['link'] = Utility::build_url( Router::ACTION_DB_OPTM, $key );\n}\n\n$_panels['all']['count'] = $total;\n\n$autoload_summary = DB_Optm::cls()->autoload_summary();\n\n?>\n\n<h3 class=\"litespeed-title\">\n    <?php esc_html_e( 'Database Optimizer', 'litespeed-cache' ); ?>\n    <?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/database/' ); ?>\n</h3>\n\n<div class=\"litespeed-panel-wrapper litespeed-cards-wrapper\">\n\n    <?php foreach ( $_panels as $key => $v ) : ?>\n        <a href=\"<?php echo esc_url( $v['link'] ); ?>\" class=\"litespeed-panel postbox\">\n            <section class=\"litespeed-panel-wrapper-icon\">\n                <span class=\"litespeed-panel-icon-<?php echo esc_attr( $key ); ?>\"></span>\n            </section>\n            <section class=\"litespeed-panel-content\">\n                <div class=\"litespeed-h3\">\n                    <?php echo esc_html( $v['title'] ); ?>\n                    <span class=\"litespeed-panel-counter<?php echo $v['count'] > 0 ? '-red' : ''; ?>\">(<?php echo esc_html( $v['count'] ); ?><?php echo DB_Optm::hide_more() ? '+' : ''; ?>)</span>\n                </div>\n                <span class=\"litespeed-panel-para\"><?php echo wp_kses_post( $v['desc'] ); ?></span>\n            </section>\n            <section class=\"litespeed-panel-wrapper-top-right\">\n                <span class=\"litespeed-panel-top-right-icon<?php echo $v['count'] > 0 ? '-cross' : '-tick'; ?>\"></span>\n            </section>\n        </a>\n    <?php endforeach; ?>\n\n</div>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Database Table Engine Converter', 'litespeed-cache' ); ?></h3>\n\n<div class=\"litespeed-panel-wrapper\">\n\n    <table class=\"wp-list-table widefat striped\">\n        <thead>\n            <tr>\n                <th scope=\"col\">#</th>\n                <th scope=\"col\"><?php esc_html_e( 'Table', 'litespeed-cache' ); ?></th>\n                <th scope=\"col\"><?php esc_html_e( 'Engine', 'litespeed-cache' ); ?></th>\n                <th scope=\"col\"><?php esc_html_e( 'Tool', 'litespeed-cache' ); ?></th>\n            </tr>\n        </thead>\n        <tbody>\n            <?php\n            $list = DB_Optm::cls()->list_myisam();\n            if ( ! empty( $list ) ) :\n                foreach ( $list as $k => $v ) :\n                    ?>\n                    <tr>\n                        <td><?php echo esc_html( $k + 1 ); ?></td>\n                        <td><?php echo esc_html( $v->table_name ); ?></td>\n                        <td><?php echo esc_html( $v->engine ); ?></td>\n                        <td>\n                            <a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_DB_OPTM, DB_Optm::TYPE_CONV_TB, false, false, array( 'tb' => $v->table_name ) ) ); ?>\">\n                                <?php esc_html_e( 'Convert to InnoDB', 'litespeed-cache' ); ?>\n                            </a>\n                        </td>\n                    </tr>\n                <?php endforeach; ?>\n            <?php else : ?>\n                <tr>\n                    <td colspan=\"4\" class=\"litespeed-success litespeed-text-center\">\n                        <?php esc_html_e( 'We are good. No table uses MyISAM engine.', 'litespeed-cache' ); ?>\n                    </td>\n                </tr>\n            <?php endif; ?>\n        </tbody>\n    </table>\n\n</div>\n\n<style type=\"text/css\">\n    .litespeed-body .field-col {\n        display: inline-block;\n        vertical-align: top;\n        margin-left: 20px;\n        margin-right: 20px;\n    }\n\n    .litespeed-body .field-col:first-child {\n        margin-left: 0;\n    }\n</style>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Database Summary', 'litespeed-cache' ); ?></h3>\n<div>\n    <div class=\"field-col\">\n        <p>\n        \t<?php esc_html_e( 'Autoload size', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( Utility::real_size( $autoload_summary->autoload_size ) ); ?></strong></p>\n        <p><?php esc_html_e( 'Autoload entries', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $autoload_summary->autload_entries ); ?></strong></p>\n    </div>\n\n    <div class=\"field-col\">\n        <p><?php esc_html_e( 'Autoload top list', 'litespeed-cache' ); ?>:</p>\n        <table class=\"wp-list-table widefat striped litespeed-width-auto litespeed-table-compact\">\n            <thead>\n                <tr>\n                    <th scope=\"col\">#</th>\n                    <th scope=\"col\"><?php esc_html_e( 'Option Name', 'litespeed-cache' ); ?></th>\n                    <th scope=\"col\"><?php esc_html_e( 'Autoload', 'litespeed-cache' ); ?></th>\n                    <th scope=\"col\"><?php esc_html_e( 'Size', 'litespeed-cache' ); ?></th>\n                </tr>\n            </thead>\n            <tbody>\n                <?php foreach ( $autoload_summary->autoload_toplist as $k => $v ) : ?>\n                    <tr>\n                        <td><?php echo esc_html( $k + 1 ); ?></td>\n                        <td><?php echo esc_html( $v->option_name ); ?></td>\n                        <td><?php echo esc_html( $v->autoload ); ?></td>\n                        <td><?php echo esc_html( $v->option_value_length ); ?></td>\n                    </tr>\n                <?php endforeach; ?>\n            </tbody>\n        </table>\n    </div>\n</div>",
    "plugins/litespeed-cache/tpl/db_optm/settings.tpl.php": "<?php\n/**\n * LiteSpeed Cache Database Optimization Settings\n *\n * Manages settings for database optimization in LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'DB Optimization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/database/#db-optimization-settings-tab' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_DB_OPTM_REVISIONS_MAX; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Specify the number of most recent revisions to keep when cleaning revisions.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 1, 100, true ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_DB_OPTM_REVISIONS_AGE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t</th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php esc_html_e( 'Day(s)', 'litespeed-cache' ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Revisions newer than this many days will be kept when cleaning revisions.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 1, 600, true ); ?>\n\t\t\t</div>\n\t\t</td>\n\t</tr>\n\n</tbody></table>\n\n<?php\n$this->form_end();\n?>",
    "plugins/litespeed-cache/tpl/db_optm/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache Database Optimization\n *\n * @package LiteSpeed\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n    'manage'   => esc_html__( 'Manage', 'litespeed-cache' ),\n);\n\nif ( ! is_network_admin() ) {\n    $menu_list['settings'] = esc_html__( 'DB Optimization Settings', 'litespeed-cache' );\n}\n\n?>\n\n<div class=\"wrap\">\n    <h1 class=\"litespeed-h1\">\n        <?php esc_html_e( 'LiteSpeed Cache Database Optimization', 'litespeed-cache' ); ?>\n    </h1>\n    <span class=\"litespeed-desc\">\n        <?php echo esc_html( 'v' . Core::VER ); ?>\n    </span>\n    <hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n    <h2 class=\"litespeed-header nav-tab-wrapper\">\n        <?php GUI::display_tab_list( $menu_list ); ?>\n    </h2>\n\n    <div class=\"litespeed-body\">\n    <?php\n        foreach ( $menu_list as $tab_key => $tab_val ) {\n\t\t\techo '<div data-litespeed-layout=\"' . esc_attr( $tab_key ) . '\">';\n\t\t\trequire LSCWP_DIR . 'tpl/db_optm/' . $tab_key . '.tpl.php';\n\t\t\techo '</div>';\n        }\n    ?>\n    </div>\n\n</div>",
    "plugins/litespeed-cache/tpl/cdn/other.tpl.php": "<?php\n/**\n * LiteSpeed Cache CDN Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$home_url = home_url( '/' );\n$parsed   = wp_parse_url( $home_url );\n$home_url = str_replace( $parsed['scheme'] . ':', '', $home_url );\n\n$cdn_mapping = $this->conf( Base::O_CDN_MAPPING );\n// Special handler: Append one row if somehow the DB default preset value got deleted\nif ( ! $cdn_mapping ) {\n\t$this->load_default_vals();\n\t$cdn_mapping = self::$_default_options[ Base::O_CDN_MAPPING ];\n}\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'CDN Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/cdn/' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Turn this setting %s if you are using a traditional Content Delivery Network (CDN) or a subdomain for static content with QUIC.cloud CDN.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/cdn/#use-cdn-mapping' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'NOTE: QUIC.cloud CDN and Cloudflare do not use CDN Mapping. If you are only using QUIC.cloud or Cloudflare, leave this setting %s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\"></th>\n\t\t\t<td>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_URL . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_INC_IMG . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_INC_CSS . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_INC_JS . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_FILETYPE . '][]' ); ?>\n\n\t\t\t\t<div id=\"litespeed_cdn_mapping_div\"></div>\n\n\t\t\t\t<script type=\"text/babel\">\n\t\t\t\t\tReactDOM.render(\n\t\t\t\t\t\t<CDNMapping list={ <?php echo wp_json_encode( $cdn_mapping ); ?> } />,\n\t\t\t\t\t\tdocument.getElementById( 'litespeed_cdn_mapping_div' )\n\t\t\t\t\t);\n\t\t\t\t</script>\n\n\t\t\t\t<div class=\"litespeed-warning\">\n\t\t\t\t\t<?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php esc_html_e( 'To randomize CDN hostname, define multiple hostnames for the same resources.', 'litespeed-cache' ); ?>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_INC_IMG ); ?></b>:\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Serve all image files through the CDN. This will affect all attachments, HTML %1$s tags, and CSS %2$s attributes.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>&lt;img</code>',\n\t\t\t\t\t\t'<code>url()</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_INC_CSS ); ?></b>:\n\t\t\t\t\t<?php esc_html_e( 'Serve all CSS files through the CDN. This will affect all enqueued WP CSS files.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_INC_JS ); ?></b>:\n\t\t\t\t\t<?php esc_html_e( 'Serve all JavaScript files through the CDN. This will affect all enqueued WP JavaScript files.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_FILETYPE ); ?></b>:\n\t\t\t\t\t<?php esc_html_e( 'Static file type links to be replaced by CDN links.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'This will affect all tags containing attributes: %s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>src=\"\"</code> <code>data-src=\"\"</code> <code>href=\"\"</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/cdn/#include-file-types', esc_html__( 'Default value', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'If you turn any of the above settings OFF, please remove the related file types from the %s box.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<b>' . esc_html__( 'Include File Types', 'litespeed-cache' ) . '</b>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/cdn/#include-file-types' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN_ATTR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify which HTML element attributes will be replaced with CDN Mapping.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Only attributes listed here will be replaced.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Use the format %1$s or %2$s (element is optional).', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>element.attribute</code>',\n\t\t\t\t\t\t'<code>.attribute</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_CDN_ORI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Site URL to be served through the CDN. Beginning with %1$s. For example, %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>//</code>',\n\t\t\t\t\t\t'<code>' . esc_html( $home_url ) . '</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Wildcard %1$s supported (match zero or more characters). For example, to match %2$s and %3$s, use %4$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>*</code>',\n\t\t\t\t\t\t'<code>//www.aa.com</code>',\n\t\t\t\t\t\t'<code>//aa.com</code>',\n\t\t\t\t\t\t'<code>//*aa.com</code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_CDN_ORI_DIR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Only files within these directories will be pointed to the CDN.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_CDN_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Paths containing these strings will not be served from the CDN.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<?php $this->form_end(); ?>",
    "plugins/litespeed-cache/tpl/cdn/qc.tpl.php": "<?php\n/**\n * LiteSpeed Cache QUIC.cloud CDN Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__cloud = Cloud::cls();\n$__cloud->finish_qc_activation( 'cdn' );\n$cloud_summary = Cloud::get_summary();\n?>\n\n<div class=\"litespeed-flex-container litespeed-column-with-boxes\">\n\t<div class=\"litespeed-width-7-10 litespeed-column-left litespeed-cdn-summary-wrapper\">\n\t\t<div class=\"litespeed-column-left-inside\">\n\t\t\t<h3>\n\t\t\t\t<?php if ( $__cloud->activated() ) : ?>\n\t\t\t\t\t<a class=\"button button-small litespeed-right litespeed-learn-more\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_SYNC_STATUS ) ); ?>\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span> <?php esc_html_e( 'Refresh Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t</a>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<span class=\"litespeed-quic-icon\"></span> <?php esc_html_e( 'QUIC.cloud CDN Status Overview', 'litespeed-cache' ); ?>\n\t\t\t</h3>\n\t\t\t<p class=\"litespeed-desc\"><?php esc_html_e( 'Check the status of your most important settings and the health of your CDN setup here.', 'litespeed-cache' ); ?></p>\n\n\t\t\t<?php if ( ! $__cloud->activated() ) : ?>\n\t\t\t\t<div class=\"litespeed-dashboard-unlock litespeed-dashboard-unlock--inline\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 class=\"litespeed-dashboard-unlock-title\"><strong class=\"litespeed-qc-text-gradient\"><?php esc_html_e( 'Accelerate, Optimize, Protect', 'litespeed-cache' ); ?></strong></h3>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-desc\">\n\t\t\t\t\t\t\t<?php echo wp_kses_post( __( 'Speed up your WordPress site even further with <strong>QUIC.cloud Online Services and CDN</strong>.', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p><?php esc_html_e( 'Free monthly quota available.', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'cdn' ) ) ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-yes\"></span><?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-footer\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'QUIC.cloud provides CDN and online optimization services, and is not required. You may use many features of this plugin without QUIC.cloud.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t\t\t<a href=\"https://www.quic.cloud/\" target=\"_blank\" rel=\"noopener\"><?php esc_html_e( 'Learn More about QUIC.cloud', 'litespeed-cache' ); ?></a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t<?php elseif ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t\t<?php if ( ! empty( $cloud_summary['qc_activated'] ) && 'linked' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t<p><?php echo wp_kses_post( __( 'QUIC.cloud CDN is currently <strong>fully disabled</strong>.', 'litespeed-cache' ) ); ?></p>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<p><?php echo wp_kses_post( __( 'QUIC.cloud CDN is <strong>not available</strong> for anonymous (unlinked) users.', 'litespeed-cache' ) ); ?></p>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$btn_title = esc_html__( 'Link & Enable QUIC.cloud CDN', 'litespeed-cache' );\n\t\t\t\t\t\tif ( ! empty( $cloud_summary['qc_activated'] ) && 'linked' === $cloud_summary['qc_activated'] ) {\n\t\t\t\t\t\t\t$btn_title = esc_html__( 'Enable QUIC.cloud CDN', 'litespeed-cache' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\tesc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ENABLE_CDN, false, null, array( 'ref' => 'cdn' ) ) ),\n\t\t\t\t\t\t\t'<span class=\"dashicons dashicons-yes\"></span>' . $btn_title,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t'button button-primary litespeed-button-cta'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t</p>\n\t\t\t\t\t<h3 class=\"litespeed-title-section\"><?php esc_html_e( 'Content Delivery Network Service', 'litespeed-cache' ); ?></h3>\n\t\t\t\t\t<p class=\"litespeed-text-md\">\n\t\t\t\t\t\t<?php esc_html_e( 'Serve your visitors fast', 'litespeed-cache' ); ?> <strong class=\"litespeed-qc-text-gradient\"><?php esc_html_e( 'no matter where they live.', 'litespeed-cache' ); ?></strong>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t/* translators: %s: Link tags */\n\t\t\t\t\t\t\tesc_html__( 'Best available WordPress performance, globally fast TTFB, easy setup, and %smore%s!', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<a href=\"https://www.quic.cloud/quic-cloud-services-and-features/litespeed-cache-service/\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t\t\t\t'</a>'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t<?php else : ?>\n\t\t\t\t<?php echo wp_kses_post( $__cloud->load_qc_status_for_dash( 'cdn_dash' ) ); ?>\n\t\t\t<?php endif; ?>\n\t\t</div>\n\t</div>\n\n\t<div class=\"litespeed-width-3-10 litespeed-column-right\">\n\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t<?php esc_html_e( 'QUIC.cloud CDN Options', 'litespeed-cache' ); ?>\n\t\t\t\t</h3>\n\t\t\t\t<?php if ( ! empty( $cloud_summary['partner'] ) && ! empty( $cloud_summary['partner']['disable_qc_login'] ) ) : ?>\n\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['logo'] ) ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\" rel=\"noopener\">\n\t\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php elseif ( ! empty( $cloud_summary['partner']['name'] ) ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\" rel=\"noopener\">\n\t\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?></span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?></span>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( ! $__cloud->activated() ) : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, go to your hosting provider\\'s portal.', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, please contact your hosting provider.', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<?php if ( ! $__cloud->activated() ) : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, go to QUIC.cloud Dashboard.', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"button button-primary disabled\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Link to QUIC.cloud', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php elseif ( 'anonymous' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'You are currently using services as an anonymous user. To manage your QUIC.cloud options, use the button below to create an account and link to the QUIC.cloud Dashboard.', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_LINK, false, null, array( 'ref' => 'cdn' ) ) ); ?>\" class=\"button button-<?php echo ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) ? 'secondary' : 'primary'; ?>\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Link to QUIC.cloud', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php elseif ( 'linked' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $__cloud->qc_link() ); ?>\" target=\"qc\" rel=\"noopener\" class=\"button button-<?php echo ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) ? 'secondary' : 'primary'; ?>\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'My QUIC.cloud Dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"></span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, go to QUIC.cloud Dashboard.', 'litespeed-cache' ); ?></p>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $__cloud->qc_link() ); ?>\" target=\"qc\" rel=\"noopener\" class=\"button button-<?php echo ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) ? 'secondary' : 'primary'; ?>\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'My QUIC.cloud Dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"></span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<?php $promo_mini = $__cloud->load_qc_status_for_dash( 'promo_mini' ); ?>\n\t\t<?php if ( $promo_mini ) : ?>\n\t\t\t<?php echo wp_kses_post( $promo_mini ); ?>\n\t\t<?php endif; ?>\n\t</div>\n</div>\n",
    "plugins/litespeed-cache/tpl/cdn/entry.tpl.php": "<?php\n/**\n * LiteSpeed Cache CDN Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'qc'    => esc_html__( 'QUIC.cloud', 'litespeed-cache' ),\n\t'cf'    => esc_html__( 'Cloudflare', 'litespeed-cache' ),\n\t'other' => esc_html__( 'Other Static CDN', 'litespeed-cache' ),\n);\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache CDN', 'litespeed-cache' ); ?>\n\t</h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t</span>\n\t<hr class=\"wp-header-end\">\n</div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t</h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php\n\t\tforeach ( $menu_list as $menu_key => $menu_value ) {\n\t\t\tprintf(\n\t\t\t\t'<div data-litespeed-layout=\"%s\">',\n\t\t\t\tesc_attr( $menu_key )\n\t\t\t);\n\t\t\trequire LSCWP_DIR . \"tpl/cdn/$menu_key.tpl.php\";\n\t\t\techo '</div>';\n\t\t}\n\t\t?>\n\t</div>\n</div>\n",
    "plugins/litespeed-cache/tpl/cdn/cf.tpl.php": "<?php\n/**\n * LiteSpeed Cache Cloudflare Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n */\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Cloudflare Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https://docs.litespeedtech.com/lscache/lscwp/cdn/' ); ?>\n</h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN_CLOUDFLARE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Use %s API functionality.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"litespeed-block\">\n\t\t\t\t\t<div class='litespeed-col'>\n\t\t\t\t\t\t<label class=\"litespeed-form-label\"><?php esc_html_e( 'Global API Key / API Token', 'litespeed-cache' ); ?></label>\n\t\t\t\t\t\t<?php $this->build_input( Base::O_CDN_CLOUDFLARE_KEY ); ?>\n\t\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'Your API key / token is used to access %s APIs.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'Get it from %s.', 'litespeed-cache' ), '<a href=\"https://dash.cloudflare.com/profile/api-tokens\" target=\"_blank\" rel=\"noopener\">Cloudflare</a>' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Recommended to generate the token from Cloudflare API token template \"WordPress\".', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='litespeed-col'>\n\t\t\t\t\t\t<label class=\"litespeed-form-label\"><?php esc_html_e( 'Email Address', 'litespeed-cache' ); ?></label>\n\t\t\t\t\t\t<?php $this->build_input( Base::O_CDN_CLOUDFLARE_EMAIL ); ?>\n\t\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'Your Email address on %s.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Optional when API token used.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='litespeed-col'>\n\t\t\t\t\t\t<label class=\"litespeed-form-label\"><?php esc_html_e( 'Domain', 'litespeed-cache' ); ?></label>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$cf_zone = $this->conf( Base::O_CDN_CLOUDFLARE_ZONE );\n\t\t\t\t\t\t$cls     = $cf_zone ? ' litespeed-input-success' : ' litespeed-input-warning';\n\t\t\t\t\t\t$this->build_input( Base::O_CDN_CLOUDFLARE_NAME, $cls );\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'You can just type part of the domain.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Once saved, it will be matched with the current list and completed automatically.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN_CLOUDFLARE_CLEAR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t</th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Clear %s cache when \"Purge All\" is run.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<?php\n$this->form_end();\n$cf_on     = $this->conf( Base::O_CDN_CLOUDFLARE );\n$cf_domain = $this->conf( Base::O_CDN_CLOUDFLARE_NAME );\n$cf_zone   = $this->conf( Base::O_CDN_CLOUDFLARE_ZONE );\nif ( ! $cf_domain ) {\n\t$cf_domain = '-';\n}\nif ( ! $cf_zone ) {\n\t$cf_zone = '-';\n}\n\n$curr_status = CDN\\Cloudflare::get_option( CDN\\Cloudflare::ITEM_STATUS, array() );\n?>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Cloudflare', 'litespeed-cache' ); ?></h3>\n\n<?php if ( ! $cf_on ) : ?>\n\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?></h4>\n\t\t<p>\n\t\t\t<?php esc_html_e( 'To enable the following functionality, turn ON Cloudflare API in CDN Settings.', 'litespeed-cache' ); ?>\n\t\t</p>\n\t</div>\n<?php endif; ?>\n\n<p><?php esc_html_e( 'Cloudflare Domain', 'litespeed-cache' ); ?>: <code><?php echo esc_textarea( $cf_domain ); ?></code></p>\n<p><?php esc_html_e( 'Cloudflare Zone', 'litespeed-cache' ); ?>: <code><?php echo esc_textarea( $cf_zone ); ?></code></p>\n\n<p>\n\t<b><?php esc_html_e( 'Development Mode', 'litespeed-cache' ); ?>:</b>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_SET_DEVMODE_ON ) ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Turn ON', 'litespeed-cache' ); ?>\n\t</a>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_SET_DEVMODE_OFF ) ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Turn OFF', 'litespeed-cache' ); ?>\n\t</a>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_GET_DEVMODE ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t<?php esc_html_e( 'Check Status', 'litespeed-cache' ); ?>\n\t</a>\n\n\t<?php if ( $curr_status ) : ?>\n\t\t<span class=\"litespeed-desc\">\n\t\t\t<?php\n\t\t\tif ( time() >= $curr_status['devmode_expired'] ) {\n\t\t\t\t$expired_at             = gmdate( 'm/d/Y H:i:s', $curr_status['devmode_expired'] + LITESPEED_TIME_OFFSET );\n\t\t\t\t$curr_status['devmode'] = 'OFF';\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Current status is %1$s since %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . esc_html( strtoupper( $curr_status['devmode'] ) ) . '</code>',\n\t\t\t\t\t'<code>' . esc_html( $expired_at ) . '</code>'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t$expired_at = $curr_status['devmode_expired'] - time();\n\t\t\t\t$expired_at = Utility::readable_time( $expired_at, 3600 * 3, true );\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Current status is %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . esc_html( strtoupper( $curr_status['devmode'] ) ) . '</code>'\n\t\t\t\t);\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Development mode will be automatically turned off in %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . esc_html( $expired_at ) . '</code>'\n\t\t\t\t);\n\t\t\t}\n\t\t\t?>\n\t\t</span>\n\t<?php endif; ?>\n\t<br>\n\t<?php esc_html_e( 'Temporarily bypass Cloudflare cache. This allows changes to the origin server to be seen in realtime.', 'litespeed-cache' ); ?>\n\t<br>\n\t<?php esc_html_e( 'Development Mode will be turned off automatically after three hours.', 'litespeed-cache' ); ?>\n\t<?php printf( esc_html__( '%1$sLearn More%2$s', 'litespeed-cache' ), '<a href=\"https://support.cloudflare.com/hc/en-us/articles/200168246\" target=\"_blank\" rel=\"noopener\">', '</a>' ); ?>\n</p>\n\n<p>\n\t<b><?php esc_html_e( 'Cloudflare Cache', 'litespeed-cache' ); ?>:</b>\n\t<?php if ( ! $cf_on ) : ?>\n\t\t<a href=\"#\" class=\"button button-secondary disabled\">\n\t<?php else : ?>\n\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_PURGE_ALL ) ); ?>\" class=\"button litespeed-btn-danger\">\n\t<?php endif; ?>\n\t\t<?php esc_html_e( 'Purge Everything', 'litespeed-cache' ); ?>\n\t</a>\n</p>",
    "plugins/litespeed-cache/composer.json": "{\n\t\"name\": \"litespeedtech/lscache_wp\",\n\t\"require-dev\": {\n\t\t\"squizlabs/php_codesniffer\": \"^3.12\",\n\t\t\"phpcompatibility/php-compatibility\": \"*\",\n\t\t\"wp-coding-standards/wpcs\": \"^3.1\",\n\t\t\"phpcsstandards/phpcsutils\": \"^1.0\",\n\t\t\"phpcsstandards/phpcsextra\": \"^1.2\",\n\t\t\"dealerdirect/phpcodesniffer-composer-installer\": \"^1.0\",\n\t\t\"php-stubs/wp-cli-stubs\": \"^2.12\"\n\t},\n\t\"prefer-stable\": true,\n\t\"scripts\": {\n\t\t\"sniff-check\": \"vendor/bin/phpcs --standard=phpcs.ruleset.xml --no-cache cli/ lib/ src/ tpl/ thirdparty autoload.php litespeed-cache.php\"\n\t},\n\t\"config\": {\n\t\t\"allow-plugins\": {\n\t\t\t\"dealerdirect/phpcodesniffer-composer-installer\": true\n\t\t}\n\t}\n}\n",
    "plugins/litespeed-cache/security.md": "# Security Policy\n\n## Reporting Security Bugs\n\nWe take security seriously. Please report potential vulnerabilities found in the LiteSpeed Cache plugin's source code via email to `support@litespeedtech.com` or open a ticket from your LiteSpeed Client Area.\n\nPlease see [Reporting Vulnerabilities](https://www.litespeedtech.com/report-security-bugs) for more information.\n",
    "mu-plugins/wtp-lang-hard-guard.php": "<?php\n/**\n * Plugin Name: WTP Lang Hard Guard (MU)\n * Description: Przywraca poprawne tablice języków, jeśli motyw je nadpisze lub wyczyści.\n */\nif (!defined('ABSPATH')) return;\n\nfunction wtp_lang_hard_guard_boot() {\n    global $WTP_LANGS, $WTP_LABELS, $WTP_LANG_KEYS;\n\n    if (!is_array($WTP_LANGS) || empty($WTP_LANGS)) {\n        $WTP_LANGS = [\n            'pl' => 'Polski',\n            'en' => 'English',\n            'es' => 'Español',\n            'pt' => 'Português',\n            'cs' => 'Čeština',\n            'sk' => 'Slovenčina',\n            'de' => 'Deutsch',\n            'fr' => 'Français',\n        ];\n    }\n    if (!is_array($WTP_LABELS) || empty($WTP_LABELS)) {\n        $WTP_LABELS = $WTP_LANGS;\n    }\n    if (!is_array($WTP_LANG_KEYS) || empty($WTP_LANG_KEYS)) {\n        $WTP_LANG_KEYS = array_keys($WTP_LANGS);\n    }\n}\nadd_action('after_setup_theme', 'wtp_lang_hard_guard_boot', 1);",
    "mu-plugins/wtp-ro-theme-bundle.php": "<?php\n/**\n * Plugin Name: WTP RO Theme Bundle (text/plain)\n * Description: Jeden endpoint zwracający cały snapshot (lub wycinek) jako text/plain dla analizy.\n * Version: 1.0.0\n */\nif (!defined('ABSPATH')) exit;\n\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-ro/v1', '/theme-bundle', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function () {\n            $site_key = '5Depft8Y9LU0t6Sv';\n            $base = WP_CONTENT_DIR . \"/uploads/wtp-ro/public/{$site_key}/\";\n\n            // Pliki snapshotu do zwrócenia (pełny zestaw). Możesz skrócić do manifest+bundle+files_000..016.\n            $files = ['manifest.json','index.json','bundle.json'];\n            for ($i = 0; $i <= 16; $i++) {\n                $files[] = sprintf('files_%03d.json', $i);\n            }\n\n            // Zbierz zawartość do jednego JSON-a (klucz=plik, wartość=treść).\n            $out = [];\n            foreach ($files as $f) {\n                $path = $base . $f;\n                $realBase = realpath($base);\n                $realPath = realpath($path);\n                if (!$realBase || !$realPath || strpos($realPath, $realBase) !== 0 || !is_file($realPath)) {\n                    continue;\n                }\n                $data = @file_get_contents($realPath);\n                if ($data !== false) {\n                    // trzymamy oryginalny tekst pliku jako string\n                    $out[$f] = $data;\n                }\n            }\n\n            header('Content-Type: text/plain; charset=UTF-8');\n            header('Cache-Control: public, max-age=60');\n            header('Access-Control-Allow-Origin: *');\n            header('Access-Control-Allow-Methods: GET, OPTIONS');\n\n            // Jedna odpowiedź z całą paczką:\n            return new WP_REST_Response(\n                wp_json_encode($out, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE),\n                200\n            );\n        }\n    ]);\n});",
    "mu-plugins/wtp-patcher-plugins.php": "<?php\n/**\n * Plugin Name: WTP Patcher — Plugins (from chunked index)\n * Description: Patchuje wszystkie (lub wybrane) wtyczki z GitHuba na podstawie plugins-index.json + chunków.\n * Version: 1.0.0\n */\nif (!defined('ABSPATH')) exit;\n\n/**\n * WYMAGANE w wp-config.php (jak przy eksporcie):\n * define('WTP_GH_OWNER',  'BoskiDionysos');\n * define('WTP_GH_REPO',   'weektoppick-wp-modules');\n * define('WTP_GH_BRANCH', 'main'); // opcjonalnie (domyślnie main)\n * define('WTP_GH_SECRET', '...');  // ten sam sekret co przy eksporcie\n */\n\nadd_action('rest_api_init', function () {\n\n    // Wariant z parametrami: /wp-json/wtp-ro/v1/patch-plugins?key=...&index=...&dry=0&only=slug1,slug2\n    register_rest_route('wtp-ro/v1', '/patch-plugins', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if (!wtp_pp_auth_ok($req)) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            $indexUrl = trim((string)$req->get_param('index'));\n            if ($indexUrl === '') {\n                // domyślny index z GH raw\n                $owner  = defined('WTP_GH_OWNER')  ? constant('WTP_GH_OWNER')  : '';\n                $repo   = defined('WTP_GH_REPO')   ? constant('WTP_GH_REPO')   : '';\n                $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n                if (!$owner || !$repo) {\n                    return new WP_REST_Response(['ok'=>false,'error'=>'missing-index-and-defaults'], 400);\n                }\n                $indexUrl = \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/plugins-index.json\";\n            }\n\n            $dry  = (string)$req->get_param('dry') === '1' || (string)$req->get_param('dry') === 'true';\n            $only = array_filter(array_map('trim', explode(',', (string)$req->get_param('only'))));\n\n            $result = wtp_pp_apply_from_index($indexUrl, $dry, $only);\n            $code   = ($result['ok'] ?? false) ? 200 : 500;\n            return new WP_REST_Response($result, $code);\n        }\n    ]);\n\n    // Krótszy wariant: /wp-json/wtp-ro/v1/patch/plugins/<secret>?index=...&dry=0&only=...\n    register_rest_route('wtp-ro/v1', '/patch/plugins/(?P<secret>[^/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            $sec = (string)$req->get_param('secret');\n            if (!defined('WTP_GH_SECRET') || $sec !== constant('WTP_GH_SECRET')) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            $indexUrl = trim((string)$req->get_param('index'));\n            if ($indexUrl === '') {\n                $owner  = defined('WTP_GH_OWNER')  ? constant('WTP_GH_OWNER')  : '';\n                $repo   = defined('WTP_GH_REPO')   ? constant('WTP_GH_REPO')   : '';\n                $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n                if (!$owner || !$repo) {\n                    return new WP_REST_Response(['ok'=>false,'error'=>'missing-index-and-defaults'], 400);\n                }\n                $indexUrl = \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/plugins-index.json\";\n            }\n            $dry  = (string)$req->get_param('dry') === '1' || (string)$req->get_param('dry') === 'true';\n            $only = array_filter(array_map('trim', explode(',', (string)$req->get_param('only'))));\n\n            $result = wtp_pp_apply_from_index($indexUrl, $dry, $only);\n            $code   = ($result['ok'] ?? false) ? 200 : 500;\n            return new WP_REST_Response($result, $code);\n        }\n    ]);\n});\n\n/** Autoryzacja: ?key=… lub nagłówki */\nfunction wtp_pp_auth_ok(WP_REST_Request $req) {\n    if (!defined('WTP_GH_SECRET')) return false;\n    $want = constant('WTP_GH_SECRET');\n\n    $key = $req->get_param('key');\n    if (is_string($key) && hash_equals($want, $key)) return true;\n\n    $hdr = $req->get_header('X-WTP-Secret');\n    if (is_string($hdr) && hash_equals($want, $hdr)) return true;\n\n    $auth = $req->get_header('Authorization');\n    if (is_string($auth) && stripos($auth, 'Bearer ') === 0) {\n        $b = trim(substr($auth, 7));\n        if (hash_equals($want, $b)) return true;\n    }\n    return false;\n}\n\n/**\n * Główna logika: pobiera index, pobiera wszystkie chunki, scala mapę i zapisuje pliki.\n *\n * @param string $indexUrl URL do plugins-index.json\n * @param bool   $dry      true = symulacja\n * @param array  $onlySlugs lista slugów (opcjonalnie), np. ['akismet','classic-editor']\n */\nfunction wtp_pp_apply_from_index($indexUrl, $dry=false, array $onlySlugs=[]) {\n    $resp = [\n        'ok'        => false,\n        'index'     => $indexUrl,\n        'dry_run'   => (bool)$dry,\n        'only'      => $onlySlugs,\n        'created'   => [],\n        'updated'   => [],\n        'skipped'   => [],\n        'errors'    => [],\n        'chunks'    => [],\n    ];\n\n    $index = wtp_pp_http_get_json($indexUrl);\n    if (!is_array($index) || empty($index['chunks']) || !is_array($index['chunks'])) {\n        $resp['errors'][] = 'bad-index';\n        return $resp;\n    }\n\n    // Zbierz wszystkie chunki do jednej mapy\n    $bundle = []; // \"plugins/... => content\" albo \"mu-plugins/... => content\"\n    foreach ($index['chunks'] as $row) {\n        $url = $row['raw'] ?? $row['url'] ?? null;\n        if (!$url) continue;\n        $resp['chunks'][] = $url;\n\n        $part = wtp_pp_http_get_json($url);\n        if (!is_array($part)) {\n            $resp['errors'][] = 'bad-chunk: '.$url;\n            continue;\n        }\n        // merge, chunki mają unikalne klucze\n        foreach ($part as $k => $v) {\n            $bundle[$k] = $v;\n        }\n    }\n    if (!$bundle) {\n        $resp['errors'][] = 'empty-bundle';\n        return $resp;\n    }\n\n    // Filtr ONLY (po slugu wtyczki dla prefixu \"plugins/\")\n    $onlySlugs = array_map('strtolower', $onlySlugs);\n    if ($onlySlugs) {\n        $bundle = array_filter($bundle, function($v, $k) use ($onlySlugs) {\n            if (strpos($k, 'plugins/') === 0) {\n                // plugins/<slug>/...\n                $rest = substr($k, 8);\n                $slug = strtolower(strtok($rest, '/'));\n                return in_array($slug, $onlySlugs, true);\n            }\n            if (strpos($k, 'mu-plugins/') === 0) {\n                $rest = substr($k, 11);\n                $slug = strtolower(strtok($rest, '/'));\n                return in_array($slug, $onlySlugs, true);\n            }\n            return false;\n        }, ARRAY_FILTER_USE_BOTH);\n        if (!$bundle) {\n            $resp['errors'][] = 'only-filter-empty';\n            return $resp;\n        }\n    }\n\n    // Zapis na dysk\n    foreach ($bundle as $key => $content) {\n        if (!is_string($content)) $content = (string)$content;\n\n        if (strpos($key, 'plugins/') === 0) {\n            $base = wp_normalize_path(WP_PLUGIN_DIR);\n            $rel  = substr($key, 8); // bez \"plugins/\"\n        } elseif (strpos($key, 'mu-plugins/') === 0) {\n            $base = wp_normalize_path(WPMU_PLUGIN_DIR);\n            $rel  = substr($key, 11); // bez \"mu-plugins/\"\n        } else {\n            $resp['skipped'][] = $key;\n            continue;\n        }\n\n        $target = $base . '/' . $rel;\n        $target = wp_normalize_path($target);\n        $dir    = dirname($target);\n\n        if ($dry) {\n            if (file_exists($target)) $resp['updated'][] = $key;\n            else                      $resp['created'][] = $key;\n            continue;\n        }\n\n        if (!is_dir($dir)) {\n            if (!wp_mkdir_p($dir)) {\n                $resp['errors'][] = 'mkdir-failed: '.$dir;\n                continue;\n            }\n        }\n\n        $exists = file_exists($target);\n        $ok     = @file_put_contents($target, $content);\n        if ($ok === false) {\n            $resp['errors'][] = 'write-failed: '.$target;\n            continue;\n        }\n        if ($exists) $resp['updated'][] = $key;\n        else         $resp['created'][] = $key;\n    }\n\n    $resp['ok'] = empty($resp['errors']);\n    return $resp;\n}\n\n/** GET JSON helper (bez zewn. bibliotek) */\nfunction wtp_pp_http_get_json($url) {\n    $args = [\n        'method'  => 'GET',\n        'timeout' => 25,\n        'headers' => ['Accept' => 'application/json'],\n    ];\n    $res  = wp_remote_request($url, $args);\n    if (is_wp_error($res)) return null;\n    $code = wp_remote_retrieve_response_code($res);\n    if ($code < 200 || $code >= 300) return null;\n    $body = wp_remote_retrieve_body($res);\n    $json = json_decode($body, true);\n    return is_array($json) ? $json : null;\n}",
    "mu-plugins/wtp-patcher-theme.php": "<?php\n/**\n * Plugin Name: WTP Patcher — Theme (GitHub → WP)\n * Description: Pobiera theme-bundle.json z GitHuba i zapisuje pliki do aktywnego motywu (z backupem .bak). Endpoint: /wp-json/wtp-ro/v1/patch-theme?key=SECRET\n * Version: 1.0.0\n */\nif (!defined('ABSPATH')) exit;\n\n/**\n * WYMAGANE:\n *   define('WTP_GH_SECRET', 'twoj_bardzo_tajny_sekret'); // w wp-config.php (JUŻ masz)\n *\n * OPCJONALNE (możesz zostawić domyślne):\n *   define('WTP_PATCH_THEME_URL', 'https://raw.githubusercontent.com/BoskiDionysos/weektoppick-wp-modules/main/theme-bundle.json');\n */\n\nif (!defined('WTP_PATCH_THEME_URL')) {\n    define('WTP_PATCH_THEME_URL', 'https://raw.githubusercontent.com/BoskiDionysos/weektoppick-wp-modules/main/theme-bundle.json');\n}\n\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-ro/v1', '/patch-theme', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true', // publiczny, ale sprawdzamy SECRET niżej\n        'callback' => 'wtp_patch_theme_run',\n        'args'     => [\n            'key'  => ['type'=>'string','required'=>false],\n            'url'  => ['type'=>'string','required'=>false], // opcjonalny override URL\n            'dry'  => ['type'=>'boolean','required'=>false], // podgląd bez zapisu\n        ],\n    ]);\n});\n\nfunction wtp_patch_theme_run(WP_REST_Request $req) {\n    // --- auth przez sekret ---\n    if (!defined('WTP_GH_SECRET')) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'missing-secret'], 403);\n    }\n    $key = (string)$req->get_param('key');\n    if ($key === '' || !hash_equals(WTP_GH_SECRET, $key)) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n    }\n\n    // --- ustal źródło bundle ---\n    $url = (string)($req->get_param('url') ?: WTP_PATCH_THEME_URL);\n\n    // pobierz JSON\n    $res = wp_remote_get($url, [\n        'timeout' => 30,\n        'headers' => [\n            'Accept'     => 'application/json',\n            'User-Agent' => 'WTP-Patcher/1.0',\n        ],\n    ]);\n    $code = wp_remote_retrieve_response_code($res);\n    if ($code !== 200) {\n        return new WP_REST_Response(['ok'=>false,'error'=>\"fetch-failed:$code\"], 500);\n    }\n    $body = wp_remote_retrieve_body($res);\n    $bundle = json_decode($body, true);\n    if (!is_array($bundle)) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'invalid-json'], 500);\n    }\n\n    // --- katalog motywu ---\n    $theme_dir = wp_normalize_path(get_stylesheet_directory());\n    if (!$theme_dir || !is_dir($theme_dir) || !is_writable($theme_dir)) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'theme-dir-not-writable'], 500);\n    }\n\n    $dry = filter_var($req->get_param('dry'), FILTER_VALIDATE_BOOLEAN);\n\n    $updated = [];\n    $created = [];\n    $skipped = [];\n    $errors  = [];\n\n    foreach ($bundle as $keyPath => $content) {\n        // Oczekujemy kluczy typu \"theme/rel/plik.php\"\n        if (strpos($keyPath, 'theme/') !== 0) {\n            $skipped[] = $keyPath;\n            continue;\n        }\n        $rel = substr($keyPath, strlen('theme/')); // relatywnie do motywu\n\n        // sanity path: bez ../, bez początkowego slasha\n        if ($rel === '' || strpos($rel, '..') !== false || $rel[0] === '/') {\n            $errors[] = ['file'=>$keyPath,'error'=>'bad-relpath'];\n            continue;\n        }\n\n        $target = wp_normalize_path($theme_dir . '/' . $rel);\n        // dopuszczalne rozszerzenia — lekkie sito\n        $ext = strtolower(pathinfo($target, PATHINFO_EXTENSION));\n        if (!in_array($ext, ['php','css','js','json','svg','txt','md','html','po','mo'], true)) {\n            $skipped[] = $keyPath;\n            continue;\n        }\n\n        // utwórz katalog\n        $dir = dirname($target);\n        if (!is_dir($dir)) {\n            if (!$dry) {\n                if (!wp_mkdir_p($dir)) {\n                    $errors[] = ['file'=>$keyPath,'error'=>'mkdir-failed'];\n                    continue;\n                }\n            }\n        }\n\n        $exists = file_exists($target);\n        if (!$dry) {\n            // zrób backup .bak (tylko jeżeli istniał)\n            if ($exists) {\n                $bak = $target . '.bak';\n                // żeby nie nadpisywać istniejącego .bak, dopisz timestamp\n                if (file_exists($bak)) {\n                    $bak = $target . '.' . date('Ymd_His') . '.bak';\n                }\n                if (!@copy($target, $bak)) {\n                    $errors[] = ['file'=>$keyPath,'error'=>'backup-failed'];\n                    continue;\n                }\n            }\n            // zapisz nową treść\n            $ok = @file_put_contents($target, $content);\n            if ($ok === false) {\n                $errors[] = ['file'=>$keyPath,'error'=>'write-failed'];\n                continue;\n            }\n        }\n\n        if ($exists) { $updated[] = $rel; } else { $created[] = $rel; }\n    }\n\n    $ok = empty($errors);\n    return new WP_REST_Response([\n        'ok'       => $ok,\n        'dry_run'  => (bool)$dry,\n        'source'   => $url,\n        'theme'    => basename($theme_dir),\n        'created'  => $created,\n        'updated'  => $updated,\n        'skipped'  => $skipped,\n        'errors'   => $errors\n    ], $ok ? 200 : 500);\n}",
    "mu-plugins/wtp-dev-bridge.php": "<?php\n/**\n * Plugin Name: WTP Dev Bridge — GitHub Export + Patcher (all-in-one)\n * Description: Eksport motywu i wtyczek do GitHub (z chunkowaniem) + patch motywu z theme-bundle.json (RAW). Bez kolizji stałych.\n * Version: 4.0.0\n */\nif (!defined('ABSPATH')) exit;\n\n// ─────────────────────────────────────────────────────────────\n// GLOBAL GUARD: ładuj tylko raz (eliminuje duplikaty w logach)\n// ─────────────────────────────────────────────────────────────\nif (defined('WTP_DEV_BRIDGE_LOADED')) return;\ndefine('WTP_DEV_BRIDGE_LOADED', true);\n\n// ─────────────────────────────────────────────────────────────\n// WYMAGANE W wp-config.php  (NIE definiujemy tu!)\n// ─  define('WTP_GH_OWNER',  'BoskiDionysos');\n// ─  define('WTP_GH_REPO',   'weektoppick-wp-modules');\n// ─  define('WTP_GH_BRANCH', 'main');               // opcjonalnie\n// ─  define('WTP_GH_TOKEN',  'ghp_xxx');            // repo:contents write\n// ─  define('WTP_GH_SECRET', 'super_tajny_sekret'); // do REST\n// ─────────────────────────────────────────────────────────────\n$__need = ['WTP_GH_OWNER','WTP_GH_REPO','WTP_GH_TOKEN','WTP_GH_SECRET'];\nforeach ($__need as $__c) { if (!defined($__c)) { error_log(\"[WTP Bridge] Missing constant $__c\"); return; } }\n\n// ============================================================================\n// KLASA – cała logika w środku (brak globalnych const → brak kolizji)\n// ============================================================================\nif (!class_exists('WTP_Dev_Bridge')):\n\nfinal class WTP_Dev_Bridge {\n\n    // Konfiguracja (trzymamy w właściwościach – nie ma redefinicji)\n    private static array $allowedExt     = ['php','css','js','json','svg','txt','md','html','po','mo'];\n    private static string $excludeRx     = '#(?:^|/)(node_modules|vendor|\\.git|\\.svn|\\.github|tests?|bin|dist|cache)(/|$)#i';\n    private static string $excludeFileRx = '#\\.(map|lock|min\\.map|ico|woff2?|ttf|eot)$#i';\n    private static int    $chunkTarget   = 4_500_000; // ~4.5 MB (poniżej 5 MB limitów)\n    private static string $themeTarget   = 'theme-bundle.json';\n    private static string $pluginsTarget = 'plugins-bundle.json';\n    private static string $pluginsIndex  = 'plugins-index.json';\n    private static string $chunkBase     = 'plugins-bundle';\n\n    // ─────────────────────────────────────────────────────────\n    // ROUTES\n    // ─────────────────────────────────────────────────────────\n    public static function boot() : void {\n        add_action('rest_api_init', [__CLASS__, 'register_routes']);\n    }\n\n    public static function register_routes() : void {\n\n        // publish/theme/{secret}\n        register_rest_route('wtp-ro/v1', '/publish/theme/(?P<secret>[^/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n                $bundle = self::collect_theme();\n                if (!$bundle) return self::err(500,'empty-theme');\n                $res = self::push_to_github($bundle, self::$themeTarget, 'Update theme-bundle.json (publish)');\n                return self::answer($res);\n            }\n        ]);\n\n        // publish/plugins/{secret}\n        register_rest_route('wtp-ro/v1', '/publish/plugins/(?P<secret>[^/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n                $bundle = self::collect_plugins_full();\n                if (!$bundle) return self::err(500,'empty-plugins');\n                $res = self::push_to_github($bundle, self::$pluginsTarget, 'Update plugins-bundle.json (publish)');\n                return self::answer($res);\n            }\n        ]);\n\n        // publish/all/{secret}\n        register_rest_route('wtp-ro/v1', '/publish/all/(?P<secret>[^/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n\n                $out = [];\n\n                $theme = self::collect_theme();\n                if ($theme) {\n                    $r1 = self::push_to_github($theme, self::$themeTarget, 'Update theme-bundle.json (publish-all)');\n                    $out['theme'] = self::res_map($r1);\n                } else $out['theme'] = ['ok'=>false,'error'=>'empty-theme'];\n\n                $plugins = self::collect_plugins_full();\n                if ($plugins) {\n                    $r2 = self::push_to_github($plugins, self::$pluginsTarget, 'Update plugins-bundle.json (publish-all)');\n                    $out['plugins'] = self::res_map($r2);\n                } else $out['plugins'] = ['ok'=>false,'error'=>'empty-plugins'];\n\n                $ok = ($out['theme']['ok']??false) || ($out['plugins']['ok']??false);\n                return new \\WP_REST_Response(['ok'=>$ok]+$out, $ok?200:500);\n            }\n        ]);\n\n        // publish/plugins-chunked/{secret}\n        register_rest_route('wtp-ro/v1', '/publish/plugins-chunked/(?P<secret>[^/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n                $bundle = self::collect_plugins_full();\n                if (!$bundle) return self::err(500,'empty-plugins');\n\n                $chunks = self::chunk_map($bundle, self::$chunkTarget);\n                if (!$chunks) return self::err(500,'chunking-failed');\n\n                $push = self::push_chunks_and_index($chunks);\n                if (is_wp_error($push)) return self::err(500, $push->get_error_message());\n                return new \\WP_REST_Response(['ok'=>true]+$push, 200);\n            }\n        ]);\n\n        // patch/theme?key=SECRET&url=RAW_JSON&dry=0|1\n        register_rest_route('wtp-ro/v1', '/patch/theme', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                $key = (string)$req->get_param('key');\n                if (!$key || $key !== constant('WTP_GH_SECRET')) return self::err(403,'forbidden');\n\n                $url = trim((string)$req->get_param('url'));\n                if ($url === '') return self::err(400,'missing-url');\n\n                $dry = (string)$req->get_param('dry');\n                $dry = ($dry === '1' || strtolower($dry) === 'true' || $dry === 'on') ? true : false;\n\n                $json = self::http('GET', $url, null, null, 25);\n                if ($json['code'] !== 200 || !is_array($json['body_raw'])) {\n                    return self::err(502, 'fetch-failed');\n                }\n                $map = $json['body_raw']; // mapa \"theme/relpath\" => content\n\n                $themeDir = wp_normalize_path(get_stylesheet_directory());\n                $updated = []; $created = []; $skipped = []; $errors = [];\n\n                foreach ($map as $k => $v) {\n                    if (strpos($k, 'theme/') !== 0) { $skipped[] = $k; continue; }\n                    $rel = ltrim(substr($k, 6), '/'); // po \"theme/\"\n                    if ($rel === '') { $skipped[] = $k; continue; }\n\n                    $target = $themeDir . '/' . $rel;\n                    $dir = dirname($target);\n                    if (!is_dir($dir)) {\n                        if (!$dry) @wp_mkdir_p($dir);\n                        if (!is_dir($dir)) { $errors[] = $rel; continue; }\n                    }\n                    $exists = file_exists($target);\n                    if (!$dry) {\n                        $ok = @file_put_contents($target, $v);\n                        if ($ok === false) { $errors[] = $rel; continue; }\n                    }\n                    if ($exists) $updated[] = $rel; else $created[] = $rel;\n                }\n\n                return new \\WP_REST_Response([\n                    'ok'      => empty($errors),\n                    'dry_run' => $dry,\n                    'source'  => $url,\n                    'theme'   => basename($themeDir),\n                    'created' => $created,\n                    'updated' => $updated,\n                    'skipped' => $skipped,\n                    'errors'  => $errors,\n                ], empty($errors) ? 200 : 500);\n            }\n        ]);\n\n        // proste: ping/selftest (bez sekretu)\n        register_rest_route('wtp-ro/v1', '/ping', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => fn() => new \\WP_REST_Response(['ok'=>true,'ts'=>time()], 200)\n        ]);\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // AUTH helpers\n    // ─────────────────────────────────────────────────────────\n    private static function auth_secret_path(\\WP_REST_Request $req) : bool {\n        $sec = (string)$req->get_param('secret');\n        return ($sec !== '' && $sec === constant('WTP_GH_SECRET'));\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // COLLECTORS\n    // ─────────────────────────────────────────────────────────\n    private static function collect_theme() : array {\n        $base = wp_normalize_path( get_stylesheet_directory() );\n        return self::collect_from_base($base, 'theme');\n    }\n\n    private static function collect_plugins_full() : array {\n        $out = [];\n        $plugins = wp_normalize_path( WP_PLUGIN_DIR );\n        if (is_dir($plugins)) $out += self::collect_from_base($plugins, 'plugins');\n\n        $mu = wp_normalize_path( WPMU_PLUGIN_DIR );\n        if (is_dir($mu) && $mu !== $plugins) $out += self::collect_from_base($mu, 'mu-plugins');\n\n        return $out;\n    }\n\n    private static function collect_from_base(string $base, string $prefix) : array {\n        $rii = new \\RecursiveIteratorIterator(new \\RecursiveDirectoryIterator($base, \\FilesystemIterator::SKIP_DOTS));\n        $out = [];\n        foreach ($rii as $spl) {\n            /** @var \\SplFileInfo $spl */\n            if (!$spl->isFile()) continue;\n\n            $path = wp_normalize_path($spl->getPathname());\n            $rel  = ltrim(str_replace($base, '', $path), '/');\n\n            if (preg_match(self::$excludeRx, $rel))     continue;\n            if (preg_match(self::$excludeFileRx, $rel)) continue;\n\n            $ext = strtolower(pathinfo($rel, PATHINFO_EXTENSION));\n            if (!in_array($ext, self::$allowedExt, true)) continue;\n\n            $content = @file_get_contents($path);\n            if ($content === false) continue;\n\n            $key = trim($prefix,'/').'/'.$rel;\n            $out[$key] = $content;\n        }\n        return $out;\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // CHUNKING\n    // ─────────────────────────────────────────────────────────\n    private static function chunk_map(array $map, int $targetBytes) : array {\n        $chunks = []; $current = []; $approx = 2; // {}\n        foreach ($map as $k => $v) {\n            $entry = [$k => $v];\n            $ej = json_encode($entry, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE);\n            $sz = strlen($ej) + 1;\n            if ($approx + $sz > $targetBytes && !empty($current)) {\n                $chunks[] = $current; $current = []; $approx = 2;\n            }\n            $current[$k] = $v; $approx += $sz;\n        }\n        if (!empty($current)) $chunks[] = $current;\n        return $chunks;\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // GITHUB PUSH (single file)\n    // ─────────────────────────────────────────────────────────\n    private static function push_to_github(array $bundle, string $target, string $msg) {\n        if (empty($bundle)) return new \\WP_Error('wtp_empty','Empty bundle');\n        $payload = json_encode($bundle, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE);\n        if ($payload === false) return new \\WP_Error('wtp_json','json_encode failed');\n\n        $owner  = constant('WTP_GH_OWNER');\n        $repo   = constant('WTP_GH_REPO');\n        $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n        $token  = constant('WTP_GH_TOKEN');\n\n        $api  = \"https://api.github.com/repos/{$owner}/{$repo}/contents/{$target}\";\n        $sha  = null;\n        $get  = self::http('GET', $api.'?ref='.rawurlencode($branch), $token, null, 25);\n        if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n        $body = ['message'=>$msg,'content'=>base64_encode($payload),'branch'=>$branch];\n        if ($sha) $body['sha'] = $sha;\n\n        $put = self::http('PUT', $api, $token, $body, 30);\n        if ($put['code'] >= 300) {\n            return new \\WP_Error('wtp_github_put', 'GitHub PUT error '.$put['code'].': '.json_encode($put['body']));\n        }\n\n        $raw = \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/{$target}\";\n        return ['raw_url'=>$raw,'commit'=>$put['body']['commit']['sha'] ?? null];\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // GITHUB PUSH (chunks + index)\n    // ─────────────────────────────────────────────────────────\n    private static function push_chunks_and_index(array $chunks) {\n        $owner  = constant('WTP_GH_OWNER');\n        $repo   = constant('WTP_GH_REPO');\n        $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n        $token  = constant('WTP_GH_TOKEN');\n\n        $pushed = [];\n        foreach ($chunks as $i => $map) {\n            $payload = json_encode($map, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE);\n            $path    = sprintf('%s_%03d.json', self::$chunkBase, $i);\n            $res     = self::gh_put_file($owner,$repo,$branch,$token,$path,$payload,'Update '.$path.' (chunk)');\n            if ($res['code'] >= 300) {\n                return new \\WP_Error('wtp_github_put', 'GitHub PUT error '.$res['code'].': '.json_encode($res['body']));\n            }\n            $pushed[] = [\n                'path' => $path,\n                'size' => strlen($payload),\n                'sha1' => sha1($payload),\n                'raw'  => \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/{$path}\",\n            ];\n        }\n\n        $index = [\n            'version'       => 1,\n            'generated_at'  => time(),\n            'total_chunks'  => count($pushed),\n            'chunks'        => $pushed,\n        ];\n        $idxPayload = json_encode($index, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT);\n        $idxRes     = self::gh_put_file($owner,$repo,$branch,$token,self::$pluginsIndex,$idxPayload,'Update '.self::$pluginsIndex.' (index)');\n        if ($idxRes['code'] >= 300) {\n            return new \\WP_Error('wtp_github_put', 'GitHub PUT index error '.$idxRes['code'].': '.json_encode($idxRes['body']));\n        }\n\n        return [\n            'index_raw_url' => \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/\".self::$pluginsIndex,\n            'chunks'        => $pushed,\n        ];\n    }\n\n    private static function gh_put_file($owner,$repo,$branch,$token,$path,$content,$message) {\n        $api = \"https://api.github.com/repos/{$owner}/{$repo}/contents/{$path}\";\n        $sha = null;\n        $get = self::http('GET', $api.'?ref='.rawurlencode($branch), $token, null, 25);\n        if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n        $body = ['message'=>$message,'content'=>base64_encode($content),'branch'=>$branch];\n        if ($sha) $body['sha'] = $sha;\n        return self::http('PUT', $api, $token, $body, 30);\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // HTTP helper (WP)\n    // ─────────────────────────────────────────────────────────\n    private static function http(string $method, string $url, ?string $token, $json, int $timeout = 20) : array {\n        $args = [\n            'method'  => $method,\n            'headers' => [\n                'User-Agent' => 'WTP-Dev-Bridge',\n                'Accept'     => 'application/json',\n            ],\n            'timeout' => $timeout,\n        ];\n        if ($token) $args['headers']['Authorization'] = 'token '.$token;\n        if ($json !== null) {\n            $args['headers']['Content-Type'] = 'application/json';\n            $args['body'] = is_string($json) ? $json : json_encode($json);\n        }\n        $res  = wp_remote_request($url, $args);\n        $code = wp_remote_retrieve_response_code($res);\n        $body = wp_remote_retrieve_body($res);\n\n        // spróbuj JSON; jeśli nie wychodzi – zwróć raw\n        $decoded = json_decode($body, true);\n        return [\n            'code'     => $code,\n            'body'     => is_array($decoded) ? $decoded : null,\n            'body_raw' => is_array($decoded) ? $decoded : null,\n            'text'     => is_array($decoded) ? null : $body,\n        ];\n    }\n\n    // ─────────────────────────────────────────────────────────\n    // Response helpers\n    // ─────────────────────────────────────────────────────────\n    private static function err(int $code, string $msg) {\n        return new \\WP_REST_Response(['ok'=>false,'error'=>$msg], $code);\n    }\n    private static function answer($res) {\n        if (is_wp_error($res)) return self::err(500, $res->get_error_message());\n        return new \\WP_REST_Response(['ok'=>true]+$res, 200);\n    }\n    private static function res_map($res) : array {\n        return is_wp_error($res) ? ['ok'=>false,'error'=>$res->get_error_message()] : ['ok'=>true]+$res;\n    }\n}\n\nWTP_Dev_Bridge::boot();\n\nendif; // class exists",
    "mu-plugins/hostinger-preview-domain.php": "<?php\n/**\n * Plugin Name:       Hostinger Preview Domain\n * Plugin URI:        https://www.hostinger.com\n * Description:       Enable access to the website through a temporary domain while the main domain is not yet configured.\n * Version:           1.3.4\n * Author:            Hostinger\n * Author URI:        https://www.hostinger.com\n * License:           GPL-2.0-or-later\n * License URI:       https://www.gnu.org/licenses/gpl-2.0.html\n * Text Domain:       hostinger-preview-domain\n * Domain Path:       /languages\n * Requires at least: 5.0\n * Requires PHP:      7.0\n * MU Plugin:         Yes\n */\n\nif ( ! class_exists( 'Hostinger_Temporary_Domain_Handler' ) ) {\n    class Hostinger_Temporary_Domain_Handler {\n        private $site_domain;\n        private $current_domain;\n        private $db_site_url;\n\n        public function __construct() {\n            $this->initialize_domains();\n            $this->setup_hooks();\n        }\n\n        /**\n         * Initialize the handler if the preview indicator is present.\n         *\n         * @return self|null Returns a new instance if preview indicator is found, otherwise null.\n         */\n        public static function init() {\n            if ( function_exists( 'getallheaders' ) ) {\n                $headers = getallheaders();\n                if ( isset( $headers['X-Preview-Indicator'] ) && $headers['X-Preview-Indicator'] ) {\n                    return new self();\n                }\n            }\n\n            if ( isset( $_SERVER['HTTP_X_PREVIEW_INDICATOR'] ) && $_SERVER['HTTP_X_PREVIEW_INDICATOR'] ) {\n                return new self();\n            }\n\n            return null;\n        }\n\n        /**\n         * Filter and rewrite the URL if necessary.\n         *\n         * @param string      $url     The original URL.\n         * @param mixed       $path    Optional. Path relative to the URL.\n         * @param string|null $scheme  Optional. Scheme to give the URL context.\n         * @param int|null    $blog_id Optional. Blog ID.\n         *\n         * @return string The filtered URL.\n         */\n        public function filter_url( $url, $path = '', $scheme = null, $blog_id = null ) {\n            if ( ! filter_var( $url, FILTER_VALIDATE_URL ) ) {\n                return $url;\n            }\n\n            $filtered_url = str_replace( [ 'http://' . $this->site_domain, 'https://' . $this->site_domain ], 'https://' . $this->current_domain, $url );\n\n            return filter_var( $filtered_url, FILTER_SANITIZE_URL ) ?: '';\n        }\n\n        /**\n         * Filter site icon URL to remove www prefix\n         *\n         * @param string $url The site icon URL\n         * @return string The filtered URL\n         */\n        public function filter_site_icon_url( $url ) {\n            if ( empty( $url ) ) {\n                return $url;\n            }\n\n            $url = $this->filter_url( $url );\n\n            $url = preg_replace( '/https?:\\/\\/www\\./i', 'https://', $url );\n\n            return $url;\n        }\n\n        /**\n         * Filter and rewrite the content if necessary.\n         *\n         * @param string $content The original content.\n         *\n         * @return string The filtered content.\n         */\n        public function filter_content( $content ) {\n            $patterns = [\n                // HTML attributes and content URLs\n                '/(href|src|action|srcset|data-img-url)\\s*=\\s*[\\'\"]https?:\\/\\/' . preg_quote( $this->site_domain, '/' ) . '[^\\s\\'\"<>]*/i',\n                // CSS imports and urls\n                '/(@import\\s+[\"\\']|url\\([\"\\']?)https?:\\/\\/' . preg_quote( $this->site_domain, '/' ) . '[^\\s\\'\"<>)]*/i',\n            ];\n\n            foreach ( $patterns as $pattern ) {\n                $content = preg_replace_callback( $pattern, function ( $matches ) {\n                    $url = substr( $matches[0], strpos( $matches[0], 'http' ) );\n\n                    return str_replace( $url, $this->filter_url( $url ), $matches[0] );\n                }, $content );\n            }\n\n            return $content ?: '';\n        }\n\n        /**\n         * Handle CORS headers.\n         *\n         * @return void\n         */\n        public function handle_cors() {\n            $allowed_origin = 'https://' . filter_var( $this->current_domain, FILTER_SANITIZE_URL );\n\n            if ( isset( $_SERVER['HTTP_ORIGIN'] ) && $_SERVER['HTTP_ORIGIN'] === $allowed_origin ) {\n                header( 'Access-Control-Allow-Origin: ' . $allowed_origin );\n                header( 'Access-Control-Allow-Methods: GET, POST, OPTIONS' );\n                header( 'Access-Control-Allow-Credentials: true' );\n                header( 'Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept' );\n                header( 'Access-Control-Max-Age: 86400' );\n\n                if ( $_SERVER['REQUEST_METHOD'] === 'OPTIONS' ) {\n                    header( 'HTTP/1.1 204 No Content' );\n                    exit();\n                }\n            }\n        }\n\n        /**\n         * Start output buffering if URL rewriting is needed.\n         *\n         * @return void\n         */\n        public function start_output_buffer() {\n            ob_start( [ $this, 'filter_content' ] );\n        }\n\n        /**\n         * Initialize site and current domains.\n         *\n         * @return void\n         */\n        private function initialize_domains() {\n            $this->site_domain = $this->sanitize_domain( parse_url( get_site_url(), PHP_URL_HOST ) ?: '' );\n            $this->current_domain = $this->sanitize_domain( isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : '' );\n            $this->db_site_url = $this->get_site_url_from_db();\n        }\n\n        /**\n         * Get site URL from database directly without WordPress functions\n         *\n         * @return string The site URL without http:// or https://\n         */\n        private function get_site_url_from_db() {\n            global $wpdb;\n\n            $site_url = $wpdb->get_var(\n                $wpdb->prepare(\n                    \"SELECT REPLACE(REPLACE(option_value, 'https://', ''), 'http://', '') \n                    FROM {$wpdb->options} \n                    WHERE option_name = %s \n                    LIMIT 1\",\n                    'siteurl'\n                )\n            );\n\n            return $this->sanitize_domain($site_url ?: '');\n        }\n\n        /**\n         * Setup hooks for URL and content filtering.\n         *\n         * @return void\n         */\n        private function setup_hooks() {\n            if ( $this->should_skip_hooks() ) {\n                return;\n            }\n\n            // Basic URL filters\n            add_filter( 'home_url', [ $this, 'filter_url' ], 10, 4 );\n            add_filter( 'site_url', [ $this, 'filter_url' ], 10, 4 );\n            add_filter( 'wp_redirect', [ $this, 'filter_url' ], 10 );\n\n            // Site icon URL filter\n            add_filter( 'get_site_icon_url', [ $this, 'filter_site_icon_url' ], 10, 1 );\n\n            // Content filters\n            $content_filters = [ 'the_content', 'widget_text', 'wp_nav_menu_items' ];\n            foreach ( $content_filters as $filter ) {\n                add_filter( $filter, [ $this, 'filter_content' ], 999 );\n            }\n\n            // Media handling\n            add_filter( 'wp_get_attachment_url', [ $this, 'filter_url' ] );\n\n            // Admin filters\n            if ( is_admin() ) {\n                $this->setup_admin_filters();\n            }\n\n            // Output buffering and CORS\n            add_action( 'init', [ $this, 'start_output_buffer' ], 0 );\n            add_action( 'init', [ $this, 'handle_cors' ], 0 );\n\n            // Content save hooks to replace domain in content\n            add_filter( 'wp_insert_post_data', [ $this, 'replace_host_in_content' ], 10, 2 );\n            add_filter( 'content_save_pre', [ $this, 'replace_host_in_content_simple' ], 10, 1 );\n            add_filter( 'pre_update_option', [ $this, 'replace_host_in_option' ], 10, 3 );\n        }\n\n        /**\n         * Setup filters for admin URLs.\n         *\n         * @return void\n         */\n        private function setup_admin_filters() {\n            $admin_filters = [\n                'admin_url',\n                'plugins_url',\n                'theme_file_uri',\n                'includes_url',\n                'content_url',\n                'style_loader_src',\n                'script_loader_src',\n                'preview_post_link',\n            ];\n\n            foreach ( $admin_filters as $filter ) {\n                add_filter( $filter, [ $this, 'filter_url' ], 10, 3 );\n            }\n        }\n\n        /**\n         * Sanitize a domain name.\n         *\n         * @param string $domain The domain name to sanitize.\n         *\n         * @return string The sanitized domain name.\n         */\n        private function sanitize_domain( $domain ) {\n            return preg_replace( '/[^a-z0-9\\-\\.]/', '', strtolower( trim( $domain ) ) );\n        }\n\n        /**\n         * Check if we should skip applying hooks for this request.\n         *\n         * @return bool True if hooks should be skipped\n         */\n        private function should_skip_hooks() {\n            if ( php_sapi_name() === 'cli' ) {\n                if ( $this->is_litespeed_command() ) {\n                    return true;\n                }\n            }\n\n            if ( ! $this->should_rewrite_url() ) {\n                return true;\n            }\n\n            $script_name = isset( $_SERVER['SCRIPT_FILENAME'] ) ? basename( $_SERVER['SCRIPT_FILENAME'] ) : '';\n            if ( strpos( $script_name, 'autologin' ) !== false || isset( $_GET['platform'] ) ) {\n                return true;\n            }\n\n            return false;\n        }\n\n        /**\n         * Simple check if current command contains LiteSpeed references\n         *\n         * @return bool True if litespeed command detected\n         */\n        private function is_litespeed_command() {\n            global $argv;\n\n            if ( ! empty( $argv ) ) {\n                $command = implode( ' ', $argv );\n                if ( stripos( $command, 'litespeed' ) !== false || stripos( $command, 'lscache' ) !== false ) {\n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n        /**\n         * Determine if the URL should be rewritten.\n         *\n         * @return bool True if the URL should be rewritten, false otherwise.\n         */\n        private function should_rewrite_url() {\n            return $this->current_domain !== $this->site_domain;\n        }\n\n        /**\n         * Replace current host with site URL in post content during save\n         *\n         * @param array $data    Post data array\n         * @param array $postarr Original post array\n         *\n         * @return array Modified post data\n         */\n        public function replace_host_in_content( $data, $postarr ) {\n            // Only proceed if current host and DB site URL are different\n            if ( $this->current_domain && $this->db_site_url && $this->current_domain !== $this->db_site_url ) {\n                if ( isset( $data['post_content'] ) ) {\n                    $data['post_content'] = str_replace( $this->current_domain, $this->db_site_url, $data['post_content'] );\n                }\n\n                if ( isset( $data['post_title'] ) ) {\n                    $data['post_title'] = str_replace( $this->current_domain, $this->db_site_url, $data['post_title'] );\n                }\n\n                if ( isset( $data['post_excerpt'] ) ) {\n                    $data['post_excerpt'] = str_replace( $this->current_domain, $this->db_site_url, $data['post_excerpt'] );\n                }\n            }\n\n            return $data;\n        }\n\n        /**\n         * Replace current host with site URL in regular content during save\n         *\n         * @param string $content The content being saved\n         *\n         * @return string Modified content\n         */\n        public function replace_host_in_content_simple( $content ) {\n            // Only proceed if current host and DB site URL are different\n            if ( $this->current_domain && $this->db_site_url && $this->current_domain !== $this->db_site_url ) {\n                $content = str_replace( $this->current_domain, $this->db_site_url, $content );\n            }\n\n            return $content;\n        }\n\n        /**\n         * Replace current host with site URL in options\n         *\n         * @param mixed  $value     The new option value\n         * @param string $option    Option name\n         * @param mixed  $old_value The old option value\n         *\n         * @return mixed Modified option value\n         */\n        public function replace_host_in_option( $value, $option, $old_value ) {\n            // Skip if it's the siteurl or home option to avoid conflicts\n            if ( in_array( $option, array( 'siteurl', 'home' ) ) ) {\n                return $value;\n            }\n\n            // Only proceed if current host and DB site URL are different\n            if ( $this->current_domain && $this->db_site_url && $this->current_domain !== $this->db_site_url ) {\n                if ( is_string( $value ) ) {\n                    $value = str_replace( $this->current_domain, $this->db_site_url, $value );\n                } elseif ( is_array( $value ) ) {\n                    $value = $this->replace_in_array_recursive( $value, $this->current_domain, $this->db_site_url );\n                }\n            }\n\n            return $value;\n        }\n\n        /**\n         * Recursively replace values in arrays\n         *\n         * @param array  $array   The array to process\n         * @param string $search  The search string\n         * @param string $replace The replacement string\n         *\n         * @return array The processed array\n         */\n        private function replace_in_array_recursive( $array, $search, $replace ) {\n            $result = array();\n\n            foreach ( $array as $key => $value ) {\n                if ( is_array( $value ) ) {\n                    $result[$key] = $this->replace_in_array_recursive( $value, $search, $replace );\n                } elseif ( is_string( $value ) ) {\n                    $result[$key] = str_replace( $search, $replace, $value );\n                } else {\n                    $result[$key] = $value;\n                }\n            }\n\n            return $result;\n        }\n    }\n\n    Hostinger_Temporary_Domain_Handler::init();\n}\n",
    "mu-plugins/wtp-ro-plain-proxy.php": "<?php\n/**\n * Plugin Name: WTP RO Plain Proxy (read-only)\n * Description: Wystawia publiczny endpoint do odczytu snapshotów jako text/plain (tylko GET, brak auth)\n * Version: 1.0.0\n */\n\n// Auto-load w mu-plugins, brak aktywacji potrzebnej.\nif (!defined('ABSPATH')) exit;\n\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-ro/v1', '/snap', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            // twardo ustawiony site_key (możesz zmienić na inny gdy się zmieni)\n            $site_key = '5Depft8Y9LU0t6Sv';\n\n            $name = $req->get_param('file');\n            if (!is_string($name)) {\n                return new WP_REST_Response('bad file param', 400);\n            }\n\n            // tylko dozwolone nazwy plików: manifest/bundle/index/files_000..016\n            if (!preg_match('#^(manifest|bundle|index|files_\\d{3})\\.json$#', $name)) {\n                return new WP_REST_Response('forbidden filename', 403);\n            }\n\n            $base = WP_CONTENT_DIR . '/uploads/wtp-ro/public/' . $site_key . '/';\n            $path = $base . $name;\n\n            // brak traversali i tylko istniejące pliki\n            $realBase = realpath($base);\n            $realPath = realpath($path);\n            if (!$realBase || !$realPath || strpos($realPath, $realBase) !== 0 || !is_file($realPath)) {\n                return new WP_REST_Response('not found', 404);\n            }\n\n            // czytamy i zwracamy jako text/plain (sandboxy to lubią)\n            $data = file_get_contents($realPath);\n            if ($data === false) return new WP_REST_Response('io error', 500);\n\n            // Ustawiamy nagłówki \"neutralne\"\n            header('Content-Type: text/plain; charset=UTF-8');\n            header('Cache-Control: public, max-age=60');\n            // CORS na wszelki wypadek\n            header('Access-Control-Allow-Origin: *');\n            header('Access-Control-Allow-Methods: GET, OPTIONS');\n\n            // Zwracamy zawartość pliku (JSON-tekst)\n            return new WP_REST_Response($data, 200);\n        }\n    ]);\n});",
    "mu-plugins/hostinger-auto-updates.php": "<?php\n/**\n * Plugin Name:       Hostinger Smart Auto Updates\n * Plugin URI:        https://www.hostinger.com\n * Description:       Faster and more secure updates for your themes, plugins, and core files. Managed entirely by Hostinger.\n * Version:           1.0.7\n * Author:            Hostinger\n * Author URI:        https://www.hostinger.com\n * License:           GPL-2.0-or-later\n * License URI:       https://www.gnu.org/licenses/gpl-2.0.html\n * Text Domain:       hostinger-auto-updates\n * Domain Path:       /languages\n * Requires at least: 5.0\n * Requires PHP:      7.4\n * Network:           true\n */\n\nif ( ! defined( 'ABSPATH' ) ) {\n    exit; // Exit if accessed directly\n}\n\n/**\n * Disable automatic updates\n */\nadd_filter( 'automatic_updater_disabled', '__return_true' ); // Core updates\nadd_filter( 'auto_update_theme', '__return_false' );         // Theme updates\nadd_filter( 'auto_update_plugin', '__return_false' );        // Plugin updates\n\n/**\n * Use Hostinger's proxy services for WordPress.org API and download requests.\n *\n * @param mixed  $response_override Response to replace with.\n * @param array  $args    HTTP request arguments.\n * @param string $url     Request URL.\n * @return mixed\n */\nif ( ! function_exists( 'hostinger_use_proxy_services' ) ) {\n    function hostinger_use_proxy_services( $response_override, $args, $url ) {\n        $proxy_domains = [\n            'api.wordpress.org'       => 'wpapi.hostinger.io',\n            'downloads.wordpress.org' => 'wpdownloads.hostinger.io',\n        ];\n\n        foreach ( $proxy_domains as $original_domain => $proxy_domain ) {\n            if ( strpos( $url, $original_domain ) !== false ) {\n                $proxy_url = str_replace( $original_domain, $proxy_domain, $url );\n                $response  = wp_remote_request( $proxy_url, $args );\n\n                return $response;\n            }\n        }\n\n        return $response_override;\n    }\n}\n\nadd_filter( 'pre_http_request', 'hostinger_use_proxy_services', 10, 3 );\n\n/**\n * Modify the default auto-update tests.\n *\n * @param array $tests The array of site status tests.\n * @return array Modified array of site status tests.\n */\nif ( ! function_exists( 'hostinger_change_default_autoupdates_test' ) ) {\n    function hostinger_change_default_autoupdates_test( $tests ) {\n        // Remove default auto-update tests\n        unset( $tests['async']['background_updates'] );\n        unset( $tests['direct']['plugin_theme_auto_updates'] );\n\n        // Add a new test to indicate Hostinger manages updates\n        $tests['direct']['hostinger_plugin_theme_auto_updates'] = [\n            'label' => __( 'Auto-updates managed by Hostinger' ),\n            'test'  => function () {\n                $result = [\n                    'label'       => __( 'Automatic updates managed by Hostinger' ),\n                    'status'      => 'good',\n                    'badge'       => [\n                        'label' => __( 'Security' ),\n                        'color' => 'blue',\n                    ],\n                    'description' => __( 'Automatic updates ensure your site is always running the latest and most secure versions of WordPress, plugins, and themes.' ),\n                    'actions'     => '',\n                    'test'        => 'hostinger_managed_updates',\n                ];\n\n                return $result;\n            },\n        ];\n\n        return $tests;\n    }\n}\n\nadd_filter( 'site_status_tests', 'hostinger_change_default_autoupdates_test' );\n",
    "mu-plugins/wtp-snapshot-exporter-github.php": "<?php\n/**\n * Plugin Name: WTP Snapshot Exporter — GitHub (theme + plugins, all-in-one)\n * Description: Eksportuje motyw i wszystkie wtyczki do GitHub (theme-bundle.json, plugins-bundle.json). Endpoint /publish/theme/<secret> wypycha TERAZ także plugins.\n * Version: 3.2.0\n */\nif (!defined('ABSPATH')) exit;\n\n/*\n * WYMAGANE W wp-config.php:\n *\n * define('WTP_GH_OWNER',  'BoskiDionysos');               // user/org\n * define('WTP_GH_REPO',   'weektoppick-wp-modules');      // repo\n * define('WTP_GH_BRANCH', 'main');                        // opcjonalnie (domyślnie 'main')\n * define('WTP_GH_TOKEN',  'ghp_xxx');                     // PAT classic z repo:contents write\n * define('WTP_GH_SECRET', 'twoj_sekret');                 // sekret do REST (path param / key / header)\n */\n\n$need = ['WTP_GH_OWNER','WTP_GH_REPO','WTP_GH_TOKEN','WTP_GH_SECRET'];\nforeach ($need as $c) { if (!defined($c)) { error_log(\"[WTP Exporter] Missing constant $c\"); return; } }\n\n// ───────────────────── USTAWIENIA ─────────────────────\nconst WTP_ALLOWED_EXT      = ['php','css','js','json','svg','txt','md','html','po','mo'];\nconst WTP_EXCLUDE_RX       = '#(?:^|/)(node_modules|vendor|\\.git|\\.svn|\\.github|tests?|bin|dist)(/|$)#i';\nconst WTP_EXCLUDE_FILE_RX  = '#\\.(map|lock|min\\.map|ico|woff2?|ttf|eot)$#i';\n\nconst WTP_THEME_TARGET     = 'theme-bundle.json';\nconst WTP_PLUGINS_TARGET   = 'plugins-bundle.json';\n\n// ───────────────────── REST ENDPOINTS ─────────────────────\nadd_action('rest_api_init', function () {\n\n    // 1) PUBLISH THEME — oraz DODATKOWO PLUGINS (wykorzystujemy już przepuszczaną ścieżkę przez WAF)\n    register_rest_route('wtp-ro/v1', '/publish/theme/(?P<secret>[^/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n\n            if (!wtp_ro_secret_ok($req)) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n\n            $out = [];\n\n            // THEME\n            $theme = wtp_ro_collect_theme_files_fs();\n            if ($theme) {\n                $r1 = wtp_ro_push_to_github($theme, WTP_THEME_TARGET, 'Update theme-bundle.json (publish via /theme)');\n                $out['theme'] = is_wp_error($r1)\n                    ? ['ok'=>false,'error'=>$r1->get_error_message()]\n                    : ['ok'=>true,'raw_url'=>$r1['raw_url'],'commit'=>$r1['commit']];\n            } else {\n                $out['theme'] = ['ok'=>false,'error'=>'empty-theme'];\n            }\n\n            // PLUGINS — DODANE TU\n            $plugins = wtp_ro_collect_all_plugins_fs();\n            if ($plugins) {\n                $r2 = wtp_ro_push_to_github($plugins, WTP_PLUGINS_TARGET, 'Update plugins-bundle.json (publish via /theme)');\n                $out['plugins'] = is_wp_error($r2)\n                    ? ['ok'=>false,'error'=>$r2->get_error_message()]\n                    : ['ok'=>true,'raw_url'=>$r2['raw_url'],'commit'=>$r2['commit']];\n            } else {\n                $out['plugins'] = ['ok'=>false,'error'=>'empty-plugins'];\n            }\n\n            $ok = ($out['theme']['ok'] ?? false) || ($out['plugins']['ok'] ?? false);\n            return new WP_REST_Response(['ok'=>$ok] + $out, $ok ? 200 : 500);\n        }\n    ]);\n\n    // 2) PUBLISH PLUGINS — tylko wtyczki (gdybyś kiedyś potrzebował osobno)\n    register_rest_route('wtp-ro/v1', '/publish/plugins/(?P<secret>[^/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if (!wtp_ro_secret_ok($req)) return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n\n            $plugins = wtp_ro_collect_all_plugins_fs();\n            if (!$plugins) return new WP_REST_Response(['ok'=>false,'error'=>'empty-plugins'], 500);\n\n            $res = wtp_ro_push_to_github($plugins, WTP_PLUGINS_TARGET, 'Update plugins-bundle.json (publish)');\n            return is_wp_error($res)\n                ? new WP_REST_Response(['ok'=>false,'error'=>$res->get_error_message()], 500)\n                : new WP_REST_Response(['ok'=>true] + $res, 200);\n        }\n    ]);\n\n    // 3) PUBLISH ALL — oba naraz (alternatywny endpoint do 1)\n    register_rest_route('wtp-ro/v1', '/publish/all/(?P<secret>[^/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if (!wtp_ro_secret_ok($req)) return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n\n            $out = [];\n\n            $theme = wtp_ro_collect_theme_files_fs();\n            if ($theme) {\n                $r1 = wtp_ro_push_to_github($theme, WTP_THEME_TARGET, 'Update theme-bundle.json (publish-all)');\n                $out['theme'] = is_wp_error($r1)\n                    ? ['ok'=>false,'error'=>$r1->get_error_message()]\n                    : ['ok'=>true,'raw_url'=>$r1['raw_url'],'commit'=>$r1['commit']];\n            } else {\n                $out['theme'] = ['ok'=>false,'error'=>'empty-theme'];\n            }\n\n            $plugins = wtp_ro_collect_all_plugins_fs();\n            if ($plugins) {\n                $r2 = wtp_ro_push_to_github($plugins, WTP_PLUGINS_TARGET, 'Update plugins-bundle.json (publish-all)');\n                $out['plugins'] = is_wp_error($r2)\n                    ? ['ok'=>false,'error'=>$r2->get_error_message()]\n                    : ['ok'=>true,'raw_url'=>$r2['raw_url'],'commit'=>$r2['commit']];\n            } else {\n                $out['plugins'] = ['ok'=>false,'error'=>'empty-plugins'];\n            }\n\n            $ok = ($out['theme']['ok'] ?? false) || ($out['plugins']['ok'] ?? false);\n            return new WP_REST_Response(['ok'=>$ok] + $out, $ok ? 200 : 500);\n        }\n    ]);\n});\n\n// Akceptujemy sekret w 4 formach: path param, ?key=, nagłówek X-WTP-Secret, Authorization: Bearer\nfunction wtp_ro_secret_ok(WP_REST_Request $req) {\n    $want = constant('WTP_GH_SECRET');\n\n    $path = $req->get_param('secret');\n    if (is_string($path) && hash_equals($want, $path)) return true;\n\n    $key = $req->get_param('key');\n    if (is_string($key) && hash_equals($want, $key)) return true;\n\n    $hdr = $req->get_header('X-WTP-Secret');\n    if (is_string($hdr) && hash_equals($want, $hdr)) return true;\n\n    $auth = $req->get_header('Authorization');\n    if (is_string($auth) && stripos($auth, 'Bearer ') === 0) {\n        $bearer = trim(substr($auth, 7));\n        if (hash_equals($want, $bearer)) return true;\n    }\n    return false;\n}\n\n// ───────────────────── COLLECTORS ─────────────────────\nfunction wtp_ro_collect_theme_files_fs() {\n    $base = wp_normalize_path( get_stylesheet_directory() ); // aktywny (child/parent) motyw\n    return wtp_ro_collect_from_base($base, 'theme');\n}\n\nfunction wtp_ro_collect_all_plugins_fs() {\n    $out = [];\n\n    $plugins_base = wp_normalize_path( WP_PLUGIN_DIR );\n    if (is_dir($plugins_base)) {\n        $out += wtp_ro_collect_from_base($plugins_base, 'plugins'); // plugins/...\n    }\n\n    $mu_base = wp_normalize_path( WPMU_PLUGIN_DIR );\n    if (is_dir($mu_base) && $mu_base !== $plugins_base) {\n        $out += wtp_ro_collect_from_base($mu_base, 'mu-plugins'); // mu-plugins/...\n    }\n\n    return $out;\n}\n\n/**\n * @param string $base   katalog bazowy\n * @param string $prefix prefiks klucza w JSON (np. theme/, plugins/, mu-plugins/)\n * @return array         mapa: \"{prefix}/{relpath}\" => \"content\"\n */\nfunction wtp_ro_collect_from_base($base, $prefix) {\n    $rii = new RecursiveIteratorIterator(\n        new RecursiveDirectoryIterator($base, FilesystemIterator::SKIP_DOTS)\n    );\n\n    $out = [];\n    foreach ($rii as $spl) {\n        if (!$spl->isFile()) continue;\n\n        $path = wp_normalize_path($spl->getPathname());\n        $rel  = ltrim(str_replace($base, '', $path), '/');\n\n        // wykluczenia\n        if (preg_match(WTP_EXCLUDE_RX, $rel)) continue;\n        if (preg_match(WTP_EXCLUDE_FILE_RX, $rel)) continue;\n\n        // rozszerzenia\n        $ext = strtolower(pathinfo($rel, PATHINFO_EXTENSION));\n        if (!in_array($ext, WTP_ALLOWED_EXT, true)) continue;\n\n        $content = @file_get_contents($path);\n        if ($content === false) continue;\n\n        $key = trim($prefix, '/').'/'.$rel; // np. \"theme/header.php\"\n        $out[$key] = $content;\n    }\n    return $out;\n}\n\n// ───────────────────── PUSH TO GITHUB ─────────────────────\nfunction wtp_ro_push_to_github(array $bundle, $target_path, $commit_msg) {\n    if (empty($bundle)) return new WP_Error('wtp_empty', 'Empty bundle');\n\n    $payload = json_encode(\n        $bundle,\n        JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE\n    );\n    if ($payload === false) return new WP_Error('wtp_json', 'json_encode failed');\n\n    $owner  = constant('WTP_GH_OWNER');\n    $repo   = constant('WTP_GH_REPO');\n    $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n    $token  = constant('WTP_GH_TOKEN');\n    $api    = \"https://api.github.com/repos/{$owner}/{$repo}/contents/{$target_path}\";\n\n    // SHA istniejącego pliku (jeśli jest)\n    $sha = null;\n    $get = wtp_ro_http('GET', $api.'?ref='.rawurlencode($branch), $token, null);\n    if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n    $body = [\n        'message' => $commit_msg,\n        'content' => base64_encode($payload),\n        'branch'  => $branch,\n    ];\n    if ($sha) $body['sha'] = $sha;\n\n    $put = wtp_ro_http('PUT', $api, $token, $body);\n    if ($put['code'] >= 300) {\n        return new WP_Error('wtp_github_put', 'GitHub PUT error '.$put['code'].': '.json_encode($put['body']));\n    }\n\n    $raw_url = \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/{$target_path}\";\n    return ['raw_url'=>$raw_url, 'commit'=>($put['body']['commit']['sha'] ?? null)];\n}\n\nfunction wtp_ro_http($method, $url, $token, $json) {\n    $args = [\n        'method'  => $method,\n        'headers' => [\n            'Authorization' => 'token '.$token,\n            'User-Agent'    => 'WTP-Exporter',\n            'Accept'        => 'application/vnd.github+json',\n        ],\n        'timeout' => 25,\n    ];\n    if ($json !== null) {\n        $args['body'] = json_encode($json);\n        $args['headers']['Content-Type'] = 'application/json';\n    }\n    $res  = wp_remote_request($url, $args);\n    $code = wp_remote_retrieve_response_code($res);\n    $body = json_decode(wp_remote_retrieve_body($res), true);\n    return ['code'=>$code, 'body'=>$body];\n}",
    "mu-plugins/wtp-exporter-chunked.php": "<?php\n/**\n * Plugin Name: WTP Exporter Chunked — GitHub (plugins only)\n * Description: Eksportuje WSZYSTKIE wtyczki (plugins + mu-plugins) do wielu plików JSON < 5 MB + generuje indeks. Push do GitHub.\n * Version: 1.1.0\n */\nif (!defined('ABSPATH')) exit;\n\n/* Twardsze limity na czas eksportu (unikamy fatal/timeout przy dużych instalacjach) */\n@ini_set('memory_limit', '512M');\n@set_time_limit(120);\n\n/*\n * WYMAGANE w wp-config.php:\n * define('WTP_GH_OWNER',  'BoskiDionysos');\n * define('WTP_GH_REPO',   'weektoppick-wp-modules');\n * define('WTP_GH_BRANCH', 'main');            // opcjonalnie (domyślnie 'main')\n * define('WTP_GH_TOKEN',  'ghp_xxx');         // PAT z repo:contents write\n * define('WTP_GH_SECRET', 'twoj_sekret');     // do REST (param <secret>)\n */\n\n$need = ['WTP_GH_OWNER','WTP_GH_REPO','WTP_GH_TOKEN','WTP_GH_SECRET'];\nforeach ($need as $c) { if (!defined($c)) { error_log(\"[WTP ExporterChunked] Missing constant $c\"); return; } }\n\n/** ───────────────────────────────────────────────────────────────────────────\n *  KONFIG\n *  ─────────────────────────────────────────────────────────────────────────── */\nconst WTP_ALLOWED_EXT        = ['php','css','js','json','svg','txt','md','html','po','mo'];\nconst WTP_EXCLUDE_RX         = '#(?:^|/)(node_modules|vendor|\\.git|\\.svn|\\.github|tests?|bin|dist|cache)(/|$)#i';\nconst WTP_EXCLUDE_FILE_RX    = '#\\.(map|lock|min\\.map|ico|woff2?|ttf|eot)$#i';\nconst WTP_CHUNK_TARGET_BYTES = 5_000_000; // ~5 MB\nconst WTP_INDEX_PATH         = 'plugins-index.json';     // w repo (root)\nconst WTP_CHUNK_BASENAME     = 'plugins-bundle';         // prefix nazw chunków\n\nadd_action('rest_api_init', function () {\n\n    // /wp-json/wtp-ro/v1/publish/plugins-chunked/<secret>\n    register_rest_route('wtp-ro/v1', '/publish/plugins-chunked/(?P<secret>[^/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if ($req->get_param('secret') !== constant('WTP_GH_SECRET')) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n\n            $t0 = microtime(true);\n            $bundle = wtp_collect_plugins_fs_map();                  // mapa \"plugins/... => content\"\n            if (!$bundle) return new WP_REST_Response(['ok'=>false,'error'=>'empty-plugins'], 500);\n\n            $chunks = wtp_chunk_map($bundle, WTP_CHUNK_TARGET_BYTES); // [ [k=>v,...], ... ]\n            if (empty($chunks)) return new WP_REST_Response(['ok'=>false,'error'=>'chunking-failed'], 500);\n\n            // push wszystkich chunków + indeksu do GitHub\n            $push = wtp_push_chunks_and_index_to_github($chunks);\n            if (is_wp_error($push)) {\n                return new WP_REST_Response(['ok'=>false,'error'=>$push->get_error_message()], 500);\n            }\n\n            $push['t_sec'] = round(microtime(true) - $t0, 3);\n            $push['mem_mb'] = round(memory_get_usage(true)/1048576, 1);\n            return new WP_REST_Response(['ok'=>true] + $push, 200);\n        }\n    ]);\n\n    // /wp-json/wtp-ro/v1/publish/plugins-chunked-debug/<secret>  (BEZ pushu – diagnostyka)\n    register_rest_route('wtp-ro/v1', '/publish/plugins-chunked-debug/(?P<secret>[^/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if ($req->get_param('secret') !== constant('WTP_GH_SECRET')) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            $t0 = microtime(true);\n            $bundle = wtp_collect_plugins_fs_map();\n            if (!$bundle) return new WP_REST_Response(['ok'=>false,'error'=>'empty-plugins'], 500);\n\n            $chunks = wtp_chunk_map($bundle, WTP_CHUNK_TARGET_BYTES);\n            $t1 = microtime(true);\n\n            return new WP_REST_Response([\n                'ok'           => true,\n                'files_total'  => count($bundle),\n                'chunks_total' => count($chunks),\n                'mem_mb'       => round(memory_get_usage(true)/1048576, 1),\n                'time_sec'     => round($t1 - $t0, 3),\n                'chunk_sizes'  => array_map(function($m){\n                    $s = json_encode($m, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_INVALID_UTF8_SUBSTITUTE);\n                    return strlen($s);\n                }, $chunks),\n                'sample'       => array_slice(array_keys($bundle), 0, 10),\n            ], 200);\n        }\n    ]);\n});\n\n/** ───────────────────────────────────────────────────────────────────────────\n *  ZBIERANIE: wszystkie wtyczki (plugins + mu-plugins) -> mapa \"prefix/relpath\" => content\n *  ─────────────────────────────────────────────────────────────────────────── */\nfunction wtp_collect_plugins_fs_map() {\n    $out = [];\n\n    $plugins_base = wp_normalize_path(WP_PLUGIN_DIR);\n    if (is_dir($plugins_base)) {\n        $out += wtp_collect_from_base($plugins_base, 'plugins');\n    }\n\n    $mu_base = wp_normalize_path(WPMU_PLUGIN_DIR);\n    if (is_dir($mu_base) && $mu_base !== $plugins_base) {\n        $out += wtp_collect_from_base($mu_base, 'mu-plugins');\n    }\n    return $out;\n}\n\nfunction wtp_collect_from_base($base, $prefix) {\n    $rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($base, FilesystemIterator::SKIP_DOTS));\n    $out = [];\n    foreach ($rii as $spl) {\n        if (!$spl->isFile()) continue;\n        $path = wp_normalize_path($spl->getPathname());\n        $rel  = ltrim(str_replace($base, '', $path), '/');\n\n        if (preg_match(WTP_EXCLUDE_RX, $rel)) continue;\n        if (preg_match(WTP_EXCLUDE_FILE_RX, $rel)) continue;\n\n        $ext = strtolower(pathinfo($rel, PATHINFO_EXTENSION));\n        if (!in_array($ext, WTP_ALLOWED_EXT, true)) continue;\n\n        $content = @file_get_contents($path);\n        if ($content === false) continue;\n\n        $key = trim($prefix, '/').'/'.$rel; // np. \"plugins/akismet/akismet.php\"\n        $out[$key] = $content;\n    }\n    return $out;\n}\n\n/** ───────────────────────────────────────────────────────────────────────────\n *  CHUNKING: dzieli mapę (k=>v) na paczki < limit (po JSON-encode)\n *  ─────────────────────────────────────────────────────────────────────────── */\nfunction wtp_chunk_map(array $map, int $targetBytes) {\n    $chunks = [];\n    $current = [];\n    $approxBytes = 2; // nawiasy {}\n\n    foreach ($map as $k => $v) {\n        // oszacuj rozmiar przy JSON (klucz+wartość jako string) – z SUBSTITUE dla bezpieczeństwa\n        $entryJson   = json_encode([$k => $v], JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_INVALID_UTF8_SUBSTITUTE);\n        $entryBytes  = strlen($entryJson) + 1;\n\n        if ($approxBytes + $entryBytes > $targetBytes && !empty($current)) {\n            $chunks[] = $current;\n            $current = [];\n            $approxBytes = 2;\n        }\n        $current[$k] = $v;\n        $approxBytes += $entryBytes;\n    }\n    if (!empty($current)) $chunks[] = $current;\n    return $chunks;\n}\n\n/** ───────────────────────────────────────────────────────────────────────────\n *  PUSH: pliki chunków + indeks do GitHub (contents API)\n *  ─────────────────────────────────────────────────────────────────────────── */\nfunction wtp_push_chunks_and_index_to_github(array $chunks) {\n    $owner  = constant('WTP_GH_OWNER');\n    $repo   = constant('WTP_GH_REPO');\n    $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n    $token  = constant('WTP_GH_TOKEN');\n\n    $pushed = [];\n    foreach ($chunks as $i => $payloadMap) {\n        $payload = json_encode(\n            $payloadMap,\n            JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE\n        );\n        $path    = sprintf('%s_%03d.json', WTP_CHUNK_BASENAME, $i);\n        $put     = wtp_gh_put_file($owner, $repo, $branch, $token, $path, $payload, 'Update '.$path.' (chunk)');\n        if ($put['code'] >= 300) {\n            return new WP_Error('wtp_github_put', 'GitHub PUT error '.$put['code'].': '.json_encode($put['body']));\n        }\n        $pushed[] = [\n            'path' => $path,\n            'size' => strlen($payload),\n            'sha1' => sha1($payload),\n            'raw'  => \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/{$path}\"\n        ];\n    }\n\n    // Zbuduj indeks\n    $index = [\n        'version'      => 1,\n        'generated_at' => time(),\n        'chunks'       => $pushed,\n        'total_chunks' => count($pushed),\n    ];\n    $indexJson = json_encode($index, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT);\n    $putIndex  = wtp_gh_put_file($owner, $repo, $branch, $token, WTP_INDEX_PATH, $indexJson, 'Update '.WTP_INDEX_PATH.' (index)');\n    if ($putIndex['code'] >= 300) {\n        return new WP_Error('wtp_github_put', 'GitHub PUT index error '.$putIndex['code'].': '.json_encode($putIndex['body']));\n    }\n\n    return [\n        'index_raw_url' => \"https://raw.githubusercontent.com/{$owner}/{$repo}/{$branch}/\".WTP_INDEX_PATH,\n        'chunks'        => $pushed,\n    ];\n}\n\nfunction wtp_gh_put_file($owner,$repo,$branch,$token,$path,$content,$message) {\n    $api = \"https://api.github.com/repos/{$owner}/{$repo}/contents/{$path}\";\n    // get sha if exists\n    $sha = null;\n    $get = wtp_http('GET', $api.'?ref='.rawurlencode($branch), $token, null);\n    if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n    $body = [\n        'message' => $message,\n        'content' => base64_encode($content),\n        'branch'  => $branch,\n    ];\n    if ($sha) $body['sha'] = $sha;\n\n    return wtp_http('PUT', $api, $token, $body);\n}\n\nfunction wtp_http($method, $url, $token, $json) {\n    $args = [\n        'method'  => $method,\n        'headers' => [\n            'Authorization' => 'token '.$token,\n            'User-Agent'    => 'WTP-Exporter-Chunked',\n            'Accept'        => 'application/vnd.github+json',\n        ],\n        'timeout' => 30,\n    ];\n    if ($json !== null) {\n        $args['body'] = json_encode($json);\n        $args['headers']['Content-Type'] = 'application/json';\n    }\n    $res  = wp_remote_request($url, $args);\n    $code = wp_remote_retrieve_response_code($res);\n    $body = json_decode(wp_remote_retrieve_body($res), true);\n    return ['code'=>$code, 'body'=>$body];\n}"
}