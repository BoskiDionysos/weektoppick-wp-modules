     1	<?php // --- SAFETY: no closing PHP tag, no echo before headers ---  // Theme supports & menus add_action('after_setup_theme', function () {   add_theme_support('title-tag');   add_theme_support('post-thumbnails');   register_nav_menus(['primary' => __('Primary Menu', 'wtp-core-theme')]); });  // Enqueue styles add_action('wp_enqueue_scripts', function () {   wp_enqueue_style('wtp-core-theme', get_stylesheet_uri(), [], null); });  // ---- Simple i18n map (JSON) ----------------------------------------------- // Files: /i18n/terms.{locale}.json, e.g., terms.en.json, terms.pl.json, terms.es.json function wtp_current_lang() {   // Use WP locale -> two-letter (e.g. pl_PL -> pl)   $locale = get_locale();   if (!$locale) return 'en';   if (preg_match('/^[a-z]{2}/i', $locale, $m)) return strtolower($m[0]);   return 'en'; } function wtp_i18n($key, $fallback = '') {   static $cache = null;   if ($cache === null) {     $lang = wtp_current_lang();     $path = get_template_directory() . "/i18n/terms.$lang.json";     if (!file_exists($path)) $path = get_template_directory() . "/i18n/terms.en.json";     $json = @file_get_contents($path);     $cache = $json ? json_decode($json, true) : [];     if (!is_array($cache)) $cache = [];   }   return isset($cache[$key]) ? $cache[$key] : ($fallback !== '' ? $fallback : $key); } function wtp_t($key, $fallback = '') { echo esc_html( wtp_i18n($key, $fallback) ); }  // ---- Light taxonomy/tag for Top-3 ----------------------------------------- add_action('init', function () {   // We keep it simple: a tag "wtp-top3" marks posts for homepage Top-3.   // Later, we can switch to CPT + custom taxonomy without touching templates.   register_taxonomy_for_object_type('post_tag', 'post'); });  // ---- Top-3 renderer (query by tag) ---------------------------------------- function wtp_render_top3() {   $q = new WP_Query([     'posts_per_page' => 3,     'tag' => 'wtp-top3',     'ignore_sticky_posts' => true,     'no_found_rows' => true,   ]);   ob_start();   ?>   <section class="container">     <div class="hero">       <span class="badge"><?php wtp_t('this_week','This week'); ?></span>       <h1><?php wtp_t('top_3_picks','Top 3 picks'); ?></h1>       <p><?php wtp_t('best_deals_curated','Best weekly deals curated for your region.'); ?></p>     </div>     <div class="grid">       <?php if ($q->have_posts()): while($q->have_posts()): $q->the_post(); ?>         <article class="card">           <?php if (has_post_thumbnail()) the_post_thumbnail('medium_large', ['style'=>'width:100%;height:auto;border-radius:8px']); ?>           <h3><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></h3>           <p><?php echo esc_html( wp_trim_words( get_the_excerpt() ?: wp_strip_all_tags( get_the_content() ), 22 ) ); ?></p>           <a class="button" href="<?php the_permalink(); ?>"><?php wtp_t('view_deal','View deal'); ?></a>         </article>       <?php endwhile; wp_reset_postdata(); else: ?>         <article class="card"><h3><?php wtp_t('no_picks_yet','No picks yet'); ?></h3><p><?php wtp_t('check_soon','Check back soon.'); ?></p></article>       <?php endif; ?>     </div>   </section>   <?php   return ob_get_clean(); } add_shortcode('wtp_top3', 'wtp_render_top3');
