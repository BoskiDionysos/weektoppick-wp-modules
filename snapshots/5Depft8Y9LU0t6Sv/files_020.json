[{"base":"plugins","rel":"litespeed-cache\/src\/avatar.cls.php","ext":"php","size":8890,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The avatar cache class.\n *\n * Caches remote (e.g., Gravatar) avatars locally and rewrites URLs\n * to serve cached copies with a TTL. Supports on-demand generation\n * during page render and batch generation via cron.\n *\n * @since 3.0\n * @package LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Avatar\n *\/\nclass Avatar extends Base {\n\n\tconst TYPE_GENERATE = 'generate';\n\n\t\/**\n\t * Avatar cache TTL (seconds).\n\t *\n\t * @var int\n\t *\/\n\tprivate $_conf_cache_ttl;\n\n\t\/**\n\t * Avatar DB table name.\n\t *\n\t * @var string\n\t *\/\n\tprivate $_tb;\n\n\t\/**\n\t * In-request map from original URL => rewritten URL to avoid duplicates.\n\t *\n\t * @var array<string,string>\n\t *\/\n\tprivate $_avatar_realtime_gen_dict = array();\n\n\t\/**\n\t * Summary\/status data for last requests.\n\t *\n\t * @var array<string,mixed>\n\t *\/\n\tprotected $_summary;\n\n\t\/**\n\t * Init.\n\t *\n\t * @since 1.4\n\t *\/\n\tpublic function __construct() {\n\t\tif ( ! $this->conf( self::O_DISCUSS_AVATAR_CACHE ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug2( '[Avatar] init' );\n\n\t\t$this->_tb = $this->cls( 'Data' )->tb( 'avatar' );\n\n\t\t$this->_conf_cache_ttl = $this->conf( self::O_DISCUSS_AVATAR_CACHE_TTL );\n\n\t\tadd_filter( 'get_avatar_url', array( $this, 'crawl_avatar' ) );\n\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t\/**\n\t * Check whether DB table is needed.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @return bool\n\t *\/\n\tpublic function need_db() {\n\t\treturn (bool) $this->conf( self::O_DISCUSS_AVATAR_CACHE );\n\t}\n\n\t\/**\n\t * Serve static avatar by md5 (used by local static route).\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param string $md5 MD5 hash of original avatar URL.\n\t * @return void\n\t *\/\n\tpublic function serve_static( $md5 ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug( '[Avatar] is avatar request' );\n\n\t\tif ( strlen( $md5 ) !== 32 ) {\n\t\t\tself::debug( '[Avatar] wrong md5 ' . $md5 );\n\t\t\treturn;\n\t\t}\n\n\t\t$url = $wpdb->get_var( \/\/ phpcs:ignore WordPress.DB.DirectDatabaseQuery.DirectQuery, WordPress.DB.DirectDatabaseQuery.NoCaching\n\t\t\t$wpdb->prepare(\n\t\t\t\t'SELECT url FROM `' . $this->_tb . '` WHERE md5 = %s', \/\/ phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared\n\t\t\t\t$md5\n\t\t\t)\n\t\t);\n\n\t\tif ( ! $url ) {\n\t\t\tself::debug( '[Avatar] no matched url for md5 ' . $md5 );\n\t\t\treturn;\n\t\t}\n\n\t\t$url = $this->_generate( $url );\n\n\t\twp_safe_redirect( $url );\n\t\texit;\n\t}\n\n\t\/**\n\t * Localize\/replace avatar URL with cached one (filter callback).\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param string $url Original avatar URL.\n\t * @return string Rewritten\/cached avatar URL (or original).\n\t *\/\n\tpublic function crawl_avatar( $url ) {\n\t\tif ( ! $url ) {\n\t\t\treturn $url;\n\t\t}\n\n\t\t\/\/ Check if already generated in this request.\n\t\tif ( ! empty( $this->_avatar_realtime_gen_dict[ $url ] ) ) {\n\t\t\tself::debug2( '[Avatar] already in dict [url] ' . $url );\n\t\t\treturn $this->_avatar_realtime_gen_dict[ $url ];\n\t\t}\n\n\t\t$realpath = $this->_realpath( $url );\n\t\t$mtime    = file_exists( $realpath ) ? filemtime( $realpath ) : false;\n\n\t\tif ( $mtime && time() - $mtime <= $this->_conf_cache_ttl ) {\n\t\t\tself::debug2( '[Avatar] cache file exists [url] ' . $url );\n\t\t\treturn $this->_rewrite( $url, $mtime );\n\t\t}\n\n\t\t\/\/ Only handle gravatar or known remote avatar providers; keep generic check for \"gravatar.com\".\n\t\tif ( strpos( $url, 'gravatar.com' ) === false ) {\n\t\t\treturn $url;\n\t\t}\n\n\t\t\/\/ Throttle generation.\n\t\tif ( ! empty( $this->_summary['curr_request'] ) && time() - $this->_summary['curr_request'] < 300 ) {\n\t\t\tself::debug2( '[Avatar] Bypass generating due to interval limit [url] ' . $url );\n\t\t\treturn $url;\n\t\t}\n\n\t\t\/\/ Generate immediately and track for this request.\n\t\t$this->_avatar_realtime_gen_dict[ $url ] = $this->_generate( $url );\n\n\t\treturn $this->_avatar_realtime_gen_dict[ $url ];\n\t}\n\n\t\/**\n\t * Count queued avatars (expired ones) for cron.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @return int|false\n\t *\/\n\tpublic function queue_count() {\n\t\tglobal $wpdb;\n\n\t\t\/\/ If var not exists, means table not exists \/\/ todo: not true.\n\t\tif ( ! $this->_tb ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$cnt = $wpdb->get_var( \/\/ phpcs:ignore WordPress.DB.DirectDatabaseQuery.DirectQuery, WordPress.DB.DirectDatabaseQuery.NoCaching\n\t\t\t$wpdb->prepare(\n\t\t\t\t'SELECT COUNT(*) FROM `' . $this->_tb . '` WHERE dateline < %d', \/\/ phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared\n\t\t\t\ttime() - $this->_conf_cache_ttl\n\t\t\t)\n\t\t);\n\n\t\treturn (int) $cnt;\n\t}\n\n\t\/**\n\t * Build final local URL for cached avatar.\n\t *\n\t * @since 3.0\n\t * @param string   $url  Original URL.\n\t * @param int|null $time Optional filemtime for cache busting.\n\t * @return string Local URL.\n\t *\/\n\tprivate function _rewrite( $url, $time = null ) {\n\t\t$qs = $time ? '?ver=' . $time : '';\n\t\treturn LITESPEED_STATIC_URL . '\/avatar\/' . $this->_filepath( $url ) . $qs;\n\t}\n\n\t\/**\n\t * Generate filesystem realpath for cache file.\n\t *\n\t * @since 3.0\n\t * @access private\n\t * @param string $url Original URL.\n\t * @return string Absolute filesystem path.\n\t *\/\n\tprivate function _realpath( $url ) {\n\t\treturn LITESPEED_STATIC_DIR . '\/avatar\/' . $this->_filepath( $url );\n\t}\n\n\t\/**\n\t * Get relative filepath for cached avatar.\n\t *\n\t * @since 4.0\n\t * @param string $url Original URL.\n\t * @return string Relative path under avatar\/ (may include blog id).\n\t *\/\n\tprivate function _filepath( $url ) {\n\t\t$filename = md5( $url ) . '.jpg';\n\t\tif ( is_multisite() ) {\n\t\t\t$filename = get_current_blog_id() . '\/' . $filename;\n\t\t}\n\t\treturn $filename;\n\t}\n\n\t\/**\n\t * Cron generation for expired avatars.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param bool $force Bypass throttle.\n\t * @return void\n\t *\/\n\tpublic static function cron( $force = false ) {\n\t\tglobal $wpdb;\n\n\t\t$_instance = self::cls();\n\t\tif ( ! $_instance->queue_count() ) {\n\t\t\tself::debug( '[Avatar] no queue' );\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ For cron, need to check request interval too.\n\t\tif ( ! $force ) {\n\t\t\tif ( ! empty( $_instance->_summary['curr_request'] ) && time() - $_instance->_summary['curr_request'] < 300 ) {\n\t\t\t\tself::debug( '[Avatar] curr_request too close' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t$list = $wpdb->get_results( \/\/ phpcs:ignore WordPress.DB.DirectDatabaseQuery.DirectQuery, WordPress.DB.DirectDatabaseQuery.NoCaching\n\t\t\t$wpdb->prepare(\n\t\t\t\t'SELECT url FROM `' . $_instance->_tb . '` WHERE dateline < %d ORDER BY id DESC LIMIT %d', \/\/ phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared\n\t\t\t\ttime() - $_instance->_conf_cache_ttl,\n\t\t\t\t(int) apply_filters( 'litespeed_avatar_limit', 30 )\n\t\t\t)\n\t\t);\n\t\tself::debug( '[Avatar] cron job [count] ' . ( $list ? count( $list ) : 0 ) );\n\n\t\tif ( $list ) {\n\t\t\tforeach ( $list as $v ) {\n\t\t\t\tself::debug( '[Avatar] cron job [url] ' . $v->url );\n\t\t\t\t$_instance->_generate( $v->url );\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Download and store the avatar locally, then update DB row.\n\t *\n\t * @since 3.0\n\t * @access private\n\t * @param string $url Original avatar URL.\n\t * @return string Rewritten local URL (fallback to original on failure).\n\t *\/\n\tprivate function _generate( $url ) {\n\t\tglobal $wpdb;\n\n\t\t$file = $this->_realpath( $url );\n\n\t\t\/\/ Mark request start\n\t\tself::save_summary(\n\t\t\tarray(\n\t\t\t\t'curr_request' => time(),\n\t\t\t)\n\t\t);\n\n\t\t\/\/ Ensure cache directory exists\n\t\t$this->_maybe_mk_cache_folder( 'avatar' );\n\n\t\t$response = wp_safe_remote_get(\n\t\t\t$url,\n\t\t\tarray(\n\t\t\t\t'timeout'  => 180,\n\t\t\t\t'stream'   => true,\n\t\t\t\t'filename' => $file,\n\t\t\t)\n\t\t);\n\n\t\tself::debug( '[Avatar] _generate [url] ' . $url );\n\n\t\t\/\/ Parse response data\n\t\tif ( is_wp_error( $response ) ) {\n\t\t\t$error_message = $response->get_error_message();\n\t\t\tif ( file_exists( $file ) ) {\n\t\t\t\twp_delete_file( $file );\n\t\t\t}\n\t\t\tself::debug( '[Avatar] failed to get: ' . $error_message );\n\t\t\treturn $url;\n\t\t}\n\n\t\t\/\/ Save summary data\n\t\tself::save_summary(\n\t\t\tarray(\n\t\t\t\t'last_spent'   => time() - $this->_summary['curr_request'],\n\t\t\t\t'last_request' => $this->_summary['curr_request'],\n\t\t\t\t'curr_request' => 0,\n\t\t\t)\n\t\t);\n\n\t\t\/\/ Update\/insert DB record\n\t\t$md5 = md5( $url );\n\n\t\t$existed = $wpdb->query( \/\/ phpcs:ignore WordPress.DB.DirectDatabaseQuery.DirectQuery, WordPress.DB.DirectDatabaseQuery.NoCaching\n\t\t\t$wpdb->prepare(\n\t\t\t\t'UPDATE `' . $this->_tb . '` SET dateline = %d WHERE md5 = %s', \/\/ phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared\n\t\t\t\ttime(),\n\t\t\t\t$md5\n\t\t\t)\n\t\t);\n\n\t\tif ( ! $existed ) {\n\t\t\t$wpdb->query( \/\/ phpcs:ignore WordPress.DB.DirectDatabaseQuery.DirectQuery, WordPress.DB.DirectDatabaseQuery.NoCaching\n\t\t\t\t$wpdb->prepare(\n\t\t\t\t\t'INSERT INTO `' . $this->_tb . '` (url, md5, dateline) VALUES (%s, %s, %d)', \/\/ phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared\n\t\t\t\t\t$url,\n\t\t\t\t\t$md5,\n\t\t\t\t\ttime()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tself::debug( '[Avatar] saved avatar ' . $file );\n\n\t\treturn $this->_rewrite( $url );\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @return void\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ( $type ) {\n\t\t\tcase self::TYPE_GENERATE:\n\t\t\t\tself::cron( true );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/import.cls.php","ext":"php","size":4395,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The import\/export class.\n *\n * @since       1.8.2\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Import extends Base {\n\n\tprotected $_summary;\n\n\tconst TYPE_IMPORT = 'import';\n\tconst TYPE_EXPORT = 'export';\n\tconst TYPE_RESET  = 'reset';\n\n\t\/**\n\t * Init\n\t *\n\t * @since  1.8.2\n\t *\/\n\tpublic function __construct() {\n\t\tDebug2::debug('Import init');\n\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t\/**\n\t * Export settings to file\n\t *\n\t * @since 1.8.2\n\t * @since 7.3 added download content type\n\t * @access public\n\t *\/\n\tpublic function export( $only_data_return = false ) {\n\t\t$raw_data = $this->get_options(true);\n\n\t\t$data = array();\n\t\tforeach ($raw_data as $k => $v) {\n\t\t\t$data[] = \\json_encode(array( $k, $v ));\n\t\t}\n\n\t\t$data = implode(\"\\n\\n\", $data);\n\n\t\tif ($only_data_return) {\n\t\t\treturn $data;\n\t\t}\n\n\t\t$filename = $this->_generate_filename();\n\n\t\t\/\/ Update log\n\t\t$this->_summary['export_file'] = $filename;\n\t\t$this->_summary['export_time'] = time();\n\t\tself::save_summary();\n\n\t\tDebug2::debug('Import: Saved to ' . $filename);\n\n\t\t@header('Content-Type: application\/octet-stream');\n\t\t@header('Content-Disposition: attachment; filename=' . $filename);\n\t\techo $data;\n\n\t\texit();\n\t}\n\n\t\/**\n\t * Import settings from file\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t *\/\n\tpublic function import( $file = false ) {\n\t\tif (!$file) {\n\t\t\tif (empty($_FILES['ls_file']['name']) || substr($_FILES['ls_file']['name'], -5) != '.data' || empty($_FILES['ls_file']['tmp_name'])) {\n\t\t\t\tDebug2::debug('Import: Failed to import, wrong ls_file');\n\n\t\t\t\t$msg = __('Import failed due to file error.', 'litespeed-cache');\n\t\t\t\tAdmin_Display::error($msg);\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$this->_summary['import_file'] = $_FILES['ls_file']['name'];\n\n\t\t\t$data = file_get_contents($_FILES['ls_file']['tmp_name']);\n\t\t} else {\n\t\t\t$this->_summary['import_file'] = $file;\n\n\t\t\t$data = file_get_contents($file);\n\t\t}\n\n\t\t\/\/ Update log\n\t\t$this->_summary['import_time'] = time();\n\t\tself::save_summary();\n\n\t\t$ori_data = array();\n\t\ttry {\n\t\t\t\/\/ Check if the data is v4+ or not\n\t\t\tif (strpos($data, '[\"_version\",') === 0) {\n\t\t\t\tDebug2::debug('[Import] Data version: v4+');\n\t\t\t\t$data = explode(\"\\n\", $data);\n\t\t\t\tforeach ($data as $v) {\n\t\t\t\t\t$v = trim($v);\n\t\t\t\t\tif (!$v) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlist($k, $v)  = \\json_decode($v, true);\n\t\t\t\t\t$ori_data[$k] = $v;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$ori_data = \\json_decode(base64_decode($data), true);\n\t\t\t}\n\t\t} catch (\\Exception $ex) {\n\t\t\tDebug2::debug('[Import] \u274c Failed to parse serialized data');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$ori_data) {\n\t\t\tDebug2::debug('[Import] \u274c Failed to import, no data');\n\t\t\treturn false;\n\t\t} else {\n\t\t\tDebug2::debug('[Import] Importing data', $ori_data);\n\t\t}\n\n\t\t$this->cls('Conf')->update_confs($ori_data);\n\n\t\tif (!$file) {\n\t\t\tDebug2::debug('Import: Imported ' . $_FILES['ls_file']['name']);\n\n\t\t\t$msg = sprintf(__('Imported setting file %s successfully.', 'litespeed-cache'), $_FILES['ls_file']['name']);\n\t\t\tAdmin_Display::success($msg);\n\t\t} else {\n\t\t\tDebug2::debug('Import: Imported ' . $file);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Reset all configs to default values.\n\t *\n\t * @since  2.6.3\n\t * @access public\n\t *\/\n\tpublic function reset() {\n\t\t$options = $this->cls('Conf')->load_default_vals();\n\n\t\t$this->cls('Conf')->update_confs($options);\n\n\t\tDebug2::debug('[Import] Reset successfully.');\n\n\t\t$msg = __('Reset successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Generate the filename to export\n\t *\n\t * @since  1.8.2\n\t * @access private\n\t *\/\n\tprivate function _generate_filename() {\n\t\t\/\/ Generate filename\n\t\t$parsed_home = parse_url(get_home_url());\n\t\t$filename    = 'LSCWP_cfg-';\n\t\tif (!empty($parsed_home['host'])) {\n\t\t\t$filename .= $parsed_home['host'] . '_';\n\t\t}\n\n\t\tif (!empty($parsed_home['path'])) {\n\t\t\t$filename .= $parsed_home['path'] . '_';\n\t\t}\n\n\t\t$filename = str_replace('\/', '_', $filename);\n\n\t\t$filename .= '-' . date('Ymd_His') . '.data';\n\n\t\treturn $filename;\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_IMPORT:\n            $this->import();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_EXPORT:\n            $this->export();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESET:\n            $this->reset();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/media.cls.php","ext":"php","size":36074,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The class to operate media data.\n *\n * @since       1.4\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Media extends Root {\n\n\tconst LOG_TAG = '\ud83d\udcfa';\n\n\tconst LIB_FILE_IMG_LAZYLOAD = 'assets\/js\/lazyload.min.js';\n\n\tprivate $content;\n\tprivate $_wp_upload_dir;\n\tprivate $_vpi_preload_list = array();\n\tprivate $_format           = '';\n\tprivate $_sys_format       = '';\n\n\t\/**\n\t * Init\n\t *\n\t * @since  1.4\n\t *\/\n\tpublic function __construct() {\n\t\tDebug2::debug2('[Media] init');\n\n\t\t$this->_wp_upload_dir = wp_upload_dir();\n\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP)) {\n\t\t\t$this->_sys_format = 'webp';\n\t\t\t$this->_format     = 'webp';\n\t\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP) == 2) {\n\t\t\t\t$this->_sys_format = 'avif';\n\t\t\t\t$this->_format     = 'avif';\n\t\t\t}\n\t\t\tif (!$this->_browser_support_next_gen()) {\n\t\t\t\t$this->_format = '';\n\t\t\t}\n\t\t\t$this->_format = apply_filters('litespeed_next_gen_format', $this->_format);\n\t\t}\n\t}\n\n\t\/**\n\t * Hooks after user init\n\t *\n\t * @since 7.2\n\t * @since 7.4 Add media replace original with scaled.\n\t *\/\n\tpublic function after_user_init() {\n\t\t\/\/ Hook to attachment delete action (PR#844, Issue#841) for AJAX del compatibility\n\t\tadd_action('delete_attachment', array( $this, 'delete_attachment' ), 11, 2);\n\n\t\t\/\/ For big images, allow to replace original with scaled image.\n\t\tif( $this->conf(Base::O_MEDIA_AUTO_RESCALE_ORI) ){\n\t\t\t\/\/ Added priority 9 to happen before other functions added.\n\t\t\tadd_filter('wp_update_attachment_metadata', array( $this, 'rescale_ori' ), 9, 2);\n\t\t}\n\t}\n\n\t\/**\n\t * Init optm features\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function init() {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Due to ajax call doesn't send correct accept header, have to limit webp to HTML only\n\t\tif ($this->webp_support()) {\n\t\t\t\/\/ Hook to srcset\n\t\t\tif (function_exists('wp_calculate_image_srcset')) {\n\t\t\t\tadd_filter('wp_calculate_image_srcset', array( $this, 'webp_srcset' ), 988);\n\t\t\t}\n\t\t\t\/\/ Hook to mime icon\n\t\t\t\/\/ add_filter( 'wp_get_attachment_image_src', array( $this, 'webp_attach_img_src' ), 988 );\/\/ todo: need to check why not\n\t\t\t\/\/ add_filter( 'wp_get_attachment_url', array( $this, 'webp_url' ), 988 ); \/\/ disabled to avoid wp-admin display\n\t\t}\n\n\t\tif ($this->conf(Base::O_MEDIA_LAZY) && !$this->cls('Metabox')->setting('litespeed_no_image_lazy')) {\n\t\t\tself::debug('Suppress default WP lazyload');\n\t\t\tadd_filter('wp_lazy_loading_enabled', '__return_false');\n\t\t}\n\n\t\t\/**\n\t\t * Replace gravatar\n\t\t *\n\t\t * @since  3.0\n\t\t *\/\n\t\t$this->cls('Avatar');\n\n\t\tadd_filter('litespeed_buffer_finalize', array( $this, 'finalize' ), 4);\n\n\t\tadd_filter('litespeed_optm_html_head', array( $this, 'finalize_head' ));\n\t}\n\n\t\/**\n\t * Handle attachment create\n\t *\n\t * @param array $metadata Current meta array.\n\t * @param int $attachment_id Attachment ID.\n\t * @return array $metadata\n\t * @since  7.4\n\t *\/\n\tpublic function rescale_ori( $metadata, $attachment_id ) {\n\t\t\/\/ Test if create and image was resized.\n\t\tif( $metadata && isset($metadata['original_image']) && isset($metadata['file']) && false !== strstr($metadata['file'], '-scaled')){\n\t\t\t\/\/ Get rescaled file name.\n\t\t\t$path_exploded      = explode( '\/', strrev($metadata['file']), 2 );\n\t\t\t$rescaled_file_name = strrev($path_exploded[0]);\n\n\t\t\t\/\/ Create paths for images: resized and original.\n\t\t\t$base_path     = $this->_wp_upload_dir['basedir'] . $this->_wp_upload_dir['subdir'] . '\/';\n\t\t\t$rescaled_path = $base_path . $rescaled_file_name;\n\t\t\t$new_path      = $base_path . $metadata['original_image'];\n\n\t\t\t\/\/ Change array file key.\n\t\t\t$metadata['file'] = $this->_wp_upload_dir['subdir'] . '\/' . $metadata['original_image'];\n\t\t\tif( 0 === strpos( $metadata['file'], '\/' ) ){\n\t\t\t\t$metadata['file'] = substr( $metadata['file'], 1 );\n\t\t\t}\n\n\t\t\t\/\/ Delete array \"original_image\" key.\n\t\t\tunset($metadata['original_image']);\n\n\t\t\tif( file_exists( $rescaled_path ) && file_exists( $new_path ) ){\n\t\t\t\t\/\/ Move rescaled to original.\n\t\t\t\trename( $rescaled_path, $new_path );\n\n\t\t\t\t\/\/ Update meta \"_wp_attached_file\".\n\t\t\t\tupdate_post_meta( $attachment_id, '_wp_attached_file', $metadata['file'] );\n\t\t\t}\n\t\t}\n\n\t\treturn $metadata;\n\t}\n\n\t\/**\n\t * Add featured image to head\n\t *\/\n\tpublic function finalize_head( $content ) {\n\t\tglobal $wp_query;\n\n\t\t\/\/ <link rel=\"preload\" as=\"image\" href=\"xx\">\n\t\tif ($this->_vpi_preload_list) {\n\t\t\tforeach ($this->_vpi_preload_list as $v) {\n\t\t\t\t$content .= '<link rel=\"preload\" as=\"image\" href=\"' . Str::trim_quotes($v) . '\">';\n\t\t\t}\n\t\t}\n\t\t\/\/ $featured_image_url = get_the_post_thumbnail_url();\n\t\t\/\/ if ($featured_image_url) {\n\t\t\/\/ self::debug('Append featured image to head: ' . $featured_image_url);\n\t\t\/\/ if ($this->webp_support()) {\n\t\t\/\/ $featured_image_url = $this->replace_webp($featured_image_url) ?: $featured_image_url;\n\t\t\/\/ }\n\t\t\/\/ }\n\t\t\/\/ }\n\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Adjust WP default JPG quality\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function adjust_jpg_quality( $quality ) {\n\t\t$v = $this->conf(Base::O_IMG_OPTM_JPG_QUALITY);\n\n\t\tif ($v) {\n\t\t\treturn $v;\n\t\t}\n\n\t\treturn $quality;\n\t}\n\n\t\/**\n\t * Register admin menu\n\t *\n\t * @since 1.6.3\n\t * @access public\n\t *\/\n\tpublic function after_admin_init() {\n\t\t\/**\n\t\t * JPG quality control\n\t\t *\n\t\t * @since  3.0\n\t\t *\/\n\t\tadd_filter('jpeg_quality', array( $this, 'adjust_jpg_quality' ));\n\n\t\tadd_filter('manage_media_columns', array( $this, 'media_row_title' ));\n\t\tadd_filter('manage_media_custom_column', array( $this, 'media_row_actions' ), 10, 2);\n\n\t\tadd_action('litespeed_media_row', array( $this, 'media_row_con' ));\n\t}\n\n\t\/**\n\t * Media delete action hook\n\t *\n\t * @since 2.4.3\n\t * @access public\n\t *\/\n\tpublic static function delete_attachment( $post_id ) {\n\t\t\/\/ if (!Data::cls()->tb_exist('img_optm')) {\n\t\t\/\/ return;\n\t\t\/\/ }\n\n\t\tself::debug('delete_attachment [pid] ' . $post_id);\n\t\tImg_Optm::cls()->reset_row($post_id);\n\t}\n\n\t\/**\n\t * Return media file info if exists\n\t *\n\t * This is for remote attachment plugins\n\t *\n\t * @since 2.9.8\n\t * @access public\n\t *\/\n\tpublic function info( $short_file_path, $post_id ) {\n\t\t$short_file_path = wp_normalize_path($short_file_path);\n\t\t$basedir         = $this->_wp_upload_dir['basedir'] . '\/';\n\t\tif (strpos($short_file_path, $basedir) === 0) {\n\t\t\t$short_file_path = substr($short_file_path, strlen($basedir));\n\t\t}\n\n\t\t$real_file = $basedir . $short_file_path;\n\n\t\tif (file_exists($real_file)) {\n\t\t\treturn array(\n\t\t\t\t'url' => $this->_wp_upload_dir['baseurl'] . '\/' . $short_file_path,\n\t\t\t\t'md5' => md5_file($real_file),\n\t\t\t\t'size' => filesize($real_file),\n\t\t\t);\n\t\t}\n\n\t\t\/**\n\t\t * WP Stateless compatibility #143 https:\/\/github.com\/litespeedtech\/lscache_wp\/issues\/143\n\t\t *\n\t\t * @since 2.9.8\n\t\t * Should return array( 'url', 'md5', 'size' )\n\t\t *\/\n\t\t$info = apply_filters('litespeed_media_info', array(), $short_file_path, $post_id);\n\t\tif (!empty($info['url']) && !empty($info['md5']) && !empty($info['size'])) {\n\t\t\treturn $info;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Delete media file\n\t *\n\t * @since 2.9.8\n\t * @access public\n\t *\/\n\tpublic function del( $short_file_path, $post_id ) {\n\t\t$real_file = $this->_wp_upload_dir['basedir'] . '\/' . $short_file_path;\n\n\t\tif (file_exists($real_file)) {\n\t\t\tunlink($real_file);\n\t\t\tself::debug('deleted ' . $real_file);\n\t\t}\n\n\t\tdo_action('litespeed_media_del', $short_file_path, $post_id);\n\t}\n\n\t\/**\n\t * Rename media file\n\t *\n\t * @since 2.9.8\n\t * @access public\n\t *\/\n\tpublic function rename( $short_file_path, $short_file_path_new, $post_id ) {\n\t\t\/\/ self::debug('renaming ' . $short_file_path . ' -> ' . $short_file_path_new);\n\t\t$real_file     = $this->_wp_upload_dir['basedir'] . '\/' . $short_file_path;\n\t\t$real_file_new = $this->_wp_upload_dir['basedir'] . '\/' . $short_file_path_new;\n\n\t\tif (file_exists($real_file)) {\n\t\t\trename($real_file, $real_file_new);\n\t\t\tself::debug('renamed ' . $real_file . ' to ' . $real_file_new);\n\t\t}\n\n\t\tdo_action('litespeed_media_rename', $short_file_path, $short_file_path_new, $post_id);\n\t}\n\n\t\/**\n\t * Media Admin Menu -> Image Optimization Column Title\n\t *\n\t * @since 1.6.3\n\t * @access public\n\t *\/\n\tpublic function media_row_title( $posts_columns ) {\n\t\t$posts_columns['imgoptm'] = __('LiteSpeed Optimization', 'litespeed-cache');\n\n\t\treturn $posts_columns;\n\t}\n\n\t\/**\n\t * Media Admin Menu -> Image Optimization Column\n\t *\n\t * @since 1.6.2\n\t * @access public\n\t *\/\n\tpublic function media_row_actions( $column_name, $post_id ) {\n\t\tif ($column_name !== 'imgoptm') {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_media_row', $post_id);\n\t}\n\n\t\/**\n\t * Display image optm info\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function media_row_con( $post_id ) {\n\t\t$att_info = wp_get_attachment_metadata($post_id);\n\t\tif (empty($att_info['file'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$short_path = $att_info['file'];\n\n\t\t$size_meta = get_post_meta($post_id, Img_Optm::DB_SIZE, true);\n\n\t\techo '<p>';\n\t\t\/\/ Original image info\n\t\tif ($size_meta && !empty($size_meta['ori_saved'])) {\n\t\t\t$percent = ceil(($size_meta['ori_saved'] * 100) \/ $size_meta['ori_total']);\n\n\t\t\t$extension    = pathinfo($short_path, PATHINFO_EXTENSION);\n\t\t\t$bk_file      = substr($short_path, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\t$bk_optm_file = substr($short_path, 0, -strlen($extension)) . 'bk.optm.' . $extension;\n\n\t\t\t$link = Utility::build_url(Router::ACTION_IMG_OPTM, 'orig' . $post_id);\n\t\t\t$desc = false;\n\n\t\t\t$cls = '';\n\n\t\t\tif ($this->info($bk_file, $post_id)) {\n\t\t\t\t$curr_status = __('(optm)', 'litespeed-cache');\n\t\t\t\t$desc        = __('Currently using optimized version of file.', 'litespeed-cache') . '&#10;' . __('Click to switch to original (unoptimized) version.', 'litespeed-cache');\n\t\t\t} elseif ($this->info($bk_optm_file, $post_id)) {\n\t\t\t\t$cls        .= ' litespeed-warning';\n\t\t\t\t$curr_status = __('(non-optm)', 'litespeed-cache');\n\t\t\t\t$desc        = __('Currently using original (unoptimized) version of file.', 'litespeed-cache') . '&#10;' . __('Click to switch to optimized version.', 'litespeed-cache');\n\t\t\t}\n\n\t\t\techo GUI::pie_tiny(\n\t\t\t\t$percent,\n\t\t\t\t24,\n\t\t\t\tsprintf(__('Original file reduced by %1$s (%2$s)', 'litespeed-cache'), $percent . '%', Utility::real_size($size_meta['ori_saved'])),\n\t\t\t\t'left'\n\t\t\t);\n\n\t\t\tprintf(__('Orig saved %s', 'litespeed-cache'), $percent . '%');\n\n\t\t\tif ($desc) {\n\t\t\t\tprintf(' <a href=\"%1$s\" class=\"litespeed-media-href %2$s\" data-balloon-pos=\"left\" data-balloon-break aria-label=\"%3$s\">%4$s<\/a>', $link, $cls, $desc, $curr_status);\n\t\t\t} else {\n\t\t\t\tprintf(\n\t\t\t\t\t' <span class=\"litespeed-desc\" data-balloon-pos=\"left\" data-balloon-break aria-label=\"%1$s\">%2$s<\/span>',\n\t\t\t\t\t__('Using optimized version of file. ', 'litespeed-cache') . '&#10;' . __('No backup of original file exists.', 'litespeed-cache'),\n\t\t\t\t\t__('(optm)', 'litespeed-cache')\n\t\t\t\t);\n\t\t\t}\n\t\t} elseif ($size_meta && $size_meta['ori_saved'] === 0) {\n\t\t\techo GUI::pie_tiny(0, 24, __('Congratulation! Your file was already optimized', 'litespeed-cache'), 'left');\n\t\t\tprintf(__('Orig %s', 'litespeed-cache'), '<span class=\"litespeed-desc\">' . __('(no savings)', 'litespeed-cache') . '<\/span>');\n\t\t} else {\n\t\t\techo __('Orig', 'litespeed-cache') . '<span class=\"litespeed-left10\">\u2014<\/span>';\n\t\t}\n\t\techo '<\/p>';\n\n\t\techo '<p>';\n\t\t\/\/ WebP\/AVIF info\n\t\tif ($size_meta && $this->webp_support(true) && !empty($size_meta[$this->_sys_format . '_saved'])) {\n\t\t\t$is_avif         = 'avif' === $this->_sys_format;\n\t\t\t$size_meta_saved = $size_meta[$this->_sys_format . '_saved'];\n\t\t\t$size_meta_total = $size_meta[$this->_sys_format . '_total'];\n\n\t\t\t$percent = ceil(($size_meta_saved * 100) \/ $size_meta_total);\n\n\t\t\t$link = Utility::build_url(Router::ACTION_IMG_OPTM, $this->_sys_format . $post_id);\n\t\t\t$desc = false;\n\n\t\t\t$cls = '';\n\n\t\t\tif ($this->info($short_path . '.' . $this->_sys_format, $post_id)) {\n\t\t\t\t$curr_status = __('(optm)', 'litespeed-cache');\n\t\t\t\t$desc        = $is_avif\n\t\t\t\t\t? __('Currently using optimized version of AVIF file.', 'litespeed-cache')\n\t\t\t\t\t: __('Currently using optimized version of WebP file.', 'litespeed-cache');\n\t\t\t\t$desc       .= '&#10;' . __('Click to switch to original (unoptimized) version.', 'litespeed-cache');\n\t\t\t} elseif ($this->info($short_path . '.optm.' . $this->_sys_format, $post_id)) {\n\t\t\t\t$cls        .= ' litespeed-warning';\n\t\t\t\t$curr_status = __('(non-optm)', 'litespeed-cache');\n\t\t\t\t$desc        = $is_avif\n\t\t\t\t\t? __('Currently using original (unoptimized) version of AVIF file.', 'litespeed-cache')\n\t\t\t\t\t: __('Currently using original (unoptimized) version of WebP file.', 'litespeed-cache');\n\t\t\t\t$desc       .= '&#10;' . __('Click to switch to optimized version.', 'litespeed-cache');\n\t\t\t}\n\n\t\t\techo GUI::pie_tiny(\n\t\t\t\t$percent,\n\t\t\t\t24,\n\t\t\t\tsprintf(\n\t\t\t\t\t$is_avif ? __('AVIF file reduced by %1$s (%2$s)', 'litespeed-cache') : __('WebP file reduced by %1$s (%2$s)', 'litespeed-cache'),\n\t\t\t\t\t$percent . '%',\n\t\t\t\t\tUtility::real_size($size_meta_saved)\n\t\t\t\t),\n\t\t\t\t'left'\n\t\t\t);\n\t\t\tprintf($is_avif ? __('AVIF saved %s', 'litespeed-cache') : __('WebP saved %s', 'litespeed-cache'), $percent . '%');\n\n\t\t\tif ($desc) {\n\t\t\t\tprintf(' <a href=\"%1$s\" class=\"litespeed-media-href %2$s\" data-balloon-pos=\"left\" data-balloon-break aria-label=\"%3$s\">%4$s<\/a>', $link, $cls, $desc, $curr_status);\n\t\t\t} else {\n\t\t\t\tprintf(\n\t\t\t\t\t' <span class=\"litespeed-desc\" data-balloon-pos=\"left\" data-balloon-break aria-label=\"%1$s&#10;%2$s\">%3$s<\/span>',\n\t\t\t\t\t__('Using optimized version of file. ', 'litespeed-cache'),\n\t\t\t\t\t$is_avif ? __('No backup of unoptimized AVIF file exists.', 'litespeed-cache') : __('No backup of unoptimized WebP file exists.', 'litespeed-cache'),\n\t\t\t\t\t__('(optm)', 'litespeed-cache')\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\techo $this->next_gen_image_title() . '<span class=\"litespeed-left10\">\u2014<\/span>';\n\t\t}\n\n\t\techo '<\/p>';\n\n\t\t\/\/ Delete row btn\n\t\tif ($size_meta) {\n\t\t\tprintf(\n\t\t\t\t'<div class=\"row-actions\"><span class=\"delete\"><a href=\"%1$s\" class=\"\">%2$s<\/a><\/span><\/div>',\n\t\t\t\tUtility::build_url(Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RESET_ROW, false, null, array( 'id' => $post_id )),\n\t\t\t\t__('Restore from backup', 'litespeed-cache')\n\t\t\t);\n\t\t\techo '<\/div>';\n\t\t}\n\t}\n\n\t\/**\n\t * Get wp size info\n\t *\n\t * NOTE: this is not used because it has to be after admin_init\n\t *\n\t * @since 1.6.2\n\t * @return array $sizes Data for all currently-registered image sizes.\n\t *\/\n\tpublic function get_image_sizes() {\n\t\tglobal $_wp_additional_image_sizes;\n\t\t$sizes = array();\n\n\t\tforeach (get_intermediate_image_sizes() as $_size) {\n\t\t\tif (in_array($_size, array( 'thumbnail', 'medium', 'medium_large', 'large' ))) {\n\t\t\t\t$sizes[$_size]['width']  = get_option($_size . '_size_w');\n\t\t\t\t$sizes[$_size]['height'] = get_option($_size . '_size_h');\n\t\t\t\t$sizes[$_size]['crop']   = (bool) get_option($_size . '_crop');\n\t\t\t} elseif (isset($_wp_additional_image_sizes[$_size])) {\n\t\t\t\t$sizes[$_size] = array(\n\t\t\t\t\t'width' => $_wp_additional_image_sizes[$_size]['width'],\n\t\t\t\t\t'height' => $_wp_additional_image_sizes[$_size]['height'],\n\t\t\t\t\t'crop' => $_wp_additional_image_sizes[$_size]['crop'],\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn $sizes;\n\t}\n\n\t\/**\n\t * Exclude role from optimization filter\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t *\/\n\tpublic function webp_support( $sys_level = false ) {\n\t\tif ($sys_level) {\n\t\t\treturn $this->_sys_format;\n\t\t}\n\t\treturn $this->_format; \/\/ User level next gen support\n\t}\n\tprivate function _browser_support_next_gen() {\n\t\tif (!empty($_SERVER['HTTP_ACCEPT'])) {\n\t\t\tif (strpos($_SERVER['HTTP_ACCEPT'], 'image\/' . $this->_sys_format) !== false) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tif (!empty($_SERVER['HTTP_USER_AGENT'])) {\n\t\t\t$user_agents = array( 'chrome-lighthouse', 'googlebot', 'page speed' );\n\t\t\tforeach ($user_agents as $user_agent) {\n\t\t\t\tif (stripos($_SERVER['HTTP_USER_AGENT'], $user_agent) !== false) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (preg_match('\/iPhone OS (\\d+)_\/i', $_SERVER['HTTP_USER_AGENT'], $matches)) {\n\t\t\t\tif ($matches[1] >= 14) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (preg_match('\/Firefox\\\/(\\d+)\/i', $_SERVER['HTTP_USER_AGENT'], $matches)) {\n\t\t\t\tif ($matches[1] >= 65) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Get next gen image title\n\t *\n\t * @since 7.0\n\t *\/\n\tpublic function next_gen_image_title() {\n\t\t$next_gen_img = 'WebP';\n\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP) == 2) {\n\t\t\t$next_gen_img = 'AVIF';\n\t\t}\n\t\treturn $next_gen_img;\n\t}\n\n\t\/**\n\t * Run lazy load process\n\t * NOTE: As this is after cache finalized, can NOT set any cache control anymore\n\t *\n\t * Only do for main page. Do NOT do for esi or dynamic content.\n\t *\n\t * @since  1.4\n\t * @access public\n\t * @return  string The buffer\n\t *\/\n\tpublic function finalize( $content ) {\n\t\tif (defined('LITESPEED_NO_LAZY')) {\n\t\t\tDebug2::debug2('[Media] bypass: NO_LAZY const');\n\t\t\treturn $content;\n\t\t}\n\n\t\tif (!defined('LITESPEED_IS_HTML')) {\n\t\t\tDebug2::debug2('[Media] bypass: Not frontend HTML type');\n\t\t\treturn $content;\n\t\t}\n\n\t\tif (!Control::is_cacheable()) {\n\t\t\tself::debug('bypass: Not cacheable');\n\t\t\treturn $content;\n\t\t}\n\n\t\tself::debug('finalize');\n\n\t\t$this->content = $content;\n\t\t$this->_finalize();\n\t\treturn $this->content;\n\t}\n\n\t\/**\n\t * Run lazyload replacement for images in buffer\n\t *\n\t * @since  1.4\n\t * @access private\n\t *\/\n\tprivate function _finalize() {\n\t\t\/**\n\t\t * Use webp for optimized images\n\t\t *\n\t\t * @since 1.6.2\n\t\t *\/\n\t\tif ($this->webp_support()) {\n\t\t\t$this->content = $this->_replace_buffer_img_webp($this->content);\n\t\t}\n\n\t\t\/**\n\t\t * Check if URI is excluded\n\t\t *\n\t\t * @since  3.0\n\t\t *\/\n\t\t$excludes = $this->conf(Base::O_MEDIA_LAZY_URI_EXC);\n\t\tif (!defined('LITESPEED_GUEST_OPTM')) {\n\t\t\t$result = Utility::str_hit_array($_SERVER['REQUEST_URI'], $excludes);\n\t\t\tif ($result) {\n\t\t\t\tself::debug('bypass lazyload: hit URI Excludes setting: ' . $result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t$cfg_lazy          = (defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_MEDIA_LAZY)) && !$this->cls('Metabox')->setting('litespeed_no_image_lazy');\n\t\t$cfg_iframe_lazy   = defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_MEDIA_IFRAME_LAZY);\n\t\t$cfg_js_delay      = defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_OPTM_JS_DEFER) == 2;\n\t\t$cfg_trim_noscript = defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_OPTM_NOSCRIPT_RM);\n\t\t$cfg_vpi           = defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_MEDIA_VPI);\n\n\t\t\/\/ Preload VPI\n\t\tif ($cfg_vpi) {\n\t\t\t$this->_parse_img_for_preload();\n\t\t}\n\n\t\tif ($cfg_lazy) {\n\t\t\tif ($cfg_vpi) {\n\t\t\t\tadd_filter('litespeed_media_lazy_img_excludes', array( $this->cls('Metabox'), 'lazy_img_excludes' ));\n\t\t\t}\n\t\t\tlist($src_list, $html_list, $placeholder_list) = $this->_parse_img();\n\t\t\t$html_list_ori                                 = $html_list;\n\t\t} else {\n\t\t\tself::debug('lazyload disabled');\n\t\t}\n\n\t\t\/\/ image lazy load\n\t\tif ($cfg_lazy) {\n\t\t\t$__placeholder = Placeholder::cls();\n\n\t\t\tforeach ($html_list as $k => $v) {\n\t\t\t\t$size = $placeholder_list[$k];\n\t\t\t\t$src  = $src_list[$k];\n\n\t\t\t\t$html_list[$k] = $__placeholder->replace($v, $src, $size);\n\t\t\t}\n\t\t}\n\n\t\tif ($cfg_lazy) {\n\t\t\t$this->content = str_replace($html_list_ori, $html_list, $this->content);\n\t\t}\n\n\t\t\/\/ iframe lazy load\n\t\tif ($cfg_iframe_lazy) {\n\t\t\t$html_list     = $this->_parse_iframe();\n\t\t\t$html_list_ori = $html_list;\n\n\t\t\tforeach ($html_list as $k => $v) {\n\t\t\t\t$snippet = $cfg_trim_noscript ? '' : '<noscript>' . $v . '<\/noscript>';\n\t\t\t\tif ($cfg_js_delay) {\n\t\t\t\t\t$v = str_replace(' src=', ' data-litespeed-src=', $v);\n\t\t\t\t} else {\n\t\t\t\t\t$v = str_replace(' src=', ' data-src=', $v);\n\t\t\t\t}\n\t\t\t\t$v       = str_replace('<iframe ', '<iframe data-lazyloaded=\"1\" src=\"about:blank\" ', $v);\n\t\t\t\t$snippet = $v . $snippet;\n\n\t\t\t\t$html_list[$k] = $snippet;\n\t\t\t}\n\n\t\t\t$this->content = str_replace($html_list_ori, $html_list, $this->content);\n\t\t}\n\n\t\t\/\/ Include lazyload lib js and init lazyload\n\t\tif ($cfg_lazy || $cfg_iframe_lazy) {\n\t\t\t$lazy_lib      = '<script data-no-optimize=\"1\">window.lazyLoadOptions=Object.assign({},{threshold:' . apply_filters('litespeed_lazyload_threshold', 300) . '},window.lazyLoadOptions||{});' . File::read(LSCWP_DIR . self::LIB_FILE_IMG_LAZYLOAD) . '<\/script>';\n\t\t\tif ($cfg_js_delay) {\n\t\t\t\t\/\/ Load JS delay lib\n\t\t\t\tif (!defined('LITESPEED_JS_DELAY_LIB_LOADED')) {\n\t\t\t\t\tdefine('LITESPEED_JS_DELAY_LIB_LOADED', true);\n\t\t\t\t\t$lazy_lib .= '<script data-no-optimize=\"1\">' . File::read(LSCWP_DIR . Optimize::LIB_FILE_JS_DELAY) . '<\/script>';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$this->content = str_replace('<\/body>', $lazy_lib . '<\/body>', $this->content);\n\t\t}\n\t}\n\n\t\/**\n\t * Parse img src for VPI preload only\n\t * Note: Didn't reuse the _parse_img() bcoz it contains parent cls replacement and other logic which is not needed for preload\n\t *\n\t * @since 6.2\n\t *\/\n\tprivate function _parse_img_for_preload() {\n\t\t\/\/ Load VPI setting\n\t\t$is_mobile = $this->_separate_mobile();\n\t\t$vpi_files = $this->cls('Metabox')->setting($is_mobile ? 'litespeed_vpi_list_mobile' : 'litespeed_vpi_list');\n\t\tif ($vpi_files) {\n\t\t\t$vpi_files = Utility::sanitize_lines($vpi_files, 'basename');\n\t\t}\n\t\tif (!$vpi_files) {\n\t\t\treturn;\n\t\t}\n\t\tif (!$this->content) {\n\t\t\treturn;\n\t\t}\n\n\t\t$content = preg_replace(array( '#<!--.*-->#sU', '#<noscript([^>]*)>.*<\/noscript>#isU' ), '', $this->content);\n\t\tif (!$content) {\n\t\t\treturn;\n\t\t}\n\n\t\tpreg_match_all('#<img\\s+([^>]+)\/?>#isU', $content, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$attrs = Utility::parse_attr($match[1]);\n\n\t\t\tif (empty($attrs['src'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (strpos($attrs['src'], 'base64') !== false || substr($attrs['src'], 0, 5) === 'data:') {\n\t\t\t\tDebug2::debug2('[Media] lazyload bypassed base64 img');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (strpos($attrs['src'], '{') !== false) {\n\t\t\t\tDebug2::debug2('[Media] image src has {} ' . $attrs['src']);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ If the src contains VPI filename, then preload it\n\t\t\tif (!Utility::str_hit_array($attrs['src'], $vpi_files)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tDebug2::debug2('[Media] VPI preload found and matched: ' . $attrs['src']);\n\n\t\t\t$this->_vpi_preload_list[] = $attrs['src'];\n\t\t}\n\t}\n\n\t\/**\n\t * Parse img src\n\t *\n\t * @since  1.4\n\t * @access private\n\t * @return array  All the src & related raw html list\n\t *\/\n\tprivate function _parse_img() {\n\t\t\/**\n\t\t * Exclude list\n\t\t *\n\t\t * @since 1.5\n\t\t * @since  2.7.1 Changed to array\n\t\t *\/\n\t\t$excludes = apply_filters('litespeed_media_lazy_img_excludes', $this->conf(Base::O_MEDIA_LAZY_EXC));\n\n\t\t$cls_excludes   = apply_filters('litespeed_media_lazy_img_cls_excludes', $this->conf(Base::O_MEDIA_LAZY_CLS_EXC));\n\t\t$cls_excludes[] = 'skip-lazy'; \/\/ https:\/\/core.trac.wordpress.org\/ticket\/44427\n\n\t\t$src_list         = array();\n\t\t$html_list        = array();\n\t\t$placeholder_list = array();\n\n\t\t$content = preg_replace(\n\t\t\tarray(\n\t\t\t\t'#<!--.*-->#sU',\n\t\t\t\t'#<noscript([^>]*)>.*<\/noscript>#isU',\n\t\t\t\t'#<script([^>]*)>.*<\/script>#isU', \/\/ Added to remove warning of file not found when image size detection is turned ON.\n\t\t\t),\n\t\t\t'',\n\t\t\t$this->content\n\t\t);\n\t\t\/**\n\t\t * Exclude parent classes\n\t\t *\n\t\t * @since  3.0\n\t\t *\/\n\t\t$parent_cls_exc = apply_filters('litespeed_media_lazy_img_parent_cls_excludes', $this->conf(Base::O_MEDIA_LAZY_PARENT_CLS_EXC));\n\t\tif ($parent_cls_exc) {\n\t\t\tDebug2::debug2('[Media] Lazyload Class excludes', $parent_cls_exc);\n\t\t\tforeach ($parent_cls_exc as $v) {\n\t\t\t\t$content = preg_replace('#<(\\w+) [^>]*class=(\\'|\")[^\\'\"]*' . preg_quote($v, '#') . '[^\\'\"]*\\2[^>]*>.*<\/\\1>#sU', '', $content);\n\t\t\t}\n\t\t}\n\n\t\tpreg_match_all('#<img\\s+([^>]+)\/?>#isU', $content, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$attrs = Utility::parse_attr($match[1]);\n\n\t\t\tif (empty($attrs['src'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/**\n\t\t\t * Add src validation to bypass base64 img src\n\t\t\t *\n\t\t\t * @since  1.6\n\t\t\t *\/\n\t\t\tif (strpos($attrs['src'], 'base64') !== false || substr($attrs['src'], 0, 5) === 'data:') {\n\t\t\t\tDebug2::debug2('[Media] lazyload bypassed base64 img');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tDebug2::debug2('[Media] lazyload found: ' . $attrs['src']);\n\n\t\t\tif (\n\t\t\t\t!empty($attrs['data-no-lazy']) ||\n\t\t\t\t!empty($attrs['data-skip-lazy']) ||\n\t\t\t\t!empty($attrs['data-lazyloaded']) ||\n\t\t\t\t!empty($attrs['data-src']) ||\n\t\t\t\t!empty($attrs['data-srcset'])\n\t\t\t) {\n\t\t\t\tDebug2::debug2('[Media] bypassed');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!empty($attrs['class']) && ($hit = Utility::str_hit_array($attrs['class'], $cls_excludes))) {\n\t\t\t\tDebug2::debug2('[Media] lazyload image cls excludes [hit] ' . $hit);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/**\n\t\t\t * Exclude from lazyload by setting\n\t\t\t *\n\t\t\t * @since  1.5\n\t\t\t *\/\n\t\t\tif ($excludes && Utility::str_hit_array($attrs['src'], $excludes)) {\n\t\t\t\tDebug2::debug2('[Media] lazyload image exclude ' . $attrs['src']);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/**\n\t\t\t * Excldues invalid image src from buddypress avatar crop\n\t\t\t *\n\t\t\t * @see  https:\/\/wordpress.org\/support\/topic\/lazy-load-breaking-buddypress-upload-avatar-feature\n\t\t\t * @since  3.0\n\t\t\t *\/\n\t\t\tif (strpos($attrs['src'], '{') !== false) {\n\t\t\t\tDebug2::debug2('[Media] image src has {} ' . $attrs['src']);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ to avoid multiple replacement\n\t\t\tif (in_array($match[0], $html_list)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Add missing dimensions\n\t\t\tif (defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_MEDIA_ADD_MISSING_SIZES)) {\n\t\t\t\tif (!apply_filters('litespeed_media_add_missing_sizes', true)) {\n\t\t\t\t\tDebug2::debug2('[Media] add_missing_sizes bypassed via litespeed_media_add_missing_sizes filter');\n\t\t\t\t} elseif (empty($attrs['width']) || $attrs['width'] == 'auto' || empty($attrs['height']) || $attrs['height'] == 'auto') {\n\t\t\t\t\tself::debug('\u26a0\ufe0f Missing sizes for image [src] ' . $attrs['src']);\n\t\t\t\t\t$dimensions = $this->_detect_dimensions($attrs['src']);\n\t\t\t\t\tif ($dimensions) {\n\t\t\t\t\t\t$ori_width  = $dimensions[0];\n\t\t\t\t\t\t$ori_height = $dimensions[1];\n\t\t\t\t\t\t\/\/ Calculate height based on width\n\t\t\t\t\t\tif (!empty($attrs['width']) && $attrs['width'] != 'auto') {\n\t\t\t\t\t\t\t$ori_height = intval(($ori_height * $attrs['width']) \/ $ori_width);\n\t\t\t\t\t\t} elseif (!empty($attrs['height']) && $attrs['height'] != 'auto') {\n\t\t\t\t\t\t\t$ori_width = intval(($ori_width * $attrs['height']) \/ $ori_height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$attrs['width']  = $ori_width;\n\t\t\t\t\t\t$attrs['height'] = $ori_height;\n\t\t\t\t\t\t$new_html        = preg_replace('#\\s+(width|height)=([\"\\'])[^\\2]*?\\2#', '', $match[0]);\n\t\t\t\t\t\t$new_html        = preg_replace(\n\t\t\t\t\t\t\t'#<img\\s+#i',\n\t\t\t\t\t\t\t'<img width=\"' . Str::trim_quotes($attrs['width']) . '\" height=\"' . Str::trim_quotes($attrs['height']) . '\" ',\n\t\t\t\t\t\t\t$new_html\n\t\t\t\t\t\t);\n\t\t\t\t\t\tself::debug('Add missing sizes ' . $attrs['width'] . 'x' . $attrs['height'] . ' to ' . $attrs['src']);\n\t\t\t\t\t\t$this->content = str_replace($match[0], $new_html, $this->content);\n\t\t\t\t\t\t$match[0]      = $new_html;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$placeholder = false;\n\t\t\tif (!empty($attrs['width']) && $attrs['width'] != 'auto' && !empty($attrs['height']) && $attrs['height'] != 'auto') {\n\t\t\t\t$placeholder = intval($attrs['width']) . 'x' . intval($attrs['height']);\n\t\t\t}\n\n\t\t\t$src_list[]         = $attrs['src'];\n\t\t\t$html_list[]        = $match[0];\n\t\t\t$placeholder_list[] = $placeholder;\n\t\t}\n\n\t\treturn array( $src_list, $html_list, $placeholder_list );\n\t}\n\n\t\/**\n\t * Detect the original sizes\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _detect_dimensions( $src ) {\n\t\tif ($pathinfo = Utility::is_internal_file($src)) {\n\t\t\t$src = $pathinfo[0];\n\t\t} elseif (apply_filters('litespeed_media_ignore_remote_missing_sizes', false)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (substr($src, 0, 2) == '\/\/') {\n\t\t\t$src = 'https:' . $src;\n\t\t}\n\n\t\ttry {\n\t\t\t$sizes = getimagesize($src);\n\t\t} catch (\\Exception $e) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!empty($sizes[0]) && !empty($sizes[1])) {\n\t\t\treturn $sizes;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Parse iframe src\n\t *\n\t * @since  1.4\n\t * @access private\n\t * @return array  All the src & related raw html list\n\t *\/\n\tprivate function _parse_iframe() {\n\t\t$cls_excludes   = apply_filters('litespeed_media_iframe_lazy_cls_excludes', $this->conf(Base::O_MEDIA_IFRAME_LAZY_CLS_EXC));\n\t\t$cls_excludes[] = 'skip-lazy'; \/\/ https:\/\/core.trac.wordpress.org\/ticket\/44427\n\n\t\t$html_list = array();\n\n\t\t$content = preg_replace('#<!--.*-->#sU', '', $this->content);\n\n\t\t\/**\n\t\t * Exclude parent classes\n\t\t *\n\t\t * @since  3.0\n\t\t *\/\n\t\t$parent_cls_exc = apply_filters('litespeed_media_iframe_lazy_parent_cls_excludes', $this->conf(Base::O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC));\n\t\tif ($parent_cls_exc) {\n\t\t\tDebug2::debug2('[Media] Iframe Lazyload Class excludes', $parent_cls_exc);\n\t\t\tforeach ($parent_cls_exc as $v) {\n\t\t\t\t$content = preg_replace('#<(\\w+) [^>]*class=(\\'|\")[^\\'\"]*' . preg_quote($v, '#') . '[^\\'\"]*\\2[^>]*>.*<\/\\1>#sU', '', $content);\n\t\t\t}\n\t\t}\n\n\t\tpreg_match_all('#<iframe \\s*([^>]+)><\/iframe>#isU', $content, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$attrs = Utility::parse_attr($match[1]);\n\n\t\t\tif (empty($attrs['src'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tDebug2::debug2('[Media] found iframe: ' . $attrs['src']);\n\n\t\t\tif (!empty($attrs['data-no-lazy']) || !empty($attrs['data-skip-lazy']) || !empty($attrs['data-lazyloaded']) || !empty($attrs['data-src'])) {\n\t\t\t\tDebug2::debug2('[Media] bypassed');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!empty($attrs['class']) && ($hit = Utility::str_hit_array($attrs['class'], $cls_excludes))) {\n\t\t\t\tDebug2::debug2('[Media] iframe lazyload cls excludes [hit] ' . $hit);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (apply_filters('litespeed_iframe_lazyload_exc', false, $attrs['src'])) {\n\t\t\t\tDebug2::debug2('[Media] bypassed by filter');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ to avoid multiple replacement\n\t\t\tif (in_array($match[0], $html_list)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$html_list[] = $match[0];\n\t\t}\n\n\t\treturn $html_list;\n\t}\n\n\t\/**\n\t * Replace image src to webp\n\t *\n\t * @since  1.6.2\n\t * @access private\n\t *\/\n\tprivate function _replace_buffer_img_webp( $content ) {\n\t\t\/**\n\t\t * Added custom element & attribute support\n\t\t *\n\t\t * @since 2.2.2\n\t\t *\/\n\t\t$webp_ele_to_check = $this->conf(Base::O_IMG_OPTM_WEBP_ATTR);\n\n\t\tforeach ($webp_ele_to_check as $v) {\n\t\t\tif (!$v || strpos($v, '.') === false) {\n\t\t\t\tDebug2::debug2('[Media] buffer_webp no . attribute ' . $v);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tDebug2::debug2('[Media] buffer_webp attribute ' . $v);\n\n\t\t\t$v    = explode('.', $v);\n\t\t\t$attr = preg_quote($v[1], '#');\n\t\t\tif ($v[0]) {\n\t\t\t\t$pattern = '#<' . preg_quote($v[0], '#') . '([^>]+)' . $attr . '=([\\'\"])(.+)\\2#iU';\n\t\t\t} else {\n\t\t\t\t$pattern = '# ' . $attr . '=([\\'\"])(.+)\\1#iU';\n\t\t\t}\n\n\t\t\tpreg_match_all($pattern, $content, $matches);\n\n\t\t\tforeach ($matches[$v[0] ? 3 : 2] as $k2 => $url) {\n\t\t\t\t\/\/ Check if is a DATA-URI\n\t\t\t\tif (strpos($url, 'data:image') !== false) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!($url2 = $this->replace_webp($url))) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ($v[0]) {\n\t\t\t\t\t$html_snippet = sprintf('<' . $v[0] . '%1$s' . $v[1] . '=%2$s', $matches[1][$k2], $matches[2][$k2] . $url2 . $matches[2][$k2]);\n\t\t\t\t} else {\n\t\t\t\t\t$html_snippet = sprintf(' ' . $v[1] . '=%1$s', $matches[1][$k2] . $url2 . $matches[1][$k2]);\n\t\t\t\t}\n\n\t\t\t\t$content = str_replace($matches[0][$k2], $html_snippet, $content);\n\t\t\t}\n\t\t}\n\n\t\t\/\/ parse srcset\n\t\t\/\/ todo: should apply this to cdn too\n\t\tif ((defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_IMG_OPTM_WEBP_REPLACE_SRCSET)) && $this->webp_support()) {\n\t\t\t$content = Utility::srcset_replace($content, array( $this, 'replace_webp' ));\n\t\t}\n\n\t\t\/\/ Replace background-image\n\t\tif ((defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_IMG_OPTM_WEBP)) && $this->webp_support()) {\n\t\t\t$content = $this->replace_background_webp($content);\n\t\t}\n\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Replace background image\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function replace_background_webp( $content ) {\n\t\tDebug2::debug2('[Media] Start replacing background WebP\/AVIF.');\n\n\t\t\/\/ Handle Elementors data-settings json encode background-images\n\t\t$content = $this->replace_urls_in_json($content);\n\n\t\t\/\/ preg_match_all( '#background-image:(\\s*)url\\((.*)\\)#iU', $content, $matches );\n\t\tpreg_match_all('#url\\(([^)]+)\\)#iU', $content, $matches);\n\t\tforeach ($matches[1] as $k => $url) {\n\t\t\t\/\/ Check if is a DATA-URI\n\t\t\tif (strpos($url, 'data:image') !== false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/**\n\t\t\t * Support quotes in src `background-image: url('src')`\n\t\t\t *\n\t\t\t * @since 2.9.3\n\t\t\t *\/\n\t\t\t$url = trim($url, '\\'\"');\n\n\t\t\t\/\/ Fix Elementors Slideshow unusual background images like  style=\"background-image: url(&quot;https:\/\/xxxx.png&quot;);\"\n\t\t\tif (strpos($url, '&quot;') === 0 && substr($url, -6) == '&quot;') {\n\t\t\t\t$url = substr($url, 6, -6);\n\t\t\t}\n\n\t\t\tif (!($url2 = $this->replace_webp($url))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ $html_snippet = sprintf( 'background-image:%1$surl(%2$s)', $matches[ 1 ][ $k ], $url2 );\n\t\t\t$html_snippet = str_replace($url, $url2, $matches[0][$k]);\n\t\t\t$content      = str_replace($matches[0][$k], $html_snippet, $content);\n\t\t}\n\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Replace images in json data settings attributes\n\t *\n\t * @since  6.2\n\t *\/\n\tpublic function replace_urls_in_json( $content ) {\n\t\t$pattern      = '\/data-settings=\"(.*?)\"\/i';\n\t\t$parent_class = $this;\n\n\t\tpreg_match_all($pattern, $content, $matches, PREG_SET_ORDER);\n\n\t\tforeach ($matches as $match) {\n\t\t\t\/\/ Check if the string contains HTML entities\n\t\t\t$isEncoded = preg_match('\/&quot;|&lt;|&gt;|&amp;|&apos;\/', $match[1]);\n\n\t\t\t\/\/ Decode HTML entities in the JSON string\n\t\t\t$jsonString = html_entity_decode($match[1]);\n\n\t\t\t$jsonData = \\json_decode($jsonString, true);\n\n\t\t\tif (json_last_error() === JSON_ERROR_NONE) {\n\t\t\t\t$did_webp_replace = false;\n\n\t\t\t\tarray_walk_recursive($jsonData, function ( &$item, $key ) use ( &$did_webp_replace, $parent_class ) {\n\t\t\t\t\tif ($key == 'url') {\n\t\t\t\t\t\t$item_image = $parent_class->replace_webp($item);\n\t\t\t\t\t\tif ($item_image) {\n\t\t\t\t\t\t\t$item = $item_image;\n\n\t\t\t\t\t\t\t$did_webp_replace = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif ($did_webp_replace) {\n\t\t\t\t\t\/\/ Re-encode the modified array back to a JSON string\n\t\t\t\t\t$newJsonString = \\json_encode($jsonData);\n\n\t\t\t\t\t\/\/ Re-encode the JSON string to HTML entities only if it was originally encoded\n\t\t\t\t\tif ($isEncoded) {\n\t\t\t\t\t\t$newJsonString = htmlspecialchars($newJsonString, ENT_QUOTES | 0); \/\/ ENT_HTML401 is for PHPv5.4+\n\t\t\t\t\t}\n\n\t\t\t\t\t\/\/ Replace the old JSON string in the content with the new, modified JSON string\n\t\t\t\t\t$content = str_replace($match[1], $newJsonString, $content);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Replace internal image src to webp or avif\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t *\/\n\tpublic function replace_webp( $url ) {\n\t\tif (!$this->webp_support()) {\n\t\t\tself::debug2('No next generation format chosen in setting, bypassed');\n\t\t\treturn false;\n\t\t}\n\t\tDebug2::debug2('[Media] ' . $this->_sys_format . ' replacing: ' . substr($url, 0, 200));\n\n\t\tif (substr($url, -5) === '.' . $this->_sys_format) {\n\t\t\tDebug2::debug2('[Media] already ' . $this->_sys_format);\n\t\t\treturn false;\n\t\t}\n\n\t\t\/**\n\t\t * WebP API hook\n\t\t * NOTE: As $url may contain query strings, WebP check will need to parse_url before appending .webp\n\t\t *\n\t\t * @since  2.9.5\n\t\t * @see  #751737 - API docs for WebP generation\n\t\t *\/\n\t\tif (apply_filters('litespeed_media_check_ori', Utility::is_internal_file($url), $url)) {\n\t\t\t\/\/ check if has webp file\n\t\t\tif (apply_filters('litespeed_media_check_webp', Utility::is_internal_file($url, $this->_sys_format), $url)) {\n\t\t\t\t$url .= '.' . $this->_sys_format;\n\t\t\t} else {\n\t\t\t\tDebug2::debug2('[Media] -no WebP or AVIF file, bypassed');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\tDebug2::debug2('[Media] -no file, bypassed');\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug2('[Media] - replaced to: ' . $url);\n\n\t\treturn $url;\n\t}\n\n\t\/**\n\t * Hook to wp_get_attachment_image_src\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t * @param  array $img The URL of the attachment image src, the width, the height\n\t * @return array\n\t *\/\n\tpublic function webp_attach_img_src( $img ) {\n\t\tDebug2::debug2('[Media] changing attach src: ' . $img[0]);\n\t\tif ($img && ($url = $this->replace_webp($img[0]))) {\n\t\t\t$img[0] = $url;\n\t\t}\n\t\treturn $img;\n\t}\n\n\t\/**\n\t * Try to replace img url\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t * @param  string $url\n\t * @return string\n\t *\/\n\tpublic function webp_url( $url ) {\n\t\tif ($url && ($url2 = $this->replace_webp($url))) {\n\t\t\t$url = $url2;\n\t\t}\n\t\treturn $url;\n\t}\n\n\t\/**\n\t * Hook to replace WP responsive images\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t * @param  array $srcs\n\t * @return array\n\t *\/\n\tpublic function webp_srcset( $srcs ) {\n\t\tif ($srcs) {\n\t\t\tforeach ($srcs as $w => $data) {\n\t\t\t\tif (!($url = $this->replace_webp($data['url']))) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$srcs[$w]['url'] = $url;\n\t\t\t}\n\t\t}\n\t\treturn $srcs;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/vpi.cls.php","ext":"php","size":7545,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The viewport image class.\n *\n * @since       4.7\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass VPI extends Base {\n\n\tconst LOG_TAG = '[VPI]';\n\n\tconst TYPE_GEN     = 'gen';\n\tconst TYPE_CLEAR_Q = 'clear_q';\n\n\tprotected $_summary;\n\tprivate $_queue;\n\n\t\/**\n\t * Init\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t\/**\n\t * The VPI content of the current page\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic function add_to_queue() {\n\t\t$is_mobile = $this->_separate_mobile();\n\n\t\tglobal $wp;\n\t\t$request_url = home_url($wp->request);\n\n\t\tif (!apply_filters('litespeed_vpi_should_queue', true, $request_url)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$ua = !empty($_SERVER['HTTP_USER_AGENT']) ? $_SERVER['HTTP_USER_AGENT'] : '';\n\n\t\t\/\/ Store it to prepare for cron\n\t\t$this->_queue = $this->load_queue('vpi');\n\n\t\tif (count($this->_queue) > 500) {\n\t\t\tself::debug('Queue is full - 500');\n\t\t\treturn;\n\t\t}\n\n\t\t$home_id = get_option('page_for_posts');\n\n\t\tif (!is_singular() && !($home_id > 0 && is_home())) {\n\t\t\tself::debug('not single post ID');\n\t\t\treturn;\n\t\t}\n\n\t\t$post_id = is_home() ? $home_id : get_the_ID();\n\n\t\t$queue_k = ($is_mobile ? 'mobile' : '') . ' ' . $request_url;\n\t\tif (!empty($this->_queue[$queue_k])) {\n\t\t\tself::debug('queue k existed ' . $queue_k);\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_queue[$queue_k] = array(\n\t\t\t'url' => apply_filters('litespeed_vpi_url', $request_url),\n\t\t\t'post_id' => $post_id,\n\t\t\t'user_agent' => substr($ua, 0, 200),\n\t\t\t'is_mobile' => $this->_separate_mobile(),\n\t\t); \/\/ Current UA will be used to request\n\t\t$this->save_queue('vpi', $this->_queue);\n\t\tself::debug('Added queue_vpi [url] ' . $queue_k . ' [UA] ' . $ua);\n\n\t\t\/\/ Prepare cache tag for later purge\n\t\tTag::add('VPI.' . md5($queue_k));\n\n\t\treturn null;\n\t}\n\n\t\/**\n\t * Notify finished from server\n\t *\n\t * @since 4.7\n\t *\/\n\tpublic function notify() {\n\t\t$post_data = \\json_decode(file_get_contents('php:\/\/input'), true);\n\t\tif (is_null($post_data)) {\n\t\t\t$post_data = $_POST;\n\t\t}\n\t\tself::debug('notify() data', $post_data);\n\n\t\t$this->_queue = $this->load_queue('vpi');\n\n\t\tlist($post_data) = $this->cls('Cloud')->extract_msg($post_data, 'vpi');\n\n\t\t$notified_data = $post_data['data'];\n\t\tif (empty($notified_data) || !is_array($notified_data)) {\n\t\t\tself::debug('\u274c notify exit: no notified data');\n\t\t\treturn Cloud::err('no notified data');\n\t\t}\n\n\t\t\/\/ Check if its in queue or not\n\t\t$valid_i = 0;\n\t\tforeach ($notified_data as $v) {\n\t\t\tif (empty($v['request_url'])) {\n\t\t\t\tself::debug('\u274c notify bypass: no request_url', $v);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (empty($v['queue_k'])) {\n\t\t\t\tself::debug('\u274c notify bypass: no queue_k', $v);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\/\/ $queue_k = ( $is_mobile ? 'mobile' : '' ) . ' ' . $v[ 'request_url' ];\n\t\t\t$queue_k = $v['queue_k'];\n\n\t\t\tif (empty($this->_queue[$queue_k])) {\n\t\t\t\tself::debug('\u274c notify bypass: no this queue [q_k]' . $queue_k);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Save data\n\t\t\tif (!empty($v['data_vpi'])) {\n\t\t\t\t$post_id   = $this->_queue[$queue_k]['post_id'];\n\t\t\t\t$name      = !empty($v['is_mobile']) ? 'litespeed_vpi_list_mobile' : 'litespeed_vpi_list';\n\t\t\t\t$urldecode = is_array($v['data_vpi']) ? array_map('urldecode', $v['data_vpi']) : urldecode($v['data_vpi']);\n\t\t\t\tself::debug('save data_vpi', $urldecode);\n\t\t\t\t$this->cls('Metabox')->save($post_id, $name, $urldecode);\n\n\t\t\t\t++$valid_i;\n\t\t\t}\n\n\t\t\tunset($this->_queue[$queue_k]);\n\t\t\tself::debug('notify data handled, unset queue [q_k] ' . $queue_k);\n\t\t}\n\t\t$this->save_queue('vpi', $this->_queue);\n\n\t\tself::debug('notified');\n\n\t\treturn Cloud::ok(array( 'count' => $valid_i ));\n\t}\n\n\t\/**\n\t * Cron\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic static function cron( $continue = false ) {\n\t\t$_instance = self::cls();\n\t\treturn $_instance->_cron_handler($continue);\n\t}\n\n\t\/**\n\t * Cron generation\n\t *\n\t * @since  4.7\n\t *\/\n\tprivate function _cron_handler( $continue = false ) {\n\t\tself::debug('cron start');\n\t\t$this->_queue = $this->load_queue('vpi');\n\n\t\tif (empty($this->_queue)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ For cron, need to check request interval too\n\t\tif (!$continue) {\n\t\t\tif (!empty($this->_summary['curr_request_vpi']) && time() - $this->_summary['curr_request_vpi'] < 300 && !$this->conf(self::O_DEBUG)) {\n\t\t\t\tself::debug('Last request not done');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t$i = 0;\n\t\tforeach ($this->_queue as $k => $v) {\n\t\t\tif (!empty($v['_status'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tself::debug('cron job [tag] ' . $k . ' [url] ' . $v['url'] . ($v['is_mobile'] ? ' \ud83d\udcf1 ' : '') . ' [UA] ' . $v['user_agent']);\n\n\t\t\t++$i;\n\t\t\t$res = $this->_send_req($v['url'], $k, $v['user_agent'], $v['is_mobile']);\n\t\t\tif (!$res) {\n\t\t\t\t\/\/ Status is wrong, drop this this->_queue\n\t\t\t\t$this->_queue = $this->load_queue('vpi');\n\t\t\t\tunset($this->_queue[$k]);\n\t\t\t\t$this->save_queue('vpi', $this->_queue);\n\n\t\t\t\tif (!$continue) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t\/\/ if ( $i > 3 ) {\n\t\t\t\tGUI::print_loading(count($this->_queue), 'VPI');\n\t\t\t\treturn Router::self_redirect(Router::ACTION_VPI, self::TYPE_GEN);\n\t\t\t\t\/\/ }\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Exit queue if out of quota or service is hot\n\t\t\tif ($res === 'out_of_quota' || $res === 'svc_hot') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$this->_queue                = $this->load_queue('vpi');\n\t\t\t$this->_queue[$k]['_status'] = 'requested';\n\t\t\t$this->save_queue('vpi', $this->_queue);\n\t\t\tself::debug('Saved to queue [k] ' . $k);\n\n\t\t\t\/\/ only request first one\n\t\t\tif (!$continue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t\/\/ if ( $i > 3 ) {\n\t\t\tGUI::print_loading(count($this->_queue), 'VPI');\n\t\t\treturn Router::self_redirect(Router::ACTION_VPI, self::TYPE_GEN);\n\t\t\t\/\/ }\n\t\t}\n\t}\n\n\t\/**\n\t * Send to QC API to generate VPI\n\t *\n\t * @since  4.7\n\t * @access private\n\t *\/\n\tprivate function _send_req( $request_url, $queue_k, $user_agent, $is_mobile ) {\n\t\t$svc = Cloud::SVC_VPI;\n\t\t\/\/ Check if has credit to push or not\n\t\t$err       = false;\n\t\t$allowance = $this->cls('Cloud')->allowance($svc, $err);\n\t\tif (!$allowance) {\n\t\t\tself::debug('\u274c No credit: ' . $err);\n\t\t\t$err && Admin_Display::error(Error::msg($err));\n\t\t\treturn 'out_of_quota';\n\t\t}\n\n\t\tset_time_limit(120);\n\n\t\t\/\/ Update css request status\n\t\tself::save_summary(array( 'curr_request_vpi' => time() ), true);\n\n\t\t\/\/ Gather guest HTML to send\n\t\t$html = $this->cls('CSS')->prepare_html($request_url, $user_agent);\n\n\t\tif (!$html) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Parse HTML to gather all CSS content before requesting\n\t\t$css              = false;\n\t\tlist($css, $html) = $this->cls('CSS')->prepare_css($html);\n\n\t\tif (!$css) {\n\t\t\tself::debug('\u274c No css');\n\t\t\treturn false;\n\t\t}\n\n\t\t$data = array(\n\t\t\t'url' => $request_url,\n\t\t\t'queue_k' => $queue_k,\n\t\t\t'user_agent' => $user_agent,\n\t\t\t'is_mobile' => $is_mobile ? 1 : 0, \/\/ todo:compatible w\/ tablet\n\t\t\t'html' => $html,\n\t\t\t'css' => $css,\n\t\t);\n\t\tself::debug('Generating: ', $data);\n\n\t\t$json = Cloud::post($svc, $data, 30);\n\t\tif (!is_array($json)) {\n\t\t\treturn $json;\n\t\t}\n\n\t\t\/\/ Unknown status, remove this line\n\t\tif ($json['status'] != 'queued') {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Save summary data\n\t\tself::reload_summary();\n\t\t$this->_summary['last_spent_vpi']   = time() - $this->_summary['curr_request_vpi'];\n\t\t$this->_summary['last_request_vpi'] = $this->_summary['curr_request_vpi'];\n\t\t$this->_summary['curr_request_vpi'] = 0;\n\t\tself::save_summary();\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_GEN:\n            self::cron(true);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CLEAR_Q:\n            $this->clear_q('vpi');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/ucss.cls.php","ext":"php","size":14677,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The ucss class.\n *\n * @since       5.1\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass UCSS extends Base {\n\n\tconst LOG_TAG = '[UCSS]';\n\n\tconst TYPE_GEN     = 'gen';\n\tconst TYPE_CLEAR_Q = 'clear_q';\n\n\tprotected $_summary;\n\tprivate $_ucss_whitelist;\n\tprivate $_queue;\n\n\t\/**\n\t * Init\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_summary = self::get_summary();\n\n\t\tadd_filter('litespeed_ucss_whitelist', array( $this->cls('Data'), 'load_ucss_whitelist' ));\n\t}\n\n\t\/**\n\t * Uniform url tag for ucss usage\n\t *\n\t * @since 4.7\n\t *\/\n\tpublic static function get_url_tag( $request_url = false ) {\n\t\t$url_tag = $request_url;\n\t\tif (is_404()) {\n\t\t\t$url_tag = '404';\n\t\t} elseif (apply_filters('litespeed_ucss_per_pagetype', false)) {\n\t\t\t$url_tag = Utility::page_type();\n\t\t\tself::debug('litespeed_ucss_per_pagetype filter altered url to ' . $url_tag);\n\t\t}\n\n\t\treturn $url_tag;\n\t}\n\n\t\/**\n\t * Get UCSS path\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function load( $request_url, $dry_run = false ) {\n\t\t\/\/ Check UCSS URI excludes\n\t\t$ucss_exc = apply_filters('litespeed_ucss_exc', $this->conf(self::O_OPTM_UCSS_EXC));\n\t\tif ($ucss_exc && ($hit = Utility::str_hit_array($request_url, $ucss_exc))) {\n\t\t\tself::debug('UCSS bypassed due to UCSS URI Exclude setting: ' . $hit);\n\t\t\tCore::comment('QUIC.cloud UCSS bypassed by setting');\n\t\t\treturn false;\n\t\t}\n\n\t\t$filepath_prefix = $this->_build_filepath_prefix('ucss');\n\n\t\t$url_tag = self::get_url_tag($request_url);\n\n\t\t$vary     = $this->cls('Vary')->finalize_full_varies();\n\t\t$filename = $this->cls('Data')->load_url_file($url_tag, $vary, 'ucss');\n\t\tif ($filename) {\n\t\t\t$static_file = LITESPEED_STATIC_DIR . $filepath_prefix . $filename . '.css';\n\n\t\t\tif (file_exists($static_file)) {\n\t\t\t\tself::debug2('existing ucss ' . $static_file);\n\t\t\t\t\/\/ Check if is error comment inside only\n\t\t\t\t$tmp = File::read($static_file);\n\t\t\t\tif (substr($tmp, 0, 2) == '\/*' && substr(trim($tmp), -2) == '*\/') {\n\t\t\t\t\tself::debug2('existing ucss is error only: ' . $tmp);\n\t\t\t\t\tCore::comment('QUIC.cloud UCSS bypassed due to generation error \u274c ' . $filepath_prefix . $filename . '.css');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tCore::comment('QUIC.cloud UCSS loaded \u2705');\n\n\t\t\t\treturn $filename . '.css';\n\t\t\t}\n\t\t}\n\n\t\tif ($dry_run) {\n\t\t\treturn false;\n\t\t}\n\n\t\tCore::comment('QUIC.cloud UCSS in queue');\n\n\t\t$uid = get_current_user_id();\n\n\t\t$ua = $this->_get_ua();\n\n\t\t\/\/ Store it for cron\n\t\t$this->_queue = $this->load_queue('ucss');\n\n\t\tif (count($this->_queue) > 500) {\n\t\t\tself::debug('UCSS Queue is full - 500');\n\t\t\treturn false;\n\t\t}\n\n\t\t$queue_k                = (strlen($vary) > 32 ? md5($vary) : $vary) . ' ' . $url_tag;\n\t\t$this->_queue[$queue_k] = array(\n\t\t\t'url' => apply_filters('litespeed_ucss_url', $request_url),\n\t\t\t'user_agent' => substr($ua, 0, 200),\n\t\t\t'is_mobile' => $this->_separate_mobile(),\n\t\t\t'is_webp' => $this->cls('Media')->webp_support() ? 1 : 0,\n\t\t\t'uid' => $uid,\n\t\t\t'vary' => $vary,\n\t\t\t'url_tag' => $url_tag,\n\t\t); \/\/ Current UA will be used to request\n\t\t$this->save_queue('ucss', $this->_queue);\n\t\tself::debug('Added queue_ucss [url_tag] ' . $url_tag . ' [UA] ' . $ua . ' [vary] ' . $vary . ' [uid] ' . $uid);\n\n\t\t\/\/ Prepare cache tag for later purge\n\t\tTag::add('UCSS.' . md5($queue_k));\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Get User Agent\n\t *\n\t * @since  5.3\n\t *\/\n\tprivate function _get_ua() {\n\t\treturn !empty($_SERVER['HTTP_USER_AGENT']) ? $_SERVER['HTTP_USER_AGENT'] : '';\n\t}\n\n\t\/**\n\t * Add rows to q\n\t *\n\t * @since  5.3\n\t *\/\n\tpublic function add_to_q( $url_files ) {\n\t\t\/\/ Store it for cron\n\t\t$this->_queue = $this->load_queue('ucss');\n\n\t\tif (count($this->_queue) > 500) {\n\t\t\tself::debug('UCSS Queue is full - 500');\n\t\t\treturn false;\n\t\t}\n\n\t\t$ua = $this->_get_ua();\n\t\tforeach ($url_files as $url_file) {\n\t\t\t$vary        = $url_file['vary'];\n\t\t\t$request_url = $url_file['url'];\n\t\t\t$is_mobile   = $url_file['mobile'];\n\t\t\t$is_webp     = $url_file['webp'];\n\t\t\t$url_tag     = self::get_url_tag($request_url);\n\n\t\t\t$queue_k = (strlen($vary) > 32 ? md5($vary) : $vary) . ' ' . $url_tag;\n\t\t\t$q       = array(\n\t\t\t\t'url' => apply_filters('litespeed_ucss_url', $request_url),\n\t\t\t\t'user_agent' => substr($ua, 0, 200),\n\t\t\t\t'is_mobile' => $is_mobile,\n\t\t\t\t'is_webp' => $is_webp,\n\t\t\t\t'uid' => false,\n\t\t\t\t'vary' => $vary,\n\t\t\t\t'url_tag' => $url_tag,\n\t\t\t); \/\/ Current UA will be used to request\n\n\t\t\tself::debug('Added queue_ucss [url_tag] ' . $url_tag . ' [UA] ' . $ua . ' [vary] ' . $vary . ' [uid] false');\n\t\t\t$this->_queue[$queue_k] = $q;\n\t\t}\n\t\t$this->save_queue('ucss', $this->_queue);\n\t}\n\n\t\/**\n\t * Generate UCSS\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic static function cron( $continue = false ) {\n\t\t$_instance = self::cls();\n\t\treturn $_instance->_cron_handler($continue);\n\t}\n\n\t\/**\n\t * Handle UCSS cron\n\t *\n\t * @since 4.2\n\t *\/\n\tprivate function _cron_handler( $continue ) {\n\t\t$this->_queue = $this->load_queue('ucss');\n\n\t\tif (empty($this->_queue)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ For cron, need to check request interval too\n\t\tif (!$continue) {\n\t\t\tif (!empty($this->_summary['curr_request']) && time() - $this->_summary['curr_request'] < 300 && !$this->conf(self::O_DEBUG)) {\n\t\t\t\tself::debug('Last request not done');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t$i = 0;\n\t\tforeach ($this->_queue as $k => $v) {\n\t\t\tif (!empty($v['_status'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tself::debug('cron job [tag] ' . $k . ' [url] ' . $v['url'] . ($v['is_mobile'] ? ' \ud83d\udcf1 ' : '') . ' [UA] ' . $v['user_agent']);\n\n\t\t\tif (!isset($v['is_webp'])) {\n\t\t\t\t$v['is_webp'] = false;\n\t\t\t}\n\n\t\t\t++$i;\n\t\t\t$res = $this->_send_req($v['url'], $k, $v['uid'], $v['user_agent'], $v['vary'], $v['url_tag'], $v['is_mobile'], $v['is_webp']);\n\t\t\tif (!$res) {\n\t\t\t\t\/\/ Status is wrong, drop this this->_queue\n\t\t\t\t$this->_queue = $this->load_queue('ucss');\n\t\t\t\tunset($this->_queue[$k]);\n\t\t\t\t$this->save_queue('ucss', $this->_queue);\n\n\t\t\t\tif (!$continue) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ($i > 3) {\n\t\t\t\t\tGUI::print_loading(count($this->_queue), 'UCSS');\n\t\t\t\t\treturn Router::self_redirect(Router::ACTION_UCSS, self::TYPE_GEN);\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Exit queue if out of quota or service is hot\n\t\t\tif ($res === 'out_of_quota' || $res === 'svc_hot') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$this->_queue                = $this->load_queue('ucss');\n\t\t\t$this->_queue[$k]['_status'] = 'requested';\n\t\t\t$this->save_queue('ucss', $this->_queue);\n\t\t\tself::debug('Saved to queue [k] ' . $k);\n\n\t\t\t\/\/ only request first one\n\t\t\tif (!$continue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ($i > 3) {\n\t\t\t\tGUI::print_loading(count($this->_queue), 'UCSS');\n\t\t\t\treturn Router::self_redirect(Router::ACTION_UCSS, self::TYPE_GEN);\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Send to QC API to generate UCSS\n\t *\n\t * @since  2.3\n\t * @access private\n\t *\/\n\tprivate function _send_req( $request_url, $queue_k, $uid, $user_agent, $vary, $url_tag, $is_mobile, $is_webp ) {\n\t\t\/\/ Check if has credit to push or not\n\t\t$err       = false;\n\t\t$allowance = $this->cls('Cloud')->allowance(Cloud::SVC_UCSS, $err);\n\t\tif (!$allowance) {\n\t\t\tself::debug('\u274c No credit: ' . $err);\n\t\t\t$err && Admin_Display::error(Error::msg($err));\n\t\t\treturn 'out_of_quota';\n\t\t}\n\n\t\tset_time_limit(120);\n\n\t\t\/\/ Update css request status\n\t\t$this->_summary['curr_request'] = time();\n\t\tself::save_summary();\n\n\t\t\/\/ Gather guest HTML to send\n\t\t$html = $this->cls('CSS')->prepare_html($request_url, $user_agent, $uid);\n\n\t\tif (!$html) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Parse HTML to gather all CSS content before requesting\n\t\t$css             = false;\n\t\tlist(, $html)    = $this->prepare_css($html, $is_webp, true); \/\/ Use this to drop CSS from HTML as we don't need those CSS to generate UCSS\n\t\t$filename        = $this->cls('Data')->load_url_file($url_tag, $vary, 'css');\n\t\t$filepath_prefix = $this->_build_filepath_prefix('css');\n\t\t$static_file     = LITESPEED_STATIC_DIR . $filepath_prefix . $filename . '.css';\n\t\tself::debug('Checking combined file ' . $static_file);\n\t\tif (file_exists($static_file)) {\n\t\t\t$css = File::read($static_file);\n\t\t}\n\n\t\tif (!$css) {\n\t\t\tself::debug('\u274c No combined css');\n\t\t\treturn false;\n\t\t}\n\n\t\t$data = array(\n\t\t\t'url' => $request_url,\n\t\t\t'queue_k' => $queue_k,\n\t\t\t'user_agent' => $user_agent,\n\t\t\t'is_mobile' => $is_mobile ? 1 : 0, \/\/ todo:compatible w\/ tablet\n\t\t\t'is_webp' => $is_webp ? 1 : 0,\n\t\t\t'html' => $html,\n\t\t\t'css' => $css,\n\t\t);\n\t\tif (!isset($this->_ucss_whitelist)) {\n\t\t\t$this->_ucss_whitelist = $this->_filter_whitelist();\n\t\t}\n\t\t$data['whitelist'] = $this->_ucss_whitelist;\n\n\t\tself::debug('Generating: ', $data);\n\n\t\t$json = Cloud::post(Cloud::SVC_UCSS, $data, 30);\n\t\tif (!is_array($json)) {\n\t\t\treturn $json;\n\t\t}\n\n\t\t\/\/ Old version compatibility\n\t\tif (empty($json['status'])) {\n\t\t\tif (!empty($json['ucss'])) {\n\t\t\t\t$this->_save_con('ucss', $json['ucss'], $queue_k, $is_mobile, $is_webp);\n\t\t\t}\n\n\t\t\t\/\/ Delete the row\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Unknown status, remove this line\n\t\tif ($json['status'] != 'queued') {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Save summary data\n\t\t$this->_summary['last_spent']   = time() - $this->_summary['curr_request'];\n\t\t$this->_summary['last_request'] = $this->_summary['curr_request'];\n\t\t$this->_summary['curr_request'] = 0;\n\t\tself::save_summary();\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Save UCSS content\n\t *\n\t * @since 4.2\n\t *\/\n\tprivate function _save_con( $type, $css, $queue_k, $is_mobile, $is_webp ) {\n\t\t\/\/ Add filters\n\t\t$css = apply_filters('litespeed_' . $type, $css, $queue_k);\n\t\tself::debug2('con: ', $css);\n\n\t\tif (substr($css, 0, 2) == '\/*' && substr($css, -2) == '*\/') {\n\t\t\tself::debug('\u274c empty ' . $type . ' [content] ' . $css);\n\t\t\t\/\/ continue; \/\/ Save the error info too\n\t\t}\n\n\t\t\/\/ Write to file\n\t\t$filecon_md5 = md5($css);\n\n\t\t$filepath_prefix = $this->_build_filepath_prefix($type);\n\t\t$static_file     = LITESPEED_STATIC_DIR . $filepath_prefix . $filecon_md5 . '.css';\n\n\t\tFile::save($static_file, $css, true);\n\n\t\t$url_tag = $this->_queue[$queue_k]['url_tag'];\n\t\t$vary    = $this->_queue[$queue_k]['vary'];\n\t\tself::debug2(\"Save URL to file [file] $static_file [vary] $vary\");\n\n\t\t$this->cls('Data')->save_url($url_tag, $vary, $type, $filecon_md5, dirname($static_file), $is_mobile, $is_webp);\n\n\t\tPurge::add(strtoupper($type) . '.' . md5($queue_k));\n\t}\n\n\t\/**\n\t * Prepare CSS from HTML for CCSS generation only. UCSS will used combined CSS directly.\n\t * Prepare refined HTML for both CCSS and UCSS.\n\t *\n\t * @since  3.4.3\n\t *\/\n\tpublic function prepare_css( $html, $is_webp = false, $dryrun = false ) {\n\t\t$css = '';\n\t\tpreg_match_all('#<link ([^>]+)\/?>|<style([^>]*)>([^<]+)<\/style>#isU', $html, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$debug_info = '';\n\t\t\tif (strpos($match[0], '<link') === 0) {\n\t\t\t\t$attrs = Utility::parse_attr($match[1]);\n\n\t\t\t\tif (empty($attrs['rel'])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ($attrs['rel'] != 'stylesheet') {\n\t\t\t\t\tif ($attrs['rel'] != 'preload' || empty($attrs['as']) || $attrs['as'] != 'style') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!empty($attrs['media']) && strpos($attrs['media'], 'print') !== false) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (empty($attrs['href'])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Check Google fonts hit\n\t\t\t\tif (strpos($attrs['href'], 'fonts.googleapis.com') !== false) {\n\t\t\t\t\t$html = str_replace($match[0], '', $html);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$debug_info = $attrs['href'];\n\n\t\t\t\t\/\/ Load CSS content\n\t\t\t\tif (!$dryrun) {\n\t\t\t\t\t\/\/ Dryrun will not load CSS but just drop them\n\t\t\t\t\t$con = $this->cls('Optimizer')->load_file($attrs['href']);\n\t\t\t\t\tif (!$con) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$con = '';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t\/\/ Inline style\n\t\t\t\t$attrs = Utility::parse_attr($match[2]);\n\n\t\t\t\tif (!empty($attrs['media']) && strpos($attrs['media'], 'print') !== false) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tDebug2::debug2('[CSS] Load inline CSS ' . substr($match[3], 0, 100) . '...', $attrs);\n\t\t\t\t$con = $match[3];\n\n\t\t\t\t$debug_info = '__INLINE__';\n\t\t\t}\n\n\t\t\t$con = Optimizer::minify_css($con);\n\t\t\tif ($is_webp && $this->cls('Media')->webp_support()) {\n\t\t\t\t$con = $this->cls('Media')->replace_background_webp($con);\n\t\t\t}\n\n\t\t\tif (!empty($attrs['media']) && $attrs['media'] !== 'all') {\n\t\t\t\t$con = '@media ' . $attrs['media'] . '{' . $con . \"}\\n\";\n\t\t\t} else {\n\t\t\t\t$con = $con . \"\\n\";\n\t\t\t}\n\n\t\t\t$con  = '\/* ' . $debug_info . ' *\/' . $con;\n\t\t\t$css .= $con;\n\n\t\t\t$html = str_replace($match[0], '', $html);\n\t\t}\n\n\t\treturn array( $css, $html );\n\t}\n\n\t\/**\n\t * Filter the comment content, add quotes to selector from whitelist. Return the json\n\t *\n\t * @since 3.3\n\t *\/\n\tprivate function _filter_whitelist() {\n\t\t$whitelist = array();\n\t\t$list      = apply_filters('litespeed_ucss_whitelist', $this->conf(self::O_OPTM_UCSS_SELECTOR_WHITELIST));\n\t\tforeach ($list as $k => $v) {\n\t\t\tif (substr($v, 0, 2) === '\/\/') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\/\/ Wrap in quotes for selectors\n\t\t\tif (substr($v, 0, 1) !== '\/' && strpos($v, '\"') === false && strpos($v, \"'\") === false) {\n\t\t\t\t\/\/ $v = \"'$v'\";\n\t\t\t}\n\t\t\t$whitelist[] = $v;\n\t\t}\n\n\t\treturn $whitelist;\n\t}\n\n\t\/**\n\t * Notify finished from server\n\t *\n\t * @since 5.1\n\t *\/\n\tpublic function notify() {\n\t\t$post_data = \\json_decode(file_get_contents('php:\/\/input'), true);\n\t\tif (is_null($post_data)) {\n\t\t\t$post_data = $_POST;\n\t\t}\n\t\tself::debug('notify() data', $post_data);\n\n\t\t$this->_queue = $this->load_queue('ucss');\n\n\t\tlist($post_data) = $this->cls('Cloud')->extract_msg($post_data, 'ucss');\n\n\t\t$notified_data = $post_data['data'];\n\t\tif (empty($notified_data) || !is_array($notified_data)) {\n\t\t\tself::debug('\u274c notify exit: no notified data');\n\t\t\treturn Cloud::err('no notified data');\n\t\t}\n\n\t\t\/\/ Check if its in queue or not\n\t\t$valid_i = 0;\n\t\tforeach ($notified_data as $v) {\n\t\t\tif (empty($v['request_url'])) {\n\t\t\t\tself::debug('\u274c notify bypass: no request_url', $v);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (empty($v['queue_k'])) {\n\t\t\t\tself::debug('\u274c notify bypass: no queue_k', $v);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (empty($this->_queue[$v['queue_k']])) {\n\t\t\t\tself::debug('\u274c notify bypass: no this queue [q_k]' . $v['queue_k']);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Save data\n\t\t\tif (!empty($v['data_ucss'])) {\n\t\t\t\t$is_mobile = $this->_queue[$v['queue_k']]['is_mobile'];\n\t\t\t\t$is_webp   = $this->_queue[$v['queue_k']]['is_webp'];\n\t\t\t\t$this->_save_con('ucss', $v['data_ucss'], $v['queue_k'], $is_mobile, $is_webp);\n\n\t\t\t\t++$valid_i;\n\t\t\t}\n\n\t\t\tunset($this->_queue[$v['queue_k']]);\n\t\t\tself::debug('notify data handled, unset queue [q_k] ' . $v['queue_k']);\n\t\t}\n\t\t$this->save_queue('ucss', $this->_queue);\n\n\t\tself::debug('notified');\n\n\t\treturn Cloud::ok(array( 'count' => $valid_i ));\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  2.3\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_GEN:\n            self::cron(true);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CLEAR_Q:\n            $this->clear_q('ucss');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/optimize.cls.php","ext":"php","size":39589,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The optimize class.\n *\n * @since       1.2.2\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Optimize extends Base {\n\tconst LOG_TAG           = '\ud83c\udfa2';\n\n\tconst LIB_FILE_CSS_ASYNC     = 'assets\/js\/css_async.min.js';\n\tconst LIB_FILE_WEBFONTLOADER = 'assets\/js\/webfontloader.min.js';\n\tconst LIB_FILE_JS_DELAY      = 'assets\/js\/js_delay.min.js';\n\n\tconst ITEM_TIMESTAMP_PURGE_CSS = 'timestamp_purge_css';\n\n\tconst DUMMY_CSS_REGEX = \"#<link rel=['\\\"]stylesheet['\\\"] id=['\\\"]litespeed-cache-dummy-css['\\\"] href=['\\\"].+assets\/css\/litespeed-dummy\\.css[?\\w.=-]*['\\\"][ \\w='\\\"\/]*>#isU\";\n\n\tprivate $content;\n\tprivate $content_ori;\n\n\tprivate $cfg_css_min;\n\tprivate $cfg_css_comb;\n\tprivate $cfg_js_min;\n\tprivate $cfg_js_comb;\n\tprivate $cfg_css_async;\n\tprivate $cfg_js_delay_inc = array();\n\tprivate $cfg_js_defer;\n\tprivate $cfg_js_defer_exc = false;\n\tprivate $cfg_ggfonts_async;\n\tprivate $_conf_css_font_display;\n\tprivate $cfg_ggfonts_rm;\n\n\tprivate $dns_prefetch;\n\tprivate $dns_preconnect;\n\tprivate $_ggfonts_urls = array();\n\tprivate $_ccss;\n\tprivate $_ucss = false;\n\n\tprivate $__optimizer;\n\n\tprivate $html_foot = ''; \/\/ The html info append to <body>\n\tprivate $html_head = ''; \/\/ The html info append to <head>\n\tprivate $html_head_early = ''; \/\/ The html info prepend to top of head\n\n\tprivate static $_var_i    = 0;\n\tprivate $_var_preserve_js = array();\n\tprivate $_request_url;\n\n\t\/**\n\t * Constructor\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function __construct() {\n\t\tself::debug('init');\n\t\t$this->__optimizer = $this->cls('Optimizer');\n\t}\n\n\t\/**\n\t * Init optimizer\n\t *\n\t * @since  3.0\n\t * @access protected\n\t *\/\n\tpublic function init() {\n\t\t$this->cfg_css_async = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_CSS_ASYNC);\n\t\tif ($this->cfg_css_async) {\n\t\t\tif (!$this->cls('Cloud')->activated()) {\n\t\t\t\tself::debug('\u274c CCSS set to OFF due to QC not activated');\n\t\t\t\t$this->cfg_css_async = false;\n\t\t\t}\n\t\t\tif ((defined('LITESPEED_GUEST_OPTM') || ($this->conf(self::O_OPTM_UCSS) && $this->conf(self::O_OPTM_CSS_COMB))) && $this->conf(self::O_OPTM_UCSS_INLINE)) {\n\t\t\t\tself::debug('\u26a0\ufe0f CCSS set to OFF due to UCSS Inline');\n\t\t\t\t$this->cfg_css_async = false;\n\t\t\t}\n\t\t}\n\t\t$this->cfg_js_defer = $this->conf(self::O_OPTM_JS_DEFER);\n\t\tif (defined('LITESPEED_GUEST_OPTM')) {\n\t\t\t$this->cfg_js_defer = 2;\n\t\t}\n\t\tif ($this->cfg_js_defer == 2) {\n\t\t\tadd_filter(\n\t\t\t\t'litespeed_optm_cssjs',\n\t\t\t\tfunction ( $con, $file_type ) {\n\t\t\t\t\tif ($file_type == 'js') {\n\t\t\t\t\t\t$con = str_replace('DOMContentLoaded', 'DOMContentLiteSpeedLoaded', $con);\n\t\t\t\t\t\t\/\/ $con = str_replace( 'addEventListener(\"load\"', 'addEventListener(\"litespeedLoad\"', $con );\n\t\t\t\t\t}\n\t\t\t\t\treturn $con;\n\t\t\t\t},\n\t\t\t\t20,\n\t\t\t\t2\n\t\t\t);\n\t\t}\n\n\t\t\/\/ To remove emoji from WP\n\t\tif ($this->conf(self::O_OPTM_EMOJI_RM)) {\n\t\t\t$this->_emoji_rm();\n\t\t}\n\n\t\tif ($this->conf(self::O_OPTM_QS_RM)) {\n\t\t\tadd_filter('style_loader_src', array( $this, 'remove_query_strings' ), 999);\n\t\t\tadd_filter('script_loader_src', array( $this, 'remove_query_strings' ), 999);\n\t\t}\n\n\t\t\/\/ GM JS exclude @since 4.1\n\t\tif (defined('LITESPEED_GUEST_OPTM')) {\n\t\t\t$this->cfg_js_defer_exc = apply_filters('litespeed_optm_gm_js_exc', $this->conf(self::O_OPTM_GM_JS_EXC));\n\t\t} else {\n\t\t\t\/**\n\t\t\t * Exclude js from deferred setting\n\t\t\t *\n\t\t\t * @since 1.5\n\t\t\t *\/\n\t\t\tif ($this->cfg_js_defer) {\n\t\t\t\tadd_filter('litespeed_optm_js_defer_exc', array( $this->cls('Data'), 'load_js_defer_exc' ));\n\t\t\t\t$this->cfg_js_defer_exc = apply_filters('litespeed_optm_js_defer_exc', $this->conf(self::O_OPTM_JS_DEFER_EXC));\n\n\t\t\t\t$this->cfg_js_delay_inc = apply_filters('litespeed_optm_js_delay_inc', $this->conf(self::O_OPTM_JS_DELAY_INC));\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Add vary filter for Role Excludes @since  1.6\n\t\tadd_filter('litespeed_vary', array( $this, 'vary_add_role_exclude' ));\n\n\t\t\/\/ DNS optm (Prefetch\/Preconnect) @since 7.3\n\t\t$this->_dns_optm_init();\n\n\t\tadd_filter('litespeed_buffer_finalize', array( $this, 'finalize' ), 20);\n\n\t\t\/\/ Inject a dummy CSS file to control final optimized data location in <head>\n\t\twp_enqueue_style(Core::PLUGIN_NAME . '-dummy', LSWCP_PLUGIN_URL . 'assets\/css\/litespeed-dummy.css');\n\t}\n\n\t\/**\n\t * Exclude role from optimization filter\n\t *\n\t * @since  1.6\n\t * @access public\n\t *\/\n\tpublic function vary_add_role_exclude( $vary ) {\n\t\tif ($this->cls('Conf')->in_optm_exc_roles()) {\n\t\t\t$vary['role_exclude_optm'] = 1;\n\t\t}\n\n\t\treturn $vary;\n\t}\n\n\t\/**\n\t * Remove emoji from WP\n\t *\n\t * @since  1.4\n\t * @since  2.9.8 Changed to private\n\t * @access private\n\t *\/\n\tprivate function _emoji_rm() {\n\t\tremove_action('wp_head', 'print_emoji_detection_script', 7);\n\t\tremove_action('admin_print_scripts', 'print_emoji_detection_script');\n\t\tremove_filter('the_content_feed', 'wp_staticize_emoji');\n\t\tremove_filter('comment_text_rss', 'wp_staticize_emoji');\n\t\t\/**\n\t\t * Added for better result\n\t\t *\n\t\t * @since  1.6.2.1\n\t\t *\/\n\t\tremove_action('wp_print_styles', 'print_emoji_styles');\n\t\tremove_action('admin_print_styles', 'print_emoji_styles');\n\t\tremove_filter('wp_mail', 'wp_staticize_emoji_for_email');\n\t}\n\n\t\/**\n\t * Delete file-based cache folder\n\t *\n\t * @since  2.1\n\t * @access public\n\t *\/\n\tpublic function rm_cache_folder( $subsite_id = false ) {\n\t\tif ($subsite_id) {\n\t\t\tfile_exists(LITESPEED_STATIC_DIR . '\/css\/' . $subsite_id) && File::rrmdir(LITESPEED_STATIC_DIR . '\/css\/' . $subsite_id);\n\t\t\tfile_exists(LITESPEED_STATIC_DIR . '\/js\/' . $subsite_id) && File::rrmdir(LITESPEED_STATIC_DIR . '\/js\/' . $subsite_id);\n\t\t\treturn;\n\t\t}\n\n\t\tfile_exists(LITESPEED_STATIC_DIR . '\/css') && File::rrmdir(LITESPEED_STATIC_DIR . '\/css');\n\t\tfile_exists(LITESPEED_STATIC_DIR . '\/js') && File::rrmdir(LITESPEED_STATIC_DIR . '\/js');\n\t}\n\n\t\/**\n\t * Remove QS\n\t *\n\t * @since  1.3\n\t * @access public\n\t *\/\n\tpublic function remove_query_strings( $src ) {\n\t\tif (strpos($src, '_litespeed_rm_qs=0') || strpos($src, '\/recaptcha')) {\n\t\t\treturn $src;\n\t\t}\n\n\t\tif (!Utility::is_internal_file($src)) {\n\t\t\treturn $src;\n\t\t}\n\n\t\tif (strpos($src, '.js?') !== false || strpos($src, '.css?') !== false) {\n\t\t\t$src = preg_replace('\/\\?.*\/', '', $src);\n\t\t}\n\n\t\treturn $src;\n\t}\n\n\t\/**\n\t * Run optimize process\n\t * NOTE: As this is after cache finalized, can NOT set any cache control anymore\n\t *\n\t * @since  1.2.2\n\t * @access public\n\t * @return  string The content that is after optimization\n\t *\/\n\tpublic function finalize( $content ) {\n\t\t$content = $this->_finalize($content);\n\t\t\/\/ Fallback to replace dummy css placeholder\n\t\tif (false !== preg_match(self::DUMMY_CSS_REGEX, $content)) {\n\t\t\tself::debug('Fallback to drop dummy CSS');\n\t\t\t$content = preg_replace( self::DUMMY_CSS_REGEX, '', $content );\n\t\t}\n\t\treturn $content;\n\t}\n\tprivate function _finalize( $content ) {\n\t\tif (defined('LITESPEED_NO_PAGEOPTM')) {\n\t\t\tself::debug2('bypass: NO_PAGEOPTM const');\n\t\t\treturn $content;\n\t\t}\n\n\t\tif (!defined('LITESPEED_IS_HTML')) {\n\t\t\tself::debug('bypass: Not frontend HTML type');\n\t\t\treturn $content;\n\t\t}\n\n\t\tif (!defined('LITESPEED_GUEST_OPTM')) {\n\t\t\tif (!Control::is_cacheable()) {\n\t\t\t\tself::debug('bypass: Not cacheable');\n\t\t\t\treturn $content;\n\t\t\t}\n\n\t\t\t\/\/ Check if hit URI excludes\n\t\t\tadd_filter('litespeed_optm_uri_exc', array( $this->cls('Data'), 'load_optm_uri_exc' ));\n\t\t\t$excludes = apply_filters('litespeed_optm_uri_exc', $this->conf(self::O_OPTM_EXC));\n\t\t\t$result   = Utility::str_hit_array($_SERVER['REQUEST_URI'], $excludes);\n\t\t\tif ($result) {\n\t\t\t\tself::debug('bypass: hit URI Excludes setting: ' . $result);\n\t\t\t\treturn $content;\n\t\t\t}\n\t\t}\n\n\t\tself::debug('start');\n\n\t\t$this->content_ori = $this->content = $content;\n\n\t\t$this->_optimize();\n\t\treturn $this->content;\n\t}\n\n\t\/**\n\t * Optimize css src\n\t *\n\t * @since  1.2.2\n\t * @access private\n\t *\/\n\tprivate function _optimize() {\n\t\tglobal $wp;\n\t\t$this->_request_url = get_permalink();\n\t\t\/\/ Backup, in case get_permalink() fails.\n\t\tif (!$this->_request_url) {\n\t\t\t$this->_request_url = home_url($wp->request);\n\t\t}\n\n\t\t$this->cfg_css_min            = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_CSS_MIN);\n\t\t$this->cfg_css_comb           = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_CSS_COMB);\n\t\t$this->cfg_js_min             = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_JS_MIN);\n\t\t$this->cfg_js_comb            = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_JS_COMB);\n\t\t$this->cfg_ggfonts_rm         = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_GGFONTS_RM);\n\t\t$this->cfg_ggfonts_async      = !defined('LITESPEED_GUEST_OPTM') && $this->conf(self::O_OPTM_GGFONTS_ASYNC); \/\/ forced rm already\n\t\t$this->_conf_css_font_display = !defined('LITESPEED_GUEST_OPTM') && $this->conf(self::O_OPTM_CSS_FONT_DISPLAY);\n\n\t\tif (!$this->cls('Router')->can_optm()) {\n\t\t\tself::debug('bypass: admin\/feed\/preview');\n\t\t\treturn;\n\t\t}\n\n\t\tif ($this->cfg_css_async) {\n\t\t\t$this->_ccss = $this->cls('CSS')->prepare_ccss();\n\t\t\tif (!$this->_ccss) {\n\t\t\t\tself::debug('\u274c CCSS set to OFF due to CCSS not generated yet');\n\t\t\t\t$this->cfg_css_async = false;\n\t\t\t} elseif (strpos($this->_ccss, '<style id=\"litespeed-ccss\" data-error') === 0) {\n\t\t\t\tself::debug('\u274c CCSS set to OFF due to CCSS failed to generate');\n\t\t\t\t$this->cfg_css_async = false;\n\t\t\t}\n\t\t}\n\n\t\tdo_action('litespeed_optm');\n\n\t\t\/\/ Parse css from content\n\t\t$src_list = false;\n\t\tif ($this->cfg_css_min || $this->cfg_css_comb || $this->cfg_ggfonts_rm || $this->cfg_css_async || $this->cfg_ggfonts_async || $this->_conf_css_font_display) {\n\t\t\tadd_filter('litespeed_optimize_css_excludes', array( $this->cls('Data'), 'load_css_exc' ));\n\t\t\tlist($src_list, $html_list) = $this->_parse_css();\n\t\t}\n\n\t\t\/\/ css optimizer\n\t\tif ($this->cfg_css_min || $this->cfg_css_comb) {\n\t\t\tif ($src_list) {\n\t\t\t\t\/\/ IF combine\n\t\t\t\tif ($this->cfg_css_comb) {\n\t\t\t\t\t\/\/ Check if has inline UCSS enabled or not\n\t\t\t\t\tif ((defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_UCSS)) && $this->conf(self::O_OPTM_UCSS_INLINE)) {\n\t\t\t\t\t\t$filename = $this->cls('UCSS')->load($this->_request_url, true);\n\t\t\t\t\t\tif ($filename) {\n\t\t\t\t\t\t\t$filepath_prefix = $this->_build_filepath_prefix('ucss');\n\t\t\t\t\t\t\t$this->_ucss     = File::read(LITESPEED_STATIC_DIR . $filepath_prefix . $filename);\n\n\t\t\t\t\t\t\t\/\/ Drop all css\n\t\t\t\t\t\t\t$this->content = str_replace($html_list, '', $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!$this->_ucss) {\n\t\t\t\t\t\t$url = $this->_build_hash_url($src_list);\n\n\t\t\t\t\t\tif ($url) {\n\t\t\t\t\t\t\t\/\/ Handle css async load\n\t\t\t\t\t\t\tif ($this->cfg_css_async) {\n\t\t\t\t\t\t\t\t$this->html_head .=\n\t\t\t\t\t\t\t\t\t'<link rel=\"preload\" data-asynced=\"1\" data-optimized=\"2\" as=\"style\" onload=\"this.onload=null;this.rel=\\'stylesheet\\'\" href=\"' .\n\t\t\t\t\t\t\t\t\tStr::trim_quotes($url) .\n\t\t\t\t\t\t\t\t\t'\" \/>'; \/\/ todo: How to use \" in attr wrapper \"\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$this->html_head .= '<link data-optimized=\"2\" rel=\"stylesheet\" href=\"' . Str::trim_quotes($url) . '\" \/>'; \/\/ use 2 as combined\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\/\/ Move all css to top\n\t\t\t\t\t\t\t$this->content = str_replace($html_list, '', $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\/\/ Only minify\n\t\t\t\telseif ($this->cfg_css_min) {\n\t\t\t\t\t\/\/ will handle async css load inside\n\t\t\t\t\t$this->_src_queue_handler($src_list, $html_list);\n\t\t\t\t}\n\t\t\t\t\/\/ Only HTTP2 push\n\t\t\t\telse {\n\t\t\t\t\tforeach ($src_list as $src_info) {\n\t\t\t\t\t\tif (!empty($src_info['inl'])) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Handle css lazy load if not handled async loaded yet\n\t\tif ($this->cfg_css_async && !$this->cfg_css_min && !$this->cfg_css_comb) {\n\t\t\t\/\/ async html\n\t\t\t$html_list_async = $this->_async_css_list($html_list, $src_list);\n\n\t\t\t\/\/ Replace async css\n\t\t\t$this->content = str_replace($html_list, $html_list_async, $this->content);\n\t\t}\n\n\t\t\/\/ Parse js from buffer as needed\n\t\t$src_list = false;\n\t\tif ($this->cfg_js_min || $this->cfg_js_comb || $this->cfg_js_defer || $this->cfg_js_delay_inc) {\n\t\t\tadd_filter('litespeed_optimize_js_excludes', array( $this->cls('Data'), 'load_js_exc' ));\n\t\t\tlist($src_list, $html_list) = $this->_parse_js();\n\t\t}\n\n\t\t\/\/ js optimizer\n\t\tif ($src_list) {\n\t\t\t\/\/ IF combine\n\t\t\tif ($this->cfg_js_comb) {\n\t\t\t\t$url = $this->_build_hash_url($src_list, 'js');\n\t\t\t\tif ($url) {\n\t\t\t\t\t$this->html_foot .= $this->_build_js_tag($url);\n\n\t\t\t\t\t\/\/ Will move all JS to bottom combined one\n\t\t\t\t\t$this->content = str_replace($html_list, '', $this->content);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ Only minify\n\t\t\telseif ($this->cfg_js_min) {\n\t\t\t\t\/\/ Will handle js defer inside\n\t\t\t\t$this->_src_queue_handler($src_list, $html_list, 'js');\n\t\t\t}\n\t\t\t\/\/ Only HTTP2 push and Defer\n\t\t\telse {\n\t\t\t\tforeach ($src_list as $k => $src_info) {\n\t\t\t\t\t\/\/ Inline JS\n\t\t\t\t\tif (!empty($src_info['inl'])) {\n\t\t\t\t\t\tif ($this->cfg_js_defer) {\n\t\t\t\t\t\t\t$attrs    = !empty($src_info['attrs']) ? $src_info['attrs'] : '';\n\t\t\t\t\t\t\t$deferred = $this->_js_inline_defer($src_info['src'], $attrs);\n\t\t\t\t\t\t\tif ($deferred) {\n\t\t\t\t\t\t\t\t$this->content = str_replace($html_list[$k], $deferred, $this->content);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\/\/ JS files\n\t\t\t\t\telseif ($this->cfg_js_defer) {\n\t\t\t\t\t\t$deferred = $this->_js_defer($html_list[$k], $src_info['src']);\n\t\t\t\t\t\tif ($deferred) {\n\t\t\t\t\t\t\t$this->content = str_replace($html_list[$k], $deferred, $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t} elseif ($this->cfg_js_delay_inc) {\n\t\t\t\t\t\t$deferred = $this->_js_delay($html_list[$k], $src_info['src']);\n\t\t\t\t\t\tif ($deferred) {\n\t\t\t\t\t\t\t$this->content = str_replace($html_list[$k], $deferred, $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Append JS inline var for preserved ESI\n\t\t\/\/ Shouldn't give any optm (defer\/delay) @since 4.4\n\t\tif ($this->_var_preserve_js) {\n\t\t\t$this->html_head .= '<script>var ' . implode(',', $this->_var_preserve_js) . ';<\/script>';\n\t\t\tself::debug2('Inline JS defer vars', $this->_var_preserve_js);\n\t\t}\n\n\t\t\/\/ Append async compatibility lib to head\n\t\tif ($this->cfg_css_async) {\n\t\t\t\/\/ Inline css async lib\n\t\t\tif ($this->conf(self::O_OPTM_CSS_ASYNC_INLINE)) {\n\t\t\t\t$this->html_head .= $this->_build_js_inline(File::read(LSCWP_DIR . self::LIB_FILE_CSS_ASYNC), true);\n\t\t\t} else {\n\t\t\t\t$css_async_lib_url = LSWCP_PLUGIN_URL . self::LIB_FILE_CSS_ASYNC;\n\t\t\t\t$this->html_head  .= $this->_build_js_tag($css_async_lib_url); \/\/ Don't exclude it from defer for now\n\t\t\t}\n\t\t}\n\n\t\t\/**\n\t\t * Handle google fonts async\n\t\t * This will result in a JS snippet in head, so need to put it in the end to avoid being replaced by JS parser\n\t\t *\/\n\t\t$this->_async_ggfonts();\n\n\t\t\/**\n\t\t * Font display optm\n\t\t *\n\t\t * @since  3.0\n\t\t *\/\n\t\t$this->_font_optm();\n\n\t\t\/\/ Inject JS Delay lib\n\t\t$this->_maybe_js_delay();\n\n\t\t\/**\n\t\t * HTML Lazyload\n\t\t *\/\n\t\tif ($this->conf(self::O_OPTM_HTML_LAZY)) {\n\t\t\t$this->html_head = $this->cls('CSS')->prepare_html_lazy() . $this->html_head;\n\t\t}\n\n\t\t\/\/ Maybe prepend inline UCSS\n\t\tif ($this->_ucss) {\n\t\t\t$this->html_head = '<style id=\"litespeed-ucss\">' . $this->_ucss . '<\/style>' . $this->html_head;\n\t\t}\n\n\t\t\/\/ Check if there is any critical css rules setting\n\t\tif ($this->cfg_css_async && $this->_ccss) {\n\t\t\t$this->html_head = $this->_ccss . $this->html_head;\n\t\t}\n\n\t\t\/\/ Replace html head part\n\t\t$this->html_head_early = apply_filters('litespeed_optm_html_head_early', $this->html_head_early);\n\t\tif ($this->html_head_early) {\n\t\t\t\/\/ Put header content to be after charset\n\t\t\tif (false !== strpos($this->content, '<meta charset')) {\n\t\t\t\tself::debug('Put early optm data to be after <meta charset>');\n\t\t\t\t$this->content = preg_replace('#<meta charset([^>]*)>#isU', '<meta charset$1>' . $this->html_head_early, $this->content, 1);\n\t\t\t} else {\n\t\t\t\tself::debug('Put early optm data to be right after <head>');\n\t\t\t\t$this->content = preg_replace('#<head([^>]*)>#isU', '<head$1>' . $this->html_head_early, $this->content, 1);\n\t\t\t}\n\t\t}\n\t\t$this->html_head = apply_filters('litespeed_optm_html_head', $this->html_head);\n\t\tif ($this->html_head) {\n\t\t\tif (apply_filters('litespeed_optm_html_after_head', false)) {\n\t\t\t\t$this->content = str_replace('<\/head>', $this->html_head . '<\/head>', $this->content);\n\t\t\t} else {\n\t\t\t\t\/\/ Put header content to dummy css position\n\t\t\t\tif (false !== preg_match(self::DUMMY_CSS_REGEX, $this->content)) {\n\t\t\t\t\tself::debug('Put optm data to dummy css location');\n\t\t\t\t\t$this->content = preg_replace( self::DUMMY_CSS_REGEX, $this->html_head, $this->content );\n\t\t\t\t}\n\t\t\t\t\/\/ Fallback: try to be after charset\n\t\t\t\telseif (strpos($this->content, '<meta charset') !== false) {\n\t\t\t\t\tself::debug('Put optm data to be after <meta charset>');\n\t\t\t\t\t$this->content = preg_replace('#<meta charset([^>]*)>#isU', '<meta charset$1>' . $this->html_head, $this->content, 1);\n\t\t\t\t} else {\n\t\t\t\t\tself::debug('Put optm data to be after <head>');\n\t\t\t\t\t$this->content = preg_replace('#<head([^>]*)>#isU', '<head$1>' . $this->html_head, $this->content, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Replace html foot part\n\t\t$this->html_foot = apply_filters('litespeed_optm_html_foot', $this->html_foot);\n\t\tif ($this->html_foot) {\n\t\t\t$this->content = str_replace('<\/body>', $this->html_foot . '<\/body>', $this->content);\n\t\t}\n\n\t\t\/\/ Drop noscript if enabled\n\t\tif ($this->conf(self::O_OPTM_NOSCRIPT_RM)) {\n\t\t\t\/\/ $this->content = preg_replace( '#<noscript>.*<\/noscript>#isU', '', $this->content );\n\t\t}\n\n\t\t\/\/ HTML minify\n\t\tif (defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_HTML_MIN)) {\n\t\t\t$this->content = $this->__optimizer->html_min($this->content);\n\t\t}\n\t}\n\n\t\/**\n\t * Build a full JS tag\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _build_js_tag( $src ) {\n\t\tif ($this->cfg_js_defer === 2 || Utility::str_hit_array($src, $this->cfg_js_delay_inc)) {\n\t\t\treturn '<script data-optimized=\"1\" type=\"litespeed\/javascript\" data-src=\"' . Str::trim_quotes($src) . '\"><\/script>';\n\t\t}\n\n\t\tif ($this->cfg_js_defer) {\n\t\t\treturn '<script data-optimized=\"1\" src=\"' . Str::trim_quotes($src) . '\" defer><\/script>';\n\t\t}\n\n\t\treturn '<script data-optimized=\"1\" src=\"' . Str::trim_quotes($src) . '\"><\/script>';\n\t}\n\n\t\/**\n\t * Build a full inline JS snippet\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _build_js_inline( $script, $minified = false ) {\n\t\tif ($this->cfg_js_defer) {\n\t\t\t$deferred = $this->_js_inline_defer($script, false, $minified);\n\t\t\tif ($deferred) {\n\t\t\t\treturn $deferred;\n\t\t\t}\n\t\t}\n\n\t\treturn '<script>' . $script . '<\/script>';\n\t}\n\n\t\/**\n\t * Load JS delay lib\n\t *\n\t * @since 4.0\n\t *\/\n\tprivate function _maybe_js_delay() {\n\t\tif ($this->cfg_js_defer !== 2 && !$this->cfg_js_delay_inc) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!defined('LITESPEED_JS_DELAY_LIB_LOADED')) {\n\t\t\tdefine('LITESPEED_JS_DELAY_LIB_LOADED', true);\n\t\t\t$this->html_foot .= '<script>' . File::read(LSCWP_DIR . self::LIB_FILE_JS_DELAY) . '<\/script>';\n\t\t}\n\t}\n\n\t\/**\n\t * Google font async\n\t *\n\t * @since 2.7.3\n\t * @access private\n\t *\/\n\tprivate function _async_ggfonts() {\n\t\tif (!$this->cfg_ggfonts_async || !$this->_ggfonts_urls) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug2('google fonts async found: ', $this->_ggfonts_urls);\n\n\t\t$this->html_head_early .= '<link rel=\"preconnect\" href=\"https:\/\/fonts.gstatic.com\/\" crossorigin \/>';\n\n\t\t\/**\n\t\t * Append fonts\n\t\t *\n\t\t * Could be multiple fonts\n\t\t *\n\t\t *  <link rel='stylesheet' href='\/\/fonts.googleapis.com\/css?family=Open+Sans%3A400%2C600%2C700%2C800%2C300&#038;ver=4.9.8' type='text\/css' media='all' \/>\n\t\t *  <link rel='stylesheet' href='\/\/fonts.googleapis.com\/css?family=PT+Sans%3A400%2C700%7CPT+Sans+Narrow%3A400%7CMontserrat%3A600&#038;subset=latin&#038;ver=4.9.8' type='text\/css' media='all' \/>\n\t\t *      -> family: PT Sans:400,700|PT Sans Narrow:400|Montserrat:600\n\t\t *  <link rel='stylesheet' href='https:\/\/fonts.googleapis.com\/css?family=Source+Sans+Pro:400,300,300italic,400italic,600,700,900&#038;subset=latin%2Clatin-ext' \/>\n\t\t *\/\n\t\t$script = 'WebFontConfig={google:{families:[';\n\n\t\t$families = array();\n\t\tforeach ($this->_ggfonts_urls as $v) {\n\t\t\t$qs = wp_specialchars_decode($v);\n\t\t\t$qs = urldecode($qs);\n\t\t\t$qs = parse_url($qs, PHP_URL_QUERY);\n\t\t\tparse_str($qs, $qs);\n\n\t\t\tif (empty($qs['family'])) {\n\t\t\t\tself::debug('ERR ggfonts failed to find family: ' . $v);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$subset = empty($qs['subset']) ? '' : ':' . $qs['subset'];\n\n\t\t\tforeach (array_filter(explode('|', $qs['family'])) as $v2) {\n\t\t\t\t$families[] = Str::trim_quotes($v2 . $subset);\n\t\t\t}\n\t\t}\n\n\t\t$script .= '\"' . implode('\",\"', $families) . ($this->_conf_css_font_display ? '&display=swap' : '') . '\"';\n\n\t\t$script .= ']}};';\n\n\t\t\/\/ if webfontloader lib was loaded before WebFontConfig variable, call WebFont.load\n\t\t$script .= 'if ( typeof WebFont === \"object\" && typeof WebFont.load === \"function\" ) { WebFont.load( WebFontConfig ); }';\n\n\t\t$html = $this->_build_js_inline($script);\n\n\t\t\/\/ https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/webfont\/1.6.28\/webfontloader.js\n\t\t$webfont_lib_url = LSWCP_PLUGIN_URL . self::LIB_FILE_WEBFONTLOADER;\n\n\t\t\/\/ default async, if js defer set use defer\n\t\t$html .= $this->_build_js_tag($webfont_lib_url);\n\n\t\t\/\/ Put this in the very beginning for preconnect\n\t\t$this->html_head = $html . $this->html_head;\n\t}\n\n\t\/**\n\t * Font optm\n\t *\n\t * @since  3.0\n\t * @access private\n\t *\/\n\tprivate function _font_optm() {\n\t\tif (!$this->_conf_css_font_display || !$this->_ggfonts_urls) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug2('google fonts optm ', $this->_ggfonts_urls);\n\n\t\tforeach ($this->_ggfonts_urls as $v) {\n\t\t\tif (strpos($v, 'display=')) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$this->html_head = str_replace($v, $v . '&#038;display=swap', $this->html_head);\n\t\t\t$this->html_foot = str_replace($v, $v . '&#038;display=swap', $this->html_foot);\n\t\t\t$this->content   = str_replace($v, $v . '&#038;display=swap', $this->content);\n\t\t}\n\t}\n\n\t\/**\n\t * Prefetch DNS\n\t *\n\t * @since 1.7.1 DNS prefetch\n\t * @since 5.6.1 DNS preconnect\n\t * @access private\n\t *\/\n\tprivate function _dns_optm_init() {\n\t\t\/\/ Widely enable link DNS prefetch\n\t\tif (defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_DNS_PREFETCH_CTRL)) {\n\t\t\t@header('X-DNS-Prefetch-Control: on');\n\t\t}\n\n\t\t$this->dns_prefetch = $this->conf(self::O_OPTM_DNS_PREFETCH);\n\t\t$this->dns_preconnect = $this->conf(self::O_OPTM_DNS_PRECONNECT);\n\t\tif (!$this->dns_prefetch && !$this->dns_preconnect) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (function_exists('wp_resource_hints')) {\n\t\t\tadd_filter('wp_resource_hints', array( $this, 'dns_optm_filter' ), 10, 2);\n\t\t} else {\n\t\t\tadd_action('litespeed_optm', array( $this, 'dns_optm_output' ));\n\t\t}\n\t}\n\n\t\/**\n\t * DNS optm hook for WP\n\t *\n\t * @since 1.7.1\n\t * @access public\n\t *\/\n\tpublic function dns_optm_filter( $urls, $relation_type ) {\n\t\tif ('dns-prefetch' === $relation_type) {\n\t\t\tforeach ($this->dns_prefetch as $v) {\n\t\t\t\tif ($v) {\n\t\t\t\t\t$urls[] = $v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif ('preconnect' === $relation_type) {\n\t\t\tforeach ($this->dns_prefetch as $v) {\n\t\t\t\tif ($v) {\n\t\t\t\t\t$urls[] = $v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn $urls;\n\t}\n\n\t\/**\n\t * DNS optm output directly\n\t *\n\t * @since 1.7.1 DNS prefetch\n\t * @since 5.6.1 DNS preconnect\n\t * @access public\n\t *\/\n\tpublic function dns_optm_output() {\n\t\tforeach ($this->dns_prefetch as $v) {\n\t\t\tif ($v) {\n\t\t\t\t$this->html_head_early .= '<link rel=\"dns-prefetch\" href=\"' . Str::trim_quotes($v) . '\" \/>';\n\t\t\t}\n\t\t}\n\t\tforeach ($this->dns_preconnect as $v) {\n\t\t\tif ($v) {\n\t\t\t\t$this->html_head_early .= '<link rel=\"preconnect\" href=\"' . Str::trim_quotes($v) . '\" crossorigin \/>';\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Run minify with src queue list\n\t *\n\t * @since  1.2.2\n\t * @access private\n\t *\/\n\tprivate function _src_queue_handler( $src_list, $html_list, $file_type = 'css' ) {\n\t\t$html_list_ori = $html_list;\n\n\t\t$can_webp = $this->cls('Media')->webp_support();\n\n\t\t$tag = $file_type == 'css' ? 'link' : 'script';\n\t\tforeach ($src_list as $key => $src_info) {\n\t\t\t\/\/ Minify inline CSS\/JS\n\t\t\tif (!empty($src_info['inl'])) {\n\t\t\t\tif ($file_type == 'css') {\n\t\t\t\t\t$code = Optimizer::minify_css($src_info['src']);\n\t\t\t\t\t$can_webp && ($code = $this->cls('Media')->replace_background_webp($code));\n\t\t\t\t\t$snippet = str_replace($src_info['src'], $code, $html_list[$key]);\n\t\t\t\t} else {\n\t\t\t\t\t\/\/ Inline defer JS\n\t\t\t\t\tif ($this->cfg_js_defer) {\n\t\t\t\t\t\t$attrs   = !empty($src_info['attrs']) ? $src_info['attrs'] : '';\n\t\t\t\t\t\t$snippet = $this->_js_inline_defer($src_info['src'], $attrs) ?: $html_list[$key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$code    = Optimizer::minify_js($src_info['src']);\n\t\t\t\t\t\t$snippet = str_replace($src_info['src'], $code, $html_list[$key]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ CSS\/JS files\n\t\t\telse {\n\t\t\t\t$url = $this->_build_single_hash_url($src_info['src'], $file_type);\n\t\t\t\tif ($url) {\n\t\t\t\t\t$snippet = str_replace($src_info['src'], $url, $html_list[$key]);\n\t\t\t\t}\n\n\t\t\t\t\/\/ Handle css async load\n\t\t\t\tif ($file_type == 'css' && $this->cfg_css_async) {\n\t\t\t\t\t$snippet = $this->_async_css($snippet);\n\t\t\t\t}\n\n\t\t\t\t\/\/ Handle js defer\n\t\t\t\tif ($file_type === 'js' && $this->cfg_js_defer) {\n\t\t\t\t\t$snippet = $this->_js_defer($snippet, $src_info['src']) ?: $snippet;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$snippet         = str_replace(\"<$tag \", '<' . $tag . ' data-optimized=\"1\" ', $snippet);\n\t\t\t$html_list[$key] = $snippet;\n\t\t}\n\n\t\t$this->content = str_replace($html_list_ori, $html_list, $this->content);\n\t}\n\n\t\/**\n\t * Build a single URL mapped filename (This will not save in DB)\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _build_single_hash_url( $src, $file_type = 'css' ) {\n\t\t$content = $this->__optimizer->load_file($src, $file_type);\n\n\t\t$is_min = $this->__optimizer->is_min($src);\n\n\t\t$content = $this->__optimizer->optm_snippet($content, $file_type, !$is_min, $src);\n\n\t\t$filepath_prefix = $this->_build_filepath_prefix($file_type);\n\n\t\t\/\/ Save to file\n\t\t$filename    = $filepath_prefix . md5($this->remove_query_strings($src)) . '.' . $file_type;\n\t\t$static_file = LITESPEED_STATIC_DIR . $filename;\n\t\tFile::save($static_file, $content, true);\n\n\t\t\/\/ QS is required as $src may contains version info\n\t\t$qs_hash = substr(md5($src), -5);\n\t\treturn LITESPEED_STATIC_URL . \"$filename?ver=$qs_hash\";\n\t}\n\n\t\/**\n\t * Generate full URL path with hash for a list of src\n\t *\n\t * @since  1.2.2\n\t * @access private\n\t *\/\n\tprivate function _build_hash_url( $src_list, $file_type = 'css' ) {\n\t\t\/\/ $url_sensitive = $this->conf( self::O_OPTM_CSS_UNIQUE ) && $file_type == 'css'; \/\/ If need to keep unique CSS per URI\n\n\t\t\/\/ Replace preserved ESI (before generating hash)\n\t\tif ($file_type == 'js') {\n\t\t\tforeach ($src_list as $k => $v) {\n\t\t\t\tif (empty($v['inl'])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$src_list[$k]['src'] = $this->_preserve_esi($v['src']);\n\t\t\t}\n\t\t}\n\n\t\t$minify        = $file_type === 'css' ? $this->cfg_css_min : $this->cfg_js_min;\n\t\t$filename_info = $this->__optimizer->serve($this->_request_url, $file_type, $minify, $src_list);\n\n\t\tif (!$filename_info) {\n\t\t\treturn false; \/\/ Failed to generate\n\t\t}\n\n\t\tlist($filename, $type) = $filename_info;\n\n\t\t\/\/ Add cache tag in case later file deleted to avoid lscache served stale non-existed files @since 4.4.1\n\t\tTag::add(Tag::TYPE_MIN . '.' . $filename);\n\n\t\t$qs_hash = substr(md5(self::get_option(self::ITEM_TIMESTAMP_PURGE_CSS)), -5);\n\t\t\/\/ As filename is already related to filecon md5, no need QS anymore\n\t\t$filepath_prefix = $this->_build_filepath_prefix($type);\n\t\treturn LITESPEED_STATIC_URL . $filepath_prefix . $filename . '?ver=' . $qs_hash;\n\t}\n\n\t\/**\n\t * Parse js src\n\t *\n\t * @since  1.2.2\n\t * @access private\n\t *\/\n\tprivate function _parse_js() {\n\t\t$excludes = apply_filters('litespeed_optimize_js_excludes', $this->conf(self::O_OPTM_JS_EXC));\n\n\t\t$combine_ext_inl = $this->conf(self::O_OPTM_JS_COMB_EXT_INL);\n\t\tif (!apply_filters('litespeed_optm_js_comb_ext_inl', true)) {\n\t\t\tself::debug2('js_comb_ext_inl bypassed via litespeed_optm_js_comb_ext_inl filter');\n\t\t\t$combine_ext_inl = false;\n\t\t}\n\n\t\t$src_list  = array();\n\t\t$html_list = array();\n\n\t\t\/\/ V7 added: (?:\\r\\n?|\\n?) to fix replacement leaving empty new line\n\t\t$content = preg_replace('#<!--.*-->(?:\\r\\n?|\\n?)#sU', '', $this->content);\n\t\tpreg_match_all('#<script([^>]*)>(.*)<\/script>(?:\\r\\n?|\\n?)#isU', $content, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$attrs = empty($match[1]) ? array() : Utility::parse_attr($match[1]);\n\n\t\t\tif (isset($attrs['data-optimized'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!empty($attrs['data-no-optimize'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!empty($attrs['data-cfasync']) && $attrs['data-cfasync'] === 'false') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!empty($attrs['type']) && $attrs['type'] != 'text\/javascript') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ to avoid multiple replacement\n\t\t\tif (in_array($match[0], $html_list)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this_src_arr = array();\n\t\t\t\/\/ JS files\n\t\t\tif (!empty($attrs['src'])) {\n\t\t\t\t\/\/ Exclude check\n\t\t\t\t$js_excluded  = Utility::str_hit_array($attrs['src'], $excludes);\n\t\t\t\t$is_internal  = Utility::is_internal_file($attrs['src']);\n\t\t\t\t$is_file      = substr($attrs['src'], 0, 5) != 'data:';\n\t\t\t\t$ext_excluded = !$combine_ext_inl && !$is_internal;\n\t\t\t\tif ($js_excluded || $ext_excluded || !$is_file) {\n\t\t\t\t\t\/\/ Maybe defer\n\t\t\t\t\tif ($this->cfg_js_defer) {\n\t\t\t\t\t\t$deferred = $this->_js_defer($match[0], $attrs['src']);\n\t\t\t\t\t\tif ($deferred) {\n\t\t\t\t\t\t\t$this->content = str_replace($match[0], $deferred, $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself::debug2('_parse_js bypassed due to ' . ($js_excluded ? 'js files excluded [hit] ' . $js_excluded : 'external js'));\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (strpos($attrs['src'], '\/localres\/') !== false) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (strpos($attrs['src'], 'instant_click') !== false) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$this_src_arr['src'] = $attrs['src'];\n\t\t\t}\n\t\t\t\/\/ Inline JS\n\t\t\telseif (!empty($match[2])) {\n\t\t\t\t\/\/ self::debug( '\ud83c\udf39\ud83c\udf39\ud83c\udf39 ' . $match[2] . '\ud83c\udf39' );\n\t\t\t\t\/\/ Exclude check\n\t\t\t\t$js_excluded = Utility::str_hit_array($match[2], $excludes);\n\t\t\t\tif ($js_excluded || !$combine_ext_inl) {\n\t\t\t\t\t\/\/ Maybe defer\n\t\t\t\t\tif ($this->cfg_js_defer) {\n\t\t\t\t\t\t$deferred = $this->_js_inline_defer($match[2], $match[1]);\n\t\t\t\t\t\tif ($deferred) {\n\t\t\t\t\t\t\t$this->content = str_replace($match[0], $deferred, $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tself::debug2('_parse_js bypassed due to ' . ($js_excluded ? 'js excluded [hit] ' . $js_excluded : 'inline js'));\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$this_src_arr['inl'] = true;\n\t\t\t\t$this_src_arr['src'] = $match[2];\n\t\t\t\tif ($match[1]) {\n\t\t\t\t\t$this_src_arr['attrs'] = $match[1];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t\/\/ Compatibility to those who changed src to data-src already\n\t\t\t\tself::debug2('No JS src or inline JS content');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$src_list[]  = $this_src_arr;\n\t\t\t$html_list[] = $match[0];\n\t\t}\n\n\t\treturn array( $src_list, $html_list );\n\t}\n\n\t\/**\n\t * Inline JS defer\n\t *\n\t * @since 3.0\n\t * @access private\n\t *\/\n\tprivate function _js_inline_defer( $con, $attrs = false, $minified = false ) {\n\t\tif (strpos($attrs, 'data-no-defer') !== false) {\n\t\t\tself::debug2('bypass: attr api data-no-defer');\n\t\t\treturn false;\n\t\t}\n\n\t\t$hit = Utility::str_hit_array($con, $this->cfg_js_defer_exc);\n\t\tif ($hit) {\n\t\t\tself::debug2('inline js defer excluded [setting] ' . $hit);\n\t\t\treturn false;\n\t\t}\n\n\t\t$con = trim($con);\n\t\t\/\/ Minify JS first\n\t\tif (!$minified) {\n\t\t\t\/\/ && $this->cfg_js_defer !== 2\n\t\t\t$con = Optimizer::minify_js($con);\n\t\t}\n\n\t\tif (!$con) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Check if the content contains ESI nonce or not\n\t\t$con = $this->_preserve_esi($con);\n\n\t\tif ($this->cfg_js_defer === 2) {\n\t\t\t\/\/ Drop type attribute from $attrs\n\t\t\tif (strpos($attrs, ' type=') !== false) {\n\t\t\t\t$attrs = preg_replace('# type=([\\'\"])([^\\1]+)\\1#isU', '', $attrs);\n\t\t\t}\n\t\t\t\/\/ Replace DOMContentLoaded\n\t\t\t$con = str_replace('DOMContentLoaded', 'DOMContentLiteSpeedLoaded', $con);\n\t\t\treturn '<script' . $attrs . ' type=\"litespeed\/javascript\">' . $con . '<\/script>';\n\t\t\t\/\/ return '<script' . $attrs . ' type=\"litespeed\/javascript\" src=\"data:text\/javascript;base64,' . base64_encode( $con ) . '\"><\/script>';\n\t\t\t\/\/ return '<script' . $attrs . ' type=\"litespeed\/javascript\">' . $con . '<\/script>';\n\t\t}\n\n\t\treturn '<script' . $attrs . ' src=\"data:text\/javascript;base64,' . base64_encode($con) . '\" defer><\/script>';\n\t}\n\n\t\/**\n\t * Replace ESI to JS inline var (mainly used to avoid nonce timeout)\n\t *\n\t * @since  3.5.1\n\t *\/\n\tprivate function _preserve_esi( $con ) {\n\t\t$esi_placeholder_list = $this->cls('ESI')->contain_preserve_esi($con);\n\t\tif (!$esi_placeholder_list) {\n\t\t\treturn $con;\n\t\t}\n\n\t\tforeach ($esi_placeholder_list as $esi_placeholder) {\n\t\t\t$js_var                   = '__litespeed_var_' . self::$_var_i++ . '__';\n\t\t\t$con                      = str_replace($esi_placeholder, $js_var, $con);\n\t\t\t$this->_var_preserve_js[] = $js_var . '=' . $esi_placeholder;\n\t\t}\n\n\t\treturn $con;\n\t}\n\n\t\/**\n\t * Parse css src and remove to-be-removed css\n\t *\n\t * @since  1.2.2\n\t * @access private\n\t * @return array  All the src & related raw html list\n\t *\/\n\tprivate function _parse_css() {\n\t\t$excludes             = apply_filters('litespeed_optimize_css_excludes', $this->conf(self::O_OPTM_CSS_EXC));\n\t\t$ucss_file_exc_inline = apply_filters('litespeed_optimize_ucss_file_exc_inline', $this->conf(self::O_OPTM_UCSS_FILE_EXC_INLINE));\n\n\t\t\/\/ Append dummy css to exclude list\n\t\t$excludes[] = 'litespeed-dummy.css';\n\n\t\t$combine_ext_inl = $this->conf(self::O_OPTM_CSS_COMB_EXT_INL);\n\t\tif (!apply_filters('litespeed_optm_css_comb_ext_inl', true)) {\n\t\t\tself::debug2('css_comb_ext_inl bypassed via litespeed_optm_css_comb_ext_inl filter');\n\t\t\t$combine_ext_inl = false;\n\t\t}\n\n\t\t$css_to_be_removed = apply_filters('litespeed_optm_css_to_be_removed', array());\n\n\t\t$src_list  = array();\n\t\t$html_list = array();\n\n\t\t\/\/ $dom = new \\PHPHtmlParser\\Dom;\n\t\t\/\/ $dom->load( $content );return $val;\n\t\t\/\/ $items = $dom->find( 'link' );\n\n\t\t\/\/ V7 added: (?:\\r\\n?|\\n?) to fix replacement leaving empty new line\n\t\t$content = preg_replace(\n\t\t\tarray( '#<!--.*-->(?:\\r\\n?|\\n?)#sU', '#<script([^>]*)>.*<\/script>(?:\\r\\n?|\\n?)#isU', '#<noscript([^>]*)>.*<\/noscript>(?:\\r\\n?|\\n?)#isU' ),\n\t\t\t'',\n\t\t\t$this->content\n\t\t);\n\t\tpreg_match_all('#<link ([^>]+)\/?>|<style([^>]*)>([^<]+)<\/style>(?:\\r\\n?|\\n?)#isU', $content, $matches, PREG_SET_ORDER);\n\n\t\tforeach ($matches as $match) {\n\t\t\t\/\/ to avoid multiple replacement\n\t\t\tif (in_array($match[0], $html_list)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($exclude = Utility::str_hit_array($match[0], $excludes)) {\n\t\t\t\tself::debug2('_parse_css bypassed exclude ' . $exclude);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this_src_arr = array();\n\t\t\tif (strpos($match[0], '<link') === 0) {\n\t\t\t\t$attrs = Utility::parse_attr($match[1]);\n\t\t\t\tif (empty($attrs['rel']) || $attrs['rel'] !== 'stylesheet') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (empty($attrs['href'])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Check if need to remove this css\n\t\t\t\tif (Utility::str_hit_array($attrs['href'], $css_to_be_removed)) {\n\t\t\t\t\tself::debug('rm css snippet ' . $attrs['href']);\n\t\t\t\t\t\/\/ Delete this css snippet from orig html\n\t\t\t\t\t$this->content = str_replace($match[0], '', $this->content);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Check if need to inline this css file\n\t\t\t\tif ($this->conf(self::O_OPTM_UCSS) && Utility::str_hit_array($attrs['href'], $ucss_file_exc_inline)) {\n\t\t\t\t\tself::debug('ucss_file_exc_inline hit ' . $attrs['href']);\n\t\t\t\t\t\/\/ Replace this css to inline from orig html\n\t\t\t\t\t$inline_script = '<style>' . $this->__optimizer->load_file($attrs['href']) . '<\/style>';\n\t\t\t\t\t$this->content = str_replace($match[0], $inline_script, $this->content);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Check Google fonts hit\n\t\t\t\tif (strpos($attrs['href'], 'fonts.googleapis.com') !== false) {\n\t\t\t\t\t\/**\n\t\t\t\t\t * For async gg fonts, will add webfont into head, hence remove it from buffer and store the matches to use later\n\t\t\t\t\t *\n\t\t\t\t\t * @since  2.7.3\n\t\t\t\t\t * @since  3.0 For font display optm, need to parse google fonts URL too\n\t\t\t\t\t *\/\n\t\t\t\t\tif (!in_array($attrs['href'], $this->_ggfonts_urls)) {\n\t\t\t\t\t\t$this->_ggfonts_urls[] = $attrs['href'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($this->cfg_ggfonts_rm || $this->cfg_ggfonts_async) {\n\t\t\t\t\t\tself::debug('rm css snippet [Google fonts] ' . $attrs['href']);\n\t\t\t\t\t\t$this->content = str_replace($match[0], '', $this->content);\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isset($attrs['data-optimized'])) {\n\t\t\t\t\t\/\/ $this_src_arr[ 'exc' ] = true;\n\t\t\t\t\tcontinue;\n\t\t\t\t} elseif (!empty($attrs['data-no-optimize'])) {\n\t\t\t\t\t\/\/ $this_src_arr[ 'exc' ] = true;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$is_internal  = Utility::is_internal_file($attrs['href']);\n\t\t\t\t$ext_excluded = !$combine_ext_inl && !$is_internal;\n\t\t\t\tif ($ext_excluded) {\n\t\t\t\t\tself::debug2('Bypassed due to external link');\n\t\t\t\t\t\/\/ Maybe defer\n\t\t\t\t\tif ($this->cfg_css_async) {\n\t\t\t\t\t\t$snippet = $this->_async_css($match[0]);\n\t\t\t\t\t\tif ($snippet != $match[0]) {\n\t\t\t\t\t\t\t$this->content = str_replace($match[0], $snippet, $this->content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!empty($attrs['media']) && $attrs['media'] !== 'all') {\n\t\t\t\t\t$this_src_arr['media'] = $attrs['media'];\n\t\t\t\t}\n\n\t\t\t\t$this_src_arr['src'] = $attrs['href'];\n\t\t\t} else {\n\t\t\t\t\/\/ Inline style\n\t\t\t\tif (!$combine_ext_inl) {\n\t\t\t\t\tself::debug2('Bypassed due to inline');\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$attrs = Utility::parse_attr($match[2]);\n\n\t\t\t\tif (!empty($attrs['data-no-optimize'])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!empty($attrs['media']) && $attrs['media'] !== 'all') {\n\t\t\t\t\t$this_src_arr['media'] = $attrs['media'];\n\t\t\t\t}\n\n\t\t\t\t$this_src_arr['inl'] = true;\n\t\t\t\t$this_src_arr['src'] = $match[3];\n\t\t\t}\n\n\t\t\t$src_list[] = $this_src_arr;\n\n\t\t\t$html_list[] = $match[0];\n\t\t}\n\n\t\treturn array( $src_list, $html_list );\n\t}\n\n\t\/**\n\t * Replace css to async loaded css\n\t *\n\t * @since  1.3\n\t * @access private\n\t *\/\n\tprivate function _async_css_list( $html_list, $src_list ) {\n\t\tforeach ($html_list as $k => $ori) {\n\t\t\tif (!empty($src_list[$k]['inl'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$html_list[$k] = $this->_async_css($ori);\n\t\t}\n\t\treturn $html_list;\n\t}\n\n\t\/**\n\t * Async CSS snippet\n\t *\n\t * @since 3.5\n\t *\/\n\tprivate function _async_css( $ori ) {\n\t\tif (strpos($ori, 'data-asynced') !== false) {\n\t\t\tself::debug2('bypass: attr data-asynced exist');\n\t\t\treturn $ori;\n\t\t}\n\n\t\tif (strpos($ori, 'data-no-async') !== false) {\n\t\t\tself::debug2('bypass: attr api data-no-async');\n\t\t\treturn $ori;\n\t\t}\n\n\t\t\/\/ async replacement\n\t\t$v = str_replace('stylesheet', 'preload', $ori);\n\t\t$v = str_replace('<link', '<link data-asynced=\"1\" as=\"style\" onload=\"this.onload=null;this.rel=\\'stylesheet\\'\" ', $v);\n\t\t\/\/ Append to noscript content\n\t\tif (!defined('LITESPEED_GUEST_OPTM') && !$this->conf(self::O_OPTM_NOSCRIPT_RM)) {\n\t\t\t$v .= '<noscript>' . preg_replace('\/ id=\\'[\\w-]+\\' \/U', ' ', $ori) . '<\/noscript>';\n\t\t}\n\n\t\treturn $v;\n\t}\n\n\t\/**\n\t * Defer JS snippet\n\t *\n\t * @since  3.5\n\t *\/\n\tprivate function _js_defer( $ori, $src ) {\n\t\tif (strpos($ori, ' async') !== false) {\n\t\t\t$ori = preg_replace('# async(?:=([\\'\"])(?:[^\\1]*?)\\1)?#is', '', $ori);\n\t\t}\n\n\t\tif (strpos($ori, 'defer') !== false) {\n\t\t\treturn false;\n\t\t}\n\t\tif (strpos($ori, 'data-deferred') !== false) {\n\t\t\tself::debug2('bypass: attr data-deferred exist');\n\t\t\treturn false;\n\t\t}\n\t\tif (strpos($ori, 'data-no-defer') !== false) {\n\t\t\tself::debug2('bypass: attr api data-no-defer');\n\t\t\treturn false;\n\t\t}\n\n\t\t\/**\n\t\t * Exclude JS from setting\n\t\t *\n\t\t * @since 1.5\n\t\t *\/\n\t\tif (Utility::str_hit_array($src, $this->cfg_js_defer_exc)) {\n\t\t\tself::debug('js defer exclude ' . $src);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ($this->cfg_js_defer === 2 || Utility::str_hit_array($src, $this->cfg_js_delay_inc)) {\n\t\t\tif (strpos($ori, ' type=') !== false) {\n\t\t\t\t$ori = preg_replace('# type=([\\'\"])([^\\1]+)\\1#isU', '', $ori);\n\t\t\t}\n\t\t\treturn str_replace(' src=', ' type=\"litespeed\/javascript\" data-src=', $ori);\n\t\t}\n\n\t\treturn str_replace('><\/script>', ' defer data-deferred=\"1\"><\/script>', $ori);\n\t}\n\n\t\/**\n\t * Delay JS for included setting\n\t *\n\t * @since 5.6\n\t *\/\n\tprivate function _js_delay( $ori, $src ) {\n\t\tif (strpos($ori, ' async') !== false) {\n\t\t\t$ori = str_replace(' async', '', $ori);\n\t\t}\n\n\t\tif (strpos($ori, 'defer') !== false) {\n\t\t\treturn false;\n\t\t}\n\t\tif (strpos($ori, 'data-deferred') !== false) {\n\t\t\tself::debug2('bypass: attr data-deferred exist');\n\t\t\treturn false;\n\t\t}\n\t\tif (strpos($ori, 'data-no-defer') !== false) {\n\t\t\tself::debug2('bypass: attr api data-no-defer');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Utility::str_hit_array($src, $this->cfg_js_delay_inc)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (strpos($ori, ' type=') !== false) {\n\t\t\t$ori = preg_replace('# type=([\\'\"])([^\\1]+)\\1#isU', '', $ori);\n\t\t}\n\t\treturn str_replace(' src=', ' type=\"litespeed\/javascript\" data-src=', $ori);\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/crawler.cls.php","ext":"php","size":43112,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The crawler class\n *\n * @since       1.1.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Crawler extends Root {\n\n\tconst LOG_TAG = '\ud83d\udd78\ufe0f';\n\n\tconst TYPE_REFRESH_MAP     = 'refresh_map';\n\tconst TYPE_EMPTY           = 'empty';\n\tconst TYPE_BLACKLIST_EMPTY = 'blacklist_empty';\n\tconst TYPE_BLACKLIST_DEL   = 'blacklist_del';\n\tconst TYPE_BLACKLIST_ADD   = 'blacklist_add';\n\tconst TYPE_START           = 'start';\n\tconst TYPE_RESET           = 'reset';\n\n\tconst USER_AGENT      = 'lscache_walker';\n\tconst FAST_USER_AGENT = 'lscache_runner';\n\tconst CHUNKS          = 10000;\n\n\tconst STATUS_WAIT      = 'W';\n\tconst STATUS_HIT       = 'H';\n\tconst STATUS_MISS      = 'M';\n\tconst STATUS_BLACKLIST = 'B';\n\tconst STATUS_NOCACHE   = 'N';\n\n\tprivate $_sitemeta = 'meta.data';\n\tprivate $_resetfile;\n\tprivate $_end_reason;\n\tprivate $_ncpu = 1;\n\tprivate $_server_ip;\n\n\tprivate $_crawler_conf = array(\n\t\t'cookies' => array(),\n\t\t'headers' => array(),\n\t\t'ua' => '',\n\t);\n\tprivate $_crawlers     = array();\n\tprivate $_cur_threads  = -1;\n\tprivate $_max_run_time;\n\tprivate $_cur_thread_time;\n\tprivate $_map_status_list = array(\n\t\t'H' => array(),\n\t\t'M' => array(),\n\t\t'B' => array(),\n\t\t'N' => array(),\n\t);\n\tprotected $_summary;\n\n\t\/**\n\t * Initialize crawler, assign sitemap path\n\t *\n\t * @since    1.1.0\n\t *\/\n\tpublic function __construct() {\n\t\tif (is_multisite()) {\n\t\t\t$this->_sitemeta = 'meta' . get_current_blog_id() . '.data';\n\t\t}\n\n\t\t$this->_resetfile = LITESPEED_STATIC_DIR . '\/crawler\/' . $this->_sitemeta . '.reset';\n\n\t\t$this->_summary = self::get_summary();\n\n\t\t$this->_ncpu      = $this->_get_server_cpu();\n\t\t$this->_server_ip = $this->conf(Base::O_SERVER_IP);\n\n\t\tself::debug('Init w\/ CPU cores=' . $this->_ncpu);\n\t}\n\n\t\/**\n\t * Try get server CPUs\n\t *\n\t * @since 5.2\n\t *\/\n\tprivate function _get_server_cpu() {\n\t\t$cpuinfo_file     = '\/proc\/cpuinfo';\n\t\t$setting_open_dir = ini_get('open_basedir');\n\t\tif ($setting_open_dir) {\n\t\t\treturn 1;\n\t\t} \/\/ Server has limit\n\n\t\ttry {\n\t\t\tif (!@is_file($cpuinfo_file)) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t} catch (\\Exception $e) {\n\t\t\treturn 1;\n\t\t}\n\n\t\t$cpuinfo = file_get_contents($cpuinfo_file);\n\t\tpreg_match_all('\/^processor\/m', $cpuinfo, $matches);\n\t\treturn count($matches[0]) ?: 1;\n\t}\n\n\t\/**\n\t * Check whether the current crawler is active\/runable\/useable\/enabled\/want it to work or not\n\t *\n\t * @since  4.3\n\t *\/\n\tpublic function is_active( $curr ) {\n\t\t$bypass_list = self::get_option('bypass_list', array());\n\t\treturn !in_array($curr, $bypass_list);\n\t}\n\n\t\/**\n\t * Toggle the current crawler's activeness state, i.e., runable\/useable\/enabled\/want it to work or not, and return the updated state\n\t *\n\t * @since  4.3\n\t *\/\n\tpublic function toggle_activeness( $curr ) {\n\t\t\/\/ param type: int\n\t\t$bypass_list = self::get_option('bypass_list', array());\n\t\tif (in_array($curr, $bypass_list)) {\n\t\t\t\/\/ when the ith opt was off \/ in the bypassed list, turn it on \/ remove it from the list\n\t\t\tunset($bypass_list[array_search($curr, $bypass_list)]);\n\t\t\t$bypass_list = array_values($bypass_list);\n\t\t\tself::update_option('bypass_list', $bypass_list);\n\t\t\treturn true;\n\t\t} else {\n\t\t\t\/\/ when the ith opt was on \/ not in the bypassed list, turn it off \/ add it to the list\n\t\t\t$bypass_list[] = (int) $curr;\n\t\t\tself::update_option('bypass_list', $bypass_list);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t\/**\n\t * Clear bypassed list\n\t *\n\t * @since  4.3\n\t * @access public\n\t *\/\n\tpublic function clear_disabled_list() {\n\t\tself::update_option('bypass_list', array());\n\n\t\t$msg = __('Crawler disabled list is cleared! All crawlers are set to active! ', 'litespeed-cache');\n\t\tAdmin_Display::note($msg);\n\n\t\tself::debug('All crawlers are set to active...... ');\n\t}\n\n\t\/**\n\t * Overwrite get_summary to init elements\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic static function get_summary( $field = false ) {\n\t\t$_default = array(\n\t\t\t'list_size' => 0,\n\t\t\t'last_update_time' => 0,\n\t\t\t'curr_crawler' => 0,\n\t\t\t'curr_crawler_beginning_time' => 0,\n\t\t\t'last_pos' => 0,\n\t\t\t'last_count' => 0,\n\t\t\t'last_crawled' => 0,\n\t\t\t'last_start_time' => 0,\n\t\t\t'last_status' => '',\n\t\t\t'is_running' => 0,\n\t\t\t'end_reason' => '',\n\t\t\t'meta_save_time' => 0,\n\t\t\t'pos_reset_check' => 0,\n\t\t\t'done' => 0,\n\t\t\t'this_full_beginning_time' => 0,\n\t\t\t'last_full_time_cost' => 0,\n\t\t\t'last_crawler_total_cost' => 0,\n\t\t\t'crawler_stats' => array(), \/\/ this will store all crawlers hit\/miss crawl status\n\t\t);\n\n\t\twp_cache_delete('alloptions', 'options'); \/\/ ensure the summary is current\n\t\t$summary = parent::get_summary();\n\t\t$summary = array_merge($_default, $summary);\n\n\t\tif (!$field) {\n\t\t\treturn $summary;\n\t\t}\n\n\t\tif (array_key_exists($field, $summary)) {\n\t\t\treturn $summary[$field];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t\/**\n\t * Overwrite save_summary\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic static function save_summary( $data = false, $reload = false, $overwrite = false ) {\n\t\t$instance                             = self::cls();\n\t\t$instance->_summary['meta_save_time'] = time();\n\n\t\tif (!$data) {\n\t\t\t$data = $instance->_summary;\n\t\t}\n\n\t\tparent::save_summary($data, $reload, $overwrite);\n\n\t\tFile::save(LITESPEED_STATIC_DIR . '\/crawler\/' . $instance->_sitemeta, \\json_encode($data), true);\n\t}\n\n\t\/**\n\t * Cron start async crawling\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function start_async_cron() {\n\t\tTask::async_call('crawler');\n\t}\n\n\t\/**\n\t * Manually start async crawling\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function start_async() {\n\t\tTask::async_call('crawler_force');\n\n\t\t$msg = __('Started async crawling', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Ajax crawl handler\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function async_handler( $manually_run = false ) {\n\t\tself::debug('------------async-------------start_async_handler');\n\t\t\/\/ check_ajax_referer('async_crawler', 'nonce');\n\t\tself::start($manually_run);\n\t}\n\n\t\/**\n\t * Proceed crawling\n\t *\n\t * @since    1.1.0\n\t * @access public\n\t *\/\n\tpublic static function start( $manually_run = false ) {\n\t\tif (!Router::can_crawl()) {\n\t\t\tself::debug('......crawler is NOT allowed by the server admin......');\n\t\t\treturn false;\n\t\t}\n\n\t\tif ($manually_run) {\n\t\t\tself::debug('......crawler manually ran......');\n\t\t}\n\n\t\tself::cls()->_crawl_data($manually_run);\n\t}\n\n\t\/**\n\t * Crawling start\n\t *\n\t * @since    1.1.0\n\t * @access   private\n\t *\/\n\tprivate function _crawl_data( $manually_run ) {\n\t\tif (!defined('LITESPEED_LANE_HASH')) {\n\t\t\tdefine('LITESPEED_LANE_HASH', Str::rrand(8));\n\t\t}\n\t\tif ($this->_check_valid_lane()) {\n\t\t\t$this->_take_over_lane();\n\t\t} else {\n\t\t\tself::debug('\u26a0\ufe0f lane in use');\n\t\t\treturn;\n\t\t\t\/\/ if ($manually_run) {\n\t\t\t\/\/ self::debug('......crawler started (manually_rund)......');\n\t\t\t\/\/ Log pid to prevent from multi running\n\t\t\t\/\/ if (defined('LITESPEED_CLI')) {\n\t\t\t\/\/ Take over lane\n\t\t\t\/\/ self::debug('\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Forced take over lane (CLI)');\n\t\t\t\/\/ $this->_take_over_lane();\n\t\t\t\/\/ }\n\t\t\t\/\/ }\n\t\t}\n\t\tself::debug('......crawler started......');\n\n\t\t\/\/ for the first time running\n\t\tif (!$this->_summary || !Data::cls()->tb_exist('crawler') || !Data::cls()->tb_exist('crawler_blacklist')) {\n\t\t\t$this->cls('Crawler_Map')->gen();\n\t\t}\n\n\t\t\/\/ if finished last time, regenerate sitemap\n\t\tif ($this->_summary['done'] === 'touchedEnd') {\n\t\t\t\/\/ check whole crawling interval\n\t\t\t$last_finished_at = $this->_summary['last_full_time_cost'] + $this->_summary['this_full_beginning_time'];\n\t\t\tif (!$manually_run && time() - $last_finished_at < $this->conf(Base::O_CRAWLER_CRAWL_INTERVAL)) {\n\t\t\t\tself::debug('Cron abort: cache warmed already.');\n\t\t\t\t\/\/ if not reach whole crawling interval, exit\n\t\t\t\t$this->Release_lane();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tself::debug('TouchedEnd. regenerate sitemap....');\n\t\t\t$this->cls('Crawler_Map')->gen();\n\t\t}\n\n\t\t$this->list_crawlers();\n\n\t\t\/\/ Skip the crawlers that in bypassed list\n\t\twhile (!$this->is_active($this->_summary['curr_crawler']) && $this->_summary['curr_crawler'] < count($this->_crawlers)) {\n\t\t\tself::debug('Skipped the Crawler #' . $this->_summary['curr_crawler'] . ' ......');\n\t\t\t++$this->_summary['curr_crawler'];\n\t\t}\n\t\tif ($this->_summary['curr_crawler'] >= count($this->_crawlers)) {\n\t\t\t$this->_end_reason = 'end';\n\t\t\t$this->_terminate_running();\n\t\t\t$this->Release_lane();\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ In case crawlers are all done but not reload, reload it\n\t\tif (empty($this->_summary['curr_crawler']) || empty($this->_crawlers[$this->_summary['curr_crawler']])) {\n\t\t\t$this->_summary['curr_crawler']                                   = 0;\n\t\t\t$this->_summary['crawler_stats'][$this->_summary['curr_crawler']] = array();\n\t\t}\n\n\t\t$res = $this->load_conf();\n\t\tif (!$res) {\n\t\t\tself::debug('Load conf failed');\n\t\t\t$this->_terminate_running();\n\t\t\t$this->Release_lane();\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t$this->_engine_start();\n\t\t\t$this->Release_lane();\n\t\t} catch (\\Exception $e) {\n\t\t\tself::debug('\ud83d\uded1 ' . $e->getMessage());\n\t\t}\n\t}\n\n\t\/**\n\t * Load conf before running crawler\n\t *\n\t * @since  3.0\n\t * @access private\n\t *\/\n\tprivate function load_conf() {\n\t\t$this->_crawler_conf['base'] = site_url();\n\n\t\t$current_crawler = $this->_crawlers[$this->_summary['curr_crawler']];\n\n\t\t\/**\n\t\t * Check cookie crawler\n\t\t *\n\t\t * @since  2.8\n\t\t *\/\n\t\tforeach ($current_crawler as $k => $v) {\n\t\t\tif (strpos($k, 'cookie:') !== 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($v == '_null') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this->_crawler_conf['cookies'][substr($k, 7)] = $v;\n\t\t}\n\n\t\t\/**\n\t\t * Set WebP simulation\n\t\t *\n\t\t * @since  1.9.1\n\t\t *\/\n\t\tif (!empty($current_crawler['webp'])) {\n\t\t\t$this->_crawler_conf['headers'][] = 'Accept: image\/' . ($this->conf(Base::O_IMG_OPTM_WEBP) == 2 ? 'avif' : 'webp') . ',*\/*';\n\t\t}\n\n\t\t\/**\n\t\t * Set mobile crawler\n\t\t *\n\t\t * @since  2.8\n\t\t *\/\n\t\tif (!empty($current_crawler['mobile'])) {\n\t\t\t$this->_crawler_conf['ua'] = 'Mobile iPhone';\n\t\t}\n\n\t\t\/**\n\t\t * Limit delay to use server setting\n\t\t *\n\t\t * @since 1.8.3\n\t\t *\/\n\t\t$this->_crawler_conf['run_delay'] = 500; \/\/ microseconds\n\t\tif (defined('LITESPEED_CRAWLER_USLEEP') && LITESPEED_CRAWLER_USLEEP > $this->_crawler_conf['run_delay']) {\n\t\t\t$this->_crawler_conf['run_delay'] = LITESPEED_CRAWLER_USLEEP;\n\t\t}\n\t\tif (!empty($_SERVER[Base::ENV_CRAWLER_USLEEP]) && $_SERVER[Base::ENV_CRAWLER_USLEEP] > $this->_crawler_conf['run_delay']) {\n\t\t\t$this->_crawler_conf['run_delay'] = $_SERVER[Base::ENV_CRAWLER_USLEEP];\n\t\t}\n\n\t\t$this->_crawler_conf['run_duration'] = $this->get_crawler_duration();\n\n\t\t$this->_crawler_conf['load_limit'] = $this->conf(Base::O_CRAWLER_LOAD_LIMIT);\n\t\tif (!empty($_SERVER[Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE])) {\n\t\t\t$this->_crawler_conf['load_limit'] = $_SERVER[Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE];\n\t\t} elseif (!empty($_SERVER[Base::ENV_CRAWLER_LOAD_LIMIT]) && $_SERVER[Base::ENV_CRAWLER_LOAD_LIMIT] < $this->_crawler_conf['load_limit']) {\n\t\t\t$this->_crawler_conf['load_limit'] = $_SERVER[Base::ENV_CRAWLER_LOAD_LIMIT];\n\t\t}\n\t\tif ($this->_crawler_conf['load_limit'] == 0) {\n\t\t\tself::debug('\ud83d\uded1 Terminated crawler due to load limit set to 0');\n\t\t\treturn false;\n\t\t}\n\n\t\t\/**\n\t\t * Set role simulation\n\t\t *\n\t\t * @since 1.9.1\n\t\t *\/\n\t\tif (!empty($current_crawler['uid'])) {\n\t\t\tif (!$this->_server_ip) {\n\t\t\t\tself::debug('\ud83d\uded1 Terminated crawler due to Server IP not set');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\/\/ Get role simulation vary name\n\t\t\t$vary_name                                  = $this->cls('Vary')->get_vary_name();\n\t\t\t$vary_val                                   = $this->cls('Vary')->finalize_default_vary($current_crawler['uid']);\n\t\t\t$this->_crawler_conf['cookies'][$vary_name] = $vary_val;\n\t\t\t$this->_crawler_conf['cookies']['litespeed_hash'] = Router::cls()->get_hash($current_crawler['uid']);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Get crawler duration allowance\n\t *\n\t * @since 7.0\n\t *\/\n\tpublic function get_crawler_duration() {\n\t\t$RUN_DURATION = defined('LITESPEED_CRAWLER_DURATION') ? LITESPEED_CRAWLER_DURATION : 900;\n\t\tif ($RUN_DURATION > 900) {\n\t\t\t$RUN_DURATION = 900; \/\/ reset to default value if defined in conf file is higher than 900 seconds for security enhancement\n\t\t}\n\t\treturn $RUN_DURATION;\n\t}\n\n\t\/**\n\t * Start crawler\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _engine_start() {\n\t\t\/\/ check if is running\n\t\t\/\/ if ($this->_summary['is_running'] && time() - $this->_summary['is_running'] < $this->_crawler_conf['run_duration']) {\n\t\t\/\/ $this->_end_reason = 'stopped';\n\t\t\/\/ self::debug('The crawler is running.');\n\t\t\/\/ return;\n\t\t\/\/ }\n\n\t\t\/\/ check current load\n\t\t$this->_adjust_current_threads();\n\t\tif ($this->_cur_threads == 0) {\n\t\t\t$this->_end_reason = 'stopped_highload';\n\t\t\tself::debug('Stopped due to heavy load.');\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ log started time\n\t\tself::save_summary(array( 'last_start_time' => time() ));\n\n\t\t\/\/ set time limit\n\t\t$maxTime = (int) ini_get('max_execution_time');\n\t\tself::debug('ini_get max_execution_time=' . $maxTime);\n\t\tif ($maxTime == 0) {\n\t\t\t$maxTime = 300; \/\/ hardlimit\n\t\t} else {\n\t\t\t$maxTime -= 5;\n\t\t}\n\t\tif ($maxTime >= $this->_crawler_conf['run_duration']) {\n\t\t\t$maxTime = $this->_crawler_conf['run_duration'];\n\t\t\tself::debug('Use run_duration setting as max_execution_time=' . $maxTime);\n\t\t} elseif (ini_set('max_execution_time', $this->_crawler_conf['run_duration'] + 15) !== false) {\n\t\t\t$maxTime = $this->_crawler_conf['run_duration'];\n\t\t\tself::debug('ini_set max_execution_time=' . $maxTime);\n\t\t}\n\t\tself::debug('final max_execution_time=' . $maxTime);\n\t\t$this->_max_run_time = $maxTime + time();\n\n\t\t\/\/ mark running\n\t\t$this->_prepare_running();\n\t\t\/\/ run crawler\n\t\t$this->_do_running();\n\t\t$this->_terminate_running();\n\t}\n\n\t\/**\n\t * Get server load\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic function get_server_load() {\n\t\t\/**\n\t\t * If server is windows, exit\n\t\t *\n\t\t * @see  https:\/\/wordpress.org\/support\/topic\/crawler-keeps-causing-crashes\/\n\t\t *\/\n\t\tif (!function_exists('sys_getloadavg')) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t$curload = sys_getloadavg();\n\t\t$curload = $curload[0];\n\t\tself::debug('Server load: ' . $curload);\n\t\treturn $curload;\n\t}\n\n\t\/**\n\t * Adjust threads dynamically\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _adjust_current_threads() {\n\t\t$curload = $this->get_server_load();\n\t\tif ($curload == -1) {\n\t\t\tself::debug('set threads=0 due to func sys_getloadavg not exist!');\n\t\t\t$this->_cur_threads = 0;\n\t\t\treturn;\n\t\t}\n\n\t\t$curload \/= $this->_ncpu;\n\t\t\/\/ $curload = 1;\n\t\t$CRAWLER_THREADS = defined('LITESPEED_CRAWLER_THREADS') ? LITESPEED_CRAWLER_THREADS : 3;\n\n\t\tif ($this->_cur_threads == -1) {\n\t\t\t\/\/ init\n\t\t\tif ($curload > $this->_crawler_conf['load_limit']) {\n\t\t\t\t$curthreads = 0;\n\t\t\t} elseif ($curload >= $this->_crawler_conf['load_limit'] - 1) {\n\t\t\t\t$curthreads = 1;\n\t\t\t} else {\n\t\t\t\t$curthreads = intval($this->_crawler_conf['load_limit'] - $curload);\n\t\t\t\tif ($curthreads > $CRAWLER_THREADS) {\n\t\t\t\t\t$curthreads = $CRAWLER_THREADS;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t\/\/ adjust\n\t\t\t$curthreads = $this->_cur_threads;\n\t\t\tif ($curload >= $this->_crawler_conf['load_limit'] + 1) {\n\t\t\t\tsleep(5); \/\/ sleep 5 secs\n\t\t\t\tif ($curthreads >= 1) {\n\t\t\t\t\t--$curthreads;\n\t\t\t\t}\n\t\t\t} elseif ($curload >= $this->_crawler_conf['load_limit']) {\n\t\t\t\t\/\/ if ( $curthreads > 1 ) {\/\/ if already 1, keep\n\t\t\t\t--$curthreads;\n\t\t\t\t\/\/ }\n\t\t\t} elseif ($curload + 1 < $this->_crawler_conf['load_limit']) {\n\t\t\t\tif ($curthreads < $CRAWLER_THREADS) {\n\t\t\t\t\t++$curthreads;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ $log = 'set current threads = ' . $curthreads . ' previous=' . $this->_cur_threads\n\t\t\/\/ . ' max_allowed=' . $CRAWLER_THREADS . ' load_limit=' . $this->_crawler_conf[ 'load_limit' ] . ' current_load=' . $curload;\n\n\t\t$this->_cur_threads     = $curthreads;\n\t\t$this->_cur_thread_time = time();\n\t}\n\n\t\/**\n\t * Mark running status\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _prepare_running() {\n\t\t$this->_summary['is_running']   = time();\n\t\t$this->_summary['done']         = 0; \/\/ reset done status\n\t\t$this->_summary['last_status']  = 'prepare running';\n\t\t$this->_summary['last_crawled'] = 0;\n\n\t\t\/\/ Current crawler starttime mark\n\t\tif ($this->_summary['last_pos'] == 0) {\n\t\t\t$this->_summary['curr_crawler_beginning_time'] = time();\n\t\t}\n\n\t\tif ($this->_summary['curr_crawler'] == 0 && $this->_summary['last_pos'] == 0) {\n\t\t\t$this->_summary['this_full_beginning_time'] = time();\n\t\t\t$this->_summary['list_size']                = $this->cls('Crawler_Map')->count_map();\n\t\t}\n\n\t\tif ($this->_summary['end_reason'] == 'end' && $this->_summary['last_pos'] == 0) {\n\t\t\t$this->_summary['crawler_stats'][$this->_summary['curr_crawler']] = array();\n\t\t}\n\n\t\tself::save_summary();\n\t}\n\n\t\/**\n\t * Take over lane\n\t *\n\t * @since 6.1\n\t *\/\n\tprivate function _take_over_lane() {\n\t\tself::debug('Take over lane as lane is free: ' . $this->json_local_path() . '.pid');\n\t\tFile::save($this->json_local_path() . '.pid', LITESPEED_LANE_HASH);\n\t}\n\n\t\/**\n\t * Update lane file\n\t *\n\t * @since 6.1\n\t *\/\n\tprivate function _touch_lane() {\n\t\ttouch($this->json_local_path() . '.pid');\n\t}\n\n\t\/**\n\t * Release lane file\n\t *\n\t * @since 6.1\n\t *\/\n\tpublic function Release_lane() {\n\t\t$lane_file = $this->json_local_path() . '.pid';\n\t\tif (!file_exists($lane_file)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Release lane');\n\t\tunlink($lane_file);\n\t}\n\n\t\/**\n\t * Check if lane is used by other crawlers\n\t *\n\t * @since 6.1\n\t *\/\n\tprivate function _check_valid_lane( $strict_mode = false ) {\n\t\t\/\/ Check lane hash\n\t\t$lane_file = $this->json_local_path() . '.pid';\n\t\tif ($strict_mode) {\n\t\t\tif (!file_exists($lane_file)) {\n\t\t\t\tself::debug(\"lane file not existed, strict mode is false [file] $lane_file\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\t$pid = File::read($lane_file);\n\t\tif ($pid && LITESPEED_LANE_HASH != $pid) {\n\t\t\t\/\/ If lane file is older than 1h, ignore\n\t\t\tif (time() - filemtime($lane_file) > 3600) {\n\t\t\t\tself::debug('Lane file is older than 1h, releasing lane');\n\t\t\t\t$this->Release_lane();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Test port for simulator\n\t *\n\t * @since  7.0\n\t * @access private\n\t * @return bool true if success and can continue crawling, false if failed and need to stop\n\t *\/\n\tprivate function _test_port() {\n\t\tif (!$this->_server_ip) {\n\t\t\tif (empty($this->_crawlers[$this->_summary['curr_crawler']]['uid'])) {\n\t\t\t\tself::debug('Bypass test port as Server IP is not set');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tself::debug('\u274c Server IP not set');\n\t\t\treturn false;\n\t\t}\n\t\tif (defined('LITESPEED_CRAWLER_LOCAL_PORT')) {\n\t\t\tself::debug('\u2705 LITESPEED_CRAWLER_LOCAL_PORT already defined');\n\t\t\treturn true;\n\t\t}\n\t\t\/\/ Don't repeat testing in 120s\n\t\tif (!empty($this->_summary['test_port_tts']) && time() - $this->_summary['test_port_tts'] < 120) {\n\t\t\tif (!empty($this->_summary['test_port'])) {\n\t\t\t\tself::debug('\u2705 Use tested local port: ' . $this->_summary['test_port']);\n\t\t\t\tdefine('LITESPEED_CRAWLER_LOCAL_PORT', $this->_summary['test_port']);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t$this->_summary['test_port_tts'] = time();\n\t\tself::save_summary();\n\n\t\t$options = $this->_get_curl_options();\n\t\t$home    = home_url();\n\t\tFile::save(LITESPEED_STATIC_DIR . '\/crawler\/test_port.html', $home, true);\n\t\t$url        = LITESPEED_STATIC_URL . '\/crawler\/test_port.html';\n\t\t$parsed_url = parse_url($url);\n\t\tif (empty($parsed_url['host'])) {\n\t\t\tself::debug('\u274c Test port failed, invalid URL: ' . $url);\n\t\t\treturn false;\n\t\t}\n\t\t$resolved                              = $parsed_url['host'] . ':443:' . $this->_server_ip;\n\t\t$options[CURLOPT_RESOLVE]              = array( $resolved );\n\t\t$options[CURLOPT_DNS_USE_GLOBAL_CACHE] = false;\n\t\t$options[CURLOPT_HEADER]               = false;\n\t\tself::debug('Test local 443 port for ' . $resolved);\n\n\t\t$ch = curl_init();\n\t\tcurl_setopt_array($ch, $options);\n\t\tcurl_setopt($ch, CURLOPT_URL, $url);\n\t\t$result      = curl_exec($ch);\n\t\t$test_result = false;\n\t\tif (curl_errno($ch) || $result !== $home) {\n\t\t\tif (curl_errno($ch)) {\n\t\t\t\tself::debug('\u274c Test port curl error: [errNo] ' . curl_errno($ch) . ' [err] ' . curl_error($ch));\n\t\t\t} elseif ($result !== $home) {\n\t\t\t\tself::debug('\u274c Test port response is wrong: ' . $result);\n\t\t\t}\n\t\t\tself::debug('\u274c Test local 443 port failed, try port 80');\n\n\t\t\t\/\/ Try port 80\n\t\t\t$resolved                 = $parsed_url['host'] . ':80:' . $this->_server_ip;\n\t\t\t$options[CURLOPT_RESOLVE] = array( $resolved );\n\t\t\t$url                      = str_replace('https:\/\/', 'http:\/\/', $url);\n\t\t\tif (!in_array('X-Forwarded-Proto: https', $options[CURLOPT_HTTPHEADER])) {\n\t\t\t\t$options[CURLOPT_HTTPHEADER][] = 'X-Forwarded-Proto: https';\n\t\t\t}\n\t\t\t\/\/ $options[CURLOPT_HTTPHEADER][] = 'X-Forwarded-SSL: on';\n\t\t\t$ch = curl_init();\n\t\t\tcurl_setopt_array($ch, $options);\n\t\t\tcurl_setopt($ch, CURLOPT_URL, $url);\n\t\t\t$result = curl_exec($ch);\n\t\t\tif (curl_errno($ch)) {\n\t\t\t\tself::debug('\u274c Test port curl error: [errNo] ' . curl_errno($ch) . ' [err] ' . curl_error($ch));\n\t\t\t} elseif ($result !== $home) {\n\t\t\t\tself::debug('\u274c Test port response is wrong: ' . $result);\n\t\t\t} else {\n\t\t\t\tself::debug('\u2705 Test local 80 port successfully');\n\t\t\t\tdefine('LITESPEED_CRAWLER_LOCAL_PORT', 80);\n\t\t\t\t$this->_summary['test_port'] = 80;\n\t\t\t\t$test_result                 = true;\n\t\t\t}\n\t\t\t\/\/ self::debug('Response data: ' . $result);\n\t\t\t\/\/ $this->Release_lane();\n\t\t\t\/\/ exit($result);\n\t\t} else {\n\t\t\tself::debug('\u2705 Tested local 443 port successfully');\n\t\t\tdefine('LITESPEED_CRAWLER_LOCAL_PORT', 443);\n\t\t\t$this->_summary['test_port'] = 443;\n\t\t\t$test_result                 = true;\n\t\t}\n\t\tself::save_summary();\n\t\tcurl_close($ch);\n\t\treturn $test_result;\n\t}\n\n\t\/**\n\t * Run crawler\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _do_running() {\n\t\t$options = $this->_get_curl_options(true);\n\n\t\t\/\/ If is role simulator and not defined local port, check port once\n\t\t$test_result = $this->_test_port();\n\t\tif (!$test_result) {\n\t\t\t$this->_end_reason = 'port_test_failed';\n\t\t\tself::debug('\u274c Test port failed, crawler stopped.');\n\t\t\treturn;\n\t\t}\n\n\t\twhile ($urlChunks = $this->cls('Crawler_Map')->list_map(self::CHUNKS, $this->_summary['last_pos'])) {\n\t\t\t\/\/ self::debug('$urlChunks=' . count($urlChunks) . ' $this->_cur_threads=' . $this->_cur_threads);\n\t\t\t\/\/ start crawling\n\t\t\t$urlChunks = array_chunk($urlChunks, $this->_cur_threads);\n\t\t\t\/\/ self::debug('$urlChunks after array_chunk: ' . count($urlChunks));\n\t\t\tforeach ($urlChunks as $rows) {\n\t\t\t\tif (!$this->_check_valid_lane(true)) {\n\t\t\t\t\t$this->_end_reason = 'lane_invalid';\n\t\t\t\t\tself::debug('\ud83d\uded1 The crawler lane is used by newer crawler.');\n\t\t\t\t\tthrow new \\Exception('invalid crawler lane');\n\t\t\t\t}\n\t\t\t\t\/\/ Update time\n\t\t\t\t$this->_touch_lane();\n\n\t\t\t\t\/\/ self::debug('chunk fetching count($rows)= ' . count($rows));\n\t\t\t\t\/\/ multi curl\n\t\t\t\t$rets = $this->_multi_request($rows, $options);\n\n\t\t\t\t\/\/ check result headers\n\t\t\t\tforeach ($rows as $row) {\n\t\t\t\t\t\/\/ self::debug('chunk fetching 553');\n\t\t\t\t\tif (empty($rets[$row['id']])) {\n\t\t\t\t\t\t\/\/ If already in blacklist, no curl happened, no corresponding record\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t\/\/ self::debug('chunk fetching 557');\n\t\t\t\t\t\/\/ check response\n\t\t\t\t\tif ($rets[$row['id']]['code'] == 428) {\n\t\t\t\t\t\t\/\/ HTTP\/1.1 428 Precondition Required (need to test)\n\t\t\t\t\t\t$this->_end_reason = 'crawler_disabled';\n\t\t\t\t\t\tself::debug('crawler_disabled');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$status = $this->_status_parse($rets[$row['id']]['header'], $rets[$row['id']]['code'], $row['url']); \/\/ B or H or M or N(nocache)\n\t\t\t\t\tself::debug('[status] ' . $this->_status2title($status) . \"\\t\\t [url] \" . $row['url']);\n\t\t\t\t\t$this->_map_status_list[$status][$row['id']] = array(\n\t\t\t\t\t\t'url' => $row['url'],\n\t\t\t\t\t\t'code' => $rets[$row['id']]['code'], \/\/ 201 or 200 or 404\n\t\t\t\t\t);\n\t\t\t\t\tif (empty($this->_summary['crawler_stats'][$this->_summary['curr_crawler']][$status])) {\n\t\t\t\t\t\t$this->_summary['crawler_stats'][$this->_summary['curr_crawler']][$status] = 0;\n\t\t\t\t\t}\n\t\t\t\t\t++$this->_summary['crawler_stats'][$this->_summary['curr_crawler']][$status];\n\t\t\t\t}\n\n\t\t\t\t\/\/ update offset position\n\t\t\t\t$_time                              = time();\n\t\t\t\t$this->_summary['last_count']       = count($rows);\n\t\t\t\t$this->_summary['last_pos']        += $this->_summary['last_count'];\n\t\t\t\t$this->_summary['last_crawled']    += $this->_summary['last_count'];\n\t\t\t\t$this->_summary['last_update_time'] = $_time;\n\t\t\t\t$this->_summary['last_status']      = 'updated position';\n\t\t\t\t\/\/ self::debug(\"chunk fetching 604 last_pos:{$this->_summary['last_pos']} last_count:{$this->_summary['last_count']} last_crawled:{$this->_summary['last_crawled']}\");\n\t\t\t\t\/\/ check duration\n\t\t\t\tif ($this->_summary['last_update_time'] > $this->_max_run_time) {\n\t\t\t\t\t$this->_end_reason = 'stopped_maxtime';\n\t\t\t\t\tself::debug('Terminated due to maxtime');\n\t\t\t\t\treturn;\n\t\t\t\t\t\/\/ return __('Stopped due to exceeding defined Maximum Run Time', 'litespeed-cache');\n\t\t\t\t}\n\n\t\t\t\t\/\/ make sure at least each 10s save meta & map status once\n\t\t\t\tif ($_time - $this->_summary['meta_save_time'] > 10) {\n\t\t\t\t\t$this->_map_status_list = $this->cls('Crawler_Map')->save_map_status($this->_map_status_list, $this->_summary['curr_crawler']);\n\t\t\t\t\tself::save_summary();\n\t\t\t\t}\n\t\t\t\t\/\/ self::debug('chunk fetching 597');\n\t\t\t\t\/\/ check if need to reset pos each 5s\n\t\t\t\tif ($_time > $this->_summary['pos_reset_check']) {\n\t\t\t\t\t$this->_summary['pos_reset_check'] = $_time + 5;\n\t\t\t\t\tif (file_exists($this->_resetfile) && unlink($this->_resetfile)) {\n\t\t\t\t\t\tself::debug('Terminated due to reset file');\n\n\t\t\t\t\t\t$this->_summary['last_pos']                                       = 0;\n\t\t\t\t\t\t$this->_summary['curr_crawler']                                   = 0;\n\t\t\t\t\t\t$this->_summary['crawler_stats'][$this->_summary['curr_crawler']] = array();\n\t\t\t\t\t\t\/\/ reset done status\n\t\t\t\t\t\t$this->_summary['done']                     = 0;\n\t\t\t\t\t\t$this->_summary['this_full_beginning_time'] = 0;\n\t\t\t\t\t\t$this->_end_reason                          = 'stopped_reset';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\/\/ return __('Stopped due to reset meta position', 'litespeed-cache');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\/\/ self::debug('chunk fetching 615');\n\t\t\t\t\/\/ check loads\n\t\t\t\tif ($this->_summary['last_update_time'] - $this->_cur_thread_time > 60) {\n\t\t\t\t\t$this->_adjust_current_threads();\n\t\t\t\t\tif ($this->_cur_threads == 0) {\n\t\t\t\t\t\t$this->_end_reason = 'stopped_highload';\n\t\t\t\t\t\tself::debug('\ud83d\uded1 Terminated due to highload');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\/\/ return __('Stopped due to load over limit', 'litespeed-cache');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$this->_summary['last_status'] = 'sleeping ' . $this->_crawler_conf['run_delay'] . 'ms';\n\n\t\t\t\tusleep($this->_crawler_conf['run_delay']);\n\t\t\t}\n\t\t\t\/\/ self::debug('chunk fetching done');\n\t\t}\n\n\t\t\/\/ All URLs are done for current crawler\n\t\t$this->_end_reason = 'end';\n\t\t$this->_summary['crawler_stats'][$this->_summary['curr_crawler']]['W'] = 0;\n\t\tself::debug('Crawler #' . $this->_summary['curr_crawler'] . ' touched end');\n\t}\n\n\t\/**\n\t * If need to resolve DNS or not\n\t *\n\t * @since 7.3.0.1\n\t *\/\n\tprivate function _should_force_resolve_dns() {\n\t\tif ($this->_server_ip) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!empty($this->_crawler_conf['cookies']) && !empty($this->_crawler_conf['cookies']['litespeed_hash'])) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Send multi curl requests\n\t * If res=B, bypass request and won't return\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _multi_request( $rows, $options ) {\n\t\tif (!function_exists('curl_multi_init')) {\n\t\t\texit('curl_multi_init disabled');\n\t\t}\n\t\t$mh                  = curl_multi_init();\n\t\t$CRAWLER_DROP_DOMAIN = defined('LITESPEED_CRAWLER_DROP_DOMAIN') ? LITESPEED_CRAWLER_DROP_DOMAIN : false;\n\t\t$curls               = array();\n\t\tforeach ($rows as $row) {\n\t\t\tif (substr($row['res'], $this->_summary['curr_crawler'], 1) == self::STATUS_BLACKLIST) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (substr($row['res'], $this->_summary['curr_crawler'], 1) == self::STATUS_NOCACHE) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!function_exists('curl_init')) {\n\t\t\t\texit('curl_init disabled');\n\t\t\t}\n\n\t\t\t$curls[$row['id']] = curl_init();\n\n\t\t\t\/\/ Append URL\n\t\t\t$url = $row['url'];\n\t\t\tif ($CRAWLER_DROP_DOMAIN) {\n\t\t\t\t$url = $this->_crawler_conf['base'] . $row['url'];\n\t\t\t}\n\n\t\t\t\/\/ IP resolve\n\t\t\tif ($this->_should_force_resolve_dns()) {\n\t\t\t\t$parsed_url = parse_url($url);\n\t\t\t\t\/\/ self::debug('Crawl role simulator, required to use localhost for resolve');\n\n\t\t\t\tif (!empty($parsed_url['host'])) {\n\t\t\t\t\t$dom                                   = $parsed_url['host'];\n\t\t\t\t\t$port                                  = defined('LITESPEED_CRAWLER_LOCAL_PORT') ? LITESPEED_CRAWLER_LOCAL_PORT : '443';\n\t\t\t\t\t$resolved                              = $dom . ':' . $port . ':' . $this->_server_ip;\n\t\t\t\t\t$options[CURLOPT_RESOLVE]              = array( $resolved );\n\t\t\t\t\t$options[CURLOPT_DNS_USE_GLOBAL_CACHE] = false;\n\t\t\t\t\t\/\/ $options[CURLOPT_PORT] = $port;\n\t\t\t\t\tif ($port == 80) {\n\t\t\t\t\t\t$url = str_replace('https:\/\/', 'http:\/\/', $url);\n\t\t\t\t\t\tif (!in_array('X-Forwarded-Proto: https', $options[CURLOPT_HTTPHEADER])) {\n\t\t\t\t\t\t\t$options[CURLOPT_HTTPHEADER][] = 'X-Forwarded-Proto: https';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tself::debug('Resolved DNS for ' . $resolved);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurl_setopt($curls[$row['id']], CURLOPT_URL, $url);\n\t\t\tself::debug('Crawling [url] ' . $url . ($url == $row['url'] ? '' : ' [ori] ' . $row['url']));\n\n\t\t\tcurl_setopt_array($curls[$row['id']], $options);\n\n\t\t\tcurl_multi_add_handle($mh, $curls[$row['id']]);\n\t\t}\n\n\t\t\/\/ execute curl\n\t\tif ($curls) {\n\t\t\tdo {\n\t\t\t\t$status = curl_multi_exec($mh, $active);\n\t\t\t\tif ($active) {\n\t\t\t\t\tcurl_multi_select($mh);\n\t\t\t\t}\n\t\t\t} while ($active && $status == CURLM_OK);\n\t\t}\n\n\t\t\/\/ curl done\n\t\t$ret = array();\n\t\tforeach ($rows as $row) {\n\t\t\tif (substr($row['res'], $this->_summary['curr_crawler'], 1) == self::STATUS_BLACKLIST) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (substr($row['res'], $this->_summary['curr_crawler'], 1) == self::STATUS_NOCACHE) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\/\/ self::debug('-----debug3');\n\t\t\t$ch = $curls[$row['id']];\n\n\t\t\t\/\/ Parse header\n\t\t\t$header_size = curl_getinfo($ch, CURLINFO_HEADER_SIZE);\n\t\t\t$content     = curl_multi_getcontent($ch);\n\t\t\t$header      = substr($content, 0, $header_size);\n\n\t\t\t$ret[$row['id']] = array(\n\t\t\t\t'header' => $header,\n\t\t\t\t'code' => curl_getinfo($ch, CURLINFO_HTTP_CODE),\n\t\t\t);\n\t\t\t\/\/ self::debug('-----debug4');\n\t\t\tcurl_multi_remove_handle($mh, $ch);\n\t\t\tcurl_close($ch);\n\t\t}\n\t\t\/\/ self::debug('-----debug5');\n\t\tcurl_multi_close($mh);\n\t\t\/\/ self::debug('-----debug6');\n\t\treturn $ret;\n\t}\n\n\t\/**\n\t * Translate the status to title\n\t *\n\t * @since 6.0\n\t *\/\n\tprivate function _status2title( $status ) {\n\t\tif ($status == self::STATUS_HIT) {\n\t\t\treturn '\u2705 Hit';\n\t\t}\n\t\tif ($status == self::STATUS_MISS) {\n\t\t\treturn '\ud83d\ude0a Miss';\n\t\t}\n\t\tif ($status == self::STATUS_BLACKLIST) {\n\t\t\treturn '\ud83d\ude05 Blacklisted';\n\t\t}\n\t\tif ($status == self::STATUS_NOCACHE) {\n\t\t\treturn '\ud83d\ude05 Blacklisted';\n\t\t}\n\t\treturn '\ud83d\udef8 Unknown';\n\t}\n\n\t\/**\n\t * Check returned curl header to find if cached or not\n\t *\n\t * @since  2.0\n\t * @access private\n\t *\/\n\tprivate function _status_parse( $header, $code, $url ) {\n\t\t\/\/ self::debug('http status code: ' . $code . ' [headers]', $header);\n\t\tif ($code == 201) {\n\t\t\treturn self::STATUS_HIT;\n\t\t}\n\n\t\tif (stripos($header, 'X-Litespeed-Cache-Control: no-cache') !== false) {\n\t\t\t\/\/ If is from DIVI, taken as miss\n\t\t\tif (defined('LITESPEED_CRAWLER_IGNORE_NONCACHEABLE') && LITESPEED_CRAWLER_IGNORE_NONCACHEABLE) {\n\t\t\t\treturn self::STATUS_MISS;\n\t\t\t}\n\n\t\t\t\/\/ If blacklist is disabled\n\t\t\tif ((defined('LITESPEED_CRAWLER_DISABLE_BLOCKLIST') && LITESPEED_CRAWLER_DISABLE_BLOCKLIST) || apply_filters('litespeed_crawler_disable_blocklist', false, $url)) {\n\t\t\t\treturn self::STATUS_MISS;\n\t\t\t}\n\n\t\t\treturn self::STATUS_NOCACHE; \/\/ Blacklist\n\t\t}\n\n\t\t$_cache_headers = array( 'x-litespeed-cache', 'x-qc-cache', 'x-lsadc-cache' );\n\n\t\tforeach ($_cache_headers as $_header) {\n\t\t\tif (stripos($header, $_header) !== false) {\n\t\t\t\tif (stripos($header, $_header . ': bkn') !== false) {\n\t\t\t\t\treturn self::STATUS_HIT; \/\/ Hit\n\t\t\t\t}\n\t\t\t\tif (stripos($header, $_header . ': miss') !== false) {\n\t\t\t\t\treturn self::STATUS_MISS; \/\/ Miss\n\t\t\t\t}\n\t\t\t\treturn self::STATUS_HIT; \/\/ Hit\n\t\t\t}\n\t\t}\n\n\t\t\/\/ If blacklist is disabled\n\t\tif ((defined('LITESPEED_CRAWLER_DISABLE_BLOCKLIST') && LITESPEED_CRAWLER_DISABLE_BLOCKLIST) || apply_filters('litespeed_crawler_disable_blocklist', false, $url)) {\n\t\t\treturn self::STATUS_MISS;\n\t\t}\n\n\t\treturn self::STATUS_BLACKLIST; \/\/ Blacklist\n\t}\n\n\t\/**\n\t * Get curl_options\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _get_curl_options( $crawler_only = false ) {\n\t\t$CRAWLER_TIMEOUT               = defined('LITESPEED_CRAWLER_TIMEOUT') ? LITESPEED_CRAWLER_TIMEOUT : 30;\n\t\t$options                       = array(\n\t\t\tCURLOPT_RETURNTRANSFER => true,\n\t\t\tCURLOPT_HEADER => true,\n\t\t\tCURLOPT_CUSTOMREQUEST => 'GET',\n\t\t\tCURLOPT_FOLLOWLOCATION => false,\n\t\t\tCURLOPT_ENCODING => 'gzip',\n\t\t\tCURLOPT_CONNECTTIMEOUT => 10,\n\t\t\tCURLOPT_TIMEOUT => $CRAWLER_TIMEOUT, \/\/ Larger timeout to avoid incorrect blacklist addition #900171\n\t\t\tCURLOPT_SSL_VERIFYHOST => 0,\n\t\t\tCURLOPT_SSL_VERIFYPEER => false,\n\t\t\tCURLOPT_NOBODY => false,\n\t\t\tCURLOPT_HTTPHEADER => $this->_crawler_conf['headers'],\n\t\t);\n\t\t$options[CURLOPT_HTTPHEADER][] = 'Cache-Control: max-age=0';\n\n\t\t\/**\n\t\t * Try to enable http2 connection (only available since PHP7+)\n\t\t *\n\t\t * @since  1.9.1\n\t\t * @since  2.2.7 Commented due to cause no-cache issue\n\t\t * @since  2.9.1+ Fixed wrongly usage of CURL_HTTP_VERSION_1_1 const\n\t\t *\/\n\t\t$options[CURLOPT_HTTP_VERSION] = CURL_HTTP_VERSION_1_1;\n\t\t\/\/ $options[ CURL_HTTP_VERSION_2 ] = 1;\n\n\t\t\/\/ if is walker\n\t\t\/\/ $options[ CURLOPT_FRESH_CONNECT ] = true;\n\n\t\t\/\/ Referer\n\t\tif (isset($_SERVER['HTTP_HOST']) && isset($_SERVER['REQUEST_URI'])) {\n\t\t\t$options[CURLOPT_REFERER] = 'http:\/\/' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];\n\t\t}\n\n\t\t\/\/ User Agent\n\t\tif ($crawler_only) {\n\t\t\tif (strpos($this->_crawler_conf['ua'], self::FAST_USER_AGENT) !== 0) {\n\t\t\t\t$this->_crawler_conf['ua'] = self::FAST_USER_AGENT . ' ' . $this->_crawler_conf['ua'];\n\t\t\t}\n\t\t}\n\t\t$options[CURLOPT_USERAGENT] = $this->_crawler_conf['ua'];\n\n\t\t\/\/ Cookies\n\t\t$cookies = array();\n\t\tforeach ($this->_crawler_conf['cookies'] as $k => $v) {\n\t\t\tif (!$v) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$cookies[] = $k . '=' . urlencode($v);\n\t\t}\n\t\tif ($cookies) {\n\t\t\t$options[CURLOPT_COOKIE] = implode('; ', $cookies);\n\t\t}\n\n\t\treturn $options;\n\t}\n\n\t\/**\n\t * Self curl to get HTML content\n\t *\n\t * @since  3.3\n\t *\/\n\tpublic function self_curl( $url, $ua, $uid = false, $accept = false ) {\n\t\t\/\/ $accept not in use yet\n\t\t$this->_crawler_conf['base'] = site_url();\n\t\t$this->_crawler_conf['ua']   = $ua;\n\t\tif ($accept) {\n\t\t\t$this->_crawler_conf['headers'] = array( 'Accept: ' . $accept );\n\t\t}\n\t\t$options = $this->_get_curl_options();\n\n\t\tif ($uid) {\n\t\t\t$this->_crawler_conf['cookies']['litespeed_flash_hash'] = Router::cls()->get_flash_hash($uid);\n\t\t\t$parsed_url = parse_url($url);\n\n\t\t\tif (!empty($parsed_url['host'])) {\n\t\t\t\t$dom                                   = $parsed_url['host'];\n\t\t\t\t$port                                  = defined('LITESPEED_CRAWLER_LOCAL_PORT') ? LITESPEED_CRAWLER_LOCAL_PORT : '443'; \/\/ TODO: need to test port?\n\t\t\t\t$resolved                              = $dom . ':' . $port . ':' . $this->_server_ip;\n\t\t\t\t$options[CURLOPT_RESOLVE]              = array( $resolved );\n\t\t\t\t$options[CURLOPT_DNS_USE_GLOBAL_CACHE] = false;\n\t\t\t\t$options[CURLOPT_PORT]                 = $port;\n\t\t\t\tself::debug('Resolved DNS for ' . $resolved);\n\t\t\t}\n\t\t}\n\n\t\t$options[CURLOPT_HEADER]         = false;\n\t\t$options[CURLOPT_FOLLOWLOCATION] = true;\n\n\t\t$ch = curl_init();\n\t\tcurl_setopt_array($ch, $options);\n\t\tcurl_setopt($ch, CURLOPT_URL, $url);\n\t\t$result = curl_exec($ch);\n\t\t$code   = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n\t\tcurl_close($ch);\n\n\t\tif ($code != 200) {\n\t\t\tself::debug('\u274c Response code is not 200 in self_curl() [code] ' . var_export($code, true));\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $result;\n\t}\n\n\t\/**\n\t * Terminate crawling\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _terminate_running() {\n\t\t$this->_map_status_list = $this->cls('Crawler_Map')->save_map_status($this->_map_status_list, $this->_summary['curr_crawler']);\n\n\t\tif ($this->_end_reason == 'end') {\n\t\t\t\/\/ Current crawler is fully done\n\t\t\t\/\/ $end_reason = sprintf( __( 'Crawler %s reached end of sitemap file.', 'litespeed-cache' ), '#' . ( $this->_summary['curr_crawler'] + 1 ) );\n\t\t\t++$this->_summary['curr_crawler']; \/\/ Jump to next crawler\n\t\t\t\/\/ $this->_summary[ 'crawler_stats' ][ $this->_summary[ 'curr_crawler' ] ] = array(); \/\/ reset this at next crawl time\n\t\t\t$this->_summary['last_pos']                = 0; \/\/ reset last position\n\t\t\t$this->_summary['last_crawler_total_cost'] = time() - $this->_summary['curr_crawler_beginning_time'];\n\t\t\t$count_crawlers                            = count($this->list_crawlers());\n\t\t\tif ($this->_summary['curr_crawler'] >= $count_crawlers) {\n\t\t\t\tself::debug('_terminate_running Touched end, whole crawled. Reload crawler!');\n\t\t\t\t$this->_summary['curr_crawler'] = 0;\n\t\t\t\t\/\/ $this->_summary[ 'crawler_stats' ][ $this->_summary[ 'curr_crawler' ] ] = array();\n\t\t\t\t$this->_summary['done']                = 'touchedEnd'; \/\/ log done status\n\t\t\t\t$this->_summary['last_full_time_cost'] = time() - $this->_summary['this_full_beginning_time'];\n\t\t\t}\n\t\t}\n\t\t$this->_summary['last_status'] = 'stopped';\n\t\t$this->_summary['is_running']  = 0;\n\t\t$this->_summary['end_reason']  = $this->_end_reason;\n\t\tself::save_summary();\n\t}\n\n\t\/**\n\t * List all crawlers ( tagA => [ valueA => titleA, ... ] ...)\n\t *\n\t * @since    1.9.1\n\t * @access   public\n\t *\/\n\tpublic function list_crawlers() {\n\t\tif ($this->_crawlers) {\n\t\t\treturn $this->_crawlers;\n\t\t}\n\n\t\t$crawler_factors = array();\n\n\t\t\/\/ Add default Guest crawler\n\t\t$crawler_factors['uid'] = array( 0 => __('Guest', 'litespeed-cache') );\n\n\t\t\/\/ WebP on\/off\n\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP)) {\n\t\t\t$crawler_factors['webp'] = array( 1 => $this->cls('Media')->next_gen_image_title() );\n\t\t\tif (apply_filters('litespeed_crawler_webp', false)) {\n\t\t\t\t$crawler_factors['webp'][0] = '';\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Guest Mode on\/off\n\t\tif ($this->conf(Base::O_GUEST)) {\n\t\t\t$vary_name = $this->cls('Vary')->get_vary_name();\n\t\t\t$vary_val  = 'guest_mode:1';\n\t\t\tif (!defined('LSCWP_LOG')) {\n\t\t\t\t$vary_val = md5($this->conf(Base::HASH) . $vary_val);\n\t\t\t}\n\t\t\t$crawler_factors['cookie:' . $vary_name] = array(\n\t\t\t\t$vary_val => '',\n\t\t\t\t'_null' => '<font data-balloon-pos=\"up\" aria-label=\"Guest Mode\">\ud83d\udc52<\/font>',\n\t\t\t);\n\t\t}\n\n\t\t\/\/ Mobile crawler\n\t\tif ($this->conf(Base::O_CACHE_MOBILE)) {\n\t\t\t$crawler_factors['mobile'] = array(\n\t\t\t\t1 => '<font data-balloon-pos=\"up\" aria-label=\"Mobile\">\ud83d\udcf1<\/font>',\n\t\t\t\t0 => '',\n\t\t\t);\n\t\t}\n\n\t\t\/\/ Get roles set\n\t\t\/\/ List all roles\n\t\tforeach ($this->conf(Base::O_CRAWLER_ROLES) as $v) {\n\t\t\t$role_title = '';\n\t\t\t$udata      = get_userdata($v);\n\t\t\tif (isset($udata->roles) && is_array($udata->roles)) {\n\t\t\t\t$tmp        = array_values($udata->roles);\n\t\t\t\t$role_title = array_shift($tmp);\n\t\t\t}\n\t\t\tif (!$role_title) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$crawler_factors['uid'][$v] = ucfirst($role_title);\n\t\t}\n\n\t\t\/\/ Cookie crawler\n\t\tforeach ($this->conf(Base::O_CRAWLER_COOKIES) as $v) {\n\t\t\tif (empty($v['name'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this_cookie_key = 'cookie:' . $v['name'];\n\n\t\t\t$crawler_factors[$this_cookie_key] = array();\n\n\t\t\tforeach ($v['vals'] as $v2) {\n\t\t\t\t$crawler_factors[$this_cookie_key][$v2] =\n\t\t\t\t\t$v2 == '_null' ? '' : '<font data-balloon-pos=\"up\" aria-label=\"Cookie\">\ud83c\udf6a<\/font>' . esc_html($v['name']) . '=' . esc_html($v2);\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Crossing generate the crawler list\n\t\t$this->_crawlers = $this->_recursive_build_crawler($crawler_factors);\n\n\t\treturn $this->_crawlers;\n\t}\n\n\t\/**\n\t * Build a crawler list recursively\n\t *\n\t * @since 2.8\n\t * @access private\n\t *\/\n\tprivate function _recursive_build_crawler( $crawler_factors, $group = array(), $i = 0 ) {\n\t\t$current_factor = array_keys($crawler_factors);\n\t\t$current_factor = $current_factor[$i];\n\n\t\t$if_touch_end = $i + 1 >= count($crawler_factors);\n\n\t\t$final_list = array();\n\n\t\tforeach ($crawler_factors[$current_factor] as $k => $v) {\n\t\t\t\/\/ Don't alter $group bcos of loop usage\n\t\t\t$item          = $group;\n\t\t\t$item['title'] = !empty($group['title']) ? $group['title'] : '';\n\t\t\tif ($v) {\n\t\t\t\tif ($item['title']) {\n\t\t\t\t\t$item['title'] .= ' - ';\n\t\t\t\t}\n\t\t\t\t$item['title'] .= $v;\n\t\t\t}\n\t\t\t$item[$current_factor] = $k;\n\n\t\t\tif ($if_touch_end) {\n\t\t\t\t$final_list[] = $item;\n\t\t\t} else {\n\t\t\t\t\/\/ Inception: next layer\n\t\t\t\t$final_list = array_merge($final_list, $this->_recursive_build_crawler($crawler_factors, $item, $i + 1));\n\t\t\t}\n\t\t}\n\n\t\treturn $final_list;\n\t}\n\n\t\/**\n\t * Return crawler meta file local path\n\t *\n\t * @since    6.1\n\t * @access public\n\t *\/\n\tpublic function json_local_path() {\n\t\t\/\/ if (!file_exists(LITESPEED_STATIC_DIR . '\/crawler\/' . $this->_sitemeta)) {\n\t\t\/\/ return false;\n\t\t\/\/ }\n\n\t\treturn LITESPEED_STATIC_DIR . '\/crawler\/' . $this->_sitemeta;\n\t}\n\n\t\/**\n\t * Return crawler meta file\n\t *\n\t * @since    1.1.0\n\t * @access public\n\t *\/\n\tpublic function json_path() {\n\t\tif (!file_exists(LITESPEED_STATIC_DIR . '\/crawler\/' . $this->_sitemeta)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn LITESPEED_STATIC_URL . '\/crawler\/' . $this->_sitemeta;\n\t}\n\n\t\/**\n\t * Create reset pos file\n\t *\n\t * @since    1.1.0\n\t * @access public\n\t *\/\n\tpublic function reset_pos() {\n\t\tFile::save($this->_resetfile, time(), true);\n\n\t\tself::save_summary(array( 'is_running' => 0 ));\n\t}\n\n\t\/**\n\t * Display status based by matching crawlers order\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function display_status( $status_row, $reason_set ) {\n\t\tif (!$status_row) {\n\t\t\treturn '';\n\t\t}\n\n\t\t$_status_list = array(\n\t\t\t'-' => 'default',\n\t\t\tself::STATUS_MISS => 'primary',\n\t\t\tself::STATUS_HIT => 'success',\n\t\t\tself::STATUS_BLACKLIST => 'danger',\n\t\t\tself::STATUS_NOCACHE => 'warning',\n\t\t);\n\n\t\t$reason_set = explode(',', $reason_set);\n\n\t\t$status = '';\n\t\tforeach (str_split($status_row) as $k => $v) {\n\t\t\t$reason = $reason_set[$k];\n\t\t\tif ($reason == 'Man') {\n\t\t\t\t$reason = __('Manually added to blocklist', 'litespeed-cache');\n\t\t\t}\n\t\t\tif ($reason == 'Existed') {\n\t\t\t\t$reason = __('Previously existed in blocklist', 'litespeed-cache');\n\t\t\t}\n\t\t\tif ($reason) {\n\t\t\t\t$reason = 'data-balloon-pos=\"up\" aria-label=\"' . $reason . '\"';\n\t\t\t}\n\t\t\t$status .= '<i class=\"litespeed-dot litespeed-bg-' . $_status_list[$v] . '\" ' . $reason . '>' . ($k + 1) . '<\/i>';\n\t\t}\n\n\t\treturn $status;\n\t}\n\n\t\/**\n\t * Output info and exit\n\t *\n\t * @since    1.1.0\n\t * @access protected\n\t * @param  string $msg Error info\n\t *\/\n\tprotected function output( $msg ) {\n\t\tif (wp_doing_cron()) {\n\t\t\techo $msg;\n\t\t\t\/\/ exit();\n\t\t} else {\n\t\t\techo \"<script>alert('\" . htmlspecialchars($msg) . \"');<\/script>\";\n\t\t\t\/\/ exit;\n\t\t}\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_REFRESH_MAP:\n            $this->cls('Crawler_Map')->gen(true);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_EMPTY:\n            $this->cls('Crawler_Map')->empty_map();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_BLACKLIST_EMPTY:\n            $this->cls('Crawler_Map')->blacklist_empty();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_BLACKLIST_DEL:\n            if (!empty($_GET['id'])) {\n\t\t\t\t\t$this->cls('Crawler_Map')->blacklist_del($_GET['id']);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_BLACKLIST_ADD:\n            if (!empty($_GET['id'])) {\n\t\t\t\t\t$this->cls('Crawler_Map')->blacklist_add($_GET['id']);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_START: \/\/ Handle the ajax request to proceed crawler manually by admin\n            self::start_async();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESET:\n            $this->reset_pos();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/admin-display.cls.php","ext":"php","size":50020,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The admin-panel specific functionality of the plugin.\n *\n * Provides admin page rendering, notices, enqueueing of assets,\n * menu registrations, and various admin utilities.\n *\n * @since      1.0.0\n * @package    LiteSpeed\n * @subpackage LiteSpeed\/admin\n * @author     LiteSpeed Technologies <info@litespeedtech.com>\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Admin_Display\n *\n * Handles WP-Admin UI for LiteSpeed Cache.\n *\/\nclass Admin_Display extends Base {\n\n\t\/**\n\t * Log tag for Admin_Display.\n\t *\n\t * @var string\n\t *\/\n\tconst LOG_TAG = '\ud83d\udc6e\u200d\u2640\ufe0f';\n\n\t\/**\n\t * Notice class (info\/blue).\n\t *\n\t * @var string\n\t *\/\n\tconst NOTICE_BLUE = 'notice notice-info';\n\t\/**\n\t * Notice class (success\/green).\n\t *\n\t * @var string\n\t *\/\n\tconst NOTICE_GREEN = 'notice notice-success';\n\t\/**\n\t * Notice class (error\/red).\n\t *\n\t * @var string\n\t *\/\n\tconst NOTICE_RED = 'notice notice-error';\n\t\/**\n\t * Notice class (warning\/yellow).\n\t *\n\t * @var string\n\t *\/\n\tconst NOTICE_YELLOW = 'notice notice-warning';\n\t\/**\n\t * Option key for one-time messages.\n\t *\n\t * @var string\n\t *\/\n\tconst DB_MSG = 'messages';\n\t\/**\n\t * Option key for pinned messages.\n\t *\n\t * @var string\n\t *\/\n\tconst DB_MSG_PIN = 'msg_pin';\n\n\t\/**\n\t * Purge by: category.\n\t *\n\t * @var string\n\t *\/\n\tconst PURGEBY_CAT = '0';\n\t\/**\n\t * Purge by: post ID.\n\t *\n\t * @var string\n\t *\/\n\tconst PURGEBY_PID = '1';\n\t\/**\n\t * Purge by: tag.\n\t *\n\t * @var string\n\t *\/\n\tconst PURGEBY_TAG = '2';\n\t\/**\n\t * Purge by: URL.\n\t *\n\t * @var string\n\t *\/\n\tconst PURGEBY_URL = '3';\n\n\t\/**\n\t * Purge selection field name.\n\t *\n\t * @var string\n\t *\/\n\tconst PURGEBYOPT_SELECT = 'purgeby';\n\t\/**\n\t * Purge list field name.\n\t *\n\t * @var string\n\t *\/\n\tconst PURGEBYOPT_LIST = 'purgebylist';\n\n\t\/**\n\t * Dismiss key for messages.\n\t *\n\t * @var string\n\t *\/\n\tconst DB_DISMISS_MSG = 'dismiss';\n\t\/**\n\t * Rule conflict flag (on).\n\t *\n\t * @var string\n\t *\/\n\tconst RULECONFLICT_ON = 'ExpiresDefault_1';\n\t\/**\n\t * Rule conflict dismissed flag.\n\t *\n\t * @var string\n\t *\/\n\tconst RULECONFLICT_DISMISSED = 'ExpiresDefault_0';\n\n\t\/**\n\t * Router type for QC hide banner.\n\t *\n\t * @var string\n\t *\/\n\tconst TYPE_QC_HIDE_BANNER = 'qc_hide_banner';\n\t\/**\n\t * Cookie name for QC hide banner.\n\t *\n\t * @var string\n\t *\/\n\tconst COOKIE_QC_HIDE_BANNER = 'litespeed_qc_hide_banner';\n\n\t\/**\n\t * Internal messages cache.\n\t *\n\t * @var array<string,string>\n\t *\/\n\tprotected $messages = array();\n\n\t\/**\n\t * Cached default settings.\n\t *\n\t * @var array<string,mixed>\n\t *\/\n\tprotected $default_settings = array();\n\n\t\/**\n\t * Whether current context is network admin.\n\t *\n\t * @var bool\n\t *\/\n\tprotected $_is_network_admin = false;\n\n\t\/**\n\t * Whether multisite is enabled.\n\t *\n\t * @var bool\n\t *\/\n\tprotected $_is_multisite = false;\n\n\t\/**\n\t * Incremental form submit button index.\n\t *\n\t * @var int\n\t *\/\n\tprivate $_btn_i = 0;\n\n\t\/**\n\t * List of settings with filters and return type.\n\t *\n\t * @since 7.4\n\t *\n\t * @var array<string,array<string,mixed>>\n\t *\/\n\tprotected static $settings_filters = [\n\t\t\/\/ Crawler - Blocklist.\n\t\t'crawler-blocklist' => [\n\t\t\t'filter' => 'litespeed_crawler_disable_blocklist',\n\t\t\t'type'   => 'boolean',\n\t\t],\n\t\t\/\/ Crawler - Settings.\n\t\tself::O_CRAWLER_LOAD_LIMIT => [\n\t\t\t'filter' => [ Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE, Base::ENV_CRAWLER_LOAD_LIMIT ],\n\t\t\t'type'   => 'input',\n\t\t],\n\t\t\/\/ Cache - ESI.\n\t\tself::O_ESI_NONCE => [\n\t\t\t'filter' => 'litespeed_esi_nonces',\n\t\t],\n\t\t\/\/ Page Optimization - CSS.\n\t\t'optm-ucss_per_pagetype' => [\n\t\t\t'filter' => 'litespeed_ucss_per_pagetype',\n\t\t\t'type'   => 'boolean',\n\t\t],\n\t\t\/\/ Page Optimization - Media.\n\t\tself::O_MEDIA_ADD_MISSING_SIZES => [\n\t\t\t'filter' => 'litespeed_media_ignore_remote_missing_sizes',\n\t\t\t'type'   => 'boolean',\n\t\t],\n\t\t\/\/ Page Optimization - Media Exclude.\n\t\tself::O_MEDIA_LAZY_EXC => [\n\t\t\t'filter' => 'litespeed_media_lazy_img_excludes',\n\t\t],\n\t\t\/\/ Page Optimization - Tuning (JS).\n\t\tself::O_OPTM_JS_DELAY_INC => [\n\t\t\t'filter' => 'litespeed_optm_js_delay_inc',\n\t\t],\n\t\tself::O_OPTM_JS_EXC => [\n\t\t\t'filter' => 'litespeed_optimize_js_excludes',\n\t\t],\n\t\tself::O_OPTM_JS_DEFER_EXC => [\n\t\t\t'filter' => 'litespeed_optm_js_defer_exc',\n\t\t],\n\t\tself::O_OPTM_GM_JS_EXC => [\n\t\t\t'filter' => 'litespeed_optm_gm_js_exc',\n\t\t],\n\t\tself::O_OPTM_EXC => [\n\t\t\t'filter' => 'litespeed_optm_uri_exc',\n\t\t],\n\t\t\/\/ Page Optimization - Tuning (CSS).\n\t\tself::O_OPTM_CSS_EXC => [\n\t\t\t'filter' => 'litespeed_optimize_css_excludes',\n\t\t],\n\t\tself::O_OPTM_UCSS_EXC => [\n\t\t\t'filter' => 'litespeed_ucss_exc',\n\t\t],\n\t];\n\n\t\/**\n\t * Initialize the class and set its properties.\n\t *\n\t * @since 1.0.7\n\t *\/\n\tpublic function __construct() {\n\t\t\/\/ main css\n\t\tadd_action( 'admin_enqueue_scripts', array( $this, 'enqueue_style' ) );\n\t\t\/\/ Main js\n\t\tadd_action( 'admin_enqueue_scripts', array( $this, 'enqueue_scripts' ) );\n\n\t\t$this->_is_network_admin = is_network_admin();\n\t\t$this->_is_multisite     = is_multisite();\n\n\t\t\/\/ Quick access menu\n\t\t$manage = ( $this->_is_multisite && $this->_is_network_admin ) ? 'manage_network_options' : 'manage_options';\n\n\t\tif ( current_user_can( $manage ) ) {\n\t\t\tadd_action( 'wp_before_admin_bar_render', array( GUI::cls(), 'backend_shortcut' ) );\n\n\t\t\t\/\/ `admin_notices` is after `admin_enqueue_scripts`.\n\t\t\tadd_action( $this->_is_network_admin ? 'network_admin_notices' : 'admin_notices', array( $this, 'display_messages' ) );\n\t\t}\n\n\t\t\/**\n\t\t * In case this is called outside the admin page.\n\t\t *\n\t\t * @see  https:\/\/codex.wordpress.org\/Function_Reference\/is_plugin_active_for_network\n\t\t * @since  2.0\n\t\t *\/\n\t\tif ( ! function_exists( 'is_plugin_active_for_network' ) ) {\n\t\t\trequire_once ABSPATH . 'wp-admin\/includes\/plugin.php';\n\t\t}\n\n\t\t\/\/ add menus (Also check for mu-plugins)\n\t\tif ( $this->_is_network_admin && ( is_plugin_active_for_network( LSCWP_BASENAME ) || defined( 'LSCWP_MU_PLUGIN' ) ) ) {\n\t\t\tadd_action( 'network_admin_menu', array( $this, 'register_admin_menu' ) );\n\t\t} else {\n\t\t\tadd_action( 'admin_menu', array( $this, 'register_admin_menu' ) );\n\t\t}\n\n\t\t$this->cls( 'Metabox' )->register_settings();\n\t}\n\n\t\/**\n\t * Echo a translated section title.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string $id Language key.\n\t * @return void\n\t *\/\n\tpublic function title( $id ) {\n\t\techo wp_kses_post( Lang::title( $id ) );\n\t}\n\n\t\/**\n\t * Register the admin menu display.\n\t *\n\t * @since 1.0.0\n\t * @return void\n\t *\/\n\tpublic function register_admin_menu() {\n\t\t$capability = $this->_is_network_admin ? 'manage_network_options' : 'manage_options';\n\t\tif ( current_user_can( $capability ) ) {\n\t\t\t\/\/ root menu.\n\t\t\tadd_menu_page( 'LiteSpeed Cache', 'LiteSpeed Cache', 'manage_options', 'litespeed' );\n\n\t\t\t\/\/ sub menus.\n\t\t\t$this->_add_submenu( __( 'Dashboard', 'litespeed-cache' ), 'litespeed', 'show_menu_dash' );\n\n\t\t\tif ( ! $this->_is_network_admin ) {\n\t\t\t\t$this->_add_submenu( __( 'Presets', 'litespeed-cache' ), 'litespeed-presets', 'show_menu_presets' );\n\t\t\t}\n\n\t\t\t$this->_add_submenu( __( 'General', 'litespeed-cache' ), 'litespeed-general', 'show_menu_general' );\n\t\t\t$this->_add_submenu( __( 'Cache', 'litespeed-cache' ), 'litespeed-cache', 'show_menu_cache' );\n\n\t\t\tif ( ! $this->_is_network_admin ) {\n\t\t\t\t$this->_add_submenu( __( 'CDN', 'litespeed-cache' ), 'litespeed-cdn', 'show_menu_cdn' );\n\t\t\t}\n\n\t\t\t$this->_add_submenu( __( 'Image Optimization', 'litespeed-cache' ), 'litespeed-img_optm', 'show_img_optm' );\n\n\t\t\tif ( ! $this->_is_network_admin ) {\n\t\t\t\t$this->_add_submenu( __( 'Page Optimization', 'litespeed-cache' ), 'litespeed-page_optm', 'show_page_optm' );\n\t\t\t}\n\n\t\t\t$this->_add_submenu( __( 'Database', 'litespeed-cache' ), 'litespeed-db_optm', 'show_db_optm' );\n\n\t\t\tif ( ! $this->_is_network_admin ) {\n\t\t\t\t$this->_add_submenu( __( 'Crawler', 'litespeed-cache' ), 'litespeed-crawler', 'show_crawler' );\n\t\t\t}\n\n\t\t\t$this->_add_submenu( __( 'Toolbox', 'litespeed-cache' ), 'litespeed-toolbox', 'show_toolbox' );\n\n\t\t\t\/\/ sub menus under options.\n\t\t\tadd_options_page( 'LiteSpeed Cache', 'LiteSpeed Cache', $capability, 'litespeed-cache-options', array( $this, 'show_menu_cache' ) );\n\t\t}\n\t}\n\n\t\/**\n\t * Helper to create a submenu.\n\t *\n\t * @since 1.0.4\n\t * @access private\n\t *\n\t * @param string $menu_title The title that appears on the menu.\n\t * @param string $menu_slug  The slug of the page.\n\t * @param string $callback   The callback to call if selected.\n\t * @return void\n\t *\/\n\tprivate function _add_submenu( $menu_title, $menu_slug, $callback ) {\n\t\tadd_submenu_page( 'litespeed', $menu_title, $menu_title, 'manage_options', $menu_slug, array( $this, $callback ) );\n\t}\n\n\t\/**\n\t * Register the stylesheets for the admin area.\n\t *\n\t * @since 1.0.14\n\t * @return void\n\t *\/\n\tpublic function enqueue_style() {\n\t\twp_enqueue_style( Core::PLUGIN_NAME, LSWCP_PLUGIN_URL . 'assets\/css\/litespeed.css', array(), Core::VER, 'all' );\n\t}\n\n\t\/**\n\t * Register\/enqueue the JavaScript for the admin area.\n\t *\n\t * @since 1.0.0\n\t * @since 7.3 Added deactivation modal code.\n\t * @return void\n\t *\/\n\tpublic function enqueue_scripts() {\n\t\twp_register_script( Core::PLUGIN_NAME, LSWCP_PLUGIN_URL . 'assets\/js\/litespeed-cache-admin.js', array(), Core::VER, false );\n\n\t\t$localize_data = array();\n\t\tif ( GUI::has_whm_msg() ) {\n\t\t\t$ajax_url_dismiss_whm                  = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_WHM, true );\n\t\t\t$localize_data['ajax_url_dismiss_whm'] = $ajax_url_dismiss_whm;\n\t\t}\n\n\t\tif ( GUI::has_msg_ruleconflict() ) {\n\t\t\t$ajax_url                                       = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_EXPIRESDEFAULT, true );\n\t\t\t$localize_data['ajax_url_dismiss_ruleconflict'] = $ajax_url;\n\t\t}\n\n\t\t\/\/ Injection to LiteSpeed pages\n\t\tglobal $pagenow;\n\t\t$page = isset( $_GET['page'] ) ? sanitize_text_field( wp_unslash( $_GET['page'] ) ) : ''; \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\n\t\tif ( 'admin.php' === $pagenow && $page && ( 0 === strpos( $page, 'litespeed-' ) || 'litespeed' === $page ) ) {\n\t\t\t\/\/ Admin footer\n\t\t\tadd_filter( 'admin_footer_text', array( $this, 'admin_footer_text' ), 1 );\n\n\t\t\tif ( in_array( $page, array( 'litespeed-crawler', 'litespeed-cdn' ), true ) ) {\n\t\t\t\t\/\/ Babel JS type correction\n\t\t\t\tadd_filter( 'script_loader_tag', array( $this, 'babel_type' ), 10, 3 );\n\n\t\t\t\twp_enqueue_script( Core::PLUGIN_NAME . '-lib-react', LSWCP_PLUGIN_URL . 'assets\/js\/react.min.js', array(), Core::VER, false );\n\t\t\t\twp_enqueue_script( Core::PLUGIN_NAME . '-lib-babel', LSWCP_PLUGIN_URL . 'assets\/js\/babel.min.js', array(), Core::VER, false );\n\t\t\t}\n\n\t\t\t\/\/ Crawler Cookie Simulation\n\t\t\tif ( 'litespeed-crawler' === $page ) {\n\t\t\t\twp_enqueue_script( Core::PLUGIN_NAME . '-crawler', LSWCP_PLUGIN_URL . 'assets\/js\/component.crawler.js', array(), Core::VER, false );\n\n\t\t\t\t$localize_data['lang']                              = array();\n\t\t\t\t$localize_data['lang']['cookie_name']               = __( 'Cookie Name', 'litespeed-cache' );\n\t\t\t\t$localize_data['lang']['cookie_value']              = __( 'Cookie Values', 'litespeed-cache' );\n\t\t\t\t$localize_data['lang']['one_per_line']              = Doc::one_per_line( true );\n\t\t\t\t$localize_data['lang']['remove_cookie_simulation']  = __( 'Remove cookie simulation', 'litespeed-cache' );\n\t\t\t\t$localize_data['lang']['add_cookie_simulation_row'] = __( 'Add new cookie to simulate', 'litespeed-cache' );\n\t\t\t\tif ( empty( $localize_data['ids'] ) ) {\n\t\t\t\t\t$localize_data['ids'] = array();\n\t\t\t\t}\n\t\t\t\t$localize_data['ids']['crawler_cookies'] = self::O_CRAWLER_COOKIES;\n\t\t\t}\n\n\t\t\t\/\/ CDN mapping\n\t\t\tif ( 'litespeed-cdn' === $page ) {\n\t\t\t\t$home_url = home_url( '\/' );\n\t\t\t\t$parsed   = wp_parse_url( $home_url );\n\t\t\t\tif ( ! empty( $parsed['scheme'] ) ) {\n\t\t\t\t\t$home_url = str_replace( $parsed['scheme'] . ':', '', $home_url );\n\t\t\t\t}\n\t\t\t\t$cdn_url = 'https:\/\/cdn.' . substr( $home_url, 2 );\n\n\t\t\t\twp_enqueue_script( Core::PLUGIN_NAME . '-cdn', LSWCP_PLUGIN_URL . 'assets\/js\/component.cdn.js', array(), Core::VER, false );\n\t\t\t\t$localize_data['lang']                         = array();\n\t\t\t\t$localize_data['lang']['cdn_mapping_url']      = Lang::title( self::CDN_MAPPING_URL );\n\t\t\t\t$localize_data['lang']['cdn_mapping_inc_img']  = Lang::title( self::CDN_MAPPING_INC_IMG );\n\t\t\t\t$localize_data['lang']['cdn_mapping_inc_css']  = Lang::title( self::CDN_MAPPING_INC_CSS );\n\t\t\t\t$localize_data['lang']['cdn_mapping_inc_js']   = Lang::title( self::CDN_MAPPING_INC_JS );\n\t\t\t\t$localize_data['lang']['cdn_mapping_filetype'] = Lang::title( self::CDN_MAPPING_FILETYPE );\n\t\t\t\t$localize_data['lang']['cdn_mapping_url_desc'] = sprintf( __( 'CDN URL to be used. For example, %s', 'litespeed-cache' ), '<code>' . esc_html( $cdn_url ) . '<\/code>' );\n\t\t\t\t$localize_data['lang']['one_per_line']         = Doc::one_per_line( true );\n\t\t\t\t$localize_data['lang']['cdn_mapping_remove']   = __( 'Remove CDN URL', 'litespeed-cache' );\n\t\t\t\t$localize_data['lang']['add_cdn_mapping_row']  = __( 'Add new CDN URL', 'litespeed-cache' );\n\t\t\t\t$localize_data['lang']['on']                   = __( 'ON', 'litespeed-cache' );\n\t\t\t\t$localize_data['lang']['off']                  = __( 'OFF', 'litespeed-cache' );\n\t\t\t\tif ( empty( $localize_data['ids'] ) ) {\n\t\t\t\t\t$localize_data['ids'] = array();\n\t\t\t\t}\n\t\t\t\t$localize_data['ids']['cdn_mapping'] = self::O_CDN_MAPPING;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Load iziModal JS and CSS\n\t\t$show_deactivation_modal = ( is_multisite() && ! is_network_admin() ) ? false : true;\n\t\tif ( $show_deactivation_modal && 'plugins.php' === $pagenow ) {\n\t\t\twp_enqueue_script( Core::PLUGIN_NAME . '-iziModal', LSWCP_PLUGIN_URL . 'assets\/js\/iziModal.min.js', array(), Core::VER, true );\n\t\t\twp_enqueue_style( Core::PLUGIN_NAME . '-iziModal', LSWCP_PLUGIN_URL . 'assets\/css\/iziModal.min.css', array(), Core::VER, 'all' );\n\t\t\tadd_action( 'admin_footer', array( $this, 'add_deactivation_html' ) );\n\t\t}\n\n\t\tif ( $localize_data ) {\n\t\t\twp_localize_script( Core::PLUGIN_NAME, 'litespeed_data', $localize_data );\n\t\t}\n\n\t\twp_enqueue_script( Core::PLUGIN_NAME );\n\t}\n\n\t\/**\n\t * Add modal HTML on Plugins screen.\n\t *\n\t * @since 7.3\n\t * @return void\n\t *\/\n\tpublic function add_deactivation_html() {\n\t\trequire LSCWP_DIR . 'tpl\/inc\/modal.deactivation.php';\n\t}\n\n\t\/**\n\t * Filter the script tag for specific handles to set Babel type.\n\t *\n\t * @since 3.6\n\t *\n\t * @param string $tag    The script tag.\n\t * @param string $handle Script handle.\n\t * @param string $src    Script source URL.\n\t * @return string The filtered script tag.\n\t *\/\n\tpublic function babel_type( $tag, $handle, $src ) {\n\t\tif ( Core::PLUGIN_NAME . '-crawler' !== $handle && Core::PLUGIN_NAME . '-cdn' !== $handle ) {\n\t\t\treturn $tag;\n\t\t}\n\n\t\t\/\/ phpcs:ignore WordPress.WP.EnqueuedResources.NonEnqueuedScript\n\t\treturn '<script src=\"' . Str::trim_quotes( $src ) . '\" type=\"text\/babel\"><\/script>';\n\t}\n\n\t\/**\n\t * Callback that adds LiteSpeed Cache's action links.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param array<string> $links Previously added links from other plugins.\n\t * @return array<string> Links with the LiteSpeed Cache one appended.\n\t *\/\n\tpublic function add_plugin_links( $links ) {\n\t\t$links[] = '<a href=\"' . esc_url( admin_url( 'admin.php?page=litespeed-cache' ) ) . '\">' . esc_html__( 'Settings', 'litespeed-cache' ) . '<\/a>';\n\n\t\treturn $links;\n\t}\n\n\t\/**\n\t * Change the admin footer text on LiteSpeed Cache admin pages.\n\t *\n\t * @since 1.0.13\n\t *\n\t * @param string $footer_text Footer text.\n\t * @return string\n\t *\/\n\tpublic function admin_footer_text( $footer_text ) {\n\t\trequire_once LSCWP_DIR . 'tpl\/inc\/admin_footer.php';\n\n\t\treturn $footer_text;\n\t}\n\n\t\/**\n\t * Build a single notice HTML string.\n\t *\n\t * @since 1.0.7\n\t *\n\t * @param string $color              The color CSS class for the notice.\n\t * @param string $str                The notice message.\n\t * @param bool   $irremovable        If true, the notice cannot be dismissed.\n\t * @param string $additional_classes Additional classes to add to the wrapper.\n\t * @return string The built notice HTML.\n\t *\/\n\tpublic static function build_notice( $color, $str, $irremovable = false, $additional_classes = '' ) {\n\t\t$cls = $color;\n\t\tif ( $irremovable ) {\n\t\t\t$cls .= ' litespeed-irremovable';\n\t\t} else {\n\t\t\t$cls .= ' is-dismissible';\n\t\t}\n\t\tif ( $additional_classes ) {\n\t\t\t$cls .= ' ' . $additional_classes;\n\t\t}\n\n\t\t\/\/ possible translation\n\t\t$str = Lang::maybe_translate( $str );\n\n\t\treturn '<div class=\"litespeed_icon ' . esc_attr( $cls ) . '\"><p>' . wp_kses_post( $str ) . '<\/p><\/div>';\n\t}\n\n\t\/**\n\t * Display info notice.\n\t *\n\t * @since 1.6.5\n\t *\n\t * @param string|array<string> $msg                Message or list of messages.\n\t * @param bool                 $do_echo            Echo immediately instead of storing.\n\t * @param bool                 $irremovable        If true, cannot be dismissed.\n\t * @param string               $additional_classes Extra CSS classes.\n\t * @return void\n\t *\/\n\tpublic static function info( $msg, $do_echo = false, $irremovable = false, $additional_classes = '' ) {\n\t\tself::add_notice( self::NOTICE_BLUE, $msg, $do_echo, $irremovable, $additional_classes );\n\t}\n\n\t\/**\n\t * Display note (warning) notice.\n\t *\n\t * @since 1.6.5\n\t *\n\t * @param string|array<string> $msg                Message or list of messages.\n\t * @param bool                 $do_echo            Echo immediately instead of storing.\n\t * @param bool                 $irremovable        If true, cannot be dismissed.\n\t * @param string               $additional_classes Extra CSS classes.\n\t * @return void\n\t *\/\n\tpublic static function note( $msg, $do_echo = false, $irremovable = false, $additional_classes = '' ) {\n\t\tself::add_notice( self::NOTICE_YELLOW, $msg, $do_echo, $irremovable, $additional_classes );\n\t}\n\n\t\/**\n\t * Display success notice.\n\t *\n\t * @since 1.6\n\t *\n\t * @param string|array<string> $msg                Message or list of messages.\n\t * @param bool                 $do_echo            Echo immediately instead of storing.\n\t * @param bool                 $irremovable        If true, cannot be dismissed.\n\t * @param string               $additional_classes Extra CSS classes.\n\t * @return void\n\t *\/\n\tpublic static function success( $msg, $do_echo = false, $irremovable = false, $additional_classes = '' ) {\n\t\tself::add_notice( self::NOTICE_GREEN, $msg, $do_echo, $irremovable, $additional_classes );\n\t}\n\n\t\/**\n\t * Deprecated alias for success().\n\t *\n\t * @deprecated 4.7 Will drop in v7.5. Use success().\n\t *\n\t * @param string|array<string> $msg                Message or list of messages.\n\t * @param bool                 $do_echo            Echo immediately instead of storing.\n\t * @param bool                 $irremovable        If true, cannot be dismissed.\n\t * @param string               $additional_classes Extra CSS classes.\n\t * @return void\n\t *\/\n\tpublic static function succeed( $msg, $do_echo = false, $irremovable = false, $additional_classes = '' ) {\n\t\tself::success( $msg, $do_echo, $irremovable, $additional_classes );\n\t}\n\n\t\/**\n\t * Display error notice.\n\t *\n\t * @since 1.6\n\t *\n\t * @param string|array<string> $msg                Message or list of messages.\n\t * @param bool                 $do_echo            Echo immediately instead of storing.\n\t * @param bool                 $irremovable        If true, cannot be dismissed.\n\t * @param string               $additional_classes Extra CSS classes.\n\t * @return void\n\t *\/\n\tpublic static function error( $msg, $do_echo = false, $irremovable = false, $additional_classes = '' ) {\n\t\tself::add_notice( self::NOTICE_RED, $msg, $do_echo, $irremovable, $additional_classes );\n\t}\n\n\t\/**\n\t * Add unique (irremovable optional) messages.\n\t *\n\t * @since 4.7\n\t *\n\t * @param string               $color_mode  One of info|note|success|error.\n\t * @param string|array<string> $msgs        Message(s).\n\t * @param bool                 $irremovable If true, cannot be dismissed.\n\t * @return void\n\t *\/\n\tpublic static function add_unique_notice( $color_mode, $msgs, $irremovable = false ) {\n\t\tif ( ! is_array( $msgs ) ) {\n\t\t\t$msgs = array( $msgs );\n\t\t}\n\n\t\t$color_map = array(\n\t\t\t'info'    => self::NOTICE_BLUE,\n\t\t\t'note'    => self::NOTICE_YELLOW,\n\t\t\t'success' => self::NOTICE_GREEN,\n\t\t\t'error'   => self::NOTICE_RED,\n\t\t);\n\t\tif ( empty( $color_map[ $color_mode ] ) ) {\n\t\t\tself::debug( 'Wrong admin display color mode!' );\n\t\t\treturn;\n\t\t}\n\t\t$color = $color_map[ $color_mode ];\n\n\t\t\/\/ Go through to make sure unique.\n\t\t$filtered_msgs = array();\n\t\tforeach ( $msgs as $k => $str ) {\n\t\t\tif ( is_numeric( $k ) ) {\n\t\t\t\t$k = md5( $str );\n\t\t\t} \/\/ Use key to make it overwritable to previous same msg.\n\t\t\t$filtered_msgs[ $k ] = $str;\n\t\t}\n\n\t\tself::add_notice( $color, $filtered_msgs, false, $irremovable );\n\t}\n\n\t\/**\n\t * Add a notice to display on the admin page (store or echo).\n\t *\n\t * @since 1.0.7\n\t *\n\t * @param string               $color              Notice color CSS class.\n\t * @param string|array<string> $msg                Message(s).\n\t * @param bool                 $do_echo            Echo immediately instead of storing.\n\t * @param bool                 $irremovable        If true, cannot be dismissed.\n\t * @param string               $additional_classes Extra classes for wrapper.\n\t * @return void\n\t *\/\n\tpublic static function add_notice( $color, $msg, $do_echo = false, $irremovable = false, $additional_classes = '' ) {\n\t\t\/\/ Bypass adding for CLI or cron\n\t\tif ( defined( 'LITESPEED_CLI' ) || wp_doing_cron() ) {\n\t\t\t\/\/ WP CLI will show the info directly\n\t\t\tif ( defined( 'WP_CLI' ) && WP_CLI ) {\n\t\t\t\tif ( ! is_array( $msg ) ) {\n\t\t\t\t\t$msg = array( $msg );\n\t\t\t\t}\n\t\t\t\tforeach ( $msg as $v ) {\n\t\t\t\t\t$v = wp_strip_all_tags( $v );\n\t\t\t\t\tif ( self::NOTICE_RED === $color ) {\n\t\t\t\t\t\t\\WP_CLI::error( $v, false );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\\WP_CLI::success( $v );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif ( $do_echo ) {\n\t\t\techo self::build_notice( $color, $msg, $irremovable, $additional_classes ); \/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped\n\t\t\treturn;\n\t\t}\n\n\t\t$msg_name = $irremovable ? self::DB_MSG_PIN : self::DB_MSG;\n\n\t\t$messages = self::get_option( $msg_name, array() );\n\t\tif ( ! is_array( $messages ) ) {\n\t\t\t$messages = array();\n\t\t}\n\n\t\tif ( is_array( $msg ) ) {\n\t\t\tforeach ( $msg as $k => $str ) {\n\t\t\t\t$messages[ $k ] = self::build_notice( $color, $str, $irremovable, $additional_classes );\n\t\t\t}\n\t\t} else {\n\t\t\t$messages[] = self::build_notice( $color, $msg, $irremovable, $additional_classes );\n\t\t}\n\t\t$messages = array_unique( $messages );\n\t\tself::update_option( $msg_name, $messages );\n\t}\n\n\t\/**\n\t * Display notices and errors in dashboard.\n\t *\n\t * @since 1.1.0\n\t * @return void\n\t *\/\n\tpublic function display_messages() {\n\t\tif ( ! defined( 'LITESPEED_CONF_LOADED' ) ) {\n\t\t\t$this->_in_upgrading();\n\t\t}\n\n\t\tif ( GUI::has_whm_msg() ) {\n\t\t\t$this->show_display_installed();\n\t\t}\n\n\t\tData::cls()->check_upgrading_msg();\n\n\t\t\/\/ If is in dev version, always check latest update\n\t\tCloud::cls()->check_dev_version();\n\n\t\t\/\/ One time msg\n\t\t$messages       = self::get_option( self::DB_MSG, array() );\n\t\t$added_thickbox = false;\n\t\tif ( is_array( $messages ) ) {\n\t\t\tforeach ( $messages as $msg ) {\n\t\t\t\t\/\/ Added for popup links\n\t\t\t\tif ( strpos( $msg, 'TB_iframe' ) && ! $added_thickbox ) {\n\t\t\t\t\tadd_thickbox();\n\t\t\t\t\t$added_thickbox = true;\n\t\t\t\t}\n\t\t\t\techo wp_kses_post( $msg );\n\t\t\t}\n\t\t}\n\t\tif ( -1 !== $messages ) {\n\t\t\tself::update_option( self::DB_MSG, -1 );\n\t\t}\n\n\t\t\/\/ Pinned msg\n\t\t$messages = self::get_option( self::DB_MSG_PIN, array() );\n\t\tif ( is_array( $messages ) ) {\n\t\t\tforeach ( $messages as $k => $msg ) {\n\t\t\t\t\/\/ Added for popup links\n\t\t\t\tif ( strpos( $msg, 'TB_iframe' ) && ! $added_thickbox ) {\n\t\t\t\t\tadd_thickbox();\n\t\t\t\t\t$added_thickbox = true;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Append close btn\n\t\t\t\tif ( '<\/div>' === substr( $msg, -6 ) ) {\n\t\t\t\t\t$link = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PIN, false, null, array( 'msgid' => $k ) );\n\t\t\t\t\t$msg  =\n\t\t\t\t\t\tsubstr( $msg, 0, -6 ) .\n\t\t\t\t\t\t'<p><a href=\"' .\n\t\t\t\t\t\tesc_url( $link ) .\n\t\t\t\t\t\t'\" class=\"button litespeed-btn-primary litespeed-btn-mini\">' .\n\t\t\t\t\t\tesc_html__( 'Dismiss', 'litespeed-cache' ) .\n\t\t\t\t\t\t'<\/a>' .\n\t\t\t\t\t\t'<\/p><\/div>';\n\t\t\t\t}\n\t\t\t\techo wp_kses_post( $msg );\n\t\t\t}\n\t\t}\n\n\t\tif ( empty( $_GET['page'] ) || 0 !== strpos( sanitize_text_field( wp_unslash( $_GET['page'] ) ), 'litespeed' ) ) { \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\t\tglobal $pagenow;\n\t\t\tif ( 'plugins.php' !== $pagenow ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( ! $this->conf( self::O_NEWS ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Show promo from cloud\n\t\tCloud::cls()->show_promo();\n\n\t\t\/**\n\t\t * Check promo msg first\n\t\t *\n\t\t * @since 2.9\n\t\t *\/\n\t\tGUI::cls()->show_promo();\n\n\t\t\/\/ Show version news\n\t\tCloud::cls()->news();\n\t}\n\n\t\/**\n\t * Dismiss pinned msg.\n\t *\n\t * @since 3.5.2\n\t * @return void\n\t *\/\n\tpublic static function dismiss_pin() {\n\t\tif ( ! isset( $_GET['msgid'] ) ) { \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\t\treturn;\n\t\t}\n\n\t\t$messages = self::get_option( self::DB_MSG_PIN, array() );\n\t\t$msgid    = sanitize_text_field( wp_unslash( $_GET['msgid'] ) ); \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\n\t\tif ( ! is_array( $messages ) || empty( $messages[ $msgid ] ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tunset( $messages[ $msgid ] );\n\t\tif ( ! $messages ) {\n\t\t\t$messages = -1;\n\t\t}\n\t\tself::update_option( self::DB_MSG_PIN, $messages );\n\t}\n\n\t\/**\n\t * Dismiss pinned msg by msg content.\n\t *\n\t * @since 7.0\n\t *\n\t * @param string $content     Message content.\n\t * @param string $color       Color CSS class.\n\t * @param bool   $irremovable Is irremovable.\n\t * @return void\n\t *\/\n\tpublic static function dismiss_pin_by_content( $content, $color, $irremovable ) {\n\t\t$content  = self::build_notice( $color, $content, $irremovable );\n\t\t$messages = self::get_option( self::DB_MSG_PIN, array() );\n\t\t$hit      = false;\n\t\tif ( -1 !== $messages ) {\n\t\t\tforeach ( $messages as $k => $v ) {\n\t\t\t\tif ( $v === $content ) {\n\t\t\t\t\tunset( $messages[ $k ] );\n\t\t\t\t\t$hit = true;\n\t\t\t\t\tself::debug( '\u2705 pinned msg content hit. Removed' );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif ( $hit ) {\n\t\t\tif ( ! $messages ) {\n\t\t\t\t$messages = -1;\n\t\t\t}\n\t\t\tself::update_option( self::DB_MSG_PIN, $messages );\n\t\t} else {\n\t\t\tself::debug( '\u274c No pinned msg content hit' );\n\t\t}\n\t}\n\n\t\/**\n\t * Hooked to the in_widget_form action.\n\t * Appends LiteSpeed Cache settings to the widget edit settings screen.\n\t * This will append the esi on\/off selector and ttl text.\n\t *\n\t * @since 1.1.0\n\t *\n\t * @param \\WP_Widget $widget     The widget instance (passed by reference).\n\t * @param mixed      $return_val Return param (unused).\n\t * @param array      $instance   The widget instance's settings.\n\t * @return void\n\t *\/\n\tpublic function show_widget_edit( $widget, $return_val, $instance ) {\n\t\trequire LSCWP_DIR . 'tpl\/esi_widget_edit.php';\n\t}\n\n\t\/**\n\t * Displays the dashboard page.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function show_menu_dash() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/dash\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Displays the Presets page.\n\t *\n\t * @since 5.3\n\t * @return void\n\t *\/\n\tpublic function show_menu_presets() {\n\t\trequire_once LSCWP_DIR . 'tpl\/presets\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Displays the General page.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function show_menu_general() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/general\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Displays the CDN page.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function show_menu_cdn() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/cdn\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Outputs the LiteSpeed Cache settings page.\n\t *\n\t * @since 1.0.0\n\t * @return void\n\t *\/\n\tpublic function show_menu_cache() {\n\t\tif ( $this->_is_network_admin ) {\n\t\t\trequire_once LSCWP_DIR . 'tpl\/cache\/entry_network.tpl.php';\n\t\t} else {\n\t\t\trequire_once LSCWP_DIR . 'tpl\/cache\/entry.tpl.php';\n\t\t}\n\t}\n\n\t\/**\n\t * Tools page.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function show_toolbox() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/toolbox\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Outputs the crawler operation page.\n\t *\n\t * @since 1.1.0\n\t * @return void\n\t *\/\n\tpublic function show_crawler() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/crawler\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Outputs the image optimization page.\n\t *\n\t * @since 1.6\n\t * @return void\n\t *\/\n\tpublic function show_img_optm() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/img_optm\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Page optimization page.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function show_page_optm() {\n\t\t$this->cls( 'Cloud' )->maybe_preview_banner();\n\t\trequire_once LSCWP_DIR . 'tpl\/page_optm\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * DB optimization page.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function show_db_optm() {\n\t\trequire_once LSCWP_DIR . 'tpl\/db_optm\/entry.tpl.php';\n\t}\n\n\t\/**\n\t * Outputs a notice when the plugin is installed via WHM.\n\t *\n\t * @since 1.0.12\n\t * @return void\n\t *\/\n\tpublic function show_display_installed() {\n\t\trequire_once LSCWP_DIR . 'tpl\/inc\/show_display_installed.php';\n\t}\n\n\t\/**\n\t * Display error cookie msg.\n\t *\n\t * @since 1.0.12\n\t * @return void\n\t *\/\n\tpublic static function show_error_cookie() {\n\t\trequire_once LSCWP_DIR . 'tpl\/inc\/show_error_cookie.php';\n\t}\n\n\t\/**\n\t * Display warning if lscache is disabled.\n\t *\n\t * @since 2.1\n\t * @return void\n\t *\/\n\tpublic function cache_disabled_warning() {\n\t\tinclude LSCWP_DIR . 'tpl\/inc\/check_cache_disabled.php';\n\t}\n\n\t\/**\n\t * Display conf data upgrading banner.\n\t *\n\t * @since 2.1\n\t * @access private\n\t * @return void\n\t *\/\n\tprivate function _in_upgrading() {\n\t\tinclude LSCWP_DIR . 'tpl\/inc\/in_upgrading.php';\n\t}\n\n\t\/**\n\t * Output LiteSpeed form open tag and hidden fields.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string|false $action     Router action.\n\t * @param string|false $type       Router type.\n\t * @param bool         $has_upload Whether form has file uploads.\n\t * @return void\n\t *\/\n\tpublic function form_action( $action = false, $type = false, $has_upload = false ) {\n\t\tif ( ! $action ) {\n\t\t\t$action = Router::ACTION_SAVE_SETTINGS;\n\t\t}\n\n\t\tif ( ! defined( 'LITESPEED_CONF_LOADED' ) ) {\n\t\t\techo '<div class=\"litespeed-relative\">';\n\t\t} else {\n\t\t\t$current = isset( $_SERVER['REQUEST_URI'] ) ? esc_url_raw( wp_unslash( $_SERVER['REQUEST_URI'] ) ) : '';\n\t\t\tif ( $has_upload ) {\n\t\t\t\techo '<form method=\"post\" action=\"' . esc_url( $current ) . '\" class=\"litespeed-relative\" enctype=\"multipart\/form-data\">';\n\t\t\t} else {\n\t\t\t\techo '<form method=\"post\" action=\"' . esc_url( $current ) . '\" class=\"litespeed-relative\">';\n\t\t\t}\n\t\t}\n\n\t\techo '<input type=\"hidden\" name=\"' . esc_attr( Router::ACTION ) . '\" value=\"' . esc_attr( $action ) . '\" \/>';\n\t\tif ( $type ) {\n\t\t\techo '<input type=\"hidden\" name=\"' . esc_attr( Router::TYPE ) . '\" value=\"' . esc_attr( $type ) . '\" \/>';\n\t\t}\n\t\twp_nonce_field( $action, Router::NONCE );\n\t}\n\n\t\/**\n\t * Output LiteSpeed form end (submit + closing tags).\n\t *\n\t * @since 3.0\n\t *\n\t * @return void\n\t *\/\n\tpublic function form_end() {\n\t\techo \"<div class='litespeed-top20'><\/div>\";\n\n\t\tif ( ! defined( 'LITESPEED_CONF_LOADED' ) ) {\n\t\t\tsubmit_button( __( 'Save Changes', 'litespeed-cache' ), 'secondary litespeed-duplicate-float', 'litespeed-submit', true, array( 'disabled' => 'disabled' ) );\n\n\t\t\techo '<\/div>';\n\t\t} else {\n\t\t\tsubmit_button(\n\t\t\t\t__( 'Save Changes', 'litespeed-cache' ),\n\t\t\t\t'primary litespeed-duplicate-float',\n\t\t\t\t'litespeed-submit',\n\t\t\t\ttrue,\n\t\t\t\tarray(\n\t\t\t\t\t'id' => 'litespeed-submit-' . $this->_btn_i++,\n\t\t\t\t)\n\t\t\t);\n\n\t\t\techo '<\/form>';\n\t\t}\n\t}\n\n\t\/**\n\t * Register a setting for saving.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string $id Setting ID.\n\t * @return void\n\t *\/\n\tpublic function enroll( $id ) {\n\t\techo '<input type=\"hidden\" name=\"' . esc_attr( Admin_Settings::ENROLL ) . '[]\" value=\"' . esc_attr( $id ) . '\" \/>';\n\t}\n\n\t\/**\n\t * Build a textarea input.\n\t *\n\t * @since 1.1.0\n\t *\n\t * @param string     $id   Setting ID.\n\t * @param int|false  $cols Columns count.\n\t * @param string|nil $val  Pre-set value.\n\t * @return void\n\t *\/\n\tpublic function build_textarea( $id, $cols = false, $val = null ) {\n\t\tif ( null === $val ) {\n\t\t\t$val = $this->conf( $id, true );\n\n\t\t\tif ( is_array( $val ) ) {\n\t\t\t\t$val = implode( \"\\n\", $val );\n\t\t\t}\n\t\t}\n\n\t\tif ( ! $cols ) {\n\t\t\t$cols = 80;\n\t\t}\n\n\t\t$rows = $this->get_textarea_rows( $val );\n\n\t\t$this->enroll( $id );\n\n\t\techo \"<textarea name='\" . esc_attr( $id ) . \"' rows='\" . (int) $rows . \"' cols='\" . (int) $cols . \"'>\" . esc_textarea( $val ) . '<\/textarea>';\n\n\t\t$this->_check_overwritten( $id );\n\t}\n\n\t\/**\n\t * Calculate textarea rows.\n\t *\n\t * @since 7.4\n\t *\n\t * @param string $val Text area value.\n\t * @return int Number of rows to use.\n\t *\/\n\tpublic function get_textarea_rows( $val ) {\n\t\t$rows  = 5;\n\t\t$lines = substr_count( (string) $val, \"\\n\" ) + 2;\n\t\tif ( $lines > $rows ) {\n\t\t\t$rows = $lines;\n\t\t}\n\t\tif ( $rows > 40 ) {\n\t\t\t$rows = 40;\n\t\t}\n\n\t\treturn $rows;\n\t}\n\n\t\/**\n\t * Build a text input field.\n\t *\n\t * @since 1.1.0\n\t *\n\t * @param string      $id       Setting ID.\n\t * @param string|null $cls      CSS class.\n\t * @param string|null $val      Value.\n\t * @param string      $type     Input type.\n\t * @param bool        $disabled Whether disabled.\n\t * @return void\n\t *\/\n\tpublic function build_input( $id, $cls = null, $val = null, $type = 'text', $disabled = false ) {\n\t\tif ( null === $val ) {\n\t\t\t$val = $this->conf( $id, true );\n\n\t\t\t\/\/ Mask passwords.\n\t\t\tif ( $this->_conf_pswd( $id ) && $val ) {\n\t\t\t\t$val = str_repeat( '*', strlen( $val ) );\n\t\t\t}\n\t\t}\n\n\t\t$label_id = preg_replace( '\/\\W\/', '', $id );\n\n\t\tif ( 'text' === $type ) {\n\t\t\t$cls = \"regular-text $cls\";\n\t\t}\n\n\t\tif ( $disabled ) {\n\t\t\techo \"<input type='\" . esc_attr( $type ) . \"' class='\" . esc_attr( $cls ) . \"' value='\" . esc_attr( $val ) . \"' id='input_\" . esc_attr( $label_id ) . \"' disabled \/> \";\n\t\t} else {\n\t\t\t$this->enroll( $id );\n\t\t\techo \"<input type='\" . esc_attr( $type ) . \"' class='\" . esc_attr( $cls ) . \"' name='\" . esc_attr( $id ) . \"' value='\" . esc_attr( $val ) . \"' id='input_\" . esc_attr( $label_id ) . \"' \/> \";\n\t\t}\n\n\t\t$this->_check_overwritten( $id );\n\t}\n\n\t\/**\n\t * Build a checkbox HTML snippet.\n\t *\n\t * @since 1.1.0\n\t *\n\t * @param string     $id      Setting ID.\n\t * @param string     $title   Checkbox label (HTML allowed).\n\t * @param bool|null  $checked Whether checked.\n\t * @param int|string $value   Checkbox value.\n\t * @return void\n\t *\/\n\tpublic function build_checkbox( $id, $title, $checked = null, $value = 1 ) {\n\t\tif ( null === $checked && $this->conf( $id, true ) ) {\n\t\t\t$checked = true;\n\t\t}\n\n\t\t$label_id = preg_replace( '\/\\W\/', '', $id );\n\n\t\tif ( 1 !== $value ) {\n\t\t\t$label_id .= '_' . $value;\n\t\t}\n\n\t\t$this->enroll( $id );\n\n\t\techo \"<div class='litespeed-tick'>\n\t\t\t<input type='checkbox' name='\" . esc_attr( $id ) . \"' id='input_checkbox_\" . esc_attr( $label_id ) . \"' value='\" . esc_attr( $value ) . \"' \" . checked( (bool) $checked, true, false ) . \" \/>\n\t\t\t<label for='input_checkbox_\" . esc_attr( $label_id ) . \"'>\" . wp_kses_post( $title ) . '<\/label>\n\t\t<\/div>';\n\n\t\t$this->_check_overwritten( $id );\n\t}\n\n\t\/**\n\t * Build a toggle checkbox snippet.\n\t *\n\t * @since 1.7\n\t *\n\t * @param string      $id        Setting ID.\n\t * @param bool|null   $checked   Whether enabled.\n\t * @param string|null $title_on  Label when on.\n\t * @param string|null $title_off Label when off.\n\t * @return void\n\t *\/\n\tpublic function build_toggle( $id, $checked = null, $title_on = null, $title_off = null ) {\n\t\tif ( null === $checked && $this->conf( $id, true ) ) {\n\t\t\t$checked = true;\n\t\t}\n\t\tif ( null === $title_on ) {\n\t\t\t$title_on  = __( 'ON', 'litespeed-cache' );\n\t\t\t$title_off = __( 'OFF', 'litespeed-cache' );\n\t\t}\n\t\t$cls = $checked ? 'primary' : 'default litespeed-toggleoff';\n\t\techo \"<div class='litespeed-toggle litespeed-toggle-btn litespeed-toggle-btn-\" . esc_attr( $cls ) . \"' data-litespeed-toggle-on='primary' data-litespeed-toggle-off='default' data-litespeed_toggle_id='\" . esc_attr( $id ) . \"' >\n\t\t\t\t<input name='\" . esc_attr( $id ) . \"' type='hidden' value='\" . esc_attr( $checked ) . \"' \/>\n\t\t\t\t<div class='litespeed-toggle-group'>\n\t\t\t\t\t<label class='litespeed-toggle-btn litespeed-toggle-btn-primary litespeed-toggle-on'>\" . esc_html( $title_on ) . \"<\/label>\n\t\t\t\t\t<label class='litespeed-toggle-btn litespeed-toggle-btn-default litespeed-toggle-active litespeed-toggle-off'>\" . esc_html( $title_off ) . \"<\/label>\n\t\t\t\t\t<span class='litespeed-toggle-handle litespeed-toggle-btn litespeed-toggle-btn-default'><\/span>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\";\n\t}\n\n\t\/**\n\t * Build a switch (radio) field.\n\t *\n\t * @since 1.1.0\n\t * @since 1.7 Removed $disable param.\n\t *\n\t * @param string                 $id         Setting ID.\n\t * @param array<int,mixed>|false $title_list Labels for options (OFF\/ON).\n\t * @return void\n\t *\/\n\tpublic function build_switch( $id, $title_list = false ) {\n\t\t$this->enroll( $id );\n\n\t\techo '<div class=\"litespeed-switch\">';\n\n\t\tif ( ! $title_list ) {\n\t\t\t$title_list = array( __( 'OFF', 'litespeed-cache' ), __( 'ON', 'litespeed-cache' ) );\n\t\t}\n\n\t\tforeach ( $title_list as $k => $v ) {\n\t\t\t$this->_build_radio( $id, $k, $v );\n\t\t}\n\n\t\techo '<\/div>';\n\n\t\t$this->_check_overwritten( $id );\n\t}\n\n\t\/**\n\t * Build a radio input and echo it.\n\t *\n\t * @since 1.1.0\n\t * @access private\n\t *\n\t * @param string     $id  Setting ID.\n\t * @param int|string $val Value for the radio.\n\t * @param string     $txt Label HTML.\n\t * @return void\n\t *\/\n\tprivate function _build_radio( $id, $val, $txt ) {\n\t\t$id_attr = 'input_radio_' . preg_replace( '\/\\W\/', '', $id ) . '_' . $val;\n\n\t\t$default = isset( self::$_default_options[ $id ] ) ? self::$_default_options[ $id ] : self::$_default_site_options[ $id ];\n\n\t\t$is_checked = ! is_string( $default )\n\t\t\t? ( (int) $this->conf( $id, true ) === (int) $val )\n\t\t\t: ( $this->conf( $id, true ) === $val );\n\n\t\techo \"<input type='radio' autocomplete='off' name='\" . esc_attr( $id ) . \"' id='\" . esc_attr( $id_attr ) . \"' value='\" . esc_attr( $val ) . \"' \" . checked( $is_checked, true, false ) . \" \/> <label for='\" . esc_attr( $id_attr ) . \"'>\" . wp_kses_post( $txt ) . '<\/label>';\n\t}\n\n\t\/**\n\t * Show overwritten info if value comes from const\/primary\/filter\/server.\n\t *\n\t * @since 3.0\n\t * @since 7.4 Show value from filters. Added type parameter.\n\t *\n\t * @param string $id Setting ID.\n\t * @return void\n\t *\/\n\tprotected function _check_overwritten( $id ) {\n\t\t$const_val   = $this->const_overwritten( $id );\n\t\t$primary_val = $this->primary_overwritten( $id );\n\t\t$filter_val  = $this->filter_overwritten( $id );\n\t\t$server_val  = $this->server_overwritten( $id );\n\n\t\tif ( null === $const_val && null === $primary_val && null === $filter_val && null === $server_val ) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Get value to display.\n\t\t$val = null !== $const_val ? $const_val : $primary_val;\n\t\t\/\/ If we have filter_val will set as new val.\n\t\tif ( null !== $filter_val ) {\n\t\t\t$val = $filter_val;\n\t\t}\n\t\t\/\/ If we have server_val will set as new val.\n\t\tif ( null !== $server_val ) {\n\t\t\t$val = $server_val;\n\t\t}\n\n\t\t\/\/ Get type (used for display purpose).\n\t\t$type = ( isset( self::$settings_filters[ $id ] ) && isset( self::$settings_filters[ $id ]['type'] ) ) ? self::$settings_filters[ $id ]['type'] : 'textarea';\n\t\tif ( ( null !== $const_val || null !== $primary_val ) && null === $filter_val ) {\n\t\t\t$type = 'setting';\n\t\t}\n\n\t\t\/\/ Get default setting: if settings exist, use default setting, otherwise use filter\/server value.\n\t\t$default = '';\n\t\tif ( isset( self::$_default_options[ $id ] ) || isset( self::$_default_site_options[ $id ] ) ) {\n\t\t\t$default = isset( self::$_default_options[ $id ] ) ? self::$_default_options[ $id ] : self::$_default_site_options[ $id ];\n\t\t}\n\t\tif ( null !== $filter_val || null !== $server_val ) {\n\t\t\t$default = null !== $filter_val ? $filter_val : $server_val;\n\t\t}\n\n\t\t\/\/ Set value to display, will be a string.\n\t\tif ( is_bool( $default ) ) {\n\t\t\t$val = $val ? __( 'ON', 'litespeed-cache' ) : __( 'OFF', 'litespeed-cache' );\n\t\t} else {\n\t\t\tif ( is_array( $val ) ) {\n\t\t\t\t$val = implode( \"\\n\", $val );\n\t\t\t}\n\t\t\t$val = esc_textarea( $val );\n\t\t}\n\n\t\t\/\/ Show warning for all types except textarea.\n\t\tif ( 'textarea' !== $type ) {\n\t\t\techo '<div class=\"litespeed-desc litespeed-warning litespeed-overwrite\">\u26a0\ufe0f ';\n\n\t\t\tif ( null !== $server_val ) {\n\t\t\t\t\/\/ Show $_SERVER value.\n\t\t\t\tprintf( esc_html__( 'This value is overwritten by the %s variable.', 'litespeed-cache' ), '$_SERVER' );\n\t\t\t\t$val = '$_SERVER[\"' . $server_val[0] . '\"] = ' . $server_val[1];\n\t\t\t} elseif ( null !== $filter_val ) {\n\t\t\t\t\/\/ Show filter value.\n\t\t\t\techo esc_html__( 'This value is overwritten by the filter.', 'litespeed-cache' );\n\t\t\t} elseif ( null !== $const_val ) {\n\t\t\t\t\/\/ Show CONSTANT value.\n\t\t\t\tprintf( esc_html__( 'This value is overwritten by the PHP constant %s.', 'litespeed-cache' ), '<code>' . esc_html( Base::conf_const( $id ) ) . '<\/code>' );\n\t\t\t} elseif ( is_multisite() ) {\n\t\t\t\t\/\/ Show multisite overwrite.\n\t\t\t\tif ( get_current_blog_id() !== BLOG_ID_CURRENT_SITE && $this->conf( self::NETWORK_O_USE_PRIMARY ) ) {\n\t\t\t\t\techo esc_html__( 'This value is overwritten by the primary site setting.', 'litespeed-cache' );\n\t\t\t\t} else {\n\t\t\t\t\techo esc_html__( 'This value is overwritten by the Network setting.', 'litespeed-cache' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\techo ' ' . sprintf( esc_html__( 'Currently set to %s', 'litespeed-cache' ), '<code>' . esc_html( $val ) . '<\/code>' ) . '<\/div>';\n\t\t} elseif ( 'textarea' === $type && null !== $filter_val ) {\n\t\t\t\/\/ Show warning for textarea.\n\t\t\t\/\/ Textarea sizes.\n\t\t\t$cols             = 30;\n\t\t\t$rows             = $this->get_textarea_rows( $val );\n\t\t\t$rows_current_val = $this->get_textarea_rows( implode( \"\\n\", $this->conf( $id, true ) ) );\n\t\t\t\/\/ If filter rows is bigger than textarea size, equalize them.\n\t\t\tif ( $rows > $rows_current_val ) {\n\t\t\t\t$rows = $rows_current_val;\n\t\t\t}\n\t\t\t?>\n\t\t\t<div class=\"litespeed-desc-wrapper\">\n\t\t\t\t<div class=\"litespeed-desc\"><?php echo esc_html__( 'Value from filter applied', 'litespeed-cache' ); ?>:<\/div>\n\t\t\t\t<textarea readonly rows=\"<?php echo (int) $rows; ?>\" cols=\"<?php echo (int) $cols; ?>\"><?php echo esc_textarea( $val ); ?><\/textarea>\n\t\t\t<\/div>\n\t\t\t<?php\n\t\t}\n\t}\n\n\t\/**\n\t * Display seconds label and readable span.\n\t *\n\t * @since 3.0\n\t * @return void\n\t *\/\n\tpublic function readable_seconds() {\n\t\techo esc_html__( 'seconds', 'litespeed-cache' );\n\t\techo ' <span data-litespeed-readable=\"\"><\/span>';\n\t}\n\n\t\/**\n\t * Display default value for a setting.\n\t *\n\t * @since 1.1.1\n\t *\n\t * @param string $id Setting ID.\n\t * @return void\n\t *\/\n\tpublic function recommended( $id ) {\n\t\tif ( ! $this->default_settings ) {\n\t\t\t$this->default_settings = $this->load_default_vals();\n\t\t}\n\n\t\t$val = $this->default_settings[ $id ];\n\n\t\tif ( ! $val ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! is_array( $val ) ) {\n\t\t\tprintf(\n\t\t\t\t'%s: <code>%s<\/code>',\n\t\t\t\tesc_html__( 'Default value', 'litespeed-cache' ),\n\t\t\t\tesc_html( $val )\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t$rows = 5;\n\t\t$cols = 30;\n\t\t\/\/ Flexible rows\/cols.\n\t\t$lines = count( $val ) + 1;\n\t\t$rows  = min( max( $lines, $rows ), 40 );\n\t\tforeach ( $val as $v ) {\n\t\t\t$cols = max( strlen( $v ), $cols );\n\t\t}\n\t\t$cols = min( $cols, 150 );\n\n\t\t$val = implode( \"\\n\", $val );\n\t\tprintf(\n\t\t\t'<div class=\"litespeed-desc\">%s:<\/div><textarea readonly rows=\"%d\" cols=\"%d\">%s<\/textarea>',\n\t\t\tesc_html__( 'Default value', 'litespeed-cache' ),\n\t\t\t(int) $rows,\n\t\t\t(int) $cols,\n\t\t\tesc_textarea( $val )\n\t\t);\n\t}\n\n\t\/**\n\t * Validate rewrite rules regex syntax.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string $id Setting ID.\n\t * @return void\n\t *\/\n\tprotected function _validate_syntax( $id ) {\n\t\t$val = $this->conf( $id, true );\n\n\t\tif ( ! $val ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! is_array( $val ) ) {\n\t\t\t$val = array( $val );\n\t\t}\n\n\t\tforeach ( $val as $v ) {\n\t\t\tif ( ! Utility::syntax_checker( $v ) ) {\n\t\t\t\techo '<br \/><span class=\"litespeed-warning\"> \u274c ' . esc_html__( 'Invalid rewrite rule', 'litespeed-cache' ) . ': <code>' . wp_kses_post( $v ) . '<\/code><\/span>';\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Validate if the .htaccess path is valid.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string $id Setting ID.\n\t * @return void\n\t *\/\n\tprotected function _validate_htaccess_path( $id ) {\n\t\t$val = $this->conf( $id, true );\n\t\tif ( ! $val ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( '\/.htaccess' !== substr( $val, -10 ) ) {\n\t\t\techo '<br \/><span class=\"litespeed-warning\"> \u274c ' . sprintf( esc_html__( 'Path must end with %s', 'litespeed-cache' ), '<code>\/.htaccess<\/code>' ) . '<\/span>';\n\t\t}\n\t}\n\n\t\/**\n\t * Check TTL ranges and show tips.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string   $id         Setting ID.\n\t * @param int|bool $min        Minimum value (or false).\n\t * @param int|bool $max        Maximum value (or false).\n\t * @param bool     $allow_zero Whether zero is allowed.\n\t * @return void\n\t *\/\n\tprotected function _validate_ttl( $id, $min = false, $max = false, $allow_zero = false ) {\n\t\t$val = $this->conf( $id, true );\n\n\t\t$tip = array();\n\t\tif ( $min && $val < $min && ( ! $allow_zero || 0 !== $val ) ) {\n\t\t\t$tip[] = esc_html__( 'Minimum value', 'litespeed-cache' ) . ': <code>' . $min . '<\/code>.';\n\t\t}\n\t\tif ( $max && $val > $max ) {\n\t\t\t$tip[] = esc_html__( 'Maximum value', 'litespeed-cache' ) . ': <code>' . $max . '<\/code>.';\n\t\t}\n\n\t\techo '<br \/>';\n\n\t\tif ( $tip ) {\n\t\t\techo '<span class=\"litespeed-warning\"> \u274c ' . wp_kses_post( implode( ' ', $tip ) ) . '<\/span>';\n\t\t}\n\n\t\t$range = '';\n\n\t\tif ( $allow_zero ) {\n\t\t\t$range .= esc_html__( 'Zero, or', 'litespeed-cache' ) . ' ';\n\t\t}\n\n\t\tif ( $min && $max ) {\n\t\t\t$range .= $min . ' - ' . $max;\n\t\t} elseif ( $min ) {\n\t\t\t$range .= esc_html__( 'Larger than', 'litespeed-cache' ) . ' ' . $min;\n\t\t} elseif ( $max ) {\n\t\t\t$range .= esc_html__( 'Smaller than', 'litespeed-cache' ) . ' ' . $max;\n\t\t}\n\n\t\techo esc_html__( 'Value range', 'litespeed-cache' ) . ': <code>' . esc_html( $range ) . '<\/code>';\n\t}\n\n\t\/**\n\t * Validate IPs in a list.\n\t *\n\t * @since 3.0\n\t *\n\t * @param string $id Setting ID.\n\t * @return void\n\t *\/\n\tprotected function _validate_ip( $id ) {\n\t\t$val = $this->conf( $id, true );\n\t\tif ( ! $val ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! is_array( $val ) ) {\n\t\t\t$val = array( $val );\n\t\t}\n\n\t\t$tip = array();\n\t\tforeach ( $val as $v ) {\n\t\t\tif ( ! $v ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( ! \\WP_Http::is_ip_address( $v ) ) {\n\t\t\t\t$tip[] = esc_html__( 'Invalid IP', 'litespeed-cache' ) . ': <code>' . esc_html( $v ) . '<\/code>.';\n\t\t\t}\n\t\t}\n\n\t\tif ( $tip ) {\n\t\t\techo '<br \/><span class=\"litespeed-warning\"> \u274c ' . wp_kses_post( implode( ' ', $tip ) ) . '<\/span>';\n\t\t}\n\t}\n\n\t\/**\n\t * Display API environment variable support.\n\t *\n\t * @since 1.8.3\n\t * @access protected\n\t *\n\t * @param string ...$args Server variable names.\n\t * @return void\n\t *\/\n\tprotected function _api_env_var( ...$args ) {\n\t\techo '<span class=\"litespeed-success\"> ' .\n\t\t\tesc_html__( 'API', 'litespeed-cache' ) . ': ' .\n\t\t\tsprintf(\n\t\t\t\t\/* translators: %s: list of server variables in <code> tags *\/\n\t\t\t\tesc_html__( 'Server variable(s) %s available to override this setting.', 'litespeed-cache' ),\n\t\t\t\t'<code>' . implode( '<\/code>, <code>', array_map( 'esc_html', $args ) ) . '<\/code>'\n\t\t\t) .\n\t\t\t'<\/span>';\n\n\t\tDoc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/admin\/#limiting-the-crawler' );\n\t}\n\n\t\/**\n\t * Display URI setting example.\n\t *\n\t * @since 2.6.1\n\t * @access protected\n\t * @return void\n\t *\/\n\tprotected function _uri_usage_example() {\n\t\techo esc_html__( 'The URLs will be compared to the REQUEST_URI server variable.', 'litespeed-cache' );\n\t\t\/* translators: 1: example URL, 2: pattern example *\/\n\t\techo ' ' . sprintf( esc_html__( 'For example, for %1$s, %2$s can be used here.', 'litespeed-cache' ), '<code>\/mypath\/mypage?aa=bb<\/code>', '<code>mypage?aa=<\/code>' );\n\t\techo '<br \/><i>';\n\t\t\/* translators: %s: caret symbol *\/\n\t\tprintf( esc_html__( 'To match the beginning, add %s to the beginning of the item.', 'litespeed-cache' ), '<code>^<\/code>' );\n\t\t\/* translators: %s: dollar symbol *\/\n\t\techo ' ' . sprintf( esc_html__( 'To do an exact match, add %s to the end of the URL.', 'litespeed-cache' ), '<code>$<\/code>' );\n\t\techo ' ' . esc_html__( 'One per line.', 'litespeed-cache' );\n\t\techo '<\/i>';\n\t}\n\n\t\/**\n\t * Return pluralized strings.\n\t *\n\t * @since 2.0\n\t *\n\t * @param int    $num  Number.\n\t * @param string $kind Kind of item (group|image).\n\t * @return string\n\t *\/\n\tpublic static function print_plural( $num, $kind = 'group' ) {\n\t\tif ( $num > 1 ) {\n\t\t\tswitch ( $kind ) {\n\t\t\t\tcase 'group':\n\t\t\t\t\treturn sprintf( esc_html__( '%s groups', 'litespeed-cache' ), $num );\n\n\t\t\t\tcase 'image':\n\t\t\t\t\treturn sprintf( esc_html__( '%s images', 'litespeed-cache' ), $num );\n\n\t\t\t\tdefault:\n\t\t\t\t\treturn $num;\n\t\t\t}\n\t\t}\n\n\t\tswitch ( $kind ) {\n\t\t\tcase 'group':\n\t\t\t\treturn sprintf( esc_html__( '%s group', 'litespeed-cache' ), $num );\n\n\t\t\tcase 'image':\n\t\t\t\treturn sprintf( esc_html__( '%s image', 'litespeed-cache' ), $num );\n\n\t\t\tdefault:\n\t\t\t\treturn $num;\n\t\t}\n\t}\n\n\t\/**\n\t * Return guidance HTML.\n\t *\n\t * @since 2.0\n\t *\n\t * @param string            $title        Title HTML.\n\t * @param array<int,string> $steps        Steps list (HTML allowed).\n\t * @param int|string        $current_step Current step number or 'done'.\n\t * @return string HTML for guidance widget.\n\t *\/\n\tpublic static function guidance( $title, $steps, $current_step ) {\n\t\tif ( 'done' === $current_step ) {\n\t\t\t$current_step = count( $steps ) + 1;\n\t\t}\n\n\t\t$percentage = ' (' . floor( ( ( $current_step - 1 ) * 100 ) \/ count( $steps ) ) . '%)';\n\n\t\t$html = '<div class=\"litespeed-guide\"><h2>' . $title . $percentage . '<\/h2><ol>';\n\t\tforeach ( $steps as $k => $v ) {\n\t\t\t$step = $k + 1;\n\t\t\tif ( $current_step > $step ) {\n\t\t\t\t$html .= '<li class=\"litespeed-guide-done\">';\n\t\t\t} else {\n\t\t\t\t$html .= '<li>';\n\t\t\t}\n\t\t\t$html .= $v . '<\/li>';\n\t\t}\n\n\t\t$html .= '<\/ol><\/div>';\n\n\t\treturn $html;\n\t}\n\n\t\/**\n\t * Check whether has QC hide banner cookie.\n\t *\n\t * @since 7.1\n\t *\n\t * @return bool\n\t *\/\n\tpublic static function has_qc_hide_banner() {\n\t\treturn isset( $_COOKIE[ self::COOKIE_QC_HIDE_BANNER ] ) && ( time() - (int) $_COOKIE[ self::COOKIE_QC_HIDE_BANNER ] ) < 86400 * 90;\n\t}\n\n\t\/**\n\t * Set QC hide banner cookie.\n\t *\n\t * @since 7.1\n\t * @return void\n\t *\/\n\tpublic static function set_qc_hide_banner() {\n\t\t$expire = time() + 86400 * 365;\n\t\tself::debug( 'Set qc hide banner cookie' );\n\t\tsetcookie( self::COOKIE_QC_HIDE_BANNER, time(), $expire, COOKIEPATH, COOKIE_DOMAIN );\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls.\n\t *\n\t * @since 7.1\n\t * @return void\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ( $type ) {\n\t\t\tcase self::TYPE_QC_HIDE_BANNER:\n\t\t\t\tself::set_qc_hide_banner();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/base.cls.php","ext":"php","size":33756,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The base consts\n *\n * @since       3.7\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Base extends Root {\n\n\t\/\/ This is redundant since v3.0\n\t\/\/ New conf items are `litespeed.key`\n\tconst OPTION_NAME = 'litespeed-cache-conf';\n\n\tconst _CACHE = '_cache'; \/\/ final cache status from setting\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------       General     ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst _VER           = '_version'; \/\/ Not set-able\n\tconst HASH           = 'hash'; \/\/ Not set-able\n\tconst O_AUTO_UPGRADE = 'auto_upgrade';\n\tconst O_API_KEY      = 'api_key'; \/\/ Deprecated since v6.4. TODO: Will drop after v6.5\n\tconst O_SERVER_IP    = 'server_ip';\n\tconst O_GUEST        = 'guest';\n\tconst O_GUEST_OPTM   = 'guest_optm';\n\tconst O_NEWS         = 'news';\n\tconst O_GUEST_UAS    = 'guest_uas';\n\tconst O_GUEST_IPS    = 'guest_ips';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------       Cache       ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_CACHE                = 'cache';\n\tconst O_CACHE_PRIV           = 'cache-priv';\n\tconst O_CACHE_COMMENTER      = 'cache-commenter';\n\tconst O_CACHE_REST           = 'cache-rest';\n\tconst O_CACHE_PAGE_LOGIN     = 'cache-page_login';\n\tconst O_CACHE_FAVICON        = 'cache-favicon'; \/\/ Deprecated since v6.2. TODO: Will drop after v6.5\n\tconst O_CACHE_RES            = 'cache-resources'; \/\/ Deprecated since v7.2. TODO: Drop after v7.5\n\tconst O_CACHE_MOBILE         = 'cache-mobile';\n\tconst O_CACHE_MOBILE_RULES   = 'cache-mobile_rules';\n\tconst O_CACHE_BROWSER        = 'cache-browser';\n\tconst O_CACHE_EXC_USERAGENTS = 'cache-exc_useragents';\n\tconst O_CACHE_EXC_COOKIES    = 'cache-exc_cookies';\n\tconst O_CACHE_EXC_QS         = 'cache-exc_qs';\n\tconst O_CACHE_EXC_CAT        = 'cache-exc_cat';\n\tconst O_CACHE_EXC_TAG        = 'cache-exc_tag';\n\tconst O_CACHE_FORCE_URI      = 'cache-force_uri';\n\tconst O_CACHE_FORCE_PUB_URI  = 'cache-force_pub_uri';\n\tconst O_CACHE_PRIV_URI       = 'cache-priv_uri';\n\tconst O_CACHE_EXC            = 'cache-exc';\n\tconst O_CACHE_EXC_ROLES      = 'cache-exc_roles';\n\tconst O_CACHE_DROP_QS        = 'cache-drop_qs';\n\tconst O_CACHE_TTL_PUB        = 'cache-ttl_pub';\n\tconst O_CACHE_TTL_PRIV       = 'cache-ttl_priv';\n\tconst O_CACHE_TTL_FRONTPAGE  = 'cache-ttl_frontpage';\n\tconst O_CACHE_TTL_FEED       = 'cache-ttl_feed';\n\tconst O_CACHE_TTL_REST       = 'cache-ttl_rest';\n\tconst O_CACHE_TTL_STATUS     = 'cache-ttl_status';\n\tconst O_CACHE_TTL_BROWSER    = 'cache-ttl_browser';\n\tconst O_CACHE_AJAX_TTL       = 'cache-ajax_ttl';\n\tconst O_CACHE_LOGIN_COOKIE   = 'cache-login_cookie';\n\tconst O_CACHE_VARY_COOKIES   = 'cache-vary_cookies';\n\tconst O_CACHE_VARY_GROUP     = 'cache-vary_group';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------       Purge       ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_PURGE_ON_UPGRADE                   = 'purge-upgrade';\n\tconst O_PURGE_STALE                        = 'purge-stale';\n\tconst O_PURGE_POST_ALL                     = 'purge-post_all';\n\tconst O_PURGE_POST_FRONTPAGE               = 'purge-post_f';\n\tconst O_PURGE_POST_HOMEPAGE                = 'purge-post_h';\n\tconst O_PURGE_POST_PAGES                   = 'purge-post_p';\n\tconst O_PURGE_POST_PAGES_WITH_RECENT_POSTS = 'purge-post_pwrp';\n\tconst O_PURGE_POST_AUTHOR                  = 'purge-post_a';\n\tconst O_PURGE_POST_YEAR                    = 'purge-post_y';\n\tconst O_PURGE_POST_MONTH                   = 'purge-post_m';\n\tconst O_PURGE_POST_DATE                    = 'purge-post_d';\n\tconst O_PURGE_POST_TERM                    = 'purge-post_t'; \/\/ include category|tag|tax\n\tconst O_PURGE_POST_POSTTYPE                = 'purge-post_pt';\n\tconst O_PURGE_TIMED_URLS                   = 'purge-timed_urls';\n\tconst O_PURGE_TIMED_URLS_TIME              = 'purge-timed_urls_time';\n\tconst O_PURGE_HOOK_ALL                     = 'purge-hook_all';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------        ESI        ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_ESI                = 'esi';\n\tconst O_ESI_CACHE_ADMBAR   = 'esi-cache_admbar';\n\tconst O_ESI_CACHE_COMMFORM = 'esi-cache_commform';\n\tconst O_ESI_NONCE          = 'esi-nonce';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------     Utilities     ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_UTIL_INSTANT_CLICK = 'util-instant_click';\n\tconst O_UTIL_NO_HTTPS_VARY = 'util-no_https_vary';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------       Debug       ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_DEBUG_DISABLE_ALL = 'debug-disable_all';\n\tconst O_DEBUG             = 'debug';\n\tconst O_DEBUG_IPS         = 'debug-ips';\n\tconst O_DEBUG_LEVEL       = 'debug-level';\n\tconst O_DEBUG_FILESIZE    = 'debug-filesize';\n\tconst O_DEBUG_COOKIE      = 'debug-cookie'; \/\/ For backwards compatibility, will drop after v7.0\n\tconst O_DEBUG_COLLAPSE_QS = 'debug-collapse_qs';\n\tconst O_DEBUG_COLLAPS_QS  = 'debug-collapse_qs'; \/\/ For backwards compatibility, will drop after v6.5\n\tconst O_DEBUG_INC         = 'debug-inc';\n\tconst O_DEBUG_EXC         = 'debug-exc';\n\tconst O_DEBUG_EXC_STRINGS = 'debug-exc_strings';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------      DB Optm      ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_DB_OPTM_REVISIONS_MAX = 'db_optm-revisions_max';\n\tconst O_DB_OPTM_REVISIONS_AGE = 'db_optm-revisions_age';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------     HTML Optm     ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_OPTM_CSS_MIN                 = 'optm-css_min';\n\tconst O_OPTM_CSS_COMB                = 'optm-css_comb';\n\tconst O_OPTM_CSS_COMB_EXT_INL        = 'optm-css_comb_ext_inl';\n\tconst O_OPTM_UCSS                    = 'optm-ucss';\n\tconst O_OPTM_UCSS_INLINE             = 'optm-ucss_inline';\n\tconst O_OPTM_UCSS_SELECTOR_WHITELIST = 'optm-ucss_whitelist';\n\tconst O_OPTM_UCSS_FILE_EXC_INLINE    = 'optm-ucss_file_exc_inline';\n\tconst O_OPTM_UCSS_EXC                = 'optm-ucss_exc';\n\tconst O_OPTM_CSS_EXC                 = 'optm-css_exc';\n\tconst O_OPTM_JS_MIN                  = 'optm-js_min';\n\tconst O_OPTM_JS_COMB                 = 'optm-js_comb';\n\tconst O_OPTM_JS_COMB_EXT_INL         = 'optm-js_comb_ext_inl';\n\tconst O_OPTM_JS_DELAY_INC            = 'optm-js_delay_inc';\n\tconst O_OPTM_JS_EXC                  = 'optm-js_exc';\n\tconst O_OPTM_HTML_MIN                = 'optm-html_min';\n\tconst O_OPTM_HTML_LAZY               = 'optm-html_lazy';\n\tconst O_OPTM_HTML_SKIP_COMMENTS      = 'optm-html_skip_comment';\n\tconst O_OPTM_QS_RM                   = 'optm-qs_rm';\n\tconst O_OPTM_GGFONTS_RM              = 'optm-ggfonts_rm';\n\tconst O_OPTM_CSS_ASYNC               = 'optm-css_async';\n\tconst O_OPTM_CCSS_PER_URL            = 'optm-ccss_per_url';\n\tconst O_OPTM_CCSS_SEP_POSTTYPE       = 'optm-ccss_sep_posttype';\n\tconst O_OPTM_CCSS_SEP_URI            = 'optm-ccss_sep_uri';\n\tconst O_OPTM_CCSS_SELECTOR_WHITELIST = 'optm-ccss_whitelist';\n\tconst O_OPTM_CSS_ASYNC_INLINE        = 'optm-css_async_inline';\n\tconst O_OPTM_CSS_FONT_DISPLAY        = 'optm-css_font_display';\n\tconst O_OPTM_JS_DEFER                = 'optm-js_defer';\n\tconst O_OPTM_LOCALIZE                = 'optm-localize';\n\tconst O_OPTM_LOCALIZE_DOMAINS        = 'optm-localize_domains';\n\tconst O_OPTM_EMOJI_RM                = 'optm-emoji_rm';\n\tconst O_OPTM_NOSCRIPT_RM             = 'optm-noscript_rm';\n\tconst O_OPTM_GGFONTS_ASYNC           = 'optm-ggfonts_async';\n\tconst O_OPTM_EXC_ROLES               = 'optm-exc_roles';\n\tconst O_OPTM_CCSS_CON                = 'optm-ccss_con';\n\tconst O_OPTM_JS_DEFER_EXC            = 'optm-js_defer_exc';\n\tconst O_OPTM_GM_JS_EXC               = 'optm-gm_js_exc';\n\tconst O_OPTM_DNS_PREFETCH            = 'optm-dns_prefetch';\n\tconst O_OPTM_DNS_PREFETCH_CTRL       = 'optm-dns_prefetch_ctrl';\n\tconst O_OPTM_DNS_PRECONNECT          = 'optm-dns_preconnect';\n\tconst O_OPTM_EXC                     = 'optm-exc';\n\tconst O_OPTM_GUEST_ONLY              = 'optm-guest_only';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------   Object Cache    ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_OBJECT                       = 'object';\n\tconst O_OBJECT_KIND                  = 'object-kind';\n\tconst O_OBJECT_HOST                  = 'object-host';\n\tconst O_OBJECT_PORT                  = 'object-port';\n\tconst O_OBJECT_LIFE                  = 'object-life';\n\tconst O_OBJECT_PERSISTENT            = 'object-persistent';\n\tconst O_OBJECT_ADMIN                 = 'object-admin';\n\tconst O_OBJECT_TRANSIENTS            = 'object-transients';\n\tconst O_OBJECT_DB_ID                 = 'object-db_id';\n\tconst O_OBJECT_USER                  = 'object-user';\n\tconst O_OBJECT_PSWD                  = 'object-pswd';\n\tconst O_OBJECT_GLOBAL_GROUPS         = 'object-global_groups';\n\tconst O_OBJECT_NON_PERSISTENT_GROUPS = 'object-non_persistent_groups';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------   Discussion      ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_DISCUSS_AVATAR_CACHE     = 'discuss-avatar_cache';\n\tconst O_DISCUSS_AVATAR_CRON      = 'discuss-avatar_cron';\n\tconst O_DISCUSS_AVATAR_CACHE_TTL = 'discuss-avatar_cache_ttl';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------        Media      ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_MEDIA_PRELOAD_FEATURED           = 'media-preload_featured'; \/\/ Deprecated since v6.2. TODO: Will drop after v6.5\n\tconst O_MEDIA_LAZY                       = 'media-lazy';\n\tconst O_MEDIA_LAZY_PLACEHOLDER           = 'media-lazy_placeholder';\n\tconst O_MEDIA_PLACEHOLDER_RESP           = 'media-placeholder_resp';\n\tconst O_MEDIA_PLACEHOLDER_RESP_COLOR     = 'media-placeholder_resp_color';\n\tconst O_MEDIA_PLACEHOLDER_RESP_SVG       = 'media-placeholder_resp_svg';\n\tconst O_MEDIA_LQIP                       = 'media-lqip';\n\tconst O_MEDIA_LQIP_QUAL                  = 'media-lqip_qual';\n\tconst O_MEDIA_LQIP_MIN_W                 = 'media-lqip_min_w';\n\tconst O_MEDIA_LQIP_MIN_H                 = 'media-lqip_min_h';\n\tconst O_MEDIA_PLACEHOLDER_RESP_ASYNC     = 'media-placeholder_resp_async';\n\tconst O_MEDIA_IFRAME_LAZY                = 'media-iframe_lazy';\n\tconst O_MEDIA_ADD_MISSING_SIZES          = 'media-add_missing_sizes';\n\tconst O_MEDIA_LAZY_EXC                   = 'media-lazy_exc';\n\tconst O_MEDIA_LAZY_CLS_EXC               = 'media-lazy_cls_exc';\n\tconst O_MEDIA_LAZY_PARENT_CLS_EXC        = 'media-lazy_parent_cls_exc';\n\tconst O_MEDIA_IFRAME_LAZY_CLS_EXC        = 'media-iframe_lazy_cls_exc';\n\tconst O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC = 'media-iframe_lazy_parent_cls_exc';\n\tconst O_MEDIA_LAZY_URI_EXC               = 'media-lazy_uri_exc';\n\tconst O_MEDIA_LQIP_EXC                   = 'media-lqip_exc';\n\tconst O_MEDIA_VPI                        = 'media-vpi';\n\tconst O_MEDIA_VPI_CRON                   = 'media-vpi_cron';\n\tconst O_IMG_OPTM_JPG_QUALITY             = 'img_optm-jpg_quality';\n\tconst O_MEDIA_AUTO_RESCALE_ORI           = 'media-auto_rescale_ori';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------     Image Optm    ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_IMG_OPTM_AUTO                = 'img_optm-auto';\n\tconst O_IMG_OPTM_CRON                = 'img_optm-cron'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_IMG_OPTM_ORI                 = 'img_optm-ori';\n\tconst O_IMG_OPTM_RM_BKUP             = 'img_optm-rm_bkup';\n\tconst O_IMG_OPTM_WEBP                = 'img_optm-webp';\n\tconst O_IMG_OPTM_LOSSLESS            = 'img_optm-lossless';\n\tconst O_IMG_OPTM_EXIF                = 'img_optm-exif';\n\tconst O_IMG_OPTM_WEBP_ATTR           = 'img_optm-webp_attr';\n\tconst O_IMG_OPTM_WEBP_REPLACE_SRCSET = 'img_optm-webp_replace_srcset';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------       Crawler     ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_CRAWLER                = 'crawler';\n\tconst O_CRAWLER_USLEEP         = 'crawler-usleep'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_RUN_DURATION   = 'crawler-run_duration'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_RUN_INTERVAL   = 'crawler-run_interval'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_CRAWL_INTERVAL = 'crawler-crawl_interval';\n\tconst O_CRAWLER_THREADS        = 'crawler-threads'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_TIMEOUT        = 'crawler-timeout'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_LOAD_LIMIT     = 'crawler-load_limit';\n\tconst O_CRAWLER_SITEMAP        = 'crawler-sitemap';\n\tconst O_CRAWLER_DROP_DOMAIN    = 'crawler-drop_domain'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_MAP_TIMEOUT    = 'crawler-map_timeout'; \/\/ @Deprecated since v7.0 TODO: remove after v7.5\n\tconst O_CRAWLER_ROLES          = 'crawler-roles';\n\tconst O_CRAWLER_COOKIES        = 'crawler-cookies';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------        Misc       ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_MISC_HEARTBEAT_FRONT      = 'misc-heartbeat_front';\n\tconst O_MISC_HEARTBEAT_FRONT_TTL  = 'misc-heartbeat_front_ttl';\n\tconst O_MISC_HEARTBEAT_BACK       = 'misc-heartbeat_back';\n\tconst O_MISC_HEARTBEAT_BACK_TTL   = 'misc-heartbeat_back_ttl';\n\tconst O_MISC_HEARTBEAT_EDITOR     = 'misc-heartbeat_editor';\n\tconst O_MISC_HEARTBEAT_EDITOR_TTL = 'misc-heartbeat_editor_ttl';\n\n\t\/\/ -------------------------------------------------- ##\n\t\/\/ --------------        CDN        ----------------- ##\n\t\/\/ -------------------------------------------------- ##\n\tconst O_CDN                  = 'cdn';\n\tconst O_CDN_ORI              = 'cdn-ori';\n\tconst O_CDN_ORI_DIR          = 'cdn-ori_dir';\n\tconst O_CDN_EXC              = 'cdn-exc';\n\tconst O_CDN_QUIC             = 'cdn-quic'; \/\/ No more a visible setting since v7\n\tconst O_CDN_CLOUDFLARE       = 'cdn-cloudflare';\n\tconst O_CDN_CLOUDFLARE_EMAIL = 'cdn-cloudflare_email';\n\tconst O_CDN_CLOUDFLARE_KEY   = 'cdn-cloudflare_key';\n\tconst O_CDN_CLOUDFLARE_NAME  = 'cdn-cloudflare_name';\n\tconst O_CDN_CLOUDFLARE_ZONE  = 'cdn-cloudflare_zone';\n\tconst O_CDN_CLOUDFLARE_CLEAR = 'cdn-cloudflare_clear';\n\tconst O_CDN_MAPPING          = 'cdn-mapping';\n\tconst O_CDN_ATTR             = 'cdn-attr';\n\tconst O_QC_NAMESERVERS       = 'qc-nameservers';\n\tconst O_QC_CNAME             = 'qc-cname';\n\n\tconst NETWORK_O_USE_PRIMARY = 'use_primary_settings';\n\n\tconst DEBUG_TMP_DISABLE = 'debug-disable_tmp';\n\n\t\/*** Other consts ***\/\n\tconst O_GUIDE = 'litespeed-guide'; \/\/ Array of each guidance tag as key, step as val \/\/xx todo: may need to remove\n\n\t\/\/ Server variables\n\tconst ENV_CRAWLER_USLEEP             = 'CRAWLER_USLEEP';\n\tconst ENV_CRAWLER_LOAD_LIMIT         = 'CRAWLER_LOAD_LIMIT';\n\tconst ENV_CRAWLER_LOAD_LIMIT_ENFORCE = 'CRAWLER_LOAD_LIMIT_ENFORCE';\n\n\tconst CRWL_COOKIE_NAME = 'name';\n\tconst CRWL_COOKIE_VALS = 'vals';\n\n\tconst CDN_MAPPING_URL      = 'url';\n\tconst CDN_MAPPING_INC_IMG  = 'inc_img';\n\tconst CDN_MAPPING_INC_CSS  = 'inc_css';\n\tconst CDN_MAPPING_INC_JS   = 'inc_js';\n\tconst CDN_MAPPING_FILETYPE = 'filetype';\n\n\tconst VAL_OFF = 0;\n\tconst VAL_ON  = 1;\n\tconst VAL_ON2 = 2;\n\n\t\/* This is for API hook usage *\/\n\tconst IMG_OPTM_BM_ORI      = 1; \/\/ @Deprecated since v7.0\n\tconst IMG_OPTM_BM_WEBP     = 2; \/\/ @Deprecated since v7.0\n\tconst IMG_OPTM_BM_LOSSLESS = 4; \/\/ @Deprecated since v7.0\n\tconst IMG_OPTM_BM_EXIF     = 8; \/\/ @Deprecated since v7.0\n\tconst IMG_OPTM_BM_AVIF     = 16; \/\/ @Deprecated since v7.0\n\n\t\/* Site related options (Will not overwrite other sites' config) *\/\n\tprotected static $SINGLE_SITE_OPTIONS = array(\n\t\tself::O_CRAWLER,\n\t\tself::O_CRAWLER_SITEMAP,\n\t\tself::O_CDN,\n\t\tself::O_CDN_ORI,\n\t\tself::O_CDN_ORI_DIR,\n\t\tself::O_CDN_EXC,\n\t\tself::O_CDN_CLOUDFLARE,\n\t\tself::O_CDN_CLOUDFLARE_EMAIL,\n\t\tself::O_CDN_CLOUDFLARE_KEY,\n\t\tself::O_CDN_CLOUDFLARE_NAME,\n\t\tself::O_CDN_CLOUDFLARE_ZONE,\n\t\tself::O_CDN_CLOUDFLARE_CLEAR,\n\t\tself::O_CDN_MAPPING,\n\t\tself::O_CDN_ATTR,\n\t\tself::O_QC_NAMESERVERS,\n\t\tself::O_QC_CNAME,\n\t);\n\n\tprotected static $_default_options = array(\n\t\tself::_VER => '',\n\t\tself::HASH => '',\n\t\tself::O_API_KEY => '',\n\t\tself::O_AUTO_UPGRADE => false,\n\t\tself::O_SERVER_IP => '',\n\t\tself::O_GUEST => false,\n\t\tself::O_GUEST_OPTM => false,\n\t\tself::O_NEWS => false,\n\t\tself::O_GUEST_UAS => array(),\n\t\tself::O_GUEST_IPS => array(),\n\n\t\t\/\/ Cache\n\t\tself::O_CACHE => false,\n\t\tself::O_CACHE_PRIV => false,\n\t\tself::O_CACHE_COMMENTER => false,\n\t\tself::O_CACHE_REST => false,\n\t\tself::O_CACHE_PAGE_LOGIN => false,\n\t\tself::O_CACHE_MOBILE => false,\n\t\tself::O_CACHE_MOBILE_RULES => array(),\n\t\tself::O_CACHE_BROWSER => false,\n\t\tself::O_CACHE_EXC_USERAGENTS => array(),\n\t\tself::O_CACHE_EXC_COOKIES => array(),\n\t\tself::O_CACHE_EXC_QS => array(),\n\t\tself::O_CACHE_EXC_CAT => array(),\n\t\tself::O_CACHE_EXC_TAG => array(),\n\t\tself::O_CACHE_FORCE_URI => array(),\n\t\tself::O_CACHE_FORCE_PUB_URI => array(),\n\t\tself::O_CACHE_PRIV_URI => array(),\n\t\tself::O_CACHE_EXC => array(),\n\t\tself::O_CACHE_EXC_ROLES => array(),\n\t\tself::O_CACHE_DROP_QS => array(),\n\t\tself::O_CACHE_TTL_PUB => 0,\n\t\tself::O_CACHE_TTL_PRIV => 0,\n\t\tself::O_CACHE_TTL_FRONTPAGE => 0,\n\t\tself::O_CACHE_TTL_FEED => 0,\n\t\tself::O_CACHE_TTL_REST => 0,\n\t\tself::O_CACHE_TTL_BROWSER => 0,\n\t\tself::O_CACHE_TTL_STATUS => array(),\n\t\tself::O_CACHE_LOGIN_COOKIE => '',\n\t\tself::O_CACHE_AJAX_TTL => array(),\n\t\tself::O_CACHE_VARY_COOKIES => array(),\n\t\tself::O_CACHE_VARY_GROUP => array(),\n\n\t\t\/\/ Purge\n\t\tself::O_PURGE_ON_UPGRADE => false,\n\t\tself::O_PURGE_STALE => false,\n\t\tself::O_PURGE_POST_ALL => false,\n\t\tself::O_PURGE_POST_FRONTPAGE => false,\n\t\tself::O_PURGE_POST_HOMEPAGE => false,\n\t\tself::O_PURGE_POST_PAGES => false,\n\t\tself::O_PURGE_POST_PAGES_WITH_RECENT_POSTS => false,\n\t\tself::O_PURGE_POST_AUTHOR => false,\n\t\tself::O_PURGE_POST_YEAR => false,\n\t\tself::O_PURGE_POST_MONTH => false,\n\t\tself::O_PURGE_POST_DATE => false,\n\t\tself::O_PURGE_POST_TERM => false,\n\t\tself::O_PURGE_POST_POSTTYPE => false,\n\t\tself::O_PURGE_TIMED_URLS => array(),\n\t\tself::O_PURGE_TIMED_URLS_TIME => '',\n\t\tself::O_PURGE_HOOK_ALL => array(),\n\n\t\t\/\/ ESI\n\t\tself::O_ESI => false,\n\t\tself::O_ESI_CACHE_ADMBAR => false,\n\t\tself::O_ESI_CACHE_COMMFORM => false,\n\t\tself::O_ESI_NONCE => array(),\n\n\t\t\/\/ Util\n\t\tself::O_UTIL_INSTANT_CLICK => false,\n\t\tself::O_UTIL_NO_HTTPS_VARY => false,\n\n\t\t\/\/ Debug\n\t\tself::O_DEBUG_DISABLE_ALL => false,\n\t\tself::O_DEBUG => false,\n\t\tself::O_DEBUG_IPS => array(),\n\t\tself::O_DEBUG_LEVEL => false,\n\t\tself::O_DEBUG_FILESIZE => 0,\n\t\tself::O_DEBUG_COLLAPSE_QS => false,\n\t\tself::O_DEBUG_INC => array(),\n\t\tself::O_DEBUG_EXC => array(),\n\t\tself::O_DEBUG_EXC_STRINGS => array(),\n\n\t\t\/\/ DB Optm\n\t\tself::O_DB_OPTM_REVISIONS_MAX => 0,\n\t\tself::O_DB_OPTM_REVISIONS_AGE => 0,\n\n\t\t\/\/ HTML Optm\n\t\tself::O_OPTM_CSS_MIN => false,\n\t\tself::O_OPTM_CSS_COMB => false,\n\t\tself::O_OPTM_CSS_COMB_EXT_INL => false,\n\t\tself::O_OPTM_UCSS => false,\n\t\tself::O_OPTM_UCSS_INLINE => false,\n\t\tself::O_OPTM_UCSS_SELECTOR_WHITELIST => array(),\n\t\tself::O_OPTM_UCSS_FILE_EXC_INLINE => array(),\n\t\tself::O_OPTM_UCSS_EXC => array(),\n\t\tself::O_OPTM_CSS_EXC => array(),\n\t\tself::O_OPTM_JS_MIN => false,\n\t\tself::O_OPTM_JS_COMB => false,\n\t\tself::O_OPTM_JS_COMB_EXT_INL => false,\n\t\tself::O_OPTM_JS_DELAY_INC => array(),\n\t\tself::O_OPTM_JS_EXC => array(),\n\t\tself::O_OPTM_HTML_MIN => false,\n\t\tself::O_OPTM_HTML_LAZY => array(),\n\t\tself::O_OPTM_HTML_SKIP_COMMENTS => array(),\n\t\tself::O_OPTM_QS_RM => false,\n\t\tself::O_OPTM_GGFONTS_RM => false,\n\t\tself::O_OPTM_CSS_ASYNC => false,\n\t\tself::O_OPTM_CCSS_PER_URL => false,\n\t\tself::O_OPTM_CCSS_SEP_POSTTYPE => array(),\n\t\tself::O_OPTM_CCSS_SEP_URI => array(),\n\t\tself::O_OPTM_CCSS_SELECTOR_WHITELIST => array(),\n\t\tself::O_OPTM_CSS_ASYNC_INLINE => false,\n\t\tself::O_OPTM_CSS_FONT_DISPLAY => false,\n\t\tself::O_OPTM_JS_DEFER => false,\n\t\tself::O_OPTM_EMOJI_RM => false,\n\t\tself::O_OPTM_NOSCRIPT_RM => false,\n\t\tself::O_OPTM_GGFONTS_ASYNC => false,\n\t\tself::O_OPTM_EXC_ROLES => array(),\n\t\tself::O_OPTM_CCSS_CON => '',\n\t\tself::O_OPTM_JS_DEFER_EXC => array(),\n\t\tself::O_OPTM_GM_JS_EXC => array(),\n\t\tself::O_OPTM_DNS_PREFETCH => array(),\n\t\tself::O_OPTM_DNS_PREFETCH_CTRL => false,\n\t\tself::O_OPTM_DNS_PRECONNECT => array(),\n\t\tself::O_OPTM_EXC => array(),\n\t\tself::O_OPTM_GUEST_ONLY => false,\n\n\t\t\/\/ Object\n\t\tself::O_OBJECT => false,\n\t\tself::O_OBJECT_KIND => false,\n\t\tself::O_OBJECT_HOST => '',\n\t\tself::O_OBJECT_PORT => 0,\n\t\tself::O_OBJECT_LIFE => 0,\n\t\tself::O_OBJECT_PERSISTENT => false,\n\t\tself::O_OBJECT_ADMIN => false,\n\t\tself::O_OBJECT_TRANSIENTS => false,\n\t\tself::O_OBJECT_DB_ID => 0,\n\t\tself::O_OBJECT_USER => '',\n\t\tself::O_OBJECT_PSWD => '',\n\t\tself::O_OBJECT_GLOBAL_GROUPS => array(),\n\t\tself::O_OBJECT_NON_PERSISTENT_GROUPS => array(),\n\n\t\t\/\/ Discuss\n\t\tself::O_DISCUSS_AVATAR_CACHE => false,\n\t\tself::O_DISCUSS_AVATAR_CRON => false,\n\t\tself::O_DISCUSS_AVATAR_CACHE_TTL => 0,\n\t\tself::O_OPTM_LOCALIZE => false,\n\t\tself::O_OPTM_LOCALIZE_DOMAINS => array(),\n\n\t\t\/\/ Media\n\t\tself::O_MEDIA_LAZY => false,\n\t\tself::O_MEDIA_LAZY_PLACEHOLDER => '',\n\t\tself::O_MEDIA_PLACEHOLDER_RESP => false,\n\t\tself::O_MEDIA_PLACEHOLDER_RESP_COLOR => '',\n\t\tself::O_MEDIA_PLACEHOLDER_RESP_SVG => '',\n\t\tself::O_MEDIA_LQIP => false,\n\t\tself::O_MEDIA_LQIP_QUAL => 0,\n\t\tself::O_MEDIA_LQIP_MIN_W => 0,\n\t\tself::O_MEDIA_LQIP_MIN_H => 0,\n\t\tself::O_MEDIA_PLACEHOLDER_RESP_ASYNC => false,\n\t\tself::O_MEDIA_IFRAME_LAZY => false,\n\t\tself::O_MEDIA_ADD_MISSING_SIZES => false,\n\t\tself::O_MEDIA_LAZY_EXC => array(),\n\t\tself::O_MEDIA_LAZY_CLS_EXC => array(),\n\t\tself::O_MEDIA_LAZY_PARENT_CLS_EXC => array(),\n\t\tself::O_MEDIA_IFRAME_LAZY_CLS_EXC => array(),\n\t\tself::O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC => array(),\n\t\tself::O_MEDIA_LAZY_URI_EXC => array(),\n\t\tself::O_MEDIA_LQIP_EXC => array(),\n\t\tself::O_MEDIA_VPI => false,\n\t\tself::O_MEDIA_VPI_CRON => false,\n\t\tself::O_MEDIA_AUTO_RESCALE_ORI => false,\n\n\t\t\/\/ Image Optm\n\t\tself::O_IMG_OPTM_AUTO => false,\n\t\tself::O_IMG_OPTM_ORI => false,\n\t\tself::O_IMG_OPTM_RM_BKUP => false,\n\t\tself::O_IMG_OPTM_WEBP => false,\n\t\tself::O_IMG_OPTM_LOSSLESS => false,\n\t\tself::O_IMG_OPTM_EXIF => false,\n\t\tself::O_IMG_OPTM_WEBP_ATTR => array(),\n\t\tself::O_IMG_OPTM_WEBP_REPLACE_SRCSET => false,\n\t\tself::O_IMG_OPTM_JPG_QUALITY => 0,\n\n\t\t\/\/ Crawler\n\t\tself::O_CRAWLER => false,\n\t\tself::O_CRAWLER_CRAWL_INTERVAL => 0,\n\t\tself::O_CRAWLER_LOAD_LIMIT => 0,\n\t\tself::O_CRAWLER_SITEMAP => '',\n\t\tself::O_CRAWLER_ROLES => array(),\n\t\tself::O_CRAWLER_COOKIES => array(),\n\n\t\t\/\/ Misc\n\t\tself::O_MISC_HEARTBEAT_FRONT => false,\n\t\tself::O_MISC_HEARTBEAT_FRONT_TTL => 0,\n\t\tself::O_MISC_HEARTBEAT_BACK => false,\n\t\tself::O_MISC_HEARTBEAT_BACK_TTL => 0,\n\t\tself::O_MISC_HEARTBEAT_EDITOR => false,\n\t\tself::O_MISC_HEARTBEAT_EDITOR_TTL => 0,\n\n\t\t\/\/ CDN\n\t\tself::O_CDN => false,\n\t\tself::O_CDN_ORI => array(),\n\t\tself::O_CDN_ORI_DIR => array(),\n\t\tself::O_CDN_EXC => array(),\n\t\tself::O_CDN_QUIC => false,\n\t\tself::O_CDN_CLOUDFLARE => false,\n\t\tself::O_CDN_CLOUDFLARE_EMAIL => '',\n\t\tself::O_CDN_CLOUDFLARE_KEY => '',\n\t\tself::O_CDN_CLOUDFLARE_NAME => '',\n\t\tself::O_CDN_CLOUDFLARE_ZONE => '',\n\t\tself::O_CDN_CLOUDFLARE_CLEAR => false,\n\t\tself::O_CDN_MAPPING => array(),\n\t\tself::O_CDN_ATTR => array(),\n\n\t\tself::O_QC_NAMESERVERS => '',\n\t\tself::O_QC_CNAME => '',\n\n\t\tself::DEBUG_TMP_DISABLE => 0,\n\t);\n\n\tprotected static $_default_site_options = array(\n\t\tself::_VER => '',\n\t\tself::O_CACHE => false,\n\t\tself::NETWORK_O_USE_PRIMARY => false,\n\t\tself::O_AUTO_UPGRADE => false,\n\t\tself::O_GUEST => false,\n\n\t\tself::O_CACHE_BROWSER => false,\n\t\tself::O_CACHE_MOBILE => false,\n\t\tself::O_CACHE_MOBILE_RULES => array(),\n\t\tself::O_CACHE_LOGIN_COOKIE => '',\n\t\tself::O_CACHE_VARY_COOKIES => array(),\n\t\tself::O_CACHE_EXC_COOKIES => array(),\n\t\tself::O_CACHE_EXC_USERAGENTS => array(),\n\t\tself::O_CACHE_TTL_BROWSER => 0,\n\n\t\tself::O_PURGE_ON_UPGRADE => false,\n\n\t\tself::O_OBJECT => false,\n\t\tself::O_OBJECT_KIND => false,\n\t\tself::O_OBJECT_HOST => '',\n\t\tself::O_OBJECT_PORT => 0,\n\t\tself::O_OBJECT_LIFE => 0,\n\t\tself::O_OBJECT_PERSISTENT => false,\n\t\tself::O_OBJECT_ADMIN => false,\n\t\tself::O_OBJECT_TRANSIENTS => false,\n\t\tself::O_OBJECT_DB_ID => 0,\n\t\tself::O_OBJECT_USER => '',\n\t\tself::O_OBJECT_PSWD => '',\n\t\tself::O_OBJECT_GLOBAL_GROUPS => array(),\n\t\tself::O_OBJECT_NON_PERSISTENT_GROUPS => array(),\n\n\t\t\/\/ Debug\n\t\tself::O_DEBUG_DISABLE_ALL => false,\n\t\tself::O_DEBUG => false,\n\t\tself::O_DEBUG_IPS => array(),\n\t\tself::O_DEBUG_LEVEL => false,\n\t\tself::O_DEBUG_FILESIZE => 0,\n\t\tself::O_DEBUG_COLLAPSE_QS => false,\n\t\tself::O_DEBUG_INC => array(),\n\t\tself::O_DEBUG_EXC => array(),\n\t\tself::O_DEBUG_EXC_STRINGS => array(),\n\n\t\tself::O_IMG_OPTM_WEBP => false,\n\t);\n\n\t\/\/ NOTE: all the val of following items will be int while not bool\n\tprotected static $_multi_switch_list = array(\n\t\tself::O_DEBUG => 2,\n\t\tself::O_OPTM_JS_DEFER => 2,\n\t\tself::O_IMG_OPTM_WEBP => 2,\n\t);\n\n\t\/**\n\t * Correct the option type\n\t *\n\t * TODO: add similar network func\n\t *\n\t * @since  3.0.3\n\t *\/\n\tprotected function type_casting( $val, $id, $is_site_conf = false ) {\n\t\t$default_v = !$is_site_conf ? self::$_default_options[$id] : self::$_default_site_options[$id];\n\t\tif (is_bool($default_v)) {\n\t\t\tif ($val === 'true') {\n\t\t\t\t$val = true;\n\t\t\t}\n\t\t\tif ($val === 'false') {\n\t\t\t\t$val = false;\n\t\t\t}\n\n\t\t\t$max = $this->_conf_multi_switch($id);\n\t\t\tif ($max) {\n\t\t\t\t$val  = (int) $val;\n\t\t\t\t$val %= $max + 1;\n\t\t\t} else {\n\t\t\t\t$val = (bool) $val;\n\t\t\t}\n\t\t} elseif (is_array($default_v)) {\n\t\t\t\/\/ from textarea input\n\t\t\tif (!is_array($val)) {\n\t\t\t\t$val = Utility::sanitize_lines($val, $this->_conf_filter($id));\n\t\t\t}\n\t\t} elseif (!is_string($default_v)) {\n\t\t\t$val = (int) $val;\n\t\t} else {\n\t\t\t\/\/ Check if the string has a limit set\n\t\t\t$val = $this->_conf_string_val($id, $val);\n\t\t}\n\n\t\treturn $val;\n\t}\n\n\t\/**\n\t * Load default network settings from data.ini\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function load_default_site_vals() {\n\t\t\/\/ Load network_default.json\n\t\tif (file_exists(LSCWP_DIR . 'data\/const.network_default.json')) {\n\t\t\t$default_ini_cfg = json_decode(File::read(LSCWP_DIR . 'data\/const.network_default.json'), true);\n\t\t\tforeach (self::$_default_site_options as $k => $v) {\n\t\t\t\tif (!array_key_exists($k, $default_ini_cfg)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Parse value in ini file\n\t\t\t\t$ini_v = $this->type_casting($default_ini_cfg[$k], $k, true);\n\n\t\t\t\tif ($ini_v == $v) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tself::$_default_site_options[$k] = $ini_v;\n\t\t\t}\n\t\t}\n\n\t\tself::$_default_site_options[self::_VER] = Core::VER;\n\n\t\treturn self::$_default_site_options;\n\t}\n\n\t\/**\n\t * Load default values from default.json\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function load_default_vals() {\n\t\t\/\/ Load default.json\n\t\tif (file_exists(LSCWP_DIR . 'data\/const.default.json')) {\n\t\t\t$default_ini_cfg = json_decode(File::read(LSCWP_DIR . 'data\/const.default.json'), true);\n\t\t\tforeach (self::$_default_options as $k => $v) {\n\t\t\t\tif (!array_key_exists($k, $default_ini_cfg)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t\/\/ Parse value in ini file\n\t\t\t\t$ini_v = $this->type_casting($default_ini_cfg[$k], $k);\n\n\t\t\t\t\/\/ NOTE: Multiple lines value must be stored as array\n\t\t\t\t\/**\n\t\t\t\t * Special handler for CDN_mapping\n\t\t\t\t *\n\t\t\t\t * format in .ini:\n\t\t\t\t *      [cdn-mapping]\n\t\t\t\t *      url[0] = 'https:\/\/example.com\/'\n\t\t\t\t *      inc_js[0] = true\n\t\t\t\t *      filetype[0] = '.css\n\t\t\t\t *                     .js\n\t\t\t\t *                     .jpg'\n\t\t\t\t *\n\t\t\t\t * format out:\n\t\t\t\t *      [0] = [ 'url' => 'https:\/\/example.com', 'inc_js' => true, 'filetype' => [ '.css', '.js', '.jpg' ] ]\n\t\t\t\t *\/\n\t\t\t\tif ($k == self::O_CDN_MAPPING) {\n\t\t\t\t\t$mapping_fields = array(\n\t\t\t\t\t\tself::CDN_MAPPING_URL,\n\t\t\t\t\t\tself::CDN_MAPPING_INC_IMG,\n\t\t\t\t\t\tself::CDN_MAPPING_INC_CSS,\n\t\t\t\t\t\tself::CDN_MAPPING_INC_JS,\n\t\t\t\t\t\tself::CDN_MAPPING_FILETYPE, \/\/ Array\n\t\t\t\t\t);\n\t\t\t\t\t$ini_v2         = array();\n\t\t\t\t\tforeach ($ini_v[self::CDN_MAPPING_URL] as $k2 => $v2) {\n\t\t\t\t\t\t\/\/ $k2 is numeric\n\t\t\t\t\t\t$this_row = array();\n\t\t\t\t\t\tforeach ($mapping_fields as $v3) {\n\t\t\t\t\t\t\t$this_v = !empty($ini_v[$v3][$k2]) ? $ini_v[$v3][$k2] : false;\n\t\t\t\t\t\t\tif ($v3 == self::CDN_MAPPING_URL) {\n\t\t\t\t\t\t\t\t$this_v = $this_v ?: '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ($v3 == self::CDN_MAPPING_FILETYPE) {\n\t\t\t\t\t\t\t\t$this_v = $this_v ? Utility::sanitize_lines($this_v) : array(); \/\/ Note: Since v3.0 its already an array\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this_row[$v3] = $this_v;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$ini_v2[$k2] = $this_row;\n\t\t\t\t\t}\n\t\t\t\t\t$ini_v = $ini_v2;\n\t\t\t\t}\n\n\t\t\t\tif ($ini_v == $v) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tself::$_default_options[$k] = $ini_v;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Load internal default vals\n\t\t\/\/ Setting the default bool to int is also to avoid type casting override it back to bool\n\t\tself::$_default_options[self::O_CACHE] = is_multisite() ? self::VAL_ON2 : self::VAL_ON; \/\/ For multi site, default is 2 (Use Network Admin Settings). For single site, default is 1 (Enabled).\n\n\t\t\/\/ Load default vals containing variables\n\t\tif (!self::$_default_options[self::O_CDN_ORI_DIR]) {\n\t\t\tself::$_default_options[self::O_CDN_ORI_DIR] = LSCWP_CONTENT_FOLDER . \"\\nwp-includes\";\n\t\t\tself::$_default_options[self::O_CDN_ORI_DIR] = explode(\"\\n\", self::$_default_options[self::O_CDN_ORI_DIR]);\n\t\t\tself::$_default_options[self::O_CDN_ORI_DIR] = array_map('trim', self::$_default_options[self::O_CDN_ORI_DIR]);\n\t\t}\n\n\t\t\/\/ Set security key if not initialized yet\n\t\tif (!self::$_default_options[self::HASH]) {\n\t\t\tself::$_default_options[self::HASH] = Str::rrand(32);\n\t\t}\n\n\t\tself::$_default_options[self::_VER] = Core::VER;\n\n\t\treturn self::$_default_options;\n\t}\n\n\t\/**\n\t * Format the string value\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_string_val( $id, $val ) {\n\t\treturn $val;\n\t}\n\n\t\/**\n\t * If the switch setting is a triple value or not\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_multi_switch( $id ) {\n\t\tif (!empty(self::$_multi_switch_list[$id])) {\n\t\t\treturn self::$_multi_switch_list[$id];\n\t\t}\n\n\t\tif ($id == self::O_CACHE && is_multisite()) {\n\t\t\treturn self::VAL_ON2;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Append a new multi switch max limit for the bool option\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic static function set_multi_switch( $id, $v ) {\n\t\tself::$_multi_switch_list[$id] = $v;\n\t}\n\n\t\/**\n\t * Generate const name based on $id\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic static function conf_const( $id ) {\n\t\treturn 'LITESPEED_CONF__' . strtoupper(str_replace('-', '__', $id));\n\t}\n\n\t\/**\n\t * Filter to be used when saving setting\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_filter( $id ) {\n\t\t$filters = array(\n\t\t\tself::O_MEDIA_LAZY_EXC => 'uri',\n\t\t\tself::O_DEBUG_INC => 'relative',\n\t\t\tself::O_DEBUG_EXC => 'relative',\n\t\t\tself::O_MEDIA_LAZY_URI_EXC => 'relative',\n\t\t\tself::O_CACHE_PRIV_URI => 'relative',\n\t\t\tself::O_PURGE_TIMED_URLS => 'relative',\n\t\t\tself::O_CACHE_FORCE_URI => 'relative',\n\t\t\tself::O_CACHE_FORCE_PUB_URI => 'relative',\n\t\t\tself::O_CACHE_EXC => 'relative',\n\t\t\t\/\/ self::O_OPTM_CSS_EXC     => 'uri', \/\/ Need to comment out for inline & external CSS\n\t\t\t\/\/ self::O_OPTM_JS_EXC          => 'uri',\n\t\t\tself::O_OPTM_EXC => 'relative',\n\t\t\tself::O_OPTM_CCSS_SEP_URI => 'uri',\n\t\t\t\/\/ self::O_OPTM_JS_DEFER_EXC    => 'uri',\n\t\t\tself::O_OPTM_DNS_PREFETCH => 'domain',\n\t\t\tself::O_CDN_ORI => 'noprotocol,trailingslash', \/\/ `Original URLs`\n\t\t\t\/\/ self::O_OPTM_LOCALIZE_DOMAINS    => 'noprotocol', \/\/ `Localize Resources`\n\t\t\t\/\/ self::   => '',\n\t\t\t\/\/ self::   => '',\n\t\t);\n\n\t\tif (!empty($filters[$id])) {\n\t\t\treturn $filters[$id];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * If the setting changes worth a purge or not\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_purge( $id ) {\n\t\t$check_ids = array(\n\t\t\tself::O_MEDIA_LAZY_URI_EXC,\n\t\t\tself::O_OPTM_EXC,\n\t\t\tself::O_CACHE_PRIV_URI,\n\t\t\tself::O_PURGE_TIMED_URLS,\n\t\t\tself::O_CACHE_FORCE_URI,\n\t\t\tself::O_CACHE_FORCE_PUB_URI,\n\t\t\tself::O_CACHE_EXC,\n\t\t);\n\n\t\treturn in_array($id, $check_ids);\n\t}\n\n\t\/**\n\t * If the setting changes worth a purge ALL or not\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_purge_all( $id ) {\n\t\t$check_ids = array( self::O_CACHE, self::O_ESI, self::O_DEBUG_DISABLE_ALL, self::NETWORK_O_USE_PRIMARY );\n\n\t\treturn in_array($id, $check_ids);\n\t}\n\n\t\/**\n\t * If the setting is a pswd or not\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_pswd( $id ) {\n\t\t$check_ids = array( self::O_CDN_CLOUDFLARE_KEY, self::O_OBJECT_PSWD );\n\n\t\treturn in_array($id, $check_ids);\n\t}\n\n\t\/**\n\t * If the setting is cron related or not\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_cron( $id ) {\n\t\t$check_ids = array( self::O_OPTM_CSS_ASYNC, self::O_MEDIA_PLACEHOLDER_RESP_ASYNC, self::O_DISCUSS_AVATAR_CRON, self::O_IMG_OPTM_AUTO, self::O_CRAWLER );\n\n\t\treturn in_array($id, $check_ids);\n\t}\n\n\t\/**\n\t * If the setting changes worth a purge, return the tag\n\t *\n\t * @since  3.0\n\t *\/\n\tprotected function _conf_purge_tag( $id ) {\n\t\t$check_ids = array(\n\t\t\tself::O_CACHE_PAGE_LOGIN => Tag::TYPE_LOGIN,\n\t\t);\n\n\t\tif (!empty($check_ids[$id])) {\n\t\t\treturn $check_ids[$id];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Generate server vars\n\t *\n\t * @since 2.4.1\n\t *\/\n\tpublic function server_vars() {\n\t\t$consts      = array(\n\t\t\t'WP_SITEURL',\n\t\t\t'WP_HOME',\n\t\t\t'WP_CONTENT_DIR',\n\t\t\t'SHORTINIT',\n\t\t\t'LSCWP_CONTENT_DIR',\n\t\t\t'LSCWP_CONTENT_FOLDER',\n\t\t\t'LSCWP_DIR',\n\t\t\t'LITESPEED_TIME_OFFSET',\n\t\t\t'LITESPEED_SERVER_TYPE',\n\t\t\t'LITESPEED_CLI',\n\t\t\t'LITESPEED_ALLOWED',\n\t\t\t'LITESPEED_ON',\n\t\t\t'LSWCP_TAG_PREFIX',\n\t\t\t'COOKIEHASH',\n\t\t);\n\t\t$server_vars = array();\n\t\tforeach ($consts as $v) {\n\t\t\t$server_vars[$v] = defined($v) ? constant($v) : null;\n\t\t}\n\n\t\treturn $server_vars;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/gui.cls.php","ext":"php","size":30894,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The frontend GUI class.\n *\n * @since       1.3\n * @subpackage  LiteSpeed\/src\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass GUI extends Base {\n\n\tprivate static $_clean_counter = 0;\n\n\tprivate $_promo_true;\n\n\t\/\/ [ file_tag => [ days, litespeed_only ], ... ]\n\tprivate $_promo_list = array(\n\t\t'new_version' => array( 7, false ),\n\t\t'score' => array( 14, false ),\n\t\t\/\/ 'slack'      => array( 3, false ),\n\t);\n\n\tconst LIB_GUEST_JS        = 'assets\/js\/guest.min.js';\n\tconst LIB_GUEST_DOCREF_JS = 'assets\/js\/guest.docref.min.js';\n\tconst PHP_GUEST           = 'guest.vary.php';\n\n\tconst TYPE_DISMISS_WHM            = 'whm';\n\tconst TYPE_DISMISS_EXPIRESDEFAULT = 'ExpiresDefault';\n\tconst TYPE_DISMISS_PROMO          = 'promo';\n\tconst TYPE_DISMISS_PIN            = 'pin';\n\n\tconst WHM_MSG     = 'lscwp_whm_install';\n\tconst WHM_MSG_VAL = 'whm_install';\n\n\tprotected $_summary;\n\n\t\/**\n\t * Instance\n\t *\n\t * @since  1.3\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t\/**\n\t * Frontend Init\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function init() {\n\t\tDebug2::debug2('[GUI] init');\n\t\tif (is_admin_bar_showing() && current_user_can('manage_options')) {\n\t\t\tadd_action('wp_enqueue_scripts', array( $this, 'frontend_enqueue_style' ));\n\t\t\tadd_action('admin_bar_menu', array( $this, 'frontend_shortcut' ), 95);\n\t\t}\n\n\t\t\/**\n\t\t * Turn on instant click\n\t\t *\n\t\t * @since  1.8.2\n\t\t *\/\n\t\tif ($this->conf(self::O_UTIL_INSTANT_CLICK)) {\n\t\t\tadd_action('wp_enqueue_scripts', array( $this, 'frontend_enqueue_style_public' ));\n\t\t}\n\n\t\t\/\/ NOTE: this needs to be before optimizer to avoid wrapper being removed\n\t\tadd_filter('litespeed_buffer_finalize', array( $this, 'finalize' ), 8);\n\t}\n\n\t\/**\n\t * Print a loading message when redirecting CCSS\/UCSS page to avoid whiteboard confusion\n\t *\/\n\tpublic static function print_loading( $counter, $type ) {\n\t\techo '<div style=\"font-size: 25px; text-align: center; padding-top: 150px; width: 100%; position: absolute;\">';\n\t\techo \"<img width='35' src='\" . LSWCP_PLUGIN_URL . \"assets\/img\/Litespeed.icon.svg' \/>   \";\n\t\tprintf(__('%1$s %2$s files left in queue', 'litespeed-cache'), $counter, $type);\n\t\techo '<p><a href=\"' . admin_url('admin.php?page=litespeed-page_optm') . '\">' . __('Cancel', 'litespeed-cache') . '<\/a><\/p>';\n\t\techo '<\/div>';\n\t}\n\n\t\/**\n\t * Display the tab list\n\t *\n\t * @since 7.3\n\t *\/\n\tpublic static function display_tab_list( $tabs ) {\n\t\t$i = 1;\n\t\tforeach ( $tabs as $k => $val ) {\n\t\t\t$accesskey = $i <= 9 ? $i : '';\n\t\t\tprintf(\n\t\t\t\t'<a class=\"litespeed-tab nav-tab\" href=\"#%1$s\" data-litespeed-tab=\"%1$s\" litespeed-accesskey=\"%2$s\">%3$s<\/a>',\n\t\t\t\tesc_attr( $k ),\n\t\t\t\tesc_attr( $accesskey ),\n\t\t\t\tesc_html( $val )\n\t\t\t);\n\t\t\t++$i;\n\t\t}\n\t}\n\n\t\/**\n\t * Display a pie\n\t *\n\t * @since 1.6.6\n\t *\/\n\tpublic static function pie( $percent, $width = 50, $finished_tick = false, $without_percentage = false, $append_cls = false ) {\n\t\t$percentage = '<text x=\"50%\" y=\"50%\">' . $percent . ($without_percentage ? '' : '%') . '<\/text>';\n\n\t\tif ($percent == 100 && $finished_tick) {\n\t\t\t$percentage = '<text x=\"50%\" y=\"50%\" class=\"litespeed-pie-done\">\u2713<\/text>';\n\t\t}\n\n\t\treturn \"\n\t\t<svg class='litespeed-pie $append_cls' viewbox='0 0 33.83098862 33.83098862' width='$width' height='$width' xmlns='http:\/\/www.w3.org\/2000\/svg'>\n\t\t\t<circle class='litespeed-pie_bg' cx='16.91549431' cy='16.91549431' r='15.91549431' \/>\n\t\t\t<circle class='litespeed-pie_circle' cx='16.91549431' cy='16.91549431' r='15.91549431' stroke-dasharray='$percent,100' \/>\n\t\t\t<g class='litespeed-pie_info'>$percentage<\/g>\n\t\t<\/svg>\n\t\t\";\n\t}\n\n\t\/**\n\t * Allow svg html filters\n\t *\n\t * @since 7.3\n\t *\/\n\tpublic static function allowed_svg_tags() {\n\t\treturn array(\n\t\t\t'svg'   => array(\n\t\t\t\t'width'   => true,\n\t\t\t\t'height'  => true,\n\t\t\t\t'viewbox' => true, \/\/ Note: SVG standard uses 'viewBox', but wp_kses normalizes to lowercase.\n\t\t\t\t'xmlns'   => true,\n\t\t\t\t'class'   => true,\n\t\t\t\t'id'      => true,\n\t\t\t),\n\t\t\t'circle' => array(\n\t\t\t\t'cx'               => true,\n\t\t\t\t'cy'               => true,\n\t\t\t\t'r'                => true,\n\t\t\t\t'fill'             => true,\n\t\t\t\t'stroke'           => true,\n\t\t\t\t'class'            => true,\n\t\t\t\t'stroke-width'     => true,\n\t\t\t\t'stroke-dasharray' => true,\n\t\t\t),\n\t\t\t'path'  => array(\n\t\t\t\t'd'      => true,\n\t\t\t\t'fill'   => true,\n\t\t\t\t'stroke' => true,\n\t\t\t),\n\t\t\t'text'  => array(\n\t\t\t\t'x'            => true,\n\t\t\t\t'y'            => true,\n\t\t\t\t'dx'           => true,\n\t\t\t\t'dy'           => true,\n\t\t\t\t'font-size'    => true,\n\t\t\t\t'font-family'  => true,\n\t\t\t\t'font-weight'  => true,\n\t\t\t\t'fill'         => true,\n\t\t\t\t'stroke'       => true,\n\t\t\t\t'stroke-width' => true,\n\t\t\t\t'text-anchor'  => true,\n\t\t\t\t'class'        => true,\n\t\t\t\t'id'           => true,\n\t\t\t),\n\t\t\t'g'     => array(\n\t\t\t\t'transform'    => true,\n\t\t\t\t'fill'         => true,\n\t\t\t\t'stroke'       => true,\n\t\t\t\t'stroke-width' => true,\n\t\t\t\t'class'        => true,\n\t\t\t\t'id'           => true,\n\t\t\t),\n\t\t\t'button' => array(\n\t\t\t\t'type'               => true,\n\t\t\t\t'data-balloon-break' => true,\n\t\t\t\t'data-balloon-pos'   => true,\n\t\t\t\t'aria-label'         => true,\n\t\t\t\t'class'              => true,\n\t\t\t),\n\t\t);\n\t}\n\n\t\/**\n\t * Display a tiny pie with a tooltip\n\t *\n\t * @since 3.0\n\t *\/\n\tpublic static function pie_tiny( $percent, $width = 50, $tooltip = '', $tooltip_pos = 'up', $append_cls = false ) {\n\t\t\/\/ formula C = 2\u03c0R\n\t\t$dasharray = 2 * 3.1416 * 9 * ($percent \/ 100);\n\n\t\treturn \"\n\t\t<button type='button' data-balloon-break data-balloon-pos='$tooltip_pos' aria-label='$tooltip' class='litespeed-btn-pie'>\n\t\t<svg class='litespeed-pie litespeed-pie-tiny $append_cls' viewbox='0 0 30 30' width='$width' height='$width' xmlns='http:\/\/www.w3.org\/2000\/svg'>\n\t\t\t<circle class='litespeed-pie_bg' cx='15' cy='15' r='9' \/>\n\t\t\t<circle class='litespeed-pie_circle' cx='15' cy='15' r='9' stroke-dasharray='$dasharray,100' \/>\n\t\t\t<g class='litespeed-pie_info'><text x='50%' y='50%'>i<\/text><\/g>\n\t\t<\/svg>\n\t\t<\/button>\n\t\t\";\n\t}\n\n\t\/**\n\t * Get classname of PageSpeed Score\n\t *\n\t * Scale:\n\t *  90-100 (fast)\n\t *  50-89 (average)\n\t *  0-49 (slow)\n\t *\n\t * @since  2.9\n\t * @access public\n\t *\/\n\tpublic function get_cls_of_pagescore( $score ) {\n\t\tif ($score >= 90) {\n\t\t\treturn 'success';\n\t\t}\n\n\t\tif ($score >= 50) {\n\t\t\treturn 'warning';\n\t\t}\n\n\t\treturn 'danger';\n\t}\n\n\t\/**\n\t * Dismiss banner\n\t *\n\t * @since 1.0\n\t * @access public\n\t *\/\n\tpublic static function dismiss() {\n\t\t$_instance = self::cls();\n\t\tswitch (Router::verify_type()) {\n\t\t\tcase self::TYPE_DISMISS_WHM:\n            self::dismiss_whm();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_DISMISS_EXPIRESDEFAULT:\n            self::update_option(Admin_Display::DB_DISMISS_MSG, Admin_Display::RULECONFLICT_DISMISSED);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_DISMISS_PIN:\n            Admin_display::dismiss_pin();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_DISMISS_PROMO:\n            if (empty($_GET['promo_tag'])) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n            $promo_tag = sanitize_key($_GET['promo_tag']);\n\n            if (empty($_instance->_promo_list[$promo_tag])) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n            defined('LSCWP_LOG') && Debug2::debug('[GUI] Dismiss promo ' . $promo_tag);\n\n            \/\/ Forever dismiss\n            if (!empty($_GET['done'])) {\n\t\t\t\t\t$_instance->_summary[$promo_tag] = 'done';\n\t\t\t\t} elseif (!empty($_GET['later'])) {\n                \/\/ Delay the banner to half year later\n                $_instance->_summary[$promo_tag] = time() + 86400 * 180;\n\t\t\t\t} else {\n                \/\/ Update welcome banner to 30 days after\n                $_instance->_summary[$promo_tag] = time() + 86400 * 30;\n\t\t\t\t}\n\n            self::save_summary();\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (Router::is_ajax()) {\n\t\t\t\/\/ All dismiss actions are considered as ajax call, so just exit\n\t\t\texit(\\json_encode(array( 'success' => 1 )));\n\t\t}\n\n\t\t\/\/ Plain click link, redirect to referral url\n\t\tAdmin::redirect();\n\t}\n\n\t\/**\n\t * Check if has rule conflict notice\n\t *\n\t * @since 1.1.5\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic static function has_msg_ruleconflict() {\n\t\t$db_dismiss_msg = self::get_option(Admin_Display::DB_DISMISS_MSG);\n\t\tif (!$db_dismiss_msg) {\n\t\t\tself::update_option(Admin_Display::DB_DISMISS_MSG, -1);\n\t\t}\n\t\treturn $db_dismiss_msg == Admin_Display::RULECONFLICT_ON;\n\t}\n\n\t\/**\n\t * Check if has whm notice\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic static function has_whm_msg() {\n\t\t$val = self::get_option(self::WHM_MSG);\n\t\tif (!$val) {\n\t\t\tself::dismiss_whm();\n\t\t\treturn false;\n\t\t}\n\t\treturn $val == self::WHM_MSG_VAL;\n\t}\n\n\t\/**\n\t * Delete whm msg tag\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t *\/\n\tpublic static function dismiss_whm() {\n\t\tself::update_option(self::WHM_MSG, -1);\n\t}\n\n\t\/**\n\t * Set current page a litespeed page\n\t *\n\t * @since  2.9\n\t *\/\n\tprivate function _is_litespeed_page() {\n\t\tif (\n\t\t\t!empty($_GET['page']) &&\n\t\t\tin_array($_GET['page'], array(\n\t\t\t\t'litespeed-settings',\n\t\t\t\t'litespeed-dash',\n\t\t\t\tAdmin::PAGE_EDIT_HTACCESS,\n\t\t\t\t'litespeed-optimization',\n\t\t\t\t'litespeed-crawler',\n\t\t\t\t'litespeed-import',\n\t\t\t\t'litespeed-report',\n\t\t\t))\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Display promo banner\n\t *\n\t * @since 2.1\n\t * @access public\n\t *\/\n\tpublic function show_promo( $check_only = false ) {\n\t\t$is_litespeed_page = $this->_is_litespeed_page();\n\n\t\t\/\/ Bypass showing info banner if disabled all in debug\n\t\tif (defined('LITESPEED_DISABLE_ALL') && LITESPEED_DISABLE_ALL) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (file_exists(ABSPATH . '.litespeed_no_banner')) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug('[GUI] Bypass banners due to silence file');\n\t\t\treturn false;\n\t\t}\n\n\t\tforeach ($this->_promo_list as $promo_tag => $v) {\n\t\t\tlist($delay_days, $litespeed_page_only) = $v;\n\n\t\t\tif ($litespeed_page_only && !$is_litespeed_page) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ first time check\n\t\t\tif (empty($this->_summary[$promo_tag])) {\n\t\t\t\t$this->_summary[$promo_tag] = time() + 86400 * $delay_days;\n\t\t\t\tself::save_summary();\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$promo_timestamp = $this->_summary[$promo_tag];\n\n\t\t\t\/\/ was ticked as done\n\t\t\tif ($promo_timestamp == 'done') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Not reach the dateline yet\n\t\t\tif (time() < $promo_timestamp) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ try to load, if can pass, will set $this->_promo_true = true\n\t\t\t$this->_promo_true = false;\n\t\t\tinclude LSCWP_DIR . \"tpl\/banner\/$promo_tag.php\";\n\n\t\t\t\/\/ If not defined, means it didn't pass the display workflow in tpl.\n\t\t\tif (!$this->_promo_true) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($check_only) {\n\t\t\t\treturn $promo_tag;\n\t\t\t}\n\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug('[GUI] Show promo ' . $promo_tag);\n\n\t\t\t\/\/ Only contain one\n\t\t\tbreak;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Load frontend public script\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t *\/\n\tpublic function frontend_enqueue_style_public() {\n\t\twp_enqueue_script(Core::PLUGIN_NAME, LSWCP_PLUGIN_URL . 'assets\/js\/instant_click.min.js', array(), Core::VER, true);\n\t}\n\n\t\/**\n\t * Load frontend menu shortcut\n\t *\n\t * @since  1.3\n\t * @access public\n\t *\/\n\tpublic function frontend_enqueue_style() {\n\t\twp_enqueue_style(Core::PLUGIN_NAME, LSWCP_PLUGIN_URL . 'assets\/css\/litespeed.css', array(), Core::VER, 'all');\n\t}\n\n\t\/**\n\t * Load frontend menu shortcut\n\t *\n\t * @since  1.3\n\t * @access public\n\t *\/\n\tpublic function frontend_shortcut() {\n\t\tglobal $wp_admin_bar;\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'id' => 'litespeed-menu',\n\t\t\t'title' => '<span class=\"ab-icon\"><\/span>',\n\t\t\t'href' => get_admin_url(null, 'admin.php?page=litespeed'),\n\t\t\t'meta' => array(\n\t\t\t\t'tabindex' => 0,\n\t\t\t\t'class' => 'litespeed-top-toolbar',\n\t\t\t),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-single',\n\t\t\t'title' => __('Purge this page', 'litespeed-cache') . ' - LSCache',\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_FRONT, false, true),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\tif ($this->has_cache_folder('ucss')) {\n\t\t\t$possible_url_tag = UCSS::get_url_tag();\n\t\t\t$append_arr       = array();\n\t\t\tif ($possible_url_tag) {\n\t\t\t\t$append_arr['url_tag'] = $possible_url_tag;\n\t\t\t}\n\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-single-ucss',\n\t\t\t\t'title' => __('Purge this page', 'litespeed-cache') . ' - UCSS',\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_UCSS, false, true, $append_arr),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-single-action',\n\t\t\t'title' => __('Mark this page as ', 'litespeed-cache'),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\tif (!empty($_SERVER['REQUEST_URI'])) {\n\t\t\t$append_arr = array(\n\t\t\t\tConf::TYPE_SET . '[' . self::O_CACHE_FORCE_URI . '][]' => $_SERVER['REQUEST_URI'] . '$',\n\t\t\t\t'redirect' => $_SERVER['REQUEST_URI'],\n\t\t\t);\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-single-action',\n\t\t\t\t'id' => 'litespeed-single-forced_cache',\n\t\t\t\t'title' => __('Forced cacheable', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_CONF, Conf::TYPE_SET, false, true, $append_arr),\n\t\t\t));\n\n\t\t\t$append_arr = array(\n\t\t\t\tConf::TYPE_SET . '[' . self::O_CACHE_EXC . '][]' => $_SERVER['REQUEST_URI'] . '$',\n\t\t\t\t'redirect' => $_SERVER['REQUEST_URI'],\n\t\t\t);\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-single-action',\n\t\t\t\t'id' => 'litespeed-single-noncache',\n\t\t\t\t'title' => __('Non cacheable', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_CONF, Conf::TYPE_SET, false, true, $append_arr),\n\t\t\t));\n\n\t\t\t$append_arr = array(\n\t\t\t\tConf::TYPE_SET . '[' . self::O_CACHE_PRIV_URI . '][]' => $_SERVER['REQUEST_URI'] . '$',\n\t\t\t\t'redirect' => $_SERVER['REQUEST_URI'],\n\t\t\t);\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-single-action',\n\t\t\t\t'id' => 'litespeed-single-private',\n\t\t\t\t'title' => __('Private cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_CONF, Conf::TYPE_SET, false, true, $append_arr),\n\t\t\t));\n\n\t\t\t$append_arr = array(\n\t\t\t\tConf::TYPE_SET . '[' . self::O_OPTM_EXC . '][]' => $_SERVER['REQUEST_URI'] . '$',\n\t\t\t\t'redirect' => $_SERVER['REQUEST_URI'],\n\t\t\t);\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-single-action',\n\t\t\t\t'id' => 'litespeed-single-nonoptimize',\n\t\t\t\t'title' => __('No optimization', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_CONF, Conf::TYPE_SET, false, true, $append_arr),\n\t\t\t));\n\t\t}\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-single-action',\n\t\t\t'id' => 'litespeed-single-more',\n\t\t\t'title' => __('More settings', 'litespeed-cache'),\n\t\t\t'href' => get_admin_url(null, 'admin.php?page=litespeed-cache'),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-all',\n\t\t\t'title' => __('Purge All', 'litespeed-cache'),\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL, false, '_ori'),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-all-lscache',\n\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('LSCache', 'litespeed-cache'),\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LSCACHE, false, '_ori'),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-cssjs',\n\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('CSS\/JS Cache', 'litespeed-cache'),\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_CSSJS, false, '_ori'),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\tif ($this->conf(self::O_CDN_CLOUDFLARE)) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-cloudflare',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Cloudflare', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_PURGE_ALL),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif (defined('LSCWP_OBJECT_CACHE')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-object',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Object Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_OBJECT, false, '_ori'),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif (Router::opcache_enabled()) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-opcache',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Opcode Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_OPCACHE, false, '_ori'),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('ccss')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-ccss',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - CCSS',\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_CCSS, false, '_ori'),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('ucss')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-ucss',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - UCSS',\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_UCSS, false, '_ori'),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('localres')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-localres',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Localized Resources', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LOCALRES, false, '_ori'),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('lqip')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-placeholder',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('LQIP Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LQIP, false, '_ori'),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('avatar')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-avatar',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Gravatar Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_AVATAR, false, '_ori'),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tdo_action('litespeed_frontend_shortcut');\n\t}\n\n\t\/**\n\t * Hooked to wp_before_admin_bar_render.\n\t * Adds a link to the admin bar so users can quickly purge all.\n\t *\n\t * @access public\n\t * @global WP_Admin_Bar $wp_admin_bar\n\t * @since 1.7.2 Moved from admin_display.cls to gui.cls; Renamed from `add_quick_purge` to `backend_shortcut`\n\t *\/\n\tpublic function backend_shortcut() {\n\t\tglobal $wp_admin_bar;\n\n\t\tif (defined('LITESPEED_DISABLE_ALL') && LITESPEED_DISABLE_ALL) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'id' => 'litespeed-menu',\n\t\t\t\t'title' => '<span class=\"ab-icon icon_disabled\" title=\"LiteSpeed Cache\"><\/span>',\n\t\t\t\t'href' => 'admin.php?page=litespeed-toolbox#settings-debug',\n\t\t\t\t'meta' => array(\n\t\t\t\t\t'tabindex' => 0,\n\t\t\t\t\t'class' => 'litespeed-top-toolbar',\n\t\t\t\t),\n\t\t\t));\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-enable_all',\n\t\t\t\t'title' => __('Enable All Features', 'litespeed-cache'),\n\t\t\t\t'href' => 'admin.php?page=litespeed-toolbox#settings-debug',\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ if ( defined( 'LITESPEED_ON' ) ) {\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'id' => 'litespeed-menu',\n\t\t\t'title' => '<span class=\"ab-icon\" title=\"' . __('LiteSpeed Cache Purge All', 'litespeed-cache') . ' - ' . __('LSCache', 'litespeed-cache') . '\"><\/span>',\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LSCACHE),\n\t\t\t'meta' => array(\n\t\t\t\t'tabindex' => 0,\n\t\t\t\t'class' => 'litespeed-top-toolbar',\n\t\t\t),\n\t\t));\n\t\t\/\/ }\n\t\t\/\/ else {\n\t\t\/\/ $wp_admin_bar->add_menu( array(\n\t\t\/\/ 'id'    => 'litespeed-menu',\n\t\t\/\/ 'title' => '<span class=\"ab-icon\" title=\"' . __( 'LiteSpeed Cache', 'litespeed-cache' ) . '\"><\/span>',\n\t\t\/\/ 'meta'  => array( 'tabindex' => 0, 'class' => 'litespeed-top-toolbar' ),\n\t\t\/\/ ) );\n\t\t\/\/ }\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-bar-manage',\n\t\t\t'title' => __('Manage', 'litespeed-cache'),\n\t\t\t'href' => 'admin.php?page=litespeed',\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-bar-setting',\n\t\t\t'title' => __('Settings', 'litespeed-cache'),\n\t\t\t'href' => 'admin.php?page=litespeed-cache',\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\tif (!is_network_admin()) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-bar-imgoptm',\n\t\t\t\t'title' => __('Image Optimization', 'litespeed-cache'),\n\t\t\t\t'href' => 'admin.php?page=litespeed-img_optm',\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-all',\n\t\t\t'title' => __('Purge All', 'litespeed-cache'),\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-all-lscache',\n\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('LSCache', 'litespeed-cache'),\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LSCACHE),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\t$wp_admin_bar->add_menu(array(\n\t\t\t'parent' => 'litespeed-menu',\n\t\t\t'id' => 'litespeed-purge-cssjs',\n\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('CSS\/JS Cache', 'litespeed-cache'),\n\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_CSSJS),\n\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t));\n\n\t\tif ($this->conf(self::O_CDN_CLOUDFLARE)) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-cloudflare',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Cloudflare', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_PURGE_ALL),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif (defined('LSCWP_OBJECT_CACHE')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-object',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Object Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_OBJECT),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif (Router::opcache_enabled()) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-opcache',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Opcode Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_OPCACHE),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('ccss')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-ccss',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - CCSS',\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_CCSS),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('ucss')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-ucss',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - UCSS',\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_UCSS),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('localres')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-localres',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Localized Resources', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LOCALRES),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('lqip')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-placeholder',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('LQIP Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_LQIP),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tif ($this->has_cache_folder('avatar')) {\n\t\t\t$wp_admin_bar->add_menu(array(\n\t\t\t\t'parent' => 'litespeed-menu',\n\t\t\t\t'id' => 'litespeed-purge-avatar',\n\t\t\t\t'title' => __('Purge All', 'litespeed-cache') . ' - ' . __('Gravatar Cache', 'litespeed-cache'),\n\t\t\t\t'href' => Utility::build_url(Router::ACTION_PURGE, Purge::TYPE_PURGE_ALL_AVATAR),\n\t\t\t\t'meta' => array( 'tabindex' => '0' ),\n\t\t\t));\n\t\t}\n\n\t\tdo_action('litespeed_backend_shortcut');\n\t}\n\n\t\/**\n\t * Clear unfinished data\n\t *\n\t * @since  2.4.2\n\t * @access public\n\t *\/\n\tpublic static function img_optm_clean_up( $unfinished_num ) {\n\t\treturn sprintf(\n\t\t\t'<a href=\"%1$s\" class=\"button litespeed-btn-warning\" data-balloon-pos=\"up\" aria-label=\"%2$s\"><span class=\"dashicons dashicons-editor-removeformatting\"><\/span>&nbsp;%3$s<\/a>',\n\t\t\tUtility::build_url(Router::ACTION_IMG_OPTM, Img_Optm::TYPE_CLEAN),\n\t\t\t__('Remove all previous unfinished image optimization requests.', 'litespeed-cache'),\n\t\t\t__('Clean Up Unfinished Data', 'litespeed-cache') . ($unfinished_num ? ': ' . Admin_Display::print_plural($unfinished_num, 'image') : '')\n\t\t);\n\t}\n\n\t\/**\n\t * Generate install link\n\t *\n\t * @since  2.4.2\n\t * @access public\n\t *\/\n\tpublic static function plugin_install_link( $title, $name, $v ) {\n\t\t$url = wp_nonce_url(self_admin_url('update.php?action=install-plugin&plugin=' . $name), 'install-plugin_' . $name);\n\n\t\t$action = sprintf(\n\t\t\t'<a href=\"%1$s\" class=\"install-now\" data-slug=\"%2$s\" data-name=\"%3$s\" aria-label=\"%4$s\">%5$s<\/a>',\n\t\t\tesc_url($url),\n\t\t\tesc_attr($name),\n\t\t\tesc_attr($title),\n\t\t\tesc_attr(sprintf(__('Install %s', 'litespeed-cache'), $title)),\n\t\t\t__('Install Now', 'litespeed-cache')\n\t\t);\n\n\t\treturn $action;\n\n\t\t\/\/ $msg .= \" <a href='$upgrade_link' class='litespeed-btn-success' target='_blank'>\" . __( 'Click here to upgrade', 'litespeed-cache' ) . '<\/a>';\n\t}\n\n\t\/**\n\t * Generate upgrade link\n\t *\n\t * @since  2.4.2\n\t * @access public\n\t *\/\n\tpublic static function plugin_upgrade_link( $title, $name, $v ) {\n\t\t$details_url = self_admin_url('plugin-install.php?tab=plugin-information&plugin=' . $name . '&section=changelog&TB_iframe=true&width=600&height=800');\n\t\t$file        = $name . '\/' . $name . '.php';\n\n\t\t$msg = sprintf(\n\t\t\t__('<a href=\"%1$s\" %2$s>View version %3$s details<\/a> or <a href=\"%4$s\" %5$s target=\"_blank\">update now<\/a>.', 'litespeed-cache'),\n\t\t\tesc_url($details_url),\n\t\t\tsprintf('class=\"thickbox open-plugin-details-modal\" aria-label=\"%s\"', esc_attr(sprintf(__('View %1$s version %2$s details', 'litespeed-cache'), $title, $v))),\n\t\t\t$v,\n\t\t\twp_nonce_url(self_admin_url('update.php?action=upgrade-plugin&plugin=') . $file, 'upgrade-plugin_' . $file),\n\t\t\tsprintf('class=\"update-link\" aria-label=\"%s\"', esc_attr(sprintf(__('Update %s now', 'litespeed-cache'), $title)))\n\t\t);\n\n\t\treturn $msg;\n\t}\n\n\t\/**\n\t * Finalize buffer by GUI class\n\t *\n\t * @since  1.6\n\t * @access public\n\t *\/\n\tpublic function finalize( $buffer ) {\n\t\t$buffer = $this->_clean_wrapper($buffer);\n\n\t\t\/\/ Maybe restore doc.ref\n\t\tif ($this->conf(Base::O_GUEST) && strpos($buffer, '<head>') !== false && defined('LITESPEED_IS_HTML')) {\n\t\t\t$buffer = $this->_enqueue_guest_docref_js($buffer);\n\t\t}\n\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST && strpos($buffer, '<\/body>') !== false && defined('LITESPEED_IS_HTML')) {\n\t\t\t$buffer = $this->_enqueue_guest_js($buffer);\n\t\t}\n\n\t\treturn $buffer;\n\t}\n\n\t\/**\n\t * Append guest restore doc.ref JS for organic traffic count\n\t *\n\t * @since  4.4.6\n\t *\/\n\tprivate function _enqueue_guest_docref_js( $buffer ) {\n\t\t$js_con = File::read(LSCWP_DIR . self::LIB_GUEST_DOCREF_JS);\n\t\t$buffer = preg_replace('\/<head>\/', '<head><script data-no-optimize=\"1\">' . $js_con . '<\/script>', $buffer, 1);\n\t\treturn $buffer;\n\t}\n\n\t\/**\n\t * Append guest JS to update vary\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _enqueue_guest_js( $buffer ) {\n\t\t$js_con = File::read(LSCWP_DIR . self::LIB_GUEST_JS);\n\t\t\/\/ $guest_update_url = add_query_arg( 'litespeed_guest', 1, home_url( '\/' ) );\n\t\t$guest_update_url = parse_url(LSWCP_PLUGIN_URL . self::PHP_GUEST, PHP_URL_PATH);\n\t\t$js_con           = str_replace('litespeed_url', esc_url($guest_update_url), $js_con);\n\t\t$buffer           = preg_replace('\/<\\\/body>\/', '<script data-no-optimize=\"1\">' . $js_con . '<\/script><\/body>', $buffer, 1);\n\t\treturn $buffer;\n\t}\n\n\t\/**\n\t * Clean wrapper from buffer\n\t *\n\t * @since  1.4\n\t * @since  1.6 converted to private with adding prefix _\n\t * @access private\n\t *\/\n\tprivate function _clean_wrapper( $buffer ) {\n\t\tif (self::$_clean_counter < 1) {\n\t\t\tDebug2::debug2('GUI bypassed by no counter');\n\t\t\treturn $buffer;\n\t\t}\n\n\t\tDebug2::debug2('GUI start cleaning counter ' . self::$_clean_counter);\n\n\t\tfor ($i = 1; $i <= self::$_clean_counter; $i++) {\n\t\t\t\/\/ If miss beginning\n\t\t\t$start = strpos($buffer, self::clean_wrapper_begin($i));\n\t\t\tif ($start === false) {\n\t\t\t\t$buffer = str_replace(self::clean_wrapper_end($i), '', $buffer);\n\t\t\t\tDebug2::debug2(\"GUI lost beginning wrapper $i\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ If miss end\n\t\t\t$end_wrapper = self::clean_wrapper_end($i);\n\t\t\t$end         = strpos($buffer, $end_wrapper);\n\t\t\tif ($end === false) {\n\t\t\t\t$buffer = str_replace(self::clean_wrapper_begin($i), '', $buffer);\n\t\t\t\tDebug2::debug2(\"GUI lost ending wrapper $i\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Now replace wrapped content\n\t\t\t$buffer = substr_replace($buffer, '', $start, $end - $start + strlen($end_wrapper));\n\t\t\tDebug2::debug2(\"GUI cleaned wrapper $i\");\n\t\t}\n\n\t\treturn $buffer;\n\t}\n\n\t\/**\n\t * Display a to-be-removed html wrapper\n\t *\n\t * @since  1.4\n\t * @access public\n\t *\/\n\tpublic static function clean_wrapper_begin( $counter = false ) {\n\t\tif ($counter === false) {\n\t\t\t++self::$_clean_counter;\n\t\t\t$counter = self::$_clean_counter;\n\t\t\tDebug2::debug(\"GUI clean wrapper $counter begin\");\n\t\t}\n\t\treturn '<!-- LiteSpeed To Be Removed begin ' . $counter . ' -->';\n\t}\n\n\t\/**\n\t * Display a to-be-removed html wrapper\n\t *\n\t * @since  1.4\n\t * @access public\n\t *\/\n\tpublic static function clean_wrapper_end( $counter = false ) {\n\t\tif ($counter === false) {\n\t\t\t$counter = self::$_clean_counter;\n\t\t\tDebug2::debug(\"GUI clean wrapper $counter end\");\n\t\t}\n\t\treturn '<!-- LiteSpeed To Be Removed end ' . $counter . ' -->';\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/admin.cls.php","ext":"php","size":5167,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The admin-panel specific functionality of the plugin.\n *\n * @since      1.0.0\n * @package    LiteSpeed_Cache\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Admin\n *\n * Wires admin-side hooks, actions, and safe redirects.\n *\/\nclass Admin extends Root {\n\n\tconst LOG_TAG = '\ud83d\udc6e';\n\n\tconst PAGE_EDIT_HTACCESS = 'litespeed-edit-htaccess';\n\n\t\/**\n\t * Initialize the class and set its properties.\n\t * Runs in hook `after_setup_theme` when is_admin().\n\t *\n\t * @since 1.0.0\n\t *\/\n\tpublic function __construct() {\n\t\t\/\/ Define LSCWP_MU_PLUGIN if in mu-plugins.\n\t\tif ( defined( 'WPMU_PLUGIN_DIR' ) && dirname( LSCWP_DIR ) === WPMU_PLUGIN_DIR && ! defined( 'LSCWP_MU_PLUGIN' ) ) {\n\t\t\tdefine( 'LSCWP_MU_PLUGIN', true );\n\t\t}\n\n\t\tself::debug( 'No cache due to Admin page' );\n\n\t\tif ( ! defined( 'DONOTCACHEPAGE' ) ) {\n\t\t\tdefine( 'DONOTCACHEPAGE', true );\n\t\t}\n\n\t\t\/\/ Additional LiteSpeed assets on admin display (also registers menus).\n\t\t$this->cls( 'Admin_Display' );\n\n\t\t\/\/ Initialize admin actions.\n\t\tadd_action( 'admin_init', array( $this, 'admin_init' ) );\n\n\t\t\/\/ Add link to plugin list page.\n\t\tadd_filter(\n\t\t\t'plugin_action_links_' . LSCWP_BASENAME,\n\t\t\tarray( $this->cls( 'Admin_Display' ), 'add_plugin_links' )\n\t\t);\n\t}\n\n\t\/**\n\t * Callback that initializes the admin options for LiteSpeed Cache.\n\t *\n\t * @since 1.0.0\n\t * @return void\n\t *\/\n\tpublic function admin_init() {\n\t\t\/\/ Hook attachment upload auto optimization.\n\t\tif ( $this->conf( Base::O_IMG_OPTM_AUTO ) ) {\n\t\t\tadd_filter( 'wp_update_attachment_metadata', array( $this, 'wp_update_attachment_metadata' ), 9999, 2 );\n\t\t}\n\n\t\t$this->_proceed_admin_action();\n\n\t\t\/\/ Terminate if user doesn't have access to settings.\n\t\t$capability = is_network_admin() ? 'manage_network_options' : 'manage_options';\n\t\tif ( ! current_user_can( $capability ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Add privacy policy (since 2.2.6).\n\t\tif ( function_exists( 'wp_add_privacy_policy_content' ) ) {\n\t\t\twp_add_privacy_policy_content( Core::NAME, Doc::privacy_policy() );\n\t\t}\n\n\t\t$this->cls( 'Media' )->after_admin_init();\n\n\t\tdo_action( 'litespeed_after_admin_init' );\n\n\t\tif ( $this->cls( 'Router' )->esi_enabled() ) {\n\t\t\tadd_action( 'in_widget_form', array( $this->cls( 'Admin_Display' ), 'show_widget_edit' ), 100, 3 );\n\t\t\tadd_filter( 'widget_update_callback', __NAMESPACE__ . '\\Admin_Settings::validate_widget_save', 10, 4 );\n\t\t}\n\t}\n\n\t\/**\n\t * Handle attachment metadata update.\n\t *\n\t * @since 4.0\n\t *\n\t * @param array $data    Attachment meta.\n\t * @param int   $post_id Attachment ID.\n\t * @return array Filtered meta.\n\t *\/\n\tpublic function wp_update_attachment_metadata( $data, $post_id ) {\n\t\t$this->cls( 'Img_Optm' )->wp_update_attachment_metadata( $data, $post_id );\n\t\treturn $data;\n\t}\n\n\t\/**\n\t * Run LiteSpeed admin actions routed via Router.\n\t *\n\t * @since 1.1.0\n\t * @return void\n\t *\/\n\tprivate function _proceed_admin_action() {\n\t\t$action = Router::get_action();\n\n\t\tswitch ( $action ) {\n\t\t\tcase Router::ACTION_SAVE_SETTINGS:\n\t\t\t\t$this->cls( 'Admin_Settings' )->save( wp_unslash( $_POST ) ); \/\/ phpcs:ignore WordPress.Security.NonceVerification.Missing\n\t\t\t\tbreak;\n\n\t\t\tcase Router::ACTION_SAVE_SETTINGS_NETWORK:\n\t\t\t\t$this->cls( 'Admin_Settings' )->network_save( wp_unslash( $_POST ) ); \/\/ phpcs:ignore WordPress.Security.NonceVerification.Missing\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t\/**\n\t * Clean up the input (array or scalar) of any extra slashes\/spaces.\n\t *\n\t * @since 1.0.4\n\t *\n\t * @param mixed $input The input value to clean.\n\t * @return mixed Cleaned value.\n\t *\/\n\tpublic static function cleanup_text( $input ) {\n\t\tif ( is_array( $input ) ) {\n\t\t\treturn array_map( __CLASS__ . '::cleanup_text', $input );\n\t\t}\n\n\t\treturn stripslashes(trim($input));\n\t}\n\n\t\/**\n\t * After a LSCWP_CTRL action, redirect back to same page\n\t * without nonce and action in the query string.\n\t *\n\t * If the redirect URL cannot be determined, redirects to the homepage.\n\t *\n\t * @since 1.0.12\n\t *\n\t * @param string|false $url Optional destination URL.\n\t * @return void\n\t *\/\n\tpublic static function redirect( $url = false ) {\n\t\tglobal $pagenow;\n\n\t\t\/\/ If originated, go back to referrer or home.\n\t\tif ( ! empty( $_GET['_litespeed_ori'] ) ) { \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\t\t$ref = wp_get_referer();\n\t\t\twp_safe_redirect( $ref ? $ref : get_home_url() );\n\t\t\texit;\n\t\t}\n\n\t\tif ( ! $url ) {\n\t\t\t$clean = [];\n\n\t\t\t\/\/ Sanitize current query args while removing our internals.\n\t\t\tif ( ! empty( $_GET ) ) { \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\t\t\tforeach ( $_GET as $k => $v ) { \/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\t\t\t\tif ( in_array( $k, array( Router::ACTION, Router::NONCE, Router::TYPE, 'litespeed_i' ), true ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t\/\/ Normalize to string for URL building.\n\t\t\t\t\t$clean[ $k ] = is_array( $v ) ? array_map( 'sanitize_text_field', wp_unslash( $v ) ) : sanitize_text_field( wp_unslash( $v ) );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$qs = '';\n\t\t\tif ( ! empty( $clean ) ) {\n\t\t\t\t$qs = '?' . http_build_query( $clean );\n\t\t\t}\n\n\t\t\t$url = is_network_admin() ? network_admin_url( $pagenow . $qs ) : admin_url( $pagenow . $qs );\n\t\t}\n\n\t\twp_safe_redirect( $url );\n\t\texit;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/activation.cls.php","ext":"php","size":17855,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The plugin activation class.\n *\n * @since       1.1.0\n * @since       1.5 Moved into \/inc\n * @package     LiteSpeed\n * @subpackage  LiteSpeed\/inc\n * @author      LiteSpeed Technologies <info@litespeedtech.com>\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Activation\n *\n * Handles plugin activation, deactivation, and related file management.\n *\n * @since 1.1.0\n *\/\nclass Activation extends Base {\n\n\tconst TYPE_UPGRADE             = 'upgrade';\n\tconst TYPE_INSTALL_3RD         = 'install_3rd';\n\tconst TYPE_INSTALL_ZIP         = 'install_zip';\n\tconst TYPE_DISMISS_RECOMMENDED = 'dismiss_recommended';\n\n\tconst NETWORK_TRANSIENT_COUNT = 'lscwp_network_count';\n\n\t\/**\n\t * Data file path for configuration.\n\t *\n\t * @since 4.1\n\t * @var string\n\t *\/\n\tprivate static $data_file;\n\n\t\/**\n\t * Construct\n\t *\n\t * Initializes the data file path.\n\t *\n\t * @since 4.1\n\t *\/\n\tpublic function __construct() {\n\t\tself::$data_file = LSCWP_CONTENT_DIR . '\/' . self::CONF_FILE;\n\t}\n\n\t\/**\n\t * The activation hook callback.\n\t *\n\t * Handles plugin activation tasks, including file creation and multisite setup.\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t *\/\n\tpublic static function register_activation() {\n\t\t$count = 0;\n\t\t! defined( 'LSCWP_LOG_TAG' ) && define( 'LSCWP_LOG_TAG', 'Activate_' . get_current_blog_id() );\n\n\t\t\/* Network file handler *\/\n\t\tif ( is_multisite() ) {\n\t\t\t$count = self::get_network_count();\n\t\t\tif ( false !== $count ) {\n\t\t\t\t$count = (int) $count + 1;\n\t\t\t\tset_site_transient( self::NETWORK_TRANSIENT_COUNT, $count, DAY_IN_SECONDS );\n\t\t\t}\n\n\t\t\tif ( ! is_network_admin() ) {\n\t\t\t\tif ( 1 === $count ) {\n\t\t\t\t\t\/\/ Only itself is activated, set .htaccess with only CacheLookUp\n\t\t\t\t\ttry {\n\t\t\t\t\t\tHtaccess::cls()->insert_ls_wrapper();\n\t\t\t\t\t} catch ( \\Exception $ex ) {\n\t\t\t\t\t\tAdmin_Display::error( $ex->getMessage() );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tself::cls()->update_files();\n\n\t\tif ( defined( 'LSCWP_REF' ) && 'whm' === LSCWP_REF ) {\n\t\t\tGUI::update_option( GUI::WHM_MSG, GUI::WHM_MSG_VAL );\n\t\t}\n\t}\n\n\t\/**\n\t * Uninstall plugin\n\t *\n\t * Removes all LiteSpeed Cache settings and data.\n\t *\n\t * @since 1.1.0\n\t * @since 7.3 Updated to remove all settings.\n\t * @access public\n\t *\/\n\tpublic static function uninstall_litespeed_cache() {\n\t\tTask::destroy();\n\n\t\tif ( is_multisite() ) {\n\t\t\t\/\/ Save main site id\n\t\t\t$current_blog = get_current_blog_id();\n\n\t\t\t\/\/ get all sites\n\t\t\t$sub_sites = get_sites();\n\n\t\t\t\/\/ clear foreach site\n\t\t\tforeach ( $sub_sites as $sub_site ) {\n\t\t\t\t$sub_blog_id = (int) $sub_site->blog_id;\n\t\t\t\tif ( $sub_blog_id !== $current_blog ) {\n\t\t\t\t\t\/\/ Switch to blog\n\t\t\t\t\tswitch_to_blog( $sub_blog_id );\n\n\t\t\t\t\t\/\/ Delete site options\n\t\t\t\t\tself::delete_settings();\n\n\t\t\t\t\t\/\/ Delete site tables\n\t\t\t\t\tData::cls()->tables_del();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\/\/ Return to main site\n\t\t\tswitch_to_blog( $current_blog );\n\t\t}\n\n\t\t\/\/ Delete current blog\/site\n\t\t\/\/ Delete options\n\t\tself::delete_settings();\n\n\t\t\/\/ Delete site tables\n\t\tData::cls()->tables_del();\n\n\t\tif ( file_exists( LITESPEED_STATIC_DIR ) ) {\n\t\t\tFile::rrmdir( LITESPEED_STATIC_DIR );\n\t\t}\n\n\t\tCloud::version_check( 'uninstall' );\n\t}\n\n\t\/**\n\t * Remove all litespeed settings.\n\t *\n\t * Deletes all LiteSpeed Cache options from the database.\n\t *\n\t * @since 7.3\n\t * @access private\n\t *\/\n\tprivate static function delete_settings() {\n\t\tglobal $wpdb;\n\n\t\t\/\/ phpcs:ignore WordPress.DB.DirectDatabaseQuery\n\t\t$wpdb->query($wpdb->prepare(\"DELETE FROM `$wpdb->options` WHERE option_name LIKE %s\", 'litespeed.%'));\n\t}\n\n\t\/**\n\t * Get the blog ids for the network. Accepts function arguments.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t * @param array $args Arguments for get_sites().\n\t * @return array The array of blog ids.\n\t *\/\n\tpublic static function get_network_ids( $args = array() ) {\n\t\t$args['fields'] = 'ids';\n\t\t$blogs          = get_sites( $args );\n\n\t\treturn $blogs;\n\t}\n\n\t\/**\n\t * Gets the count of active litespeed cache plugins on multisite.\n\t *\n\t * @since 1.0.12\n\t * @access private\n\t * @return int|false Number of active LSCWP or false if none.\n\t *\/\n\tprivate static function get_network_count() {\n\t\t$count = get_site_transient( self::NETWORK_TRANSIENT_COUNT );\n\t\tif ( false !== $count ) {\n\t\t\treturn (int) $count;\n\t\t}\n\t\t\/\/ need to update\n\t\t$default = array();\n\t\t$count   = 0;\n\n\t\t$sites = self::get_network_ids( array( 'deleted' => 0 ) );\n\t\tif ( empty( $sites ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tforeach ( $sites as $site ) {\n\t\t\t$bid     = is_object( $site ) && property_exists( $site, 'blog_id' ) ? $site->blog_id : $site;\n\t\t\t$plugins = get_blog_option( $bid, 'active_plugins', $default );\n\t\t\tif ( ! empty( $plugins ) && in_array( LSCWP_BASENAME, $plugins, true ) ) {\n\t\t\t\t++$count;\n\t\t\t}\n\t\t}\n\n\t\t\/**\n\t\t * In case this is called outside the admin page\n\t\t *\n\t\t * @see  https:\/\/codex.wordpress.org\/Function_Reference\/is_plugin_active_for_network\n\t\t * @since  2.0\n\t\t *\/\n\t\tif ( ! function_exists( 'is_plugin_active_for_network' ) ) {\n\t\t\trequire_once ABSPATH . '\/wp-admin\/includes\/plugin.php';\n\t\t}\n\n\t\tif ( is_plugin_active_for_network( LSCWP_BASENAME ) ) {\n\t\t\t++$count;\n\t\t}\n\t\treturn $count;\n\t}\n\n\t\/**\n\t * Is this deactivate call the last active installation on the multisite network?\n\t *\n\t * @since 1.0.12\n\t * @access private\n\t *\/\n\tprivate static function is_deactivate_last() {\n\t\t$count = self::get_network_count();\n\t\tif ( false === $count ) {\n\t\t\treturn false;\n\t\t}\n\t\tif ( 1 !== $count ) {\n\t\t\t\/\/ Not deactivating the last one.\n\t\t\t--$count;\n\t\t\tset_site_transient( self::NETWORK_TRANSIENT_COUNT, $count, DAY_IN_SECONDS );\n\t\t\treturn false;\n\t\t}\n\n\t\tdelete_site_transient( self::NETWORK_TRANSIENT_COUNT );\n\t\treturn true;\n\t}\n\n\t\/**\n\t * The deactivation hook callback.\n\t *\n\t * Initializes all clean up functionalities.\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t *\/\n\tpublic static function register_deactivation() {\n\t\tTask::destroy();\n\n\t\t! defined( 'LSCWP_LOG_TAG' ) && define( 'LSCWP_LOG_TAG', 'Deactivate_' . get_current_blog_id() );\n\n\t\tPurge::purge_all();\n\n\t\tif ( is_multisite() ) {\n\t\t\tif ( ! self::is_deactivate_last() ) {\n\t\t\t\tif ( is_network_admin() ) {\n\t\t\t\t\t\/\/ Still other activated subsite left, set .htaccess with only CacheLookUp\n\t\t\t\t\ttry {\n\t\t\t\t\t\tHtaccess::cls()->insert_ls_wrapper();\n\t\t\t\t\t} catch ( \\Exception $ex ) {\n\t\t\t\t\t\tAdmin_Display::error($ex->getMessage());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t\/* 1) wp-config.php; *\/\n\n\t\ttry {\n\t\t\tself::cls()->manage_wp_cache_const( false );\n\t\t} catch ( \\Exception $ex ) {\n\t\t\t\/\/ phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.PHP.DevelopmentFunctions.error_log_error_log\n\t\t\terror_log( 'In wp-config.php: WP_CACHE could not be set to false during deactivation!' );\n\n\t\t\tAdmin_Display::error( $ex->getMessage() );\n\t\t}\n\n\t\t\/* 2) adv-cache.php; Dropped in v3.0.4 *\/\n\n\t\t\/* 3) object-cache.php; *\/\n\n\t\tObject_Cache::cls()->del_file();\n\n\t\t\/* 4) .htaccess; *\/\n\n\t\ttry {\n\t\t\tHtaccess::cls()->clear_rules();\n\t\t} catch ( \\Exception $ex ) {\n\t\t\tAdmin_Display::error( $ex->getMessage() );\n\t\t}\n\n\t\t\/* 5) .litespeed_conf.dat; *\/\n\n\t\tself::del_conf_data_file();\n\n\t\t\/* 6) delete option lscwp_whm_install *\/\n\n\t\t\/\/ delete in case it's not deleted prior to deactivation.\n\t\tGUI::dismiss_whm();\n\t}\n\n\t\/**\n\t * Manage related files based on plugin latest conf\n\t *\n\t * Handle files:\n\t *      1) wp-config.php;\n\t *      2) adv-cache.php;\n\t *      3) object-cache.php;\n\t *      4) .htaccess;\n\t *      5) .litespeed_conf.dat;\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function update_files() {\n\t\tDebug2::debug( '\ud83d\uddc2\ufe0f [Activation] update_files' );\n\n\t\t\/\/ Update cache setting `_CACHE`\n\t\t$this->cls( 'Conf' )->define_cache();\n\n\t\t\/\/ Site options applied already\n\t\t$options = $this->get_options();\n\n\t\t\/* 1) wp-config.php; *\/\n\n\t\ttry {\n\t\t\t$this->manage_wp_cache_const( $options[ self::_CACHE ] );\n\t\t} catch ( \\Exception $ex ) {\n\t\t\t\/\/ Add msg to admin page or CLI\n\t\t\tAdmin_Display::error( wp_kses_post( $ex->getMessage() ) );\n\t\t}\n\n\t\t\/* 2) adv-cache.php; Dropped in v3.0.4 *\/\n\n\t\t\/* 3) object-cache.php; *\/\n\n\t\tif ( $options[ self::O_OBJECT ] && ( ! $options[ self::O_DEBUG_DISABLE_ALL ] || is_multisite() ) ) {\n\t\t\t$this->cls( 'Object_Cache' )->update_file( $options );\n\t\t} else {\n\t\t\t$this->cls( 'Object_Cache' )->del_file(); \/\/ Note: because it doesn't reconnect, which caused setting page OC option changes delayed, thus may meet Connect Test Failed issue (Next refresh will correct it). Not a big deal, will keep as is.\n\t\t}\n\n\t\t\/* 4) .htaccess; *\/\n\n\t\ttry {\n\t\t\t$this->cls( 'Htaccess' )->update( $options );\n\t\t} catch ( \\Exception $ex ) {\n\t\t\tAdmin_Display::error( wp_kses_post( $ex->getMessage() ) );\n\t\t}\n\n\t\t\/* 5) .litespeed_conf.dat; *\/\n\n\t\tif ( ( $options[ self::O_GUEST ] || $options[ self::O_OBJECT ] ) && ( ! $options[ self::O_DEBUG_DISABLE_ALL ] || is_multisite() ) ) {\n\t\t\t$this->update_conf_data_file( $options );\n\t\t}\n\t}\n\n\t\/**\n\t * Delete data conf file\n\t *\n\t * Removes the .litespeed_conf.dat file.\n\t *\n\t * @since  4.1\n\t * @access private\n\t *\/\n\tprivate static function del_conf_data_file() {\n\t\tglobal $wp_filesystem;\n\n\t\tif ( ! $wp_filesystem ) {\n\t\t\trequire_once ABSPATH . 'wp-admin\/includes\/file.php';\n\t\t\tWP_Filesystem();\n\t\t}\n\n\t\tif ( $wp_filesystem->exists( self::$data_file ) ) {\n\t\t\t$wp_filesystem->delete( self::$data_file );\n\t\t}\n\t}\n\n\t\/**\n\t * Update data conf file for guest mode & object cache\n\t *\n\t * Updates the .litespeed_conf.dat file with relevant settings.\n\t *\n\t * @since  4.1\n\t * @access private\n\t * @param array $options Plugin options.\n\t *\/\n\tprivate function update_conf_data_file( $options ) {\n\t\t$ids = array();\n\t\tif ( $options[ self::O_OBJECT ] ) {\n\t\t\t$this_ids = array(\n\t\t\t\tself::O_DEBUG,\n\t\t\t\tself::O_OBJECT_KIND,\n\t\t\t\tself::O_OBJECT_HOST,\n\t\t\t\tself::O_OBJECT_PORT,\n\t\t\t\tself::O_OBJECT_LIFE,\n\t\t\t\tself::O_OBJECT_USER,\n\t\t\t\tself::O_OBJECT_PSWD,\n\t\t\t\tself::O_OBJECT_DB_ID,\n\t\t\t\tself::O_OBJECT_PERSISTENT,\n\t\t\t\tself::O_OBJECT_ADMIN,\n\t\t\t\tself::O_OBJECT_TRANSIENTS,\n\t\t\t\tself::O_OBJECT_GLOBAL_GROUPS,\n\t\t\t\tself::O_OBJECT_NON_PERSISTENT_GROUPS,\n\t\t\t);\n\t\t\t$ids      = array_merge( $ids, $this_ids );\n\t\t}\n\n\t\tif ( $options[ self::O_GUEST ] ) {\n\t\t\t$this_ids = array(\n\t\t\t\tself::HASH,\n\t\t\t\tself::O_CACHE_LOGIN_COOKIE,\n\t\t\t\tself::O_DEBUG_IPS,\n\t\t\t\tself::O_UTIL_NO_HTTPS_VARY,\n\t\t\t\tself::O_GUEST_UAS,\n\t\t\t\tself::O_GUEST_IPS,\n\t\t\t);\n\t\t\t$ids      = array_merge( $ids, $this_ids );\n\t\t}\n\n\t\t$data = array();\n\t\tforeach ( $ids as $v ) {\n\t\t\t$data[ $v ] = $options[ $v ];\n\t\t}\n\t\t$data = wp_json_encode( $data );\n\n\t\t$old_data = File::read( self::$data_file );\n\t\tif ( $old_data !== $data ) {\n\t\t\tdefined( 'LSCWP_LOG' ) && Debug2::debug( '[Activation] Updating .litespeed_conf.dat' );\n\t\t\tFile::save( self::$data_file, $data );\n\t\t}\n\t}\n\n\t\/**\n\t * Update the WP_CACHE variable in the wp-config.php file.\n\t *\n\t * If enabling, check if the variable is defined, and if not, define it.\n\t * Vice versa for disabling.\n\t *\n\t * @since 1.0.0\n\t * @since  3.0 Refactored\n\t * @param bool $enable Whether to enable WP_CACHE.\n\t * @throws \\Exception If wp-config.php cannot be modified.\n\t * @return bool True if updated, false if no change needed.\n\t *\/\n\tpublic function manage_wp_cache_const( $enable ) {\n\t\tif ( $enable ) {\n\t\t\tif ( defined( 'WP_CACHE' ) && WP_CACHE ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} elseif ( ! defined( 'WP_CACHE' ) || ( defined( 'WP_CACHE' ) && ! WP_CACHE ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( apply_filters( 'litespeed_wpconfig_readonly', false ) ) {\n\t\t\tthrow new \\Exception( 'wp-config file is forbidden to modify due to API hook: litespeed_wpconfig_readonly' );\n\t\t}\n\n\t\t\/**\n\t\t * Follow WP's logic to locate wp-config file\n\t\t *\n\t\t * @see wp-load.php\n\t\t *\/\n\t\t$conf_file = ABSPATH . 'wp-config.php';\n\t\tif ( ! file_exists( $conf_file ) ) {\n\t\t\t$conf_file = dirname( ABSPATH ) . '\/wp-config.php';\n\t\t}\n\n\t\t$content = File::read( $conf_file );\n\t\tif ( ! $content ) {\n\t\t\tthrow new \\Exception( 'wp-config file content is empty: ' . wp_kses_post( $conf_file ) );\n\t\t}\n\n\t\t\/\/ Remove the line `define('WP_CACHE', true\/false);` first\n\t\tif ( defined( 'WP_CACHE' ) ) {\n\t\t\t$content = preg_replace( '\/define\\(\\s*([\\'\"])WP_CACHE\\1\\s*,\\s*\\w+\\s*\\)\\s*;\/sU', '', $content );\n\t\t}\n\n\t\t\/\/ Insert const\n\t\tif ( $enable ) {\n\t\t\t$content = preg_replace( '\/^<\\?php\/', \"<?php\\ndefine( 'WP_CACHE', true );\", $content );\n\t\t}\n\n\t\t$res = File::save( $conf_file, $content, false, false, false );\n\n\t\tif ( true !== $res ) {\n\t\t\tthrow new \\Exception( 'wp-config.php operation failed when changing `WP_CACHE` const: ' . wp_kses_post( $res ) );\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Handle auto update\n\t *\n\t * Enables auto-updates for the plugin if configured.\n\t *\n\t * @since 2.7.2\n\t * @access public\n\t *\/\n\tpublic function auto_update() {\n\t\tif ( ! $this->conf( Base::O_AUTO_UPGRADE ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter( 'auto_update_plugin', array( $this, 'auto_update_hook' ), 10, 2 );\n\t}\n\n\t\/**\n\t * Auto upgrade hook\n\t *\n\t * Determines whether to auto-update the plugin.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param bool   $update Whether to update.\n\t * @param object $item   Plugin data.\n\t * @return bool Whether to update.\n\t *\/\n\tpublic function auto_update_hook( $update, $item ) {\n\t\tif ( ! empty( $item->slug ) && 'litespeed-cache' === $item->slug ) {\n\t\t\t$auto_v = Cloud::version_check( 'auto_update_plugin' );\n\n\t\t\tif ( ! empty( $auto_v['latest'] ) && ! empty( $item->new_version ) && $auto_v['latest'] === $item->new_version ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn $update; \/\/ Else, use the normal API response to decide whether to update or not\n\t}\n\n\t\/**\n\t * Upgrade LSCWP\n\t *\n\t * Upgrades the LiteSpeed Cache plugin.\n\t *\n\t * @since 2.9\n\t * @access public\n\t *\/\n\tpublic function upgrade() {\n\t\t$plugin = Core::PLUGIN_FILE;\n\n\t\t\/**\n\t\t * Load upgrade cls\n\t\t *\n\t\t * @see wp-admin\/update.php\n\t\t *\/\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/class-wp-upgrader.php';\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/file.php';\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/misc.php';\n\n\t\ttry {\n\t\t\tob_start();\n\t\t\t$skin     = new \\WP_Ajax_Upgrader_Skin();\n\t\t\t$upgrader = new \\Plugin_Upgrader( $skin );\n\t\t\t$result   = $upgrader->upgrade( $plugin );\n\t\t\tif ( ! is_plugin_active( $plugin ) ) {\n\t\t\t\t\/\/ todo: upgrade should reactivate the plugin again by WP. Need to check why disabled after upgraded.\n\t\t\t\tactivate_plugin( $plugin, '', is_multisite() );\n\t\t\t}\n\t\t\tob_end_clean();\n\t\t} catch ( \\Exception $e ) {\n\t\t\tAdmin_Display::error( __( 'Failed to upgrade.', 'litespeed-cache' ) );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( is_wp_error( $result ) ) {\n\t\t\tAdmin_Display::error( __( 'Failed to upgrade.', 'litespeed-cache' ) );\n\t\t\treturn;\n\t\t}\n\n\t\tAdmin_Display::success( __( 'Upgraded successfully.', 'litespeed-cache' ) );\n\t}\n\n\t\/**\n\t * Detect if the plugin is active or not\n\t *\n\t * @since  1.0\n\t * @access public\n\t * @param string $plugin Plugin slug.\n\t * @return bool True if active, false otherwise.\n\t *\/\n\tpublic function dash_notifier_is_plugin_active( $plugin ) {\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/plugin.php';\n\n\t\t$plugin_path = $plugin . '\/' . $plugin . '.php';\n\n\t\treturn is_plugin_active( $plugin_path );\n\t}\n\n\t\/**\n\t * Detect if the plugin is installed or not\n\t *\n\t * @since  1.0\n\t * @access public\n\t * @param string $plugin Plugin slug.\n\t * @return bool True if installed, false otherwise.\n\t *\/\n\tpublic function dash_notifier_is_plugin_installed( $plugin ) {\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/plugin.php';\n\n\t\t$plugin_path = $plugin . '\/' . $plugin . '.php';\n\n\t\t$valid = validate_plugin( $plugin_path );\n\n\t\treturn ! is_wp_error( $valid );\n\t}\n\n\t\/**\n\t * Grab a plugin info from WordPress\n\t *\n\t * @since  1.0\n\t * @access public\n\t * @param string $slug Plugin slug.\n\t * @return object|false Plugin info or false on failure.\n\t *\/\n\tpublic function dash_notifier_get_plugin_info( $slug ) {\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/plugin-install.php';\n\t\t$result = plugins_api( 'plugin_information', array( 'slug' => $slug ) );\n\n\t\tif ( is_wp_error( $result ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $result;\n\t}\n\n\t\/**\n\t * Install the 3rd party plugin\n\t *\n\t * Installs and activates a third-party plugin.\n\t *\n\t * @since  1.0\n\t * @access public\n\t *\/\n\tpublic function dash_notifier_install_3rd() {\n\t\t! defined( 'SILENCE_INSTALL' ) && define( 'SILENCE_INSTALL', true );\n\n\t\t\/\/ phpcs:ignore\n\t\t$slug = ! empty( $_GET['plugin'] ) ? wp_unslash( sanitize_text_field( $_GET['plugin'] ) ) : false;\n\n\t\t\/\/ Check if plugin is installed already\n\t\tif ( ! $slug || $this->dash_notifier_is_plugin_active( $slug ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/**\n\t\t * Load upgrade cls\n\t\t *\n\t\t * @see wp-admin\/update.php\n\t\t *\/\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/class-wp-upgrader.php';\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/file.php';\n\t\tinclude_once ABSPATH . 'wp-admin\/includes\/misc.php';\n\n\t\t$plugin_path = $slug . '\/' . $slug . '.php';\n\n\t\tif ( ! $this->dash_notifier_is_plugin_installed( $slug ) ) {\n\t\t\t$plugin_info = $this->dash_notifier_get_plugin_info( $slug );\n\t\t\tif ( ! $plugin_info ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\/\/ Try to install plugin\n\t\t\ttry {\n\t\t\t\tob_start();\n\t\t\t\t$skin     = new \\Automatic_Upgrader_Skin();\n\t\t\t\t$upgrader = new \\Plugin_Upgrader( $skin );\n\t\t\t\t$result   = $upgrader->install( $plugin_info->download_link );\n\t\t\t\tob_end_clean();\n\t\t\t} catch ( \\Exception $e ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( ! is_plugin_active( $plugin_path ) ) {\n\t\t\tactivate_plugin( $plugin_path );\n\t\t}\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * Processes various activation-related actions.\n\t *\n\t * @since  2.9\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ( $type ) {\n\t\t\tcase self::TYPE_UPGRADE:\n\t\t\t\t$this->upgrade();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_INSTALL_3RD:\n\t\t\t\t$this->dash_notifier_install_3rd();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_DISMISS_RECOMMENDED:\n\t\t\t\tCloud::reload_summary();\n\t\t\t\tCloud::save_summary( array( 'news.new' => 0 ) );\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_INSTALL_ZIP:\n\t\t\t\tCloud::reload_summary();\n\t\t\t\t$summary = Cloud::get_summary();\n\t\t\t\tif ( ! empty( $summary['news.zip'] ) ) {\n\t\t\t\t\tCloud::save_summary( array( 'news.new' => 0 ) );\n\n\t\t\t\t\t$this->cls( 'Debug2' )->beta_test( $summary['zip'] );\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/api.cls.php","ext":"php","size":10687,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The plugin API class.\n *\n * @since       1.1.3\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class API\n *\n * Provides API hooks and methods for LiteSpeed Cache integration.\n *\n * @since 1.1.3\n *\/\nclass API extends Base {\n\n\tconst VERSION = Core::VER;\n\n\tconst TYPE_FEED                    = Tag::TYPE_FEED;\n\tconst TYPE_FRONTPAGE               = Tag::TYPE_FRONTPAGE;\n\tconst TYPE_HOME                    = Tag::TYPE_HOME;\n\tconst TYPE_PAGES                   = Tag::TYPE_PAGES;\n\tconst TYPE_PAGES_WITH_RECENT_POSTS = Tag::TYPE_PAGES_WITH_RECENT_POSTS;\n\tconst TYPE_HTTP                    = Tag::TYPE_HTTP;\n\tconst TYPE_ARCHIVE_POSTTYPE        = Tag::TYPE_ARCHIVE_POSTTYPE;\n\tconst TYPE_ARCHIVE_TERM            = Tag::TYPE_ARCHIVE_TERM;\n\tconst TYPE_AUTHOR                  = Tag::TYPE_AUTHOR;\n\tconst TYPE_ARCHIVE_DATE            = Tag::TYPE_ARCHIVE_DATE;\n\tconst TYPE_BLOG                    = Tag::TYPE_BLOG;\n\tconst TYPE_LOGIN                   = Tag::TYPE_LOGIN;\n\tconst TYPE_URL                     = Tag::TYPE_URL;\n\n\tconst TYPE_ESI = Tag::TYPE_ESI;\n\n\tconst PARAM_NAME         = ESI::PARAM_NAME;\n\tconst WIDGET_O_ESIENABLE = ESI::WIDGET_O_ESIENABLE;\n\tconst WIDGET_O_TTL       = ESI::WIDGET_O_TTL;\n\n\t\/**\n\t * Instance\n\t *\n\t * Initializes the API class.\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function __construct() {\n\t}\n\n\t\/**\n\t * Define hooks to be used in other plugins.\n\t *\n\t * The benefit to use hooks other than functions is no need to detach if LSCWP enabled and function existed or not anymore\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function init() {\n\t\t\/**\n\t\t * Init\n\t\t *\/\n\t\t\/\/ Action `litespeed_init`\n\n\t\t\/**\n\t\t * Conf\n\t\t *\/\n\t\tadd_filter( 'litespeed_conf', array( $this, 'conf' ) );\n\t\t\/\/ Action `litespeed_conf_append`\n\t\tadd_action( 'litespeed_conf_multi_switch', __NAMESPACE__ . '\\Base::set_multi_switch', 10, 2 );\n\t\t\/\/ Action `litespeed_conf_force`\n\t\tadd_action( 'litespeed_save_conf', array( $this, 'save_conf' ) );\n\n\t\t\/**\n\t\t * Cache Control Hooks\n\t\t *\/\n\t\t\/\/ Action `litespeed_control_finalize`\n\t\tadd_action( 'litespeed_control_set_private', __NAMESPACE__ . '\\Control::set_private' );\n\t\tadd_action( 'litespeed_control_set_nocache', __NAMESPACE__ . '\\Control::set_nocache' );\n\t\tadd_action( 'litespeed_control_set_cacheable', array( $this, 'set_cacheable' ) );\n\t\tadd_action( 'litespeed_control_force_cacheable', __NAMESPACE__ . '\\Control::force_cacheable' );\n\t\tadd_action( 'litespeed_control_force_public', __NAMESPACE__ . '\\Control::set_public_forced' );\n\t\tadd_filter( 'litespeed_control_cacheable', __NAMESPACE__ . '\\Control::is_cacheable', 3 );\n\t\tadd_action( 'litespeed_control_set_ttl', __NAMESPACE__ . '\\Control::set_custom_ttl', 10, 2 );\n\t\tadd_filter( 'litespeed_control_ttl', array( $this, 'get_ttl' ), 3 );\n\n\t\t\/**\n\t\t * Tag Hooks\n\t\t *\/\n\t\t\/\/ Action `litespeed_tag_finalize`\n\t\tadd_action( 'litespeed_tag', __NAMESPACE__ . '\\Tag::add' );\n\t\tadd_action( 'litespeed_tag_post', __NAMESPACE__ . '\\Tag::add_post' );\n\t\tadd_action( 'litespeed_tag_widget', __NAMESPACE__ . '\\Tag::add_widget' );\n\t\tadd_action( 'litespeed_tag_private', __NAMESPACE__ . '\\Tag::add_private' );\n\t\tadd_action( 'litespeed_tag_private_esi', __NAMESPACE__ . '\\Tag::add_private_esi' );\n\n\t\tadd_action( 'litespeed_tag_add', __NAMESPACE__ . '\\Tag::add' );\n\t\tadd_action( 'litespeed_tag_add_post', __NAMESPACE__ . '\\Tag::add_post' );\n\t\tadd_action( 'litespeed_tag_add_widget', __NAMESPACE__ . '\\Tag::add_widget' );\n\t\tadd_action( 'litespeed_tag_add_private', __NAMESPACE__ . '\\Tag::add_private' );\n\t\tadd_action( 'litespeed_tag_add_private_esi', __NAMESPACE__ . '\\Tag::add_private_esi' );\n\n\t\t\/**\n\t\t * Purge Hooks\n\t\t *\/\n\t\t\/\/ Action `litespeed_purge_finalize`\n\t\tadd_action( 'litespeed_purge', __NAMESPACE__ . '\\Purge::add' );\n\t\tadd_action( 'litespeed_purge_all', __NAMESPACE__ . '\\Purge::purge_all' );\n\t\tadd_action( 'litespeed_purge_post', array( $this, 'purge_post' ) );\n\t\tadd_action( 'litespeed_purge_posttype', __NAMESPACE__ . '\\Purge::purge_posttype' );\n\t\tadd_action( 'litespeed_purge_url', array( $this, 'purge_url' ) );\n\t\tadd_action( 'litespeed_purge_widget', __NAMESPACE__ . '\\Purge::purge_widget' );\n\t\tadd_action( 'litespeed_purge_esi', __NAMESPACE__ . '\\Purge::purge_esi' );\n\t\tadd_action( 'litespeed_purge_private', __NAMESPACE__ . '\\Purge::add_private' );\n\t\tadd_action( 'litespeed_purge_private_esi', __NAMESPACE__ . '\\Purge::add_private_esi' );\n\t\tadd_action( 'litespeed_purge_private_all', __NAMESPACE__ . '\\Purge::add_private_all' );\n\t\t\/\/ Action `litespeed_api_purge_post`\n\t\t\/\/ Action `litespeed_purged_all`\n\t\tadd_action( 'litespeed_purge_all_object', __NAMESPACE__ . '\\Purge::purge_all_object' );\n\t\tadd_action( 'litespeed_purge_ucss', __NAMESPACE__ . '\\Purge::purge_ucss' );\n\n\t\t\/**\n\t\t * ESI\n\t\t *\/\n\t\t\/\/ Action `litespeed_nonce`\n\t\tadd_filter( 'litespeed_esi_status', array( $this, 'esi_enabled' ) );\n\t\tadd_filter( 'litespeed_esi_url', array( $this, 'sub_esi_block' ), 10, 8 ); \/\/ Generate ESI block url\n\t\t\/\/ Filter `litespeed_widget_default_options` \/\/ Hook widget default settings value. Currently used in Woo 3rd\n\t\t\/\/ Filter `litespeed_esi_params`\n\t\t\/\/ Action `litespeed_tpl_normal`\n\t\t\/\/ Action `litespeed_esi_load-$block` \/\/ @usage add_action( 'litespeed_esi_load-' . $block, $hook )\n\t\tadd_action( 'litespeed_esi_combine', __NAMESPACE__ . '\\ESI::combine' );\n\n\t\t\/**\n\t\t * Vary\n\t\t *\n\t\t * To modify default vary, There are two ways: Action `litespeed_vary_append` or Filter `litespeed_vary`\n\t\t *\/\n\t\tadd_action( 'litespeed_vary_ajax_force', __NAMESPACE__ . '\\Vary::can_ajax_vary' ); \/\/ Force finalize vary even if its in an AJAX call\n\t\t\/\/ Filter `litespeed_vary_curr_cookies` to generate current in use vary, which will be used for response vary header.\n\t\t\/\/ Filter `litespeed_vary_cookies` to register the final vary cookies, which will be written to rewrite rule. (litespeed_vary_curr_cookies are always equal to or less than litespeed_vary_cookies)\n\t\t\/\/ Filter `litespeed_vary`\n\t\tadd_action( 'litespeed_vary_no', __NAMESPACE__ . '\\Control::set_no_vary' );\n\n\t\t\/**\n\t\t * Cloud\n\t\t *\/\n\t\tadd_filter( 'litespeed_is_from_cloud', array( $this, 'is_from_cloud' ) ); \/\/ Check if current request is from QC (usually its to check REST access) \/\/ @see https:\/\/wordpress.org\/support\/topic\/image-optimization-not-working-3\/\n\n\t\t\/**\n\t\t * Media\n\t\t *\/\n\t\tadd_action( 'litespeed_media_reset', __NAMESPACE__ . '\\Media::delete_attachment' );\n\n\t\t\/**\n\t\t * GUI\n\t\t *\/\n\t\tadd_filter( 'litespeed_clean_wrapper_begin', __NAMESPACE__ . '\\GUI::clean_wrapper_begin' );\n\t\tadd_filter( 'litespeed_clean_wrapper_end', __NAMESPACE__ . '\\GUI::clean_wrapper_end' );\n\n\t\t\/**\n\t\t * Misc\n\t\t *\/\n\t\tadd_action( 'litespeed_debug', __NAMESPACE__ . '\\Debug2::debug', 10, 2 );\n\t\tadd_action( 'litespeed_debug2', __NAMESPACE__ . '\\Debug2::debug2', 10, 2 );\n\t\tadd_action( 'litespeed_disable_all', array( $this, 'disable_all' ) );\n\n\t\tadd_action( 'litespeed_after_admin_init', array( $this, 'after_admin_init' ) );\n\t}\n\n\t\/**\n\t * API for admin related\n\t *\n\t * Registers hooks for admin settings and UI elements.\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function after_admin_init() {\n\t\t\/**\n\t\t * GUI\n\t\t *\/\n\t\tadd_action( 'litespeed_setting_enroll', array( $this->cls( 'Admin_Display' ), 'enroll' ), 10, 4 );\n\t\tadd_action( 'litespeed_build_switch', array( $this->cls( 'Admin_Display' ), 'build_switch' ) );\n\t\t\/\/ Action `litespeed_settings_content`\n\t\t\/\/ Action `litespeed_settings_tab`\n\t}\n\n\t\/**\n\t * Disable All\n\t *\n\t * Disables all LiteSpeed Cache features with a given reason.\n\t *\n\t * @since 2.9.7.2\n\t * @access public\n\t * @param string $reason The reason for disabling all features.\n\t *\/\n\tpublic function disable_all( $reason ) {\n\t\tdo_action( 'litespeed_debug', '[API] Disabled_all due to ' . $reason );\n\n\t\t! defined( 'LITESPEED_DISABLE_ALL' ) && define( 'LITESPEED_DISABLE_ALL', true );\n\t}\n\n\t\/**\n\t * Append commenter vary\n\t *\n\t * Adds commenter vary to the cache vary cookies.\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function vary_append_commenter() {\n\t\tVary::cls()->append_commenter();\n\t}\n\n\t\/**\n\t * Check if is from Cloud\n\t *\n\t * Checks if the current request originates from QUIC.cloud.\n\t *\n\t * @since 4.2\n\t * @access public\n\t * @return bool True if from QUIC.cloud, false otherwise.\n\t *\/\n\tpublic function is_from_cloud() {\n\t\treturn $this->cls( 'Cloud' )->is_from_cloud();\n\t}\n\n\t\/**\n\t * Purge post\n\t *\n\t * Purges the cache for a specific post.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param int $pid Post ID to purge.\n\t *\/\n\tpublic function purge_post( $pid ) {\n\t\t$this->cls( 'Purge' )->purge_post( $pid );\n\t}\n\n\t\/**\n\t * Purge URL\n\t *\n\t * Purges the cache for a specific URL.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param string $url URL to purge.\n\t *\/\n\tpublic function purge_url( $url ) {\n\t\t$this->cls( 'Purge' )->purge_url( $url );\n\t}\n\n\t\/**\n\t * Set cacheable\n\t *\n\t * Marks the current request as cacheable.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param string|bool $reason Optional reason for setting cacheable.\n\t *\/\n\tpublic function set_cacheable( $reason = false ) {\n\t\t$this->cls( 'Control' )->set_cacheable( $reason );\n\t}\n\n\t\/**\n\t * Check ESI enabled\n\t *\n\t * Returns whether ESI is enabled.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @return bool True if ESI is enabled, false otherwise.\n\t *\/\n\tpublic function esi_enabled() {\n\t\treturn $this->cls( 'Router' )->esi_enabled();\n\t}\n\n\t\/**\n\t * Get TTL\n\t *\n\t * Retrieves the cache TTL (time to live).\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @return int Cache TTL value.\n\t *\/\n\tpublic function get_ttl() {\n\t\treturn $this->cls( 'Control' )->get_ttl();\n\t}\n\n\t\/**\n\t * Generate ESI block URL\n\t *\n\t * Generates a URL for an ESI block.\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param string $block_id    ESI block ID.\n\t * @param string $wrapper     Wrapper identifier.\n\t * @param array  $params      Parameters for the ESI block.\n\t * @param string $control     Cache control settings.\n\t * @param bool   $silence     Silence output flag.\n\t * @param bool   $preserved   Preserved flag.\n\t * @param bool   $svar        Server variable flag.\n\t * @param array  $inline_param Inline parameters.\n\t * @return string ESI block URL.\n\t *\/\n\tpublic function sub_esi_block(\n\t\t$block_id,\n\t\t$wrapper,\n\t\t$params = array(),\n\t\t$control = 'private,no-vary',\n\t\t$silence = false,\n\t\t$preserved = false,\n\t\t$svar = false,\n\t\t$inline_param = array()\n\t) {\n\t\treturn $this->cls( 'ESI' )->sub_esi_block( $block_id, $wrapper, $params, $control, $silence, $preserved, $svar, $inline_param );\n\t}\n\n\t\/**\n\t * Set and sync conf\n\t *\n\t * Updates and synchronizes configuration settings.\n\t *\n\t * @since 7.2\n\t * @access public\n\t * @param bool|array $the_matrix Configuration data to update.\n\t *\/\n\tpublic function save_conf( $the_matrix = false ) {\n\t\t$this->cls( 'Conf' )->update_confs( $the_matrix );\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/import.preset.cls.php","ext":"php","size":5633,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The preset class.\n *\n * @since  5.3.0\n *\/\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Preset extends Import {\n\n\tprotected $_summary;\n\n\tconst MAX_BACKUPS = 10;\n\n\tconst TYPE_APPLY   = 'apply';\n\tconst TYPE_RESTORE = 'restore';\n\n\tconst STANDARD_DIR = LSCWP_DIR . 'data\/preset';\n\tconst BACKUP_DIR   = LITESPEED_STATIC_DIR . '\/auto-backup';\n\n\t\/**\n\t * Returns sorted backup names\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic static function get_backups() {\n\t\tself::init_filesystem();\n\t\tglobal $wp_filesystem;\n\n\t\t$backups = array_map(\n\t\t\tfunction ( $path ) {\n\t\t\t\treturn self::basename($path['name']);\n\t\t\t},\n\t\t\t$wp_filesystem->dirlist(self::BACKUP_DIR) ?: array()\n\t\t);\n\t\trsort($backups);\n\n\t\treturn $backups;\n\t}\n\n\t\/**\n\t * Removes extra backup files\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic static function prune_backups() {\n\t\t$backups = self::get_backups();\n\t\tglobal $wp_filesystem;\n\n\t\tforeach (array_slice($backups, self::MAX_BACKUPS) as $backup) {\n\t\t\t$path = self::get_backup($backup);\n\t\t\t$wp_filesystem->delete($path);\n\t\t\tDebug2::debug('[Preset] Deleted old backup from ' . $backup);\n\t\t}\n\t}\n\n\t\/**\n\t * Returns a settings file's extensionless basename given its filesystem path\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic static function basename( $path ) {\n\t\treturn basename($path, '.data');\n\t}\n\n\t\/**\n\t * Returns a standard preset's path given its extensionless basename\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic static function get_standard( $name ) {\n\t\treturn path_join(self::STANDARD_DIR, $name . '.data');\n\t}\n\n\t\/**\n\t * Returns a backup's path given its extensionless basename\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic static function get_backup( $name ) {\n\t\treturn path_join(self::BACKUP_DIR, $name . '.data');\n\t}\n\n\t\/**\n\t * Initializes the global $wp_filesystem object and clears stat cache\n\t *\n\t * @since  5.3.0\n\t *\/\n\tstatic function init_filesystem() {\n\t\trequire_once ABSPATH . '\/wp-admin\/includes\/file.php';\n\t\t\\WP_Filesystem();\n\t\tclearstatcache();\n\t}\n\n\t\/**\n\t * Init\n\t *\n\t * @since  5.3.0\n\t *\/\n\tpublic function __construct() {\n\t\tDebug2::debug('[Preset] Init');\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t\/**\n\t * Applies a standard preset's settings given its extensionless basename\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic function apply( $preset ) {\n\t\t$this->make_backup($preset);\n\n\t\t$path   = self::get_standard($preset);\n\t\t$result = $this->import_file($path) ? $preset : 'error';\n\n\t\t$this->log($result);\n\t}\n\n\t\/**\n\t * Restores settings from the backup file with the given timestamp, then deletes the file\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic function restore( $timestamp ) {\n\t\t$backups = array();\n\t\tforeach (self::get_backups() as $backup) {\n\t\t\tif (preg_match('\/^backup-' . $timestamp . '(-|$)\/', $backup) === 1) {\n\t\t\t\t$backups[] = $backup;\n\t\t\t}\n\t\t}\n\n\t\tif (empty($backups)) {\n\t\t\t$this->log('error');\n\t\t\treturn;\n\t\t}\n\n\t\t$backup = $backups[0];\n\t\t$path   = self::get_backup($backup);\n\n\t\tif (!$this->import_file($path)) {\n\t\t\t$this->log('error');\n\t\t\treturn;\n\t\t}\n\n\t\tself::init_filesystem();\n\t\tglobal $wp_filesystem;\n\n\t\t$wp_filesystem->delete($path);\n\t\tDebug2::debug('[Preset] Deleted most recent backup from ' . $backup);\n\n\t\t$this->log('backup');\n\t}\n\n\t\/**\n\t * Saves current settings as a backup file, then prunes extra backup files\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic function make_backup( $preset ) {\n\t\t$backup = 'backup-' . time() . '-before-' . $preset;\n\t\t$data   = $this->export(true);\n\n\t\t$path = self::get_backup($backup);\n\t\tFile::save($path, $data, true);\n\t\tDebug2::debug('[Preset] Backup saved to ' . $backup);\n\n\t\tself::prune_backups();\n\t}\n\n\t\/**\n\t * Tries to import from a given settings file\n\t *\n\t * @since  5.3.0\n\t *\/\n\tfunction import_file( $path ) {\n\t\t$debug = function ( $result, $name ) {\n\t\t\t$action = $result ? 'Applied' : 'Failed to apply';\n\t\t\tDebug2::debug('[Preset] ' . $action . ' settings from ' . $name);\n\t\t\treturn $result;\n\t\t};\n\n\t\t$name     = self::basename($path);\n\t\t$contents = file_get_contents($path);\n\n\t\tif (false === $contents) {\n\t\t\tDebug2::debug('[Preset] \u274c Failed to get file contents');\n\t\t\treturn $debug(false, $name);\n\t\t}\n\n\t\t$parsed = array();\n\t\ttry {\n\t\t\t\/\/ Check if the data is v4+\n\t\t\tif (strpos($contents, '[\"_version\",') === 0) {\n\t\t\t\t$contents = explode(\"\\n\", $contents);\n\t\t\t\tforeach ($contents as $line) {\n\t\t\t\t\t$line = trim($line);\n\t\t\t\t\tif (empty($line)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlist($key, $value) = \\json_decode($line, true);\n\t\t\t\t\t$parsed[$key]      = $value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$parsed = \\json_decode(base64_decode($contents), true);\n\t\t\t}\n\t\t} catch (\\Exception $ex) {\n\t\t\tDebug2::debug('[Preset] \u274c Failed to parse serialized data');\n\t\t\treturn $debug(false, $name);\n\t\t}\n\n\t\tif (empty($parsed)) {\n\t\t\tDebug2::debug('[Preset] \u274c Nothing to apply');\n\t\t\treturn $debug(false, $name);\n\t\t}\n\n\t\t$this->cls('Conf')->update_confs($parsed);\n\n\t\treturn $debug(true, $name);\n\t}\n\n\t\/**\n\t * Updates the log\n\t *\n\t * @since  5.3.0\n\t *\/\n\tfunction log( $preset ) {\n\t\t$this->_summary['preset']           = $preset;\n\t\t$this->_summary['preset_timestamp'] = time();\n\t\tself::save_summary();\n\t}\n\n\t\/**\n\t * Handles all request actions from main cls\n\t *\n\t * @since  5.3.0\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_APPLY:\n            $this->apply(!empty($_GET['preset']) ? $_GET['preset'] : false);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESTORE:\n            $this->restore(!empty($_GET['timestamp']) ? $_GET['timestamp'] : false);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/htaccess.cls.php","ext":"php","size":24637,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The htaccess rewrite rule operation class\n *\n * @since      1.0.0\n * @package    LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Htaccess extends Root {\n\n\tprivate $frontend_htaccess          = null;\n\tprivate $_default_frontend_htaccess = null;\n\tprivate $backend_htaccess           = null;\n\tprivate $_default_backend_htaccess  = null;\n\tprivate $theme_htaccess             = null; \/\/ Not used yet\n\tprivate $frontend_htaccess_readable = false;\n\tprivate $frontend_htaccess_writable = false;\n\tprivate $backend_htaccess_readable  = false;\n\tprivate $backend_htaccess_writable  = false;\n\tprivate $theme_htaccess_readable    = false;\n\tprivate $theme_htaccess_writable    = false;\n\tprivate $__rewrite_on;\n\n\tconst LS_MODULE_START            = '<IfModule LiteSpeed>';\n\tconst EXPIRES_MODULE_START       = '<IfModule mod_expires.c>';\n\tconst LS_MODULE_END              = '<\/IfModule>';\n\tconst LS_MODULE_REWRITE_START    = '<IfModule mod_rewrite.c>';\n\tconst REWRITE_ON                 = 'RewriteEngine on';\n\tconst LS_MODULE_DONOTEDIT        = '## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##';\n\tconst MARKER                     = 'LSCACHE';\n\tconst MARKER_NONLS               = 'NON_LSCACHE';\n\tconst MARKER_LOGIN_COOKIE        = '### marker LOGIN COOKIE';\n\tconst MARKER_ASYNC               = '### marker ASYNC';\n\tconst MARKER_CRAWLER             = '### marker CRAWLER';\n\tconst MARKER_MOBILE              = '### marker MOBILE';\n\tconst MARKER_NOCACHE_COOKIES     = '### marker NOCACHE COOKIES';\n\tconst MARKER_NOCACHE_USER_AGENTS = '### marker NOCACHE USER AGENTS';\n\tconst MARKER_CACHE_RESOURCE      = '### marker CACHE RESOURCE';\n\tconst MARKER_BROWSER_CACHE       = '### marker BROWSER CACHE';\n\tconst MARKER_MINIFY              = '### marker MINIFY';\n\tconst MARKER_CORS                = '### marker CORS';\n\tconst MARKER_WEBP                = '### marker WEBP';\n\tconst MARKER_DROPQS              = '### marker DROPQS';\n\tconst MARKER_START               = ' start ###';\n\tconst MARKER_END                 = ' end ###';\n\n\tconst RW_PATTERN_RES = '\/.*\/[^\/]*(responsive|css|js|dynamic|loader|fonts)\\.php';\n\n\t\/**\n\t * Initialize the class and set its properties.\n\t *\n\t * @since    1.0.7\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_path_set();\n\t\t$this->_default_frontend_htaccess = $this->frontend_htaccess;\n\t\t$this->_default_backend_htaccess  = $this->backend_htaccess;\n\n\t\t$frontend_htaccess = defined('LITESPEED_CFG_HTACCESS') ? LITESPEED_CFG_HTACCESS : false;\n\t\tif ($frontend_htaccess && substr($frontend_htaccess, -10) === '\/.htaccess') {\n\t\t\t$this->frontend_htaccess = $frontend_htaccess;\n\t\t}\n\t\t$backend_htaccess = defined('LITESPEED_CFG_HTACCESS_BACKEND') ? LITESPEED_CFG_HTACCESS_BACKEND : false;\n\t\tif ($backend_htaccess && substr($backend_htaccess, -10) === '\/.htaccess') {\n\t\t\t$this->backend_htaccess = $backend_htaccess;\n\t\t}\n\n\t\t\/\/ Filter for frontend&backend htaccess path\n\t\t$this->frontend_htaccess = apply_filters('litespeed_frontend_htaccess', $this->frontend_htaccess);\n\t\t$this->backend_htaccess  = apply_filters('litespeed_backend_htaccess', $this->backend_htaccess);\n\n\t\tclearstatcache();\n\n\t\t\/\/ frontend .htaccess privilege\n\t\t$test_permissions = file_exists($this->frontend_htaccess) ? $this->frontend_htaccess : dirname($this->frontend_htaccess);\n\t\tif (is_readable($test_permissions)) {\n\t\t\t$this->frontend_htaccess_readable = true;\n\t\t}\n\t\tif (is_writable($test_permissions)) {\n\t\t\t$this->frontend_htaccess_writable = true;\n\t\t}\n\n\t\t$this->__rewrite_on = array(\n\t\t\tself::REWRITE_ON,\n\t\t\t'CacheLookup on',\n\t\t\t'RewriteRule .* - [E=Cache-Control:no-autoflush]',\n\t\t\t'RewriteRule ' . preg_quote(LITESPEED_DATA_FOLDER) . '\/debug\/.*\\.log$ - [F,L]',\n\t\t\t'RewriteRule ' . preg_quote(self::CONF_FILE) . ' - [F,L]',\n\t\t);\n\n\t\t\/\/ backend .htaccess privilege\n\t\tif ($this->frontend_htaccess === $this->backend_htaccess) {\n\t\t\t$this->backend_htaccess_readable = $this->frontend_htaccess_readable;\n\t\t\t$this->backend_htaccess_writable = $this->frontend_htaccess_writable;\n\t\t} else {\n\t\t\t$test_permissions = file_exists($this->backend_htaccess) ? $this->backend_htaccess : dirname($this->backend_htaccess);\n\t\t\tif (is_readable($test_permissions)) {\n\t\t\t\t$this->backend_htaccess_readable = true;\n\t\t\t}\n\t\t\tif (is_writable($test_permissions)) {\n\t\t\t\t$this->backend_htaccess_writable = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Get if htaccess file is readable\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t *\/\n\tprivate function _readable( $kind = 'frontend' ) {\n\t\tif ($kind === 'frontend') {\n\t\t\treturn $this->frontend_htaccess_readable;\n\t\t}\n\t\tif ($kind === 'backend') {\n\t\t\treturn $this->backend_htaccess_readable;\n\t\t}\n\t}\n\n\t\/**\n\t * Get if htaccess file is writable\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t *\/\n\tpublic function writable( $kind = 'frontend' ) {\n\t\tif ($kind === 'frontend') {\n\t\t\treturn $this->frontend_htaccess_writable;\n\t\t}\n\t\tif ($kind === 'backend') {\n\t\t\treturn $this->backend_htaccess_writable;\n\t\t}\n\t}\n\n\t\/**\n\t * Get frontend htaccess path\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t *\/\n\tpublic static function get_frontend_htaccess( $show_default = false ) {\n\t\tif ($show_default) {\n\t\t\treturn self::cls()->_default_frontend_htaccess;\n\t\t}\n\t\treturn self::cls()->frontend_htaccess;\n\t}\n\n\t\/**\n\t * Get backend htaccess path\n\t *\n\t * @since 1.1.0\n\t * @return string\n\t *\/\n\tpublic static function get_backend_htaccess( $show_default = false ) {\n\t\tif ($show_default) {\n\t\t\treturn self::cls()->_default_backend_htaccess;\n\t\t}\n\t\treturn self::cls()->backend_htaccess;\n\t}\n\n\t\/**\n\t * Check to see if .htaccess exists starting at $start_path and going up directories until it hits DOCUMENT_ROOT.\n\t *\n\t * As dirname() strips the ending '\/', paths passed in must exclude the final '\/'\n\t *\n\t * @since 1.0.11\n\t * @access private\n\t *\/\n\tprivate function _htaccess_search( $start_path ) {\n\t\twhile (!file_exists($start_path . '\/.htaccess')) {\n\t\t\tif ($start_path === '\/' || !$start_path) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!empty($_SERVER['DOCUMENT_ROOT']) && wp_normalize_path($start_path) === wp_normalize_path($_SERVER['DOCUMENT_ROOT'])) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (dirname($start_path) === $start_path) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$start_path = dirname($start_path);\n\t\t}\n\n\t\treturn $start_path;\n\t}\n\n\t\/**\n\t * Set the path class variables.\n\t *\n\t * @since 1.0.11\n\t * @access private\n\t *\/\n\tprivate function _path_set() {\n\t\t$frontend                 = Router::frontend_path();\n\t\t$frontend_htaccess_search = $this->_htaccess_search($frontend); \/\/ The existing .htaccess path to be used for frontend .htaccess\n\t\t$this->frontend_htaccess  = ($frontend_htaccess_search ?: $frontend) . '\/.htaccess';\n\n\t\t$backend = realpath(ABSPATH); \/\/ \/home\/user\/public_html\/backend\/\n\t\tif ($frontend == $backend) {\n\t\t\t$this->backend_htaccess = $this->frontend_htaccess;\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Backend is a different path\n\t\t$backend_htaccess_search = $this->_htaccess_search($backend);\n\t\t\/\/ Found affected .htaccess\n\t\tif ($backend_htaccess_search) {\n\t\t\t$this->backend_htaccess = $backend_htaccess_search . '\/.htaccess';\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Frontend path is the parent of backend path\n\t\tif (stripos($backend, $frontend . '\/') === 0) {\n\t\t\t\/\/ backend use frontend htaccess\n\t\t\t$this->backend_htaccess = $this->frontend_htaccess;\n\t\t\treturn;\n\t\t}\n\n\t\t$this->backend_htaccess = $backend . '\/.htaccess';\n\t}\n\n\t\/**\n\t * Get corresponding htaccess path\n\t *\n\t * @since 1.1.0\n\t * @param  string $kind Frontend or backend\n\t * @return string       Path\n\t *\/\n\tpublic function htaccess_path( $kind = 'frontend' ) {\n\t\tswitch ($kind) {\n\t\t\tcase 'backend':\n            $path = $this->backend_htaccess;\n\t\t\t\tbreak;\n\n\t\t\tcase 'frontend':\n\t\t\tdefault:\n            $path = $this->frontend_htaccess;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn $path;\n\t}\n\n\t\/**\n\t * Get the content of the rules file.\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.0.4\n\t * @since  2.9 Used exception for failed reading\n\t * @access public\n\t *\/\n\tpublic function htaccess_read( $kind = 'frontend' ) {\n\t\t$path = $this->htaccess_path($kind);\n\n\t\tif (!$path || !file_exists($path)) {\n\t\t\treturn \"\\n\";\n\t\t}\n\n\t\tif (!$this->_readable($kind)) {\n\t\t\tError::t('HTA_R');\n\t\t}\n\n\t\t$content = File::read($path);\n\t\tif ($content === false) {\n\t\t\tError::t('HTA_GET');\n\t\t}\n\n\t\t\/\/ Remove ^M characters.\n\t\t$content = str_ireplace(\"\\x0D\", '', $content);\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Try to backup the .htaccess file if we didn't save one before.\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.0.10\n\t * @access private\n\t *\/\n\tprivate function _htaccess_backup( $kind = 'frontend' ) {\n\t\t$path = $this->htaccess_path($kind);\n\n\t\tif (!file_exists($path)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (file_exists($path . '.bk')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$res = copy($path, $path . '.bk');\n\n\t\t\/\/ Failed to backup, abort\n\t\tif (!$res) {\n\t\t\tError::t('HTA_BK');\n\t\t}\n\t}\n\n\t\/**\n\t * Get mobile view rule from htaccess file\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.1.0\n\t *\/\n\tpublic function current_mobile_agents() {\n\t\t$rules = $this->_get_rule_by(self::MARKER_MOBILE);\n\t\tif (!isset($rules[0])) {\n\t\t\tError::t('HTA_DNF', self::MARKER_MOBILE);\n\t\t}\n\n\t\t$rule = trim($rules[0]);\n\t\t\/\/ 'RewriteCond %{HTTP_USER_AGENT} ' . Utility::arr2regex( $cfg[ $id ], true ) . ' [NC]';\n\t\t$match = substr($rule, strlen('RewriteCond %{HTTP_USER_AGENT} '), -strlen(' [NC]'));\n\n\t\tif (!$match) {\n\t\t\tError::t('HTA_DNF', __('Mobile Agent Rules', 'litespeed-cache'));\n\t\t}\n\n\t\treturn $match;\n\t}\n\n\t\/**\n\t * Parse rewrites rule from the .htaccess file.\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic function current_login_cookie( $kind = 'frontend' ) {\n\t\t$rule = $this->_get_rule_by(self::MARKER_LOGIN_COOKIE, $kind);\n\n\t\tif (!$rule) {\n\t\t\tError::t('HTA_DNF', self::MARKER_LOGIN_COOKIE);\n\t\t}\n\n\t\tif (strpos($rule, 'RewriteRule .? - [E=') !== 0) {\n\t\t\tError::t('HTA_LOGIN_COOKIE_INVALID');\n\t\t}\n\n\t\t$rule_cookie = substr($rule, strlen('RewriteRule .? - [E='), -1);\n\n\t\tif (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t\t\t$rule_cookie = trim($rule_cookie, '\"');\n\t\t}\n\n\t\t\/\/ Drop `Cache-Vary:`\n\t\t$rule_cookie = substr($rule_cookie, strlen('Cache-Vary:'));\n\n\t\treturn $rule_cookie;\n\t}\n\n\t\/**\n\t * Get rewrite rules based on the marker\n\t *\n\t * @since  2.0\n\t * @access private\n\t *\/\n\tprivate function _get_rule_by( $cond, $kind = 'frontend' ) {\n\t\tclearstatcache();\n\t\t$path = $this->htaccess_path($kind);\n\t\tif (!$this->_readable($kind)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$rules = File::extract_from_markers($path, self::MARKER);\n\t\tif (!in_array($cond . self::MARKER_START, $rules) || !in_array($cond . self::MARKER_END, $rules)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$key_start = array_search($cond . self::MARKER_START, $rules);\n\t\t$key_end   = array_search($cond . self::MARKER_END, $rules);\n\t\tif ($key_start === false || $key_end === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$results = array_slice($rules, $key_start + 1, $key_end - $key_start - 1);\n\t\tif (!$results) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (count($results) == 1) {\n\t\t\treturn trim($results[0]);\n\t\t}\n\n\t\treturn array_filter($results);\n\t}\n\n\t\/**\n\t * Generate browser cache rules\n\t *\n\t * @since  1.3\n\t * @access private\n\t * @return array Rules set\n\t *\/\n\tprivate function _browser_cache_rules( $cfg ) {\n\t\t\/**\n\t\t * Add ttl setting\n\t\t *\n\t\t * @since 1.6.3\n\t\t *\/\n\t\t$id    = Base::O_CACHE_TTL_BROWSER;\n\t\t$ttl   = $cfg[$id];\n\t\t$rules = array(\n\t\t\tself::EXPIRES_MODULE_START,\n\t\t\t\/\/ '<FilesMatch \"\\.(pdf|ico|svg|xml|jpg|jpeg|png|gif|webp|ogg|mp4|webm|js|css|woff|woff2|ttf|eot)(\\.gz)?$\">',\n\t\t\t'ExpiresActive on',\n\t\t\t'ExpiresByType application\/pdf A' . $ttl,\n\t\t\t'ExpiresByType image\/x-icon A' . $ttl,\n\t\t\t'ExpiresByType image\/vnd.microsoft.icon A' . $ttl,\n\t\t\t'ExpiresByType image\/svg+xml A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType image\/jpg A' . $ttl,\n\t\t\t'ExpiresByType image\/jpeg A' . $ttl,\n\t\t\t'ExpiresByType image\/png A' . $ttl,\n\t\t\t'ExpiresByType image\/gif A' . $ttl,\n\t\t\t'ExpiresByType image\/webp A' . $ttl,\n\t\t\t'ExpiresByType image\/avif A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType video\/ogg A' . $ttl,\n\t\t\t'ExpiresByType audio\/ogg A' . $ttl,\n\t\t\t'ExpiresByType video\/mp4 A' . $ttl,\n\t\t\t'ExpiresByType video\/webm A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType text\/css A' . $ttl,\n\t\t\t'ExpiresByType text\/javascript A' . $ttl,\n\t\t\t'ExpiresByType application\/javascript A' . $ttl,\n\t\t\t'ExpiresByType application\/x-javascript A' . $ttl,\n\t\t\t'',\n\t\t\t'ExpiresByType application\/x-font-ttf A' . $ttl,\n\t\t\t'ExpiresByType application\/x-font-woff A' . $ttl,\n\t\t\t'ExpiresByType application\/font-woff A' . $ttl,\n\t\t\t'ExpiresByType application\/font-woff2 A' . $ttl,\n\t\t\t'ExpiresByType application\/vnd.ms-fontobject A' . $ttl,\n\t\t\t'ExpiresByType font\/ttf A' . $ttl,\n\t\t\t'ExpiresByType font\/otf A' . $ttl,\n\t\t\t'ExpiresByType font\/woff A' . $ttl,\n\t\t\t'ExpiresByType font\/woff2 A' . $ttl,\n\t\t\t'',\n\t\t\t\/\/ '<\/FilesMatch>',\n\t\t\tself::LS_MODULE_END,\n\t\t);\n\t\treturn $rules;\n\t}\n\n\t\/**\n\t * Generate CORS rules for fonts\n\t *\n\t * @since  1.5\n\t * @access private\n\t * @return array Rules set\n\t *\/\n\tprivate function _cors_rules() {\n\t\treturn array(\n\t\t\t'<FilesMatch \"\\.(ttf|ttc|otf|eot|woff|woff2|font\\.css)$\">',\n\t\t\t'<IfModule mod_headers.c>',\n\t\t\t'Header set Access-Control-Allow-Origin \"*\"',\n\t\t\t'<\/IfModule>',\n\t\t\t'<\/FilesMatch>',\n\t\t);\n\t}\n\n\t\/**\n\t * Generate rewrite rules based on settings\n\t *\n\t * @since  1.3\n\t * @access private\n\t * @param  array $cfg  The settings to be used for rewrite rule\n\t * @return array      Rules array\n\t *\/\n\tprivate function _generate_rules( $cfg ) {\n\t\t$new_rules               = array();\n\t\t$new_rules_nonls         = array();\n\t\t$new_rules_backend       = array();\n\t\t$new_rules_backend_nonls = array();\n\n\t\t\/\/ continual crawler\n\t\t\/\/ $id = Base::O_CRAWLER;\n\t\t\/\/ if (!empty($cfg[$id])) {\n\t\t$new_rules[] = self::MARKER_ASYNC . self::MARKER_START;\n\t\t$new_rules[] = 'RewriteCond %{REQUEST_URI} \/wp-admin\/admin-ajax\\.php';\n\t\t$new_rules[] = 'RewriteCond %{QUERY_STRING} action=async_litespeed';\n\t\t$new_rules[] = 'RewriteRule .* - [E=noabort:1]';\n\t\t$new_rules[] = self::MARKER_ASYNC . self::MARKER_END;\n\t\t$new_rules[] = '';\n\t\t\/\/ }\n\n\t\t\/\/ mobile agents\n\t\t$id = Base::O_CACHE_MOBILE_RULES;\n\t\tif ((!empty($cfg[Base::O_CACHE_MOBILE]) || !empty($cfg[Base::O_GUEST])) && !empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_MOBILE . self::MARKER_START;\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} ' . Utility::arr2regex($cfg[$id], true) . ' [NC]';\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+ismobile]';\n\t\t\t$new_rules[] = self::MARKER_MOBILE . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ nocache cookie\n\t\t$id = Base::O_CACHE_EXC_COOKIES;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_COOKIES . self::MARKER_START;\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_COOKIE} ' . Utility::arr2regex($cfg[$id], true);\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:no-cache]';\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_COOKIES . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ nocache user agents\n\t\t$id = Base::O_CACHE_EXC_USERAGENTS;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_USER_AGENTS . self::MARKER_START;\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} ' . Utility::arr2regex($cfg[$id], true) . ' [NC]';\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:no-cache]';\n\t\t\t$new_rules[] = self::MARKER_NOCACHE_USER_AGENTS . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ check login cookie\n\t\t$vary_cookies = $cfg[Base::O_CACHE_VARY_COOKIES];\n\t\t$id           = Base::O_CACHE_LOGIN_COOKIE;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$vary_cookies[] = $cfg[$id];\n\t\t}\n\t\tif (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t\t\t\/\/ Need to keep this due to different behavior of OLS when handling response vary header @Sep\/22\/2018\n\t\t\tif (defined('COOKIEHASH')) {\n\t\t\t\t$vary_cookies[] = ',wp-postpass_' . COOKIEHASH;\n\t\t\t}\n\t\t}\n\t\t$vary_cookies = apply_filters('litespeed_vary_cookies', $vary_cookies); \/\/ todo: test if response vary header can work in latest OLS, drop the above two lines\n\t\t\/\/ frontend and backend\n\t\tif ($vary_cookies) {\n\t\t\t$env = 'Cache-Vary:' . implode(',', $vary_cookies);\n\t\t\t\/\/ if (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t\t\t\/\/ }\n\t\t\t$env         = '\"' . $env . '\"';\n\t\t\t$new_rules[] = $new_rules_backend[] = self::MARKER_LOGIN_COOKIE . self::MARKER_START;\n\t\t\t$new_rules[] = $new_rules_backend[] = 'RewriteRule .? - [E=' . $env . ']';\n\t\t\t$new_rules[] = $new_rules_backend[] = self::MARKER_LOGIN_COOKIE . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ CORS font rules\n\t\t$id = Base::O_CDN;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_CORS . self::MARKER_START;\n\t\t\t$new_rules   = array_merge($new_rules, $this->_cors_rules()); \/\/ todo: network\n\t\t\t$new_rules[] = self::MARKER_CORS . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ webp support\n\t\t$id = Base::O_IMG_OPTM_WEBP;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$next_gen_format = 'webp';\n\t\t\tif ($cfg[$id] == 2) {\n\t\t\t\t$next_gen_format = 'avif';\n\t\t\t}\n\t\t\t$new_rules[] = self::MARKER_WEBP . self::MARKER_START;\n\t\t\t\/\/ Check for WebP support via HTTP_ACCEPT\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_ACCEPT} image\/' . $next_gen_format . ' [OR]';\n\n\t\t\t\/\/ Check for iPhone browsers (version > 13)\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} iPhone\\ OS\\ (1[4-9]|[2-9][0-9]) [OR]';\n\n\t\t\t\/\/ Check for Firefox (version >= 65)\n\t\t\t$new_rules[] = 'RewriteCond %{HTTP_USER_AGENT} Firefox\/([6-9][0-9]|[1-9][0-9]{2,})';\n\n\t\t\t\/\/ Add vary\n\t\t\t$new_rules[] = 'RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]';\n\t\t\t$new_rules[] = self::MARKER_WEBP . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ drop qs support\n\t\t$id = Base::O_CACHE_DROP_QS;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules[] = self::MARKER_DROPQS . self::MARKER_START;\n\t\t\tforeach ($cfg[$id] as $v) {\n\t\t\t\t$new_rules[] = 'CacheKeyModify -qs:' . $v;\n\t\t\t}\n\t\t\t$new_rules[] = self::MARKER_DROPQS . self::MARKER_END;\n\t\t\t$new_rules[] = '';\n\t\t}\n\n\t\t\/\/ Browser cache\n\t\t$id = Base::O_CACHE_BROWSER;\n\t\tif (!empty($cfg[$id])) {\n\t\t\t$new_rules_nonls[]       = $new_rules_backend_nonls[] = self::MARKER_BROWSER_CACHE . self::MARKER_START;\n\t\t\t$new_rules_nonls         = array_merge($new_rules_nonls, $this->_browser_cache_rules($cfg));\n\t\t\t$new_rules_backend_nonls = array_merge($new_rules_backend_nonls, $this->_browser_cache_rules($cfg));\n\t\t\t$new_rules_nonls[]       = $new_rules_backend_nonls[] = self::MARKER_BROWSER_CACHE . self::MARKER_END;\n\t\t\t$new_rules_nonls[]       = '';\n\t\t}\n\n\t\t\/\/ Add module wrapper for LiteSpeed rules\n\t\tif ($new_rules) {\n\t\t\t$new_rules = $this->_wrap_ls_module($new_rules);\n\t\t}\n\n\t\tif ($new_rules_backend) {\n\t\t\t$new_rules_backend = $this->_wrap_ls_module($new_rules_backend);\n\t\t}\n\n\t\treturn array( $new_rules, $new_rules_backend, $new_rules_nonls, $new_rules_backend_nonls );\n\t}\n\n\t\/**\n\t * Add LitSpeed module wrapper with rewrite on\n\t *\n\t * @since  2.1.1\n\t * @access private\n\t *\/\n\tprivate function _wrap_ls_module( $rules = array() ) {\n\t\treturn array_merge(array( self::LS_MODULE_START ), $this->__rewrite_on, array( '' ), $rules, array( self::LS_MODULE_END ));\n\t}\n\n\t\/**\n\t * Insert LitSpeed module wrapper with rewrite on\n\t *\n\t * @since  2.1.1\n\t * @access public\n\t *\/\n\tpublic function insert_ls_wrapper() {\n\t\t$rules = $this->_wrap_ls_module();\n\t\t$this->_insert_wrapper($rules);\n\t}\n\n\t\/**\n\t * wrap rules with module on info\n\t *\n\t * @since  1.1.5\n\t * @param  array $rules\n\t * @return array        wrapped rules with module info\n\t *\/\n\tprivate function _wrap_do_no_edit( $rules ) {\n\t\t\/\/ When to clear rules, don't need DONOTEDIT msg\n\t\tif ($rules === false || !is_array($rules)) {\n\t\t\treturn $rules;\n\t\t}\n\n\t\t$rules = array_merge(array( self::LS_MODULE_DONOTEDIT ), $rules, array( self::LS_MODULE_DONOTEDIT ));\n\n\t\treturn $rules;\n\t}\n\n\t\/**\n\t * Write to htaccess with rules\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since  1.1.0\n\t * @access private\n\t *\/\n\tprivate function _insert_wrapper( $rules = array(), $kind = false, $marker = false ) {\n\t\tif ($kind != 'backend') {\n\t\t\t$kind = 'frontend';\n\t\t}\n\n\t\t\/\/ Default marker is LiteSpeed marker `LSCACHE`\n\t\tif ($marker === false) {\n\t\t\t$marker = self::MARKER;\n\t\t}\n\n\t\t$this->_htaccess_backup($kind);\n\n\t\tFile::insert_with_markers($this->htaccess_path($kind), $this->_wrap_do_no_edit($rules), $marker, true);\n\t}\n\n\t\/**\n\t * Update rewrite rules based on setting\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since 1.3\n\t * @access public\n\t *\/\n\tpublic function update( $cfg ) {\n\t\tlist($frontend_rules, $backend_rules, $frontend_rules_nonls, $backend_rules_nonls) = $this->_generate_rules($cfg);\n\n\t\t\/\/ Check frontend content\n\t\tlist($rules, $rules_nonls) = $this->_extract_rules();\n\n\t\t\/\/ Check Non-LiteSpeed rules\n\t\tif ($this->_wrap_do_no_edit($frontend_rules_nonls) != $rules_nonls) {\n\t\t\tDebug2::debug('[Rules] Update non-ls frontend rules');\n\t\t\t\/\/ Need to update frontend htaccess\n\t\t\ttry {\n\t\t\t\t$this->_insert_wrapper($frontend_rules_nonls, false, self::MARKER_NONLS);\n\t\t\t} catch (\\Exception $e) {\n\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->frontend_htaccess, $frontend_rules_nonls, self::MARKER_NONLS);\n\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Check LiteSpeed rules\n\t\tif ($this->_wrap_do_no_edit($frontend_rules) != $rules) {\n\t\t\tDebug2::debug('[Rules] Update frontend rules');\n\t\t\t\/\/ Need to update frontend htaccess\n\t\t\ttry {\n\t\t\t\t$this->_insert_wrapper($frontend_rules);\n\t\t\t} catch (\\Exception $e) {\n\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->frontend_htaccess, $frontend_rules);\n\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t}\n\t\t}\n\n\t\tif ($this->frontend_htaccess !== $this->backend_htaccess) {\n\t\t\tlist($rules, $rules_nonls) = $this->_extract_rules('backend');\n\n\t\t\t\/\/ Check Non-LiteSpeed rules for backend\n\t\t\tif ($this->_wrap_do_no_edit($backend_rules_nonls) != $rules_nonls) {\n\t\t\t\tDebug2::debug('[Rules] Update non-ls backend rules');\n\t\t\t\t\/\/ Need to update frontend htaccess\n\t\t\t\ttry {\n\t\t\t\t\t$this->_insert_wrapper($backend_rules_nonls, 'backend', self::MARKER_NONLS);\n\t\t\t\t} catch (\\Exception $e) {\n\t\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->backend_htaccess, $backend_rules_nonls, self::MARKER_NONLS);\n\t\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\/\/ Check backend content\n\t\t\tif ($this->_wrap_do_no_edit($backend_rules) != $rules) {\n\t\t\t\tDebug2::debug('[Rules] Update backend rules');\n\t\t\t\t\/\/ Need to update backend htaccess\n\t\t\t\ttry {\n\t\t\t\t\t$this->_insert_wrapper($backend_rules, 'backend');\n\t\t\t\t} catch (\\Exception $e) {\n\t\t\t\t\tDebug2::debug('[Rules] Update Failed');\n\t\t\t\t\t$manual_guide_codes = $this->_rewrite_codes_msg($this->backend_htaccess, $backend_rules);\n\t\t\t\t\tthrow new \\Exception($manual_guide_codes);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Get existing rewrite rules\n\t *\n\t * NOTE: will throw error if failed\n\t *\n\t * @since  1.3\n\t * @access private\n\t * @param  string $kind Frontend or backend .htaccess file\n\t *\/\n\tprivate function _extract_rules( $kind = 'frontend' ) {\n\t\tclearstatcache();\n\t\t$path = $this->htaccess_path($kind);\n\t\tif (!$this->_readable($kind)) {\n\t\t\tError::t('E_HTA_R');\n\t\t}\n\n\t\t$rules       = File::extract_from_markers($path, self::MARKER);\n\t\t$rules_nonls = File::extract_from_markers($path, self::MARKER_NONLS);\n\n\t\treturn array( $rules, $rules_nonls );\n\t}\n\n\t\/**\n\t * Output the msg with rules plain data for manual insert\n\t *\n\t * @since  1.1.5\n\t * @param  string $file\n\t * @param  array  $rules\n\t * @return string        final msg to output\n\t *\/\n\tprivate function _rewrite_codes_msg( $file, $rules, $marker = false ) {\n\t\treturn sprintf(\n\t\t\t__('<p>Please add\/replace the following codes into the beginning of %1$s:<\/p> %2$s', 'litespeed-cache'),\n\t\t\t$file,\n\t\t\t'<textarea style=\"width:100%;\" rows=\"10\" readonly>' . htmlspecialchars($this->_wrap_rules_with_marker($rules, $marker)) . '<\/textarea>'\n\t\t);\n\t}\n\n\t\/**\n\t * Generate rules plain data for manual insert\n\t *\n\t * @since  1.1.5\n\t *\/\n\tprivate function _wrap_rules_with_marker( $rules, $marker = false ) {\n\t\t\/\/ Default marker is LiteSpeed marker `LSCACHE`\n\t\tif ($marker === false) {\n\t\t\t$marker = self::MARKER;\n\t\t}\n\n\t\t$start_marker  = \"# BEGIN {$marker}\";\n\t\t$end_marker    = \"# END {$marker}\";\n\t\t$new_file_data = implode(\"\\n\", array_merge(array( $start_marker ), $this->_wrap_do_no_edit($rules), array( $end_marker )));\n\n\t\treturn $new_file_data;\n\t}\n\n\t\/**\n\t * Clear the rules file of any changes added by the plugin specifically.\n\t *\n\t * @since 1.0.4\n\t * @access public\n\t *\/\n\tpublic function clear_rules() {\n\t\t$this->_insert_wrapper(false); \/\/ Use false to avoid do-not-edit msg\n\t\t\/\/ Clear non ls rules\n\t\t$this->_insert_wrapper(false, false, self::MARKER_NONLS);\n\n\t\tif ($this->frontend_htaccess !== $this->backend_htaccess) {\n\t\t\t$this->_insert_wrapper(false, 'backend');\n\t\t\t$this->_insert_wrapper(false, 'backend', self::MARKER_NONLS);\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/purge.cls.php","ext":"php","size":32406,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The plugin purge class for X-LiteSpeed-Purge\n *\n * @since       1.1.3\n * @since       2.2 Refactored. Changed access from public to private for most func and class variables.\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Purge extends Base {\n\n\tconst LOG_TAG = '\ud83e\uddf9';\n\n\tprotected $_pub_purge    = array();\n\tprotected $_pub_purge2   = array();\n\tprotected $_priv_purge   = array();\n\tprotected $_purge_single = false;\n\n\tconst X_HEADER  = 'X-LiteSpeed-Purge';\n\tconst X_HEADER2 = 'X-LiteSpeed-Purge2';\n\tconst DB_QUEUE  = 'queue';\n\tconst DB_QUEUE2 = 'queue2';\n\n\tconst TYPE_PURGE_ALL          = 'purge_all';\n\tconst TYPE_PURGE_ALL_LSCACHE  = 'purge_all_lscache';\n\tconst TYPE_PURGE_ALL_CSSJS    = 'purge_all_cssjs';\n\tconst TYPE_PURGE_ALL_LOCALRES = 'purge_all_localres';\n\tconst TYPE_PURGE_ALL_CCSS     = 'purge_all_ccss';\n\tconst TYPE_PURGE_ALL_UCSS     = 'purge_all_ucss';\n\tconst TYPE_PURGE_ALL_LQIP     = 'purge_all_lqip';\n\tconst TYPE_PURGE_ALL_AVATAR   = 'purge_all_avatar';\n\tconst TYPE_PURGE_ALL_OBJECT   = 'purge_all_object';\n\tconst TYPE_PURGE_ALL_OPCACHE  = 'purge_all_opcache';\n\n\tconst TYPE_PURGE_FRONT     = 'purge_front';\n\tconst TYPE_PURGE_UCSS      = 'purge_ucss';\n\tconst TYPE_PURGE_FRONTPAGE = 'purge_frontpage';\n\tconst TYPE_PURGE_PAGES     = 'purge_pages';\n\tconst TYPE_PURGE_ERROR     = 'purge_error';\n\n\t\/**\n\t * Init hooks\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function init() {\n\t\t\/\/ Register purge actions.\n\t\t\/\/ Most used values: edit_post, save_post, delete_post, wp_trash_post, clean_post_cache, wp_update_comment_count\n\t\t$purge_post_events = apply_filters('litespeed_purge_post_events', array(\n\t\t\t'delete_post',\n\t\t\t'wp_trash_post',\n\t\t\t\/\/ 'clean_post_cache', \/\/ This will disable wc's not purge product when stock status not change setting\n\t\t\t'wp_update_comment_count', \/\/ TODO: check if needed for non ESI\n\t\t));\n\n\t\tforeach ($purge_post_events as $event) {\n\t\t\t\/\/ this will purge all related tags\n\t\t\tadd_action($event, array( $this, 'purge_post' ));\n\t\t}\n\n\t\t\/\/ Purge post only when status is\/was publish\n\t\tadd_action('transition_post_status', array( $this, 'purge_publish' ), 10, 3);\n\n\t\tadd_action('wp_update_comment_count', array( $this, 'purge_feeds' ));\n\n\t\tif ($this->conf(self::O_OPTM_UCSS)) {\n\t\t\tadd_action('edit_post', __NAMESPACE__ . '\\Purge::purge_ucss');\n\t\t}\n\t}\n\n\t\/**\n\t * Only purge publish related status post\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function purge_publish( $new_status, $old_status, $post ) {\n\t\tif ($new_status != 'publish' && $old_status != 'publish') {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->purge_post($post->ID);\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_PURGE_ALL:\n            $this->_purge_all();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_LSCACHE:\n            $this->_purge_all_lscache();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_CSSJS:\n            $this->_purge_all_cssjs();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_LOCALRES:\n            $this->_purge_all_localres();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_CCSS:\n            $this->_purge_all_ccss();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_UCSS:\n            $this->_purge_all_ucss();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_LQIP:\n            $this->_purge_all_lqip();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_AVATAR:\n            $this->_purge_all_avatar();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_OBJECT:\n            $this->_purge_all_object();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_ALL_OPCACHE:\n            $this->purge_all_opcache();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_FRONT:\n            $this->_purge_front();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_UCSS:\n            $this->_purge_ucss();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_FRONTPAGE:\n            $this->_purge_frontpage();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PURGE_PAGES:\n            $this->_purge_pages();\n\t\t\t\tbreak;\n\n\t\t\tcase strpos($type, self::TYPE_PURGE_ERROR) === 0:\n            $this->_purge_error(substr($type, strlen(self::TYPE_PURGE_ERROR)));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n\n\t\/**\n\t * Shortcut to purge all lscache\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t *\/\n\tpublic static function purge_all( $reason = false ) {\n\t\tself::cls()->_purge_all($reason);\n\t}\n\n\t\/**\n\t * Purge all caches (lscache\/op\/oc)\n\t *\n\t * @since 2.2\n\t * @access private\n\t *\/\n\tprivate function _purge_all( $reason = false ) {\n\t\t\/\/ if ( defined( 'LITESPEED_CLI' ) ) {\n\t\t\/\/ Can't send, already has output, need to save and wait for next run\n\t\t\/\/ self::update_option( self::DB_QUEUE, $curr_built );\n\t\t\/\/ self::debug( 'CLI request, queue stored: ' . $curr_built );\n\t\t\/\/ }\n\t\t\/\/ else {\n\t\t$this->_purge_all_lscache(true);\n\t\t$this->_purge_all_cssjs(true);\n\t\t$this->_purge_all_localres(true);\n\t\t\/\/ $this->_purge_all_ccss( true );\n\t\t\/\/ $this->_purge_all_lqip( true );\n\t\t$this->_purge_all_object(true);\n\t\t$this->purge_all_opcache(true);\n\t\t\/\/ }\n\n\t\tif ($this->conf(self::O_CDN_CLOUDFLARE_CLEAR)) {\n\t\t\tCDN\\Cloudflare::purge_all('Purge All');\n\t\t}\n\n\t\tif (!is_string($reason)) {\n\t\t\t$reason = false;\n\t\t}\n\n\t\tif ($reason) {\n\t\t\t$reason = \"( $reason )\";\n\t\t}\n\n\t\tself::debug('Purge all ' . $reason, 3);\n\n\t\t$msg = __('Purged all caches successfully.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\n\t\tdo_action('litespeed_purged_all');\n\t}\n\n\t\/**\n\t * Alerts LiteSpeed Web Server to purge all pages.\n\t *\n\t * For multisite installs, if this is called by a site admin (not network admin),\n\t * it will only purge all posts associated with that site.\n\t *\n\t * @since 2.2\n\t * @access public\n\t *\/\n\tprivate function _purge_all_lscache( $silence = false ) {\n\t\t$this->_add('*');\n\n\t\t\/\/ Action to run after server was notified to delete LSCache entries.\n\t\tdo_action('litespeed_purged_all_lscache');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Notified LiteSpeed Web Server to purge all LSCache entries.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Delete all critical css\n\t *\n\t * @since    2.3\n\t * @access   private\n\t *\/\n\tprivate function _purge_all_ccss( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_ccss');\n\n\t\t$this->cls('CSS')->rm_cache_folder('ccss');\n\n\t\t$this->cls('Data')->url_file_clean('ccss');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all Critical CSS files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Delete all unique css\n\t *\n\t * @since    2.3\n\t * @access   private\n\t *\/\n\tprivate function _purge_all_ucss( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_ucss');\n\n\t\t$this->cls('CSS')->rm_cache_folder('ucss');\n\n\t\t$this->cls('Data')->url_file_clean('ucss');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all Unique CSS files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Purge one UCSS by URL\n\t *\n\t * @since 4.5\n\t * @access public\n\t *\/\n\tpublic static function purge_ucss( $post_id_or_url ) {\n\t\tself::debug('Purge a single UCSS: ' . $post_id_or_url);\n\t\t\/\/ If is post_id, generate URL\n\t\tif (!preg_match('\/\\D\/', $post_id_or_url)) {\n\t\t\t$post_id_or_url = get_permalink($post_id_or_url);\n\t\t}\n\t\t$post_id_or_url = untrailingslashit($post_id_or_url);\n\n\t\t$existing_url_files = Data::cls()->mark_as_expired($post_id_or_url, true);\n\t\tif ($existing_url_files) {\n\t\t\t\/\/ Add to UCSS Q\n\t\t\tself::cls('UCSS')->add_to_q($existing_url_files);\n\t\t}\n\t}\n\n\t\/**\n\t * Delete all LQIP images\n\t *\n\t * @since    3.0\n\t * @access   private\n\t *\/\n\tprivate function _purge_all_lqip( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_lqip');\n\n\t\t$this->cls('Placeholder')->rm_cache_folder('lqip');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all LQIP files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Delete all avatar images\n\t *\n\t * @since    3.0\n\t * @access   private\n\t *\/\n\tprivate function _purge_all_avatar( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_avatar');\n\n\t\t$this->cls('Avatar')->rm_cache_folder('avatar');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all Gravatar files.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Delete all localized JS\n\t *\n\t * @since    3.3\n\t * @access   private\n\t *\/\n\tprivate function _purge_all_localres( $silence = false ) {\n\t\tdo_action('litespeed_purged_all_localres');\n\n\t\t$this->_add(Tag::TYPE_LOCALRES);\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Cleaned all localized resource entries.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Alerts LiteSpeed Web Server to purge pages.\n\t *\n\t * @since    1.2.2\n\t * @access   private\n\t *\/\n\tprivate function _purge_all_cssjs( $silence = false ) {\n\t\tif (wp_doing_cron() || defined('LITESPEED_DID_send_headers')) {\n\t\t\tself::debug('\u274c Bypassed cssjs delete as header sent (lscache purge after this point will fail) or doing cron');\n\t\t\treturn;\n\t\t}\n\t\t$this->_purge_all_lscache($silence); \/\/ Purge CSSJS must purge lscache too to avoid 404\n\n\t\tdo_action('litespeed_purged_all_cssjs');\n\n\t\tOptimize::update_option(Optimize::ITEM_TIMESTAMP_PURGE_CSS, time());\n\n\t\t$this->_add(Tag::TYPE_MIN);\n\n\t\t$this->cls('CSS')->rm_cache_folder('css');\n\t\t$this->cls('CSS')->rm_cache_folder('js');\n\n\t\t$this->cls('Data')->url_file_clean('css');\n\t\t$this->cls('Data')->url_file_clean('js');\n\n\t\t\/\/ Clear UCSS queue as it used combined CSS to generate\n\t\t$this->clear_q('ucss', true);\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Notified LiteSpeed Web Server to purge CSS\/JS entries.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Purge opcode cache\n\t *\n\t * @since  1.8.2\n\t * @since  7.3 added test for opcode cache restriction\n\t * @access public\n\t *\/\n\tpublic function purge_all_opcache( $silence = false ) {\n\t\tif (!Router::opcache_enabled()) {\n\t\t\tself::debug('\u274c Failed to reset OPcache due to OPcache not enabled');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = __('OPcache is not enabled.', 'litespeed-cache');\n\t\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::error($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Router::opcache_restricted(__FILE__)) {\n\t\t\tself::debug('\u274c Failed to reset OPcache due to OPcache is restricted. File requesting the clear is not allowed.');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = sprintf(__('OPcache is restricted by %s setting.', 'litespeed-cache'), '<code>restrict_api<\/code>');\n\t\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::error($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Purge opcode cache\n\t\tif (!opcache_reset()) {\n\t\t\tself::debug('\u274c Reset OPcache not worked');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = __('Reset the OPcache failed.', 'litespeed-cache');\n\t\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Action to run after opcache purge.\n\t\tdo_action('litespeed_purged_all_opcache');\n\n\t\tself::debug('Reset OPcache');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Reset the entire OPcache successfully.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Purge object cache\n\t *\n\t * @since  3.4\n\t * @access public\n\t *\/\n\tpublic static function purge_all_object( $silence = true ) {\n\t\tself::cls()->_purge_all_object($silence);\n\t}\n\n\t\/**\n\t * Purge object cache\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\/\n\tprivate function _purge_all_object( $silence = false ) {\n\t\tif (!defined('LSCWP_OBJECT_CACHE')) {\n\t\t\tself::debug('Failed to flush object cache due to object cache not enabled');\n\n\t\t\tif (!$silence) {\n\t\t\t\t$msg = __('Object cache is not enabled.', 'litespeed-cache');\n\t\t\t\tAdmin_Display::error($msg);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tdo_action('litespeed_purged_all_object');\n\n\t\t$this->cls('Object_Cache')->flush();\n\t\tself::debug('Flushed object cache');\n\n\t\tif (!$silence) {\n\t\t\t$msg = __('Purge all object caches successfully.', 'litespeed-cache');\n\t\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Adds new public purge tags to the array of purge tags for the request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param mixed $tags Tags to add to the list.\n\t *\/\n\tpublic static function add( $tags, $purge2 = false ) {\n\t\tself::cls()->_add($tags, $purge2);\n\t}\n\n\t\/**\n\t * Add tags to purge\n\t *\n\t * @since 2.2\n\t * @access private\n\t *\/\n\tprivate function _add( $tags, $purge2 = false ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\t$tags = $this->_prepend_bid($tags);\n\n\t\tif (!array_diff($tags, $purge2 ? $this->_pub_purge2 : $this->_pub_purge)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ($purge2) {\n\t\t\t$this->_pub_purge2 = array_merge($this->_pub_purge2, $tags);\n\t\t\t$this->_pub_purge2 = array_unique($this->_pub_purge2);\n\t\t} else {\n\t\t\t$this->_pub_purge = array_merge($this->_pub_purge, $tags);\n\t\t\t$this->_pub_purge = array_unique($this->_pub_purge);\n\t\t}\n\t\tself::debug('added ' . implode(',', $tags) . ($purge2 ? ' [Purge2]' : ''), 8);\n\n\t\t\/\/ Send purge header immediately\n\t\t$curr_built = $this->_build($purge2);\n\t\tif (defined('LITESPEED_CLI')) {\n\t\t\t\/\/ Can't send, already has output, need to save and wait for next run\n\t\t\tself::update_option($purge2 ? self::DB_QUEUE2 : self::DB_QUEUE, $curr_built);\n\t\t\tself::debug('CLI request, queue stored: ' . $curr_built);\n\t\t} else {\n\t\t\t@header($curr_built);\n\t\t\tif (wp_doing_cron() || defined('LITESPEED_DID_send_headers') || apply_filters('litespeed_delay_purge', false)) {\n\t\t\t\tself::update_option($purge2 ? self::DB_QUEUE2 : self::DB_QUEUE, $curr_built);\n\t\t\t\tself::debug('Output existed, queue stored: ' . $curr_built);\n\t\t\t}\n\t\t\tself::debug($curr_built);\n\t\t}\n\t}\n\n\t\/**\n\t * Adds new private purge tags to the array of purge tags for the request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param mixed $tags Tags to add to the list.\n\t *\/\n\tpublic static function add_private( $tags ) {\n\t\tself::cls()->_add_private($tags);\n\t}\n\n\t\/**\n\t * Add private ESI tag to purge list\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function add_private_esi( $tag ) {\n\t\tself::add_private(Tag::TYPE_ESI . $tag);\n\t}\n\n\t\/**\n\t * Add private all tag to purge list\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function add_private_all() {\n\t\tself::add_private('*');\n\t}\n\n\t\/**\n\t * Add tags to private purge\n\t *\n\t * @since 2.2\n\t * @access private\n\t *\/\n\tprivate function _add_private( $tags ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\t$tags = $this->_prepend_bid($tags);\n\n\t\tif (!array_diff($tags, $this->_priv_purge)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('added [private] ' . implode(',', $tags), 3);\n\n\t\t$this->_priv_purge = array_merge($this->_priv_purge, $tags);\n\t\t$this->_priv_purge = array_unique($this->_priv_purge);\n\n\t\t\/\/ Send purge header immediately\n\t\t@header($this->_build());\n\t}\n\n\t\/**\n\t * Incorporate blog_id into purge tags for multisite\n\t *\n\t * @since 4.0\n\t * @access private\n\t * @param mixed $tags Tags to add to the list.\n\t *\/\n\tprivate function _prepend_bid( $tags ) {\n\t\tif (in_array('*', $tags)) {\n\t\t\treturn array( '*' );\n\t\t}\n\n\t\t$curr_bid = is_multisite() ? get_current_blog_id() : '';\n\n\t\tforeach ($tags as $k => $v) {\n\t\t\t$tags[$k] = $curr_bid . '_' . $v;\n\t\t}\n\t\treturn $tags;\n\t}\n\n\t\/**\n\t * Activate `purge related tags` for Admin QS.\n\t *\n\t * @since    1.1.3\n\t * @access   public\n\t * @deprecated @7.0 Drop @v7.5\n\t *\/\n\tpublic static function set_purge_related() {\n\t}\n\n\t\/**\n\t * Activate `purge single url tag` for Admin QS.\n\t *\n\t * @since    1.1.3\n\t * @access   public\n\t *\/\n\tpublic static function set_purge_single() {\n\t\tself::cls()->_purge_single = true;\n\t\tdo_action('litespeed_purged_single');\n\t}\n\n\t\/**\n\t * Purge frontend url\n\t *\n\t * @since 1.3\n\t * @since 2.2 Renamed from `frontend_purge`; Access changed from public\n\t * @access private\n\t *\/\n\tprivate function _purge_front() {\n\t\tif (empty($_SERVER['HTTP_REFERER'])) {\n\t\t\texit('no referer');\n\t\t}\n\n\t\t$this->purge_url($_SERVER['HTTP_REFERER']);\n\n\t\tdo_action('litespeed_purged_front', $_SERVER['HTTP_REFERER']);\n\t\twp_redirect($_SERVER['HTTP_REFERER']);\n\t\texit();\n\t}\n\n\t\/**\n\t * Purge single UCSS\n\t *\n\t * @since 4.7\n\t *\/\n\tprivate function _purge_ucss() {\n\t\tif (empty($_SERVER['HTTP_REFERER'])) {\n\t\t\texit('no referer');\n\t\t}\n\n\t\t$url_tag = empty($_GET['url_tag']) ? $_SERVER['HTTP_REFERER'] : $_GET['url_tag'];\n\n\t\tself::debug('Purge ucss [url_tag] ' . $url_tag);\n\n\t\tdo_action('litespeed_purge_ucss', $url_tag);\n\t\t$this->purge_url($_SERVER['HTTP_REFERER']);\n\n\t\twp_redirect($_SERVER['HTTP_REFERER']);\n\t\texit();\n\t}\n\n\t\/**\n\t * Alerts LiteSpeed Web Server to purge the front page.\n\t *\n\t * @since    1.0.3\n\t * @since    2.2    Access changed from public to private, renamed from `_purge_front`\n\t * @access   private\n\t *\/\n\tprivate function _purge_frontpage() {\n\t\t$this->_add(Tag::TYPE_FRONTPAGE);\n\t\tif (LITESPEED_SERVER_TYPE !== 'LITESPEED_SERVER_OLS') {\n\t\t\t$this->_add_private(Tag::TYPE_FRONTPAGE);\n\t\t}\n\n\t\t$msg = __('Notified LiteSpeed Web Server to purge the front page.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\tdo_action('litespeed_purged_frontpage');\n\t}\n\n\t\/**\n\t * Alerts LiteSpeed Web Server to purge pages.\n\t *\n\t * @since    1.0.15\n\t * @access   private\n\t *\/\n\tprivate function _purge_pages() {\n\t\t$this->_add(Tag::TYPE_PAGES);\n\n\t\t$msg = __('Notified LiteSpeed Web Server to purge all pages.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t\tdo_action('litespeed_purged_pages');\n\t}\n\n\t\/**\n\t * Alerts LiteSpeed Web Server to purge error pages.\n\t *\n\t * @since    1.0.14\n\t * @access   private\n\t *\/\n\tprivate function _purge_error( $type = false ) {\n\t\t$this->_add(Tag::TYPE_HTTP);\n\n\t\tif (!$type || !in_array($type, array( '403', '404', '500' ))) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_add(Tag::TYPE_HTTP . $type);\n\n\t\t$msg = __('Notified LiteSpeed Web Server to purge error pages.', 'litespeed-cache');\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Callback to add purge tags if admin selects to purge selected category pages.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t *\/\n\tpublic function purge_cat( $value ) {\n\t\t$val = trim($value);\n\t\tif (empty($val)) {\n\t\t\treturn;\n\t\t}\n\t\tif (preg_match('\/^[a-zA-Z0-9-]+$\/', $val) == 0) {\n\t\t\tself::debug(\"$val cat invalid\");\n\t\t\treturn;\n\t\t}\n\t\t$cat = get_category_by_slug($val);\n\t\tif ($cat == false) {\n\t\t\tself::debug(\"$val cat not existed\/published\");\n\t\t\treturn;\n\t\t}\n\n\t\tself::add(Tag::TYPE_ARCHIVE_TERM . $cat->term_id);\n\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success(sprintf(__('Purge category %s', 'litespeed-cache'), $val));\n\n\t\t\/\/ Action to run after category purge.\n\t\tdo_action('litespeed_purged_cat', $value);\n\t}\n\n\t\/**\n\t * Callback to add purge tags if admin selects to purge selected tag pages.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t *\/\n\tpublic function purge_tag( $val ) {\n\t\t$val = trim($val);\n\t\tif (empty($val)) {\n\t\t\treturn;\n\t\t}\n\t\tif (preg_match('\/^[a-zA-Z0-9-]+$\/', $val) == 0) {\n\t\t\tself::debug(\"$val tag invalid\");\n\t\t\treturn;\n\t\t}\n\t\t$term = get_term_by('slug', $val, 'post_tag');\n\t\tif ($term === false) {\n\t\t\tself::debug(\"$val tag not exist\");\n\t\t\treturn;\n\t\t}\n\n\t\tself::add(Tag::TYPE_ARCHIVE_TERM . $term->term_id);\n\n\t\t!defined('LITESPEED_PURGE_SILENT') && Admin_Display::success(sprintf(__('Purge tag %s', 'litespeed-cache'), $val));\n\n\t\t\/\/ Action to run after tag purge.\n\t\tdo_action('litespeed_purged_tag', $val);\n\t}\n\n\t\/**\n\t * Callback to add purge tags if admin selects to purge selected urls.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t *\/\n\tpublic function purge_url( $url, $purge2 = false, $quite = false ) {\n\t\t$val = trim($url);\n\t\tif (empty($val)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (strpos($val, '<') !== false) {\n\t\t\tself::debug(\"$val url contains <\");\n\t\t\treturn;\n\t\t}\n\n\t\t$val = Utility::make_relative($val);\n\n\t\t$hash = Tag::get_uri_tag($val);\n\n\t\tif ($hash === false) {\n\t\t\tself::debug(\"$val url invalid\");\n\t\t\treturn;\n\t\t}\n\n\t\tself::add($hash, $purge2);\n\n\t\t!$quite && !defined('LITESPEED_PURGE_SILENT') && Admin_Display::success(sprintf(__('Purge url %s', 'litespeed-cache'), $val));\n\n\t\t\/\/ Action to run after url purge.\n\t\tdo_action('litespeed_purged_link', $url);\n\t}\n\n\t\/**\n\t * Purge a list of pages when selected by admin. This method will look at the post arguments to determine how and what to purge.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t *\/\n\tpublic function purge_list() {\n\t\tif (!isset($_REQUEST[Admin_Display::PURGEBYOPT_SELECT]) || !isset($_REQUEST[Admin_Display::PURGEBYOPT_LIST])) {\n\t\t\treturn;\n\t\t}\n\t\t$sel      = $_REQUEST[Admin_Display::PURGEBYOPT_SELECT];\n\t\t$list_buf = $_REQUEST[Admin_Display::PURGEBYOPT_LIST];\n\t\tif (empty($list_buf)) {\n\t\t\treturn;\n\t\t}\n\t\t$list_buf = str_replace(',', \"\\n\", $list_buf); \/\/ for cli\n\t\t$list     = explode(\"\\n\", $list_buf);\n\t\tswitch ($sel) {\n\t\t\tcase Admin_Display::PURGEBY_CAT:\n            $cb = 'purge_cat';\n\t\t\t\tbreak;\n\t\t\tcase Admin_Display::PURGEBY_PID:\n            $cb = 'purge_post';\n\t\t\t\tbreak;\n\t\t\tcase Admin_Display::PURGEBY_TAG:\n            $cb = 'purge_tag';\n\t\t\t\tbreak;\n\t\t\tcase Admin_Display::PURGEBY_URL:\n            $cb = 'purge_url';\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t}\n\t\tarray_map(array( $this, $cb ), $list);\n\n\t\t\/\/ for redirection\n\t\t$_GET[Admin_Display::PURGEBYOPT_SELECT] = $sel;\n\t}\n\n\t\/**\n\t * Purge ESI\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function purge_esi( $tag ) {\n\t\tself::add(Tag::TYPE_ESI . $tag);\n\t\tdo_action('litespeed_purged_esi', $tag);\n\t}\n\n\t\/**\n\t * Purge a certain post type\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function purge_posttype( $post_type ) {\n\t\tself::add(Tag::TYPE_ARCHIVE_POSTTYPE . $post_type);\n\t\tself::add($post_type);\n\n\t\tdo_action('litespeed_purged_posttype', $post_type);\n\t}\n\n\t\/**\n\t * Purge all related tags to a post.\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t *\/\n\tpublic function purge_post( $pid ) {\n\t\t$pid = intval($pid);\n\t\t\/\/ ignore the status we don't care\n\t\tif (!$pid || !in_array(get_post_status($pid), array( 'publish', 'trash', 'private', 'draft' ))) {\n\t\t\treturn;\n\t\t}\n\n\t\t$purge_tags = $this->_get_purge_tags_by_post($pid);\n\t\tif (!$purge_tags) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::add($purge_tags);\n\t\tif ($this->conf(self::O_CACHE_REST)) {\n\t\t\tself::add(Tag::TYPE_REST);\n\t\t}\n\n\t\t\/\/ $this->cls( 'Control' )->set_stale();\n\t\tdo_action('litespeed_purged_post', $pid);\n\t}\n\n\t\/**\n\t * Hooked to the load-widgets.php action.\n\t * Attempts to purge a single widget from cache.\n\t * If no widget id is passed in, the method will attempt to find the widget id.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic static function purge_widget( $widget_id = null ) {\n\t\tif (is_null($widget_id)) {\n\t\t\t$widget_id = $_POST['widget-id'];\n\t\t\tif (is_null($widget_id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tself::add(Tag::TYPE_WIDGET . $widget_id);\n\t\tself::add_private(Tag::TYPE_WIDGET . $widget_id);\n\n\t\tdo_action('litespeed_purged_widget', $widget_id);\n\t}\n\n\t\/**\n\t * Hooked to the wp_update_comment_count action.\n\t * Purges the comment widget when the count is updated.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global type $wp_widget_factory\n\t *\/\n\tpublic static function purge_comment_widget() {\n\t\tglobal $wp_widget_factory;\n\t\tif (!isset($wp_widget_factory->widgets['WP_Widget_Recent_Comments'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$recent_comments = $wp_widget_factory->widgets['WP_Widget_Recent_Comments'];\n\t\tif (!is_null($recent_comments)) {\n\t\t\tself::add(Tag::TYPE_WIDGET . $recent_comments->id);\n\t\t\tself::add_private(Tag::TYPE_WIDGET . $recent_comments->id);\n\n\t\t\tdo_action('litespeed_purged_comment_widget', $recent_comments->id);\n\t\t}\n\t}\n\n\t\/**\n\t * Purges feeds on comment count update.\n\t *\n\t * @since 1.0.9\n\t * @access public\n\t *\/\n\tpublic function purge_feeds() {\n\t\tif ($this->conf(self::O_CACHE_TTL_FEED) > 0) {\n\t\t\tself::add(Tag::TYPE_FEED);\n\t\t}\n\t\tdo_action('litespeed_purged_feeds');\n\t}\n\n\t\/**\n\t * Purges all private cache entries when the user logs out.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t *\/\n\tpublic static function purge_on_logout() {\n\t\tself::add_private_all();\n\t\tdo_action('litespeed_purged_on_logout');\n\t}\n\n\t\/**\n\t * Generate all purge tags before output\n\t *\n\t * @access private\n\t * @since 1.1.3\n\t *\/\n\tprivate function _finalize() {\n\t\t\/\/ Make sure header output only run once\n\t\tif (!defined('LITESPEED_DID_' . __FUNCTION__)) {\n\t\t\tdefine('LITESPEED_DID_' . __FUNCTION__, true);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_purge_finalize');\n\n\t\t\/\/ Append unique uri purge tags if Admin QS is `PURGESINGLE` or `PURGE`\n\t\tif ($this->_purge_single) {\n\t\t\t$tags             = array( Tag::build_uri_tag() );\n\t\t\t$this->_pub_purge = array_merge($this->_pub_purge, $this->_prepend_bid($tags));\n\t\t}\n\n\t\tif (!empty($this->_pub_purge)) {\n\t\t\t$this->_pub_purge = array_unique($this->_pub_purge);\n\t\t}\n\n\t\tif (!empty($this->_priv_purge)) {\n\t\t\t$this->_priv_purge = array_unique($this->_priv_purge);\n\t\t}\n\t}\n\n\t\/**\n\t * Gathers all the purge headers.\n\t *\n\t * This will collect all site wide purge tags as well as third party plugin defined purge tags.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return string the built purge header\n\t *\/\n\tpublic static function output() {\n\t\t$instance = self::cls();\n\n\t\t$instance->_finalize();\n\n\t\treturn $instance->_build();\n\t}\n\n\t\/**\n\t * Build the current purge headers.\n\t *\n\t * @since 1.1.5\n\t * @access private\n\t * @return string the built purge header\n\t *\/\n\tprivate function _build( $purge2 = false ) {\n\t\tif ($purge2) {\n\t\t\tif (empty($this->_pub_purge2)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} elseif (empty($this->_pub_purge) && empty($this->_priv_purge)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$purge_header = '';\n\n\t\t\/\/ Handle purge2 @since 4.4.1\n\t\tif ($purge2) {\n\t\t\t$public_tags = $this->_append_prefix($this->_pub_purge2);\n\t\t\tif (empty($public_tags)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$purge_header = self::X_HEADER2 . ': public,';\n\t\t\tif (Control::is_stale()) {\n\t\t\t\t$purge_header .= 'stale,';\n\t\t\t}\n\t\t\t$purge_header .= implode(',', $public_tags);\n\t\t\treturn $purge_header;\n\t\t}\n\n\t\t$private_prefix = self::X_HEADER . ': private,';\n\n\t\tif (!empty($this->_pub_purge)) {\n\t\t\t$public_tags = $this->_append_prefix($this->_pub_purge);\n\t\t\tif (empty($public_tags)) {\n\t\t\t\t\/\/ If this ends up empty, private will also end up empty\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$purge_header = self::X_HEADER . ': public,';\n\t\t\tif (Control::is_stale()) {\n\t\t\t\t$purge_header .= 'stale,';\n\t\t\t}\n\t\t\t$purge_header  .= implode(',', $public_tags);\n\t\t\t$private_prefix = ';private,';\n\t\t}\n\n\t\t\/\/ Handle priv purge tags\n\t\tif (!empty($this->_priv_purge)) {\n\t\t\t$private_tags  = $this->_append_prefix($this->_priv_purge, true);\n\t\t\t$purge_header .= $private_prefix . implode(',', $private_tags);\n\t\t}\n\n\t\treturn $purge_header;\n\t}\n\n\t\/**\n\t * Append prefix to an array of purge headers\n\t *\n\t * @since 1.1.0\n\t * @access private\n\t *\/\n\tprivate function _append_prefix( $purge_tags, $is_private = false ) {\n\t\t$curr_bid = is_multisite() ? get_current_blog_id() : '';\n\n\t\t$purge_tags = apply_filters('litespeed_purge_tags', $purge_tags, $is_private);\n\t\tif (!in_array('*', $purge_tags)) {\n\t\t\t$tags = array();\n\t\t\tforeach ($purge_tags as $val) {\n\t\t\t\t$tags[] = LSWCP_TAG_PREFIX . $val;\n\t\t\t}\n\t\t\treturn $tags;\n\t\t}\n\n\t\t\/\/ Purge All need to check if need to reset crawler or not\n\t\tif (!$is_private && $this->conf(self::O_CRAWLER)) {\n\t\t\tCrawler::cls()->reset_pos();\n\t\t}\n\n\t\tif ((defined('LSWCP_EMPTYCACHE') && LSWCP_EMPTYCACHE) || $is_private) {\n\t\t\treturn array( '*' );\n\t\t}\n\n\t\tif (is_multisite() && !$this->_is_subsite_purge()) {\n\t\t\t$blogs = Activation::get_network_ids();\n\t\t\tif (empty($blogs)) {\n\t\t\t\tself::debug('build_purge_headers: blog list is empty');\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t$tags = array();\n\t\t\tforeach ($blogs as $blog_id) {\n\t\t\t\t$tags[] = LSWCP_TAG_PREFIX . $blog_id . '_';\n\t\t\t}\n\t\t\treturn $tags;\n\t\t} else {\n\t\t\treturn array( LSWCP_TAG_PREFIX . $curr_bid . '_' );\n\t\t}\n\t}\n\n\t\/**\n\t * Check if this purge belongs to a subsite purge\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _is_subsite_purge() {\n\t\tif (!is_multisite()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (is_network_admin()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (defined('LSWCP_EMPTYCACHE') && LSWCP_EMPTYCACHE) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Would only use multisite and network admin except is_network_admin is false for ajax calls, which is used by WordPress updates v4.6+\n\t\tif (Router::is_ajax() && (check_ajax_referer('updates', false, false) || check_ajax_referer('litespeed-purgeall-network', false, false))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Gets all the purge tags correlated with the post about to be purged.\n\t *\n\t * If the purge all pages configuration is set, all pages will be purged.\n\t *\n\t * This includes site wide post types (e.g. front page) as well as any third party plugin specific post tags.\n\t *\n\t * @since 1.0.0\n\t * @access private\n\t *\/\n\tprivate function _get_purge_tags_by_post( $post_id ) {\n\t\t\/\/ If this is a valid post we want to purge the post, the home page and any associated tags & cats\n\t\t\/\/ If not, purge everything on the site.\n\n\t\t$purge_tags = array();\n\n\t\tif ($this->conf(self::O_PURGE_POST_ALL)) {\n\t\t\t\/\/ ignore the rest if purge all\n\t\t\treturn array( '*' );\n\t\t}\n\n\t\t\/\/ now do API hook action for post purge\n\t\tdo_action('litespeed_api_purge_post', $post_id);\n\n\t\t\/\/ post\n\t\t$purge_tags[] = Tag::TYPE_POST . $post_id;\n\t\t$post_status  = get_post_status($post_id);\n\t\tif (function_exists('is_post_status_viewable')) {\n\t\t\t$viewable = is_post_status_viewable($post_status);\n\t\t\tif ($viewable) {\n\t\t\t\t$purge_tags[] = Tag::get_uri_tag(wp_make_link_relative(get_permalink($post_id)));\n\t\t\t}\n\t\t}\n\n\t\t\/\/ for archive of categories|tags|custom tax\n\t\tglobal $post;\n\t\t$original_post = $post;\n\t\t$post          = get_post($post_id);\n\t\t$post_type     = $post->post_type;\n\n\t\tglobal $wp_widget_factory;\n\t\t\/\/ recent_posts\n\t\t$recent_posts = isset($wp_widget_factory->widgets['WP_Widget_Recent_Posts']) ? $wp_widget_factory->widgets['WP_Widget_Recent_Posts'] : null;\n\t\tif (!is_null($recent_posts)) {\n\t\t\t$purge_tags[] = Tag::TYPE_WIDGET . $recent_posts->id;\n\t\t}\n\n\t\t\/\/ get adjacent posts id as related post tag\n\t\tif ($post_type == 'post') {\n\t\t\t$prev_post = get_previous_post();\n\t\t\t$next_post = get_next_post();\n\t\t\tif (!empty($prev_post->ID)) {\n\t\t\t\t$purge_tags[] = Tag::TYPE_POST . $prev_post->ID;\n\t\t\t\tself::debug('--------purge_tags prev is: ' . $prev_post->ID);\n\t\t\t}\n\t\t\tif (!empty($next_post->ID)) {\n\t\t\t\t$purge_tags[] = Tag::TYPE_POST . $next_post->ID;\n\t\t\t\tself::debug('--------purge_tags next is: ' . $next_post->ID);\n\t\t\t}\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_TERM)) {\n\t\t\t$taxonomies = get_object_taxonomies($post_type);\n\t\t\t\/\/ self::debug('purge by post, check tax = ' . var_export($taxonomies, true));\n\t\t\tforeach ($taxonomies as $tax) {\n\t\t\t\t$terms = get_the_terms($post_id, $tax);\n\t\t\t\tif (!empty($terms)) {\n\t\t\t\t\tforeach ($terms as $term) {\n\t\t\t\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_TERM . $term->term_id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ($this->conf(self::O_CACHE_TTL_FEED)) {\n\t\t\t$purge_tags[] = Tag::TYPE_FEED;\n\t\t}\n\n\t\t\/\/ author, for author posts and feed list\n\t\tif ($this->conf(self::O_PURGE_POST_AUTHOR)) {\n\t\t\t$purge_tags[] = Tag::TYPE_AUTHOR . get_post_field('post_author', $post_id);\n\t\t}\n\n\t\t\/\/ archive and feed of post type\n\t\t\/\/ todo: check if type contains space\n\t\tif ($this->conf(self::O_PURGE_POST_POSTTYPE)) {\n\t\t\tif (get_post_type_archive_link($post_type)) {\n\t\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_POSTTYPE . $post_type;\n\t\t\t\t$purge_tags[] = $post_type;\n\t\t\t}\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_FRONTPAGE)) {\n\t\t\t$purge_tags[] = Tag::TYPE_FRONTPAGE;\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_HOMEPAGE)) {\n\t\t\t$purge_tags[] = Tag::TYPE_HOME;\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_PAGES)) {\n\t\t\t$purge_tags[] = Tag::TYPE_PAGES;\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_PAGES_WITH_RECENT_POSTS)) {\n\t\t\t$purge_tags[] = Tag::TYPE_PAGES_WITH_RECENT_POSTS;\n\t\t}\n\n\t\t\/\/ if configured to have archived by date\n\t\t$date = $post->post_date;\n\t\t$date = strtotime($date);\n\n\t\tif ($this->conf(self::O_PURGE_POST_DATE)) {\n\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_DATE . date('Ymd', $date);\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_MONTH)) {\n\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_DATE . date('Ym', $date);\n\t\t}\n\n\t\tif ($this->conf(self::O_PURGE_POST_YEAR)) {\n\t\t\t$purge_tags[] = Tag::TYPE_ARCHIVE_DATE . date('Y', $date);\n\t\t}\n\n\t\t\/\/ Set back to original post as $post_id might affecting the global $post value\n\t\t$post = $original_post;\n\n\t\treturn array_unique($purge_tags);\n\t}\n\n\t\/**\n\t * The dummy filter for purge all\n\t *\n\t * @since 1.1.5\n\t * @access public\n\t * @param string $val The filter value\n\t * @return string     The filter value\n\t *\/\n\tpublic static function filter_with_purge_all( $val ) {\n\t\tself::purge_all();\n\t\treturn $val;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/utility.cls.php","ext":"php","size":21397,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The utility class.\n *\n * @since       1.1.5\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Utility extends Root {\n\n\tprivate static $_internal_domains;\n\n\t\/**\n\t * Validate regex\n\t *\n\t * @since 1.0.9\n\t * @since  3.0 Moved here from admin-settings.cls\n\t * @access public\n\t * @return bool True for valid rules, false otherwise.\n\t *\/\n\tpublic static function syntax_checker( $rules ) {\n\t\treturn preg_match(self::arr2regex($rules), '') !== false;\n\t}\n\n\t\/**\n\t * Combine regex array to regex rule\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic static function arr2regex( $arr, $drop_delimiter = false ) {\n\t\t$arr = self::sanitize_lines($arr);\n\n\t\t$new_arr = array();\n\t\tforeach ($arr as $v) {\n\t\t\t$new_arr[] = preg_quote($v, '#');\n\t\t}\n\n\t\t$regex = implode('|', $new_arr);\n\t\t$regex = str_replace(' ', '\\\\ ', $regex);\n\n\t\tif ($drop_delimiter) {\n\t\t\treturn $regex;\n\t\t}\n\n\t\treturn '#' . $regex . '#';\n\t}\n\n\t\/**\n\t * Replace wildcard to regex\n\t *\n\t * @since  3.2.2\n\t *\/\n\tpublic static function wildcard2regex( $string ) {\n\t\tif (is_array($string)) {\n\t\t\treturn array_map(__CLASS__ . '::wildcard2regex', $string);\n\t\t}\n\n\t\tif (strpos($string, '*') !== false) {\n\t\t\t$string = preg_quote($string, '#');\n\t\t\t$string = str_replace('\\*', '.*', $string);\n\t\t}\n\n\t\treturn $string;\n\t}\n\n\t\/**\n\t * Check if an URL or current page is REST req or not\n\t *\n\t * @since  2.9.3\n\t * @deprecated 2.9.4 Moved to REST class\n\t * @access public\n\t *\/\n\tpublic static function is_rest( $url = false ) {\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Get current page type\n\t *\n\t * @since  2.9\n\t *\/\n\tpublic static function page_type() {\n\t\tglobal $wp_query;\n\t\t$page_type = 'default';\n\n\t\tif ($wp_query->is_page) {\n\t\t\t$page_type = is_front_page() ? 'front' : 'page';\n\t\t} elseif ($wp_query->is_home) {\n\t\t\t$page_type = 'home';\n\t\t} elseif ($wp_query->is_single) {\n\t\t\t\/\/ $page_type = $wp_query->is_attachment ? 'attachment' : 'single';\n\t\t\t$page_type = get_post_type();\n\t\t} elseif ($wp_query->is_category) {\n\t\t\t$page_type = 'category';\n\t\t} elseif ($wp_query->is_tag) {\n\t\t\t$page_type = 'tag';\n\t\t} elseif ($wp_query->is_tax) {\n\t\t\t$page_type = 'tax';\n\t\t\t\/\/ $page_type = get_queried_object()->taxonomy;\n\t\t} elseif ($wp_query->is_archive) {\n\t\t\tif ($wp_query->is_day) {\n\t\t\t\t$page_type = 'day';\n\t\t\t} elseif ($wp_query->is_month) {\n\t\t\t\t$page_type = 'month';\n\t\t\t} elseif ($wp_query->is_year) {\n\t\t\t\t$page_type = 'year';\n\t\t\t} elseif ($wp_query->is_author) {\n\t\t\t\t$page_type = 'author';\n\t\t\t} else {\n\t\t\t\t$page_type = 'archive';\n\t\t\t}\n\t\t} elseif ($wp_query->is_search) {\n\t\t\t$page_type = 'search';\n\t\t} elseif ($wp_query->is_404) {\n\t\t\t$page_type = '404';\n\t\t}\n\n\t\treturn $page_type;\n\n\t\t\/\/ if ( is_404() ) {\n\t\t\/\/ $page_type = '404';\n\t\t\/\/ }\n\t\t\/\/ elseif ( is_singular() ) {\n\t\t\/\/ $page_type = get_post_type();\n\t\t\/\/ }\n\t\t\/\/ elseif ( is_home() && get_option( 'show_on_front' ) == 'page' ) {\n\t\t\/\/ $page_type = 'home';\n\t\t\/\/ }\n\t\t\/\/ elseif ( is_front_page() ) {\n\t\t\/\/ $page_type = 'front';\n\t\t\/\/ }\n\t\t\/\/ elseif ( is_tax() ) {\n\t\t\/\/ $page_type = get_queried_object()->taxonomy;\n\t\t\/\/ }\n\t\t\/\/ elseif ( is_category() ) {\n\t\t\/\/ $page_type = 'category';\n\t\t\/\/ }\n\t\t\/\/ elseif ( is_tag() ) {\n\t\t\/\/ $page_type = 'tag';\n\t\t\/\/ }\n\n\t\t\/\/ return $page_type;\n\t}\n\n\t\/**\n\t * Get ping speed\n\t *\n\t * @since  2.9\n\t *\/\n\tpublic static function ping( $domain ) {\n\t\tif (strpos($domain, ':')) {\n\t\t\t$domain = parse_url($domain, PHP_URL_HOST);\n\t\t}\n\t\t$starttime = microtime(true);\n\t\t$file      = fsockopen($domain, 443, $errno, $errstr, 10);\n\t\t$stoptime  = microtime(true);\n\t\t$status    = 0;\n\n\t\tif (!$file) {\n\t\t\t$status = 99999;\n\t\t}\n\t\t\/\/ Site is down\n\t\telse {\n\t\t\tfclose($file);\n\t\t\t$status = ($stoptime - $starttime) * 1000;\n\t\t\t$status = floor($status);\n\t\t}\n\n\t\tDebug2::debug(\"[Util] ping [Domain] $domain \\t[Speed] $status\");\n\n\t\treturn $status;\n\t}\n\n\t\/**\n\t * Set seconds\/timestamp to readable format\n\t *\n\t * @since  1.6.5\n\t * @access public\n\t *\/\n\tpublic static function readable_time( $seconds_or_timestamp, $timeout = 3600, $forward = false ) {\n\t\tif (strlen($seconds_or_timestamp) == 10) {\n\t\t\t$seconds = time() - $seconds_or_timestamp;\n\t\t\tif ($seconds > $timeout) {\n\t\t\t\treturn date('m\/d\/Y H:i:s', $seconds_or_timestamp + LITESPEED_TIME_OFFSET);\n\t\t\t}\n\t\t} else {\n\t\t\t$seconds = $seconds_or_timestamp;\n\t\t}\n\n\t\t$res = '';\n\t\tif ($seconds > 86400) {\n\t\t\t$num      = floor($seconds \/ 86400);\n\t\t\t$res     .= $num . 'd';\n\t\t\t$seconds %= 86400;\n\t\t}\n\n\t\tif ($seconds > 3600) {\n\t\t\tif ($res) {\n\t\t\t\t$res .= ', ';\n\t\t\t}\n\t\t\t$num      = floor($seconds \/ 3600);\n\t\t\t$res     .= $num . 'h';\n\t\t\t$seconds %= 3600;\n\t\t}\n\n\t\tif ($seconds > 60) {\n\t\t\tif ($res) {\n\t\t\t\t$res .= ', ';\n\t\t\t}\n\t\t\t$num      = floor($seconds \/ 60);\n\t\t\t$res     .= $num . 'm';\n\t\t\t$seconds %= 60;\n\t\t}\n\n\t\tif ($seconds > 0) {\n\t\t\tif ($res) {\n\t\t\t\t$res .= ' ';\n\t\t\t}\n\t\t\t$res .= $seconds . 's';\n\t\t}\n\n\t\tif (!$res) {\n\t\t\treturn $forward ? __('right now', 'litespeed-cache') : __('just now', 'litespeed-cache');\n\t\t}\n\n\t\t$res = $forward ? $res : sprintf(__(' %s ago', 'litespeed-cache'), $res);\n\n\t\treturn $res;\n\t}\n\n\t\/**\n\t * Convert array to string\n\t *\n\t * @since  1.6\n\t * @access public\n\t *\/\n\tpublic static function arr2str( $arr ) {\n\t\tif (!is_array($arr)) {\n\t\t\treturn $arr;\n\t\t}\n\n\t\treturn base64_encode(\\json_encode($arr));\n\t}\n\n\t\/**\n\t * Get human readable size\n\t *\n\t * @since  1.6\n\t * @access public\n\t *\/\n\tpublic static function real_size( $filesize, $is_1000 = false ) {\n\t\t$unit = $is_1000 ? 1000 : 1024;\n\n\t\tif ($filesize >= pow($unit, 3)) {\n\t\t\t$filesize = round(($filesize \/ pow($unit, 3)) * 100) \/ 100 . 'G';\n\t\t} elseif ($filesize >= pow($unit, 2)) {\n\t\t\t$filesize = round(($filesize \/ pow($unit, 2)) * 100) \/ 100 . 'M';\n\t\t} elseif ($filesize >= $unit) {\n\t\t\t$filesize = round(($filesize \/ $unit) * 100) \/ 100 . 'K';\n\t\t} else {\n\t\t\t$filesize = $filesize . 'B';\n\t\t}\n\t\treturn $filesize;\n\t}\n\n\t\/**\n\t * Parse attributes from string\n\t *\n\t * @since  1.2.2\n\t * @since  1.4 Moved from optimize to utility\n\t * @access private\n\t * @param  string $str\n\t * @return array  All the attributes\n\t *\/\n\tpublic static function parse_attr( $str ) {\n\t\t$attrs = array();\n\t\tpreg_match_all('#([\\w-]+)=([\"\\'])([^\\2]*)\\2#isU', $str, $matches, PREG_SET_ORDER);\n\t\tforeach ($matches as $match) {\n\t\t\t$attrs[$match[1]] = trim($match[3]);\n\t\t}\n\t\treturn $attrs;\n\t}\n\n\t\/**\n\t * Check if an array has a string\n\t *\n\t * Support $ exact match\n\t *\n\t * @since 1.3\n\t * @access private\n\t * @param string $needle The string to search with\n\t * @param array  $haystack\n\t * @return bool|string False if not found, otherwise return the matched string in haystack.\n\t *\/\n\tpublic static function str_hit_array( $needle, $haystack, $has_ttl = false ) {\n\t\tif (!$haystack) {\n\t\t\treturn false;\n\t\t}\n\t\t\/**\n\t\t * Safety check to avoid PHP warning\n\t\t *\n\t\t * @see  https:\/\/github.com\/litespeedtech\/lscache_wp\/pull\/131\/commits\/45fc03af308c7d6b5583d1664fad68f75fb6d017\n\t\t *\/\n\t\tif (!is_array($haystack)) {\n\t\t\tDebug2::debug('[Util] \u274c bad param in str_hit_array()!');\n\n\t\t\treturn false;\n\t\t}\n\n\t\t$hit      = false;\n\t\t$this_ttl = 0;\n\t\tforeach ($haystack as $item) {\n\t\t\tif (!$item) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($has_ttl) {\n\t\t\t\t$this_ttl = 0;\n\t\t\t\t$item     = explode(' ', $item);\n\t\t\t\tif (!empty($item[1])) {\n\t\t\t\t\t$this_ttl = $item[1];\n\t\t\t\t}\n\t\t\t\t$item = $item[0];\n\t\t\t}\n\n\t\t\tif (substr($item, 0, 1) === '^' && substr($item, -1) === '$') {\n\t\t\t\t\/\/ do exact match\n\t\t\t\tif (substr($item, 1, -1) === $needle) {\n\t\t\t\t\t$hit = $item;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} elseif (substr($item, -1) === '$') {\n\t\t\t\t\/\/ match end\n\t\t\t\tif (substr($item, 0, -1) === substr($needle, -strlen($item) + 1)) {\n\t\t\t\t\t$hit = $item;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} elseif (substr($item, 0, 1) === '^') {\n\t\t\t\t\/\/ match beginning\n\t\t\t\tif (substr($item, 1) === substr($needle, 0, strlen($item) - 1)) {\n\t\t\t\t\t$hit = $item;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} elseif (strpos($needle, $item) !== false) {\n\t\t\t\t$hit = $item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ($hit) {\n\t\t\tif ($has_ttl) {\n\t\t\t\treturn array( $hit, $this_ttl );\n\t\t\t}\n\n\t\t\treturn $hit;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Improve compatibility to PHP old versions\n\t *\n\t * @since  1.2.2\n\t *\/\n\tpublic static function compatibility() {\n\t\trequire_once LSCWP_DIR . 'lib\/php-compatibility.func.php';\n\t}\n\n\t\/**\n\t * Convert URI to URL\n\t *\n\t * @since  1.3\n\t * @access public\n\t * @param  string $uri `xx\/xx.html` or `\/subfolder\/xx\/xx.html`\n\t * @return  string http:\/\/www.example.com\/subfolder\/xx\/xx.html\n\t *\/\n\tpublic static function uri2url( $uri ) {\n\t\tif (substr($uri, 0, 1) === '\/') {\n\t\t\tself::domain_const();\n\t\t\t$url = LSCWP_DOMAIN . $uri;\n\t\t} else {\n\t\t\t$url = home_url('\/') . $uri;\n\t\t}\n\n\t\treturn $url;\n\t}\n\n\t\/**\n\t * Convert URL to basename (filename)\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic static function basename( $url ) {\n\t\t$url      = trim($url);\n\t\t$uri      = @parse_url($url, PHP_URL_PATH);\n\t\t$basename = pathinfo($uri, PATHINFO_BASENAME);\n\n\t\treturn $basename;\n\t}\n\n\t\/**\n\t * Drop .webp and .avif if existed in filename\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic static function drop_webp( $filename ) {\n\t\tif (in_array(substr($filename, -5), array( '.webp', '.avif' ))) {\n\t\t\t$filename = substr($filename, 0, -5);\n\t\t}\n\n\t\treturn $filename;\n\t}\n\n\t\/**\n\t * Convert URL to URI\n\t *\n\t * @since  1.2.2\n\t * @since  1.6.2.1 Added 2nd param keep_qs\n\t * @access public\n\t *\/\n\tpublic static function url2uri( $url, $keep_qs = false ) {\n\t\t$url = trim($url);\n\t\t$uri = @parse_url($url, PHP_URL_PATH);\n\t\t$qs  = @parse_url($url, PHP_URL_QUERY);\n\n\t\tif (!$keep_qs || !$qs) {\n\t\t\treturn $uri;\n\t\t}\n\n\t\treturn $uri . '?' . $qs;\n\t}\n\n\t\/**\n\t * Get attachment relative path to upload folder\n\t *\n\t * @since 3.0\n\t * @access public\n\t * @param  string $url `https:\/\/aa.com\/bbb\/wp-content\/upload\/2018\/08\/test.jpg` or `\/bbb\/wp-content\/upload\/2018\/08\/test.jpg`\n\t * @return string   `2018\/08\/test.jpg`\n\t *\/\n\tpublic static function att_short_path( $url ) {\n\t\tif (!defined('LITESPEED_UPLOAD_PATH')) {\n\t\t\t$_wp_upload_dir = wp_upload_dir();\n\n\t\t\t$upload_path = self::url2uri($_wp_upload_dir['baseurl']);\n\n\t\t\tdefine('LITESPEED_UPLOAD_PATH', $upload_path);\n\t\t}\n\n\t\t$local_file = self::url2uri($url);\n\n\t\t$short_path = substr($local_file, strlen(LITESPEED_UPLOAD_PATH) + 1);\n\n\t\treturn $short_path;\n\t}\n\n\t\/**\n\t * Make URL to be relative\n\t *\n\t * NOTE: for subfolder home_url, will keep subfolder part (strip nothing but scheme and host)\n\t *\n\t * @param  string $url\n\t * @return string      Relative URL, start with \/\n\t *\/\n\tpublic static function make_relative( $url ) {\n\t\t\/\/ replace home_url if the url is full url\n\t\tself::domain_const();\n\t\tif (strpos($url, LSCWP_DOMAIN) === 0) {\n\t\t\t$url = substr($url, strlen(LSCWP_DOMAIN));\n\t\t}\n\t\treturn trim($url);\n\t}\n\n\t\/**\n\t * Convert URL to domain only\n\t *\n\t * @since  1.7.1\n\t *\/\n\tpublic static function parse_domain( $url ) {\n\t\t$url = @parse_url($url);\n\t\tif (empty($url['host'])) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!empty($url['scheme'])) {\n\t\t\treturn $url['scheme'] . ':\/\/' . $url['host'];\n\t\t}\n\n\t\treturn '\/\/' . $url['host'];\n\t}\n\n\t\/**\n\t * Drop protocol `https:` from https:\/\/example.com\n\t *\n\t * @since  3.3\n\t *\/\n\tpublic static function noprotocol( $url ) {\n\t\t$tmp = parse_url(trim($url));\n\t\tif (!empty($tmp['scheme'])) {\n\t\t\t$url = str_replace($tmp['scheme'] . ':', '', $url);\n\t\t}\n\n\t\treturn $url;\n\t}\n\n\t\/**\n\t * Validate ip v4\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function valid_ipv4( $ip ) {\n\t\treturn filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4 | FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE);\n\t}\n\n\t\/**\n\t * Generate domain const\n\t *\n\t * This will generate http:\/\/www.example.com even there is a subfolder in home_url setting\n\t *\n\t * Conf LSCWP_DOMAIN has NO trailing \/\n\t *\n\t * @since  1.3\n\t * @access public\n\t *\/\n\tpublic static function domain_const() {\n\t\tif (defined('LSCWP_DOMAIN')) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::compatibility();\n\t\t$domain = http_build_url(get_home_url(), array(), HTTP_URL_STRIP_ALL);\n\n\t\tdefine('LSCWP_DOMAIN', $domain);\n\t}\n\n\t\/**\n\t * Array map one textarea to sanitize the url\n\t *\n\t * @since  1.3\n\t * @access public\n\t * @param  array|string $arr\n\t * @param  string|null  $type String handler type\n\t * @return string|array\n\t *\/\n\tpublic static function sanitize_lines( $arr, $type = null ) {\n\t\t$types = $type ? explode(',', $type) : array();\n\n\t\tif (!$arr) {\n\t\t\tif ($type === 'string') {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\treturn array();\n\t\t}\n\n\t\tif (!is_array($arr)) {\n\t\t\t$arr = explode(\"\\n\", $arr);\n\t\t}\n\n\t\t$arr     = array_map('trim', $arr);\n\t\t$changed = false;\n\t\tif (in_array('uri', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::url2uri', $arr);\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('basename', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::basename', $arr);\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('drop_webp', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::drop_webp', $arr);\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('relative', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::make_relative', $arr); \/\/ Remove domain\n\t\t\t$changed = true;\n\t\t}\n\t\tif (in_array('domain', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::parse_domain', $arr); \/\/ Only keep domain\n\t\t\t$changed = true;\n\t\t}\n\n\t\tif (in_array('noprotocol', $types)) {\n\t\t\t$arr     = array_map(__CLASS__ . '::noprotocol', $arr); \/\/ Drop protocol, `https:\/\/example.com` -> `\/\/example.com`\n\t\t\t$changed = true;\n\t\t}\n\n\t\tif (in_array('trailingslash', $types)) {\n\t\t\t$arr     = array_map('trailingslashit', $arr); \/\/ Append trailing slash, `https:\/\/example.com` -> `https:\/\/example.com\/`\n\t\t\t$changed = true;\n\t\t}\n\n\t\tif ($changed) {\n\t\t\t$arr = array_map('trim', $arr);\n\t\t}\n\t\t$arr = array_unique($arr);\n\t\t$arr = array_filter($arr);\n\n\t\tif (in_array('string', $types)) {\n\t\t\treturn implode(\"\\n\", $arr);\n\t\t}\n\n\t\treturn $arr;\n\t}\n\n\t\/**\n\t * Builds an url with an action and a nonce.\n\t *\n\t * Assumes user capabilities are already checked.\n\t *\n\t * @since  1.6 Changed order of 2nd&3rd param, changed 3rd param `append_str` to 2nd `type`\n\t * @access public\n\t * @return string The built url.\n\t *\/\n\tpublic static function build_url( $action, $type = false, $is_ajax = false, $page = null, $append_arr = array(), $unescape = false ) {\n\t\t$prefix = '?';\n\n\t\tif ($page === '_ori') {\n\t\t\t$page                         = true;\n\t\t\t$append_arr['_litespeed_ori'] = 1;\n\t\t}\n\n\t\tif (!$is_ajax) {\n\t\t\tif ($page) {\n\t\t\t\t\/\/ If use admin url\n\t\t\t\tif ($page === true) {\n\t\t\t\t\t$page = 'admin.php';\n\t\t\t\t} elseif (strpos($page, '?') !== false) {\n\t\t\t\t\t$prefix = '&';\n\t\t\t\t}\n\t\t\t\t$combined = $page . $prefix . Router::ACTION . '=' . $action;\n\t\t\t} else {\n\t\t\t\t\/\/ Current page rebuild URL\n\t\t\t\t$params = $_GET;\n\n\t\t\t\tif (!empty($params)) {\n\t\t\t\t\tif (isset($params[Router::ACTION])) {\n\t\t\t\t\t\tunset($params[Router::ACTION]);\n\t\t\t\t\t}\n\t\t\t\t\tif (isset($params['_wpnonce'])) {\n\t\t\t\t\t\tunset($params['_wpnonce']);\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty($params)) {\n\t\t\t\t\t\t$prefix .= http_build_query($params) . '&';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tglobal $pagenow;\n\t\t\t\t$combined = $pagenow . $prefix . Router::ACTION . '=' . $action;\n\t\t\t}\n\t\t} else {\n\t\t\t$combined = 'admin-ajax.php?action=litespeed_ajax&' . Router::ACTION . '=' . $action;\n\t\t}\n\n\t\tif (is_network_admin()) {\n\t\t\t$prenonce = network_admin_url($combined);\n\t\t} else {\n\t\t\t$prenonce = admin_url($combined);\n\t\t}\n\t\t$url = wp_nonce_url($prenonce, $action, Router::NONCE);\n\n\t\tif ($type) {\n\t\t\t\/\/ Remove potential param `type` from url\n\t\t\t$url = parse_url(htmlspecialchars_decode($url));\n\t\t\tparse_str($url['query'], $query);\n\n\t\t\t$built_arr = array_merge($query, array( Router::TYPE => $type ));\n\t\t\tif ($append_arr) {\n\t\t\t\t$built_arr = array_merge($built_arr, $append_arr);\n\t\t\t}\n\t\t\t$url['query'] = http_build_query($built_arr);\n\t\t\tself::compatibility();\n\t\t\t$url = http_build_url($url);\n\t\t\t$url = htmlspecialchars($url, ENT_QUOTES, 'UTF-8');\n\t\t}\n\n\t\tif ($unescape) {\n\t\t\t$url = wp_specialchars_decode($url);\n\t\t}\n\n\t\treturn $url;\n\t}\n\n\t\/**\n\t * Check if the host is the internal host\n\t *\n\t * @since  1.2.3\n\t *\/\n\tpublic static function internal( $host ) {\n\t\tif (!defined('LITESPEED_FRONTEND_HOST')) {\n\t\t\tif (defined('WP_HOME')) {\n\t\t\t\t$home_host = WP_HOME; \/\/ Also think of `WP_SITEURL`\n\t\t\t} else {\n\t\t\t\t$home_host = get_option('home');\n\t\t\t}\n\t\t\tdefine('LITESPEED_FRONTEND_HOST', parse_url($home_host, PHP_URL_HOST));\n\t\t}\n\n\t\tif ($host === LITESPEED_FRONTEND_HOST) {\n\t\t\treturn true;\n\t\t}\n\n\t\t\/**\n\t\t * Filter for multiple domains\n\t\t *\n\t\t * @since 2.9.4\n\t\t *\/\n\t\tif (!isset(self::$_internal_domains)) {\n\t\t\tself::$_internal_domains = apply_filters('litespeed_internal_domains', array());\n\t\t}\n\n\t\tif (self::$_internal_domains) {\n\t\t\treturn in_array($host, self::$_internal_domains);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Check if an URL is a internal existing file\n\t *\n\t * @since  1.2.2\n\t * @since  1.6.2 Moved here from optm.cls due to usage of media.cls\n\t * @access public\n\t * @return string|bool The real path of file OR false\n\t *\/\n\tpublic static function is_internal_file( $url, $addition_postfix = false ) {\n\t\tif (substr($url, 0, 5) == 'data:') {\n\t\t\tDebug2::debug2('[Util] data: content not file');\n\t\t\treturn false;\n\t\t}\n\t\t$url_parsed = parse_url($url);\n\t\tif (isset($url_parsed['host']) && !self::internal($url_parsed['host'])) {\n\t\t\t\/\/ Check if is cdn path\n\t\t\t\/\/ Do this to avoid user hardcoded src in tpl\n\t\t\tif (!CDN::internal($url_parsed['host'])) {\n\t\t\t\tDebug2::debug2('[Util] external');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (empty($url_parsed['path'])) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Need to replace child blog path for assets, ref: .htaccess\n\t\tif (is_multisite() && defined('PATH_CURRENT_SITE')) {\n\t\t\t$pattern            = '#^' . PATH_CURRENT_SITE . '([_0-9a-zA-Z-]+\/)(wp-(content|admin|includes))#U';\n\t\t\t$replacement        = PATH_CURRENT_SITE . '$2';\n\t\t\t$url_parsed['path'] = preg_replace($pattern, $replacement, $url_parsed['path']);\n\t\t\t\/\/ $current_blog = (int) get_current_blog_id();\n\t\t\t\/\/ $main_blog_id = (int) get_network()->site_id;\n\t\t\t\/\/ if ( $current_blog === $main_blog_id ) {\n\t\t\t\/\/ define( 'LITESPEED_IS_MAIN_BLOG', true );\n\t\t\t\/\/ }\n\t\t\t\/\/ else {\n\t\t\t\/\/ define( 'LITESPEED_IS_MAIN_BLOG', false );\n\t\t\t\/\/ }\n\t\t}\n\n\t\t\/\/ Parse file path\n\t\t\/**\n\t\t * Trying to fix pure \/.htaccess rewrite to \/wordpress case\n\t\t *\n\t\t * Add `define( 'LITESPEED_WP_REALPATH', '\/wordpress' );` in wp-config.php in this case\n\t\t *\n\t\t * @internal #611001 - Combine & Minify not working?\n\t\t * @since  1.6.3\n\t\t *\/\n\t\tif (substr($url_parsed['path'], 0, 1) === '\/') {\n\t\t\tif (defined('LITESPEED_WP_REALPATH')) {\n\t\t\t\t$file_path_ori = $_SERVER['DOCUMENT_ROOT'] . LITESPEED_WP_REALPATH . $url_parsed['path'];\n\t\t\t} else {\n\t\t\t\t$file_path_ori = $_SERVER['DOCUMENT_ROOT'] . $url_parsed['path'];\n\t\t\t}\n\t\t} else {\n\t\t\t$file_path_ori = Router::frontend_path() . '\/' . $url_parsed['path'];\n\t\t}\n\n\t\t\/**\n\t\t * Added new file postfix to be check if passed in\n\t\t *\n\t\t * @since 2.2.4\n\t\t *\/\n\t\tif ($addition_postfix) {\n\t\t\t$file_path_ori .= '.' . $addition_postfix;\n\t\t}\n\n\t\t\/**\n\t\t * Added this filter for those plugins which overwrite the filepath\n\t\t *\n\t\t * @see #101091 plugin `Hide My WordPress`\n\t\t * @since 2.2.3\n\t\t *\/\n\t\t$file_path_ori = apply_filters('litespeed_realpath', $file_path_ori);\n\n\t\t$file_path = realpath($file_path_ori);\n\t\tif (!is_file($file_path)) {\n\t\t\tDebug2::debug2('[Util] file not exist: ' . $file_path_ori);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn array( $file_path, filesize($file_path) );\n\t}\n\n\t\/**\n\t * Safely parse URL for v5.3 compatibility\n\t *\n\t * @since  3.4.3\n\t *\/\n\tpublic static function parse_url_safe( $url, $component = -1 ) {\n\t\tif (substr($url, 0, 2) == '\/\/') {\n\t\t\t$url = 'https:' . $url;\n\t\t}\n\n\t\treturn parse_url($url, $component);\n\t}\n\n\t\/**\n\t * Replace url in srcset to new value\n\t *\n\t * @since  2.2.3\n\t *\/\n\tpublic static function srcset_replace( $content, $callback ) {\n\t\tpreg_match_all('# srcset=([\\'\"])(.+)\\g{1}#iU', $content, $matches);\n\t\t$srcset_ori   = array();\n\t\t$srcset_final = array();\n\t\tforeach ($matches[2] as $k => $urls_ori) {\n\t\t\t$urls_final = explode(',', $urls_ori);\n\n\t\t\t$changed = false;\n\n\t\t\tforeach ($urls_final as $k2 => $url_info) {\n\t\t\t\t$url_info_arr = explode(' ', trim($url_info));\n\n\t\t\t\tif (!($url2 = call_user_func($callback, $url_info_arr[0]))) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$changed = true;\n\n\t\t\t\t$urls_final[$k2] = str_replace($url_info_arr[0], $url2, $url_info);\n\n\t\t\t\tDebug2::debug2('[Util] - srcset replaced to ' . $url2 . (!empty($url_info_arr[1]) ? ' ' . $url_info_arr[1] : ''));\n\t\t\t}\n\n\t\t\tif (!$changed) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$urls_final = implode(',', $urls_final);\n\n\t\t\t$srcset_ori[] = $matches[0][$k];\n\n\t\t\t$srcset_final[] = str_replace($urls_ori, $urls_final, $matches[0][$k]);\n\t\t}\n\n\t\tif ($srcset_ori) {\n\t\t\t$content = str_replace($srcset_ori, $srcset_final, $content);\n\t\t\tDebug2::debug2('[Util] - srcset replaced');\n\t\t}\n\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Generate pagination\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function pagination( $total, $limit, $return_offset = false ) {\n\t\t$pagenum = isset($_GET['pagenum']) ? absint($_GET['pagenum']) : 1;\n\n\t\t$offset       = ($pagenum - 1) * $limit;\n\t\t$num_of_pages = ceil($total \/ $limit);\n\n\t\tif ($offset > $total) {\n\t\t\t$offset = $total - $limit;\n\t\t}\n\n\t\tif ($offset < 0) {\n\t\t\t$offset = 0;\n\t\t}\n\n\t\tif ($return_offset) {\n\t\t\treturn $offset;\n\t\t}\n\n\t\t$page_links = paginate_links(array(\n\t\t\t'base' => add_query_arg('pagenum', '%#%'),\n\t\t\t'format' => '',\n\t\t\t'prev_text' => '&laquo;',\n\t\t\t'next_text' => '&raquo;',\n\t\t\t'total' => $num_of_pages,\n\t\t\t'current' => $pagenum,\n\t\t));\n\n\t\treturn '<div class=\"tablenav\"><div class=\"tablenav-pages\" style=\"margin: 1em 0\">' . $page_links . '<\/div><\/div>';\n\t}\n\n\t\/**\n\t * Generate placeholder for an array to query\n\t *\n\t * @since 2.0\n\t * @access public\n\t *\/\n\tpublic static function chunk_placeholder( $data, $fields ) {\n\t\t$division = substr_count($fields, ',') + 1;\n\n\t\t$q = implode(\n\t\t\t',',\n\t\t\tarray_map(function ( $el ) {\n\t\t\t\treturn '(' . implode(',', $el) . ')';\n\t\t\t}, array_chunk(array_fill(0, count($data), '%s'), $division))\n\t\t);\n\n\t\treturn $q;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/doc.cls.php","ext":"php","size":4164,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The Doc class.\n *\n * @since       2.2.7\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Doc {\n\n\t\/\/ protected static $_instance;\n\n\t\/**\n\t * Show option is actually ON by GM\n\t *\n\t * @since  5.5\n\t * @access public\n\t *\/\n\tpublic static function maybe_on_by_gm( $id ) {\n\t\tif (apply_filters('litespeed_conf', $id)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!apply_filters('litespeed_conf', Base::O_GUEST)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!apply_filters('litespeed_conf', Base::O_GUEST_OPTM)) {\n\t\t\treturn;\n\t\t}\n\t\techo '<font class=\"litespeed-warning\">';\n\t\techo '\u26a0\ufe0f ' .\n\t\t\tsprintf(\n\t\t\t\t__('This setting is %1$s for certain qualifying requests due to %2$s!', 'litespeed-cache'),\n\t\t\t\t'<code>' . __('ON', 'litespeed-cache') . '<\/code>',\n\t\t\t\tLang::title(Base::O_GUEST_OPTM)\n\t\t\t);\n\t\tself::learn_more('https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/general\/#guest-optimization');\n\t\techo '<\/font>';\n\t}\n\n\t\/**\n\t * Changes affect crawler list warning\n\t *\n\t * @since  4.3\n\t * @access public\n\t *\/\n\tpublic static function crawler_affected() {\n\t\techo '<font class=\"litespeed-primary\">';\n\t\techo '\u26a0\ufe0f ' . __('This setting will regenerate crawler list and clear the disabled list!', 'litespeed-cache');\n\t\techo '<\/font>';\n\t}\n\n\t\/**\n\t * Privacy policy\n\t *\n\t * @since 2.2.7\n\t * @access public\n\t *\/\n\tpublic static function privacy_policy() {\n\t\treturn __(\n\t\t\t'This site utilizes caching in order to facilitate a faster response time and better user experience. Caching potentially stores a duplicate copy of every web page that is on display on this site. All cache files are temporary, and are never accessed by any third party, except as necessary to obtain technical support from the cache plugin vendor. Cache files expire on a schedule set by the site administrator, but may easily be purged by the admin before their natural expiration, if necessary. We may use QUIC.cloud services to process & cache your data temporarily.',\n\t\t\t'litespeed-cache'\n\t\t) .\n\t\t\tsprintf(\n\t\t\t\t__('Please see %s for more details.', 'litespeed-cache'),\n\t\t\t\t'<a href=\"https:\/\/quic.cloud\/privacy-policy\/\" target=\"_blank\">https:\/\/quic.cloud\/privacy-policy\/<\/a>'\n\t\t\t);\n\t}\n\n\t\/**\n\t * Learn more link\n\t *\n\t * @since  2.4.2\n\t * @access public\n\t *\/\n\tpublic static function learn_more( $url, $title = false, $self = false, $class = false, $return = false ) {\n\t\tif (!$class) {\n\t\t\t$class = 'litespeed-learn-more';\n\t\t}\n\n\t\tif (!$title) {\n\t\t\t$title = __('Learn More', 'litespeed-cache');\n\t\t}\n\n\t\t$self = $self ? '' : \"target='_blank'\";\n\n\t\t$txt = \" <a href='$url' $self class='$class'>$title<\/a>\";\n\n\t\tif ($return) {\n\t\t\treturn $txt;\n\t\t}\n\n\t\techo $txt;\n\t}\n\n\t\/**\n\t * One per line\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic static function one_per_line( $return = false ) {\n\t\t$str = __('One per line.', 'litespeed-cache');\n\t\tif ($return) {\n\t\t\treturn $str;\n\t\t}\n\t\techo $str;\n\t}\n\n\t\/**\n\t * One per line\n\t *\n\t * @since  3.4\n\t * @access public\n\t *\/\n\tpublic static function full_or_partial_url( $string_only = false ) {\n\t\tif ($string_only) {\n\t\t\techo __('Both full and partial strings can be used.', 'litespeed-cache');\n\t\t} else {\n\t\t\techo __('Both full URLs and partial strings can be used.', 'litespeed-cache');\n\t\t}\n\t}\n\n\t\/**\n\t * Notice to edit .htaccess\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic static function notice_htaccess() {\n\t\techo '<font class=\"litespeed-primary\">';\n\t\techo '\u26a0\ufe0f ' . __('This setting will edit the .htaccess file.', 'litespeed-cache');\n\t\techo ' <a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#edit-htaccess-tab\" target=\"_blank\" class=\"litespeed-learn-more\">' .\n\t\t\t__('Learn More', 'litespeed-cache') .\n\t\t\t'<\/a>';\n\t\techo '<\/font>';\n\t}\n\n\t\/**\n\t * Gentle reminder that web services run asynchronously\n\t *\n\t * @since  5.3.1\n\t * @access public\n\t *\/\n\tpublic static function queue_issues( $return = false ) {\n\t\t$str =\n\t\t\t'<div class=\"litespeed-desc\">' .\n\t\t\t__('The queue is processed asynchronously. It may take time.', 'litespeed-cache') .\n\t\t\tself::learn_more('https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/troubleshoot\/#quiccloud-queue-issues', false, false, false, true) .\n\t\t\t'<\/div>';\n\t\tif ($return) {\n\t\t\treturn $str;\n\t\t}\n\t\techo $str;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/data.cls.php","ext":"php","size":16886,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The class to store and manage litespeed db data.\n *\n * @since       1.3.1\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Data extends Root {\n\n\tconst LOG_TAG = '\ud83d\ude80';\n\n\tprivate $_db_updater = array(\n\t\t'5.3-a5' => array( 'litespeed_update_5_3' ),\n\t\t'7.0-b26' => array( 'litespeed_update_7' ),\n\t\t'7.0.1-b1' => array( 'litespeed_update_7_0_1' ),\n\t);\n\n\tprivate $_db_site_updater = array(\n\t\t\/\/ Example\n\t\t\/\/ '2.0'    => array(\n\t\t\/\/ 'litespeed_update_site_2_0',\n\t\t\/\/ ),\n\t);\n\n\tprivate $_url_file_types = array(\n\t\t'css' => 1,\n\t\t'js' => 2,\n\t\t'ccss' => 3,\n\t\t'ucss' => 4,\n\t);\n\n\tconst TB_IMG_OPTM          = 'litespeed_img_optm';\n\tconst TB_IMG_OPTMING       = 'litespeed_img_optming'; \/\/ working table\n\tconst TB_AVATAR            = 'litespeed_avatar';\n\tconst TB_CRAWLER           = 'litespeed_crawler';\n\tconst TB_CRAWLER_BLACKLIST = 'litespeed_crawler_blacklist';\n\tconst TB_URL               = 'litespeed_url';\n\tconst TB_URL_FILE          = 'litespeed_url_file';\n\n\t\/**\n\t * Init\n\t *\n\t * @since  1.3.1\n\t *\/\n\tpublic function __construct() {\n\t}\n\n\t\/**\n\t * Correct table existence\n\t *\n\t * Call when activate -> update_confs()\n\t * Call when update_confs()\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function correct_tb_existence() {\n\t\t\/\/ Gravatar\n\t\tif ($this->conf(Base::O_DISCUSS_AVATAR_CACHE)) {\n\t\t\t$this->tb_create('avatar');\n\t\t}\n\n\t\t\/\/ Crawler\n\t\tif ($this->conf(Base::O_CRAWLER)) {\n\t\t\t$this->tb_create('crawler');\n\t\t\t$this->tb_create('crawler_blacklist');\n\t\t}\n\n\t\t\/\/ URL mapping\n\t\t$this->tb_create('url');\n\t\t$this->tb_create('url_file');\n\n\t\t\/\/ Image optm is a bit different. Only trigger creation when sending requests. Drop when destroying.\n\t}\n\n\t\/**\n\t * Upgrade conf to latest format version from previous versions\n\t *\n\t * NOTE: Only for v3.0+\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function conf_upgrade( $ver ) {\n\t\t\/\/ Skip count check if `Use Primary Site Configurations` is on\n\t\t\/\/ Deprecated since v3.0 as network primary site didn't override the subsites conf yet\n\t\t\/\/ if ( ! is_main_site() && ! empty ( $this->_site_options[ self::NETWORK_O_USE_PRIMARY ] ) ) {\n\t\t\/\/ return;\n\t\t\/\/ }\n\n\t\tif ($this->_get_upgrade_lock()) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_set_upgrade_lock(true);\n\n\t\trequire_once LSCWP_DIR . 'src\/data.upgrade.func.php';\n\n\t\t\/\/ Init log manually\n\t\tif ($this->conf(Base::O_DEBUG)) {\n\t\t\t$this->cls('Debug2')->init();\n\t\t}\n\n\t\tforeach ($this->_db_updater as $k => $v) {\n\t\t\tif (version_compare($ver, $k, '<')) {\n\t\t\t\t\/\/ run each callback\n\t\t\t\tforeach ($v as $v2) {\n\t\t\t\t\tself::debug(\"Updating [ori_v] $ver \\t[to] $k \\t[func] $v2\");\n\t\t\t\t\tcall_user_func($v2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Reload options\n\t\t$this->cls('Conf')->load_options();\n\n\t\t$this->correct_tb_existence();\n\n\t\t\/\/ Update related files\n\t\t$this->cls('Activation')->update_files();\n\n\t\t\/\/ Update version to latest\n\t\tConf::delete_option(Base::_VER);\n\t\tConf::add_option(Base::_VER, Core::VER);\n\n\t\tself::debug('Updated version to ' . Core::VER);\n\n\t\t$this->_set_upgrade_lock(false);\n\n\t\t!defined('LSWCP_EMPTYCACHE') && define('LSWCP_EMPTYCACHE', true); \/\/ clear all sites caches\n\t\tPurge::purge_all();\n\n\t\treturn 'upgrade';\n\t}\n\n\t\/**\n\t * Upgrade site conf to latest format version from previous versions\n\t *\n\t * NOTE: Only for v3.0+\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function conf_site_upgrade( $ver ) {\n\t\tif ($this->_get_upgrade_lock()) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_set_upgrade_lock(true);\n\n\t\trequire_once LSCWP_DIR . 'src\/data.upgrade.func.php';\n\n\t\tforeach ($this->_db_site_updater as $k => $v) {\n\t\t\tif (version_compare($ver, $k, '<')) {\n\t\t\t\t\/\/ run each callback\n\t\t\t\tforeach ($v as $v2) {\n\t\t\t\t\tself::debug(\"Updating site [ori_v] $ver \\t[to] $k \\t[func] $v2\");\n\t\t\t\t\tcall_user_func($v2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Reload options\n\t\t$this->cls('Conf')->load_site_options();\n\n\t\tConf::delete_site_option(Base::_VER);\n\t\tConf::add_site_option(Base::_VER, Core::VER);\n\n\t\tself::debug('Updated site_version to ' . Core::VER);\n\n\t\t$this->_set_upgrade_lock(false);\n\n\t\t!defined('LSWCP_EMPTYCACHE') && define('LSWCP_EMPTYCACHE', true); \/\/ clear all sites caches\n\t\tPurge::purge_all();\n\t}\n\n\t\/**\n\t * Check if upgrade script is running or not\n\t *\n\t * @since 3.0.1\n\t *\/\n\tprivate function _get_upgrade_lock() {\n\t\t$is_upgrading = get_option('litespeed.data.upgrading');\n\t\tif (!$is_upgrading) {\n\t\t\t$this->_set_upgrade_lock(false); \/\/ set option value to existed to avoid repeated db query next time\n\t\t}\n\t\tif ($is_upgrading && time() - $is_upgrading < 3600) {\n\t\t\treturn $is_upgrading;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Show the upgrading banner if upgrade script is running\n\t *\n\t * @since 3.0.1\n\t *\/\n\tpublic function check_upgrading_msg() {\n\t\t$is_upgrading = $this->_get_upgrade_lock();\n\t\tif (!$is_upgrading) {\n\t\t\treturn;\n\t\t}\n\n\t\tAdmin_Display::info(\n\t\t\tsprintf(\n\t\t\t\t__('The database has been upgrading in the background since %s. This message will disappear once upgrade is complete.', 'litespeed-cache'),\n\t\t\t\t'<code>' . Utility::readable_time($is_upgrading) . '<\/code>'\n\t\t\t) . ' [LiteSpeed]',\n\t\t\ttrue\n\t\t);\n\t}\n\n\t\/**\n\t * Set lock for upgrade process\n\t *\n\t * @since 3.0.1\n\t *\/\n\tprivate function _set_upgrade_lock( $lock ) {\n\t\tif (!$lock) {\n\t\t\tupdate_option('litespeed.data.upgrading', -1);\n\t\t} else {\n\t\t\tupdate_option('litespeed.data.upgrading', time());\n\t\t}\n\t}\n\n\t\/**\n\t * Get the table name\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function tb( $tb ) {\n\t\tglobal $wpdb;\n\n\t\tswitch ($tb) {\n\t\t\tcase 'img_optm':\n\t\t\t\treturn $wpdb->prefix . self::TB_IMG_OPTM;\n\t\t\t\tbreak;\n\n\t\t\tcase 'img_optming':\n\t\t\t\treturn $wpdb->prefix . self::TB_IMG_OPTMING;\n\t\t\t\tbreak;\n\n\t\t\tcase 'avatar':\n\t\t\t\treturn $wpdb->prefix . self::TB_AVATAR;\n\t\t\t\tbreak;\n\n\t\t\tcase 'crawler':\n\t\t\t\treturn $wpdb->prefix . self::TB_CRAWLER;\n\t\t\t\tbreak;\n\n\t\t\tcase 'crawler_blacklist':\n\t\t\t\treturn $wpdb->prefix . self::TB_CRAWLER_BLACKLIST;\n\t\t\t\tbreak;\n\n\t\t\tcase 'url':\n\t\t\t\treturn $wpdb->prefix . self::TB_URL;\n\t\t\t\tbreak;\n\n\t\t\tcase 'url_file':\n\t\t\t\treturn $wpdb->prefix . self::TB_URL_FILE;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t\/**\n\t * Check if one table exists or not\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function tb_exist( $tb ) {\n\t\tglobal $wpdb;\n\n\t\t$save_state = $wpdb->suppress_errors;\n\t\t$wpdb->suppress_errors(true);\n\t\t$describe = $wpdb->get_var('DESCRIBE `' . $this->tb($tb) . '`');\n\t\t$wpdb->suppress_errors($save_state);\n\n\t\treturn $describe !== null;\n\t}\n\n\t\/**\n\t * Get data structure of one table\n\t *\n\t * @since  2.0\n\t * @access private\n\t *\/\n\tprivate function _tb_structure( $tb ) {\n\t\treturn File::read(LSCWP_DIR . 'src\/data_structure\/' . $tb . '.sql');\n\t}\n\n\t\/**\n\t * Create img optm table and sync data from wp_postmeta\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function tb_create( $tb ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug2('[Data] Checking table ' . $tb);\n\n\t\t\/\/ Check if table exists first\n\t\tif ($this->tb_exist($tb)) {\n\t\t\tself::debug2('[Data] Existed');\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Creating ' . $tb);\n\n\t\t$sql = sprintf(\n\t\t\t'CREATE TABLE IF NOT EXISTS `%1$s` (' . $this->_tb_structure($tb) . ') %2$s;',\n\t\t\t$this->tb($tb),\n\t\t\t$wpdb->get_charset_collate() \/\/ 'DEFAULT CHARSET=utf8'\n\t\t);\n\n\t\t$res = $wpdb->query($sql);\n\t\tif ($res !== true) {\n\t\t\tself::debug('Warning! Creating table failed!', $sql);\n\t\t\tAdmin_Display::error(Error::msg('failed_tb_creation', array( '<code>' . $tb . '<\/code>', '<code>' . $sql . '<\/code>' )));\n\t\t}\n\t}\n\n\t\/**\n\t * Drop table\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function tb_del( $tb ) {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->tb_exist($tb)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Deleting table ' . $tb);\n\n\t\t$q = 'DROP TABLE IF EXISTS ' . $this->tb($tb);\n\t\t$wpdb->query($q);\n\t}\n\n\t\/**\n\t * Drop generated tables\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function tables_del() {\n\t\t$this->tb_del('avatar');\n\t\t$this->tb_del('crawler');\n\t\t$this->tb_del('crawler_blacklist');\n\t\t$this->tb_del('url');\n\t\t$this->tb_del('url_file');\n\n\t\t\/\/ Deleting img_optm only can be done when destroy all optm images\n\t}\n\n\t\/**\n\t * Keep table but clear all data\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function table_truncate( $tb ) {\n\t\tglobal $wpdb;\n\t\t$q = 'TRUNCATE TABLE ' . $this->tb($tb);\n\t\t$wpdb->query($q);\n\t}\n\n\t\/**\n\t * Clean certain type of url_file\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function url_file_clean( $file_type ) {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->tb_exist('url_file')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$type = $this->_url_file_types[$file_type];\n\t\t$q    = 'DELETE FROM ' . $this->tb('url_file') . ' WHERE `type` = %d';\n\t\t$wpdb->query($wpdb->prepare($q, $type));\n\n\t\t\/\/ Added to cleanup url table. See issue: https:\/\/wordpress.org\/support\/topic\/wp_litespeed_url-1-1-gb-in-db-huge-big\/\n\t\t$wpdb->query(\n\t\t\t'DELETE d\n\t\t\tFROM `' .\n\t\t\t\t$this->tb('url') .\n\t\t\t\t'` AS d\n\t\t\tLEFT JOIN `' .\n\t\t\t\t$this->tb('url_file') .\n\t\t\t\t'` AS f ON d.`id` = f.`url_id`\n\t\t\tWHERE f.`url_id` IS NULL'\n\t\t);\n\t}\n\n\t\/**\n\t * Generate filename based on URL, if content md5 existed, reuse existing file.\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function save_url( $request_url, $vary, $file_type, $filecon_md5, $path, $mobile = false, $webp = false ) {\n\t\tglobal $wpdb;\n\n\t\tif (strlen($vary) > 32) {\n\t\t\t$vary = md5($vary);\n\t\t}\n\n\t\t$type = $this->_url_file_types[$file_type];\n\n\t\t$tb_url      = $this->tb('url');\n\t\t$tb_url_file = $this->tb('url_file');\n\t\t$q           = \"SELECT * FROM `$tb_url` WHERE url=%s\";\n\t\t$url_row     = $wpdb->get_row($wpdb->prepare($q, $request_url), ARRAY_A);\n\t\tif (!$url_row) {\n\t\t\t$q = \"INSERT INTO `$tb_url` SET url=%s\";\n\t\t\t$wpdb->query($wpdb->prepare($q, $request_url));\n\t\t\t$url_id = $wpdb->insert_id;\n\t\t} else {\n\t\t\t$url_id = $url_row['id'];\n\t\t}\n\n\t\t$q        = \"SELECT * FROM `$tb_url_file` WHERE url_id=%d AND vary=%s AND type=%d AND expired=0\";\n\t\t$file_row = $wpdb->get_row($wpdb->prepare($q, array( $url_id, $vary, $type )), ARRAY_A);\n\n\t\t\/\/ Check if has previous file or not\n\t\tif ($file_row && $file_row['filename'] == $filecon_md5) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ If the new $filecon_md5 is marked as expired by previous records, clear those records\n\t\t$q = \"DELETE FROM `$tb_url_file` WHERE filename = %s AND expired > 0\";\n\t\t$wpdb->query($wpdb->prepare($q, $filecon_md5));\n\n\t\t\/\/ Check if there is any other record used the same filename or not\n\t\t$q = \"SELECT id FROM `$tb_url_file` WHERE filename = %s AND expired = 0 AND id != %d LIMIT 1\";\n\t\tif ($file_row && $wpdb->get_var($wpdb->prepare($q, array( $file_row['filename'], $file_row['id'] )))) {\n\t\t\t$q = \"UPDATE `$tb_url_file` SET filename=%s WHERE id=%d\";\n\t\t\t$wpdb->query($wpdb->prepare($q, array( $filecon_md5, $file_row['id'] )));\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ New record needed\n\t\t$q = \"INSERT INTO `$tb_url_file` SET url_id=%d, vary=%s, filename=%s, type=%d, mobile=%d, webp=%d, expired=0\";\n\t\t$wpdb->query($wpdb->prepare($q, array( $url_id, $vary, $filecon_md5, $type, $mobile ? 1 : 0, $webp ? 1 : 0 )));\n\n\t\t\/\/ Mark existing rows as expired\n\t\tif ($file_row) {\n\t\t\t$q       = \"UPDATE `$tb_url_file` SET expired=%d WHERE id=%d\";\n\t\t\t$expired = time() + 86400 * apply_filters('litespeed_url_file_expired_days', 20);\n\t\t\t$wpdb->query($wpdb->prepare($q, array( $expired, $file_row['id'] )));\n\n\t\t\t\/\/ Also check if has other files expired already to be deleted\n\t\t\t$q    = \"SELECT * FROM `$tb_url_file` WHERE url_id = %d AND expired BETWEEN 1 AND %d\";\n\t\t\t$q    = $wpdb->prepare($q, array( $url_id, time() ));\n\t\t\t$list = $wpdb->get_results($q, ARRAY_A);\n\t\t\tif ($list) {\n\t\t\t\tforeach ($list as $v) {\n\t\t\t\t\t$file_to_del = $path . '\/' . $v['filename'] . '.' . ($file_type == 'js' ? 'js' : 'css');\n\t\t\t\t\tif (file_exists($file_to_del)) {\n\t\t\t\t\t\t\/\/ Safe to delete\n\t\t\t\t\t\tself::debug('Delete expired unused file: ' . $file_to_del);\n\n\t\t\t\t\t\t\/\/ Clear related lscache first to avoid cache copy of same URL w\/ diff QS\n\t\t\t\t\t\t\/\/ Purge::add( Tag::TYPE_MIN . '.' . $file_row[ 'filename' ] . '.' . $file_type );\n\n\t\t\t\t\t\tunlink($file_to_del);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$q = \"DELETE FROM `$tb_url_file` WHERE url_id = %d AND expired BETWEEN 1 AND %d\";\n\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $url_id, time() )));\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Purge this URL to avoid cache copy of same URL w\/ diff QS\n\t\t\/\/ $this->cls( 'Purge' )->purge_url( Utility::make_relative( $request_url ) ?: '\/', true, true );\n\t}\n\n\t\/**\n\t * Load CCSS related file\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function load_url_file( $request_url, $vary, $file_type ) {\n\t\tglobal $wpdb;\n\n\t\tif (strlen($vary) > 32) {\n\t\t\t$vary = md5($vary);\n\t\t}\n\n\t\t$type = $this->_url_file_types[$file_type];\n\n\t\tself::debug2('load url file: ' . $request_url);\n\n\t\t$tb_url  = $this->tb('url');\n\t\t$q       = \"SELECT * FROM `$tb_url` WHERE url=%s\";\n\t\t$url_row = $wpdb->get_row($wpdb->prepare($q, $request_url), ARRAY_A);\n\t\tif (!$url_row) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$url_id = $url_row['id'];\n\n\t\t$tb_url_file = $this->tb('url_file');\n\t\t$q           = \"SELECT * FROM `$tb_url_file` WHERE url_id=%d AND vary=%s AND type=%d AND expired=0\";\n\t\t$file_row    = $wpdb->get_row($wpdb->prepare($q, array( $url_id, $vary, $type )), ARRAY_A);\n\t\tif (!$file_row) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $file_row['filename'];\n\t}\n\n\t\/**\n\t * Mark all entries of one URL to expired\n\t *\n\t * @since 4.5\n\t *\/\n\tpublic function mark_as_expired( $request_url, $auto_q = false ) {\n\t\tglobal $wpdb;\n\t\t$tb_url = $this->tb('url');\n\n\t\tself::debug('Try to mark as expired: ' . $request_url);\n\t\t$q       = \"SELECT * FROM `$tb_url` WHERE url=%s\";\n\t\t$url_row = $wpdb->get_row($wpdb->prepare($q, $request_url), ARRAY_A);\n\t\tif (!$url_row) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Mark url_id=' . $url_row['id'] . ' as expired');\n\n\t\t$tb_url_file = $this->tb('url_file');\n\n\t\t$existing_url_files = array();\n\t\tif ($auto_q) {\n\t\t\t$q                  = \"SELECT a.*, b.url FROM `$tb_url_file` a LEFT JOIN `$tb_url` b ON b.id=a.url_id WHERE a.url_id=%d AND a.type=4 AND a.expired=0\";\n\t\t\t$q                  = $wpdb->prepare($q, $url_row['id']);\n\t\t\t$existing_url_files = $wpdb->get_results($q, ARRAY_A);\n\t\t}\n\t\t$q       = \"UPDATE `$tb_url_file` SET expired=%d WHERE url_id=%d AND type=4 AND expired=0\";\n\t\t$expired = time() + 86400 * apply_filters('litespeed_url_file_expired_days', 20);\n\t\t$wpdb->query($wpdb->prepare($q, array( $expired, $url_row['id'] )));\n\n\t\treturn $existing_url_files;\n\t}\n\n\t\/**\n\t * Get list from `data\/css_excludes.txt`\n\t *\n\t * @since  3.6\n\t *\/\n\tpublic function load_css_exc( $list ) {\n\t\t$data = $this->_load_per_line('css_excludes.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/ccss_whitelist.txt`\n\t *\n\t * @since  7.1\n\t *\/\n\tpublic function load_ccss_whitelist( $list ) {\n\t\t$data = $this->_load_per_line('ccss_whitelist.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/ucss_whitelist.txt`\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function load_ucss_whitelist( $list ) {\n\t\t$data = $this->_load_per_line('ucss_whitelist.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/js_excludes.txt`\n\t *\n\t * @since  3.5\n\t *\/\n\tpublic function load_js_exc( $list ) {\n\t\t$data = $this->_load_per_line('js_excludes.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/js_defer_excludes.txt`\n\t *\n\t * @since  3.6\n\t *\/\n\tpublic function load_js_defer_exc( $list ) {\n\t\t$data = $this->_load_per_line('js_defer_excludes.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/optm_uri_exc.txt`\n\t *\n\t * @since  5.4\n\t *\/\n\tpublic function load_optm_uri_exc( $list ) {\n\t\t$data = $this->_load_per_line('optm_uri_exc.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/esi.nonces.txt`\n\t *\n\t * @since  3.5\n\t *\/\n\tpublic function load_esi_nonces( $list ) {\n\t\t$data = $this->_load_per_line('esi.nonces.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Get list from `data\/cache_nocacheable.txt`\n\t *\n\t * @since  6.3.0.1\n\t *\/\n\tpublic function load_cache_nocacheable( $list ) {\n\t\t$data = $this->_load_per_line('cache_nocacheable.txt');\n\t\tif ($data) {\n\t\t\t$list = array_unique(array_filter(array_merge($list, $data)));\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Load file per line\n\t *\n\t * Support two kinds of comments:\n\t *      1. `# this is comment`\n\t *      2. `##this is comment`\n\t *\n\t * @since  3.5\n\t *\/\n\tprivate function _load_per_line( $file ) {\n\t\t$data = File::read(LSCWP_DIR . 'data\/' . $file);\n\t\t$data = explode(PHP_EOL, $data);\n\t\t$list = array();\n\t\tforeach ($data as $v) {\n\t\t\t\/\/ Drop two kinds of comments\n\t\t\tif (strpos($v, '##') !== false) {\n\t\t\t\t$v = trim(substr($v, 0, strpos($v, '##')));\n\t\t\t}\n\t\t\tif (strpos($v, '# ') !== false) {\n\t\t\t\t$v = trim(substr($v, 0, strpos($v, '# ')));\n\t\t\t}\n\n\t\t\tif (!$v) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$list[] = $v;\n\t\t}\n\n\t\treturn $list;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/tool.cls.php","ext":"php","size":4318,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The tools\n *\n * @since       3.0\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Tool\n *\n * Provides utility functions for LiteSpeed Cache, including IP detection and heartbeat control.\n *\n * @since 3.0\n *\/\nclass Tool extends Root {\n\n\tconst LOG_TAG = '[Tool]';\n\n\t\/**\n\t * Get public IP\n\t *\n\t * Retrieves the public IP address of the server.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @return string The public IP address or an error message.\n\t *\/\n\tpublic function check_ip() {\n\t\tself::debug( '\u2705 check_ip' );\n\n\t\t$response = wp_safe_remote_get( 'https:\/\/cyberpanel.sh\/?ip', array(\n\t\t\t'headers' => array(\n\t\t\t\t'User-Agent' => 'curl\/8.7.1',\n\t\t\t),\n\t\t) );\n\n\t\tif ( is_wp_error( $response ) ) {\n\t\t\treturn esc_html__( 'Failed to detect IP', 'litespeed-cache' );\n\t\t}\n\n\t\t$ip = trim( $response['body'] );\n\n\t\tself::debug( 'result [ip] ' . $ip );\n\n\t\tif ( Utility::valid_ipv4( $ip ) ) {\n\t\t\treturn $ip;\n\t\t}\n\n\t\treturn esc_html__( 'Failed to detect IP', 'litespeed-cache' );\n\t}\n\n\t\/**\n\t * Heartbeat Control\n\t *\n\t * Configures WordPress heartbeat settings for frontend, backend, and editor.\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function heartbeat() {\n\t\tadd_action( 'wp_enqueue_scripts', array( $this, 'heartbeat_frontend' ) );\n\t\tadd_action( 'admin_enqueue_scripts', array( $this, 'heartbeat_backend' ) );\n\t\tadd_filter( 'heartbeat_settings', array( $this, 'heartbeat_settings' ) );\n\t}\n\n\t\/**\n\t * Heartbeat Control frontend control\n\t *\n\t * Manages heartbeat settings for the frontend.\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function heartbeat_frontend() {\n\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_FRONT ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_FRONT_TTL ) ) {\n\t\t\twp_deregister_script( 'heartbeat' );\n\t\t\tDebug2::debug( '[Tool] Deregistered frontend heartbeat' );\n\t\t}\n\t}\n\n\t\/**\n\t * Heartbeat Control backend control\n\t *\n\t * Manages heartbeat settings for the backend and editor.\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function heartbeat_backend() {\n\t\tif ( $this->is_editor() ) {\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_EDITOR ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_EDITOR_TTL ) ) {\n\t\t\t\twp_deregister_script( 'heartbeat' );\n\t\t\t\tDebug2::debug( '[Tool] Deregistered editor heartbeat' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_BACK ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( ! $this->conf( Base::O_MISC_HEARTBEAT_BACK_TTL ) ) {\n\t\t\t\twp_deregister_script( 'heartbeat' );\n\t\t\t\tDebug2::debug( '[Tool] Deregistered backend heartbeat' );\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Heartbeat Control settings\n\t *\n\t * Adjusts heartbeat interval settings based on configuration.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param array $settings Existing heartbeat settings.\n\t * @return array Modified heartbeat settings.\n\t *\/\n\tpublic function heartbeat_settings( $settings ) {\n\t\t\/\/ Check editor first to make frontend editor valid too\n\t\tif ( $this->is_editor() ) {\n\t\t\tif ( $this->conf( Base::O_MISC_HEARTBEAT_EDITOR ) ) {\n\t\t\t\t$settings['interval'] = $this->conf( Base::O_MISC_HEARTBEAT_EDITOR_TTL );\n\t\t\t\tDebug2::debug( '[Tool] Heartbeat interval set to ' . $this->conf( Base::O_MISC_HEARTBEAT_EDITOR_TTL ) );\n\t\t\t}\n\t\t} elseif ( ! is_admin() ) {\n\t\t\tif ( $this->conf( Base::O_MISC_HEARTBEAT_FRONT ) ) {\n\t\t\t\t$settings['interval'] = $this->conf( Base::O_MISC_HEARTBEAT_FRONT_TTL );\n\t\t\t\tDebug2::debug( '[Tool] Heartbeat interval set to ' . $this->conf( Base::O_MISC_HEARTBEAT_FRONT_TTL ) );\n\t\t\t}\n\t\t} elseif ( $this->conf( Base::O_MISC_HEARTBEAT_BACK ) ) {\n\t\t\t$settings['interval'] = $this->conf( Base::O_MISC_HEARTBEAT_BACK_TTL );\n\t\t\tDebug2::debug( '[Tool] Heartbeat interval set to ' . $this->conf( Base::O_MISC_HEARTBEAT_BACK_TTL ) );\n\t\t}\n\t\treturn $settings;\n\t}\n\n\t\/**\n\t * Check if in editor\n\t *\n\t * Determines if the current request is within the WordPress editor.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @return bool True if in editor, false otherwise.\n\t *\/\n\tpublic function is_editor() {\n\t\t$request_uri = isset( $_SERVER['REQUEST_URI'] ) ? sanitize_text_field( wp_unslash( $_SERVER['REQUEST_URI'] ) ) : '';\n\t\t$res         = is_admin() && Utility::str_hit_array( $request_uri, array( 'post.php', 'post-new.php' ) );\n\n\t\treturn apply_filters( 'litespeed_is_editor', $res );\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/data.upgrade.func.php","ext":"php","size":3147,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * Database upgrade funcs\n *\n * NOTE: whenever called this file, always call Data::get_upgrade_lock and Data::_set_upgrade_lock first.\n *\n * @since  3.0\n *\/\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Debug2;\nuse LiteSpeed\\Cloud;\n\n\/**\n * Table existence check function\n *\n * @since 7.2\n *\/\nfunction litespeed_table_exists( $table_name ) {\n\tglobal $wpdb;\n\t$save_state = $wpdb->suppress_errors;\n\t$wpdb->suppress_errors(true);\n\t$tb_exists = $wpdb->get_var('DESCRIBE `' . $table_name . '`');\n\t$wpdb->suppress_errors($save_state);\n\n\treturn $tb_exists !== null;\n}\n\n\/**\n * Migrate v7.0- url_files URL from no trailing slash to trailing slash\n *\n * @since 7.0.1\n *\/\nfunction litespeed_update_7_0_1() {\n\tglobal $wpdb;\n\tDebug2::debug('[Data] v7.0.1 upgrade started');\n\n\t$tb_url = $wpdb->prefix . 'litespeed_url';\n\tif (!litespeed_table_exists($tb_url)) {\n\t\tDebug2::debug('[Data] Table `litespeed_url` not found, bypassed migration');\n\t\treturn;\n\t}\n\n\t$q             = \"SELECT * FROM `$tb_url` WHERE url LIKE 'https:\/\/%\/'\";\n\t$q             = $wpdb->prepare($q);\n\t$list          = $wpdb->get_results($q, ARRAY_A);\n\t$existing_urls = array();\n\tif ($list) {\n\t\tforeach ($list as $v) {\n\t\t\t$existing_urls[] = $v['url'];\n\t\t}\n\t}\n\n\t$q    = \"SELECT * FROM `$tb_url` WHERE url LIKE 'https:\/\/%'\";\n\t$q    = $wpdb->prepare($q);\n\t$list = $wpdb->get_results($q, ARRAY_A);\n\tif (!$list) {\n\t\treturn;\n\t}\n\tforeach ($list as $v) {\n\t\tif (substr($v['url'], -1) == '\/') {\n\t\t\tcontinue;\n\t\t}\n\t\t$new_url = $v['url'] . '\/';\n\t\tif (in_array($new_url, $existing_urls)) {\n\t\t\tcontinue;\n\t\t}\n\t\t$q = \"UPDATE `$tb_url` SET url = %s WHERE id = %d\";\n\t\t$q = $wpdb->prepare($q, $new_url, $v['id']);\n\t\t$wpdb->query($q);\n\t}\n}\n\n\/**\n * Migrate from domain key to pk\/sk for QC\n *\n * @since 7.0\n *\/\nfunction litespeed_update_7() {\n\tDebug2::debug('[Data] v7 upgrade started');\n\n\t$__cloud = Cloud::cls();\n\n\t$domain_key = $__cloud->conf('api_key');\n\tif (!$domain_key) {\n\t\tDebug2::debug('[Data] No domain key, bypassed migration');\n\t\treturn;\n\t}\n\n\t$new_prepared = $__cloud->init_qc_prepare();\n\tif (!$new_prepared && $__cloud->activated()) {\n\t\tDebug2::debug('[Data] QC previously activated in v7, bypassed migration');\n\t\treturn;\n\t}\n\t$data = array(\n\t\t'domain_key' => $domain_key,\n\t);\n\t$resp = $__cloud->post(Cloud::SVC_D_V3UPGRADE, $data);\n\tif (!empty($resp['qc_activated'])) {\n\t\tif ($resp['qc_activated'] != 'deleted') {\n\t\t\t$cloud_summary_updates = array( 'qc_activated' => $resp['qc_activated'] );\n\t\t\tif (!empty($resp['main_domain'])) {\n\t\t\t\t$cloud_summary_updates['main_domain'] = $resp['main_domain'];\n\t\t\t}\n\t\t\tCloud::save_summary($cloud_summary_updates);\n\t\t\tDebug2::debug('[Data] Updated QC activated status to ' . $resp['qc_activated']);\n\t\t}\n\t}\n}\n\n\/**\n * Append webp\/mobile to url_file\n *\n * @since 5.3\n *\/\nfunction litespeed_update_5_3() {\n\tglobal $wpdb;\n\tDebug2::debug('[Data] Upgrade url_file table');\n\n\t$tb = $wpdb->prefix . 'litespeed_url_file';\n\tif (litespeed_table_exists($tb)) {\n\t\t$q =\n\t\t\t'ALTER TABLE `' .\n\t\t\t$tb .\n\t\t\t'`\n\t\t\t\tADD COLUMN `mobile` tinyint(4) NOT NULL COMMENT \"mobile=1\",\n\t\t\t\tADD COLUMN `webp` tinyint(4) NOT NULL COMMENT \"webp=1\"\n\t\t\t';\n\t\t$wpdb->query($q);\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/core.cls.php","ext":"php","size":21519,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The core plugin class.\n *\n * This is the main class for the LiteSpeed Cache plugin, responsible for initializing\n * the plugin's core functionality, registering hooks, and handling cache-related operations.\n *\n * Note: Core doesn't allow $this->cls( 'Core' )\n *\n * @since 1.0.0\n * @package LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Core\n *\n * @since 1.0.0\n *\/\nclass Core extends Root {\n\n\tconst NAME        = 'LiteSpeed Cache';\n\tconst PLUGIN_NAME = 'litespeed-cache';\n\tconst PLUGIN_FILE = 'litespeed-cache\/litespeed-cache.php';\n\tconst VER         = LSCWP_V;\n\n\tconst ACTION_DISMISS             = 'dismiss';\n\tconst ACTION_PURGE_BY            = 'PURGE_BY';\n\tconst ACTION_PURGE_EMPTYCACHE    = 'PURGE_EMPTYCACHE';\n\tconst ACTION_QS_PURGE            = 'PURGE';\n\tconst ACTION_QS_PURGE_SINGLE     = 'PURGESINGLE'; \/\/ This will be same as `ACTION_QS_PURGE` (purge single URL only)\n\tconst ACTION_QS_SHOW_HEADERS     = 'SHOWHEADERS';\n\tconst ACTION_QS_PURGE_ALL        = 'purge_all';\n\tconst ACTION_QS_PURGE_EMPTYCACHE = 'empty_all';\n\tconst ACTION_QS_NOCACHE          = 'NOCACHE';\n\n\tconst HEADER_DEBUG = 'X-LiteSpeed-Debug';\n\n\t\/**\n\t * Whether to show debug headers.\n\t *\n\t * @var bool\n\t * @since 1.0.0\n\t *\/\n\tprotected static $debug_show_header = false;\n\n\t\/**\n\t * Footer comment buffer.\n\t *\n\t * @var string\n\t * @since 1.0.0\n\t *\/\n\tprivate $footer_comment = '';\n\n\t\/**\n\t * Define the core functionality of the plugin.\n\t *\n\t * Set the plugin name and the plugin version that can be used throughout the plugin.\n\t * Load the dependencies, define the locale, and set the hooks for the admin area and\n\t * the public-facing side of the site.\n\t *\n\t * @since 1.0.0\n\t *\/\n\tpublic function __construct() {\n\t\t! defined( 'LSCWP_TS_0' ) && define( 'LSCWP_TS_0', microtime( true ) );\n\t\t$this->cls( 'Conf' )->init();\n\n\t\t\/**\n\t\t * Load API hooks\n\t\t *\n\t\t * @since 3.0\n\t\t *\/\n\t\t$this->cls( 'API' )->init();\n\n\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t\/\/ Load third party detection if lscache enabled.\n\t\t\tinclude_once LSCWP_DIR . 'thirdparty\/entry.inc.php';\n\t\t}\n\n\n\t\tif ( $this->conf( Base::O_DEBUG_DISABLE_ALL ) || Debug2::is_tmp_disable() ) {\n\t\t\t! defined( 'LITESPEED_DISABLE_ALL' ) && define( 'LITESPEED_DISABLE_ALL', true );\n\t\t}\n\n\t\t\/**\n\t\t * Register plugin activate\/deactivate\/uninstall hooks\n\t\t * NOTE: this can't be moved under after_setup_theme, otherwise activation will be bypassed\n\t\t *\n\t\t * @since 2.7.1 Disabled admin&CLI check to make frontend able to enable cache too\n\t\t *\/\n\t\t$plugin_file = LSCWP_DIR . 'litespeed-cache.php';\n\t\tregister_activation_hook( $plugin_file, array( __NAMESPACE__ . '\\Activation', 'register_activation' ) );\n\t\tregister_deactivation_hook( $plugin_file, array( __NAMESPACE__ . '\\Activation', 'register_deactivation' ) );\n\t\tregister_uninstall_hook( $plugin_file, __NAMESPACE__ . '\\Activation::uninstall_litespeed_cache' );\n\n\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t\/\/ Register purge_all actions\n\t\t\t$purge_all_events = $this->conf( Base::O_PURGE_HOOK_ALL );\n\n\t\t\t\/\/ Purge all on upgrade\n\t\t\tif ( $this->conf( Base::O_PURGE_ON_UPGRADE ) ) {\n\t\t\t\t$purge_all_events[] = 'automatic_updates_complete';\n\t\t\t\t$purge_all_events[] = 'upgrader_process_complete';\n\t\t\t\t$purge_all_events[] = 'admin_action_do-plugin-upgrade';\n\t\t\t}\n\t\t\tforeach ( $purge_all_events as $event ) {\n\t\t\t\t\/\/ Don't allow hook to update_option because purge_all will cause infinite loop of update_option\n\t\t\t\tif ( in_array( $event, array( 'update_option' ), true ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tadd_action( $event, __NAMESPACE__ . '\\Purge::purge_all' );\n\t\t\t}\n\n\t\t\t\/\/ Add headers to site health check for full page cache\n\t\t\t\/\/ @since 5.4\n\t\t\tadd_filter( 'site_status_page_cache_supported_cache_headers', function ( $cache_headers ) {\n\t\t\t\t$is_cache_hit                       = function ( $header_value ) {\n\t\t\t\t\treturn false !== strpos( strtolower( $header_value ), 'hit' );\n\t\t\t\t};\n\t\t\t\t$cache_headers['x-litespeed-cache'] = $is_cache_hit;\n\t\t\t\t$cache_headers['x-lsadc-cache']     = $is_cache_hit;\n\t\t\t\t$cache_headers['x-qc-cache']        = $is_cache_hit;\n\t\t\t\treturn $cache_headers;\n\t\t\t} );\n\t\t}\n\n\t\tadd_action( 'after_setup_theme', array( $this, 'init' ) );\n\n\t\t\/\/ Check if there is a purge request in queue\n\t\tif ( ! defined( 'LITESPEED_CLI' ) ) {\n\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE );\n\t\t\tif ( $purge_queue && '-1' !== $purge_queue ) {\n\t\t\t\t$this->http_header( $purge_queue );\n\t\t\t\tDebug2::debug( '[Core] Purge Queue found&sent: ' . $purge_queue );\n\t\t\t}\n\t\t\tif ( '-1' !== $purge_queue ) {\n\t\t\t\tPurge::update_option( Purge::DB_QUEUE, '-1' ); \/\/ Use -1 to bypass purge while still enable db update as WP's update_option will check value===false to bypass update\n\t\t\t}\n\n\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE2 );\n\t\t\tif ( $purge_queue && '-1' !== $purge_queue ) {\n\t\t\t\t$this->http_header( $purge_queue );\n\t\t\t\tDebug2::debug( '[Core] Purge2 Queue found&sent: ' . $purge_queue );\n\t\t\t}\n\t\t\tif ( '-1' !== $purge_queue ) {\n\t\t\t\tPurge::update_option( Purge::DB_QUEUE2, '-1' );\n\t\t\t}\n\t\t}\n\n\t\t\/**\n\t\t * Hook internal REST\n\t\t *\n\t\t * @since 2.9.4\n\t\t *\/\n\t\t$this->cls( 'REST' );\n\n\t\t\/**\n\t\t * Hook wpnonce function\n\t\t *\n\t\t * Note: ESI nonce won't be available until hook after_setup_theme ESI init due to Guest Mode concern\n\t\t *\n\t\t * @since 4.1\n\t\t *\/\n\t\tif ( $this->cls( 'Router' )->esi_enabled() && ! function_exists( 'wp_create_nonce' ) ) {\n\t\t\tDebug2::debug( '[ESI] Overwrite wp_create_nonce()' );\n\t\t\tlitespeed_define_nonce_func();\n\t\t}\n\t}\n\n\t\/**\n\t * The plugin initializer.\n\t *\n\t * This function checks if the cache is enabled and ready to use, then determines what actions need to be set up based on the type of user and page accessed. Output is buffered if the cache is enabled.\n\t *\n\t * NOTE: WP user doesn't init yet\n\t *\n\t * @since 1.0.0\n\t *\/\n\tpublic function init() {\n\t\t\/**\n\t\t * Added hook before init\n\t\t * 3rd party preload hooks will be fired here too (e.g. Divi disable all in edit mode)\n\t\t *\n\t\t * @since 1.6.6\n\t\t * @since 2.6 Added filter to all config values in Conf\n\t\t *\/\n\t\tdo_action( 'litespeed_init' );\n\t\tadd_action( 'wp_ajax_async_litespeed', 'LiteSpeed\\Task::async_litespeed_handler' );\n\t\tadd_action( 'wp_ajax_nopriv_async_litespeed', 'LiteSpeed\\Task::async_litespeed_handler' );\n\n\t\t\/\/ In `after_setup_theme`, before `init` hook\n\t\t$this->cls( 'Activation' )->auto_update();\n\n\t\tif ( is_admin() && ! wp_doing_ajax() ) {\n\t\t\t$this->cls( 'Admin' );\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_DISABLE_ALL' ) && LITESPEED_DISABLE_ALL ) {\n\t\t\tDebug2::debug( '[Core] Bypassed due to debug disable all setting' );\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action( 'litespeed_initing' );\n\n\t\tob_start( array( $this, 'send_headers_force' ) );\n\t\tadd_action( 'shutdown', array( $this, 'send_headers' ), 0 );\n\t\tadd_action( 'wp_footer', array( $this, 'footer_hook' ) );\n\n\t\t\/**\n\t\t * Check if is non-optimization simulator\n\t\t *\n\t\t * @since 2.9\n\t\t *\/\n\t\t\/\/ phpcs:ignore WordPress.Security.NonceVerification.Recommended\n\t\tif ( ! empty( $_GET[ Router::ACTION ] ) && 'before_optm' === $_GET[ Router::ACTION ] && ! apply_filters( 'litespeed_qs_forbidden', false ) ) {\n\t\t\tDebug2::debug( '[Core] \u26d1\ufe0f bypass_optm due to QS CTRL' );\n\t\t\t! defined( 'LITESPEED_NO_OPTM' ) && define( 'LITESPEED_NO_OPTM', true );\n\t\t}\n\n\t\t\/**\n\t\t * Register vary filter\n\t\t *\n\t\t * @since 1.6.2\n\t\t *\/\n\t\t$this->cls( 'Control' )->init();\n\n\t\t\/\/ Init Purge hooks\n\t\t$this->cls( 'Purge' )->init();\n\n\t\t$this->cls( 'Tag' )->init();\n\n\t\t\/\/ Load hooks that may be related to users\n\t\tadd_action( 'init', array( $this, 'after_user_init' ), 5 );\n\n\t\t\/\/ Load 3rd party hooks\n\t\tadd_action( 'wp_loaded', array( $this, 'load_thirdparty' ), 2 );\n\t}\n\n\t\/**\n\t * Run hooks after user init\n\t *\n\t * @since 2.9.8\n\t *\/\n\tpublic function after_user_init() {\n\t\t$this->cls( 'Router' )->is_role_simulation();\n\n\t\t\/\/ Detect if is Guest mode or not\n\t\t$this->cls( 'Vary' )->after_user_init();\n\n\t\t\/\/ Register attachment delete hook\n\t\t$this->cls( 'Media' )->after_user_init();\n\n\t\t\/**\n\t\t * Preload ESI functionality for ESI request URI recovery\n\t\t *\n\t\t * @since 1.8.1\n\t\t * @since 4.0 ESI init needs to be after Guest mode detection to bypass ESI if is under Guest mode\n\t\t *\/\n\t\t$this->cls( 'ESI' )->init();\n\n\t\tif ( ! is_admin() && ! defined( 'LITESPEED_GUEST_OPTM' ) ) {\n\t\t\t$result = $this->cls( 'Conf' )->in_optm_exc_roles();\n\t\t\tif ( $result ) {\n\t\t\t\tDebug2::debug( '[Core] \u26d1\ufe0f bypass_optm: hit Role Excludes setting: ' . $result );\n\t\t\t\t! defined( 'LITESPEED_NO_OPTM' ) && define( 'LITESPEED_NO_OPTM', true );\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Heartbeat control\n\t\t$this->cls( 'Tool' )->heartbeat();\n\n\t\tif ( ! defined( 'LITESPEED_NO_OPTM' ) || ! LITESPEED_NO_OPTM ) {\n\t\t\t\/\/ Check missing static files\n\t\t\t$this->cls( 'Router' )->serve_static();\n\n\t\t\t$this->cls( 'Media' )->init();\n\n\t\t\t$this->cls( 'Placeholder' )->init();\n\n\t\t\t$this->cls( 'Router' )->can_optm() && $this->cls( 'Optimize' )->init();\n\n\t\t\t$this->cls( 'Localization' )->init();\n\n\t\t\t\/\/ Hook CDN for attachments\n\t\t\t$this->cls( 'CDN' )->init();\n\n\t\t\t\/\/ Load cron tasks\n\t\t\t$this->cls( 'Task' )->init();\n\t\t}\n\n\t\t\/\/ Load litespeed actions\n\t\t$action = Router::get_action();\n\t\tif ( $action ) {\n\t\t\t$this->proceed_action( $action );\n\t\t}\n\n\t\t\/\/ Load frontend GUI\n\t\tif ( ! is_admin() ) {\n\t\t\t$this->cls( 'GUI' )->init();\n\t\t}\n\t}\n\n\t\/**\n\t * Run frontend actions\n\t *\n\t * @since 1.1.0\n\t * @param string $action The action to proceed.\n\t *\/\n\tpublic function proceed_action( $action ) {\n\t\t$msg = false;\n\t\t\/\/ Handle actions\n\t\tswitch ( $action ) {\n\t\t\tcase self::ACTION_QS_SHOW_HEADERS:\n\t\t\t\tself::$debug_show_header = true;\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_QS_PURGE:\n\t\t\tcase self::ACTION_QS_PURGE_SINGLE:\n\t\t\t\tPurge::set_purge_single();\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_QS_PURGE_ALL:\n\t\t\t\tPurge::purge_all();\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_PURGE_EMPTYCACHE:\n\t\t\tcase self::ACTION_QS_PURGE_EMPTYCACHE:\n\t\t\t\tdefine( 'LSWCP_EMPTYCACHE', true ); \/\/ Clear all sites caches\n\t\t\t\tPurge::purge_all();\n\t\t\t\t$msg = __( 'Notified LiteSpeed Web Server to purge everything.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_PURGE_BY:\n\t\t\t\t$this->cls( 'Purge' )->purge_list();\n\t\t\t\t$msg = __( 'Notified LiteSpeed Web Server to purge the list.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase self::ACTION_DISMISS:\n\t\t\t\tGUI::dismiss();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t$msg = $this->cls( 'Router' )->handler( $action );\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( $msg && ! Router::is_ajax() ) {\n\t\t\tAdmin_Display::add_notice( Admin_Display::NOTICE_GREEN, $msg );\n\t\t\tAdmin::redirect();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Router::is_ajax() ) {\n\t\t\texit();\n\t\t}\n\t}\n\n\t\/**\n\t * Callback used to call the detect third party action.\n\t *\n\t * The detect action is used by third party plugin integration classes to determine if they should add the rest of their hooks.\n\t *\n\t * @since 1.0.5\n\t *\/\n\tpublic function load_thirdparty() {\n\t\tdo_action( 'litespeed_load_thirdparty' );\n\t}\n\n\t\/**\n\t * Mark wp_footer called\n\t *\n\t * @since 1.3\n\t *\/\n\tpublic function footer_hook() {\n\t\tDebug2::debug( '[Core] Footer hook called' );\n\t\tif ( ! defined( 'LITESPEED_FOOTER_CALLED' ) ) {\n\t\t\tdefine( 'LITESPEED_FOOTER_CALLED', true );\n\t\t}\n\t}\n\n\t\/**\n\t * Trigger comment info display hook\n\t *\n\t * @since 1.3\n\t * @param string|null $buffer The buffer to check.\n\t * @return void\n\t *\/\n\tprivate function check_is_html( $buffer = null ) {\n\t\tif ( ! defined( 'LITESPEED_FOOTER_CALLED' ) ) {\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: miss footer const' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( wp_doing_ajax() ) {\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: doing ajax' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( wp_doing_cron() ) {\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: doing cron' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( empty( $_SERVER['REQUEST_METHOD'] ) || 'GET' !== $_SERVER['REQUEST_METHOD'] ) {\n\t\t\t\/\/ phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized\n\t\t\tDebug2::debug2( '[Core] CHK html bypass: not get method ' . wp_unslash( $_SERVER['REQUEST_METHOD'] ) );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( null === $buffer ) {\n\t\t\t$buffer = ob_get_contents();\n\t\t}\n\n\t\t\/\/ Double check to make sure it is an HTML file\n\t\tif ( strlen( $buffer ) > 300 ) {\n\t\t\t$buffer = substr( $buffer, 0, 300 );\n\t\t}\n\t\tif ( false !== strstr( $buffer, '<!--' ) ) {\n\t\t\t$buffer = preg_replace( '\/<!--.*?-->\/s', '', $buffer );\n\t\t}\n\t\t$buffer = trim( $buffer );\n\n\t\t$buffer = File::remove_zero_space( $buffer );\n\n\t\t$is_html = 0 === stripos( $buffer, '<html' ) || 0 === stripos( $buffer, '<!DOCTYPE' );\n\n\t\tif ( ! $is_html ) {\n\t\t\tDebug2::debug( '[Core] Footer check failed: ' . ob_get_level() . '-' . substr( $buffer, 0, 100 ) );\n\t\t\treturn;\n\t\t}\n\n\t\tDebug2::debug( '[Core] Footer check passed' );\n\n\t\tif ( ! defined( 'LITESPEED_IS_HTML' ) ) {\n\t\t\tdefine( 'LITESPEED_IS_HTML', true );\n\t\t}\n\t}\n\n\t\/**\n\t * For compatibility with plugins that have 'Bad' logic that forced all buffer output even if it is NOT their buffer.\n\t *\n\t * Usually this is called after send_headers() if following original WP process\n\t *\n\t * @since 1.1.5\n\t * @param string $buffer The buffer to process.\n\t * @return string The processed buffer.\n\t *\/\n\tpublic function send_headers_force( $buffer ) {\n\t\t$this->check_is_html( $buffer );\n\n\t\t\/\/ Hook to modify buffer before\n\t\t$buffer = apply_filters( 'litespeed_buffer_before', $buffer );\n\n\t\t\/**\n\t\t * Media: Image lazyload && WebP\n\t\t * GUI: Clean wrapper mainly for ESI block NOTE: this needs to be before optimizer to avoid wrapper being removed\n\t\t * Optimize\n\t\t * CDN\n\t\t *\/\n\t\tif ( ! defined( 'LITESPEED_NO_OPTM' ) || ! LITESPEED_NO_OPTM ) {\n\t\t\tDebug2::debug( '[Core] run hook litespeed_buffer_finalize' );\n\t\t\t$buffer = apply_filters( 'litespeed_buffer_finalize', $buffer );\n\t\t}\n\n\t\t\/**\n\t\t * Replace ESI preserved list\n\t\t *\n\t\t * @since 3.3 Replace this in the end to avoid `Inline JS Defer` or other Page Optm features encoded ESI tags wrongly, which caused LSWS can't recognize ESI\n\t\t *\/\n\t\t$buffer = $this->cls( 'ESI' )->finalize( $buffer );\n\n\t\t$this->send_headers( true );\n\n\t\t\/\/ Log ESI nonce buffer empty issue\n\t\tif ( defined( 'LSCACHE_IS_ESI' ) && 0 === strlen( $buffer ) && ! empty( $_SERVER['REQUEST_URI'] ) ) {\n\t\t\t\/\/ Log ref for debug purpose\n\t\t\t\/\/ phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.PHP.DevelopmentFunctions.error_log_error_log\n\t\t\terror_log( 'ESI buffer empty ' . wp_unslash( $_SERVER['REQUEST_URI'] ) );\n\t\t}\n\n\t\t\/\/ Init comment info\n\t\t$running_info_showing = defined( 'LITESPEED_IS_HTML' ) || defined( 'LSCACHE_IS_ESI' );\n\t\tif ( defined( 'LSCACHE_ESI_SILENCE' ) ) {\n\t\t\t$running_info_showing = false;\n\t\t\tDebug2::debug( '[Core] ESI silence' );\n\t\t}\n\t\t\/**\n\t\t * Silence comment for JSON request\n\t\t *\n\t\t * @since 2.9.3\n\t\t *\/\n\t\tif ( REST::cls()->is_rest() || Router::is_ajax() ) {\n\t\t\t$running_info_showing = false;\n\t\t\tDebug2::debug( '[Core] Silence Comment due to REST\/AJAX' );\n\t\t}\n\t\t$running_info_showing = apply_filters( 'litespeed_comment', $running_info_showing );\n\t\tif ( $running_info_showing && $this->footer_comment ) {\n\t\t\t$buffer .= $this->footer_comment;\n\t\t}\n\n\t\t\/**\n\t\t * If ESI request is JSON, give the content JSON format\n\t\t *\n\t\t * @since 2.9.3\n\t\t * @since 2.9.4 ESI request could be from internal REST call, so moved json_encode out of this condition\n\t\t *\/\n\t\tif ( defined( 'LSCACHE_IS_ESI' ) ) {\n\t\t\tDebug2::debug( '[Core] ESI Start \ud83d\udc47' );\n\t\t\tif ( strlen( $buffer ) > 500 ) {\n\t\t\t\tDebug2::debug( trim( substr( $buffer, 0, 500 ) ) . '.....' );\n\t\t\t} else {\n\t\t\t\tDebug2::debug( $buffer );\n\t\t\t}\n\t\t\tDebug2::debug( '[Core] ESI End \ud83d\udc46' );\n\t\t}\n\n\t\tif ( apply_filters( 'litespeed_is_json', false ) ) {\n\t\t\tif ( null === \\json_decode( $buffer, true ) ) {\n\t\t\t\tDebug2::debug( '[Core] Buffer converting to JSON' );\n\t\t\t\t$buffer = wp_json_encode( $buffer );\n\t\t\t\t$buffer = trim( $buffer, '\"' );\n\t\t\t} else {\n\t\t\t\tDebug2::debug( '[Core] JSON Buffer' );\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Hook to modify buffer after\n\t\t$buffer = apply_filters( 'litespeed_buffer_after', $buffer );\n\n\t\tDebug2::ended();\n\n\t\treturn $buffer;\n\t}\n\n\t\/**\n\t * Sends the headers out at the end of processing the request.\n\t *\n\t * This will send out all LiteSpeed Cache related response headers needed for the post.\n\t *\n\t * @since 1.0.5\n\t * @param bool $is_forced If the header is sent following our normal finalizing logic.\n\t *\/\n\tpublic function send_headers( $is_forced = false ) {\n\t\t\/\/ Make sure header output only runs once\n\t\tif ( defined( 'LITESPEED_DID_' . __FUNCTION__ ) ) {\n\t\t\treturn;\n\t\t}\n\t\tdefine( 'LITESPEED_DID_' . __FUNCTION__, true );\n\n\t\t\/\/ Avoid PHP warning for headers sent out already\n\t\tif ( headers_sent() ) {\n\t\t\tself::debug( '\u274c !!! Err: Header sent out already' );\n\t\t\treturn;\n\t\t}\n\n\t\t$this->check_is_html();\n\n\t\t\/\/ Cache control output needs to be done first, as some varies are added in 3rd party hook `litespeed_api_control`.\n\t\t$this->cls( 'Control' )->finalize();\n\n\t\t$vary_header = $this->cls( 'Vary' )->finalize();\n\n\t\t\/\/ If not cacheable but Admin QS is `purge` or `purgesingle`, `tag` still needs to be generated\n\t\t$tag_header = $this->cls( 'Tag' )->output();\n\t\tif ( ! $tag_header && Control::is_cacheable() ) {\n\t\t\tControl::set_nocache( 'empty tag header' );\n\t\t}\n\n\t\t\/\/ `Purge` output needs to be after `tag` output as Admin QS may need to send `tag` header\n\t\t$purge_header = Purge::output();\n\n\t\t\/\/ Generate `control` header in the end in case control status is changed by other headers\n\t\t$control_header = $this->cls( 'Control' )->output();\n\n\t\t\/\/ Give one more break to avoid Firefox crash\n\t\tif ( ! defined( 'LSCACHE_IS_ESI' ) ) {\n\t\t\t$this->footer_comment .= \"\\n\";\n\t\t}\n\n\t\t$cache_support = 'supported';\n\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t$cache_support = Control::is_cacheable() ? 'cached' : 'uncached';\n\t\t}\n\n\t\t$this->comment(\n\t\t\tsprintf(\n\t\t\t\t'%1$s %2$s by LiteSpeed Cache %4$s on %3$s',\n\t\t\t\tdefined( 'LSCACHE_IS_ESI' ) ? 'Block' : 'Page',\n\t\t\t\t$cache_support,\n\t\t\t\tgmdate( 'Y-m-d H:i:s', time() + LITESPEED_TIME_OFFSET ),\n\t\t\t\tself::VER\n\t\t\t)\n\t\t);\n\n\t\t\/\/ Send Control header\n\t\tif ( defined( 'LITESPEED_ON' ) && $control_header ) {\n\t\t\t$this->http_header( $control_header );\n\t\t\tif ( ! Control::is_cacheable() && !is_admin() ) {\n\t\t\t\t$ori_wp_header = wp_get_nocache_headers();\n\t\t\t\tif ( isset( $ori_wp_header['Cache-Control'] ) ) {\n\t\t\t\t\t$this->http_header( 'Cache-Control: ' . $ori_wp_header['Cache-Control'] ); \/\/ @ref: https:\/\/github.com\/litespeedtech\/lscache_wp\/issues\/889\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $control_header );\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Send PURGE header (Always send regardless of cache setting disabled\/enabled)\n\t\tif ( defined( 'LITESPEED_ON' ) && $purge_header ) {\n\t\t\t$this->http_header( $purge_header );\n\t\t\tDebug2::log_purge( $purge_header );\n\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $purge_header );\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Send Vary header\n\t\tif ( defined( 'LITESPEED_ON' ) && $vary_header ) {\n\t\t\t$this->http_header( $vary_header );\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $vary_header );\n\t\t\t}\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_ON' ) && defined( 'LSCWP_LOG' ) ) {\n\t\t\t$vary = $this->cls( 'Vary' )->finalize_full_varies();\n\t\t\tif ( $vary ) {\n\t\t\t\t$this->comment( 'Full varies: ' . $vary );\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Admin QS show header action\n\t\tif ( self::$debug_show_header ) {\n\t\t\t$debug_header = self::HEADER_DEBUG . ': ';\n\t\t\tif ( $control_header ) {\n\t\t\t\t$debug_header .= $control_header . '; ';\n\t\t\t}\n\t\t\tif ( $purge_header ) {\n\t\t\t\t$debug_header .= $purge_header . '; ';\n\t\t\t}\n\t\t\tif ( $tag_header ) {\n\t\t\t\t$debug_header .= $tag_header . '; ';\n\t\t\t}\n\t\t\tif ( $vary_header ) {\n\t\t\t\t$debug_header .= $vary_header . '; ';\n\t\t\t}\n\t\t\t$this->http_header( $debug_header );\n\t\t} elseif ( defined( 'LITESPEED_ON' ) && Control::is_cacheable() && $tag_header ) {\n\t\t\t$this->http_header( $tag_header );\n\t\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t\t$this->comment( $tag_header );\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Object cache comment\n\t\tif ( defined( 'LSCWP_LOG' ) && defined( 'LSCWP_OBJECT_CACHE' ) && method_exists( 'WP_Object_Cache', 'debug' ) ) {\n\t\t\t$this->comment( 'Object Cache ' . \\WP_Object_Cache::get_instance()->debug() );\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_GUEST' ) && LITESPEED_GUEST ) {\n\t\t\t$this->comment( 'Guest Mode' );\n\t\t}\n\n\t\tif ( ! empty( $this->footer_comment ) ) {\n\t\t\tself::debug( \"[footer comment]\\n\" . trim( $this->footer_comment ) );\n\t\t}\n\n\t\tif ( $is_forced ) {\n\t\t\tDebug2::debug( '--forced--' );\n\t\t}\n\n\t\t\/\/ If CLI and contains Purge Header, issue an HTTP request to Purge\n\t\tif ( defined( 'LITESPEED_CLI' ) ) {\n\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE );\n\t\t\tif ( ! $purge_queue || '-1' === $purge_queue ) {\n\t\t\t\t$purge_queue = Purge::get_option( Purge::DB_QUEUE2 );\n\t\t\t}\n\t\t\tif ( $purge_queue && '-1' !== $purge_queue ) {\n\t\t\t\tself::debug( '[Core] Purge Queue found, issue an HTTP request to purge: ' . $purge_queue );\n\t\t\t\t\/\/ Kick off HTTP request\n\t\t\t\t$url  = admin_url( 'admin-ajax.php' );\n\t\t\t\t$resp = wp_safe_remote_get( $url );\n\t\t\t\tif ( is_wp_error( $resp ) ) {\n\t\t\t\t\t$error_message = $resp->get_error_message();\n\t\t\t\t\tself::debug( '[URL]' . $url );\n\t\t\t\t\tself::debug( 'failed to request: ' . $error_message );\n\t\t\t\t} else {\n\t\t\t\t\tself::debug( 'HTTP request response: ' . $resp['body'] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Append one HTML comment\n\t *\n\t * @since 5.5\n\t * @param string $data The comment data.\n\t *\/\n\tpublic static function comment( $data ) {\n\t\tself::cls()->append_comment( $data );\n\t}\n\n\t\/**\n\t * Append one HTML comment\n\t *\n\t * @since 5.5\n\t * @param string $data The comment data.\n\t *\/\n\tprivate function append_comment( $data ) {\n\t\t$this->footer_comment .= \"\\n<!-- \" . $data . ' -->';\n\t}\n\n\t\/**\n\t * Send HTTP header\n\t *\n\t * @since 5.3\n\t * @param string $header The header to send.\n\t *\/\n\tprivate function http_header( $header ) {\n\t\tif ( defined( 'LITESPEED_CLI' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! headers_sent() ) {\n\t\t\theader( $header );\n\t\t}\n\n\t\tif ( ! defined( 'LSCWP_LOG' ) ) {\n\t\t\treturn;\n\t\t}\n\t\tDebug2::debug( '\ud83d\udcb0 ' . $header );\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/optimizer.cls.php","ext":"php","size":9640,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The optimize4 class.\n *\n * @since       1.9\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Optimizer extends Root {\n\n\tprivate $_conf_css_font_display;\n\n\t\/**\n\t * Init optimizer\n\t *\n\t * @since  1.9\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_conf_css_font_display = $this->conf(Base::O_OPTM_CSS_FONT_DISPLAY);\n\t}\n\n\t\/**\n\t * Run HTML minify process and return final content\n\t *\n\t * @since  1.9\n\t * @access public\n\t *\/\n\tpublic function html_min( $content, $force_inline_minify = false ) {\n\t\tif (!apply_filters('litespeed_html_min', true)) {\n\t\t\tDebug2::debug2('[Optmer] html_min bypassed via litespeed_html_min filter');\n\t\t\treturn $content;\n\t\t}\n\n\t\t$options = array();\n\n\t\tif ($force_inline_minify) {\n\t\t\t$options['jsMinifier'] = __CLASS__ . '::minify_js';\n\t\t}\n\n\t\t$skip_comments = $this->conf(Base::O_OPTM_HTML_SKIP_COMMENTS);\n\t\tif ($skip_comments) {\n\t\t\t$options['skipComments'] = $skip_comments;\n\t\t}\n\n\t\t\/**\n\t\t * Added exception capture when minify\n\t\t *\n\t\t * @since  2.2.3\n\t\t *\/\n\t\ttry {\n\t\t\t$obj           = new Lib\\HTML_MIN($content, $options);\n\t\t\t$content_final = $obj->process();\n\t\t\t\/\/ check if content from minification is empty\n\t\t\tif ($content_final == '') {\n\t\t\t\tDebug2::debug('Failed to minify HTML: HTML minification resulted in empty HTML');\n\t\t\t\treturn $content;\n\t\t\t}\n\t\t\tif (!defined('LSCACHE_ESI_SILENCE')) {\n\t\t\t\t$content_final .= \"\\n\" . '<!-- Page optimized by LiteSpeed Cache @' . date('Y-m-d H:i:s', time() + LITESPEED_TIME_OFFSET) . ' -->';\n\t\t\t}\n\t\t\treturn $content_final;\n\t\t} catch (\\Exception $e) {\n\t\t\tDebug2::debug('******[Optmer] html_min failed: ' . $e->getMessage());\n\t\t\terror_log('****** LiteSpeed Optimizer html_min failed: ' . $e->getMessage());\n\t\t\treturn $content;\n\t\t}\n\t}\n\n\t\/**\n\t * Run minify process and save content\n\t *\n\t * @since  1.9\n\t * @access public\n\t *\/\n\tpublic function serve( $request_url, $file_type, $minify, $src_list ) {\n\t\t\/\/ Try Unique CSS\n\t\tif ($file_type == 'css') {\n\t\t\t$content = false;\n\t\t\tif (defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_OPTM_UCSS)) {\n\t\t\t\t$filename = $this->cls('UCSS')->load($request_url);\n\n\t\t\t\tif ($filename) {\n\t\t\t\t\treturn array( $filename, 'ucss' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Before generated, don't know the contented hash filename yet, so used url hash as tmp filename\n\t\t$file_path_prefix = $this->_build_filepath_prefix($file_type);\n\n\t\t$url_tag          = $request_url;\n\t\t$url_tag_for_file = md5($request_url);\n\t\tif (is_404()) {\n\t\t\t$url_tag_for_file = $url_tag = '404';\n\t\t} elseif ($file_type == 'css' && apply_filters('litespeed_ucss_per_pagetype', false)) {\n\t\t\t$url_tag_for_file = $url_tag = Utility::page_type();\n\t\t}\n\n\t\t$static_file = LITESPEED_STATIC_DIR . $file_path_prefix . $url_tag_for_file . '.' . $file_type;\n\n\t\t\/\/ Create tmp file to avoid conflict\n\t\t$tmp_static_file = $static_file . '.tmp';\n\t\tif (file_exists($tmp_static_file) && time() - filemtime($tmp_static_file) <= 600) {\n\t\t\t\/\/ some other request is generating\n\t\t\treturn false;\n\t\t}\n\t\t\/\/ File::save( $tmp_static_file, '\/* ' . ( is_404() ? '404' : $request_url ) . ' *\/', true ); \/\/ Can't use this bcos this will get filecon md5 changed\n\t\tFile::save($tmp_static_file, '', true);\n\n\t\t\/\/ Load content\n\t\t$real_files = array();\n\t\tforeach ($src_list as $src_info) {\n\t\t\t$is_min = false;\n\t\t\tif (!empty($src_info['inl'])) {\n\t\t\t\t\/\/ Load inline\n\t\t\t\t$content = $src_info['src'];\n\t\t\t} else {\n\t\t\t\t\/\/ Load file\n\t\t\t\t$content = $this->load_file($src_info['src'], $file_type);\n\n\t\t\t\tif (!$content) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$is_min = $this->is_min($src_info['src']);\n\t\t\t}\n\t\t\t$content = $this->optm_snippet($content, $file_type, $minify && !$is_min, $src_info['src'], !empty($src_info['media']) ? $src_info['media'] : false);\n\t\t\t\/\/ Write to file\n\t\t\tFile::save($tmp_static_file, $content, true, true);\n\t\t}\n\n\t\t\/\/ if CSS - run the minification on the saved file.\n\t\t\/\/ Will move imports to the top of file and remove extra spaces.\n\t\tif ($file_type == 'css') {\n\t\t\t$obj                   = new Lib\\CSS_JS_MIN\\Minify\\CSS();\n\t\t\t$file_content_combined = $obj->moveImportsToTop(File::read($tmp_static_file));\n\n\t\t\tFile::save($tmp_static_file, $file_content_combined);\n\t\t}\n\n\t\t\/\/ validate md5\n\t\t$filecon_md5 = md5_file($tmp_static_file);\n\n\t\t$final_file_path = $file_path_prefix . $filecon_md5 . '.' . $file_type;\n\t\t$realfile        = LITESPEED_STATIC_DIR . $final_file_path;\n\t\tif (!file_exists($realfile)) {\n\t\t\trename($tmp_static_file, $realfile);\n\t\t\tDebug2::debug2('[Optmer] Saved static file [path] ' . $realfile);\n\t\t} else {\n\t\t\tunlink($tmp_static_file);\n\t\t}\n\n\t\t$vary = $this->cls('Vary')->finalize_full_varies();\n\t\tDebug2::debug2(\"[Optmer] Save URL to file for [file_type] $file_type [file] $filecon_md5 [vary] $vary \");\n\t\t$this->cls('Data')->save_url($url_tag, $vary, $file_type, $filecon_md5, dirname($realfile));\n\n\t\treturn array( $filecon_md5 . '.' . $file_type, $file_type );\n\t}\n\n\t\/**\n\t * Load a single file\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function optm_snippet( $content, $file_type, $minify, $src, $media = false ) {\n\t\t\/\/ CSS related features\n\t\tif ($file_type == 'css') {\n\t\t\t\/\/ Font optimize\n\t\t\tif ($this->_conf_css_font_display) {\n\t\t\t\t$content = preg_replace('#(@font\\-face\\s*\\{)#isU', '${1}font-display:swap;', $content);\n\t\t\t}\n\n\t\t\t$content = preg_replace('\/@charset[^;]+;\\\\s*\/', '', $content);\n\n\t\t\tif ($media) {\n\t\t\t\t$content = '@media ' . $media . '{' . $content . \"\\n}\";\n\t\t\t}\n\n\t\t\tif ($minify) {\n\t\t\t\t$content = self::minify_css($content);\n\t\t\t}\n\n\t\t\t$content = $this->cls('CDN')->finalize($content);\n\n\t\t\tif ((defined('LITESPEED_GUEST_OPTM') || $this->conf(Base::O_IMG_OPTM_WEBP)) && $this->cls('Media')->webp_support()) {\n\t\t\t\t$content = $this->cls('Media')->replace_background_webp($content);\n\t\t\t}\n\t\t} else {\n\t\t\tif ($minify) {\n\t\t\t\t$content = self::minify_js($content);\n\t\t\t} else {\n\t\t\t\t$content = $this->_null_minifier($content);\n\t\t\t}\n\n\t\t\t$content .= \"\\n;\";\n\t\t}\n\n\t\t\/\/ Add filter\n\t\t$content = apply_filters('litespeed_optm_cssjs', $content, $file_type, $src);\n\n\t\treturn $content;\n\t}\n\n\t\/**\n\t * Load remote resource from cache if existed\n\t *\n\t * @since  4.7\n\t *\/\n\tprivate function load_cached_file( $url, $file_type ) {\n\t\t$file_path_prefix     = $this->_build_filepath_prefix($file_type);\n\t\t$folder_name          = LITESPEED_STATIC_DIR . $file_path_prefix;\n\t\t$to_be_deleted_folder = $folder_name . date('Ymd', strtotime('-2 days'));\n\t\tif (file_exists($to_be_deleted_folder)) {\n\t\t\tDebug2::debug('[Optimizer] \u274c Clearing folder [name] ' . $to_be_deleted_folder);\n\t\t\tFile::rrmdir($to_be_deleted_folder);\n\t\t}\n\n\t\t$today_file = $folder_name . date('Ymd') . '\/' . md5($url);\n\t\tif (file_exists($today_file)) {\n\t\t\treturn File::read($today_file);\n\t\t}\n\n\t\t\/\/ Write file\n\t\t$res      = wp_safe_remote_get($url);\n\t\t$res_code = wp_remote_retrieve_response_code($res);\n\t\tif (is_wp_error($res) || $res_code != 200) {\n\t\t\tDebug2::debug2('[Optimizer] \u274c Load Remote error [code] ' . $res_code);\n\t\t\treturn false;\n\t\t}\n\t\t$con = wp_remote_retrieve_body($res);\n\t\tif (!$con) {\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug('[Optimizer] \u2705 Save remote file to cache [name] ' . $today_file);\n\t\tFile::save($today_file, $con, true);\n\n\t\treturn $con;\n\t}\n\n\t\/**\n\t * Load remote\/local resource\n\t *\n\t * @since  3.5\n\t *\/\n\tpublic function load_file( $src, $file_type = 'css' ) {\n\t\t$real_file = Utility::is_internal_file($src);\n\t\t$postfix   = pathinfo(parse_url($src, PHP_URL_PATH), PATHINFO_EXTENSION);\n\t\tif (!$real_file || $postfix != $file_type) {\n\t\t\tDebug2::debug2('[CSS] Load Remote [' . $file_type . '] ' . $src);\n\t\t\t$this_url = substr($src, 0, 2) == '\/\/' ? set_url_scheme($src) : $src;\n\t\t\t$con      = $this->load_cached_file($this_url, $file_type);\n\n\t\t\tif ($file_type == 'css') {\n\t\t\t\t$dirname = dirname($this_url) . '\/';\n\n\t\t\t\t$con = Lib\\UriRewriter::prepend($con, $dirname);\n\t\t\t}\n\t\t} else {\n\t\t\tDebug2::debug2('[CSS] Load local [' . $file_type . '] ' . $real_file[0]);\n\t\t\t$con = File::read($real_file[0]);\n\n\t\t\tif ($file_type == 'css') {\n\t\t\t\t$dirname = dirname($real_file[0]);\n\n\t\t\t\t$con = Lib\\UriRewriter::rewrite($con, $dirname);\n\t\t\t}\n\t\t}\n\n\t\treturn $con;\n\t}\n\n\t\/**\n\t * Minify CSS\n\t *\n\t * @since  2.2.3\n\t * @access private\n\t *\/\n\tpublic static function minify_css( $data ) {\n\t\ttry {\n\t\t\t$obj = new Lib\\CSS_JS_MIN\\Minify\\CSS();\n\t\t\t$obj->add($data);\n\n\t\t\treturn $obj->minify();\n\t\t} catch (\\Exception $e) {\n\t\t\tDebug2::debug('******[Optmer] minify_css failed: ' . $e->getMessage());\n\t\t\terror_log('****** LiteSpeed Optimizer minify_css failed: ' . $e->getMessage());\n\t\t\treturn $data;\n\t\t}\n\t}\n\n\t\/**\n\t * Minify JS\n\t *\n\t * Added exception capture when minify\n\t *\n\t * @since  2.2.3\n\t * @access private\n\t *\/\n\tpublic static function minify_js( $data, $js_type = '' ) {\n\t\t\/\/ For inline JS optimize, need to check if it's js type\n\t\tif ($js_type) {\n\t\t\tpreg_match('#type=([\\'\"])(.+)\\g{1}#isU', $js_type, $matches);\n\t\t\tif ($matches && $matches[2] != 'text\/javascript') {\n\t\t\t\tDebug2::debug('******[Optmer] minify_js bypass due to type: ' . $matches[2]);\n\t\t\t\treturn $data;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\t$obj = new Lib\\CSS_JS_MIN\\Minify\\JS();\n\t\t\t$obj->add($data);\n\n\t\t\treturn $obj->minify();\n\t\t} catch (\\Exception $e) {\n\t\t\tDebug2::debug('******[Optmer] minify_js failed: ' . $e->getMessage());\n\t\t\t\/\/ error_log( '****** LiteSpeed Optimizer minify_js failed: ' . $e->getMessage() );\n\t\t\treturn $data;\n\t\t}\n\t}\n\n\t\/**\n\t * Basic minifier\n\t *\n\t * @access private\n\t *\/\n\tprivate function _null_minifier( $content ) {\n\t\t$content = str_replace(\"\\r\\n\", \"\\n\", $content);\n\n\t\treturn trim($content);\n\t}\n\n\t\/**\n\t * Check if the file is already min file\n\t *\n\t * @since  1.9\n\t *\/\n\tpublic function is_min( $filename ) {\n\t\t$basename = basename($filename);\n\t\tif (preg_match('\/[-\\.]min\\.(?:[a-zA-Z]+)$\/i', $basename)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/admin-settings.cls.php","ext":"php","size":11065,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The admin settings handler of the plugin.\n *\n * Handles saving and validating settings from the admin UI and network admin.\n *\n * @since      1.1.0\n * @package    LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Admin_Settings\n *\n * Saves, sanitizes, and validates LiteSpeed Cache settings.\n *\/\nclass Admin_Settings extends Base {\n\tconst LOG_TAG = '[Settings]';\n\n\tconst ENROLL = '_settings-enroll';\n\n\t\/**\n\t * Save settings (single site).\n\t *\n\t * Accepts data from $_POST or WP-CLI.\n\t * Importers may call the Conf class directly.\n\t *\n\t * @since 3.0\n\t *\n\t * @param array<string,mixed> $raw_data Raw data from request\/CLI.\n\t * @return void\n\t *\/\n\tpublic function save( $raw_data ) {\n\t\tself::debug( 'saving' );\n\n\t\tif ( empty( $raw_data[ self::ENROLL ] ) ) {\n\t\t\twp_die( esc_html__( 'No fields', 'litespeed-cache' ) );\n\t\t}\n\n\t\t$raw_data = Admin::cleanup_text( $raw_data );\n\n\t\t\/\/ Convert data to config format.\n\t\t$the_matrix = [];\n\t\tforeach ( array_unique( $raw_data[ self::ENROLL ] ) as $id ) {\n\t\t\t$child = false;\n\n\t\t\t\/\/ Drop array format.\n\t\t\tif ( false !== strpos( $id, '[' ) ) {\n\t\t\t\tif ( 0 === strpos( $id, self::O_CDN_MAPPING ) || 0 === strpos( $id, self::O_CRAWLER_COOKIES ) ) {\n\t\t\t\t\t\/\/ CDN child | Cookie Crawler settings.\n\t\t\t\t\t$child = substr( $id, strpos( $id, '[' ) + 1, strpos( $id, ']' ) - strpos( $id, '[' ) - 1 );\n\t\t\t\t\t\/\/ Drop ending []; Compatible with xx[0] way from CLI.\n\t\t\t\t\t$id = substr( $id, 0, strpos( $id, '[' ) );\n\t\t\t\t} else {\n\t\t\t\t\t\/\/ Drop ending [].\n\t\t\t\t\t$id = substr( $id, 0, strpos( $id, '[' ) );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! array_key_exists( $id, self::$_default_options ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ Validate $child.\n\t\t\tif ( self::O_CDN_MAPPING === $id ) {\n\t\t\t\tif ( ! in_array( $child, [ self::CDN_MAPPING_URL, self::CDN_MAPPING_INC_IMG, self::CDN_MAPPING_INC_CSS, self::CDN_MAPPING_INC_JS, self::CDN_MAPPING_FILETYPE ], true ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\tif ( ! in_array( $child, [ self::CRWL_COOKIE_NAME, self::CRWL_COOKIE_VALS ], true ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\/\/ Pull value from request.\n\t\t\tif ( $child ) {\n\t\t\t\t\/\/ []=xxx or [0]=xxx\n\t\t\t\t$data = ! empty( $raw_data[ $id ][ $child ] ) ? $raw_data[ $id ][ $child ] : false;\n\t\t\t} else {\n\t\t\t\t$data = ! empty( $raw_data[ $id ] ) ? $raw_data[ $id ] : false;\n\t\t\t}\n\n\t\t\t\/\/ Sanitize\/normalize complex fields.\n\t\t\tif ( self::O_CDN_MAPPING === $id || self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\t\/\/ Use existing queued data if available (only when $child != false).\n\t\t\t\t$data2 = array_key_exists( $id, $the_matrix )\n\t\t\t\t\t? $the_matrix[ $id ]\n\t\t\t\t\t: ( defined( 'WP_CLI' ) && WP_CLI ? $this->conf( $id ) : [] );\n\t\t\t}\n\n\t\t\tswitch ( $id ) {\n\t\t\t\t\/\/ Don't allow Editor\/admin to be used in crawler role simulator.\n\t\t\t\tcase self::O_CRAWLER_ROLES:\n\t\t\t\t\t$data = Utility::sanitize_lines( $data );\n\t\t\t\t\tif ( $data ) {\n\t\t\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\t\t\tif ( user_can( $v, 'edit_posts' ) ) {\n\t\t\t\t\t\t\t\t\/* translators: %s: user id in <code> tags *\/\n\t\t\t\t\t\t\t\t$msg = sprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'The user with id %s has editor access, which is not allowed for the role simulator.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $v ) . '<\/code>'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tAdmin_Display::error( $msg );\n\t\t\t\t\t\t\t\tunset( $data[ $k ] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase self::O_CDN_MAPPING:\n\t\t\t\t\t\/**\n\t\t\t\t\t * CDN setting\n\t\t\t\t\t *\n\t\t\t\t\t * Raw data format:\n\t\t\t\t\t *  cdn-mapping[url][] = 'xxx'\n\t\t\t\t\t *  cdn-mapping[url][2] = 'xxx2'\n\t\t\t\t\t *  cdn-mapping[inc_js][] = 1\n\t\t\t\t\t *\n\t\t\t\t\t * Final format:\n\t\t\t\t\t *  cdn-mapping[0][url] = 'xxx'\n\t\t\t\t\t *  cdn-mapping[2][url] = 'xxx2'\n\t\t\t\t\t *\/\n\t\t\t\t\tif ( $data ) {\n\t\t\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\t\t\tif ( self::CDN_MAPPING_FILETYPE === $child ) {\n\t\t\t\t\t\t\t\t$v = Utility::sanitize_lines( $v );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( self::CDN_MAPPING_URL === $child ) {\n\t\t\t\t\t\t\t\t\/\/ If not a valid URL, turn off CDN.\n\t\t\t\t\t\t\t\tif ( 0 !== strpos( $v, 'https:\/\/' ) ) {\n\t\t\t\t\t\t\t\t\tself::debug( '\u274c CDN mapping set to OFF due to invalid URL' );\n\t\t\t\t\t\t\t\t\t$the_matrix[ self::O_CDN ] = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$v = trailingslashit( $v );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( in_array( $child, [ self::CDN_MAPPING_INC_IMG, self::CDN_MAPPING_INC_CSS, self::CDN_MAPPING_INC_JS ], true ) ) {\n\t\t\t\t\t\t\t\t\/\/ Because these can't be auto detected in `config->update()`, need to format here.\n\t\t\t\t\t\t\t\t$v = 'false' === $v ? 0 : (bool) $v;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( empty( $data2[ $k ] ) ) {\n\t\t\t\t\t\t\t\t$data2[ $k ] = [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$data2[ $k ][ $child ] = $v;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase self::O_CRAWLER_COOKIES:\n\t\t\t\t\t\/**\n\t\t\t\t\t * Cookie Crawler setting\n\t\t\t\t\t * Raw Format:\n\t\t\t\t\t *  crawler-cookies[name][] = xxx\n\t\t\t\t\t *  crawler-cookies[name][2] = xxx2\n\t\t\t\t\t *  crawler-cookies[vals][] = xxx\n\t\t\t\t\t *\n\t\t\t\t\t * Final format:\n\t\t\t\t\t *  crawler-cookie[0][name] = 'xxx'\n\t\t\t\t\t *  crawler-cookie[0][vals] = 'xxx'\n\t\t\t\t\t *  crawler-cookie[2][name] = 'xxx2'\n\t\t\t\t\t *\n\t\t\t\t\t * Empty line for `vals` uses literal `_null`.\n\t\t\t\t\t *\/\n\t\t\t\t\tif ( $data ) {\n\t\t\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\t\t\tif ( self::CRWL_COOKIE_VALS === $child ) {\n\t\t\t\t\t\t\t\t$v = Utility::sanitize_lines( $v );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( empty( $data2[ $k ] ) ) {\n\t\t\t\t\t\t\t\t$data2[ $k ] = [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$data2[ $k ][ $child ] = $v;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\t\/\/ Cache exclude category.\n\t\t\t\tcase self::O_CACHE_EXC_CAT:\n\t\t\t\t\t$data2 = [];\n\t\t\t\t\t$data  = Utility::sanitize_lines( $data );\n\t\t\t\t\tforeach ( $data as $v ) {\n\t\t\t\t\t\t$cat_id = get_cat_ID( $v );\n\t\t\t\t\t\tif ( ! $cat_id ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$data2[] = $cat_id;\n\t\t\t\t\t}\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\t\/\/ Cache exclude tag.\n\t\t\t\tcase self::O_CACHE_EXC_TAG:\n\t\t\t\t\t$data2 = [];\n\t\t\t\t\t$data  = Utility::sanitize_lines( $data );\n\t\t\t\t\tforeach ( $data as $v ) {\n\t\t\t\t\t\t$term = get_term_by( 'name', $v, 'post_tag' );\n\t\t\t\t\t\tif ( ! $term ) {\n\t\t\t\t\t\t\t\/\/ Could surface an admin error here if desired.\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$data2[] = $term->term_id;\n\t\t\t\t\t}\n\t\t\t\t\t$data = $data2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$the_matrix[ $id ] = $data;\n\t\t}\n\n\t\t\/\/ Special handler for CDN\/Crawler 2d list to drop empty rows.\n\t\tforeach ( $the_matrix as $id => $data ) {\n\t\t\t\/**\n\t\t\t * Format:\n\t\t\t *  cdn-mapping[0][url] = 'xxx'\n\t\t\t *  cdn-mapping[2][url] = 'xxx2'\n\t\t\t *  crawler-cookie[0][name] = 'xxx'\n\t\t\t *  crawler-cookie[0][vals] = 'xxx'\n\t\t\t *  crawler-cookie[2][name] = 'xxx2'\n\t\t\t *\/\n\t\t\tif ( self::O_CDN_MAPPING === $id || self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\t\/\/ Drop row if all children are empty.\n\t\t\t\tforeach ( $data as $k => $v ) {\n\t\t\t\t\tforeach ( $v as $v2 ) {\n\t\t\t\t\t\tif ( $v2 ) {\n\t\t\t\t\t\t\tcontinue 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\/\/ All empty.\n\t\t\t\t\tunset( $the_matrix[ $id ][ $k ] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\/\/ Don't allow repeated cookie names.\n\t\t\tif ( self::O_CRAWLER_COOKIES === $id ) {\n\t\t\t\t$existed = [];\n\t\t\t\tforeach ( $the_matrix[ $id ] as $k => $v ) {\n\t\t\t\t\tif ( empty( $v[ self::CRWL_COOKIE_NAME ] ) || in_array( $v[ self::CRWL_COOKIE_NAME ], $existed, true ) ) {\n\t\t\t\t\t\t\/\/ Filter repeated or empty name.\n\t\t\t\t\t\tunset( $the_matrix[ $id ][ $k ] );\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t$existed[] = $v[ self::CRWL_COOKIE_NAME ];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\/\/ tmp fix the 3rd part woo update hook issue when enabling vary cookie.\n\t\t\tif ( 'wc_cart_vary' === $id ) {\n\t\t\t\tif ( $data ) {\n\t\t\t\t\tadd_filter(\n\t\t\t\t\t\t'litespeed_vary_cookies',\n\t\t\t\t\t\tfunction ( $arr ) {\n\t\t\t\t\t\t\t$arr[] = 'woocommerce_cart_hash';\n\t\t\t\t\t\t\treturn array_unique( $arr );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tadd_filter(\n\t\t\t\t\t\t'litespeed_vary_cookies',\n\t\t\t\t\t\tfunction ( $arr ) {\n\t\t\t\t\t\t\t$key = array_search( 'woocommerce_cart_hash', $arr, true );\n\t\t\t\t\t\t\tif ( false !== $key ) {\n\t\t\t\t\t\t\t\tunset( $arr[ $key ] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn array_unique( $arr );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ id validation will be inside.\n\t\t$this->cls( 'Conf' )->update_confs( $the_matrix );\n\n\t\t$msg = __( 'Options saved.', 'litespeed-cache' );\n\t\tAdmin_Display::success( $msg );\n\t}\n\n\t\/**\n\t * Parses any changes made by the network admin on the network settings.\n\t *\n\t * @since 3.0\n\t *\n\t * @param array<string,mixed> $raw_data Raw data from request\/CLI.\n\t * @return void\n\t *\/\n\tpublic function network_save( $raw_data ) {\n\t\tself::debug( 'network saving' );\n\n\t\tif ( empty( $raw_data[ self::ENROLL ] ) ) {\n\t\t\twp_die( esc_html__( 'No fields', 'litespeed-cache' ) );\n\t\t}\n\n\t\t$raw_data = Admin::cleanup_text( $raw_data );\n\n\t\tforeach ( array_unique( $raw_data[ self::ENROLL ] ) as $id ) {\n\t\t\t\/\/ Append current field to setting save.\n\t\t\tif ( ! array_key_exists( $id, self::$_default_site_options ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$data = ! empty( $raw_data[ $id ] ) ? $raw_data[ $id ] : false;\n\n\t\t\t\/\/ id validation will be inside.\n\t\t\t$this->cls( 'Conf' )->network_update( $id, $data );\n\t\t}\n\n\t\t\/\/ Update related files.\n\t\tActivation::cls()->update_files();\n\n\t\t$msg = __( 'Options saved.', 'litespeed-cache' );\n\t\tAdmin_Display::success( $msg );\n\t}\n\n\t\/**\n\t * Hooked to the wp_redirect filter when saving widgets fails validation.\n\t *\n\t * @since 1.1.3\n\t *\n\t * @param string $location The redirect location.\n\t * @return string Updated location string.\n\t *\/\n\tpublic static function widget_save_err( $location ) {\n\t\treturn str_replace( '?message=0', '?error=0', $location );\n\t}\n\n\t\/**\n\t * Validate the LiteSpeed Cache settings on widget save.\n\t *\n\t * @since 1.1.3\n\t *\n\t * @param array      $instance     The new settings.\n\t * @param array      $new_instance The raw submitted settings.\n\t * @param array      $old_instance The original settings.\n\t * @param \\WP_Widget $widget       The widget instance.\n\t * @return array|false Updated settings on success, false on error.\n\t *\/\n\tpublic static function validate_widget_save( $instance, $new_instance, $old_instance, $widget ) {\n\t\tif ( empty( $new_instance ) ) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\tif ( ! isset( $new_instance[ ESI::WIDGET_O_ESIENABLE ], $new_instance[ ESI::WIDGET_O_TTL ] ) ) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$esi = (int) $new_instance[ ESI::WIDGET_O_ESIENABLE ] % 3;\n\t\t$ttl = (int) $new_instance[ ESI::WIDGET_O_TTL ];\n\n\t\tif ( 0 !== $ttl && $ttl < 30 ) {\n\t\t\tadd_filter( 'wp_redirect', __CLASS__ . '::widget_save_err' );\n\t\t\treturn false; \/\/ Invalid ttl.\n\t\t}\n\n\t\tif ( empty( $instance[ Conf::OPTION_NAME ] ) ) {\n\t\t\t\/\/ @todo to be removed.\n\t\t\t$instance[ Conf::OPTION_NAME ] = [];\n\t\t}\n\t\t$instance[ Conf::OPTION_NAME ][ ESI::WIDGET_O_ESIENABLE ] = $esi;\n\t\t$instance[ Conf::OPTION_NAME ][ ESI::WIDGET_O_TTL ]       = $ttl;\n\n\t\t$current = ! empty( $old_instance[ Conf::OPTION_NAME ] ) ? $old_instance[ Conf::OPTION_NAME ] : false;\n\n\t\t\/\/ Avoid unsanitized superglobal usage.\n\t\t$referrer = isset( $_SERVER['HTTP_REFERER'] ) ? esc_url_raw( wp_unslash( $_SERVER['HTTP_REFERER'] ) ) : '';\n\n\t\t\/\/ Only purge when not in the Customizer.\n\t\tif ( false === strpos( $referrer, '\/wp-admin\/customize.php' ) ) {\n\t\t\tif ( ! $current || $esi !== (int) $current[ ESI::WIDGET_O_ESIENABLE ] ) {\n\t\t\t\tPurge::purge_all( 'Widget ESI_enable changed' );\n\t\t\t} elseif ( 0 !== $ttl && $ttl !== (int) $current[ ESI::WIDGET_O_TTL ] ) {\n\t\t\t\tPurge::add( Tag::TYPE_WIDGET . $widget->id );\n\t\t\t}\n\n\t\t\tPurge::purge_all( 'Widget saved' );\n\t\t}\n\n\t\treturn $instance;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/rest.cls.php","ext":"php","size":7719,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The REST related class.\n *\n * @since       2.9.4\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass REST extends Root {\n\n\tconst LOG_TAG                  = '\u260e\ufe0f';\n\tprivate $_internal_rest_status = false;\n\n\t\/**\n\t * Confructor of ESI\n\t *\n\t * @since    2.9.4\n\t *\/\n\tpublic function __construct() {\n\t\t\/\/ Hook to internal REST call\n\t\tadd_filter('rest_request_before_callbacks', array( $this, 'set_internal_rest_on' ));\n\t\tadd_filter('rest_request_after_callbacks', array( $this, 'set_internal_rest_off' ));\n\n\t\tadd_action('rest_api_init', array( $this, 'rest_api_init' ));\n\t}\n\n\t\/**\n\t * Register REST hooks\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function rest_api_init() {\n\t\t\/\/ Activate or deactivate a specific crawler callback\n\t\tregister_rest_route('litespeed\/v1', '\/toggle_crawler_state', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'toggle_crawler_state' ),\n\t\t\t'permission_callback' => function () {\n\t\t\t\treturn current_user_can('manage_network_options') || current_user_can('manage_options');\n\t\t\t},\n\t\t));\n\n\t\tregister_rest_route('litespeed\/v1', '\/tool\/check_ip', array(\n\t\t\t'methods' => 'GET',\n\t\t\t'callback' => array( $this, 'check_ip' ),\n\t\t\t'permission_callback' => function () {\n\t\t\t\treturn current_user_can('manage_network_options') || current_user_can('manage_options');\n\t\t\t},\n\t\t));\n\n\t\t\/\/ IP callback validate\n\t\tregister_rest_route('litespeed\/v3', '\/ip_validate', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'ip_validate' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t\/\/ 1.2. WP REST Dryrun Callback\n\t\tregister_rest_route('litespeed\/v3', '\/wp_rest_echo', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'wp_rest_echo' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\t\tregister_rest_route('litespeed\/v3', '\/ping', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'ping' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t\/\/ CDN setup callback notification\n\t\tregister_rest_route('litespeed\/v3', '\/cdn_status', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'cdn_status' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t\/\/ Image optm notify_img\n\t\t\/\/ Need validation\n\t\tregister_rest_route('litespeed\/v1', '\/notify_img', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_img' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed\/v1', '\/notify_ccss', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_ccss' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed\/v1', '\/notify_ucss', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_ucss' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed\/v1', '\/notify_vpi', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'notify_vpi' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\tregister_rest_route('litespeed\/v3', '\/err_domains', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'err_domains' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\n\t\t\/\/ Image optm check_img\n\t\t\/\/ Need validation\n\t\tregister_rest_route('litespeed\/v1', '\/check_img', array(\n\t\t\t'methods' => 'POST',\n\t\t\t'callback' => array( $this, 'check_img' ),\n\t\t\t'permission_callback' => array( $this, 'is_from_cloud' ),\n\t\t));\n\t}\n\n\t\/**\n\t * Call to freeze or melt the crawler clicked\n\t *\n\t * @since  4.3\n\t *\/\n\tpublic function toggle_crawler_state() {\n\t\tif (isset($_POST['crawler_id'])) {\n\t\t\treturn $this->cls('Crawler')->toggle_activeness($_POST['crawler_id']) ? 1 : 0;\n\t\t}\n\t}\n\n\t\/**\n\t * Check if the request is from cloud nodes\n\t *\n\t * @since 4.2\n\t * @since 4.4.7 As there is always token\/api key validation, ip validation is redundant\n\t *\/\n\tpublic function is_from_cloud() {\n\t\t\/\/ return true;\n\t\treturn $this->cls('Cloud')->is_from_cloud();\n\t}\n\n\t\/**\n\t * Ping pong\n\t *\n\t * @since  3.0.4\n\t *\/\n\tpublic function ping() {\n\t\treturn $this->cls('Cloud')->ping();\n\t}\n\n\t\/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function check_ip() {\n\t\treturn Tool::cls()->check_ip();\n\t}\n\n\t\/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function ip_validate() {\n\t\treturn $this->cls('Cloud')->ip_validate();\n\t}\n\n\t\/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function wp_rest_echo() {\n\t\treturn $this->cls('Cloud')->wp_rest_echo();\n\t}\n\n\t\/**\n\t * Endpoint for QC to notify plugin of CDN status update.\n\t *\n\t * @since  7.0\n\t *\/\n\tpublic function cdn_status() {\n\t\treturn $this->cls('Cloud')->update_cdn_status();\n\t}\n\n\t\/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function notify_img() {\n\t\treturn Img_Optm::cls()->notify_img();\n\t}\n\n\t\/**\n\t * @since  7.1\n\t *\/\n\tpublic function notify_ccss() {\n\t\tself::debug('notify_ccss');\n\t\treturn CSS::cls()->notify();\n\t}\n\n\t\/**\n\t * @since  5.2\n\t *\/\n\tpublic function notify_ucss() {\n\t\tself::debug('notify_ucss');\n\t\treturn UCSS::cls()->notify();\n\t}\n\n\t\/**\n\t * @since  4.7\n\t *\/\n\tpublic function notify_vpi() {\n\t\tself::debug('notify_vpi');\n\t\treturn VPI::cls()->notify();\n\t}\n\n\t\/**\n\t * @since  4.7\n\t *\/\n\tpublic function err_domains() {\n\t\tself::debug('err_domains');\n\t\treturn $this->cls('Cloud')->rest_err_domains();\n\t}\n\n\t\/**\n\t * Launch api call\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function check_img() {\n\t\treturn Img_Optm::cls()->check_img();\n\t}\n\n\t\/**\n\t * Return error\n\t *\n\t * @since  5.7.0.1\n\t *\/\n\tpublic static function err( $code ) {\n\t\treturn array(\n\t\t\t'_res' => 'err',\n\t\t\t'_msg' => $code,\n\t\t);\n\t}\n\n\t\/**\n\t * Set internal REST tag to ON\n\t *\n\t * @since  2.9.4\n\t * @access public\n\t *\/\n\tpublic function set_internal_rest_on( $not_used = null ) {\n\t\t$this->_internal_rest_status = true;\n\t\tDebug2::debug2('[REST] \u2705 Internal REST ON [filter] rest_request_before_callbacks');\n\n\t\treturn $not_used;\n\t}\n\n\t\/**\n\t * Set internal REST tag to OFF\n\t *\n\t * @since  2.9.4\n\t * @access public\n\t *\/\n\tpublic function set_internal_rest_off( $not_used = null ) {\n\t\t$this->_internal_rest_status = false;\n\t\tDebug2::debug2('[REST] \u274e Internal REST OFF [filter] rest_request_after_callbacks');\n\n\t\treturn $not_used;\n\t}\n\n\t\/**\n\t * Get internal REST tag\n\t *\n\t * @since  2.9.4\n\t * @access public\n\t *\/\n\tpublic function is_internal_rest() {\n\t\treturn $this->_internal_rest_status;\n\t}\n\n\t\/**\n\t * Check if an URL or current page is REST req or not\n\t *\n\t * @since  2.9.3\n\t * @since  2.9.4 Moved here from Utility, dropped static\n\t * @access public\n\t *\/\n\tpublic function is_rest( $url = false ) {\n\t\t\/\/ For WP 4.4.0- compatibility\n\t\tif (!function_exists('rest_get_url_prefix')) {\n\t\t\treturn defined('REST_REQUEST') && REST_REQUEST;\n\t\t}\n\n\t\t$prefix = rest_get_url_prefix();\n\n\t\t\/\/ Case #1: After WP_REST_Request initialisation\n\t\tif (defined('REST_REQUEST') && REST_REQUEST) {\n\t\t\treturn true;\n\t\t}\n\n\t\t\/\/ Case #2: Support \"plain\" permalink settings\n\t\tif (isset($_GET['rest_route']) && strpos(trim($_GET['rest_route'], '\\\\\/'), $prefix, 0) === 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!$url) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Case #3: URL Path begins with wp-json\/ (REST prefix) Safe for subfolder installation\n\t\t$rest_url    = wp_parse_url(site_url($prefix));\n\t\t$current_url = wp_parse_url($url);\n\t\t\/\/ Debug2::debug( '[Util] is_rest check [base] ', $rest_url );\n\t\t\/\/ Debug2::debug( '[Util] is_rest check [curr] ', $current_url );\n\t\t\/\/ Debug2::debug( '[Util] is_rest check [curr2] ', wp_parse_url( add_query_arg( array( ) ) ) );\n\t\tif ($current_url !== false && !empty($current_url['path']) && $rest_url !== false && !empty($rest_url['path'])) {\n\t\t\treturn strpos($current_url['path'], $rest_url['path']) === 0;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/localization.cls.php","ext":"php","size":3522,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The localization class.\n *\n * @since       3.3\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Localization extends Base {\n\n\tconst LOG_TAG = '\ud83d\udecd\ufe0f';\n\n\t\/**\n\t * Init optimizer\n\t *\n\t * @since  3.0\n\t * @access protected\n\t *\/\n\tpublic function init() {\n\t\tadd_filter('litespeed_buffer_finalize', array( $this, 'finalize' ), 23); \/\/ After page optm\n\t}\n\n\t\/**\n\t * Localize Resources\n\t *\n\t * @since  3.3\n\t *\/\n\tpublic function serve_static( $uri ) {\n\t\t$url = base64_decode($uri);\n\n\t\tif (!$this->conf(self::O_OPTM_LOCALIZE)) {\n\t\t\t\/\/ wp_redirect( $url );\n\t\t\texit('Not supported');\n\t\t}\n\n\t\tif (substr($url, -3) !== '.js') {\n\t\t\t\/\/ wp_redirect( $url );\n\t\t\t\/\/ exit( 'Not supported ' . $uri );\n\t\t}\n\n\t\t$match   = false;\n\t\t$domains = $this->conf(self::O_OPTM_LOCALIZE_DOMAINS);\n\t\tforeach ($domains as $v) {\n\t\t\tif (!$v || strpos($v, '#') === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$type   = 'js';\n\t\t\t$domain = $v;\n\t\t\t\/\/ Try to parse space split value\n\t\t\tif (strpos($v, ' ')) {\n\t\t\t\t$v = explode(' ', $v);\n\t\t\t\tif (!empty($v[1])) {\n\t\t\t\t\t$type   = strtolower($v[0]);\n\t\t\t\t\t$domain = $v[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strpos($domain, 'https:\/\/') !== 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($type != 'js') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t\/\/ if ( strpos( $url, $domain ) !== 0 ) {\n\t\t\tif ($url != $domain) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$match = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!$match) {\n\t\t\t\/\/ wp_redirect( $url );\n\t\t\texit('Not supported2');\n\t\t}\n\n\t\theader('Content-Type: application\/javascript');\n\n\t\t\/\/ Generate\n\t\t$this->_maybe_mk_cache_folder('localres');\n\n\t\t$file = $this->_realpath($url);\n\n\t\tself::debug('localize [url] ' . $url);\n\t\t$response = wp_safe_remote_get($url, array(\n\t\t\t'timeout' => 180,\n\t\t\t'stream' => true,\n\t\t\t'filename' => $file,\n\t\t));\n\n\t\t\/\/ Parse response data\n\t\tif (is_wp_error($response)) {\n\t\t\t$error_message = $response->get_error_message();\n\t\t\tfile_exists($file) && unlink($file);\n\t\t\tself::debug('failed to get: ' . $error_message);\n\t\t\twp_redirect($url);\n\t\t\texit();\n\t\t}\n\n\t\t$url = $this->_rewrite($url);\n\n\t\twp_redirect($url);\n\t\texit();\n\t}\n\n\t\/**\n\t * Get the final URL of local avatar\n\t *\n\t * @since  4.5\n\t *\/\n\tprivate function _rewrite( $url ) {\n\t\treturn LITESPEED_STATIC_URL . '\/localres\/' . $this->_filepath($url);\n\t}\n\n\t\/**\n\t * Generate realpath of the cache file\n\t *\n\t * @since  4.5\n\t * @access private\n\t *\/\n\tprivate function _realpath( $url ) {\n\t\treturn LITESPEED_STATIC_DIR . '\/localres\/' . $this->_filepath($url);\n\t}\n\n\t\/**\n\t * Get filepath\n\t *\n\t * @since  4.5\n\t *\/\n\tprivate function _filepath( $url ) {\n\t\t$filename = md5($url) . '.js';\n\t\tif (is_multisite()) {\n\t\t\t$filename = get_current_blog_id() . '\/' . $filename;\n\t\t}\n\t\treturn $filename;\n\t}\n\n\t\/**\n\t * Localize JS\/Fonts\n\t *\n\t * @since 3.3\n\t * @access public\n\t *\/\n\tpublic function finalize( $content ) {\n\t\tif (is_admin()) {\n\t\t\treturn $content;\n\t\t}\n\n\t\tif (!$this->conf(self::O_OPTM_LOCALIZE)) {\n\t\t\treturn $content;\n\t\t}\n\n\t\t$domains = $this->conf(self::O_OPTM_LOCALIZE_DOMAINS);\n\t\tif (!$domains) {\n\t\t\treturn $content;\n\t\t}\n\n\t\tforeach ($domains as $v) {\n\t\t\tif (!$v || strpos($v, '#') === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$type   = 'js';\n\t\t\t$domain = $v;\n\t\t\t\/\/ Try to parse space split value\n\t\t\tif (strpos($v, ' ')) {\n\t\t\t\t$v = explode(' ', $v);\n\t\t\t\tif (!empty($v[1])) {\n\t\t\t\t\t$type   = strtolower($v[0]);\n\t\t\t\t\t$domain = $v[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strpos($domain, 'https:\/\/') !== 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ($type != 'js') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$content = str_replace($domain, LITESPEED_STATIC_URL . '\/localres\/' . base64_encode($domain), $content);\n\t\t}\n\n\t\treturn $content;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/object-cache-wp.cls.php","ext":"php","size":25259,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * WP Object Cache wrapper for LiteSpeed Cache.\n *\n * Provides a drop-in-compatible object cache implementation that proxies to\n * LiteSpeed's persistent cache while keeping a local runtime cache.\n *\n * @package LiteSpeed\n * @since   1.8\n *\/\n\n\/**\n * Class WP_Object_Cache\n *\n * Implements the WordPress object cache for LiteSpeed Cache.\n *\n * @since 1.8\n * @package LiteSpeed\n *\/\nclass WP_Object_Cache {\n\n\t\/**\n\t * Singleton instance\n\t *\n\t * @since 1.8\n\t * @access protected\n\t * @var WP_Object_Cache|null\n\t *\/\n\tprotected static $_instance;\n\n\t\/**\n\t * Object cache instance\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var \\LiteSpeed\\Object_Cache\n\t *\/\n\tprivate $_object_cache;\n\n\t\/**\n\t * Cache storage\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var array\n\t *\/\n\tprivate $_cache = array();\n\n\t\/**\n\t * Cache for 404 keys\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var array\n\t *\/\n\tprivate $_cache_404 = array();\n\n\t\/**\n\t * Total cache operations\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t *\/\n\tprivate $cache_total = 0;\n\n\t\/**\n\t * Cache hits within call\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t *\/\n\tprivate $count_hit_incall = 0;\n\n\t\/**\n\t * Cache hits\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t *\/\n\tprivate $count_hit = 0;\n\n\t\/**\n\t * Cache misses within call\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t *\/\n\tprivate $count_miss_incall = 0;\n\n\t\/**\n\t * Cache misses\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t *\/\n\tprivate $count_miss = 0;\n\n\t\/**\n\t * Cache set operations\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var int\n\t *\/\n\tprivate $count_set = 0;\n\n\t\/**\n\t * Global cache groups\n\t *\n\t * @since 1.8\n\t * @access protected\n\t * @var array\n\t *\/\n\tprotected $global_groups = array();\n\n\t\/**\n\t * Blog prefix for cache keys\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var string\n\t *\/\n\tprivate $blog_prefix;\n\n\t\/**\n\t * Multisite flag\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @var bool\n\t *\/\n\tprivate $multisite;\n\n\t\/**\n\t * Init.\n\t *\n\t * Initializes the object cache with LiteSpeed settings.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_object_cache = \\LiteSpeed\\Object_Cache::cls();\n\n\t\t$this->multisite   = is_multisite();\n\t\t$this->blog_prefix = $this->multisite ? get_current_blog_id() . ':' : '';\n\n\t\t\/**\n\t\t * Fix multiple instance using same oc issue\n\t\t *\n\t\t * @since  1.8.2\n\t\t *\/\n\t\tif ( ! defined( 'LSOC_PREFIX' ) ) {\n\t\t\tdefine( 'LSOC_PREFIX', substr( md5( __FILE__ ), -5 ) );\n\t\t}\n\t}\n\n\t\/**\n\t * Makes private properties readable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name Property to get.\n\t * @return mixed Property.\n\t *\/\n\tpublic function __get( $name ) {\n\t\treturn $this->$name;\n\t}\n\n\t\/**\n\t * Makes private properties settable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name  Property to set.\n\t * @param mixed  $value Property value.\n\t * @return mixed Newly-set property.\n\t *\/\n\tpublic function __set( $name, $value ) {\n\t\t$this->$name = $value;\n\n\t\treturn $this->$name;\n\t}\n\n\t\/**\n\t * Makes private properties checkable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name Property to check if set.\n\t * @return bool Whether the property is set.\n\t *\/\n\tpublic function __isset( $name ) {\n\t\treturn isset( $this->$name );\n\t}\n\n\t\/**\n\t * Makes private properties un-settable for backward compatibility.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param string $name Property to unset.\n\t *\/\n\tpublic function __unset( $name ) {\n\t\tunset( $this->$name );\n\t}\n\n\t\/**\n\t * Serves as a utility function to determine whether a key is valid.\n\t *\n\t * @since 5.4\n\t * @access protected\n\t *\n\t * @param int|string $key Cache key to check for validity.\n\t * @return bool Whether the key is valid.\n\t *\/\n\tprotected function is_valid_key( $key ) {\n\t\tif ( is_int( $key ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( is_string( $key ) && '' !== trim( $key ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\t$type = gettype( $key );\n\n\t\tif ( ! function_exists( '__' ) ) {\n\t\t\twp_load_translations_early();\n\t\t}\n\n\t\t$message = is_string( $key )\n\t\t\t? __( 'Cache key must not be an empty string.' )\n\t\t\t: sprintf(\n\t\t\t\t\/* translators: %s: The type of the given cache key. *\/\n\t\t\t\t__( 'Cache key must be integer or non-empty string, %s given.' ),\n\t\t\t\t$type\n\t\t\t);\n\n\t\t_doing_it_wrong(\n\t\t\tesc_html( __METHOD__ ),\n\t\t\tesc_html( $message ),\n\t\t\t'6.1.0'\n\t\t);\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Get the final key.\n\t *\n\t * Generates a unique cache key based on group and prefix.\n\t *\n\t * @since 1.8\n\t * @access private\n\t * @param int|string $key   Cache key.\n\t * @param string     $group Optional. Cache group. Default 'default'.\n\t * @return string The final cache key.\n\t *\/\n\tprivate function _key( $key, $group = 'default' ) {\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$prefix = $this->_object_cache->is_global( $group ) ? '' : $this->blog_prefix;\n\n\t\treturn LSOC_PREFIX . $prefix . $group . '.' . $key;\n\t}\n\n\t\/**\n\t * Output debug info.\n\t *\n\t * Returns cache statistics for debugging purposes.\n\t *\n\t * @since  1.8\n\t * @access public\n\t * @return string Cache statistics.\n\t *\/\n\tpublic function debug() {\n\t\treturn ' [total] ' .\n\t\t\t$this->cache_total .\n\t\t\t' [hit_incall] ' .\n\t\t\t$this->count_hit_incall .\n\t\t\t' [hit] ' .\n\t\t\t$this->count_hit .\n\t\t\t' [miss_incall] ' .\n\t\t\t$this->count_miss_incall .\n\t\t\t' [miss] ' .\n\t\t\t$this->count_miss .\n\t\t\t' [set] ' .\n\t\t\t$this->count_set;\n\t}\n\n\t\/**\n\t * Adds data to the cache if it doesn't already exist.\n\t *\n\t * @since 1.8\n\t * @access public\n\t * @see WP_Object_Cache::set()\n\t *\n\t * @param int|string $key    What to call the contents in the cache.\n\t * @param mixed      $data   The contents to store in the cache.\n\t * @param string     $group  Optional. Where to group the cache contents. Default 'default'.\n\t * @param int        $expire Optional. When to expire the cache contents, in seconds.\n\t *                           Default 0 (no expiration).\n\t * @return bool True on success, false if cache key and group already exist.\n\t *\/\n\tpublic function add( $key, $data, $group = 'default', $expire = 0 ) {\n\t\tif ( wp_suspend_cache_addition() ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( array_key_exists( $id, $this->_cache ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $this->set( $key, $data, $group, (int) $expire );\n\t}\n\n\t\/**\n\t * Adds multiple values to the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $data   Array of keys and values to be added.\n\t * @param string $group  Optional. Where the cache contents are grouped. Default empty.\n\t * @param int    $expire Optional. When to expire the cache contents, in seconds.\n\t *                       Default 0 (no expiration).\n\t * @return bool[] Array of return values, grouped by key. Each value is either\n\t *                true on success, or false if cache key and group already exist.\n\t *\/\n\tpublic function add_multiple( array $data, $group = '', $expire = 0 ) {\n\t\t$values = array();\n\n\t\tforeach ( $data as $key => $value ) {\n\t\t\t$values[ $key ] = $this->add( $key, $value, $group, $expire );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t\/**\n\t * Replaces the contents in the cache, if contents already exist.\n\t *\n\t * @since 1.8\n\t * @access public\n\t * @see WP_Object_Cache::set()\n\t *\n\t * @param int|string $key    What to call the contents in the cache.\n\t * @param mixed      $data   The contents to store in the cache.\n\t * @param string     $group  Optional. Where to group the cache contents. Default 'default'.\n\t * @param int        $expire Optional. When to expire the cache contents, in seconds.\n\t *                           Default 0 (no expiration).\n\t * @return bool True if contents were replaced, false if original value does not exist.\n\t *\/\n\tpublic function replace( $key, $data, $group = 'default', $expire = 0 ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( ! array_key_exists( $id, $this->_cache ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $this->set( $key, $data, $group, (int) $expire );\n\t}\n\n\t\/**\n\t * Sets the data contents into the cache.\n\t *\n\t * The cache contents are grouped by the $group parameter followed by the\n\t * $key. This allows for duplicate IDs in unique groups. Therefore, naming of\n\t * the group should be used with care and should follow normal function\n\t * naming guidelines outside of core WordPress usage.\n\t *\n\t * The $expire parameter is not used, because the cache will automatically\n\t * expire for each time a page is accessed and PHP finishes. The method is\n\t * more for cache plugins which use files.\n\t *\n\t * @since 1.8\n\t * @since 5.4 Returns false if cache key is invalid.\n\t * @access public\n\t *\n\t * @param int|string $key    What to call the contents in the cache.\n\t * @param mixed      $data   The contents to store in the cache.\n\t * @param string     $group  Optional. Where to group the cache contents. Default 'default'.\n\t * @param int        $expire Optional. When to expire the cache contents, in seconds.\n\t *                           Default 0 (no expiration).\n\t * @return bool True if contents were set, false if key is invalid.\n\t *\/\n\tpublic function set( $key, $data, $group = 'default', $expire = 0 ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( is_object( $data ) ) {\n\t\t\t$data = clone $data;\n\t\t}\n\n\t\t$this->_cache[ $id ] = $data;\n\n\t\tif ( array_key_exists( $id, $this->_cache_404 ) ) {\n\t\t\tunset( $this->_cache_404[ $id ] );\n\t\t}\n\n\t\tif ( ! $this->_object_cache->is_non_persistent( $group ) ) {\n\t\t\t\/\/ phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions.serialize_serialize\n\t\t\t$this->_object_cache->set( $id, serialize( array( 'data' => $data ) ), (int) $expire );\n\t\t\t++$this->count_set;\n\t\t}\n\n\t\tif ( $this->_object_cache->store_transients( $group ) ) {\n\t\t\t$this->_transient_set( $key, $data, $group, (int) $expire );\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Sets multiple values to the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $data   Array of key and value to be set.\n\t * @param string $group  Optional. Where the cache contents are grouped. Default empty.\n\t * @param int    $expire Optional. When to expire the cache contents, in seconds.\n\t *                       Default 0 (no expiration).\n\t * @return bool[] Array of return values, grouped by key. Each value is always true.\n\t *\/\n\tpublic function set_multiple( array $data, $group = '', $expire = 0 ) {\n\t\t$values = array();\n\n\t\tforeach ( $data as $key => $value ) {\n\t\t\t$values[ $key ] = $this->set( $key, $value, $group, $expire );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t\/**\n\t * Retrieves the cache contents, if it exists.\n\t *\n\t * The contents will be first attempted to be retrieved by searching by the\n\t * key in the cache group. If the cache is hit (success) then the contents\n\t * are returned.\n\t *\n\t * On failure, the number of cache misses will be incremented.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int|string $key   The key under which the cache contents are stored.\n\t * @param string     $group Optional. Where the cache contents are grouped. Default 'default'.\n\t * @param bool       $force Optional. Unused. Whether to force an update of the local cache\n\t *                          from the persistent cache. Default false.\n\t * @param bool       $found Optional. Whether the key was found in the cache (passed by reference).\n\t *                          Disambiguates a return of false, a storable value. Default null.\n\t * @return mixed|false The cache contents on success, false on failure to retrieve contents.\n\t *\/\n\tpublic function get( $key, $group = 'default', $force = false, &$found = null ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\t$found       = false;\n\t\t$found_in_oc = false;\n\t\t$cache_val   = false;\n\n\t\tif ( array_key_exists( $id, $this->_cache ) && ! $force ) {\n\t\t\t$found     = true;\n\t\t\t$cache_val = $this->_cache[ $id ];\n\t\t\t++$this->count_hit_incall;\n\t\t} elseif ( ! array_key_exists( $id, $this->_cache_404 ) && ! $this->_object_cache->is_non_persistent( $group ) ) {\n\t\t\t$v = $this->_object_cache->get( $id );\n\n\t\t\tif ( null !== $v ) {\n\t\t\t\t$v = maybe_unserialize( $v );\n\t\t\t}\n\n\t\t\t\/\/ To be compatible with false val.\n\t\t\tif ( is_array( $v ) && array_key_exists( 'data', $v ) ) {\n\t\t\t\t++$this->count_hit;\n\t\t\t\t$found       = true;\n\t\t\t\t$found_in_oc = true;\n\t\t\t\t$cache_val   = $v['data'];\n\t\t\t} else {\n\t\t\t\t\/\/ Can't find key, cache it to 404.\n\t\t\t\t$this->_cache_404[ $id ] = 1;\n\t\t\t\t++$this->count_miss;\n\t\t\t}\n\t\t} else {\n\t\t\t++$this->count_miss_incall;\n\t\t}\n\n\t\tif ( is_object( $cache_val ) ) {\n\t\t\t$cache_val = clone $cache_val;\n\t\t}\n\n\t\t\/\/ If not found but has `Store Transients` cfg on, still need to follow WP's get_transient() logic.\n\t\tif ( ! $found && $this->_object_cache->store_transients( $group ) ) {\n\t\t\t$cache_val = $this->_transient_get( $key, $group );\n\t\t\tif ( $cache_val ) {\n\t\t\t\t$found = true;\n\t\t\t}\n\t\t}\n\n\t\tif ( $found_in_oc ) {\n\t\t\t$this->_cache[ $id ] = $cache_val;\n\t\t}\n\n\t\t++$this->cache_total;\n\n\t\treturn $cache_val;\n\t}\n\n\t\/**\n\t * Retrieves multiple values from the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $keys  Array of keys under which the cache contents are stored.\n\t * @param string $group Optional. Where the cache contents are grouped. Default 'default'.\n\t * @param bool   $force Optional. Whether to force an update of the local cache\n\t *                      from the persistent cache. Default false.\n\t * @return array Array of return values, grouped by key. Each value is either\n\t *               the cache contents on success, or false on failure.\n\t *\/\n\tpublic function get_multiple( $keys, $group = 'default', $force = false ) {\n\t\t$values = array();\n\n\t\tforeach ( $keys as $key ) {\n\t\t\t$values[ $key ] = $this->get( $key, $group, $force );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t\/**\n\t * Removes the contents of the cache key in the group.\n\t *\n\t * If the cache key does not exist in the group, then nothing will happen.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int|string $key   What the contents in the cache are called.\n\t * @param string     $group Optional. Where the cache contents are grouped. Default 'default'.\n\t * @return bool True on success, false if the contents were not deleted.\n\t *\/\n\tpublic function delete( $key, $group = 'default' ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$id = $this->_key( $key, $group );\n\n\t\tif ( $this->_object_cache->store_transients( $group ) ) {\n\t\t\t$this->_transient_del( $key, $group );\n\t\t}\n\n\t\tif ( array_key_exists( $id, $this->_cache ) ) {\n\t\t\tunset( $this->_cache[ $id ] );\n\t\t}\n\n\t\tif ( $this->_object_cache->is_non_persistent( $group ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $this->_object_cache->delete( $id );\n\t}\n\n\t\/**\n\t * Deletes multiple values from the cache in one call.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param array  $keys  Array of keys to be deleted.\n\t * @param string $group Optional. Where the cache contents are grouped. Default empty.\n\t * @return bool[] Array of return values, grouped by key. Each value is either\n\t *                true on success, or false if the contents were not deleted.\n\t *\/\n\tpublic function delete_multiple( array $keys, $group = '' ) {\n\t\t$values = array();\n\n\t\tforeach ( $keys as $key ) {\n\t\t\t$values[ $key ] = $this->delete( $key, $group );\n\t\t}\n\n\t\treturn $values;\n\t}\n\n\t\/**\n\t * Increments numeric cache item's value.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param int|string $key    The cache key to increment.\n\t * @param int        $offset Optional. The amount by which to increment the item's value.\n\t *                           Default 1.\n\t * @param string     $group  Optional. The group the key is in. Default 'default'.\n\t * @return int|false The item's new value on success, false on failure.\n\t *\/\n\tpublic function incr( $key, $offset = 1, $group = 'default' ) {\n\t\treturn $this->incr_desr( $key, $offset, $group, true );\n\t}\n\n\t\/**\n\t * Decrements numeric cache item's value.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @param int|string $key    The cache key to decrement.\n\t * @param int        $offset Optional. The amount by which to decrement the item's value.\n\t *                           Default 1.\n\t * @param string     $group  Optional. The group the key is in. Default 'default'.\n\t * @return int|false The item's new value on success, false on failure.\n\t *\/\n\tpublic function decr( $key, $offset = 1, $group = 'default' ) {\n\t\treturn $this->incr_desr( $key, $offset, $group, false );\n\t}\n\n\t\/**\n\t * Increments or decrements numeric cache item's value.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int|string $key    The cache key to increment or decrement.\n\t * @param int        $offset The amount by which to adjust the item's value.\n\t * @param string     $group  Optional. The group the key is in. Default 'default'.\n\t * @param bool       $incr   True to increment, false to decrement.\n\t * @return int|false The item's new value on success, false on failure.\n\t *\/\n\tpublic function incr_desr( $key, $offset = 1, $group = 'default', $incr = true ) {\n\t\tif ( ! $this->is_valid_key( $key ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( empty( $group ) ) {\n\t\t\t$group = 'default';\n\t\t}\n\n\t\t$cache_val = $this->get( $key, $group );\n\n\t\tif ( false === $cache_val ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! is_numeric( $cache_val ) ) {\n\t\t\t$cache_val = 0;\n\t\t}\n\n\t\t$offset = (int) $offset;\n\n\t\tif ( $incr ) {\n\t\t\t$cache_val += $offset;\n\t\t} else {\n\t\t\t$cache_val -= $offset;\n\t\t}\n\n\t\tif ( $cache_val < 0 ) {\n\t\t\t$cache_val = 0;\n\t\t}\n\n\t\t$this->set( $key, $cache_val, $group );\n\n\t\treturn $cache_val;\n\t}\n\n\t\/**\n\t * Clears the object cache of all data.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @return true Always returns true.\n\t *\/\n\tpublic function flush() {\n\t\t$this->flush_runtime();\n\n\t\t$this->_object_cache->flush();\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Removes all cache items from the in-memory runtime cache.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @return true Always returns true.\n\t *\/\n\tpublic function flush_runtime() {\n\t\t$this->_cache     = array();\n\t\t$this->_cache_404 = array();\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Removes all cache items in a group.\n\t *\n\t * @since 5.4\n\t * @access public\n\t *\n\t * @return true Always returns true.\n\t *\/\n\tpublic function flush_group() {\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Sets the list of global cache groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups List of groups that are global.\n\t *\/\n\tpublic function add_global_groups( $groups ) {\n\t\t$groups = (array) $groups;\n\n\t\t$this->_object_cache->add_global_groups( $groups );\n\t}\n\n\t\/**\n\t * Sets the list of non-persistent cache groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups A group or an array of groups to add.\n\t *\/\n\tpublic function add_non_persistent_groups( $groups ) {\n\t\t$groups = (array) $groups;\n\n\t\t$this->_object_cache->add_non_persistent_groups( $groups );\n\t}\n\n\t\/**\n\t * Switches the internal blog ID.\n\t *\n\t * This changes the blog ID used to create keys in blog specific groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param int $blog_id Blog ID.\n\t *\/\n\tpublic function switch_to_blog( $blog_id ) {\n\t\t$blog_id           = (int) $blog_id;\n\t\t$this->blog_prefix = $this->multisite ? $blog_id . ':' : '';\n\t}\n\n\t\/**\n\t * Get transient from wp table\n\t *\n\t * Retrieves transient data from WordPress options table.\n\t *\n\t * @since 1.8.3\n\t * @access private\n\t * @see `wp-includes\/option.php` function `get_transient`\/`set_site_transient`\n\t *\n\t * @param string $transient Transient name.\n\t * @param string $group     Transient group ('transient' or 'site-transient').\n\t * @return mixed Transient value or false if not found.\n\t *\/\n\tprivate function _transient_get( $transient, $group ) {\n\t\tif ( 'transient' === $group ) {\n\t\t\t\/**** Ori WP func start *\/\n\t\t\t$transient_option = '_transient_' . $transient;\n\t\t\tif ( ! wp_installing() ) {\n\t\t\t\t\/\/ If option is not in alloptions, it is not autoloaded and thus has a timeout\n\t\t\t\t$alloptions = wp_load_alloptions();\n\t\t\t\tif ( ! isset( $alloptions[ $transient_option ] ) ) {\n\t\t\t\t\t$transient_timeout = '_transient_timeout_' . $transient;\n\t\t\t\t\t$timeout           = get_option( $transient_timeout );\n\t\t\t\t\tif ( false !== $timeout && $timeout < time() ) {\n\t\t\t\t\t\tdelete_option( $transient_option );\n\t\t\t\t\t\tdelete_option( $transient_timeout );\n\t\t\t\t\t\t$value = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! isset( $value ) ) {\n\t\t\t\t$value = get_option( $transient_option );\n\t\t\t}\n\t\t\t\/**** Ori WP func end *\/\n\t\t} elseif ( 'site-transient' === $group ) {\n\t\t\t\/**** Ori WP func start *\/\n\t\t\t$no_timeout       = array( 'update_core', 'update_plugins', 'update_themes' );\n\t\t\t$transient_option = '_site_transient_' . $transient;\n\t\t\tif ( ! in_array( $transient, $no_timeout, true ) ) {\n\t\t\t\t$transient_timeout = '_site_transient_timeout_' . $transient;\n\t\t\t\t$timeout           = get_site_option( $transient_timeout );\n\t\t\t\tif ( false !== $timeout && $timeout < time() ) {\n\t\t\t\t\tdelete_site_option( $transient_option );\n\t\t\t\t\tdelete_site_option( $transient_timeout );\n\t\t\t\t\t$value = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! isset( $value ) ) {\n\t\t\t\t$value = get_site_option( $transient_option );\n\t\t\t}\n\t\t\t\/**** Ori WP func end *\/\n\t\t} else {\n\t\t\t$value = false;\n\t\t}\n\n\t\treturn $value;\n\t}\n\n\t\/**\n\t * Set transient to WP table\n\t *\n\t * Stores transient data in WordPress options table.\n\t *\n\t * @since 1.8.3\n\t * @access private\n\t * @see `wp-includes\/option.php` function `set_transient`\/`set_site_transient`\n\t *\n\t * @param string $transient  Transient name.\n\t * @param mixed  $value      Transient value.\n\t * @param string $group      Transient group ('transient' or 'site-transient').\n\t * @param int    $expiration Time until expiration in seconds.\n\t * @return bool True on success, false on failure.\n\t *\/\n\tprivate function _transient_set( $transient, $value, $group, $expiration ) {\n\t\tif ( 'transient' === $group ) {\n\t\t\t\/**** Ori WP func start *\/\n\t\t\t$transient_timeout = '_transient_timeout_' . $transient;\n\t\t\t$transient_option  = '_transient_' . $transient;\n\t\t\tif ( false === get_option( $transient_option ) ) {\n\t\t\t\t$autoload = 'yes';\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\t$autoload = 'no';\n\t\t\t\t\tadd_option( $transient_timeout, time() + (int) $expiration, '', 'no' );\n\t\t\t\t}\n\t\t\t\t$result = add_option( $transient_option, $value, '', $autoload );\n\t\t\t} else {\n\t\t\t\t\/\/ If expiration is requested, but the transient has no timeout option,\n\t\t\t\t\/\/ delete, then re-create transient rather than update.\n\t\t\t\t$update = true;\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\tif ( false === get_option( $transient_timeout ) ) {\n\t\t\t\t\t\tdelete_option( $transient_option );\n\t\t\t\t\t\tadd_option( $transient_timeout, time() + (int) $expiration, '', 'no' );\n\t\t\t\t\t\t$result = add_option( $transient_option, $value, '', 'no' );\n\t\t\t\t\t\t$update = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdate_option( $transient_timeout, time() + (int) $expiration );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( $update ) {\n\t\t\t\t\t$result = update_option( $transient_option, $value );\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/**** Ori WP func end *\/\n\t\t} elseif ( 'site-transient' === $group ) {\n\t\t\t\/**** Ori WP func start *\/\n\t\t\t$transient_timeout = '_site_transient_timeout_' . $transient;\n\t\t\t$option            = '_site_transient_' . $transient;\n\t\t\tif ( false === get_site_option( $option ) ) {\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\tadd_site_option( $transient_timeout, time() + (int) $expiration );\n\t\t\t\t}\n\t\t\t\t$result = add_site_option( $option, $value );\n\t\t\t} else {\n\t\t\t\tif ( (int) $expiration ) {\n\t\t\t\t\tupdate_site_option( $transient_timeout, time() + (int) $expiration );\n\t\t\t\t}\n\t\t\t\t$result = update_site_option( $option, $value );\n\t\t\t}\n\t\t\t\/**** Ori WP func end *\/\n\t\t} else {\n\t\t\t$result = null;\n\t\t}\n\n\t\treturn $result;\n\t}\n\n\t\/**\n\t * Delete transient from WP table\n\t *\n\t * Removes transient data from WordPress options table.\n\t *\n\t * @since 1.8.3\n\t * @access private\n\t * @see `wp-includes\/option.php` function `delete_transient`\/`delete_site_transient`\n\t *\n\t * @param string $transient Transient name.\n\t * @param string $group     Transient group ('transient' or 'site-transient').\n\t *\/\n\tprivate function _transient_del( $transient, $group ) {\n\t\tif ( 'transient' === $group ) {\n\t\t\t\/**** Ori WP func start *\/\n\t\t\t$option_timeout = '_transient_timeout_' . $transient;\n\t\t\t$option         = '_transient_' . $transient;\n\t\t\t$result         = delete_option( $option );\n\t\t\tif ( $result ) {\n\t\t\t\tdelete_option( $option_timeout );\n\t\t\t}\n\t\t\t\/**** Ori WP func end *\/\n\t\t} elseif ( 'site-transient' === $group ) {\n\t\t\t\/**** Ori WP func start *\/\n\t\t\t$option_timeout = '_site_transient_timeout_' . $transient;\n\t\t\t$option         = '_site_transient_' . $transient;\n\t\t\t$result         = delete_site_option( $option );\n\t\t\tif ( $result ) {\n\t\t\t\tdelete_site_option( $option_timeout );\n\t\t\t}\n\t\t\t\/**** Ori WP func end *\/\n\t\t}\n\t}\n\n\t\/**\n\t * Get the current instance object.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @return WP_Object_Cache The current instance.\n\t *\/\n\tpublic static function get_instance() {\n\t\tif ( ! isset( self::$_instance ) ) {\n\t\t\tself::$_instance = new self();\n\t\t}\n\n\t\treturn self::$_instance;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/router.cls.php","ext":"php","size":21062,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The core plugin router class.\n *\n * This generate the valid action.\n *\n * @since       1.1.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Router extends Base {\n\n\tconst LOG_TAG = '[Router]';\n\n\tconst NONCE  = 'LSCWP_NONCE';\n\tconst ACTION = 'LSCWP_CTRL';\n\n\tconst ACTION_SAVE_SETTINGS_NETWORK = 'save-settings-network';\n\tconst ACTION_DB_OPTM               = 'db_optm';\n\tconst ACTION_PLACEHOLDER           = 'placeholder';\n\tconst ACTION_AVATAR                = 'avatar';\n\tconst ACTION_SAVE_SETTINGS         = 'save-settings';\n\tconst ACTION_CLOUD                 = 'cloud';\n\tconst ACTION_IMG_OPTM              = 'img_optm';\n\tconst ACTION_HEALTH                = 'health';\n\tconst ACTION_CRAWLER               = 'crawler';\n\tconst ACTION_PURGE                 = 'purge';\n\tconst ACTION_CONF                  = 'conf';\n\tconst ACTION_ACTIVATION            = 'activation';\n\tconst ACTION_CSS                   = 'css';\n\tconst ACTION_UCSS                  = 'ucss';\n\tconst ACTION_VPI                   = 'vpi';\n\tconst ACTION_PRESET                = 'preset';\n\tconst ACTION_IMPORT                = 'import';\n\tconst ACTION_REPORT                = 'report';\n\tconst ACTION_DEBUG2                = 'debug2';\n\tconst ACTION_CDN_CLOUDFLARE        = 'CDN\\Cloudflare';\n\tconst ACTION_ADMIN_DISPLAY         = 'admin_display';\n\tconst ACTION_TMP_DISABLE          = 'tmp_disable';\n\n\t\/\/ List all handlers here\n\tprivate static $_HANDLERS = array(\n\t\tself::ACTION_ADMIN_DISPLAY,\n\t\tself::ACTION_ACTIVATION,\n\t\tself::ACTION_AVATAR,\n\t\tself::ACTION_CDN_CLOUDFLARE,\n\t\tself::ACTION_CLOUD,\n\t\tself::ACTION_CONF,\n\t\tself::ACTION_CRAWLER,\n\t\tself::ACTION_CSS,\n\t\tself::ACTION_UCSS,\n\t\tself::ACTION_VPI,\n\t\tself::ACTION_DB_OPTM,\n\t\tself::ACTION_DEBUG2,\n\t\tself::ACTION_HEALTH,\n\t\tself::ACTION_IMG_OPTM,\n\t\tself::ACTION_PRESET,\n\t\tself::ACTION_IMPORT,\n\t\tself::ACTION_PLACEHOLDER,\n\t\tself::ACTION_PURGE,\n\t\tself::ACTION_REPORT,\n\t);\n\n\tconst TYPE = 'litespeed_type';\n\n\tconst ITEM_HASH       = 'hash';\n\tconst ITEM_FLASH_HASH = 'flash_hash';\n\n\tprivate static $_esi_enabled;\n\tprivate static $_is_ajax;\n\tprivate static $_is_logged_in;\n\tprivate static $_ip;\n\tprivate static $_action;\n\tprivate static $_is_admin_ip;\n\tprivate static $_frontend_path;\n\n\t\/**\n\t * Redirect to self to continue operation\n\t *\n\t * Note: must return when use this func. CLI\/Cron call won't die in this func.\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic static function self_redirect( $action, $type ) {\n\t\tif (defined('LITESPEED_CLI') || wp_doing_cron()) {\n\t\t\tAdmin_Display::success('To be continued'); \/\/ Show for CLI\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Add i to avoid browser too many redirected warning\n\t\t$i = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t++$i;\n\n\t\t$link = Utility::build_url($action, $type, false, null, array( 'litespeed_i' => $i ));\n\n\t\t$url = html_entity_decode($link);\n\t\texit(\"<meta http-equiv='refresh' content='0;url=$url'>\");\n\t}\n\n\t\/**\n\t * Check if can run optimize\n\t *\n\t * @since  1.3\n\t * @since  2.3.1 Relocated from cdn.cls\n\t * @access public\n\t *\/\n\tpublic function can_optm() {\n\t\t$can = true;\n\n\t\tif (is_user_logged_in() && $this->conf(self::O_OPTM_GUEST_ONLY)) {\n\t\t\t$can = false;\n\t\t} elseif (is_admin()) {\n\t\t\t$can = false;\n\t\t} elseif (is_feed()) {\n\t\t\t$can = false;\n\t\t} elseif (is_preview()) {\n\t\t\t$can = false;\n\t\t} elseif (self::is_ajax()) {\n\t\t\t$can = false;\n\t\t}\n\n\t\tif (self::_is_login_page()) {\n\t\t\tDebug2::debug('[Router] Optm bypassed: login\/reg page');\n\t\t\t$can = false;\n\t\t}\n\n\t\t$can_final = apply_filters('litespeed_can_optm', $can);\n\n\t\tif ($can_final != $can) {\n\t\t\tDebug2::debug('[Router] Optm bypassed: filter');\n\t\t}\n\n\t\treturn $can_final;\n\t}\n\n\t\/**\n\t * Check referer page to see if its from admin\n\t *\n\t * @since 2.4.2.1\n\t * @access public\n\t *\/\n\tpublic static function from_admin() {\n\t\treturn !empty($_SERVER['HTTP_REFERER']) && strpos($_SERVER['HTTP_REFERER'], get_admin_url()) === 0;\n\t}\n\n\t\/**\n\t * Check if it can use CDN replacement\n\t *\n\t * @since  1.2.3\n\t * @since  2.3.1 Relocated from cdn.cls\n\t * @access public\n\t *\/\n\tpublic static function can_cdn() {\n\t\t$can = true;\n\n\t\tif (is_admin()) {\n\t\t\tif (!self::is_ajax()) {\n\t\t\t\tDebug2::debug2('[Router] CDN bypassed: is not ajax call');\n\t\t\t\t$can = false;\n\t\t\t}\n\n\t\t\tif (self::from_admin()) {\n\t\t\t\tDebug2::debug2('[Router] CDN bypassed: ajax call from admin');\n\t\t\t\t$can = false;\n\t\t\t}\n\t\t} elseif (is_feed()) {\n\t\t\t$can = false;\n\t\t} elseif (is_preview()) {\n\t\t\t$can = false;\n\t\t}\n\n\t\t\/**\n\t\t * Bypass cron to avoid deregister jq notice `Do not deregister the <code>jquery-core<\/code> script in the administration area.`\n\t\t *\n\t\t * @since  2.7.2\n\t\t *\/\n\t\tif (wp_doing_cron()) {\n\t\t\t$can = false;\n\t\t}\n\n\t\t\/**\n\t\t * Bypass login\/reg page\n\t\t *\n\t\t * @since  1.6\n\t\t *\/\n\t\tif (self::_is_login_page()) {\n\t\t\tDebug2::debug('[Router] CDN bypassed: login\/reg page');\n\t\t\t$can = false;\n\t\t}\n\n\t\t\/**\n\t\t * Bypass post\/page link setting\n\t\t *\n\t\t * @since 2.9.8.5\n\t\t *\/\n\t\t$rest_prefix = function_exists('rest_get_url_prefix') ? rest_get_url_prefix() : apply_filters('rest_url_prefix', 'wp-json');\n\t\tif (\n\t\t\t!empty($_SERVER['REQUEST_URI']) &&\n\t\t\tstrpos($_SERVER['REQUEST_URI'], $rest_prefix . '\/wp\/v2\/media') !== false &&\n\t\t\tisset($_SERVER['HTTP_REFERER']) &&\n\t\t\tstrpos($_SERVER['HTTP_REFERER'], 'wp-admin') !== false\n\t\t) {\n\t\t\tDebug2::debug('[Router] CDN bypassed: wp-json on admin page');\n\t\t\t$can = false;\n\t\t}\n\n\t\t$can_final = apply_filters('litespeed_can_cdn', $can);\n\n\t\tif ($can_final != $can) {\n\t\t\tDebug2::debug('[Router] CDN bypassed: filter');\n\t\t}\n\n\t\treturn $can_final;\n\t}\n\n\t\/**\n\t * Check if is login page or not\n\t *\n\t * @since  2.3.1\n\t * @access protected\n\t *\/\n\tprotected static function _is_login_page() {\n\t\tif (in_array($GLOBALS['pagenow'], array( 'wp-login.php', 'wp-register.php' ), true)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * UCSS\/Crawler role simulator\n\t *\n\t * @since  1.9.1\n\t * @since  3.3 Renamed from `is_crawler_role_simulation`\n\t *\/\n\tpublic function is_role_simulation() {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (empty($_COOKIE['litespeed_hash']) && empty($_COOKIE['litespeed_flash_hash'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('\ud83e\udeaa starting role validation');\n\n\t\t\/\/ Check if is from crawler\n\t\t\/\/ if ( empty( $_SERVER[ 'HTTP_USER_AGENT' ] ) || strpos( $_SERVER[ 'HTTP_USER_AGENT' ], Crawler::FAST_USER_AGENT ) !== 0 ) {\n\t\t\/\/ Debug2::debug( '[Router] user agent not match' );\n\t\t\/\/ return;\n\t\t\/\/ }\n\t\t$server_ip = $this->conf(self::O_SERVER_IP);\n\t\tif (!$server_ip || self::get_ip() !== $server_ip) {\n\t\t\tself::debug('\u274c\u274c Role simulate uid denied! Not localhost visit!');\n\t\t\tControl::set_nocache('Role simulate uid denied');\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Flash hash validation\n\t\tif (!empty($_COOKIE['litespeed_flash_hash'])) {\n\t\t\t$hash_data = self::get_option(self::ITEM_FLASH_HASH, array());\n\t\t\tif ($hash_data && is_array($hash_data) && !empty($hash_data['hash']) && !empty($hash_data['ts']) && !empty($hash_data['uid'])) {\n\t\t\t\tif (time() - $hash_data['ts'] < 120 && $_COOKIE['litespeed_flash_hash'] == $hash_data['hash']) {\n\t\t\t\t\tself::debug('\ud83e\udeaa Role simulator flash hash matched, escalating user to be uid=' . $hash_data['uid']);\n\t\t\t\t\tself::delete_option(self::ITEM_FLASH_HASH);\n\t\t\t\t\twp_set_current_user($hash_data['uid']);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\/\/ Hash validation\n\t\tif (!empty($_COOKIE['litespeed_hash'])) {\n\t\t\t$hash_data = self::get_option(self::ITEM_HASH, array());\n\t\t\tif ($hash_data && is_array($hash_data) && !empty($hash_data['hash']) && !empty($hash_data['ts']) && !empty($hash_data['uid'])) {\n\t\t\t\t$RUN_DURATION = $this->cls('Crawler')->get_crawler_duration();\n\t\t\t\tif (time() - $hash_data['ts'] < $RUN_DURATION && $_COOKIE['litespeed_hash'] == $hash_data['hash']) {\n\t\t\t\t\tself::debug('\ud83e\udeaa Role simulator hash matched, escalating user to be uid=' . $hash_data['uid']);\n\t\t\t\t\twp_set_current_user($hash_data['uid']);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tself::debug('\u274c WARNING: role simulator hash not match');\n\t}\n\n\t\/**\n\t * Get a short ttl hash (2mins)\n\t *\n\t * @since  6.4\n\t *\/\n\tpublic function get_flash_hash( $uid ) {\n\t\t$hash_data = self::get_option(self::ITEM_FLASH_HASH, array());\n\t\tif ($hash_data && is_array($hash_data) && !empty($hash_data['hash']) && !empty($hash_data['ts'])) {\n\t\t\tif (time() - $hash_data['ts'] < 60) {\n\t\t\t\treturn $hash_data['hash'];\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Check if this user has editor access or not\n\t\tif (user_can($uid, 'edit_posts')) {\n\t\t\tself::debug('\ud83d\uded1 The user with id ' . $uid . ' has editor access, which is not allowed for the role simulator.');\n\t\t\treturn '';\n\t\t}\n\n\t\t$hash = Str::rrand(32);\n\t\tself::update_option(self::ITEM_FLASH_HASH, array(\n\t\t\t'hash' => $hash,\n\t\t\t'ts' => time(),\n\t\t\t'uid' => $uid,\n\t\t));\n\t\treturn $hash;\n\t}\n\n\t\/**\n\t * Get a security hash\n\t *\n\t * @since  3.3\n\t *\/\n\tpublic function get_hash( $uid ) {\n\t\t\/\/ Check if this user has editor access or not\n\t\tif (user_can($uid, 'edit_posts')) {\n\t\t\tself::debug('\ud83d\uded1 The user with id ' . $uid . ' has editor access, which is not allowed for the role simulator.');\n\t\t\treturn '';\n\t\t}\n\n\t\t\/\/ As this is called only when starting crawling, not per page, no need to reuse\n\t\t$hash = Str::rrand(32);\n\t\tself::update_option(self::ITEM_HASH, array(\n\t\t\t'hash' => $hash,\n\t\t\t'ts' => time(),\n\t\t\t'uid' => $uid,\n\t\t));\n\t\treturn $hash;\n\t}\n\n\t\/**\n\t * Get user role\n\t *\n\t * @since  1.6.2\n\t *\/\n\tpublic static function get_role( $uid = null ) {\n\t\tif (defined('LITESPEED_WP_ROLE')) {\n\t\t\treturn LITESPEED_WP_ROLE;\n\t\t}\n\n\t\tif ($uid === null) {\n\t\t\t$uid = get_current_user_id();\n\t\t}\n\n\t\t$role = false;\n\t\tif ($uid) {\n\t\t\t$user = get_userdata($uid);\n\t\t\tif (isset($user->roles) && is_array($user->roles)) {\n\t\t\t\t$tmp  = array_values($user->roles);\n\t\t\t\t$role = implode(',', $tmp); \/\/ Combine for PHP5.3 const compatibility\n\t\t\t}\n\t\t}\n\t\tDebug2::debug('[Router] get_role: ' . $role);\n\n\t\tif (!$role) {\n\t\t\treturn $role;\n\t\t\t\/\/ Guest user\n\t\t\tDebug2::debug('[Router] role: guest');\n\n\t\t\t\/**\n\t\t\t * Fix double login issue\n\t\t\t * The previous user init refactoring didn't fix this bcos this is in login process and the user role could change\n\t\t\t *\n\t\t\t * @see  https:\/\/github.com\/litespeedtech\/lscache_wp\/commit\/69e7bc71d0de5cd58961bae953380b581abdc088\n\t\t\t * @since  2.9.8 Won't assign const if in login process\n\t\t\t *\/\n\t\t\tif (substr_compare(wp_login_url(), $GLOBALS['pagenow'], -strlen($GLOBALS['pagenow'])) === 0) {\n\t\t\t\treturn $role;\n\t\t\t}\n\t\t}\n\n\t\tdefine('LITESPEED_WP_ROLE', $role);\n\n\t\treturn LITESPEED_WP_ROLE;\n\t}\n\n\t\/**\n\t * Get frontend path\n\t *\n\t * @since 1.2.2\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic static function frontend_path() {\n\t\t\/\/ todo: move to htaccess.cls ?\n\t\tif (!isset(self::$_frontend_path)) {\n\t\t\t$frontend = rtrim(ABSPATH, '\/'); \/\/ \/home\/user\/public_html\/frontend\n\t\t\t\/\/ get home path failed. Trac ticket #37668 (e.g. frontend:\/blog backend:\/wordpress)\n\t\t\tif (!$frontend) {\n\t\t\t\tDebug2::debug('[Router] No ABSPATH, generating from home option');\n\t\t\t\t$frontend = parse_url(get_option('home'));\n\t\t\t\t$frontend = !empty($frontend['path']) ? $frontend['path'] : '';\n\t\t\t\t$frontend = $_SERVER['DOCUMENT_ROOT'] . $frontend;\n\t\t\t}\n\t\t\t$frontend = realpath($frontend);\n\n\t\t\tself::$_frontend_path = $frontend;\n\t\t}\n\t\treturn self::$_frontend_path;\n\t}\n\n\t\/**\n\t * Check if ESI is enabled or not\n\t *\n\t * @since 1.2.0\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic function esi_enabled() {\n\t\tif (!isset(self::$_esi_enabled)) {\n\t\t\tself::$_esi_enabled = defined('LITESPEED_ON') && $this->conf(self::O_ESI);\n\t\t\tif (!empty($_REQUEST[self::ACTION])) {\n\t\t\t\tself::$_esi_enabled = false;\n\t\t\t}\n\t\t}\n\t\treturn self::$_esi_enabled;\n\t}\n\n\t\/**\n\t * Check if crawler is enabled on server level\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t *\/\n\tpublic static function can_crawl() {\n\t\tif (isset($_SERVER['X-LSCACHE']) && strpos($_SERVER['X-LSCACHE'], 'crawler') === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ CLI will bypass this check as crawler library can always do the 428 check\n\t\tif (defined('LITESPEED_CLI')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Check action\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return string\n\t *\/\n\tpublic static function get_action() {\n\t\tif (!isset(self::$_action)) {\n\t\t\tself::$_action = false;\n\t\t\tself::cls()->verify_action();\n\t\t\tif (self::$_action) {\n\t\t\t\tdefined('LSCWP_LOG') && Debug2::debug('[Router] LSCWP_CTRL verified: ' . var_export(self::$_action, true));\n\t\t\t}\n\t\t}\n\t\treturn self::$_action;\n\t}\n\n\t\/**\n\t * Check if is logged in\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic static function is_logged_in() {\n\t\tif (!isset(self::$_is_logged_in)) {\n\t\t\tself::$_is_logged_in = is_user_logged_in();\n\t\t}\n\t\treturn self::$_is_logged_in;\n\t}\n\n\t\/**\n\t * Check if is ajax call\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic static function is_ajax() {\n\t\tif (!isset(self::$_is_ajax)) {\n\t\t\tself::$_is_ajax = wp_doing_ajax();\n\t\t}\n\t\treturn self::$_is_ajax;\n\t}\n\n\t\/**\n\t * Check if is admin ip\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @return boolean\n\t *\/\n\tpublic function is_admin_ip() {\n\t\tif (!isset(self::$_is_admin_ip)) {\n\t\t\t$ips = $this->conf(self::O_DEBUG_IPS);\n\n\t\t\tself::$_is_admin_ip = $this->ip_access($ips);\n\t\t}\n\t\treturn self::$_is_admin_ip;\n\t}\n\n\t\/**\n\t * Get type value\n\t *\n\t * @since 1.6\n\t * @access public\n\t *\/\n\tpublic static function verify_type() {\n\t\tif (empty($_REQUEST[self::TYPE])) {\n\t\t\tDebug2::debug('[Router] no type', 2);\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug('[Router] parsed type: ' . $_REQUEST[self::TYPE], 2);\n\n\t\treturn $_REQUEST[self::TYPE];\n\t}\n\n\t\/**\n\t * Check privilege and nonce for the action\n\t *\n\t * @since 1.1.0\n\t * @access private\n\t *\/\n\tprivate function verify_action() {\n\t\tif (empty($_REQUEST[self::ACTION])) {\n\t\t\tDebug2::debug2('[Router] LSCWP_CTRL bypassed empty');\n\t\t\treturn;\n\t\t}\n\n\t\t$action = stripslashes($_REQUEST[self::ACTION]);\n\n\t\tif (!$action) {\n\t\t\treturn;\n\t\t}\n\n\t\t$_is_public_action = false;\n\n\t\t\/\/ Each action must have a valid nonce unless its from admin ip and is public action\n\t\t\/\/ Validate requests nonce (from admin logged in page or cli)\n\t\tif (!$this->verify_nonce($action)) {\n\t\t\t\/\/ check if it is from admin ip\n\t\t\tif (!$this->is_admin_ip()) {\n\t\t\t\tDebug2::debug('[Router] LSCWP_CTRL query string - did not match admin IP: ' . $action);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t\/\/ check if it is public action\n\t\t\tif (\n\t\t\t\t!in_array($action, array(\n\t\t\t\t\tCore::ACTION_QS_NOCACHE,\n\t\t\t\t\tCore::ACTION_QS_PURGE,\n\t\t\t\t\tCore::ACTION_QS_PURGE_SINGLE,\n\t\t\t\t\tCore::ACTION_QS_SHOW_HEADERS,\n\t\t\t\t\tCore::ACTION_QS_PURGE_ALL,\n\t\t\t\t\tCore::ACTION_QS_PURGE_EMPTYCACHE,\n\t\t\t\t))\n\t\t\t) {\n\t\t\t\tDebug2::debug('[Router] LSCWP_CTRL query string - did not match admin IP Actions: ' . $action);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (apply_filters('litespeed_qs_forbidden', false)) {\n\t\t\t\tDebug2::debug('[Router] LSCWP_CTRL forbidden by hook litespeed_qs_forbidden');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$_is_public_action = true;\n\t\t}\n\n\t\t\/* Now it is a valid action, lets log and check the permission *\/\n\t\tDebug2::debug('[Router] LSCWP_CTRL: ' . $action);\n\n\t\t\/\/ OK, as we want to do something magic, lets check if its allowed\n\t\t$_is_multisite       = is_multisite();\n\t\t$_is_network_admin   = $_is_multisite && is_network_admin();\n\t\t$_can_network_option = $_is_network_admin && current_user_can('manage_network_options');\n\t\t$_can_option         = current_user_can('manage_options');\n\n\t\tswitch ($action) {\n\t\t\tcase self::ACTION_TMP_DISABLE: \/\/ Disable LSC for 24H\n\t\t\t\tDebug2::tmp_disable();\n\t\t\t\tAdmin::redirect(\"?page=litespeed-toolbox#settings-debug\");\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_SAVE_SETTINGS_NETWORK: \/\/ Save network settings\n            if ($_can_network_option) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_PURGE_BY:\n            if (defined('LITESPEED_ON') && ($_can_network_option || $_can_option || self::is_ajax())) {\n\t\t\t\t\t\/\/ here may need more security\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_DB_OPTM:\n            if ($_can_network_option || $_can_option) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_PURGE_EMPTYCACHE: \/\/ todo: moved to purge.cls type action\n            if ((defined('LITESPEED_ON') || $_is_network_admin) && ($_can_network_option || (!$_is_multisite && $_can_option))) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_QS_NOCACHE:\n\t\t\tcase Core::ACTION_QS_PURGE:\n\t\t\tcase Core::ACTION_QS_PURGE_SINGLE:\n\t\t\tcase Core::ACTION_QS_SHOW_HEADERS:\n\t\t\tcase Core::ACTION_QS_PURGE_ALL:\n\t\t\tcase Core::ACTION_QS_PURGE_EMPTYCACHE:\n            if (defined('LITESPEED_ON') && ($_is_public_action || self::is_ajax())) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_ADMIN_DISPLAY:\n\t\t\tcase self::ACTION_PLACEHOLDER:\n\t\t\tcase self::ACTION_AVATAR:\n\t\t\tcase self::ACTION_IMG_OPTM:\n\t\t\tcase self::ACTION_CLOUD:\n\t\t\tcase self::ACTION_CDN_CLOUDFLARE:\n\t\t\tcase self::ACTION_CRAWLER:\n\t\t\tcase self::ACTION_PRESET:\n\t\t\tcase self::ACTION_IMPORT:\n\t\t\tcase self::ACTION_REPORT:\n\t\t\tcase self::ACTION_CSS:\n\t\t\tcase self::ACTION_UCSS:\n\t\t\tcase self::ACTION_VPI:\n\t\t\tcase self::ACTION_CONF:\n\t\t\tcase self::ACTION_ACTIVATION:\n\t\t\tcase self::ACTION_HEALTH:\n\t\t\tcase self::ACTION_SAVE_SETTINGS: \/\/ Save settings\n            if ($_can_option && !$_is_network_admin) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase self::ACTION_PURGE:\n\t\t\tcase self::ACTION_DEBUG2:\n            if ($_can_network_option || $_can_option) {\n\t\t\t\t\tself::$_action = $action;\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\tcase Core::ACTION_DISMISS:\n            \/**\n             * Non ajax call can dismiss too\n             *\n             * @since  2.9\n             *\/\n            \/\/ if ( self::is_ajax() ) {\n            self::$_action = $action;\n            \/\/ }\n\t\t\t\treturn;\n\n\t\t\tdefault:\n            Debug2::debug('[Router] LSCWP_CTRL match failed: ' . $action);\n\t\t\t\treturn;\n\t\t}\n\t}\n\n\t\/**\n\t * Verify nonce\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t * @param  string $action\n\t * @return bool\n\t *\/\n\tpublic function verify_nonce( $action ) {\n\t\tif (!isset($_REQUEST[self::NONCE]) || !wp_verify_nonce($_REQUEST[self::NONCE], $action)) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t\/**\n\t * Check if the ip is in the range\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic function ip_access( $ip_list ) {\n\t\tif (!$ip_list) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!isset(self::$_ip)) {\n\t\t\tself::$_ip = self::get_ip();\n\t\t}\n\n\t\tif (!self::$_ip) {\n\t\t\treturn false;\n\t\t}\n\t\t\/\/ $uip = explode('.', $_ip);\n\t\t\/\/ if(empty($uip) || count($uip) != 4) Return false;\n\t\t\/\/ foreach($ip_list as $key => $ip) $ip_list[$key] = explode('.', trim($ip));\n\t\t\/\/ foreach($ip_list as $key => $ip) {\n\t\t\/\/ if(count($ip) != 4) continue;\n\t\t\/\/ for($i = 0; $i <= 3; $i++) if($ip[$i] == '*') $ip_list[$key][$i] = $uip[$i];\n\t\t\/\/ }\n\t\treturn in_array(self::$_ip, $ip_list);\n\t}\n\n\t\/**\n\t * Get client ip\n\t *\n\t * @since 1.1.0\n\t * @since  1.6.5 changed to public\n\t * @access public\n\t * @return string\n\t *\/\n\tpublic static function get_ip() {\n\t\t$_ip = '';\n\t\t\/\/ if ( function_exists( 'apache_request_headers' ) ) {\n\t\t\/\/ $apache_headers = apache_request_headers();\n\t\t\/\/ $_ip = ! empty( $apache_headers['True-Client-IP'] ) ? $apache_headers['True-Client-IP'] : false;\n\t\t\/\/ if ( ! $_ip ) {\n\t\t\/\/ $_ip = ! empty( $apache_headers['X-Forwarded-For'] ) ? $apache_headers['X-Forwarded-For'] : false;\n\t\t\/\/ $_ip = explode( ',', $_ip );\n\t\t\/\/ $_ip = $_ip[ 0 ];\n\t\t\/\/ }\n\n\t\t\/\/ }\n\n\t\tif (!$_ip) {\n\t\t\t$_ip = !empty($_SERVER['REMOTE_ADDR']) ? $_SERVER['REMOTE_ADDR'] : false;\n\t\t}\n\t\treturn $_ip;\n\t}\n\n\t\/**\n\t * Check if opcode cache is enabled\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t *\/\n\tpublic static function opcache_enabled() {\n\t\treturn function_exists('opcache_reset') && ini_get('opcache.enable');\n\t}\n\n\t\/**\n\t * Check if opcode cache is restricted and file that is requesting.\n\t * https:\/\/www.php.net\/manual\/en\/opcache.configuration.php#ini.opcache.restrict-api\n\t *\n\t * @since  7.3\n\t * @access public\n\t *\/\n\tpublic static function opcache_restricted($file)\n\t{\n\t\t$restrict_value = ini_get('opcache.restrict_api');\n\t\tif ($restrict_value) {\n\t\t\tif ( !$file || false === strpos($restrict_value, $file) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Handle static files\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function serve_static() {\n\t\tif (!empty($_SERVER['SCRIPT_URI'])) {\n\t\t\tif (strpos($_SERVER['SCRIPT_URI'], LITESPEED_STATIC_URL . '\/') !== 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$path = substr($_SERVER['SCRIPT_URI'], strlen(LITESPEED_STATIC_URL . '\/'));\n\t\t} elseif (!empty($_SERVER['REQUEST_URI'])) {\n\t\t\t$static_path = parse_url(LITESPEED_STATIC_URL, PHP_URL_PATH) . '\/';\n\t\t\tif (strpos($_SERVER['REQUEST_URI'], $static_path) !== 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$path = substr(parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH), strlen($static_path));\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\t$path = explode('\/', $path, 2);\n\n\t\tif (empty($path[0]) || empty($path[1])) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ($path[0]) {\n\t\t\tcase 'avatar':\n            $this->cls('Avatar')->serve_static($path[1]);\n\t\t\t\tbreak;\n\n\t\t\tcase 'localres':\n            $this->cls('Localization')->serve_static($path[1]);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * This is different than other handlers\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function handler( $cls ) {\n\t\tif (!in_array($cls, self::$_HANDLERS)) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn $this->cls($cls)->handler();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/object-cache.cls.php","ext":"php","size":20788,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The object cache class.\n *\n * @since       1.8\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\nrequire_once dirname( __DIR__ ) . '\/autoload.php';\n\n\/**\n * Object cache handler using Redis or Memcached.\n *\n * NOTE: this class may be included without initialized core.\n *\n * @since 1.8\n *\/\nclass Object_Cache extends Root {\n\tconst LOG_TAG = '[Object_Cache]';\n\n\t\/**\n\t * Debug option key.\n\t *\n\t * @var string\n\t *\/\n\tconst O_DEBUG = 'debug';\n\n\t\/**\n\t * Object cache enable key.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT = 'object';\n\n\t\/**\n\t * Object kind (Redis\/Memcached).\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_KIND = 'object-kind';\n\n\t\/**\n\t * Object host.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_HOST = 'object-host';\n\n\t\/**\n\t * Object port.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_PORT = 'object-port';\n\n\t\/**\n\t * Object life\/TTL.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_LIFE = 'object-life';\n\n\t\/**\n\t * Persistent connection flag.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_PERSISTENT = 'object-persistent';\n\n\t\/**\n\t * Admin cache flag.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_ADMIN = 'object-admin';\n\n\t\/**\n\t * Transients store flag.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_TRANSIENTS = 'object-transients';\n\n\t\/**\n\t * DB index for Redis.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_DB_ID = 'object-db_id';\n\n\t\/**\n\t * Username for auth.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_USER = 'object-user';\n\n\t\/**\n\t * Password for auth.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_PSWD = 'object-pswd';\n\n\t\/**\n\t * Global groups list.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_GLOBAL_GROUPS = 'object-global_groups';\n\n\t\/**\n\t * Non-persistent groups list.\n\t *\n\t * @var string\n\t *\/\n\tconst O_OBJECT_NON_PERSISTENT_GROUPS = 'object-non_persistent_groups';\n\n\t\/**\n\t * Connection instance.\n\t *\n\t * @var \\Redis|\\Memcached|null\n\t *\/\n\tprivate $_conn;\n\n\t\/**\n\t * Debug config.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $_cfg_debug;\n\n\t\/**\n\t * Whether OC is enabled.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $_cfg_enabled;\n\n\t\/**\n\t * True => Redis, false => Memcached.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $_cfg_method;\n\n\t\/**\n\t * Host name.\n\t *\n\t * @var string\n\t *\/\n\tprivate $_cfg_host;\n\n\t\/**\n\t * Port number.\n\t *\n\t * @var int|string\n\t *\/\n\tprivate $_cfg_port;\n\n\t\/**\n\t * TTL in seconds.\n\t *\n\t * @var int\n\t *\/\n\tprivate $_cfg_life;\n\n\t\/**\n\t * Use persistent connection.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $_cfg_persistent;\n\n\t\/**\n\t * Cache admin pages.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $_cfg_admin;\n\n\t\/**\n\t * Store transients.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $_cfg_transients;\n\n\t\/**\n\t * Redis DB index.\n\t *\n\t * @var int\n\t *\/\n\tprivate $_cfg_db;\n\n\t\/**\n\t * Auth username.\n\t *\n\t * @var string\n\t *\/\n\tprivate $_cfg_user;\n\n\t\/**\n\t * Auth password.\n\t *\n\t * @var string\n\t *\/\n\tprivate $_cfg_pswd;\n\n\t\/**\n\t * Default TTL in seconds.\n\t *\n\t * @var int\n\t *\/\n\tprivate $_default_life = 360;\n\n\t\/**\n\t * 'Redis' or 'Memcached'.\n\t *\n\t * @var string\n\t *\/\n\tprivate $_oc_driver = 'Memcached'; \/\/ Redis or Memcached.\n\n\t\/**\n\t * Global groups.\n\t *\n\t * @var array\n\t *\/\n\tprivate $_global_groups = array();\n\n\t\/**\n\t * Non-persistent groups.\n\t *\n\t * @var array\n\t *\/\n\tprivate $_non_persistent_groups = array();\n\n\t\/**\n\t * Init.\n\t *\n\t * NOTE: this class may be included without initialized core.\n\t *\n\t * @since  1.8\n\t *\n\t * @param array|false $cfg Optional configuration to bootstrap without core.\n\t *\/\n\tpublic function __construct( $cfg = false ) {\n\t\tif ( $cfg ) {\n\t\t\tif ( ! is_array( $cfg[ Base::O_OBJECT_GLOBAL_GROUPS ] ) ) {\n\t\t\t\t$cfg[ Base::O_OBJECT_GLOBAL_GROUPS ] = explode( \"\\n\", $cfg[ Base::O_OBJECT_GLOBAL_GROUPS ] );\n\t\t\t}\n\t\t\tif ( ! is_array( $cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ] ) ) {\n\t\t\t\t$cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ] = explode( \"\\n\", $cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ] );\n\t\t\t}\n\t\t\t$this->_cfg_debug             = $cfg[ Base::O_DEBUG ] ? $cfg[ Base::O_DEBUG ] : false;\n\t\t\t$this->_cfg_method            = $cfg[ Base::O_OBJECT_KIND ] ? true : false;\n\t\t\t$this->_cfg_host              = $cfg[ Base::O_OBJECT_HOST ];\n\t\t\t$this->_cfg_port              = $cfg[ Base::O_OBJECT_PORT ];\n\t\t\t$this->_cfg_life              = $cfg[ Base::O_OBJECT_LIFE ];\n\t\t\t$this->_cfg_persistent        = $cfg[ Base::O_OBJECT_PERSISTENT ];\n\t\t\t$this->_cfg_admin             = $cfg[ Base::O_OBJECT_ADMIN ];\n\t\t\t$this->_cfg_transients        = $cfg[ Base::O_OBJECT_TRANSIENTS ];\n\t\t\t$this->_cfg_db                = $cfg[ Base::O_OBJECT_DB_ID ];\n\t\t\t$this->_cfg_user              = $cfg[ Base::O_OBJECT_USER ];\n\t\t\t$this->_cfg_pswd              = $cfg[ Base::O_OBJECT_PSWD ];\n\t\t\t$this->_global_groups         = $cfg[ Base::O_OBJECT_GLOBAL_GROUPS ];\n\t\t\t$this->_non_persistent_groups = $cfg[ Base::O_OBJECT_NON_PERSISTENT_GROUPS ];\n\n\t\t\tif ( $this->_cfg_method ) {\n\t\t\t\t$this->_oc_driver = 'Redis';\n\t\t\t}\n\t\t\t$this->_cfg_enabled = $cfg[ Base::O_OBJECT ] && class_exists( $this->_oc_driver ) && $this->_cfg_host;\n\t\t} elseif ( defined( 'LITESPEED_CONF_LOADED' ) ) { \/\/ If OC is OFF, will hit here to init OC after conf initialized\n\t\t\t$this->_cfg_debug             = $this->conf( Base::O_DEBUG ) ? $this->conf( Base::O_DEBUG ) : false;\n\t\t\t$this->_cfg_method            = $this->conf( Base::O_OBJECT_KIND ) ? true : false;\n\t\t\t$this->_cfg_host              = $this->conf( Base::O_OBJECT_HOST );\n\t\t\t$this->_cfg_port              = $this->conf( Base::O_OBJECT_PORT );\n\t\t\t$this->_cfg_life              = $this->conf( Base::O_OBJECT_LIFE );\n\t\t\t$this->_cfg_persistent        = $this->conf( Base::O_OBJECT_PERSISTENT );\n\t\t\t$this->_cfg_admin             = $this->conf( Base::O_OBJECT_ADMIN );\n\t\t\t$this->_cfg_transients        = $this->conf( Base::O_OBJECT_TRANSIENTS );\n\t\t\t$this->_cfg_db                = $this->conf( Base::O_OBJECT_DB_ID );\n\t\t\t$this->_cfg_user              = $this->conf( Base::O_OBJECT_USER );\n\t\t\t$this->_cfg_pswd              = $this->conf( Base::O_OBJECT_PSWD );\n\t\t\t$this->_global_groups         = $this->conf( Base::O_OBJECT_GLOBAL_GROUPS );\n\t\t\t$this->_non_persistent_groups = $this->conf( Base::O_OBJECT_NON_PERSISTENT_GROUPS );\n\n\t\t\tif ( $this->_cfg_method ) {\n\t\t\t\t$this->_oc_driver = 'Redis';\n\t\t\t}\n\t\t\t$this->_cfg_enabled = $this->conf( Base::O_OBJECT ) && class_exists( $this->_oc_driver ) && $this->_cfg_host;\n\t\t} elseif ( defined( 'self::CONF_FILE' ) && file_exists( WP_CONTENT_DIR . '\/' . self::CONF_FILE ) ) {\n\t\t\t\/\/ Get cfg from _data_file.\n\t\t\t\/\/ Use self::const to avoid loading more classes.\n\t\t\t$cfg = \\json_decode( file_get_contents( WP_CONTENT_DIR . '\/' . self::CONF_FILE ), true );\n\t\t\tif ( ! empty( $cfg[ self::O_OBJECT_HOST ] ) ) {\n\t\t\t\t$this->_cfg_debug             = ! empty( $cfg[ Base::O_DEBUG ] ) ? $cfg[ Base::O_DEBUG ] : false;\n\t\t\t\t$this->_cfg_method            = ! empty( $cfg[ self::O_OBJECT_KIND ] ) ? $cfg[ self::O_OBJECT_KIND ] : false;\n\t\t\t\t$this->_cfg_host              = $cfg[ self::O_OBJECT_HOST ];\n\t\t\t\t$this->_cfg_port              = $cfg[ self::O_OBJECT_PORT ];\n\t\t\t\t$this->_cfg_life              = ! empty( $cfg[ self::O_OBJECT_LIFE ] ) ? $cfg[ self::O_OBJECT_LIFE ] : $this->_default_life;\n\t\t\t\t$this->_cfg_persistent        = ! empty( $cfg[ self::O_OBJECT_PERSISTENT ] ) ? $cfg[ self::O_OBJECT_PERSISTENT ] : false;\n\t\t\t\t$this->_cfg_admin             = ! empty( $cfg[ self::O_OBJECT_ADMIN ] ) ? $cfg[ self::O_OBJECT_ADMIN ] : false;\n\t\t\t\t$this->_cfg_transients        = ! empty( $cfg[ self::O_OBJECT_TRANSIENTS ] ) ? $cfg[ self::O_OBJECT_TRANSIENTS ] : false;\n\t\t\t\t$this->_cfg_db                = ! empty( $cfg[ self::O_OBJECT_DB_ID ] ) ? $cfg[ self::O_OBJECT_DB_ID ] : 0;\n\t\t\t\t$this->_cfg_user              = ! empty( $cfg[ self::O_OBJECT_USER ] ) ? $cfg[ self::O_OBJECT_USER ] : '';\n\t\t\t\t$this->_cfg_pswd              = ! empty( $cfg[ self::O_OBJECT_PSWD ] ) ? $cfg[ self::O_OBJECT_PSWD ] : '';\n\t\t\t\t$this->_global_groups         = ! empty( $cfg[ self::O_OBJECT_GLOBAL_GROUPS ] ) ? $cfg[ self::O_OBJECT_GLOBAL_GROUPS ] : array();\n\t\t\t\t$this->_non_persistent_groups = ! empty( $cfg[ self::O_OBJECT_NON_PERSISTENT_GROUPS ] ) ? $cfg[ self::O_OBJECT_NON_PERSISTENT_GROUPS ] : array();\n\n\t\t\t\tif ( $this->_cfg_method ) {\n\t\t\t\t\t$this->_oc_driver = 'Redis';\n\t\t\t\t}\n\t\t\t\t$this->_cfg_enabled = class_exists( $this->_oc_driver ) && $this->_cfg_host;\n\t\t\t} else {\n\t\t\t\t$this->_cfg_enabled = false;\n\t\t\t}\n\t\t} else {\n\t\t\t$this->_cfg_enabled = false;\n\t\t}\n\t}\n\n\t\/**\n\t * Add debug.\n\t *\n\t * @since  6.3\n\t * @access private\n\t *\n\t * @param string $text Log text.\n\t * @return void\n\t *\/\n\tprivate function debug_oc( $text ) {\n\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\tself::debug( $text );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Base::VAL_ON2 !== $this->_cfg_debug ) {\n\t\t\treturn;\n\t\t}\n\n\t\t$litespeed_data_folder = defined( 'LITESPEED_DATA_FOLDER' ) ? LITESPEED_DATA_FOLDER : 'litespeed';\n\t\t$lscwp_content_dir     = defined( 'LSCWP_CONTENT_DIR' ) ? LSCWP_CONTENT_DIR : WP_CONTENT_DIR;\n\t\t$litespeed_static_dir  = $lscwp_content_dir . '\/' . $litespeed_data_folder;\n\t\t$log_path_prefix       = $litespeed_static_dir . '\/debug\/';\n\t\t$log_file              = $log_path_prefix . Debug2::FilePath( 'debug' );\n\n\t\tif ( file_exists( $log_path_prefix . 'index.php' ) && file_exists( $log_file ) ) {\n\t\t\t\/\/ phpcs:ignore WordPress.PHP.DevelopmentFunctions.error_log_error_log\n\t\t\terror_log(gmdate('m\/d\/y H:i:s') . ' - OC - ' . $text . PHP_EOL, 3, $log_file);\n\t\t}\n\t}\n\n\t\/**\n\t * Get `Store Transients` setting value.\n\t *\n\t * @since  1.8.3\n\t * @access public\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t *\/\n\tpublic function store_transients( $group ) {\n\t\treturn $this->_cfg_transients && $this->_is_transients_group( $group );\n\t}\n\n\t\/**\n\t * Check if the group belongs to transients or not.\n\t *\n\t * @since  1.8.3\n\t * @access private\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t *\/\n\tprivate function _is_transients_group( $group ) {\n\t\treturn in_array( $group, array( 'transient', 'site-transient' ), true );\n\t}\n\n\t\/**\n\t * Update WP object cache file config.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param array $options Options to apply after update.\n\t * @return void\n\t *\/\n\tpublic function update_file( $options ) {\n\t\t$changed = false;\n\n\t\t\/\/ NOTE: When included in oc.php, `LSCWP_DIR` will show undefined, so this must be assigned\/generated when used.\n\t\t$_oc_ori_file = LSCWP_DIR . 'lib\/object-cache.php';\n\t\t$_oc_wp_file  = WP_CONTENT_DIR . '\/object-cache.php';\n\n\t\t\/\/ Update cls file.\n\t\tif ( ! file_exists( $_oc_wp_file ) || md5_file( $_oc_wp_file ) !== md5_file( $_oc_ori_file ) ) {\n\t\t\t$this->debug_oc( 'copying object-cache.php file to ' . $_oc_wp_file );\n\t\t\tcopy( $_oc_ori_file, $_oc_wp_file );\n\t\t\t$changed = true;\n\t\t}\n\n\t\t\/**\n\t\t * Clear object cache.\n\t\t *\/\n\t\tif ( $changed ) {\n\t\t\t$this->_reconnect( $options );\n\t\t}\n\t}\n\n\t\/**\n\t * Remove object cache file.\n\t *\n\t * @since  1.8.2\n\t * @access public\n\t *\n\t * @return void\n\t *\/\n\tpublic function del_file() {\n\t\t\/\/ NOTE: When included in oc.php, `LSCWP_DIR` will show undefined, so this must be assigned\/generated when used.\n\t\t$_oc_ori_file = LSCWP_DIR . 'lib\/object-cache.php';\n\t\t$_oc_wp_file  = WP_CONTENT_DIR . '\/object-cache.php';\n\n\t\tif ( file_exists( $_oc_wp_file ) && md5_file( $_oc_wp_file ) === md5_file( $_oc_ori_file ) ) {\n\t\t\t$this->debug_oc( 'removing ' . $_oc_wp_file );\n\t\t\twp_delete_file( $_oc_wp_file );\n\t\t}\n\t}\n\n\t\/**\n\t * Try to build connection.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @return bool|null False on failure, true on success, null if unsupported.\n\t *\/\n\tpublic function test_connection() {\n\t\treturn $this->_connect();\n\t}\n\n\t\/**\n\t * Force to connect with this setting.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @param array $cfg Reconnect configuration.\n\t * @return void\n\t *\/\n\tprivate function _reconnect( $cfg ) {\n\t\t$this->debug_oc( 'Reconnecting' );\n\t\tif ( isset( $this->_conn ) ) {\n\t\t\t\/\/ error_log( 'Object: Quitting existing connection!' );\n\t\t\t$this->debug_oc( 'Quitting existing connection' );\n\t\t\t$this->flush();\n\t\t\t$this->_conn = null;\n\t\t\t$this->cls( false, true );\n\t\t}\n\n\t\t$cls = $this->cls( false, false, $cfg );\n\t\t$cls->_connect();\n\t\tif ( isset( $cls->_conn ) ) {\n\t\t\t$cls->flush();\n\t\t}\n\t}\n\n\t\/**\n\t * Connect to Memcached\/Redis server.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return bool|null False on failure, true on success, null if driver missing.\n\t *\/\n\tprivate function _connect() {\n\t\tif ( isset( $this->_conn ) ) {\n\t\t\t\/\/ error_log( 'Object: _connected' );\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( ! class_exists( $this->_oc_driver ) || ! $this->_cfg_host ) {\n\t\t\t$this->debug_oc( '_oc_driver cls non existed or _cfg_host missed: ' . $this->_oc_driver . ' [_cfg_host] ' . $this->_cfg_host . ':' . $this->_cfg_port );\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_OC_FAILURE' ) ) {\n\t\t\t$this->debug_oc( 'LITESPEED_OC_FAILURE const defined' );\n\t\t\treturn false;\n\t\t}\n\n\t\t$this->debug_oc( 'Init ' . $this->_oc_driver . ' connection to ' . $this->_cfg_host . ':' . $this->_cfg_port );\n\n\t\t$failed = false;\n\n\t\t\/**\n\t\t * Connect to Redis.\n\t\t *\n\t\t * @since  1.8.1\n\t\t * @see https:\/\/github.com\/phpredis\/phpredis\/#example-1\n\t\t *\/\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\t\/\/ phpcs:ignore WordPress.PHP.DevelopmentFunctions.error_log_set_error_handler\n\t\t\tset_error_handler( 'litespeed_exception_handler' );\n\t\t\ttry {\n\t\t\t\t$this->_conn = new \\Redis();\n\t\t\t\t\/\/ error_log( 'Object: _connect Redis' );\n\n\t\t\t\tif ( $this->_cfg_persistent ) {\n\t\t\t\t\tif ( $this->_cfg_port ) {\n\t\t\t\t\t\t$this->_conn->pconnect( $this->_cfg_host, $this->_cfg_port );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this->_conn->pconnect( $this->_cfg_host );\n\t\t\t\t\t}\n\t\t\t\t} elseif ( $this->_cfg_port ) {\n\t\t\t\t\t$this->_conn->connect( $this->_cfg_host, $this->_cfg_port );\n\t\t\t\t} else {\n\t\t\t\t\t$this->_conn->connect( $this->_cfg_host );\n\t\t\t\t}\n\n\t\t\t\tif ( $this->_cfg_pswd ) {\n\t\t\t\t\tif ( $this->_cfg_user ) {\n\t\t\t\t\t\t$this->_conn->auth( array( $this->_cfg_user, $this->_cfg_pswd ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this->_conn->auth( $this->_cfg_pswd );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (defined('Redis::OPT_REPLY_LITERAL')) {\n\t\t\t\t\t$this->debug_oc( 'Redis set OPT_REPLY_LITERAL' );\n\t\t\t\t\t$this->_conn->setOption(\\Redis::OPT_REPLY_LITERAL, true);\n\t\t\t\t}\n\n\t\t\t\tif ( $this->_cfg_db ) {\n\t\t\t\t\t$this->_conn->select( $this->_cfg_db );\n\t\t\t\t}\n\n\t\t\t\t$res = $this->_conn->rawCommand('PING');\n\n\t\t\t\tif ( 'PONG' !== $res ) {\n\t\t\t\t\t$this->debug_oc( 'Redis resp is wrong: ' . $res );\n\t\t\t\t\t$failed = true;\n\t\t\t\t}\n\t\t\t} catch ( \\Exception $e ) {\n\t\t\t\t$this->debug_oc( 'Redis connect exception: ' . $e->getMessage() );\n\t\t\t\t$failed = true;\n\t\t\t} catch ( \\ErrorException $e ) {\n\t\t\t\t$this->debug_oc( 'Redis connect error: ' . $e->getMessage() );\n\t\t\t\t$failed = true;\n\t\t\t}\n\t\t\trestore_error_handler();\n\t\t} else {\n\t\t\t\/\/ Connect to Memcached.\n\t\t\tif ( $this->_cfg_persistent ) {\n\t\t\t\t$this->_conn = new \\Memcached( $this->_get_mem_id() );\n\n\t\t\t\t\/\/ Check memcached persistent connection.\n\t\t\t\tif ( $this->_validate_mem_server() ) {\n\t\t\t\t\t\/\/ error_log( 'Object: _validate_mem_server' );\n\t\t\t\t\t$this->debug_oc( 'Got persistent ' . $this->_oc_driver . ' connection' );\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t$this->debug_oc( 'No persistent ' . $this->_oc_driver . ' server list!' );\n\t\t\t} else {\n\t\t\t\t\/\/ error_log( 'Object: new memcached!' );\n\t\t\t\t$this->_conn = new \\Memcached();\n\t\t\t}\n\n\t\t\t$this->_conn->addServer( $this->_cfg_host, (int) $this->_cfg_port );\n\n\t\t\t\/**\n\t\t\t * Add SASL auth.\n\t\t\t *\n\t\t\t * @since  1.8.1\n\t\t\t * @since  2.9.6 Fixed SASL connection @see https:\/\/www.litespeedtech.com\/support\/wiki\/doku.php\/litespeed_wiki:lsmcd:new_sasl\n\t\t\t *\/\n\t\t\tif ( $this->_cfg_user && $this->_cfg_pswd && method_exists( $this->_conn, 'setSaslAuthData' ) ) {\n\t\t\t\t$this->_conn->setOption( \\Memcached::OPT_BINARY_PROTOCOL, true );\n\t\t\t\t$this->_conn->setOption( \\Memcached::OPT_COMPRESSION, false );\n\t\t\t\t$this->_conn->setSaslAuthData( $this->_cfg_user, $this->_cfg_pswd );\n\t\t\t}\n\n\t\t\t\/\/ Check connection.\n\t\t\tif ( ! $this->_validate_mem_server() ) {\n\t\t\t\t$failed = true;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ If failed to connect.\n\t\tif ( $failed ) {\n\t\t\t$this->debug_oc( '\u274c Failed to connect ' . $this->_oc_driver . ' server!' );\n\t\t\t$this->_conn        = null;\n\t\t\t$this->_cfg_enabled = false;\n\t\t\t! defined( 'LITESPEED_OC_FAILURE' ) && define( 'LITESPEED_OC_FAILURE', true );\n\t\t\t\/\/ error_log( 'Object: false!' );\n\t\t\treturn false;\n\t\t}\n\n\t\t$this->debug_oc( '\u2705 Connected to ' . $this->_oc_driver . ' server.' );\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Check if the connected memcached host is the one in cfg.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return bool\n\t *\/\n\tprivate function _validate_mem_server() {\n\t\t$mem_list = $this->_conn->getStats();\n\t\tif ( empty( $mem_list ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tforeach ( $mem_list as $k => $v ) {\n\t\t\tif ( substr( $k, 0, strlen( $this->_cfg_host ) ) !== $this->_cfg_host ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif ( ! empty( $v['pid'] ) || ! empty( $v['curr_connections'] ) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Get memcached unique id to be used for connecting.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return string\n\t *\/\n\tprivate function _get_mem_id() {\n\t\t$mem_id = 'litespeed';\n\t\tif ( is_multisite() ) {\n\t\t\t$mem_id .= '_' . get_current_blog_id();\n\t\t}\n\n\t\treturn $mem_id;\n\t}\n\n\t\/**\n\t * Get cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param string $key Cache key.\n\t * @return mixed|null\n\t *\/\n\tpublic function get( $key ) {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_can_cache() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t$res = $this->_conn->get( $key );\n\n\t\treturn $res;\n\t}\n\n\t\/**\n\t * Set cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param string $key    Cache key.\n\t * @param mixed  $data   Data to store.\n\t * @param int    $expire TTL seconds.\n\t * @return bool|null\n\t *\/\n\tpublic function set( $key, $data, $expire ) {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t\/**\n\t\t * To fix the Cloud callback cached as its frontend call but the hash is generated in backend\n\t\t * Bug found by Stan at Jan\/10\/2020\n\t\t *\/\n\t\t\/\/ if ( ! $this->_can_cache() ) {\n\t\t\/\/ return null;\n\t\t\/\/ }\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t$ttl = $expire ? $expire : $this->_cfg_life;\n\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\ttry {\n\t\t\t\t$res = $this->_conn->setEx( $key, $ttl, $data );\n\t\t\t} catch ( \\RedisException $ex ) {\n\t\t\t\t$res = false;\n\t\t\t\t$msg = sprintf( __( 'Redis encountered a fatal error: %1$s (code: %2$d)', 'litespeed-cache' ), $ex->getMessage(), $ex->getCode() );\n\t\t\t\t$this->debug_oc( $msg );\n\t\t\t\tAdmin_Display::error( $msg );\n\t\t\t}\n\t\t} else {\n\t\t\t$res = $this->_conn->set( $key, $data, $ttl );\n\t\t}\n\n\t\treturn $res;\n\t}\n\n\t\/**\n\t * Check if can cache or not.\n\t *\n\t * @since  1.8\n\t * @access private\n\t *\n\t * @return bool\n\t *\/\n\tprivate function _can_cache() {\n\t\tif ( ! $this->_cfg_admin && defined( 'WP_ADMIN' ) ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Delete cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @param string $key Cache key.\n\t * @return bool|null\n\t *\/\n\tpublic function delete( $key ) {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\t$res = $this->_conn->del( $key );\n\t\t} else {\n\t\t\t$res = $this->_conn->delete( $key );\n\t\t}\n\n\t\treturn (bool) $res;\n\t}\n\n\t\/**\n\t * Clear all cache.\n\t *\n\t * @since  1.8\n\t * @access public\n\t *\n\t * @return bool|null\n\t *\/\n\tpublic function flush() {\n\t\tif ( ! $this->_cfg_enabled ) {\n\t\t\t$this->debug_oc( 'bypass flushing' );\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! $this->_connect() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t$this->debug_oc( 'flush!' );\n\n\t\tif ( 'Redis' === $this->_oc_driver ) {\n\t\t\t$res = $this->_conn->flushDb();\n\t\t} else {\n\t\t\t$res = $this->_conn->flush();\n\t\t\t$this->_conn->resetServerList();\n\t\t}\n\n\t\treturn $res;\n\t}\n\n\t\/**\n\t * Add global groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups Group(s) to add.\n\t * @return void\n\t *\/\n\tpublic function add_global_groups( $groups ) {\n\t\tif ( ! is_array( $groups ) ) {\n\t\t\t$groups = array( $groups );\n\t\t}\n\n\t\t$this->_global_groups = array_merge( $this->_global_groups, $groups );\n\t\t$this->_global_groups = array_unique( $this->_global_groups );\n\t}\n\n\t\/**\n\t * Check if is in global groups or not.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t *\/\n\tpublic function is_global( $group ) {\n\t\treturn in_array( $group, $this->_global_groups, true );\n\t}\n\n\t\/**\n\t * Add non persistent groups.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string|string[] $groups Group(s) to add.\n\t * @return void\n\t *\/\n\tpublic function add_non_persistent_groups( $groups ) {\n\t\tif ( ! is_array( $groups ) ) {\n\t\t\t$groups = array( $groups );\n\t\t}\n\n\t\t$this->_non_persistent_groups = array_merge( $this->_non_persistent_groups, $groups );\n\t\t$this->_non_persistent_groups = array_unique( $this->_non_persistent_groups );\n\t}\n\n\t\/**\n\t * Check if is in non persistent groups or not.\n\t *\n\t * @since 1.8\n\t * @access public\n\t *\n\t * @param string $group Group name.\n\t * @return bool\n\t *\/\n\tpublic function is_non_persistent( $group ) {\n\t\treturn in_array( $group, $this->_non_persistent_groups, true );\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/cdn\/quic.cls.php","ext":"php","size":3090,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The quic.cloud class.\n *\n * @since       2.4.1\n * @package     LiteSpeed\n * @subpackage  LiteSpeed\/src\/cdn\n *\/\n\nnamespace LiteSpeed\\CDN;\n\nuse LiteSpeed\\Cloud;\nuse LiteSpeed\\Base;\n\ndefined('WPINC') || exit();\n\n\/**\n * Class Quic\n *\n * Handles Quic.cloud CDN integration.\n *\n * @since 2.4.1\n *\/\nclass Quic extends Base {\n\tconst LOG_TAG  = '\u2601\ufe0f';\n\tconst TYPE_REG = 'reg';\n\n\t\/**\n\t * Force sync flag.\n\t *\n\t * @var bool\n\t *\/\n\tprivate $force = false;\n\n\t\/**\n\t * Notify CDN new config updated\n\t *\n\t * Syncs configuration with Quic.cloud CDN.\n\t *\n\t * @since 2.4.1\n\t * @access public\n\t * @param bool $force Whether to force sync.\n\t * @return bool|void\n\t *\/\n\tpublic function try_sync_conf( $force = false ) {\n\t\t$cloud_summary = Cloud::get_summary();\n\t\tif ($force) {\n\t\t\t$this->force = $force;\n\t\t}\n\n\t\tif (!$this->conf(self::O_CDN_QUIC)) {\n\t\t\tif (!empty($cloud_summary['conf_md5'])) {\n\t\t\t\tself::debug('\u274c No QC CDN, clear conf md5!');\n\t\t\t\tCloud::save_summary(array( 'conf_md5' => '' ));\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Notice: Sync conf must be after `wp_loaded` hook, to get 3rd party vary injected (e.g. `woocommerce_cart_hash`).\n\t\tif (!did_action('wp_loaded')) {\n\t\t\tadd_action('wp_loaded', array( $this, 'try_sync_conf' ), 999);\n\t\t\tself::debug('WP not loaded yet, delay sync to wp_loaded:999');\n\t\t\treturn;\n\t\t}\n\n\t\t$options                = $this->get_options();\n\t\t$options['_tp_cookies'] = apply_filters('litespeed_vary_cookies', array());\n\n\t\t\/\/ Build necessary options only\n\t\t$options_needed  = array(\n\t\t\tself::O_CACHE_DROP_QS,\n\t\t\tself::O_CACHE_EXC_COOKIES,\n\t\t\tself::O_CACHE_EXC_USERAGENTS,\n\t\t\tself::O_CACHE_LOGIN_COOKIE,\n\t\t\tself::O_CACHE_VARY_COOKIES,\n\t\t\tself::O_CACHE_MOBILE_RULES,\n\t\t\tself::O_CACHE_MOBILE,\n\t\t\tself::O_CACHE_BROWSER,\n\t\t\tself::O_CACHE_TTL_BROWSER,\n\t\t\tself::O_IMG_OPTM_WEBP,\n\t\t\tself::O_GUEST,\n\t\t\t'_tp_cookies',\n\t\t);\n\t\t$consts_needed   = array( 'LSWCP_TAG_PREFIX' );\n\t\t$options_for_md5 = array();\n\t\tforeach ($options_needed as $v) {\n\t\t\tif (isset($options[$v])) {\n\t\t\t\t$options_for_md5[$v] = $options[$v];\n\t\t\t\t\/\/ Remove overflow multi lines fields\n\t\t\t\tif (is_array($options_for_md5[$v]) && count($options_for_md5[$v]) > 30) {\n\t\t\t\t\t$options_for_md5[$v] = array_slice($options_for_md5[$v], 0, 30);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t$server_vars = $this->server_vars();\n\t\tforeach ($consts_needed as $v) {\n\t\t\tif (isset($server_vars[$v])) {\n\t\t\t\tif (empty($options_for_md5['_server'])) {\n\t\t\t\t\t$options_for_md5['_server'] = array();\n\t\t\t\t}\n\t\t\t\t$options_for_md5['_server'][$v] = $server_vars[$v];\n\t\t\t}\n\t\t}\n\n\t\t$conf_md5 = md5(wp_json_encode($options_for_md5));\n\t\tif (!empty($cloud_summary['conf_md5'])) {\n\t\t\tif ($conf_md5 === $cloud_summary['conf_md5']) {\n\t\t\t\tif (!$this->force) {\n\t\t\t\t\tself::debug('Bypass sync conf to QC due to same md5', $conf_md5);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tself::debug('!!!Force sync conf even same md5');\n\t\t\t} else {\n\t\t\t\tself::debug('[conf_md5] ' . $conf_md5 . ' [existing_conf_md5] ' . $cloud_summary['conf_md5']);\n\t\t\t}\n\t\t}\n\n\t\tCloud::save_summary(array( 'conf_md5' => $conf_md5 ));\n\t\tself::debug('sync conf to QC');\n\n\t\tCloud::post(Cloud::SVC_D_SYNC_CONF, $options_for_md5);\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/cdn\/cloudflare.cls.php","ext":"php","size":8086,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * The cloudflare CDN class.\n *\n * @since       2.1\n * @package     LiteSpeed\n * @subpackage  LiteSpeed\/src\/cdn\n * @author      LiteSpeed Technologies <info@litespeedtech.com>\n *\/\n\nnamespace LiteSpeed\\CDN;\n\nuse LiteSpeed\\Base;\nuse LiteSpeed\\Debug2;\nuse LiteSpeed\\Router;\nuse LiteSpeed\\Admin;\nuse LiteSpeed\\Admin_Display;\n\ndefined('WPINC') || exit();\n\n\/**\n * Class Cloudflare\n *\n * @since 2.1\n *\/\nclass Cloudflare extends Base {\n\n\tconst TYPE_PURGE_ALL       = 'purge_all';\n\tconst TYPE_GET_DEVMODE     = 'get_devmode';\n\tconst TYPE_SET_DEVMODE_ON  = 'set_devmode_on';\n\tconst TYPE_SET_DEVMODE_OFF = 'set_devmode_off';\n\n\tconst ITEM_STATUS = 'status';\n\n\t\/**\n\t * Update zone&name based on latest settings\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function try_refresh_zone() {\n\t\tif (!$this->conf(self::O_CDN_CLOUDFLARE)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$zone = $this->fetch_zone();\n\t\tif ($zone) {\n\t\t\t$this->cls('Conf')->update(self::O_CDN_CLOUDFLARE_NAME, $zone['name']);\n\n\t\t\t$this->cls('Conf')->update(self::O_CDN_CLOUDFLARE_ZONE, $zone['id']);\n\n\t\t\tDebug2::debug(\"[Cloudflare] Get zone successfully \\t\\t[ID] \" . $zone['id']);\n\t\t} else {\n\t\t\t$this->cls('Conf')->update(self::O_CDN_CLOUDFLARE_ZONE, '');\n\t\t\tDebug2::debug('[Cloudflare] \u274c Get zone failed, clean zone');\n\t\t}\n\t}\n\n\t\/**\n\t * Get Cloudflare development mode\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t * @param bool $show_msg Whether to show success\/error message.\n\t *\/\n\tprivate function get_devmode( $show_msg = true ) {\n\t\tDebug2::debug('[Cloudflare] get_devmode');\n\n\t\t$zone = $this->zone();\n\t\tif (!$zone) {\n\t\t\treturn;\n\t\t}\n\n\t\t$url = 'https:\/\/api.cloudflare.com\/client\/v4\/zones\/' . $zone . '\/settings\/development_mode';\n\t\t$res = $this->cloudflare_call($url, 'GET', false, $show_msg);\n\n\t\tif (!$res) {\n\t\t\treturn;\n\t\t}\n\t\tDebug2::debug('[Cloudflare] get_devmode result ', $res);\n\n\t\t\/\/ Make sure is array: #992174\n\t\t$curr_status = self::get_option(self::ITEM_STATUS, array());\n\t\tif ( ! is_array( $curr_status ) ) {\n\t\t\t$curr_status = array();\n\t\t}\n\t\t$curr_status['devmode']         = $res['value'];\n\t\t$curr_status['devmode_expired'] = $res['time_remaining'] + time();\n\n\t\t\/\/ update status\n\t\tself::update_option(self::ITEM_STATUS, $curr_status);\n\t}\n\n\t\/**\n\t * Set Cloudflare development mode\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t * @param string $type The type of development mode to set (on\/off).\n\t *\/\n\tprivate function set_devmode( $type ) {\n\t\tDebug2::debug('[Cloudflare] set_devmode');\n\n\t\t$zone = $this->zone();\n\t\tif (!$zone) {\n\t\t\treturn;\n\t\t}\n\n\t\t$url     = 'https:\/\/api.cloudflare.com\/client\/v4\/zones\/' . $zone . '\/settings\/development_mode';\n\t\t$new_val = self::TYPE_SET_DEVMODE_ON === $type ? 'on' : 'off';\n\t\t$data    = array( 'value' => $new_val );\n\t\t$res     = $this->cloudflare_call($url, 'PATCH', $data);\n\n\t\tif (!$res) {\n\t\t\treturn;\n\t\t}\n\n\t\t$res = $this->get_devmode(false);\n\n\t\tif ($res) {\n\t\t\t$msg = sprintf(__('Notified Cloudflare to set development mode to %s successfully.', 'litespeed-cache'), strtoupper($new_val));\n\t\t\tAdmin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Shortcut to purge Cloudflare\n\t *\n\t * @since  7.1\n\t * @access public\n\t * @param string|bool $reason The reason for purging, or false if none.\n\t *\/\n\tpublic static function purge_all( $reason = false ) {\n\t\tif ($reason) {\n\t\t\tDebug2::debug('[Cloudflare] purge call because: ' . $reason);\n\t\t}\n\t\tself::cls()->purge_all_private();\n\t}\n\n\t\/**\n\t * Purge Cloudflare cache\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t *\/\n\tprivate function purge_all_private() {\n\t\tDebug2::debug('[Cloudflare] purge_all_private');\n\n\t\t$cf_on = $this->conf(self::O_CDN_CLOUDFLARE);\n\t\tif (!$cf_on) {\n\t\t\t$msg = __('Cloudflare API is set to off.', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn;\n\t\t}\n\n\t\t$zone = $this->zone();\n\t\tif (!$zone) {\n\t\t\treturn;\n\t\t}\n\n\t\t$url  = 'https:\/\/api.cloudflare.com\/client\/v4\/zones\/' . $zone . '\/purge_cache';\n\t\t$data = array( 'purge_everything' => true );\n\n\t\t$res = $this->cloudflare_call($url, 'DELETE', $data);\n\n\t\tif ($res) {\n\t\t\t$msg = __('Notified Cloudflare to purge all successfully.', 'litespeed-cache');\n\t\t\tAdmin_Display::success($msg);\n\t\t}\n\t}\n\n\t\/**\n\t * Get current Cloudflare zone from cfg\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t *\/\n\tprivate function zone() {\n\t\t$zone = $this->conf(self::O_CDN_CLOUDFLARE_ZONE);\n\t\tif (!$zone) {\n\t\t\t$msg = __('No available Cloudflare zone', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $zone;\n\t}\n\n\t\/**\n\t * Get Cloudflare zone settings\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t *\/\n\tprivate function fetch_zone() {\n\t\t$kw = $this->conf(self::O_CDN_CLOUDFLARE_NAME);\n\n\t\t$url = 'https:\/\/api.cloudflare.com\/client\/v4\/zones?status=active&match=all';\n\n\t\t\/\/ Try exact match first\n\t\tif ($kw && false !== strpos($kw, '.')) {\n\t\t\t$zones = $this->cloudflare_call($url . '&name=' . $kw, 'GET', false, false);\n\t\t\tif ($zones) {\n\t\t\t\tDebug2::debug('[Cloudflare] fetch_zone exact matched');\n\t\t\t\treturn $zones[0];\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Can't find, try to get default one\n\t\t$zones = $this->cloudflare_call($url, 'GET', false, false);\n\n\t\tif (!$zones) {\n\t\t\tDebug2::debug('[Cloudflare] fetch_zone no zone');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$kw) {\n\t\t\tDebug2::debug('[Cloudflare] fetch_zone no set name, use first one by default');\n\t\t\treturn $zones[0];\n\t\t}\n\n\t\tforeach ($zones as $v) {\n\t\t\tif (false !== strpos($v['name'], $kw)) {\n\t\t\t\tDebug2::debug('[Cloudflare] fetch_zone matched ' . $kw . ' [name] ' . $v['name']);\n\t\t\t\treturn $v;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Can't match current name, return default one\n\t\tDebug2::debug('[Cloudflare] fetch_zone failed match name, use first one by default');\n\t\treturn $zones[0];\n\t}\n\n\t\/**\n\t * Cloudflare API\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t * @param string     $url      The API URL to call.\n\t * @param string     $method   The HTTP method to use (GET, POST, etc.).\n\t * @param array|bool $data     The data to send with the request, or false if none.\n\t * @param bool       $show_msg Whether to show success\/error message.\n\t *\/\n\tprivate function cloudflare_call( $url, $method = 'GET', $data = false, $show_msg = true ) {\n\t\tDebug2::debug(\"[Cloudflare] cloudflare_call \\t\\t[URL] $url\");\n\n\t\tif (strlen($this->conf(self::O_CDN_CLOUDFLARE_KEY)) === 40) {\n\t\t\t$headers = array(\n\t\t\t\t'Content-Type'  => 'application\/json',\n\t\t\t\t'Authorization' => 'Bearer ' . $this->conf(self::O_CDN_CLOUDFLARE_KEY),\n\t\t\t);\n\t\t} else {\n\t\t\t$headers = array(\n\t\t\t\t'Content-Type'  => 'application\/json',\n\t\t\t\t'X-Auth-Email' => $this->conf(self::O_CDN_CLOUDFLARE_EMAIL),\n\t\t\t\t'X-Auth-Key'   => $this->conf(self::O_CDN_CLOUDFLARE_KEY),\n\t\t\t);\n\t\t}\n\n\t\t$wp_args = array(\n\t\t\t'method'  => $method,\n\t\t\t'headers' => $headers,\n\t\t);\n\n\t\tif ($data) {\n\t\t\tif (is_array($data)) {\n\t\t\t\t$data = wp_json_encode($data);\n\t\t\t}\n\t\t\t$wp_args['body'] = $data;\n\t\t}\n\t\t$resp = wp_remote_request($url, $wp_args);\n\t\tif (is_wp_error($resp)) {\n\t\t\tDebug2::debug('[Cloudflare] error in response');\n\t\t\tif ($show_msg) {\n\t\t\t\t$msg = __('Failed to communicate with Cloudflare', 'litespeed-cache');\n\t\t\t\tAdmin_Display::error($msg);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\t$result = wp_remote_retrieve_body($resp);\n\n\t\t$json = \\json_decode($result, true);\n\n\t\tif ($json && $json['success'] && $json['result']) {\n\t\t\tDebug2::debug('[Cloudflare] cloudflare_call called successfully');\n\t\t\tif ($show_msg) {\n\t\t\t\t$msg = __('Communicated with Cloudflare successfully.', 'litespeed-cache');\n\t\t\t\tAdmin_Display::success($msg);\n\t\t\t}\n\n\t\t\treturn $json['result'];\n\t\t}\n\n\t\tDebug2::debug(\"[Cloudflare] cloudflare_call called failed: $result\");\n\t\tif ($show_msg) {\n\t\t\t$msg = __('Failed to communicate with Cloudflare', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  1.7.2\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_PURGE_ALL:\n\t\t\t\t$this->purge_all_private();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_GET_DEVMODE:\n\t\t\t\t$this->get_devmode();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_SET_DEVMODE_ON:\n\t\t\tcase self::TYPE_SET_DEVMODE_OFF:\n\t\t\t\t$this->set_devmode($type);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/lang.cls.php","ext":"php","size":15280,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The language class.\n *\n * @since       3.0\n * @package     LiteSpeed_Cache\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Lang extends Base {\n\n\t\/**\n\t * Get image status per status bit\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic static function img_status( $status = null ) {\n\t\t$list = array(\n\t\t\tImg_Optm::STATUS_NEW => __('Images not requested', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_RAW => __('Images ready to request', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_REQUESTED => __('Images requested', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_NOTIFIED => __('Images notified to pull', 'litespeed-cache'),\n\t\t\tImg_Optm::STATUS_PULLED => __('Images optimized and pulled', 'litespeed-cache'),\n\t\t);\n\n\t\tif ($status !== null) {\n\t\t\treturn !empty($list[$status]) ? $list[$status] : 'N\/A';\n\t\t}\n\n\t\treturn $list;\n\t}\n\n\t\/**\n\t * Try translating a string\n\t *\n\t * @since  4.7\n\t *\/\n\tpublic static function maybe_translate( $raw_string ) {\n\t\t$map = array(\n\t\t\t'auto_alias_failed_cdn' =>\n\t\t\t\t__('Unable to automatically add %1$s as a Domain Alias for main %2$s domain, due to potential CDN conflict.', 'litespeed-cache') .\n\t\t\t\t' ' .\n\t\t\t\tDoc::learn_more('https:\/\/quic.cloud\/docs\/cdn\/dns\/how-to-setup-domain-alias\/', false, false, false, true),\n\n\t\t\t'auto_alias_failed_uid' =>\n\t\t\t\t__('Unable to automatically add %1$s as a Domain Alias for main %2$s domain.', 'litespeed-cache') .\n\t\t\t\t' ' .\n\t\t\t\t__('Alias is in use by another QUIC.cloud account.', 'litespeed-cache') .\n\t\t\t\t' ' .\n\t\t\t\tDoc::learn_more('https:\/\/quic.cloud\/docs\/cdn\/dns\/how-to-setup-domain-alias\/', false, false, false, true),\n\t\t);\n\n\t\t\/\/ Maybe has placeholder\n\t\tif (strpos($raw_string, '::')) {\n\t\t\t$replacements = explode('::', $raw_string);\n\t\t\tif (empty($map[$replacements[0]])) {\n\t\t\t\treturn $raw_string;\n\t\t\t}\n\t\t\t$tpl = $map[$replacements[0]];\n\t\t\tunset($replacements[0]);\n\t\t\treturn vsprintf($tpl, array_values($replacements));\n\t\t}\n\n\t\t\/\/ Direct translation only\n\t\tif (empty($map[$raw_string])) {\n\t\t\treturn $raw_string;\n\t\t}\n\n\t\treturn $map[$raw_string];\n\t}\n\n\t\/**\n\t * Get the title of id\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic static function title( $id ) {\n\t\t$_lang_list = array(\n\t\t\tself::O_SERVER_IP => __('Server IP', 'litespeed-cache'),\n\t\t\tself::O_GUEST_UAS => __('Guest Mode User Agents', 'litespeed-cache'),\n\t\t\tself::O_GUEST_IPS => __('Guest Mode IPs', 'litespeed-cache'),\n\n\t\t\tself::O_CACHE => __('Enable Cache', 'litespeed-cache'),\n\t\t\tself::O_CACHE_BROWSER => __('Browser Cache', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_PUB => __('Default Public Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_PRIV => __('Default Private Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_FRONTPAGE => __('Default Front Page TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_FEED => __('Default Feed TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_REST => __('Default REST TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_STATUS => __('Default HTTP Status Code Page TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_TTL_BROWSER => __('Browser Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_CACHE_AJAX_TTL => __('AJAX Cache TTL', 'litespeed-cache'),\n\t\t\tself::O_AUTO_UPGRADE => __('Automatically Upgrade', 'litespeed-cache'),\n\t\t\tself::O_GUEST => __('Guest Mode', 'litespeed-cache'),\n\t\t\tself::O_GUEST_OPTM => __('Guest Optimization', 'litespeed-cache'),\n\t\t\tself::O_NEWS => __('Notifications', 'litespeed-cache'),\n\t\t\tself::O_CACHE_PRIV => __('Cache Logged-in Users', 'litespeed-cache'),\n\t\t\tself::O_CACHE_COMMENTER => __('Cache Commenters', 'litespeed-cache'),\n\t\t\tself::O_CACHE_REST => __('Cache REST API', 'litespeed-cache'),\n\t\t\tself::O_CACHE_PAGE_LOGIN => __('Cache Login Page', 'litespeed-cache'),\n\t\t\tself::O_CACHE_MOBILE => __('Cache Mobile', 'litespeed-cache'),\n\t\t\tself::O_CACHE_MOBILE_RULES => __('List of Mobile User Agents', 'litespeed-cache'),\n\t\t\tself::O_CACHE_PRIV_URI => __('Private Cached URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_DROP_QS => __('Drop Query String', 'litespeed-cache'),\n\n\t\t\tself::O_OBJECT => __('Object Cache', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_KIND => __('Method', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_HOST => __('Host', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_PORT => __('Port', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_LIFE => __('Default Object Lifetime', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_USER => __('Username', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_PSWD => __('Password', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_DB_ID => __('Redis Database ID', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_GLOBAL_GROUPS => __('Global Groups', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_NON_PERSISTENT_GROUPS => __('Do Not Cache Groups', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_PERSISTENT => __('Persistent Connection', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_ADMIN => __('Cache WP-Admin', 'litespeed-cache'),\n\t\t\tself::O_OBJECT_TRANSIENTS => __('Store Transients', 'litespeed-cache'),\n\n\t\t\tself::O_PURGE_ON_UPGRADE => __('Purge All On Upgrade', 'litespeed-cache'),\n\t\t\tself::O_PURGE_STALE => __('Serve Stale', 'litespeed-cache'),\n\t\t\tself::O_PURGE_TIMED_URLS => __('Scheduled Purge URLs', 'litespeed-cache'),\n\t\t\tself::O_PURGE_TIMED_URLS_TIME => __('Scheduled Purge Time', 'litespeed-cache'),\n\t\t\tself::O_CACHE_FORCE_URI => __('Force Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_FORCE_PUB_URI => __('Force Public Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC => __('Do Not Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_QS => __('Do Not Cache Query Strings', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_CAT => __('Do Not Cache Categories', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_TAG => __('Do Not Cache Tags', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_ROLES => __('Do Not Cache Roles', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_MIN => __('CSS Minify', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_COMB => __('CSS Combine', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_COMB_EXT_INL => __('CSS Combine External and Inline', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS => __('Generate UCSS', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_INLINE => __('UCSS Inline', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_SELECTOR_WHITELIST => __('UCSS Selector Allowlist', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_FILE_EXC_INLINE => __('UCSS Inline Excluded Files', 'litespeed-cache'),\n\t\t\tself::O_OPTM_UCSS_EXC => __('UCSS URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_MIN => __('JS Minify', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_COMB => __('JS Combine', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_COMB_EXT_INL => __('JS Combine External and Inline', 'litespeed-cache'),\n\t\t\tself::O_OPTM_HTML_MIN => __('HTML Minify', 'litespeed-cache'),\n\t\t\tself::O_OPTM_HTML_LAZY => __('HTML Lazy Load Selectors', 'litespeed-cache'),\n\t\t\tself::O_OPTM_HTML_SKIP_COMMENTS => __('HTML Keep Comments', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_ASYNC => __('Load CSS Asynchronously', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_PER_URL => __('CCSS Per URL', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_ASYNC_INLINE => __('Inline CSS Async Lib', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_FONT_DISPLAY => __('Font Display Optimization', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_DEFER => __('Load JS Deferred', 'litespeed-cache'),\n\t\t\tself::O_OPTM_LOCALIZE => __('Localize Resources', 'litespeed-cache'),\n\t\t\tself::O_OPTM_LOCALIZE_DOMAINS => __('Localization Files', 'litespeed-cache'),\n\t\t\tself::O_OPTM_DNS_PREFETCH => __('DNS Prefetch', 'litespeed-cache'),\n\t\t\tself::O_OPTM_DNS_PREFETCH_CTRL => __('DNS Prefetch Control', 'litespeed-cache'),\n\t\t\tself::O_OPTM_DNS_PRECONNECT => __('DNS Preconnect', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CSS_EXC => __('CSS Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_DELAY_INC => __('JS Delayed Includes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_EXC => __('JS Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_QS_RM => __('Remove Query Strings', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GGFONTS_ASYNC => __('Load Google Fonts Asynchronously', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GGFONTS_RM => __('Remove Google Fonts', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_CON => __('Critical CSS Rules', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_SEP_POSTTYPE => __('Separate CCSS Cache Post Types', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_SEP_URI => __('Separate CCSS Cache URIs', 'litespeed-cache'),\n\t\t\tself::O_OPTM_CCSS_SELECTOR_WHITELIST => __('CCSS Selector Allowlist', 'litespeed-cache'),\n\t\t\tself::O_OPTM_JS_DEFER_EXC => __('JS Deferred \/ Delayed Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GM_JS_EXC => __('Guest Mode JS Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_EMOJI_RM => __('Remove WordPress Emoji', 'litespeed-cache'),\n\t\t\tself::O_OPTM_NOSCRIPT_RM => __('Remove Noscript Tags', 'litespeed-cache'),\n\t\t\tself::O_OPTM_EXC => __('URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_OPTM_GUEST_ONLY => __('Optimize for Guests Only', 'litespeed-cache'),\n\t\t\tself::O_OPTM_EXC_ROLES => __('Role Excludes', 'litespeed-cache'),\n\n\t\t\tself::O_DISCUSS_AVATAR_CACHE => __('Gravatar Cache', 'litespeed-cache'),\n\t\t\tself::O_DISCUSS_AVATAR_CRON => __('Gravatar Cache Cron', 'litespeed-cache'),\n\t\t\tself::O_DISCUSS_AVATAR_CACHE_TTL => __('Gravatar Cache TTL', 'litespeed-cache'),\n\n\t\t\tself::O_MEDIA_LAZY => __('Lazy Load Images', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_EXC => __('Lazy Load Image Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_CLS_EXC => __('Lazy Load Image Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_PARENT_CLS_EXC => __('Lazy Load Image Parent Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_IFRAME_LAZY_CLS_EXC => __('Lazy Load Iframe Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC => __('Lazy Load Iframe Parent Class Name Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_URI_EXC => __('Lazy Load URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP_EXC => __('LQIP Excludes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LAZY_PLACEHOLDER => __('Basic Image Placeholder', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP => __('Responsive Placeholder', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP_COLOR => __('Responsive Placeholder Color', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP_SVG => __('Responsive Placeholder SVG', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP => __('LQIP Cloud Generator', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP_QUAL => __('LQIP Quality', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_LQIP_MIN_W => __('LQIP Minimum Dimensions', 'litespeed-cache'),\n\t\t\t\/\/ self::O_MEDIA_LQIP_MIN_H         => __( 'LQIP Minimum Height', 'litespeed-cache' ),\n\t\t\tself::O_MEDIA_PLACEHOLDER_RESP_ASYNC => __('Generate LQIP In Background', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_IFRAME_LAZY => __('Lazy Load Iframes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_ADD_MISSING_SIZES => __('Add Missing Sizes', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_VPI => __('Viewport Images', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_VPI_CRON => __('Viewport Images Cron', 'litespeed-cache'),\n\t\t\tself::O_MEDIA_AUTO_RESCALE_ORI => __('Auto Rescale Original Images', 'litespeed-cache'),\n\n\t\t\tself::O_IMG_OPTM_AUTO => __('Auto Request Cron', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_ORI => __('Optimize Original Images', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_RM_BKUP => __('Remove Original Backups', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_WEBP => __('Next-Gen Image Format', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_LOSSLESS => __('Optimize Losslessly', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_EXIF => __('Preserve EXIF\/XMP data', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_WEBP_ATTR => __('WebP\/AVIF Attribute To Replace', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_WEBP_REPLACE_SRCSET => __('WebP\/AVIF For Extra srcset', 'litespeed-cache'),\n\t\t\tself::O_IMG_OPTM_JPG_QUALITY => __('WordPress Image Quality Control', 'litespeed-cache'),\n\t\t\tself::O_ESI => __('Enable ESI', 'litespeed-cache'),\n\t\t\tself::O_ESI_CACHE_ADMBAR => __('Cache Admin Bar', 'litespeed-cache'),\n\t\t\tself::O_ESI_CACHE_COMMFORM => __('Cache Comment Form', 'litespeed-cache'),\n\t\t\tself::O_ESI_NONCE => __('ESI Nonces', 'litespeed-cache'),\n\t\t\tself::O_CACHE_VARY_GROUP => __('Vary Group', 'litespeed-cache'),\n\t\t\tself::O_PURGE_HOOK_ALL => __('Purge All Hooks', 'litespeed-cache'),\n\t\t\tself::O_UTIL_NO_HTTPS_VARY => __('Improve HTTP\/HTTPS Compatibility', 'litespeed-cache'),\n\t\t\tself::O_UTIL_INSTANT_CLICK => __('Instant Click', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_COOKIES => __('Do Not Cache Cookies', 'litespeed-cache'),\n\t\t\tself::O_CACHE_EXC_USERAGENTS => __('Do Not Cache User Agents', 'litespeed-cache'),\n\t\t\tself::O_CACHE_LOGIN_COOKIE => __('Login Cookie', 'litespeed-cache'),\n\t\t\tself::O_CACHE_VARY_COOKIES => __('Vary Cookies', 'litespeed-cache'),\n\n\t\t\tself::O_MISC_HEARTBEAT_FRONT => __('Frontend Heartbeat Control', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_FRONT_TTL => __('Frontend Heartbeat TTL', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_BACK => __('Backend Heartbeat Control', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_BACK_TTL => __('Backend Heartbeat TTL', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_EDITOR => __('Editor Heartbeat', 'litespeed-cache'),\n\t\t\tself::O_MISC_HEARTBEAT_EDITOR_TTL => __('Editor Heartbeat TTL', 'litespeed-cache'),\n\n\t\t\tself::O_CDN => __('Use CDN Mapping', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_URL => __('CDN URL', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_INC_IMG => __('Include Images', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_INC_CSS => __('Include CSS', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_INC_JS => __('Include JS', 'litespeed-cache'),\n\t\t\tself::CDN_MAPPING_FILETYPE => __('Include File Types', 'litespeed-cache'),\n\t\t\tself::O_CDN_ATTR => __('HTML Attribute To Replace', 'litespeed-cache'),\n\t\t\tself::O_CDN_ORI => __('Original URLs', 'litespeed-cache'),\n\t\t\tself::O_CDN_ORI_DIR => __('Included Directories', 'litespeed-cache'),\n\t\t\tself::O_CDN_EXC => __('Exclude Path', 'litespeed-cache'),\n\t\t\tself::O_CDN_CLOUDFLARE => __('Cloudflare API', 'litespeed-cache'),\n\t\t\tself::O_CDN_CLOUDFLARE_CLEAR => __('Clear Cloudflare cache', 'litespeed-cache'),\n\n\t\t\tself::O_CRAWLER => __('Crawler', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_CRAWL_INTERVAL => __('Crawl Interval', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_LOAD_LIMIT => __('Server Load Limit', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_ROLES => __('Role Simulation', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_COOKIES => __('Cookie Simulation', 'litespeed-cache'),\n\t\t\tself::O_CRAWLER_SITEMAP => __('Custom Sitemap', 'litespeed-cache'),\n\n\t\t\tself::O_DEBUG_DISABLE_ALL => __('Disable All Features', 'litespeed-cache'),\n\t\t\tself::O_DEBUG => __('Debug Log', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_IPS => __('Admin IPs', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_LEVEL => __('Debug Level', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_FILESIZE => __('Log File Size Limit', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_COLLAPSE_QS => __('Collapse Query Strings', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_INC => __('Debug URI Includes', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_EXC => __('Debug URI Excludes', 'litespeed-cache'),\n\t\t\tself::O_DEBUG_EXC_STRINGS => __('Debug String Excludes', 'litespeed-cache'),\n\n\t\t\tself::O_DB_OPTM_REVISIONS_MAX => __('Revisions Max Number', 'litespeed-cache'),\n\t\t\tself::O_DB_OPTM_REVISIONS_AGE => __('Revisions Max Age', 'litespeed-cache'),\n\t\t);\n\n\t\tif (array_key_exists($id, $_lang_list)) {\n\t\t\treturn $_lang_list[$id];\n\t\t}\n\n\t\treturn 'N\/A';\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/esi.cls.php","ext":"php","size":27834,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The ESI class.\n *\n * This is used to define all esi related functions.\n *\n * @since       1.1.3\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass ESI extends Root {\n\n\tconst LOG_TAG = '\u23fa';\n\n\tprivate static $has_esi      = false;\n\tprivate static $_combine_ids = array();\n\tprivate $esi_args            = null;\n\tprivate $_esi_preserve_list  = array();\n\tprivate $_nonce_actions      = array( -1 => '' ); \/\/ val is cache control\n\n\tconst QS_ACTION = 'lsesi';\n\tconst QS_PARAMS = 'esi';\n\tconst COMBO     = '__combo'; \/\/ ESI include combine='main' handler\n\n\tconst PARAM_ARGS     = 'args';\n\tconst PARAM_ID       = 'id';\n\tconst PARAM_INSTANCE = 'instance';\n\tconst PARAM_NAME     = 'name';\n\n\tconst WIDGET_O_ESIENABLE = 'widget_esi_enable';\n\tconst WIDGET_O_TTL       = 'widget_ttl';\n\n\t\/**\n\t * Confructor of ESI\n\t *\n\t * @since  1.2.0\n\t * @since  4.0 Change to be after Vary init in hook 'after_setup_theme'\n\t *\/\n\tpublic function init() {\n\t\t\/**\n\t\t * Bypass ESI related funcs if disabled ESI to fix potential DIVI compatibility issue\n\t\t *\n\t\t * @since  2.9.7.2\n\t\t *\/\n\t\tif (Router::is_ajax() || !$this->cls('Router')->esi_enabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Guest mode, don't need to use ESI\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ If page is not cacheable\n\t\tif (defined('DONOTCACHEPAGE') && apply_filters('litespeed_const_DONOTCACHEPAGE', DONOTCACHEPAGE)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Init ESI in `after_setup_theme` hook after detected if LITESPEED_DISABLE_ALL is ON or not\n\t\t$this->_hooks();\n\n\t\t\/**\n\t\t * Overwrite wp_create_nonce func\n\t\t *\n\t\t * @since  2.9.5\n\t\t *\/\n\t\t$this->_transform_nonce();\n\n\t\t!defined('LITESPEED_ESI_INITED') && define('LITESPEED_ESI_INITED', true);\n\t}\n\n\t\/**\n\t * Init ESI related hooks\n\t *\n\t * Load delayed by hook to give the ability to bypass by LITESPEED_DISABLE_ALL const\n\t *\n\t * @since 2.9.7.2\n\t * @since  4.0 Changed to private from public\n\t * @access private\n\t *\/\n\tprivate function _hooks() {\n\t\tadd_filter('template_include', array( $this, 'esi_template' ), 99999);\n\n\t\tadd_action('load-widgets.php', __NAMESPACE__ . '\\Purge::purge_widget');\n\t\tadd_action('wp_update_comment_count', __NAMESPACE__ . '\\Purge::purge_comment_widget');\n\n\t\t\/**\n\t\t * Recover REQUEST_URI\n\t\t *\n\t\t * @since  1.8.1\n\t\t *\/\n\t\tif (!empty($_GET[self::QS_ACTION])) {\n\t\t\tself::debug('ESI req');\n\t\t\t$this->_register_esi_actions();\n\t\t}\n\n\t\t\/**\n\t\t * Shortcode ESI\n\t\t *\n\t\t * To use it, just change the original shortcode as below:\n\t\t *      old: [someshortcode aa='bb']\n\t\t *      new: [esi someshortcode aa='bb' cache='private,no-vary' ttl='600']\n\t\t *\n\t\t *  1. `cache` attribute is optional, default to 'public,no-vary'.\n\t\t *  2. `ttl` attribute is optional, default is your public TTL setting.\n\t\t *  3. `_ls_silence` attribute is optional, default is false.\n\t\t *\n\t\t * @since  2.8\n\t\t * @since  2.8.1 Check is_admin for Elementor compatibility #726013\n\t\t *\/\n\t\tif (!is_admin()) {\n\t\t\tadd_shortcode('esi', array( $this, 'shortcode' ));\n\t\t}\n\t}\n\n\t\/**\n\t * Take over all nonce calls and transform to ESI\n\t *\n\t * @since  2.9.5\n\t *\/\n\tprivate function _transform_nonce() {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Load ESI nonces in conf\n\t\t$nonces = $this->conf(Base::O_ESI_NONCE);\n\t\tadd_filter('litespeed_esi_nonces', array( $this->cls('Data'), 'load_esi_nonces' ));\n\t\tif ($nonces = apply_filters('litespeed_esi_nonces', $nonces)) {\n\t\t\tforeach ($nonces as $action) {\n\t\t\t\t$this->nonce_action($action);\n\t\t\t}\n\t\t}\n\n\t\tadd_action('litespeed_nonce', array( $this, 'nonce_action' ));\n\t}\n\n\t\/**\n\t * Register a new nonce action to convert it to ESI\n\t *\n\t * @since  2.9.5\n\t *\/\n\tpublic function nonce_action( $action ) {\n\t\t\/\/ Split the Cache Control\n\t\t$action  = explode(' ', $action);\n\t\t$control = !empty($action[1]) ? $action[1] : '';\n\t\t$action  = $action[0];\n\n\t\t\/\/ Wildcard supported\n\t\t$action = Utility::wildcard2regex($action);\n\n\t\tif (array_key_exists($action, $this->_nonce_actions)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_nonce_actions[$action] = $control;\n\n\t\t\/\/ Debug2::debug('[ESI] Appended nonce action to nonce list [action] ' . $action);\n\t}\n\n\t\/**\n\t * Check if an action is registered to replace ESI\n\t *\n\t * @since 2.9.5\n\t *\/\n\tpublic function is_nonce_action( $action ) {\n\t\t\/\/ If GM not run yet, then ESI not init yet, then ESI nonce will not be allowed even nonce func replaced.\n\t\tif (!defined('LITESPEED_ESI_INITED')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tforeach ($this->_nonce_actions as $k => $v) {\n\t\t\tif (strpos($k, '*') !== false) {\n\t\t\t\tif (preg_match('#' . $k . '#iU', $action)) {\n\t\t\t\t\treturn $v;\n\t\t\t\t}\n\t\t\t} elseif ($k == $action) {\n\t\t\t\treturn $v;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t\/**\n\t * Shortcode ESI\n\t *\n\t * @since 2.8\n\t * @access public\n\t *\/\n\tpublic function shortcode( $atts ) {\n\t\tif (empty($atts[0])) {\n\t\t\tDebug2::debug('[ESI] ===shortcode wrong format', $atts);\n\t\t\treturn 'Wrong shortcode esi format';\n\t\t}\n\n\t\t$cache = 'public,no-vary';\n\t\tif (!empty($atts['cache'])) {\n\t\t\t$cache = $atts['cache'];\n\t\t\tunset($atts['cache']);\n\t\t}\n\n\t\t$silence = false;\n\t\tif (!empty($atts['_ls_silence'])) {\n\t\t\t$silence = true;\n\t\t}\n\n\t\tdo_action('litespeed_esi_shortcode-' . $atts[0]);\n\n\t\t\/\/ Show ESI link\n\t\treturn $this->sub_esi_block('esi', 'esi-shortcode', $atts, $cache, $silence);\n\t}\n\n\t\/**\n\t * Check if the requested page has esi elements. If so, return esi on\n\t * header.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return string Esi On header if request has esi, empty string otherwise.\n\t *\/\n\tpublic static function has_esi() {\n\t\treturn self::$has_esi;\n\t}\n\n\t\/**\n\t * Sets that the requested page has esi elements.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic static function set_has_esi() {\n\t\tself::$has_esi = true;\n\t}\n\n\t\/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page IS an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t *\/\n\tprivate function _register_esi_actions() {\n\t\t\/**\n\t\t * This hook is in `init`\n\t\t * For any plugin need to check if page is ESI, use `LSCACHE_IS_ESI` check after `init` hook\n\t\t *\/\n\t\t!defined('LSCACHE_IS_ESI') && define('LSCACHE_IS_ESI', $_GET[self::QS_ACTION]); \/\/ Reused this to ESI block ID\n\n\t\t!empty($_SERVER['ESI_REFERER']) && defined('LSCWP_LOG') && Debug2::debug('[ESI] ESI_REFERER: ' . $_SERVER['ESI_REFERER']);\n\n\t\t\/**\n\t\t * Only when ESI's parent is not REST, replace REQUEST_URI to avoid breaking WP5 editor REST call\n\t\t *\n\t\t * @since 2.9.3\n\t\t *\/\n\t\tif (!empty($_SERVER['ESI_REFERER']) && !$this->cls('REST')->is_rest($_SERVER['ESI_REFERER'])) {\n\t\t\tself::debug('overwrite REQUEST_URI to ESI_REFERER [from] ' . $_SERVER['REQUEST_URI'] . ' [to] ' . $_SERVER['ESI_REFERER']);\n\t\t\tif (!empty($_SERVER['ESI_REFERER'])) {\n\t\t\t\t$_SERVER['REQUEST_URI'] = $_SERVER['ESI_REFERER'];\n\t\t\t\tif (substr(get_option('permalink_structure'), -1) === '\/' && strpos($_SERVER['ESI_REFERER'], '?') === false) {\n\t\t\t\t\t$_SERVER['REQUEST_URI'] = trailingslashit($_SERVER['ESI_REFERER']);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ Prevent from 301 redirecting\n\t\t\tif (!empty($_SERVER['SCRIPT_URI'])) {\n\t\t\t\t$SCRIPT_URI         = parse_url($_SERVER['SCRIPT_URI']);\n\t\t\t\t$SCRIPT_URI['path'] = $_SERVER['REQUEST_URI'];\n\t\t\t\tUtility::compatibility();\n\t\t\t\t$_SERVER['SCRIPT_URI'] = http_build_url($SCRIPT_URI);\n\t\t\t}\n\t\t}\n\n\t\tif (!empty($_SERVER['ESI_CONTENT_TYPE']) && strpos($_SERVER['ESI_CONTENT_TYPE'], 'application\/json') === 0) {\n\t\t\tadd_filter('litespeed_is_json', '__return_true');\n\t\t}\n\n\t\t\/**\n\t\t * Make REST call be able to parse ESI\n\t\t * NOTE: Not effective due to ESI req are all to `\/` yet\n\t\t *\n\t\t * @since 2.9.4\n\t\t *\/\n\t\tadd_action('rest_api_init', array( $this, 'load_esi_block' ), 101);\n\n\t\t\/\/ Register ESI blocks\n\t\tadd_action('litespeed_esi_load-widget', array( $this, 'load_widget_block' ));\n\t\tadd_action('litespeed_esi_load-admin-bar', array( $this, 'load_admin_bar_block' ));\n\t\tadd_action('litespeed_esi_load-comment-form', array( $this, 'load_comment_form_block' ));\n\n\t\tadd_action('litespeed_esi_load-nonce', array( $this, 'load_nonce_block' ));\n\t\tadd_action('litespeed_esi_load-esi', array( $this, 'load_esi_shortcode' ));\n\n\t\tadd_action('litespeed_esi_load-' . self::COMBO, array( $this, 'load_combo' ));\n\t}\n\n\t\/**\n\t * Hooked to the template_include action.\n\t * Selects the esi template file when the post type is a LiteSpeed ESI page.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param string $template The template path filtered.\n\t * @return string The new template path.\n\t *\/\n\tpublic function esi_template( $template ) {\n\t\t\/\/ Check if is an ESI request\n\t\tif (defined('LSCACHE_IS_ESI')) {\n\t\t\tself::debug('calling ESI template');\n\n\t\t\treturn LSCWP_DIR . 'tpl\/esi.tpl.php';\n\t\t}\n\t\tself::debug('calling default template');\n\t\t$this->_register_not_esi_actions();\n\t\treturn $template;\n\t}\n\n\t\/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page is NOT an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t *\/\n\tprivate function _register_not_esi_actions() {\n\t\tdo_action('litespeed_tpl_normal');\n\n\t\tif (!Control::is_cacheable()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Router::is_ajax()) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('widget_display_callback', array( $this, 'sub_widget_block' ), 0, 3);\n\n\t\t\/\/ Add admin_bar esi\n\t\tif (Router::is_logged_in()) {\n\t\t\tremove_action('wp_body_open', 'wp_admin_bar_render', 0); \/\/ Remove default Admin bar. Fix https:\/\/github.com\/elementor\/elementor\/issues\/25198\n\t\t\tremove_action('wp_footer', 'wp_admin_bar_render', 1000);\n\t\t\tadd_action('wp_footer', array( $this, 'sub_admin_bar_block' ), 1000);\n\t\t}\n\n\t\t\/\/ Add comment forum esi for logged-in user or commenter\n\t\tif (!Router::is_ajax() && Vary::has_vary()) {\n\t\t\tadd_filter('comment_form_defaults', array( $this, 'register_comment_form_actions' ));\n\t\t}\n\t}\n\n\t\/**\n\t * Set an ESI to be combine='sub'\n\t *\n\t * @since  3.4.2\n\t *\/\n\tpublic static function combine( $block_id ) {\n\t\tif (!isset($_SERVER['X-LSCACHE']) || strpos($_SERVER['X-LSCACHE'], 'combine') === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (in_array($block_id, self::$_combine_ids)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::$_combine_ids[] = $block_id;\n\t}\n\n\t\/**\n\t * Load combined ESI\n\t *\n\t * @since  3.4.2\n\t *\/\n\tpublic function load_combo() {\n\t\tControl::set_nocache('ESI combine request');\n\n\t\tif (empty($_POST['esi_include'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::set_has_esi();\n\n\t\tDebug2::debug('[ESI] \ud83c\udf54 Load combo', $_POST['esi_include']);\n\n\t\t$output = '';\n\t\tforeach ($_POST['esi_include'] as $url) {\n\t\t\t$qs = parse_url(htmlspecialchars_decode($url), PHP_URL_QUERY);\n\t\t\tparse_str($qs, $qs);\n\t\t\tif (empty($qs[self::QS_ACTION])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$esi_id       = $qs[self::QS_ACTION];\n\t\t\t$esi_param    = !empty($qs[self::QS_PARAMS]) ? $this->_parse_esi_param($qs[self::QS_PARAMS]) : false;\n\t\t\t$inline_param = apply_filters('litespeed_esi_inline-' . $esi_id, array(), $esi_param); \/\/ Returned array need to be [ val, control, tag ]\n\t\t\tif ($inline_param) {\n\t\t\t\t$output .= self::_build_inline($url, $inline_param);\n\t\t\t}\n\t\t}\n\n\t\techo $output;\n\t}\n\n\t\/**\n\t * Build a whole inline segment\n\t *\n\t * @since  3.4.2\n\t *\/\n\tprivate static function _build_inline( $url, $inline_param ) {\n\t\tif (!$url || empty($inline_param['val']) || empty($inline_param['control']) || empty($inline_param['tag'])) {\n\t\t\treturn '';\n\t\t}\n\n\t\t$url     = esc_attr($url);\n\t\t$control = esc_attr($inline_param['control']);\n\t\t$tag     = esc_attr($inline_param['tag']);\n\n\t\treturn \"<esi:inline name='$url' cache-control='\" . $control . \"' cache-tag='\" . $tag . \"'>\" . $inline_param['val'] . '<\/esi:inline>';\n\t}\n\n\t\/**\n\t * Build the esi url. This method will build the html comment wrapper as well as serialize and encode the parameter array.\n\t *\n\t * The block_id parameter should contain alphanumeric and '-_' only.\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param string $block_id     The id to use to display the correct esi block.\n\t * @param string $wrapper      The wrapper for the esi comments.\n\t * @param array  $params       The esi parameters.\n\t * @param string $control      The cache control attribute if any.\n\t * @param bool   $silence      If generate wrapper comment or not\n\t * @param bool   $preserved    If this ESI block is used in any filter, need to temporarily convert it to a string to avoid the HTML tag being removed\/filtered.\n\t * @param bool   $svar         If store the value in memory or not, in memory will be faster\n\t * @param array  $inline_param If show the current value for current request( this can avoid multiple esi requests in first time cache generating process )\n\t *\/\n\tpublic function sub_esi_block(\n\t\t$block_id,\n\t\t$wrapper,\n\t\t$params = array(),\n\t\t$control = 'private,no-vary',\n\t\t$silence = false,\n\t\t$preserved = false,\n\t\t$svar = false,\n\t\t$inline_param = array()\n\t) {\n\t\tif (empty($block_id) || !is_array($params) || preg_match('\/[^\\w-]\/', $block_id)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\tDebug2::debug('[ESI] ESI OFF so force loading [block_id] ' . $block_id);\n\t\t\tdo_action('litespeed_esi_load-' . $block_id, $params);\n\t\t\treturn;\n\t\t}\n\n\t\tif ($silence) {\n\t\t\t\/\/ Don't add comment to esi block ( original for nonce used in tag property data-nonce='esi_block' )\n\t\t\t$params['_ls_silence'] = true;\n\t\t}\n\n\t\tif ($this->cls('REST')->is_rest() || $this->cls('REST')->is_internal_rest()) {\n\t\t\t$params['is_json'] = 1;\n\t\t}\n\n\t\t$params  = apply_filters('litespeed_esi_params', $params, $block_id);\n\t\t$control = apply_filters('litespeed_esi_control', $control, $block_id);\n\n\t\tif (!is_array($params) || !is_string($control)) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug(\"[ESI] \ud83d\uded1 Sub hooks returned Params: \\n\" . var_export($params, true) . \"\\ncache control: \\n\" . var_export($control, true));\n\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ Build params for URL\n\t\t$appended_params = array(\n\t\t\tself::QS_ACTION => $block_id,\n\t\t);\n\t\tif (!empty($control)) {\n\t\t\t$appended_params['_control'] = $control;\n\t\t}\n\t\tif ($params) {\n\t\t\t$appended_params[self::QS_PARAMS] = base64_encode(\\json_encode($params));\n\t\t\tDebug2::debug2('[ESI] param ', $params);\n\t\t}\n\n\t\t\/\/ Append hash\n\t\t$appended_params['_hash'] = $this->_gen_esi_md5($appended_params);\n\n\t\t\/**\n\t\t * Escape potential chars\n\t\t *\n\t\t * @since 2.9.4\n\t\t *\/\n\t\t$appended_params = array_map('urlencode', $appended_params);\n\n\t\t\/\/ Generate ESI URL\n\t\t$url = add_query_arg($appended_params, trailingslashit(wp_make_link_relative(home_url())));\n\n\t\t$output = '';\n\t\tif ($inline_param) {\n\t\t\t$output .= self::_build_inline($url, $inline_param);\n\t\t}\n\n\t\t$output .= \"<esi:include src='$url'\";\n\t\tif (!empty($control)) {\n\t\t\t$control = esc_attr($control);\n\t\t\t$output .= \" cache-control='$control'\";\n\t\t}\n\t\tif ($svar) {\n\t\t\t$output .= \" as-var='1'\";\n\t\t}\n\t\tif (in_array($block_id, self::$_combine_ids)) {\n\t\t\t$output .= \" combine='sub'\";\n\t\t}\n\t\tif ($block_id == self::COMBO && isset($_SERVER['X-LSCACHE']) && strpos($_SERVER['X-LSCACHE'], 'combine') !== false) {\n\t\t\t$output .= \" combine='main'\";\n\t\t}\n\t\t$output .= ' \/>';\n\n\t\tif (!$silence) {\n\t\t\t$output = \"<!-- lscwp $wrapper -->$output<!-- lscwp $wrapper esi end -->\";\n\t\t}\n\n\t\tself::debug(\"\ud83d\udc95  [BLock_ID] $block_id \\t[wrapper] $wrapper \\t\\t[Control] $control\");\n\t\tself::debug2($output);\n\n\t\tself::set_has_esi();\n\n\t\t\/\/ Convert to string to avoid html chars filter when using\n\t\t\/\/ Will reverse the buffer when output in self::finalize()\n\t\tif ($preserved) {\n\t\t\t$hash                            = md5($output);\n\t\t\t$this->_esi_preserve_list[$hash] = $output;\n\t\t\tself::debug(\"Preserved to $hash\");\n\n\t\t\treturn $hash;\n\t\t}\n\n\t\treturn $output;\n\t}\n\n\t\/**\n\t * Generate ESI hash md5\n\t *\n\t * @since  2.9.6\n\t * @access private\n\t *\/\n\tprivate function _gen_esi_md5( $params ) {\n\t\t$keys = array( self::QS_ACTION, '_control', self::QS_PARAMS );\n\n\t\t$str = '';\n\t\tforeach ($keys as $v) {\n\t\t\tif (isset($params[$v]) && is_string($params[$v])) {\n\t\t\t\t$str .= $params[$v];\n\t\t\t}\n\t\t}\n\t\tDebug2::debug2('[ESI] md5_string=' . $str);\n\n\t\treturn md5($this->conf(Base::HASH) . $str);\n\t}\n\n\t\/**\n\t * Parses the request parameters on an ESI request\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t *\/\n\tprivate function _parse_esi_param( $qs_params = false ) {\n\t\t$req_params = false;\n\t\tif ($qs_params) {\n\t\t\t$req_params = $qs_params;\n\t\t} elseif (isset($_REQUEST[self::QS_PARAMS])) {\n\t\t\t$req_params = $_REQUEST[self::QS_PARAMS];\n\t\t}\n\n\t\tif (!$req_params) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$unencrypted = base64_decode($req_params);\n\t\tif ($unencrypted === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug2('[ESI] params', $unencrypted);\n\t\t\/\/ $unencoded = urldecode($unencrypted); no need to do this as $_GET is already parsed\n\t\t$params = \\json_decode($unencrypted, true);\n\n\t\treturn $params;\n\t}\n\n\t\/**\n\t * Select the correct esi output based on the parameters in an ESI request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic function load_esi_block() {\n\t\t\/**\n\t\t * Validate if is a legal ESI req\n\t\t *\n\t\t * @since 2.9.6\n\t\t *\/\n\t\tif (empty($_GET['_hash']) || $this->_gen_esi_md5($_GET) != $_GET['_hash']) {\n\t\t\tDebug2::debug('[ESI] \u274c Failed to validate _hash');\n\t\t\treturn;\n\t\t}\n\n\t\t$params = $this->_parse_esi_param();\n\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\t$logInfo = '[ESI] \u2b55 ';\n\t\t\tif (!empty($params[self::PARAM_NAME])) {\n\t\t\t\t$logInfo .= ' Name: ' . $params[self::PARAM_NAME] . ' ----- ';\n\t\t\t}\n\t\t\t$logInfo .= ' [ID] ' . LSCACHE_IS_ESI;\n\t\t\tDebug2::debug($logInfo);\n\t\t}\n\n\t\tif (!empty($params['_ls_silence'])) {\n\t\t\t!defined('LSCACHE_ESI_SILENCE') && define('LSCACHE_ESI_SILENCE', true);\n\t\t}\n\n\t\t\/**\n\t\t * Buffer needs to be JSON format\n\t\t *\n\t\t * @since  2.9.4\n\t\t *\/\n\t\tif (!empty($params['is_json'])) {\n\t\t\tadd_filter('litespeed_is_json', '__return_true');\n\t\t}\n\n\t\tTag::add(rtrim(Tag::TYPE_ESI, '.'));\n\t\tTag::add(Tag::TYPE_ESI . LSCACHE_IS_ESI);\n\n\t\t\/\/ Debug2::debug(var_export($params, true ));\n\n\t\t\/**\n\t\t * Handle default cache control 'private,no-vary' for sub_esi_block()   @ticket #923505\n\t\t *\n\t\t * @since  2.2.3\n\t\t *\/\n\t\tif (!empty($_GET['_control'])) {\n\t\t\t$control = explode(',', $_GET['_control']);\n\t\t\tif (in_array('private', $control)) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\n\t\t\tif (in_array('no-vary', $control)) {\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\n\t\tdo_action('litespeed_esi_load-' . LSCACHE_IS_ESI, $params);\n\t}\n\n\t\/\/ The *_sub_* functions are helpers for the sub_* functions.\n\t\/\/ The *_load_* functions are helpers for the load_* functions.\n\n\t\/**\n\t * Loads the default options for default WordPress widgets.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic static function widget_default_options( $options, $widget ) {\n\t\tif (!is_array($options)) {\n\t\t\treturn $options;\n\t\t}\n\n\t\t$widget_name = get_class($widget);\n\t\tswitch ($widget_name) {\n\t\t\tcase 'WP_Widget_Recent_Posts':\n\t\t\tcase 'WP_Widget_Recent_Comments':\n            $options[self::WIDGET_O_ESIENABLE] = Base::VAL_OFF;\n            $options[self::WIDGET_O_TTL]       = 86400;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn $options;\n\t}\n\n\t\/**\n\t * Hooked to the widget_display_callback filter.\n\t * If the admin configured the widget to display via esi, this function\n\t * will set up the esi request and cancel the widget display.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param array      $instance Parameter used to build the widget.\n\t * @param \\WP_Widget $widget The widget to build.\n\t * @param array      $args Parameter used to build the widget.\n\t * @return mixed Return false if display through esi, instance otherwise.\n\t *\/\n\tpublic function sub_widget_block( $instance, $widget, $args ) {\n\t\t\/\/ #210407\n\t\tif (!is_array($instance)) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$name = get_class($widget);\n\t\tif (!isset($instance[Base::OPTION_NAME])) {\n\t\t\treturn $instance;\n\t\t}\n\t\t$options = $instance[Base::OPTION_NAME];\n\t\tif (!isset($options) || !$options[self::WIDGET_O_ESIENABLE]) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI 0 ' . $name . ': ' . (!isset($options) ? 'not set' : 'set off'));\n\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$esi_private = $options[self::WIDGET_O_ESIENABLE] == Base::VAL_ON2 ? 'private,' : '';\n\n\t\t$params = array(\n\t\t\tself::PARAM_NAME => $name,\n\t\t\tself::PARAM_ID => $widget->id,\n\t\t\tself::PARAM_INSTANCE => $instance,\n\t\t\tself::PARAM_ARGS => $args,\n\t\t);\n\n\t\techo $this->sub_esi_block('widget', 'widget ' . $name, $params, $esi_private . 'no-vary');\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Hooked to the wp_footer action.\n\t * Sets up the ESI request for the admin bar.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global type $wp_admin_bar\n\t *\/\n\tpublic function sub_admin_bar_block() {\n\t\tglobal $wp_admin_bar;\n\n\t\tif (!is_admin_bar_showing() || !is_object($wp_admin_bar)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ To make each admin bar ESI request different for `Edit` button different link\n\t\t$params = array(\n\t\t\t'ref' => $_SERVER['REQUEST_URI'],\n\t\t);\n\n\t\techo $this->sub_esi_block('admin-bar', 'adminbar', $params);\n\t}\n\n\t\/**\n\t * Parses the esi input parameters and generates the widget for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global $wp_widget_factory\n\t * @param array $params Input parameters needed to correctly display widget\n\t *\/\n\tpublic function load_widget_block( $params ) {\n\t\t\/\/ global $wp_widget_factory;\n\t\t\/\/ $widget = $wp_widget_factory->widgets[ $params[ self::PARAM_NAME ] ];\n\t\t$option = $params[self::PARAM_INSTANCE];\n\t\t$option = $option[Base::OPTION_NAME];\n\n\t\t\/\/ Since we only reach here via esi, safe to assume setting exists.\n\t\t$ttl = $option[self::WIDGET_O_TTL];\n\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI widget render: name ' . $params[self::PARAM_NAME] . ', id ' . $params[self::PARAM_ID] . ', ttl ' . $ttl);\n\t\tif ($ttl == 0) {\n\t\t\tControl::set_nocache('ESI Widget time to live set to 0');\n\t\t} else {\n\t\t\tControl::set_custom_ttl($ttl);\n\n\t\t\tif ($option[self::WIDGET_O_ESIENABLE] == Base::VAL_ON2) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\t\t\tControl::set_no_vary();\n\t\t\tTag::add(Tag::TYPE_WIDGET . $params[self::PARAM_ID]);\n\t\t}\n\t\tthe_widget($params[self::PARAM_NAME], $params[self::PARAM_INSTANCE], $params[self::PARAM_ARGS]);\n\t}\n\n\t\/**\n\t * Generates the admin bar for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t *\/\n\tpublic function load_admin_bar_block( $params ) {\n\t\tglobal $wp_the_query;\n\n\t\tif (!empty($params['ref'])) {\n\t\t\t$ref_qs = parse_url($params['ref'], PHP_URL_QUERY);\n\t\t\tif (!empty($ref_qs)) {\n\t\t\t\tparse_str($ref_qs, $ref_qs_arr);\n\n\t\t\t\tif (!empty($ref_qs_arr)) {\n\t\t\t\t\tforeach ($ref_qs_arr as $k => $v) {\n\t\t\t\t\t\t$_GET[$k] = $v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Needed when permalink structure is \"Plain\"\n\t\tif (!isset($wp_the_query)) {\n\t\t\twp();\n\t\t}\n\n\t\twp_admin_bar_render();\n\t\tif (!$this->conf(Base::O_ESI_CACHE_ADMBAR)) {\n\t\t\tControl::set_nocache('build-in set to not cacheable');\n\t\t} else {\n\t\t\tControl::set_private();\n\t\t\tControl::set_no_vary();\n\t\t}\n\n\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI: adminbar ref: ' . $_SERVER['REQUEST_URI']);\n\t}\n\n\t\/**\n\t * Parses the esi input parameters and generates the comment form for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @param array $params Input parameters needed to correctly display comment form\n\t *\/\n\tpublic function load_comment_form_block( $params ) {\n\t\tcomment_form($params[self::PARAM_ARGS], $params[self::PARAM_ID]);\n\n\t\tif (!$this->conf(Base::O_ESI_CACHE_COMMFORM)) {\n\t\t\tControl::set_nocache('build-in set to not cacheable');\n\t\t} else {\n\t\t\t\/\/ by default comment form is public\n\t\t\tif (Vary::has_vary()) {\n\t\t\t\tControl::set_private();\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Generate nonce for certain action\n\t *\n\t * @access public\n\t * @since 2.6\n\t *\/\n\tpublic function load_nonce_block( $params ) {\n\t\t$action = $params['action'];\n\n\t\tDebug2::debug('[ESI] load_nonce_block [action] ' . $action);\n\n\t\t\/\/ set nonce TTL to half day\n\t\tControl::set_custom_ttl(43200);\n\n\t\tif (Router::is_logged_in()) {\n\t\t\tControl::set_private();\n\t\t}\n\n\t\tif (function_exists('wp_create_nonce_litespeed_esi')) {\n\t\t\techo wp_create_nonce_litespeed_esi($action);\n\t\t} else {\n\t\t\techo wp_create_nonce($action);\n\t\t}\n\t}\n\n\t\/**\n\t * Show original shortcode\n\t *\n\t * @access public\n\t * @since 2.8\n\t *\/\n\tpublic function load_esi_shortcode( $params ) {\n\t\tif (isset($params['ttl'])) {\n\t\t\tif (!$params['ttl']) {\n\t\t\t\tControl::set_nocache('ESI shortcode att ttl=0');\n\t\t\t} else {\n\t\t\t\tControl::set_custom_ttl($params['ttl']);\n\t\t\t}\n\t\t\tunset($params['ttl']);\n\t\t}\n\n\t\t\/\/ Replace to original shortcode\n\t\t$shortcode = $params[0];\n\t\t$atts_ori  = array();\n\t\tforeach ($params as $k => $v) {\n\t\t\tif ($k === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$atts_ori[] = is_string($k) ? \"$k='\" . addslashes($v) . \"'\" : $v;\n\t\t}\n\n\t\tTag::add(Tag::TYPE_ESI . \"esi.$shortcode\");\n\n\t\t\/\/ Output original shortcode final content\n\t\techo do_shortcode(\"[$shortcode \" . implode(' ', $atts_ori) . ' ]');\n\t}\n\n\t\/**\n\t * Hooked to the comment_form_defaults filter.\n\t * Stores the default comment form settings.\n\t * If sub_comment_form_block is triggered, the output buffer is cleared and an esi block is added. The remaining comment form is also buffered and cleared.\n\t * Else there is no need to make the comment form ESI.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic function register_comment_form_actions( $defaults ) {\n\t\t$this->esi_args = $defaults;\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_filter('comment_form_submit_button', array( $this, 'sub_comment_form_btn' ), 1000, 2); \/\/ To save the params passed in\n\t\tadd_action('comment_form', array( $this, 'sub_comment_form_block' ), 1000);\n\t\treturn $defaults;\n\t}\n\n\t\/**\n\t * Store the args passed in comment_form for the ESI comment param usage in `$this->sub_comment_form_block()`\n\t *\n\t * @since  3.4\n\t * @access public\n\t *\/\n\tpublic function sub_comment_form_btn( $unused, $args ) {\n\t\tif (empty($args) || empty($this->esi_args)) {\n\t\t\tDebug2::debug('comment form args empty?');\n\t\t\treturn $unused;\n\t\t}\n\t\t$esi_args = array();\n\n\t\t\/\/ compare current args with default ones\n\t\tforeach ($args as $k => $v) {\n\t\t\tif (!isset($this->esi_args[$k])) {\n\t\t\t\t$esi_args[$k] = $v;\n\t\t\t} elseif (is_array($v)) {\n\t\t\t\t$diff = array_diff_assoc($v, $this->esi_args[$k]);\n\t\t\t\tif (!empty($diff)) {\n\t\t\t\t\t$esi_args[$k] = $diff;\n\t\t\t\t}\n\t\t\t} elseif ($v !== $this->esi_args[$k]) {\n\t\t\t\t$esi_args[$k] = $v;\n\t\t\t}\n\t\t}\n\n\t\t$this->esi_args = $esi_args;\n\n\t\treturn $unused;\n\t}\n\n\t\/**\n\t * Hooked to the comment_form_submit_button filter.\n\t *\n\t * This method will compare the used comment form args against the default args. The difference will be passed to the esi request.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t *\/\n\tpublic function sub_comment_form_block( $post_id ) {\n\t\techo GUI::clean_wrapper_end();\n\t\t$params = array(\n\t\t\tself::PARAM_ID => $post_id,\n\t\t\tself::PARAM_ARGS => $this->esi_args,\n\t\t);\n\n\t\techo $this->sub_esi_block('comment-form', 'comment form', $params);\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_action('comment_form_after', array( $this, 'comment_form_sub_clean' ));\n\t}\n\n\t\/**\n\t * Hooked to the comment_form_after action.\n\t * Cleans up the remaining comment form output.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic function comment_form_sub_clean() {\n\t\techo GUI::clean_wrapper_end();\n\t}\n\n\t\/**\n\t * Replace preserved blocks\n\t *\n\t * @since  2.6\n\t * @access public\n\t *\/\n\tpublic function finalize( $buffer ) {\n\t\t\/\/ Prepend combo esi block\n\t\tif (self::$_combine_ids) {\n\t\t\tDebug2::debug('[ESI] \ud83c\udf54 Enabled combo');\n\t\t\t$esi_block = $this->sub_esi_block(self::COMBO, '__COMBINE_MAIN__', array(), 'no-cache', true);\n\t\t\t$buffer    = $esi_block . $buffer;\n\t\t}\n\n\t\t\/\/ Bypass if no preserved list to be replaced\n\t\tif (!$this->_esi_preserve_list) {\n\t\t\treturn $buffer;\n\t\t}\n\n\t\t$keys = array_keys($this->_esi_preserve_list);\n\n\t\tDebug2::debug('[ESI] replacing preserved blocks', $keys);\n\n\t\t$buffer = str_replace($keys, $this->_esi_preserve_list, $buffer);\n\n\t\treturn $buffer;\n\t}\n\n\t\/**\n\t * Check if the content contains preserved list or not\n\t *\n\t * @since  3.3\n\t *\/\n\tpublic function contain_preserve_esi( $content ) {\n\t\t$hit_list = array();\n\t\tforeach ($this->_esi_preserve_list as $k => $v) {\n\t\t\tif (strpos($content, '\"' . $k . '\"') !== false) {\n\t\t\t\t$hit_list[] = '\"' . $k . '\"';\n\t\t\t}\n\t\t\tif (strpos($content, \"'\" . $k . \"'\") !== false) {\n\t\t\t\t$hit_list[] = \"'\" . $k . \"'\";\n\t\t\t}\n\t\t}\n\t\treturn $hit_list;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/vary.cls.php","ext":"php","size":20686,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The plugin vary class to manage X-LiteSpeed-Vary\n *\n * @since       1.1.3\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Vary extends Root {\n\n\tconst LOG_TAG  = '\ud83d\udd31';\n\tconst X_HEADER = 'X-LiteSpeed-Vary';\n\n\tprivate static $_vary_name       = '_lscache_vary'; \/\/ this default vary cookie is used for logged in status check\n\tprivate static $_can_change_vary = false; \/\/ Currently only AJAX used this\n\n\t\/**\n\t * Adds the actions used for setting up cookies on log in\/out.\n\t *\n\t * Also checks if the database matches the rewrite rule.\n\t *\n\t * @since 1.0.4\n\t *\/\n\t\/\/ public function init()\n\t\/\/ {\n\t\/\/ $this->_update_vary_name();\n\t\/\/ }\n\n\t\/**\n\t * Update the default vary name if changed\n\t *\n\t * @since  4.0\n\t * @since 7.0 Moved to after_user_init to allow ESI no-vary no conflict w\/ LSCACHE_VARY_COOKIE\/O_CACHE_LOGIN_COOKIE\n\t *\/\n\tprivate function _update_vary_name() {\n\t\t$db_cookie = $this->conf(Base::O_CACHE_LOGIN_COOKIE); \/\/ [3.0] todo: check if works in network's sites\n\t\t\/\/ If no vary set in rewrite rule\n\t\tif (!isset($_SERVER['LSCACHE_VARY_COOKIE'])) {\n\t\t\tif ($db_cookie) {\n\t\t\t\t\/\/ Check if is from ESI req or not. If from ESI no-vary, no need to set no-cache\n\t\t\t\t$something_wrong = true;\n\t\t\t\tif (!empty($_GET[ESI::QS_ACTION]) && !empty($_GET['_control'])) {\n\t\t\t\t\t\/\/ Have to manually build this checker bcoz ESI is not init yet.\n\t\t\t\t\t$control = explode(',', $_GET['_control']);\n\t\t\t\t\tif (in_array('no-vary', $control)) {\n\t\t\t\t\t\tself::debug('no-vary control existed, bypass vary_name update');\n\t\t\t\t\t\t$something_wrong  = false;\n\t\t\t\t\t\tself::$_vary_name = $db_cookie;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (defined('LITESPEED_CLI') || wp_doing_cron()) {\n\t\t\t\t\t$something_wrong = false;\n\t\t\t\t}\n\n\t\t\t\tif ($something_wrong) {\n\t\t\t\t\t\/\/ Display cookie error msg to admin\n\t\t\t\t\tif (is_multisite() ? is_network_admin() : is_admin()) {\n\t\t\t\t\t\tAdmin_Display::show_error_cookie();\n\t\t\t\t\t}\n\t\t\t\t\tControl::set_nocache('\u274c\u274c vary cookie setting error');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t\/\/ If db setting does not exist, skip checking db value\n\t\tif (!$db_cookie) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ beyond this point, need to make sure db vary setting is in $_SERVER env.\n\t\t$vary_arr = explode(',', $_SERVER['LSCACHE_VARY_COOKIE']);\n\n\t\tif (in_array($db_cookie, $vary_arr)) {\n\t\t\tself::$_vary_name = $db_cookie;\n\t\t\treturn;\n\t\t}\n\n\t\tif (is_multisite() ? is_network_admin() : is_admin()) {\n\t\t\tAdmin_Display::show_error_cookie();\n\t\t}\n\t\tControl::set_nocache('vary cookie setting lost error');\n\t}\n\n\t\/**\n\t * Hooks after user init\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function after_user_init() {\n\t\t$this->_update_vary_name();\n\n\t\t\/\/ logged in user\n\t\tif (Router::is_logged_in()) {\n\t\t\t\/\/ If not esi, check cache logged-in user setting\n\t\t\tif (!$this->cls('Router')->esi_enabled()) {\n\t\t\t\t\/\/ If cache logged-in, then init cacheable to private\n\t\t\t\tif ($this->conf(Base::O_CACHE_PRIV) && !is_admin()) {\n\t\t\t\t\tadd_action('wp_logout', __NAMESPACE__ . '\\Purge::purge_on_logout');\n\n\t\t\t\t\t$this->cls('Control')->init_cacheable();\n\t\t\t\t\tControl::set_private('logged in user');\n\t\t\t\t}\n\t\t\t\t\/\/ No cache for logged-in user\n\t\t\t\telse {\n\t\t\t\t\tControl::set_nocache('logged in user');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ ESI is on, can be public cache\n\t\t\telseif (!is_admin()) {\n\t\t\t\t\/\/ Need to make sure vary is using group id\n\t\t\t\t$this->cls('Control')->init_cacheable();\n\t\t\t}\n\n\t\t\t\/\/ register logout hook to clear login status\n\t\t\tadd_action('clear_auth_cookie', array( $this, 'remove_logged_in' ));\n\t\t} else {\n\t\t\t\/\/ Only after vary init, can detect if is Guest mode or not\n\t\t\t\/\/ Here need `self::$_vary_name` to be set first.\n\t\t\t$this->_maybe_guest_mode();\n\n\t\t\t\/\/ Set vary cookie for logging in user, otherwise the user will hit public with vary=0 (guest version)\n\t\t\tadd_action('set_logged_in_cookie', array( $this, 'add_logged_in' ), 10, 4);\n\t\t\tadd_action('wp_login', __NAMESPACE__ . '\\Purge::purge_on_logout');\n\n\t\t\t$this->cls('Control')->init_cacheable();\n\n\t\t\t\/\/ Check `login page` cacheable setting because they don't go through main WP logic\n\t\t\tadd_action('login_init', array( $this->cls('Tag'), 'check_login_cacheable' ), 5);\n\n\t\t\tif (!empty($_GET['litespeed_guest'])) {\n\t\t\t\tadd_action('wp_loaded', array( $this, 'update_guest_vary' ), 20);\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Add comment list ESI\n\t\tadd_filter('comments_array', array( $this, 'check_commenter' ));\n\n\t\t\/\/ Set vary cookie for commenter.\n\t\tadd_action('set_comment_cookies', array( $this, 'append_commenter' ));\n\n\t\t\/**\n\t\t * Don't change for REST call because they don't carry on user info usually\n\t\t *\n\t\t * @since 1.6.7\n\t\t *\/\n\t\tadd_action('rest_api_init', function () {\n\t\t\t\/\/ this hook is fired in `init` hook\n\t\t\tself::debug('Rest API init disabled vary change');\n\t\t\tadd_filter('litespeed_can_change_vary', '__return_false');\n\t\t});\n\t}\n\n\t\/**\n\t * Check if is Guest mode or not\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _maybe_guest_mode() {\n\t\tif (defined('LITESPEED_GUEST')) {\n\t\t\tself::debug('\ud83d\udc52\ud83d\udc52 Guest mode ' . (LITESPEED_GUEST ? 'predefined' : 'turned off'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$this->conf(Base::O_GUEST)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ If vary is set, then not a guest\n\t\tif (self::has_vary()) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ If has admin QS, then no guest\n\t\tif (!empty($_GET[Router::ACTION])) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (wp_doing_ajax()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (wp_doing_cron()) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ If is the request to update vary, then no guest\n\t\t\/\/ Don't need anymore as it is always ajax call\n\t\t\/\/ Still keep it in case some WP blocked the lightweight guest vary update script, WP can still update the vary\n\t\tif (!empty($_GET['litespeed_guest'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/* @ref https:\/\/wordpress.org\/support\/topic\/checkout-add-to-cart-executed-twice\/ *\/\n\t\tif (!empty($_GET['litespeed_guest_off'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('\ud83d\udc52\ud83d\udc52 Guest mode');\n\n\t\t!defined('LITESPEED_GUEST') && define('LITESPEED_GUEST', true);\n\n\t\tif ($this->conf(Base::O_GUEST_OPTM)) {\n\t\t\t!defined('LITESPEED_GUEST_OPTM') && define('LITESPEED_GUEST_OPTM', true);\n\t\t}\n\t}\n\n\t\/**\n\t * Update Guest vary\n\t *\n\t * @since  4.0\n\t * @deprecated 4.1 Use independent lightweight guest.vary.php as a replacement\n\t *\/\n\tpublic function update_guest_vary() {\n\t\t\/\/ This process must not be cached\n\t\t!defined('LSCACHE_NO_CACHE') && define('LSCACHE_NO_CACHE', true);\n\n\t\t$_guest = new Lib\\Guest();\n\t\tif ($_guest->always_guest() || self::has_vary()) {\n\t\t\t\/\/ If contains vary already, don't reload to avoid infinite loop when parent page having browser cache\n\t\t\t!defined('LITESPEED_GUEST') && define('LITESPEED_GUEST', true); \/\/ Reuse this const to bypass set vary in vary finalize\n\t\t\tself::debug('\ud83e\udd20\ud83e\udd20 Guest');\n\t\t\techo '[]';\n\t\t\texit();\n\t\t}\n\n\t\tself::debug('Will update guest vary in finalize');\n\n\t\t\/\/ return json\n\t\techo \\json_encode(array( 'reload' => 'yes' ));\n\t\texit();\n\t}\n\n\t\/**\n\t * Hooked to the comments_array filter.\n\t *\n\t * Check if the user accessing the page has the commenter cookie.\n\t *\n\t * If the user does not want to cache commenters, just check if user is commenter.\n\t * Otherwise if the vary cookie is set, unset it. This is so that when the page is cached, the page will appear as if the user was a normal user.\n\t * Normal user is defined as not a logged in user and not a commenter.\n\t *\n\t * @since 1.0.4\n\t * @access public\n\t * @global type $post\n\t * @param array $comments The current comments to output\n\t * @return array The comments to output.\n\t *\/\n\tpublic function check_commenter( $comments ) {\n\t\t\/**\n\t\t * Hook to bypass pending comment check for comment related plugins compatibility\n\t\t *\n\t\t * @since 2.9.5\n\t\t *\/\n\t\tif (apply_filters('litespeed_vary_check_commenter_pending', true)) {\n\t\t\t$pending = false;\n\t\t\tforeach ($comments as $comment) {\n\t\t\t\tif (!$comment->comment_approved) {\n\t\t\t\t\t\/\/ current user has pending comment\n\t\t\t\t\t$pending = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\/\/ No pending comments, don't need to add private cache\n\t\t\tif (!$pending) {\n\t\t\t\tself::debug('No pending comment');\n\t\t\t\t$this->remove_commenter();\n\n\t\t\t\t\/\/ Remove commenter prefilled info if exists, for public cache\n\t\t\t\tforeach ($_COOKIE as $cookie_name => $cookie_value) {\n\t\t\t\t\tif (strlen($cookie_name) >= 15 && strpos($cookie_name, 'comment_author_') === 0) {\n\t\t\t\t\t\tunset($_COOKIE[$cookie_name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn $comments;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Current user\/visitor has pending comments\n\t\t\/\/ set vary=2 for next time vary lookup\n\t\t$this->add_commenter();\n\n\t\tif ($this->conf(Base::O_CACHE_COMMENTER)) {\n\t\t\tControl::set_private('existing commenter');\n\t\t} else {\n\t\t\tControl::set_nocache('existing commenter');\n\t\t}\n\n\t\treturn $comments;\n\t}\n\n\t\/**\n\t * Check if default vary has a value\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic static function has_vary() {\n\t\tif (empty($_COOKIE[self::$_vary_name])) {\n\t\t\treturn false;\n\t\t}\n\t\treturn $_COOKIE[self::$_vary_name];\n\t}\n\n\t\/**\n\t * Append user status with logged in\n\t *\n\t * @since 1.1.3\n\t * @since 1.6.2 Removed static referral\n\t * @access public\n\t *\/\n\tpublic function add_logged_in( $logged_in_cookie = false, $expire = false, $expiration = false, $uid = false ) {\n\t\tself::debug('add_logged_in');\n\n\t\t\/**\n\t\t * NOTE: Run before `$this->_update_default_vary()` to make vary changeable\n\t\t *\n\t\t * @since  2.2.2\n\t\t *\/\n\t\tself::can_ajax_vary();\n\n\t\t\/\/ If the cookie is lost somehow, set it\n\t\t$this->_update_default_vary($uid, $expire);\n\t}\n\n\t\/**\n\t * Remove user logged in status\n\t *\n\t * @since 1.1.3\n\t * @since 1.6.2 Removed static referral\n\t * @access public\n\t *\/\n\tpublic function remove_logged_in() {\n\t\tself::debug('remove_logged_in');\n\n\t\t\/**\n\t\t * NOTE: Run before `$this->_update_default_vary()` to make vary changeable\n\t\t *\n\t\t * @since  2.2.2\n\t\t *\/\n\t\tself::can_ajax_vary();\n\n\t\t\/\/ Force update vary to remove login status\n\t\t$this->_update_default_vary(-1);\n\t}\n\n\t\/**\n\t * Allow vary can be changed for ajax calls\n\t *\n\t * @since 2.2.2\n\t * @since 2.6 Changed to static\n\t * @access public\n\t *\/\n\tpublic static function can_ajax_vary() {\n\t\tself::debug('_can_change_vary -> true');\n\t\tself::$_can_change_vary = true;\n\t}\n\n\t\/**\n\t * Check if can change default vary\n\t *\n\t * @since 1.6.2\n\t * @access private\n\t *\/\n\tprivate function can_change_vary() {\n\t\t\/\/ Don't change for ajax due to ajax not sending webp header\n\t\tif (Router::is_ajax()) {\n\t\t\tif (!self::$_can_change_vary) {\n\t\t\t\tself::debug('can_change_vary bypassed due to ajax call');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t\/**\n\t\t * POST request can set vary to fix #820789 login \"loop\" guest cache issue\n\t\t *\n\t\t * @since 1.6.5\n\t\t *\/\n\t\tif (isset($_SERVER['REQUEST_METHOD']) && $_SERVER['REQUEST_METHOD'] !== 'GET' && $_SERVER['REQUEST_METHOD'] !== 'POST') {\n\t\t\tself::debug('can_change_vary bypassed due to method not get\/post');\n\t\t\treturn false;\n\t\t}\n\n\t\t\/**\n\t\t * Disable vary change if is from crawler\n\t\t *\n\t\t * @since  2.9.8 To enable woocommerce cart not empty warm up (@Taba)\n\t\t *\/\n\t\tif (!empty($_SERVER['HTTP_USER_AGENT']) && strpos($_SERVER['HTTP_USER_AGENT'], Crawler::FAST_USER_AGENT) === 0) {\n\t\t\tself::debug('can_change_vary bypassed due to crawler');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!apply_filters('litespeed_can_change_vary', true)) {\n\t\t\tself::debug('can_change_vary bypassed due to litespeed_can_change_vary hook');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Update default vary\n\t *\n\t * @since 1.6.2\n\t * @since  1.6.6.1 Add ran check to make it only run once ( No run multiple times due to login process doesn't have valid uid )\n\t * @access private\n\t *\/\n\tprivate function _update_default_vary( $uid = false, $expire = false ) {\n\t\t\/\/ Make sure header output only run once\n\t\tif (!defined('LITESPEED_DID_' . __FUNCTION__)) {\n\t\t\tdefine('LITESPEED_DID_' . __FUNCTION__, true);\n\t\t} else {\n\t\t\tself::debug2('_update_default_vary bypassed due to run already');\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ ESI shouldn't change vary (Let main page do only)\n\t\tif (defined('LSCACHE_IS_ESI') && LSCACHE_IS_ESI) {\n\t\t\tself::debug2('_update_default_vary bypassed due to ESI');\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ If the cookie is lost somehow, set it\n\t\t$vary         = $this->finalize_default_vary($uid);\n\t\t$current_vary = self::has_vary();\n\t\tif ($current_vary !== $vary && $current_vary !== 'commenter' && $this->can_change_vary()) {\n\t\t\t\/\/ $_COOKIE[ self::$_vary_name ] = $vary; \/\/ not needed\n\n\t\t\t\/\/ save it\n\t\t\tif (!$expire) {\n\t\t\t\t$expire = time() + 2 * DAY_IN_SECONDS;\n\t\t\t}\n\t\t\t$this->_cookie($vary, $expire);\n\t\t\t\/\/ Control::set_nocache( 'changing default vary' . \" $current_vary => $vary\" );\n\t\t}\n\t}\n\n\t\/**\n\t * Get vary name\n\t *\n\t * @since 1.9.1\n\t * @access public\n\t *\/\n\tpublic function get_vary_name() {\n\t\treturn self::$_vary_name;\n\t}\n\n\t\/**\n\t * Check if one user role is in vary group settings\n\t *\n\t * @since 1.2.0\n\t * @since  3.0 Moved here from conf.cls\n\t * @access public\n\t * @param  string $role The user role\n\t * @return int       The set value if already set\n\t *\/\n\tpublic function in_vary_group( $role ) {\n\t\t$group       = 0;\n\t\t$vary_groups = $this->conf(Base::O_CACHE_VARY_GROUP);\n\n\t\t$roles = explode(',', $role);\n\t\tif ($found = array_intersect($roles, array_keys($vary_groups))) {\n\t\t\t$groups = array();\n\t\t\tforeach ($found as $curr_role) {\n\t\t\t\t$groups[] = $vary_groups[$curr_role];\n\t\t\t}\n\t\t\t$group = implode(',', array_unique($groups));\n\t\t} elseif (in_array('administrator', $roles)) {\n\t\t\t$group = 99;\n\t\t}\n\n\t\tif ($group) {\n\t\t\tself::debug2('role in vary_group [group] ' . $group);\n\t\t}\n\n\t\treturn $group;\n\t}\n\n\t\/**\n\t * Finalize default Vary Cookie\n\t *\n\t *  Get user vary tag based on admin_bar & role\n\t *\n\t * NOTE: Login process will also call this because it does not call wp hook as normal page loading\n\t *\n\t * @since 1.6.2\n\t * @access public\n\t *\/\n\tpublic function finalize_default_vary( $uid = false ) {\n\t\t\/\/ Must check this to bypass vary generation for guests\n\t\t\/\/ Must check this to avoid Guest page's CSS\/JS\/CCSS\/UCSS get non-guest vary filename\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$vary = array();\n\n\t\tif ($this->conf(Base::O_GUEST)) {\n\t\t\t$vary['guest_mode'] = 1;\n\t\t}\n\n\t\tif (!$uid) {\n\t\t\t$uid = get_current_user_id();\n\t\t} else {\n\t\t\tself::debug('uid: ' . $uid);\n\t\t}\n\n\t\t\/\/ get user's group id\n\t\t$role = Router::get_role($uid);\n\n\t\tif ($uid > 0 && $role) {\n\t\t\t$vary['logged-in'] = 1;\n\n\t\t\t\/\/ parse role group from settings\n\t\t\tif ($role_group = $this->in_vary_group($role)) {\n\t\t\t\t$vary['role'] = $role_group;\n\t\t\t}\n\n\t\t\t\/\/ Get admin bar set\n\t\t\t\/\/ see @_get_admin_bar_pref()\n\t\t\t$pref = get_user_option('show_admin_bar_front', $uid);\n\t\t\tself::debug2('show_admin_bar_front: ' . $pref);\n\t\t\t$admin_bar = $pref === false || $pref === 'true';\n\n\t\t\tif ($admin_bar) {\n\t\t\t\t$vary['admin_bar'] = 1;\n\t\t\t\tself::debug2('admin bar : true');\n\t\t\t}\n\t\t} else {\n\t\t\t\/\/ Guest user\n\t\t\tself::debug('role id: failed, guest');\n\t\t}\n\n\t\t\/**\n\t\t * Add filter\n\t\t *\n\t\t * @since 1.6 Added for Role Excludes for optimization cls\n\t\t * @since 1.6.2 Hooked to webp (checked in v4, no webp anymore)\n\t\t * @since 3.0 Used by 3rd hooks too\n\t\t *\/\n\t\t$vary = apply_filters('litespeed_vary', $vary);\n\n\t\tif (!$vary) {\n\t\t\treturn false;\n\t\t}\n\n\t\tksort($vary);\n\t\t$res = array();\n\t\tforeach ($vary as $key => $val) {\n\t\t\t$res[] = $key . ':' . $val;\n\t\t}\n\n\t\t$res = implode(';', $res);\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\treturn $res;\n\t\t}\n\t\t\/\/ Encrypt in production\n\t\treturn md5($this->conf(Base::HASH) . $res);\n\t}\n\n\t\/**\n\t * Get the hash of all vary related values\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function finalize_full_varies() {\n\t\t$vary  = $this->_finalize_curr_vary_cookies(true);\n\t\t$vary .= $this->finalize_default_vary(get_current_user_id());\n\t\t$vary .= $this->get_env_vary();\n\t\treturn $vary;\n\t}\n\n\t\/**\n\t * Get request environment Vary\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function get_env_vary() {\n\t\t$env_vary = isset($_SERVER['LSCACHE_VARY_VALUE']) ? $_SERVER['LSCACHE_VARY_VALUE'] : false;\n\t\tif (!$env_vary) {\n\t\t\t$env_vary = isset($_SERVER['HTTP_X_LSCACHE_VARY_VALUE']) ? $_SERVER['HTTP_X_LSCACHE_VARY_VALUE'] : false;\n\t\t}\n\t\treturn $env_vary;\n\t}\n\n\t\/**\n\t * Append user status with commenter\n\t *\n\t * This is ONLY used when submit a comment\n\t *\n\t * @since 1.1.6\n\t * @access public\n\t *\/\n\tpublic function append_commenter() {\n\t\t$this->add_commenter(true);\n\t}\n\n\t\/**\n\t * Correct user status with commenter\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param  boolean $from_redirect If the request is from redirect page or not\n\t *\/\n\tprivate function add_commenter( $from_redirect = false ) {\n\t\t\/\/ If the cookie is lost somehow, set it\n\t\tif (self::has_vary() !== 'commenter') {\n\t\t\tself::debug('Add commenter');\n\t\t\t\/\/ $_COOKIE[ self::$_vary_name ] = 'commenter'; \/\/ not needed\n\n\t\t\t\/\/ save it\n\t\t\t\/\/ only set commenter status for current domain path\n\t\t\t$this->_cookie('commenter', time() + apply_filters('comment_cookie_lifetime', 30000000), self::_relative_path($from_redirect));\n\t\t\t\/\/ Control::set_nocache( 'adding commenter status' );\n\t\t}\n\t}\n\n\t\/**\n\t * Remove user commenter status\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t *\/\n\tprivate function remove_commenter() {\n\t\tif (self::has_vary() === 'commenter') {\n\t\t\tself::debug('Remove commenter');\n\t\t\t\/\/ remove logged in status from global var\n\t\t\t\/\/ unset( $_COOKIE[ self::$_vary_name ] ); \/\/ not needed\n\n\t\t\t\/\/ save it\n\t\t\t$this->_cookie(false, false, self::_relative_path());\n\t\t\t\/\/ Control::set_nocache( 'removing commenter status' );\n\t\t}\n\t}\n\n\t\/**\n\t * Generate relative path for cookie\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param  boolean $from_redirect If the request is from redirect page or not\n\t *\/\n\tprivate static function _relative_path( $from_redirect = false ) {\n\t\t$path = false;\n\t\t$tag  = $from_redirect ? 'HTTP_REFERER' : 'SCRIPT_URL';\n\t\tif (!empty($_SERVER[$tag])) {\n\t\t\t$path = parse_url($_SERVER[$tag]);\n\t\t\t$path = !empty($path['path']) ? $path['path'] : false;\n\t\t\tself::debug('Cookie Vary path: ' . $path);\n\t\t}\n\t\treturn $path;\n\t}\n\n\t\/**\n\t * Builds the vary header.\n\t *\n\t * NOTE: Non caccheable page can still set vary ( for logged in process )\n\t *\n\t * Currently, this only checks post passwords and 3rd party.\n\t *\n\t * @since 1.0.13\n\t * @access public\n\t * @global $post\n\t * @return mixed false if the user has the postpass cookie. Empty string if the post is not password protected. Vary header otherwise.\n\t *\/\n\tpublic function finalize() {\n\t\t\/\/ Finalize default vary\n\t\tif (!defined('LITESPEED_GUEST') || !LITESPEED_GUEST) {\n\t\t\t$this->_update_default_vary();\n\t\t}\n\n\t\t$tp_cookies = $this->_finalize_curr_vary_cookies();\n\n\t\tif (!$tp_cookies) {\n\t\t\tself::debug2('no custimzed vary');\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('finalized 3rd party cookies', $tp_cookies);\n\n\t\treturn self::X_HEADER . ': ' . implode(',', $tp_cookies);\n\t}\n\n\t\/**\n\t * Gets vary cookies or their values unique hash that are already added for the current page.\n\t *\n\t * @since 1.0.13\n\t * @access private\n\t * @return array List of all vary cookies currently added.\n\t *\/\n\tprivate function _finalize_curr_vary_cookies( $values_json = false ) {\n\t\tglobal $post;\n\n\t\t$cookies = array(); \/\/ No need to append default vary cookie name\n\n\t\tif (!empty($post->post_password)) {\n\t\t\t$postpass_key = 'wp-postpass_' . COOKIEHASH;\n\t\t\tif ($this->_get_cookie_val($postpass_key)) {\n\t\t\t\tself::debug('finalize bypassed due to password protected vary ');\n\t\t\t\t\/\/ If user has password cookie, do not cache & ignore existing vary cookies\n\t\t\t\tControl::set_nocache('password protected vary');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$cookies[] = $values_json ? $this->_get_cookie_val($postpass_key) : $postpass_key;\n\t\t}\n\n\t\t$cookies = apply_filters('litespeed_vary_curr_cookies', $cookies);\n\t\tif ($cookies) {\n\t\t\t$cookies = array_filter(array_unique($cookies));\n\t\t\tself::debug('vary cookies changed by filter litespeed_vary_curr_cookies', $cookies);\n\t\t}\n\n\t\tif (!$cookies) {\n\t\t\treturn false;\n\t\t}\n\t\t\/\/ Format cookie name data or value data\n\t\tsort($cookies); \/\/ This is to maintain the cookie val orders for $values_json=true case.\n\t\tforeach ($cookies as $k => $v) {\n\t\t\t$cookies[$k] = $values_json ? $this->_get_cookie_val($v) : 'cookie=' . $v;\n\t\t}\n\n\t\treturn $values_json ? \\json_encode($cookies) : $cookies;\n\t}\n\n\t\/**\n\t * Get one vary cookie value\n\t *\n\t * @since  4.0\n\t *\/\n\tprivate function _get_cookie_val( $key ) {\n\t\tif (!empty($_COOKIE[$key])) {\n\t\t\treturn $_COOKIE[$key];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Set the vary cookie.\n\t *\n\t * If vary cookie changed, must set non cacheable.\n\t *\n\t * @since 1.0.4\n\t * @access private\n\t * @param int|false $val    The value to update.\n\t * @param int       $expire Expire time.\n\t * @param bool      $path   False if use wp root path as cookie path\n\t *\/\n\tprivate function _cookie( $val = false, $expire = 0, $path = false ) {\n\t\tif (!$val) {\n\t\t\t$expire = 1;\n\t\t}\n\n\t\t\/**\n\t\t * Add HTTPS bypass in case clients use both HTTP and HTTPS version of site\n\t\t *\n\t\t * @since 1.7\n\t\t *\/\n\t\t$is_ssl = $this->conf(Base::O_UTIL_NO_HTTPS_VARY) ? false : is_ssl();\n\n\t\tsetcookie(self::$_vary_name, $val, $expire, $path ?: COOKIEPATH, COOKIE_DOMAIN, $is_ssl, true);\n\t\tself::debug('set_cookie ---> [k] ' . self::$_vary_name . \" [v] $val [ttl] \" . ($expire - time()));\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/placeholder.cls.php","ext":"php","size":14527,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The PlaceHolder class\n *\n * @since       3.0\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Placeholder extends Base {\n\n\tconst TYPE_GENERATE = 'generate';\n\tconst TYPE_CLEAR_Q  = 'clear_q';\n\n\tprivate $_conf_placeholder_resp;\n\tprivate $_conf_placeholder_resp_svg;\n\tprivate $_conf_lqip;\n\tprivate $_conf_lqip_qual;\n\tprivate $_conf_lqip_min_w;\n\tprivate $_conf_lqip_min_h;\n\tprivate $_conf_placeholder_resp_color;\n\tprivate $_conf_placeholder_resp_async;\n\tprivate $_conf_ph_default;\n\tprivate $_placeholder_resp_dict = array();\n\tprivate $_ph_queue              = array();\n\n\tprotected $_summary;\n\n\t\/**\n\t * Init\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function __construct() {\n\t\t$this->_conf_placeholder_resp       = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_MEDIA_PLACEHOLDER_RESP);\n\t\t$this->_conf_placeholder_resp_svg   = $this->conf(self::O_MEDIA_PLACEHOLDER_RESP_SVG);\n\t\t$this->_conf_lqip                   = !defined('LITESPEED_GUEST_OPTM') && $this->conf(self::O_MEDIA_LQIP);\n\t\t$this->_conf_lqip_qual              = $this->conf(self::O_MEDIA_LQIP_QUAL);\n\t\t$this->_conf_lqip_min_w             = $this->conf(self::O_MEDIA_LQIP_MIN_W);\n\t\t$this->_conf_lqip_min_h             = $this->conf(self::O_MEDIA_LQIP_MIN_H);\n\t\t$this->_conf_placeholder_resp_async = $this->conf(self::O_MEDIA_PLACEHOLDER_RESP_ASYNC);\n\t\t$this->_conf_placeholder_resp_color = $this->conf(self::O_MEDIA_PLACEHOLDER_RESP_COLOR);\n\t\t$this->_conf_ph_default             = $this->conf(self::O_MEDIA_LAZY_PLACEHOLDER) ?: LITESPEED_PLACEHOLDER;\n\n\t\t$this->_summary = self::get_summary();\n\t}\n\n\t\/**\n\t * Init Placeholder\n\t *\/\n\tpublic function init() {\n\t\tDebug2::debug2('[LQIP] init');\n\n\t\tadd_action('litespeed_after_admin_init', array( $this, 'after_admin_init' ));\n\t}\n\n\t\/**\n\t * Display column in Media\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function after_admin_init() {\n\t\tif ($this->_conf_lqip) {\n\t\t\tadd_filter('manage_media_columns', array( $this, 'media_row_title' ));\n\t\t\tadd_filter('manage_media_custom_column', array( $this, 'media_row_actions' ), 10, 2);\n\t\t\tadd_action('litespeed_media_row_lqip', array( $this, 'media_row_con' ));\n\t\t}\n\t}\n\n\t\/**\n\t * Media Admin Menu -> LQIP col\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function media_row_title( $posts_columns ) {\n\t\t$posts_columns['lqip'] = __('LQIP', 'litespeed-cache');\n\n\t\treturn $posts_columns;\n\t}\n\n\t\/**\n\t * Media Admin Menu -> LQIP Column\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic function media_row_actions( $column_name, $post_id ) {\n\t\tif ($column_name !== 'lqip') {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_media_row_lqip', $post_id);\n\t}\n\n\t\/**\n\t * Display LQIP column\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function media_row_con( $post_id ) {\n\t\t$meta_value = wp_get_attachment_metadata($post_id);\n\n\t\tif (empty($meta_value['file'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$total_files = 0;\n\n\t\t\/\/ List all sizes\n\t\t$all_sizes = array( $meta_value['file'] );\n\t\t$size_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\tforeach ($meta_value['sizes'] as $v) {\n\t\t\t$all_sizes[] = $size_path . $v['file'];\n\t\t}\n\n\t\tforeach ($all_sizes as $short_path) {\n\t\t\t$lqip_folder = LITESPEED_STATIC_DIR . '\/lqip\/' . $short_path;\n\n\t\t\tif (is_dir($lqip_folder)) {\n\t\t\t\tDebug2::debug('[LQIP] Found folder: ' . $short_path);\n\n\t\t\t\t\/\/ List all files\n\t\t\t\tforeach (scandir($lqip_folder) as $v) {\n\t\t\t\t\tif ($v == '.' || $v == '..') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($total_files == 0) {\n\t\t\t\t\t\techo '<div class=\"litespeed-media-lqip\"><img src=\"' .\n\t\t\t\t\t\t\tStr::trim_quotes(File::read($lqip_folder . '\/' . $v)) .\n\t\t\t\t\t\t\t'\" alt=\"' .\n\t\t\t\t\t\t\tsprintf(__('LQIP image preview for size %s', 'litespeed-cache'), $v) .\n\t\t\t\t\t\t\t'\"><\/div>';\n\t\t\t\t\t}\n\n\t\t\t\t\techo '<div class=\"litespeed-media-size\"><a href=\"' . Str::trim_quotes(File::read($lqip_folder . '\/' . $v)) . '\" target=\"_blank\">' . $v . '<\/a><\/div>';\n\n\t\t\t\t\t++$total_files;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ($total_files == 0) {\n\t\t\techo '\u2014';\n\t\t}\n\t}\n\n\t\/**\n\t * Replace image with placeholder\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function replace( $html, $src, $size ) {\n\t\t\/\/ Check if need to enable responsive placeholder or not\n\t\t$this_placeholder = $this->_placeholder($src, $size) ?: $this->_conf_ph_default;\n\n\t\t$additional_attr = '';\n\t\tif ($this->_conf_lqip && $this_placeholder != $this->_conf_ph_default) {\n\t\t\tDebug2::debug2('[LQIP] Use resp LQIP [size] ' . $size);\n\t\t\t$additional_attr = ' data-placeholder-resp=\"' . Str::trim_quotes($size) . '\"';\n\t\t}\n\n\t\t$snippet = defined('LITESPEED_GUEST_OPTM') || $this->conf(self::O_OPTM_NOSCRIPT_RM) ? '' : '<noscript>' . $html . '<\/noscript>';\n\t\t$html    = str_replace(array( ' src=', ' srcset=', ' sizes=' ), array( ' data-src=', ' data-srcset=', ' data-sizes=' ), $html);\n\t\t$html    = str_replace('<img ', '<img data-lazyloaded=\"1\"' . $additional_attr . ' src=\"' . Str::trim_quotes($this_placeholder) . '\" ', $html);\n\t\t$snippet = $html . $snippet;\n\n\t\treturn $snippet;\n\t}\n\n\t\/**\n\t * Generate responsive placeholder\n\t *\n\t * @since  2.5.1\n\t * @access private\n\t *\/\n\tprivate function _placeholder( $src, $size ) {\n\t\t\/\/ Low Quality Image Placeholders\n\t\tif (!$size) {\n\t\t\tDebug2::debug2('[LQIP] no size ' . $src);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$this->_conf_placeholder_resp) {\n\t\t\treturn false;\n\t\t}\n\n\t\t\/\/ If use local generator\n\t\tif (!$this->_conf_lqip || !$this->_lqip_size_check($size)) {\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\tDebug2::debug2('[LQIP] Resp LQIP process [src] ' . $src . ' [size] ' . $size);\n\n\t\t$arr_key = $size . ' ' . $src;\n\n\t\t\/\/ Check if its already in dict or not\n\t\tif (!empty($this->_placeholder_resp_dict[$arr_key])) {\n\t\t\tDebug2::debug2('[LQIP] already in dict');\n\n\t\t\treturn $this->_placeholder_resp_dict[$arr_key];\n\t\t}\n\n\t\t\/\/ Need to generate the responsive placeholder\n\t\t$placeholder_realpath = $this->_placeholder_realpath($src, $size); \/\/ todo: give offload API\n\t\tif (file_exists($placeholder_realpath)) {\n\t\t\tDebug2::debug2('[LQIP] file exists');\n\t\t\t$this->_placeholder_resp_dict[$arr_key] = File::read($placeholder_realpath);\n\n\t\t\treturn $this->_placeholder_resp_dict[$arr_key];\n\t\t}\n\n\t\t\/\/ Add to cron queue\n\n\t\t\/\/ Prevent repeated requests\n\t\tif (in_array($arr_key, $this->_ph_queue)) {\n\t\t\tDebug2::debug2('[LQIP] file bypass generating due to in queue');\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\tif ($hit = Utility::str_hit_array($src, $this->conf(self::O_MEDIA_LQIP_EXC))) {\n\t\t\tDebug2::debug2('[LQIP] file bypass generating due to exclude setting [hit] ' . $hit);\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\t$this->_ph_queue[] = $arr_key;\n\n\t\t\/\/ Send request to generate placeholder\n\t\tif (!$this->_conf_placeholder_resp_async) {\n\t\t\t\/\/ If requested recently, bypass\n\t\t\tif ($this->_summary && !empty($this->_summary['curr_request']) && time() - $this->_summary['curr_request'] < 300) {\n\t\t\t\tDebug2::debug2('[LQIP] file bypass generating due to interval limit');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\/\/ Generate immediately\n\t\t\t$this->_placeholder_resp_dict[$arr_key] = $this->_generate_placeholder($arr_key);\n\n\t\t\treturn $this->_placeholder_resp_dict[$arr_key];\n\t\t}\n\n\t\t\/\/ Prepare default svg placeholder as tmp placeholder\n\t\t$tmp_placeholder = $this->_generate_placeholder_locally($size);\n\n\t\t\/\/ Store it to prepare for cron\n\t\t$queue = $this->load_queue('lqip');\n\t\tif (in_array($arr_key, $queue)) {\n\t\t\tDebug2::debug2('[LQIP] already in queue');\n\n\t\t\treturn $tmp_placeholder;\n\t\t}\n\n\t\tif (count($queue) > 500) {\n\t\t\tDebug2::debug2('[LQIP] queue is full');\n\n\t\t\treturn $tmp_placeholder;\n\t\t}\n\n\t\t$queue[] = $arr_key;\n\t\t$this->save_queue('lqip', $queue);\n\t\tDebug2::debug('[LQIP] Added placeholder queue');\n\n\t\treturn $tmp_placeholder;\n\t}\n\n\t\/**\n\t * Generate realpath of placeholder file\n\t *\n\t * @since  2.5.1\n\t * @access private\n\t *\/\n\tprivate function _placeholder_realpath( $src, $size ) {\n\t\t\/\/ Use LQIP Cloud generator, each image placeholder will be separately stored\n\n\t\t\/\/ Compatibility with WebP and AVIF\n\t\t$src = Utility::drop_webp($src);\n\n\t\t$filepath_prefix = $this->_build_filepath_prefix('lqip');\n\n\t\t\/\/ External images will use cache folder directly\n\t\t$domain = parse_url($src, PHP_URL_HOST);\n\t\tif ($domain && !Utility::internal($domain)) {\n\t\t\t\/\/ todo: need to improve `util:internal()` to include `CDN::internal()`\n\t\t\t$md5 = md5($src);\n\n\t\t\treturn LITESPEED_STATIC_DIR . $filepath_prefix . 'remote\/' . substr($md5, 0, 1) . '\/' . substr($md5, 1, 1) . '\/' . $md5 . '.' . $size;\n\t\t}\n\n\t\t\/\/ Drop domain\n\t\t$short_path = Utility::att_short_path($src);\n\n\t\treturn LITESPEED_STATIC_DIR . $filepath_prefix . $short_path . '\/' . $size;\n\t}\n\n\t\/**\n\t * Cron placeholder generation\n\t *\n\t * @since  2.5.1\n\t * @access public\n\t *\/\n\tpublic static function cron( $continue = false ) {\n\t\t$_instance = self::cls();\n\n\t\t$queue = $_instance->load_queue('lqip');\n\n\t\tif (empty($queue)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ For cron, need to check request interval too\n\t\tif (!$continue) {\n\t\t\tif (!empty($_instance->_summary['curr_request']) && time() - $_instance->_summary['curr_request'] < 300) {\n\t\t\t\tDebug2::debug('[LQIP] Last request not done');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tforeach ($queue as $v) {\n\t\t\tDebug2::debug('[LQIP] cron job [size] ' . $v);\n\n\t\t\t$res = $_instance->_generate_placeholder($v, true);\n\n\t\t\t\/\/ Exit queue if out of quota\n\t\t\tif ($res === 'out_of_quota') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t\/\/ only request first one\n\t\t\tif (!$continue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Generate placeholder locally\n\t *\n\t * @since  3.0\n\t * @access private\n\t *\/\n\tprivate function _generate_placeholder_locally( $size ) {\n\t\tDebug2::debug2('[LQIP] _generate_placeholder local [size] ' . $size);\n\n\t\t$size = explode('x', $size);\n\n\t\t$svg = str_replace(array( '{width}', '{height}', '{color}' ), array( $size[0], $size[1], $this->_conf_placeholder_resp_color ), $this->_conf_placeholder_resp_svg);\n\n\t\treturn 'data:image\/svg+xml;base64,' . base64_encode($svg);\n\t}\n\n\t\/**\n\t * Send to LiteSpeed API to generate placeholder\n\t *\n\t * @since  2.5.1\n\t * @access private\n\t *\/\n\tprivate function _generate_placeholder( $raw_size_and_src, $from_cron = false ) {\n\t\t\/\/ Parse containing size and src info\n\t\t$size_and_src = explode(' ', $raw_size_and_src, 2);\n\t\t$size         = $size_and_src[0];\n\n\t\tif (empty($size_and_src[1])) {\n\t\t\t$this->_popup_and_save($raw_size_and_src);\n\t\t\tDebug2::debug('[LQIP] \u274c No src [raw] ' . $raw_size_and_src);\n\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t}\n\n\t\t$src = $size_and_src[1];\n\n\t\t$file = $this->_placeholder_realpath($src, $size);\n\n\t\t\/\/ Local generate SVG to serve ( Repeatedly doing this here to remove stored cron queue in case the setting _conf_lqip is changed )\n\t\tif (!$this->_conf_lqip || !$this->_lqip_size_check($size)) {\n\t\t\t$data = $this->_generate_placeholder_locally($size);\n\t\t} else {\n\t\t\t$err       = false;\n\t\t\t$allowance = Cloud::cls()->allowance(Cloud::SVC_LQIP, $err);\n\t\t\tif (!$allowance) {\n\t\t\t\tDebug2::debug('[LQIP] \u274c No credit: ' . $err);\n\t\t\t\t$err && Admin_Display::error(Error::msg($err));\n\n\t\t\t\tif ($from_cron) {\n\t\t\t\t\treturn 'out_of_quota';\n\t\t\t\t}\n\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\t\/\/ Generate LQIP\n\t\t\tlist($width, $height) = explode('x', $size);\n\t\t\t$req_data             = array(\n\t\t\t\t'width' => $width,\n\t\t\t\t'height' => $height,\n\t\t\t\t'url' => Utility::drop_webp($src),\n\t\t\t\t'quality' => $this->_conf_lqip_qual,\n\t\t\t);\n\n\t\t\t\/\/ CHeck if the image is 404 first\n\t\t\tif (File::is_404($req_data['url'])) {\n\t\t\t\t$this->_popup_and_save($raw_size_and_src, true);\n\t\t\t\t$this->_append_exc($src);\n\t\t\t\tDebug2::debug('[LQIP] 404 before request [src] ' . $req_data['url']);\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\t\/\/ Update request status\n\t\t\t$this->_summary['curr_request'] = time();\n\t\t\tself::save_summary();\n\n\t\t\t$json = Cloud::post(Cloud::SVC_LQIP, $req_data, 120);\n\t\t\tif (!is_array($json)) {\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\tif (empty($json['lqip']) || strpos($json['lqip'], 'data:image\/svg+xml') !== 0) {\n\t\t\t\t\/\/ image error, pop up the current queue\n\t\t\t\t$this->_popup_and_save($raw_size_and_src, true);\n\t\t\t\t$this->_append_exc($src);\n\t\t\t\tDebug2::debug('[LQIP] wrong response format', $json);\n\n\t\t\t\treturn $this->_generate_placeholder_locally($size);\n\t\t\t}\n\n\t\t\t$data = $json['lqip'];\n\n\t\t\tDebug2::debug('[LQIP] _generate_placeholder LQIP');\n\t\t}\n\n\t\t\/\/ Write to file\n\t\tFile::save($file, $data, true);\n\n\t\t\/\/ Save summary data\n\t\t$this->_summary['last_spent']   = time() - $this->_summary['curr_request'];\n\t\t$this->_summary['last_request'] = $this->_summary['curr_request'];\n\t\t$this->_summary['curr_request'] = 0;\n\t\tself::save_summary();\n\t\t$this->_popup_and_save($raw_size_and_src);\n\n\t\tDebug2::debug('[LQIP] saved LQIP ' . $file);\n\n\t\treturn $data;\n\t}\n\n\t\/**\n\t * Check if the size is valid to send LQIP request or not\n\t *\n\t * @since  3.0\n\t *\/\n\tprivate function _lqip_size_check( $size ) {\n\t\t$size = explode('x', $size);\n\t\tif ($size[0] >= $this->_conf_lqip_min_w || $size[1] >= $this->_conf_lqip_min_h) {\n\t\t\treturn true;\n\t\t}\n\n\t\tDebug2::debug2('[LQIP] Size too small');\n\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Add to LQIP exclude list\n\t *\n\t * @since  3.4\n\t *\/\n\tprivate function _append_exc( $src ) {\n\t\t$val   = $this->conf(self::O_MEDIA_LQIP_EXC);\n\t\t$val[] = $src;\n\t\t$this->cls('Conf')->update(self::O_MEDIA_LQIP_EXC, $val);\n\t\tDebug2::debug('[LQIP] Appended to LQIP Excludes [URL] ' . $src);\n\t}\n\n\t\/**\n\t * Pop up the current request and save\n\t *\n\t * @since  3.0\n\t *\/\n\tprivate function _popup_and_save( $raw_size_and_src, $append_to_exc = false ) {\n\t\t$queue = $this->load_queue('lqip');\n\t\tif (!empty($queue) && in_array($raw_size_and_src, $queue)) {\n\t\t\tunset($queue[array_search($raw_size_and_src, $queue)]);\n\t\t}\n\n\t\tif ($append_to_exc) {\n\t\t\t$size_and_src = explode(' ', $raw_size_and_src, 2);\n\t\t\t$this_src     = $size_and_src[1];\n\n\t\t\t\/\/ Append to lqip exc setting first\n\t\t\t$this->_append_exc($this_src);\n\n\t\t\t\/\/ Check if other queues contain this src or not\n\t\t\tif ($queue) {\n\t\t\t\tforeach ($queue as $k => $raw_size_and_src) {\n\t\t\t\t\t$size_and_src = explode(' ', $raw_size_and_src, 2);\n\t\t\t\t\tif (empty($size_and_src[1])) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($size_and_src[1] == $this_src) {\n\t\t\t\t\t\tunset($queue[$k]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t$this->save_queue('lqip', $queue);\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  2.5.1\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_GENERATE:\n            self::cron(true);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CLEAR_Q:\n            $this->clear_q('lqip');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/img-optm.cls.php","ext":"php","size":65816,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The class to optimize image.\n *\n * @since       2.0\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\nuse WpOrg\\Requests\\Autoload;\nuse WpOrg\\Requests\\Requests;\n\ndefined('WPINC') || exit();\n\nclass Img_Optm extends Base {\n\n\tconst LOG_TAG = '\ud83d\udddc\ufe0f';\n\n\tconst CLOUD_ACTION_NEW_REQ         = 'new_req';\n\tconst CLOUD_ACTION_TAKEN           = 'taken';\n\tconst CLOUD_ACTION_REQUEST_DESTROY = 'imgoptm_destroy';\n\tconst CLOUD_ACTION_CLEAN           = 'clean';\n\n\tconst TYPE_NEW_REQ           = 'new_req';\n\tconst TYPE_RESCAN            = 'rescan';\n\tconst TYPE_DESTROY           = 'destroy';\n\tconst TYPE_RESET_COUNTER     = 'reset_counter';\n\tconst TYPE_CLEAN             = 'clean';\n\tconst TYPE_PULL              = 'pull';\n\tconst TYPE_BATCH_SWITCH_ORI  = 'batch_switch_ori';\n\tconst TYPE_BATCH_SWITCH_OPTM = 'batch_switch_optm';\n\tconst TYPE_CALC_BKUP         = 'calc_bkup';\n\tconst TYPE_RESET_ROW         = 'reset_row';\n\tconst TYPE_RM_BKUP           = 'rm_bkup';\n\n\tconst STATUS_NEW        = 0; \/\/ 'new';\n\tconst STATUS_RAW        = 1; \/\/ 'raw';\n\tconst STATUS_REQUESTED  = 3; \/\/ 'requested';\n\tconst STATUS_NOTIFIED   = 6; \/\/ 'notified';\n\tconst STATUS_DUPLICATED = 8; \/\/ 'duplicated';\n\tconst STATUS_PULLED     = 9; \/\/ 'pulled';\n\tconst STATUS_FAILED     = -1; \/\/ 'failed';\n\tconst STATUS_MISS       = -3; \/\/ 'miss';\n\tconst STATUS_ERR_FETCH  = -5; \/\/ 'err_fetch';\n\tconst STATUS_ERR_404    = -6; \/\/ 'err_404';\n\tconst STATUS_ERR_OPTM   = -7; \/\/ 'err_optm';\n\tconst STATUS_XMETA      = -8; \/\/ 'xmeta';\n\tconst STATUS_ERR        = -9; \/\/ 'err';\n\tconst DB_SIZE           = 'litespeed-optimize-size';\n\tconst DB_SET            = 'litespeed-optimize-set';\n\n\tconst DB_NEED_PULL = 'need_pull';\n\n\tprivate $wp_upload_dir;\n\tprivate $tmp_pid;\n\tprivate $tmp_type;\n\tprivate $tmp_path;\n\tprivate $_img_in_queue     = array();\n\tprivate $_existed_src_list = array();\n\tprivate $_pids_set         = array();\n\tprivate $_thumbnail_set    = '';\n\tprivate $_table_img_optm;\n\tprivate $_table_img_optming;\n\tprivate $_cron_ran = false;\n\n\tprivate $__media;\n\tprivate $__data;\n\tprotected $_summary;\n\tprivate $_format = '';\n\n\t\/**\n\t * Init\n\t *\n\t * @since  2.0\n\t *\/\n\tpublic function __construct() {\n\t\tDebug2::debug2('[ImgOptm] init');\n\n\t\t$this->wp_upload_dir      = wp_upload_dir();\n\t\t$this->__media            = $this->cls('Media');\n\t\t$this->__data             = $this->cls('Data');\n\t\t$this->_table_img_optm    = $this->__data->tb('img_optm');\n\t\t$this->_table_img_optming = $this->__data->tb('img_optming');\n\n\t\t$this->_summary = self::get_summary();\n\t\tif (empty($this->_summary['next_post_id'])) {\n\t\t\t$this->_summary['next_post_id'] = 0;\n\t\t}\n\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP)) {\n\t\t\t$this->_format = 'webp';\n\t\t\tif ($this->conf(Base::O_IMG_OPTM_WEBP) == 2) {\n\t\t\t\t$this->_format = 'avif';\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Gather images auto when update attachment meta\n\t * This is to optimize new uploaded images first. Stored in img_optm table.\n\t * Later normal process will auto remove these records when trying to optimize these images again\n\t *\n\t * @since  4.0\n\t *\/\n\tpublic function wp_update_attachment_metadata( $meta_value, $post_id ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug2('\ud83d\udd8c\ufe0f Auto update attachment meta [id] ' . $post_id);\n\t\tif (empty($meta_value['file'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Load gathered images\n\t\tif (!$this->_existed_src_list) {\n\t\t\t\/\/ To aavoid extra query when recalling this function\n\t\t\tself::debug('SELECT src from img_optm table');\n\t\t\tif ($this->__data->tb_exist('img_optm')) {\n\t\t\t\t$q    = \"SELECT src FROM `$this->_table_img_optm` WHERE post_id = %d\";\n\t\t\t\t$list = $wpdb->get_results($wpdb->prepare($q, $post_id));\n\t\t\t\tforeach ($list as $v) {\n\t\t\t\t\t$this->_existed_src_list[] = $post_id . '.' . $v->src;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($this->__data->tb_exist('img_optming')) {\n\t\t\t\t$q    = \"SELECT src FROM `$this->_table_img_optming` WHERE post_id = %d\";\n\t\t\t\t$list = $wpdb->get_results($wpdb->prepare($q, $post_id));\n\t\t\t\tforeach ($list as $v) {\n\t\t\t\t\t$this->_existed_src_list[] = $post_id . '.' . $v->src;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$this->__data->tb_create('img_optming');\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Prepare images\n\t\t$this->tmp_pid  = $post_id;\n\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t$this->_append_img_queue($meta_value, true);\n\t\tif (!empty($meta_value['sizes'])) {\n\t\t\tarray_map(array( $this, '_append_img_queue' ), $meta_value['sizes']);\n\t\t}\n\n\t\tif (!$this->_img_in_queue) {\n\t\t\tself::debug('auto update attachment meta 2 bypass: empty _img_in_queue');\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Save to DB\n\t\t$this->_save_raw();\n\n\t\t\/\/ $this->_send_request();\n\t}\n\n\t\/**\n\t * Auto send optm request\n\t *\n\t * @since  2.4.1\n\t * @access public\n\t *\/\n\tpublic static function cron_auto_request() {\n\t\tif (!wp_doing_cron()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$instance = self::cls();\n\t\t$instance->new_req();\n\t}\n\n\t\/**\n\t * Calculate wet run allowance\n\t *\n\t * @since 3.0\n\t *\/\n\tpublic function wet_limit() {\n\t\t$wet_limit = 1;\n\t\tif (!empty($this->_summary['img_taken'])) {\n\t\t\t$wet_limit = pow($this->_summary['img_taken'], 2);\n\t\t}\n\n\t\tif ($wet_limit == 1 && !empty($this->_summary['img_status.' . self::STATUS_ERR_OPTM])) {\n\t\t\t$wet_limit = pow($this->_summary['img_status.' . self::STATUS_ERR_OPTM], 2);\n\t\t}\n\n\t\tif ($wet_limit < Cloud::IMG_OPTM_DEFAULT_GROUP) {\n\t\t\treturn $wet_limit;\n\t\t}\n\n\t\t\/\/ No limit\n\t\treturn false;\n\t}\n\n\t\/**\n\t * Push raw img to image optm server\n\t *\n\t * @since 1.6\n\t * @access public\n\t *\/\n\tpublic function new_req() {\n\t\tglobal $wpdb;\n\n\t\t\/\/ check if is running\n\t\tif (!empty($this->_summary['is_running']) && time() - $this->_summary['is_running'] < apply_filters('litespeed_imgoptm_new_req_interval', 3600)) {\n\t\t\tself::debug('The previous req was in 3600s.');\n\t\t\treturn;\n\t\t}\n\t\t$this->_summary['is_running'] = time();\n\t\tself::save_summary();\n\n\t\t\/\/ Check if has credit to push\n\t\t$err       = false;\n\t\t$allowance = Cloud::cls()->allowance(Cloud::SVC_IMG_OPTM, $err);\n\n\t\t$wet_limit = $this->wet_limit();\n\n\t\tself::debug(\"allowance_max $allowance wet_limit $wet_limit\");\n\t\tif ($wet_limit && $wet_limit < $allowance) {\n\t\t\t$allowance = $wet_limit;\n\t\t}\n\n\t\tif (!$allowance) {\n\t\t\tself::debug('\u274c No credit');\n\t\t\tAdmin_Display::error(Error::msg($err));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('preparing images to push');\n\n\t\t$this->__data->tb_create('img_optming');\n\n\t\t$q               = \"SELECT COUNT(1) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t$q               = $wpdb->prepare($q, array( self::STATUS_REQUESTED ));\n\t\t$total_requested = $wpdb->get_var($q);\n\t\t$max_requested   = $allowance * 1;\n\n\t\tif ($total_requested > $max_requested) {\n\t\t\tself::debug('\u274c Too many queued images (' . $total_requested . ' > ' . $max_requested . ')');\n\t\t\tAdmin_Display::error(Error::msg('too_many_requested'));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\t$allowance -= $total_requested;\n\n\t\tif ($allowance < 1) {\n\t\t\tself::debug('\u274c Too many requested images ' . $total_requested);\n\t\t\tAdmin_Display::error(Error::msg('too_many_requested'));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Limit maximum number of items waiting to be pulled\n\t\t$q              = \"SELECT COUNT(1) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t$q              = $wpdb->prepare($q, array( self::STATUS_NOTIFIED ));\n\t\t$total_notified = $wpdb->get_var($q);\n\t\tif ($total_notified > 0) {\n\t\t\tself::debug('\u274c Too many notified images (' . $total_notified . ')');\n\t\t\tAdmin_Display::error(Error::msg('too_many_notified'));\n\t\t\t$this->_finished_running();\n\t\t\treturn;\n\t\t}\n\n\t\t$q         = \"SELECT COUNT(1) FROM `$this->_table_img_optming` WHERE optm_status IN (%d, %d)\";\n\t\t$q         = $wpdb->prepare($q, array( self::STATUS_NEW, self::STATUS_RAW ));\n\t\t$total_new = $wpdb->get_var($q);\n\t\t\/\/ $allowance -= $total_new;\n\n\t\t\/\/ May need to get more images\n\t\t$list = array();\n\t\t$more = $allowance - $total_new;\n\t\tif ($more > 0) {\n\t\t\t$q    = \"SELECT b.post_id, b.meta_value\n\t\t\t\tFROM `$wpdb->posts` a\n\t\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\t\tAND a.ID>%d\n\t\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\t\tORDER BY a.ID\n\t\t\t\tLIMIT %d\n\t\t\t\t\";\n\t\t\t$q    = $wpdb->prepare($q, array( $this->_summary['next_post_id'], $more ));\n\t\t\t$list = $wpdb->get_results($q);\n\t\t\tforeach ($list as $v) {\n\t\t\t\tif (!$v->post_id) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t$this->_summary['next_post_id'] = $v->post_id;\n\n\t\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\t\tif (!$meta_value) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$meta_value['file'] = wp_normalize_path($meta_value['file']);\n\t\t\t\t$basedir            = $this->wp_upload_dir['basedir'] . '\/';\n\t\t\t\tif (strpos($meta_value['file'], $basedir) === 0) {\n\t\t\t\t\t$meta_value['file'] = substr($meta_value['file'], strlen($basedir));\n\t\t\t\t}\n\n\t\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t\t$this->_append_img_queue($meta_value, true);\n\t\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\t\tarray_map(array( $this, '_append_img_queue' ), $meta_value['sizes']);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself::save_summary();\n\n\t\t\t$num_a = count($this->_img_in_queue);\n\t\t\tself::debug('Images found: ' . $num_a);\n\t\t\t$this->_filter_duplicated_src();\n\t\t\tself::debug('Images after duplicated: ' . count($this->_img_in_queue));\n\t\t\t$this->_filter_invalid_src();\n\t\t\tself::debug('Images after invalid: ' . count($this->_img_in_queue));\n\t\t\t\/\/ Check w\/ legacy imgoptm table, bypass finished images\n\t\t\t$this->_filter_legacy_src();\n\n\t\t\t$num_b = count($this->_img_in_queue);\n\t\t\tif ($num_b != $num_a) {\n\t\t\t\tself::debug('Images after filtered duplicated\/invalid\/legacy src: ' . $num_b);\n\t\t\t}\n\n\t\t\t\/\/ Save to DB\n\t\t\t$this->_save_raw();\n\t\t}\n\n\t\t\/\/ Push to Cloud server\n\t\t$accepted_imgs = $this->_send_request($allowance);\n\n\t\t$this->_finished_running();\n\t\tif (!$accepted_imgs) {\n\t\t\treturn;\n\t\t}\n\n\t\t$placeholder1 = Admin_Display::print_plural($accepted_imgs[0], 'image');\n\t\t$placeholder2 = Admin_Display::print_plural($accepted_imgs[1], 'image');\n\t\t$msg          = sprintf(__('Pushed %1$s to Cloud server, accepted %2$s.', 'litespeed-cache'), $placeholder1, $placeholder2);\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Set running to done\n\t *\/\n\tprivate function _finished_running() {\n\t\t$this->_summary['is_running'] = 0;\n\t\tself::save_summary();\n\t}\n\n\t\/**\n\t * Add a new img to queue which will be pushed to request\n\t *\n\t * @since 1.6\n\t * @access private\n\t *\/\n\tprivate function _append_img_queue( $meta_value, $is_ori_file = false ) {\n\t\tif (empty($meta_value['file']) || empty($meta_value['width']) || empty($meta_value['height'])) {\n\t\t\tself::debug2('bypass image due to lack of file\/w\/h: pid ' . $this->tmp_pid, $meta_value);\n\t\t\treturn;\n\t\t}\n\n\t\t$short_file_path = $meta_value['file'];\n\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t\/\/ Check if src is gathered already or not\n\t\tif (in_array($this->tmp_pid . '.' . $short_file_path, $this->_existed_src_list)) {\n\t\t\t\/\/ Debug2::debug2( '[Img_Optm] bypass image due to gathered: pid ' . $this->tmp_pid . ' ' . $short_file_path );\n\t\t\treturn;\n\t\t} else {\n\t\t\t\/\/ Append handled images\n\t\t\t$this->_existed_src_list[] = $this->tmp_pid . '.' . $short_file_path;\n\t\t}\n\n\t\t\/\/ check file exists or not\n\t\t$_img_info = $this->__media->info($short_file_path, $this->tmp_pid);\n\n\t\t$extension = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\tif (!$_img_info || !in_array($extension, array( 'jpg', 'jpeg', 'png', 'gif' ))) {\n\t\t\tself::debug2('bypass image due to file not exist: pid ' . $this->tmp_pid . ' ' . $short_file_path);\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Check if optimized file exists or not\n\t\t$target_needed = false;\n\t\tif ($this->_format) {\n\t\t\t$target_file_path = $short_file_path . '.' . $this->_format;\n\t\t\tif (!$this->__media->info($target_file_path, $this->tmp_pid)) {\n\t\t\t\t$target_needed = true;\n\t\t\t}\n\t\t}\n\t\tif ($this->conf(self::O_IMG_OPTM_ORI)) {\n\t\t\t$target_file_path = substr($short_file_path, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\tif (!$this->__media->info($target_file_path, $this->tmp_pid)) {\n\t\t\t\t$target_needed = true;\n\t\t\t}\n\t\t}\n\t\tif (!$target_needed) {\n\t\t\tself::debug2('bypass image due to optimized file exists: pid ' . $this->tmp_pid . ' ' . $short_file_path);\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Debug2::debug2( '[Img_Optm] adding image: pid ' . $this->tmp_pid );\n\n\t\t$this->_img_in_queue[] = array(\n\t\t\t'pid' => $this->tmp_pid,\n\t\t\t'md5' => $_img_info['md5'],\n\t\t\t'url' => $_img_info['url'],\n\t\t\t'src' => $short_file_path, \/\/ not needed in LiteSpeed IAPI, just leave for local storage after post\n\t\t\t'mime_type' => !empty($meta_value['mime-type']) ? $meta_value['mime-type'] : '',\n\t\t);\n\t}\n\n\t\/**\n\t * Save gathered image raw data\n\t *\n\t * @since  3.0\n\t *\/\n\tprivate function _save_raw() {\n\t\tif (empty($this->_img_in_queue)) {\n\t\t\treturn;\n\t\t}\n\t\t$data     = array();\n\t\t$pid_list = array();\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\t$_img_info = $this->__media->info($v['src'], $v['pid']);\n\n\t\t\t\/\/ attachment doesn't exist, delete the record\n\t\t\tif (empty($_img_info['url']) || empty($_img_info['md5'])) {\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$pid_list[] = (int) $v['pid'];\n\n\t\t\t$data[] = $v['pid'];\n\t\t\t$data[] = self::STATUS_RAW;\n\t\t\t$data[] = $v['src'];\n\t\t}\n\n\t\tglobal $wpdb;\n\t\t$fields = 'post_id, optm_status, src';\n\t\t$q      = \"INSERT INTO `$this->_table_img_optming` ( $fields ) VALUES \";\n\n\t\t\/\/ Add placeholder\n\t\t$q .= Utility::chunk_placeholder($data, $fields);\n\n\t\t\/\/ Store data\n\t\t$wpdb->query($wpdb->prepare($q, $data));\n\n\t\t$count = count($this->_img_in_queue);\n\t\tself::debug('Added raw images [total] ' . $count);\n\n\t\t$this->_img_in_queue = array();\n\n\t\t\/\/ Save thumbnail groups for future rescan index\n\t\t$this->_gen_thumbnail_set();\n\n\t\t$pid_list = array_unique($pid_list);\n\t\tself::debug('pid list to append to postmeta', $pid_list);\n\t\t$pid_list        = array_diff($pid_list, $this->_pids_set);\n\t\t$this->_pids_set = array_merge($this->_pids_set, $pid_list);\n\n\t\t$existed_meta = $wpdb->get_results(\"SELECT * FROM `$wpdb->postmeta` WHERE post_id IN ('\" . implode(\"','\", $pid_list) . \"') AND meta_key='\" . self::DB_SET . \"'\");\n\t\t$existed_pid  = array();\n\t\tif ($existed_meta) {\n\t\t\tforeach ($existed_meta as $v) {\n\t\t\t\t$existed_pid[] = $v->post_id;\n\t\t\t}\n\t\t\tself::debug('pid list to update postmeta', $existed_pid);\n\t\t\t$wpdb->query(\n\t\t\t\t$wpdb->prepare(\"UPDATE `$wpdb->postmeta` SET meta_value=%s WHERE post_id IN ('\" . implode(\"','\", $existed_pid) . \"') AND meta_key=%s\", array(\n\t\t\t\t\t$this->_thumbnail_set,\n\t\t\t\t\tself::DB_SET,\n\t\t\t\t))\n\t\t\t);\n\t\t}\n\n\t\t\/\/ Add new meta\n\t\t$new_pids = $existed_pid ? array_diff($pid_list, $existed_pid) : $pid_list;\n\t\tif ($new_pids) {\n\t\t\tself::debug('pid list to update postmeta', $new_pids);\n\t\t\tforeach ($new_pids as $v) {\n\t\t\t\tself::debug('New group set info [pid] ' . $v);\n\t\t\t\t$q = \"INSERT INTO `$wpdb->postmeta` (post_id, meta_key, meta_value) VALUES (%d, %s, %s)\";\n\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $v, self::DB_SET, $this->_thumbnail_set )));\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Generate thumbnail sets of current image group\n\t *\n\t * @since 5.4\n\t *\/\n\tprivate function _gen_thumbnail_set() {\n\t\tif ($this->_thumbnail_set) {\n\t\t\treturn;\n\t\t}\n\t\t$set = array();\n\t\tforeach (Media::cls()->get_image_sizes() as $size) {\n\t\t\t$curr_size = $size['width'] . 'x' . $size['height'];\n\t\t\tif (in_array($curr_size, $set)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$set[] = $curr_size;\n\t\t}\n\t\t$this->_thumbnail_set = implode(PHP_EOL, $set);\n\t}\n\n\t\/**\n\t * Filter duplicated src in work table and $this->_img_in_queue, then mark them as duplicated\n\t *\n\t * @since 2.0\n\t * @access private\n\t *\/\n\tprivate function _filter_duplicated_src() {\n\t\tglobal $wpdb;\n\n\t\t$srcpath_list = array();\n\n\t\t$list = $wpdb->get_results(\"SELECT src FROM `$this->_table_img_optming`\");\n\t\tforeach ($list as $v) {\n\t\t\t$srcpath_list[] = $v->src;\n\t\t}\n\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\tif (in_array($v['src'], $srcpath_list)) {\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$srcpath_list[] = $v['src'];\n\t\t}\n\t}\n\n\t\/**\n\t * Filter legacy finished ones\n\t *\n\t * @since 5.4\n\t *\/\n\tprivate function _filter_legacy_src() {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->__data->tb_exist('img_optm')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$this->_img_in_queue) {\n\t\t\treturn;\n\t\t}\n\n\t\t$finished_ids = array();\n\n\t\tUtility::compatibility();\n\t\t$post_ids = array_unique(array_column($this->_img_in_queue, 'pid'));\n\t\t$list     = $wpdb->get_results(\"SELECT post_id FROM `$this->_table_img_optm` WHERE post_id in (\" . implode(',', $post_ids) . ') GROUP BY post_id');\n\t\tforeach ($list as $v) {\n\t\t\t$finished_ids[] = $v->post_id;\n\t\t}\n\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\tif (in_array($v['pid'], $finished_ids)) {\n\t\t\t\tself::debug('Legacy image optimized [pid] ' . $v['pid']);\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Drop all existing legacy records\n\t\t$wpdb->query(\"DELETE FROM `$this->_table_img_optm` WHERE post_id in (\" . implode(',', $post_ids) . ')');\n\t}\n\n\t\/**\n\t * Filter the invalid src before sending\n\t *\n\t * @since 3.0.8.3\n\t * @access private\n\t *\/\n\tprivate function _filter_invalid_src() {\n\t\t$img_in_queue_invalid = array();\n\t\tforeach ($this->_img_in_queue as $k => $v) {\n\t\t\tif ($v['src']) {\n\t\t\t\t$extension = pathinfo($v['src'], PATHINFO_EXTENSION);\n\t\t\t}\n\t\t\tif (!$v['src'] || empty($extension) || !in_array($extension, array( 'jpg', 'jpeg', 'png', 'gif' ))) {\n\t\t\t\t$img_in_queue_invalid[] = $v['id'];\n\t\t\t\tunset($this->_img_in_queue[$k]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tif (!$img_in_queue_invalid) {\n\t\t\treturn;\n\t\t}\n\n\t\t$count = count($img_in_queue_invalid);\n\t\t$msg   = sprintf(__('Cleared %1$s invalid images.', 'litespeed-cache'), $count);\n\t\tAdmin_Display::success($msg);\n\n\t\tself::debug('Found invalid src [total] ' . $count);\n\t}\n\n\t\/**\n\t * Push img request to Cloud server\n\t *\n\t * @since 1.6.7\n\t * @access private\n\t *\/\n\tprivate function _send_request( $allowance ) {\n\t\tglobal $wpdb;\n\n\t\t$q             = \"SELECT id, src, post_id FROM `$this->_table_img_optming` WHERE optm_status=%d LIMIT %d\";\n\t\t$q             = $wpdb->prepare($q, array( self::STATUS_RAW, $allowance ));\n\t\t$_img_in_queue = $wpdb->get_results($q);\n\t\tif (!$_img_in_queue) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Load img in queue [total] ' . count($_img_in_queue));\n\n\t\t$list = array();\n\t\tforeach ($_img_in_queue as $v) {\n\t\t\t$_img_info = $this->__media->info($v->src, $v->post_id);\n\t\t\t\/\/ If record is invalid, remove from img_optming table\n\t\t\tif (empty($_img_info['url']) || empty($_img_info['md5'])) {\n\t\t\t\t$wpdb->query($wpdb->prepare(\"DELETE FROM `$this->_table_img_optming` WHERE id=%d\", $v->id));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$img = array(\n\t\t\t\t'id' => $v->id,\n\t\t\t\t'url' => $_img_info['url'],\n\t\t\t\t'md5' => $_img_info['md5'],\n\t\t\t);\n\t\t\t\/\/ Build the needed image types for request as we now support soft reset counter\n\t\t\tif ($this->_format) {\n\t\t\t\t$target_file_path = $v->src . '.' . $this->_format;\n\t\t\t\tif ($this->__media->info($target_file_path, $v->post_id)) {\n\t\t\t\t\t$img['optm_' . $this->_format] = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($this->conf(self::O_IMG_OPTM_ORI)) {\n\t\t\t\t$extension        = pathinfo($v->src, PATHINFO_EXTENSION);\n\t\t\t\t$target_file_path = substr($v->src, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\t\tif ($this->__media->info($target_file_path, $v->post_id)) {\n\t\t\t\t\t$img['optm_ori'] = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$list[] = $img;\n\t\t}\n\n\t\tif (!$list) {\n\t\t\t$msg = __('No valid image found in the current request.', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn;\n\t\t}\n\n\t\t$data = array(\n\t\t\t'action' => self::CLOUD_ACTION_NEW_REQ,\n\t\t\t'list' => \\json_encode($list),\n\t\t\t'optm_ori' => $this->conf(self::O_IMG_OPTM_ORI) ? 1 : 0,\n\t\t\t'optm_lossless' => $this->conf(self::O_IMG_OPTM_LOSSLESS) ? 1 : 0,\n\t\t\t'keep_exif' => $this->conf(self::O_IMG_OPTM_EXIF) ? 1 : 0,\n\t\t);\n\t\tif ($this->_format) {\n\t\t\t$data['optm_' . $this->_format] = 1;\n\t\t}\n\n\t\t\/\/ Push to Cloud server\n\t\t$json = Cloud::post(Cloud::SVC_IMG_OPTM, $data);\n\t\tif (!$json) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Check data format\n\t\tif (empty($json['ids'])) {\n\t\t\tself::debug('Failed to parse response data from Cloud server ', $json);\n\t\t\t$msg = __('No valid image found by Cloud server in the current request.', 'litespeed-cache');\n\t\t\tAdmin_Display::error($msg);\n\t\t\treturn;\n\t\t}\n\n\t\tself::debug('Returned data from Cloud server count: ' . count($json['ids']));\n\n\t\t$ids = implode(',', array_map('intval', $json['ids']));\n\t\t\/\/ Update img table\n\t\t$q = \"UPDATE `$this->_table_img_optming` SET optm_status = '\" . self::STATUS_REQUESTED . \"' WHERE id IN ( $ids )\";\n\t\t$wpdb->query($q);\n\n\t\t$this->_summary['last_requested'] = time();\n\t\tself::save_summary();\n\n\t\treturn array( count($list), count($json['ids']) );\n\t}\n\n\t\/**\n\t * Cloud server notify Client img status changed\n\t *\n\t * @access public\n\t *\/\n\tpublic function notify_img() {\n\t\t\/\/ Interval validation to avoid hacking domain_key\n\t\tif (!empty($this->_summary['notify_ts_err']) && time() - $this->_summary['notify_ts_err'] < 3) {\n\t\t\treturn Cloud::err('too_often');\n\t\t}\n\n\t\t$post_data = \\json_decode(file_get_contents('php:\/\/input'), true);\n\t\tif (is_null($post_data)) {\n\t\t\t$post_data = $_POST;\n\t\t}\n\n\t\tglobal $wpdb;\n\n\t\t$notified_data = $post_data['data'];\n\t\tif (empty($notified_data) || !is_array($notified_data)) {\n\t\t\tself::debug('\u274c notify exit: no notified data');\n\t\t\treturn Cloud::err('no notified data');\n\t\t}\n\n\t\tif (empty($post_data['server']) || (substr($post_data['server'], -11) !== '.quic.cloud' && substr($post_data['server'], -15) !== '.quicserver.com')) {\n\t\t\tself::debug('notify exit: no\/wrong server');\n\t\t\treturn Cloud::err('no\/wrong server');\n\t\t}\n\n\t\tif (empty($post_data['status'])) {\n\t\t\tself::debug('notify missing status');\n\t\t\treturn Cloud::err('no status');\n\t\t}\n\n\t\t$status = $post_data['status'];\n\t\tself::debug('notified status=' . $status);\n\n\t\t$last_log_pid = 0;\n\n\t\tif (empty($this->_summary['reduced'])) {\n\t\t\t$this->_summary['reduced'] = 0;\n\t\t}\n\n\t\tif ($status == self::STATUS_NOTIFIED) {\n\t\t\t\/\/ Notified data format: [ img_optm_id => [ id=>, src_size=>, ori=>, ori_md5=>, ori_reduced=>, webp=>, webp_md5=>, webp_reduced=> ] ]\n\t\t\t$q                               =\n\t\t\t\t\"SELECT a.*, b.meta_id as b_meta_id, b.meta_value AS b_optm_info\n\t\t\t\t\tFROM `$this->_table_img_optming` a\n\t\t\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.post_id AND b.meta_key = %s\n\t\t\t\t\tWHERE a.id IN ( \" .\n\t\t\t\timplode(',', array_fill(0, count($notified_data), '%d')) .\n\t\t\t\t' )';\n\t\t\t$list                            = $wpdb->get_results($wpdb->prepare($q, array_merge(array( self::DB_SIZE ), array_keys($notified_data))));\n\t\t\t$ls_optm_size_row_exists_postids = array();\n\t\t\tforeach ($list as $v) {\n\t\t\t\t$json = $notified_data[$v->id];\n\t\t\t\t\/\/ self::debug('Notified data for [id] ' . $v->id, $json);\n\n\t\t\t\t$server = !empty($json['server']) ? $json['server'] : $post_data['server'];\n\n\t\t\t\t$server_info = array(\n\t\t\t\t\t'server' => $server,\n\t\t\t\t);\n\n\t\t\t\t\/\/ Save server side ID to send taken notification after pulled\n\t\t\t\t$server_info['id'] = $json['id'];\n\t\t\t\tif (!empty($json['file_id'])) {\n\t\t\t\t\t$server_info['file_id'] = $json['file_id'];\n\t\t\t\t}\n\n\t\t\t\t\/\/ Optm info array\n\t\t\t\t$postmeta_info = array(\n\t\t\t\t\t'ori_total' => 0,\n\t\t\t\t\t'ori_saved' => 0,\n\t\t\t\t\t'webp_total' => 0,\n\t\t\t\t\t'webp_saved' => 0,\n\t\t\t\t\t'avif_total' => 0,\n\t\t\t\t\t'avif_saved' => 0,\n\t\t\t\t);\n\t\t\t\t\/\/ Init postmeta_info for the first one\n\t\t\t\tif (!empty($v->b_meta_id)) {\n\t\t\t\t\tforeach (maybe_unserialize($v->b_optm_info) as $k2 => $v2) {\n\t\t\t\t\t\t$postmeta_info[$k2] += $v2;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!empty($json['ori'])) {\n\t\t\t\t\t$server_info['ori_md5'] = $json['ori_md5'];\n\t\t\t\t\t$server_info['ori']     = $json['ori'];\n\n\t\t\t\t\t\/\/ Append meta info\n\t\t\t\t\t$postmeta_info['ori_total'] += $json['src_size'];\n\t\t\t\t\t$postmeta_info['ori_saved'] += $json['ori_reduced']; \/\/ optimized image size info in img_optm tb will be updated when pull\n\n\t\t\t\t\t$this->_summary['reduced'] += $json['ori_reduced'];\n\t\t\t\t}\n\n\t\t\t\tif (!empty($json['webp'])) {\n\t\t\t\t\t$server_info['webp_md5'] = $json['webp_md5'];\n\t\t\t\t\t$server_info['webp']     = $json['webp'];\n\n\t\t\t\t\t\/\/ Append meta info\n\t\t\t\t\t$postmeta_info['webp_total'] += $json['src_size'];\n\t\t\t\t\t$postmeta_info['webp_saved'] += $json['webp_reduced'];\n\n\t\t\t\t\t$this->_summary['reduced'] += $json['webp_reduced'];\n\t\t\t\t}\n\n\t\t\t\tif (!empty($json['avif'])) {\n\t\t\t\t\t$server_info['avif_md5'] = $json['avif_md5'];\n\t\t\t\t\t$server_info['avif']     = $json['avif'];\n\n\t\t\t\t\t\/\/ Append meta info\n\t\t\t\t\t$postmeta_info['avif_total'] += $json['src_size'];\n\t\t\t\t\t$postmeta_info['avif_saved'] += $json['avif_reduced'];\n\n\t\t\t\t\t$this->_summary['reduced'] += $json['avif_reduced'];\n\t\t\t\t}\n\n\t\t\t\t\/\/ Update status and data in working table\n\t\t\t\t$q = \"UPDATE `$this->_table_img_optming` SET optm_status = %d, server_info = %s WHERE id = %d \";\n\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $status, \\json_encode($server_info), $v->id )));\n\n\t\t\t\t\/\/ Update postmeta for optm summary\n\t\t\t\t$postmeta_info = serialize($postmeta_info);\n\t\t\t\tif (empty($v->b_meta_id) && !in_array($v->post_id, $ls_optm_size_row_exists_postids)) {\n\t\t\t\t\tself::debug('New size info [pid] ' . $v->post_id);\n\t\t\t\t\t$q = \"INSERT INTO `$wpdb->postmeta` ( post_id, meta_key, meta_value ) VALUES ( %d, %s, %s )\";\n\t\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $v->post_id, self::DB_SIZE, $postmeta_info )));\n\t\t\t\t\t$ls_optm_size_row_exists_postids[] = $v->post_id;\n\t\t\t\t} else {\n\t\t\t\t\t$q = \"UPDATE `$wpdb->postmeta` SET meta_value = %s WHERE meta_id = %d \";\n\t\t\t\t\t$wpdb->query($wpdb->prepare($q, array( $postmeta_info, $v->b_meta_id )));\n\t\t\t\t}\n\n\t\t\t\t\/\/ write log\n\t\t\t\t$pid_log = $last_log_pid == $v->post_id ? '.' : $v->post_id;\n\t\t\t\tself::debug('notify_img [status] ' . $status . \" \\t\\t[pid] \" . $pid_log . \" \\t\\t[id] \" . $v->id);\n\t\t\t\t$last_log_pid = $v->post_id;\n\t\t\t}\n\n\t\t\tself::save_summary();\n\n\t\t\t\/\/ Mark need_pull tag for cron\n\t\t\tself::update_option(self::DB_NEED_PULL, self::STATUS_NOTIFIED);\n\t\t} else {\n\t\t\t\/\/ Other errors will directly remove the working records\n\t\t\t\/\/ Delete from working table\n\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id IN ( \" . implode(',', array_fill(0, count($notified_data), '%d')) . ' ) ';\n\t\t\t$wpdb->query($wpdb->prepare($q, $notified_data));\n\t\t}\n\n\t\treturn Cloud::ok(array( 'count' => count($notified_data) ));\n\t}\n\n\t\/**\n\t * Cron start async req\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function start_async_cron() {\n\t\tTask::async_call('imgoptm');\n\t}\n\n\t\/**\n\t * Manually start async req\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function start_async() {\n\t\tTask::async_call('imgoptm_force');\n\n\t\t$msg = __('Started async image optimization request', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Check if need to pull or not\n\t *\n\t * @since 7.2\n\t *\/\n\tpublic static function need_pull() {\n\t\t$tag = self::get_option(self::DB_NEED_PULL);\n\t\tif (!$tag || $tag != self::STATUS_NOTIFIED) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t\/**\n\t * Ajax req handler\n\t *\n\t * @since 5.5\n\t *\/\n\tpublic static function async_handler( $force = false ) {\n\t\tself::debug('------------async-------------start_async_handler');\n\n\t\tif (!self::need_pull()) {\n\t\t\tself::debug('\u274c no need pull');\n\t\t\treturn;\n\t\t}\n\n\t\tif (defined('LITESPEED_IMG_OPTM_PULL_CRON') && !LITESPEED_IMG_OPTM_PULL_CRON) {\n\t\t\tself::debug('Cron disabled [define] LITESPEED_IMG_OPTM_PULL_CRON');\n\t\t\treturn;\n\t\t}\n\n\t\tself::cls()->pull($force);\n\t}\n\n\t\/**\n\t * Calculate pull threads\n\t *\n\t * @since  5.8\n\t * @access private\n\t *\/\n\tprivate function _calc_pull_threads() {\n\t\tglobal $wpdb;\n\n\t\tif (defined('LITESPEED_IMG_OPTM_PULL_THREADS')) {\n\t\t\treturn LITESPEED_IMG_OPTM_PULL_THREADS;\n\t\t}\n\n\t\t\/\/ Tune number of images per request based on number of images waiting and cloud packages\n\t\t$imgs_per_req = 1; \/\/ base 1, ramp up to ~50 max\n\n\t\t\/\/ Ramp up the request rate based on how many images are waiting\n\t\t$c              = \"SELECT count(id) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t$_c             = $wpdb->prepare($c, array( self::STATUS_NOTIFIED ));\n\t\t$images_waiting = $wpdb->get_var($_c);\n\t\tif ($images_waiting && $images_waiting > 0) {\n\t\t\t$imgs_per_req = ceil($images_waiting \/ 1000); \/\/ ie. download 5\/request if 5000 images are waiting\n\t\t}\n\n\t\t\/\/ Cap the request rate at 50 images per request\n\t\t$imgs_per_req = min(50, $imgs_per_req);\n\n\t\tself::debug('Pulling images at rate: ' . $imgs_per_req . ' Images per request.');\n\n\t\treturn $imgs_per_req;\n\t}\n\n\t\/**\n\t * Pull optimized img\n\t *\n\t * @since  1.6\n\t * @access public\n\t *\/\n\tpublic function pull( $manual = false ) {\n\t\tglobal $wpdb;\n\t\t$timeoutLimit = ini_get('max_execution_time');\n\t\t$endts        = time() + $timeoutLimit;\n\n\t\tself::debug('' . ($manual ? 'Manually' : 'Cron') . ' pull started [timeout: ' . $timeoutLimit . 's]');\n\n\t\tif ($this->cron_running()) {\n\t\t\tself::debug('Pull cron is running');\n\n\t\t\t$msg = __('Pull Cron is running', 'litespeed-cache');\n\t\t\tAdmin_Display::note($msg);\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_summary['last_pulled']         = time();\n\t\t$this->_summary['last_pulled_by_cron'] = !$manual;\n\t\tself::save_summary();\n\n\t\t$imgs_per_req = $this->_calc_pull_threads();\n\t\t$q            = \"SELECT * FROM `$this->_table_img_optming` WHERE optm_status = %d ORDER BY id LIMIT %d\";\n\t\t$_q           = $wpdb->prepare($q, array( self::STATUS_NOTIFIED, $imgs_per_req ));\n\n\t\t$rm_ori_bkup = $this->conf(self::O_IMG_OPTM_RM_BKUP);\n\n\t\t$total_pulled_ori  = 0;\n\t\t$total_pulled_webp = 0;\n\t\t$total_pulled_avif = 0;\n\n\t\t$server_list = array();\n\n\t\ttry {\n\t\t\twhile ($img_rows = $wpdb->get_results($_q)) {\n\t\t\t\tself::debug('timeout left: ' . ($endts - time()) . 's');\n\t\t\t\tif (function_exists('set_time_limit')) {\n\t\t\t\t\t$endts += 600;\n\t\t\t\t\tself::debug('Endtime extended to ' . date('Ymd H:i:s', $endts));\n\t\t\t\t\tset_time_limit(600); \/\/ This will be no more important as we use noabort now\n\t\t\t\t}\n\t\t\t\t\/\/ Disabled as we use noabort\n\t\t\t\t\/\/ if ($endts - time() < 10) {\n\t\t\t\t\/\/ self::debug(\"\ud83d\udea8 End loop due to timeout limit reached \" . $timeoutLimit . \"s\");\n\t\t\t\t\/\/ break;\n\t\t\t\t\/\/ }\n\n\t\t\t\t\/**\n\t\t\t\t * Update cron timestamp to avoid duplicated running\n\t\t\t\t *\n\t\t\t\t * @since  1.6.2\n\t\t\t\t *\/\n\t\t\t\t$this->_update_cron_running();\n\n\t\t\t\t\/\/ Run requests in parallel\n\t\t\t\t$requests    = array(); \/\/ store each request URL for Requests::request_multiple()\n\t\t\t\t$imgs_by_req = array(); \/\/ store original request data so that we can reference it in the response\n\t\t\t\t$req_counter = 0;\n\t\t\t\tforeach ($img_rows as $row_img) {\n\t\t\t\t\t\/\/ request original image\n\t\t\t\t\t$server_info = \\json_decode($row_img->server_info, true);\n\t\t\t\t\tif (!empty($server_info['ori'])) {\n\t\t\t\t\t\t$image_url = $server_info['server'] . '\/' . $server_info['ori'];\n\t\t\t\t\t\tself::debug('Queueing pull: ' . $image_url);\n\t\t\t\t\t\t$requests[$req_counter]      = array(\n\t\t\t\t\t\t\t'url' => $image_url,\n\t\t\t\t\t\t\t'type' => 'GET',\n\t\t\t\t\t\t);\n\t\t\t\t\t\t$imgs_by_req[$req_counter++] = array(\n\t\t\t\t\t\t\t'type' => 'ori',\n\t\t\t\t\t\t\t'data' => $row_img,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t\/\/ request webp image\n\t\t\t\t\t$webp_size = 0;\n\t\t\t\t\tif (!empty($server_info['webp'])) {\n\t\t\t\t\t\t$image_url = $server_info['server'] . '\/' . $server_info['webp'];\n\t\t\t\t\t\tself::debug('Queueing pull WebP: ' . $image_url);\n\t\t\t\t\t\t$requests[$req_counter]      = array(\n\t\t\t\t\t\t\t'url' => $image_url,\n\t\t\t\t\t\t\t'type' => 'GET',\n\t\t\t\t\t\t);\n\t\t\t\t\t\t$imgs_by_req[$req_counter++] = array(\n\t\t\t\t\t\t\t'type' => 'webp',\n\t\t\t\t\t\t\t'data' => $row_img,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t\/\/ request avif image\n\t\t\t\t\t$avif_size = 0;\n\t\t\t\t\tif (!empty($server_info['avif'])) {\n\t\t\t\t\t\t$image_url = $server_info['server'] . '\/' . $server_info['avif'];\n\t\t\t\t\t\tself::debug('Queueing pull AVIF: ' . $image_url);\n\t\t\t\t\t\t$requests[$req_counter]      = array(\n\t\t\t\t\t\t\t'url' => $image_url,\n\t\t\t\t\t\t\t'type' => 'GET',\n\t\t\t\t\t\t);\n\t\t\t\t\t\t$imgs_by_req[$req_counter++] = array(\n\t\t\t\t\t\t\t'type' => 'avif',\n\t\t\t\t\t\t\t'data' => $row_img,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself::debug('Loaded images count: ' . $req_counter);\n\n\t\t\t\t$complete_action = function ( $response, $req_count ) use ( $imgs_by_req, $rm_ori_bkup, &$total_pulled_ori, &$total_pulled_webp, &$total_pulled_avif, &$server_list ) {\n\t\t\t\t\tglobal $wpdb;\n\t\t\t\t\t$row_data = isset($imgs_by_req[$req_count]) ? $imgs_by_req[$req_count] : false;\n\t\t\t\t\tif (false === $row_data) {\n\t\t\t\t\t\tself::debug('\u274c failed to pull image: Request not found in lookup variable.');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$row_type    = isset($row_data['type']) ? $row_data['type'] : 'ori';\n\t\t\t\t\t$row_img     = $row_data['data'];\n\t\t\t\t\t$local_file  = $this->wp_upload_dir['basedir'] . '\/' . $row_img->src;\n\t\t\t\t\t$server_info = \\json_decode($row_img->server_info, true);\n\n\t\t\t\t\t\/\/ Handle status_code 404\/5xx too as its success=true\n\t\t\t\t\tif ( empty( $response->success ) || empty( $response->status_code ) || 200 !== $response->status_code ) {\n\t\t\t\t\t\t$this->_step_back_image($row_img->id);\n\n\t\t\t\t\t\t$msg = __('Some optimized image file(s) has expired and was cleared.', 'litespeed-cache');\n\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ('webp' === $row_type) {\n\t\t\t\t\t\tfile_put_contents($local_file . '.webp', $response->body);\n\n\t\t\t\t\t\tif (!file_exists($local_file . '.webp') || !filesize($local_file . '.webp') || md5_file($local_file . '.webp') !== $server_info['webp_md5']) {\n\t\t\t\t\t\t\tself::debug('\u274c Failed to pull optimized webp img: file md5 mismatch, server md5: ' . $server_info['webp_md5']);\n\n\t\t\t\t\t\t\t\/\/ Delete working table\n\t\t\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\t\t$msg = __('Pulled WebP image md5 does not match the notified WebP image md5.', 'litespeed-cache');\n\t\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself::debug('Pulled optimized img WebP: ' . $local_file . '.webp');\n\n\t\t\t\t\t\t$webp_size = filesize($local_file . '.webp');\n\n\t\t\t\t\t\t\/**\n\t\t\t\t\t\t * API for WebP\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @since 2.9.5\n\t\t\t\t\t\t * @since  3.0 $row_img less elements (see above one)\n\t\t\t\t\t\t * @see #751737  - API docs for WEBP generation\n\t\t\t\t\t\t *\/\n\t\t\t\t\t\tdo_action('litespeed_img_pull_webp', $row_img, $local_file . '.webp');\n\n\t\t\t\t\t\t++$total_pulled_webp;\n\t\t\t\t\t} elseif ('avif' === $row_type) {\n\t\t\t\t\t\tfile_put_contents($local_file . '.avif', $response->body);\n\n\t\t\t\t\t\tif (!file_exists($local_file . '.avif') || !filesize($local_file . '.avif') || md5_file($local_file . '.avif') !== $server_info['avif_md5']) {\n\t\t\t\t\t\t\tself::debug('\u274c Failed to pull optimized avif img: file md5 mismatch, server md5: ' . $server_info['avif_md5']);\n\n\t\t\t\t\t\t\t\/\/ Delete working table\n\t\t\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\t\t$msg = __('Pulled AVIF image md5 does not match the notified AVIF image md5.', 'litespeed-cache');\n\t\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself::debug('Pulled optimized img AVIF: ' . $local_file . '.avif');\n\n\t\t\t\t\t\t$avif_size = filesize($local_file . '.avif');\n\n\t\t\t\t\t\t\/**\n\t\t\t\t\t\t * API for AVIF\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @since 7.0\n\t\t\t\t\t\t *\/\n\t\t\t\t\t\tdo_action('litespeed_img_pull_avif', $row_img, $local_file . '.avif');\n\n\t\t\t\t\t\t++$total_pulled_avif;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\/\/ \"ori\" image type\n\t\t\t\t\t\tfile_put_contents($local_file . '.tmp', $response->body);\n\n\t\t\t\t\t\tif (!file_exists($local_file . '.tmp') || !filesize($local_file . '.tmp') || md5_file($local_file . '.tmp') !== $server_info['ori_md5']) {\n\t\t\t\t\t\t\tself::debug(\n\t\t\t\t\t\t\t\t'\u274c Failed to pull optimized img: file md5 mismatch [url] ' .\n\t\t\t\t\t\t\t\t\t$server_info['server'] .\n\t\t\t\t\t\t\t\t\t'\/' .\n\t\t\t\t\t\t\t\t\t$server_info['ori'] .\n\t\t\t\t\t\t\t\t\t' [server_md5] ' .\n\t\t\t\t\t\t\t\t\t$server_info['ori_md5']\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\/\/ Delete working table\n\t\t\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\t\t$msg = __('One or more pulled images does not match with the notified image md5', 'litespeed-cache');\n\t\t\t\t\t\t\tAdmin_Display::error($msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\/\/ Backup ori img\n\t\t\t\t\t\tif (!$rm_ori_bkup) {\n\t\t\t\t\t\t\t$extension = pathinfo($local_file, PATHINFO_EXTENSION);\n\t\t\t\t\t\t\t$bk_file   = substr($local_file, 0, -strlen($extension)) . 'bk.' . $extension;\n\t\t\t\t\t\t\tfile_exists($local_file) && rename($local_file, $bk_file);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\/\/ Replace ori img\n\t\t\t\t\t\trename($local_file . '.tmp', $local_file);\n\n\t\t\t\t\t\tself::debug('Pulled optimized img: ' . $local_file);\n\n\t\t\t\t\t\t\/**\n\t\t\t\t\t\t * API Hook\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @since  2.9.5\n\t\t\t\t\t\t * @since  3.0 $row_img has less elements now. Most useful ones are `post_id`\/`src`\n\t\t\t\t\t\t *\/\n\t\t\t\t\t\tdo_action('litespeed_img_pull_ori', $row_img, $local_file);\n\n\t\t\t\t\t\tself::debug2('Remove _table_img_optming record [id] ' . $row_img->id);\n\t\t\t\t\t}\n\n\t\t\t\t\t\/\/ Delete working table\n\t\t\t\t\t$q = \"DELETE FROM `$this->_table_img_optming` WHERE id = %d \";\n\t\t\t\t\t$wpdb->query($wpdb->prepare($q, $row_img->id));\n\n\t\t\t\t\t\/\/ Save server_list to notify taken\n\t\t\t\t\tif (empty($server_list[$server_info['server']])) {\n\t\t\t\t\t\t$server_list[$server_info['server']] = array();\n\t\t\t\t\t}\n\n\t\t\t\t\t$server_info_id                        = !empty($server_info['file_id']) ? $server_info['file_id'] : $server_info['id'];\n\t\t\t\t\t$server_list[$server_info['server']][] = $server_info_id;\n\n\t\t\t\t\t++$total_pulled_ori;\n\t\t\t\t};\n\n\t\t\t\t$force_wp_remote_get = defined('LITESPEED_FORCE_WP_REMOTE_GET') && LITESPEED_FORCE_WP_REMOTE_GET;\n\t\t\t\tif (!$force_wp_remote_get && class_exists('\\WpOrg\\Requests\\Requests') && class_exists('\\WpOrg\\Requests\\Autoload') && version_compare(PHP_VERSION, '5.6.0', '>=')) {\n\t\t\t\t\t\/\/ Make sure Requests can load internal classes.\n\t\t\t\t\tAutoload::register();\n\n\t\t\t\t\t\/\/ Run pull requests in parallel\n\t\t\t\t\tRequests::request_multiple($requests, array(\n\t\t\t\t\t\t'timeout' => 60,\n\t\t\t\t\t\t'connect_timeout' => 60,\n\t\t\t\t\t\t'complete' => $complete_action,\n\t\t\t\t\t));\n\t\t\t\t} else {\n\t\t\t\t\tforeach ($requests as $cnt => $req) {\n\t\t\t\t\t\t$wp_response      = wp_safe_remote_get($req['url'], array( 'timeout' => 60 ));\n\t\t\t\t\t\t$request_response = array(\n\t\t\t\t\t\t\t'success' => false,\n\t\t\t\t\t\t\t'status_code' => 0,\n\t\t\t\t\t\t\t'body' => null,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (is_wp_error($wp_response)) {\n\t\t\t\t\t\t\t$error_message = $wp_response->get_error_message();\n\t\t\t\t\t\t\tself::debug('\u274c failed to pull image: ' . $error_message);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$request_response['success']     = true;\n\t\t\t\t\t\t\t$request_response['status_code'] = $wp_response['response']['code'];\n\t\t\t\t\t\t\t$request_response['body']        = $wp_response['body'];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself::debug('response code [code] ' . $wp_response['response']['code'] . ' [url] ' . $req['url']);\n\n\t\t\t\t\t\t$request_response = (object) $request_response;\n\n\t\t\t\t\t\t$complete_action($request_response, $cnt);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself::debug('Current batch pull finished');\n\t\t\t}\n\t\t} catch (\\Exception $e) {\n\t\t\tAdmin_Display::error('Image pull process failure: ' . $e->getMessage());\n\t\t}\n\n\t\t\/\/ Notify IAPI images taken\n\t\tforeach ($server_list as $server => $img_list) {\n\t\t\t$data = array(\n\t\t\t\t'action' => self::CLOUD_ACTION_TAKEN,\n\t\t\t\t'list' => $img_list,\n\t\t\t\t'server' => $server,\n\t\t\t);\n\t\t\t\/\/ TODO: improve this so we do not call once per server, but just once and then filter on the server side\n\t\t\tCloud::post(Cloud::SVC_IMG_OPTM, $data);\n\t\t}\n\n\t\tif (empty($this->_summary['img_taken'])) {\n\t\t\t$this->_summary['img_taken'] = 0;\n\t\t}\n\t\t$this->_summary['img_taken'] += $total_pulled_ori + $total_pulled_webp + $total_pulled_avif;\n\t\tself::save_summary();\n\n\t\t\/\/ Manually running needs to roll back timestamp for next running\n\t\tif ($manual) {\n\t\t\t$this->_update_cron_running(true);\n\t\t}\n\n\t\t\/\/ $msg = sprintf(__('Pulled %d image(s)', 'litespeed-cache'), $total_pulled_ori + $total_pulled_webp);\n\t\t\/\/ Admin_Display::success($msg);\n\n\t\t\/\/ Check if there is still task in queue\n\t\t$q               = \"SELECT * FROM `$this->_table_img_optming` WHERE optm_status = %d LIMIT 1\";\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($q, self::STATUS_NOTIFIED));\n\t\tif ($to_be_continued) {\n\t\t\tself::debug('Task in queue, to be continued...');\n\t\t\treturn;\n\t\t\t\/\/ return Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_PULL);\n\t\t}\n\n\t\t\/\/ If all pulled, update tag to done\n\t\tself::debug('Marked pull status to all pulled');\n\t\tself::update_option(self::DB_NEED_PULL, self::STATUS_PULLED);\n\t}\n\n\t\/**\n\t * Push image back to previous status\n\t *\n\t * @since  3.0\n\t * @access private\n\t *\/\n\tprivate function _step_back_image( $id ) {\n\t\tglobal $wpdb;\n\n\t\tself::debug('Push image back to new status [id] ' . $id);\n\n\t\t\/\/ Reset the image to gathered status\n\t\t$q = \"UPDATE `$this->_table_img_optming` SET optm_status = %d WHERE id = %d \";\n\t\t$wpdb->query($wpdb->prepare($q, array( self::STATUS_RAW, $id )));\n\t}\n\n\t\/**\n\t * Parse wp's meta value\n\t *\n\t * @since 1.6.7\n\t * @access private\n\t *\/\n\tprivate function _parse_wp_meta_value( $v ) {\n\t\tif (empty($v)) {\n\t\t\tself::debug('bypassed parsing meta due to null value');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!$v->meta_value) {\n\t\t\tself::debug('bypassed parsing meta due to no meta_value: pid ' . $v->post_id);\n\t\t\treturn false;\n\t\t}\n\n\t\t$meta_value = @maybe_unserialize($v->meta_value);\n\t\tif (!is_array($meta_value)) {\n\t\t\tself::debug('bypassed parsing meta due to meta_value not json: pid ' . $v->post_id);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (empty($meta_value['file'])) {\n\t\t\tself::debug('bypassed parsing meta due to no ori file: pid ' . $v->post_id);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn $meta_value;\n\t}\n\n\t\/**\n\t * Clean up all unfinished queue locally and to Cloud server\n\t *\n\t * @since 2.1.2\n\t * @access public\n\t *\/\n\tpublic function clean() {\n\t\tglobal $wpdb;\n\n\t\t\/\/ Reset img_optm table's queue\n\t\tif ($this->__data->tb_exist('img_optming')) {\n\t\t\t\/\/ Get min post id to mark\n\t\t\t$q       = \"SELECT MIN(post_id) FROM `$this->_table_img_optming`\";\n\t\t\t$min_pid = $wpdb->get_var($q) - 1;\n\t\t\tif ($this->_summary['next_post_id'] > $min_pid) {\n\t\t\t\t$this->_summary['next_post_id'] = $min_pid;\n\t\t\t\tself::save_summary();\n\t\t\t}\n\n\t\t\t$q = \"DELETE FROM `$this->_table_img_optming`\";\n\t\t\t$wpdb->query($q);\n\t\t}\n\n\t\t$msg = __('Cleaned up unfinished data successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Reset image counter\n\t *\n\t * @since 7.0\n\t * @access private\n\t *\/\n\tprivate function _reset_counter() {\n\t\tself::debug('reset image optm counter');\n\t\t$this->_summary['next_post_id'] = 0;\n\t\tself::save_summary();\n\n\t\t$this->clean();\n\n\t\t$msg = __('Reset image optimization counter successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Destroy all optimized images\n\t *\n\t * @since 3.0\n\t * @access private\n\t *\/\n\tprivate function _destroy() {\n\t\tglobal $wpdb;\n\n\t\tself::debug('executing DESTROY process');\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t\/**\n\t\t * Limit images each time before redirection to fix Out of memory issue. #665465\n\t\t *\n\t\t * @since  2.9.8\n\t\t *\/\n\t\t\/\/ Start deleting files\n\t\t$limit = apply_filters('litespeed_imgoptm_destroy_max_rows', 500);\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\t$i     = 0;\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t++$i;\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t$this->_destroy_optm_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_destroy_optm_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tself::debug('batch switched images total: ' . $i);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\t\tif ($to_be_continued) {\n\t\t\t\/\/ Check if post_id is beyond next_post_id\n\t\t\tself::debug('[next_post_id] ' . $this->_summary['next_post_id'] . ' [cursor post id] ' . $to_be_continued->post_id);\n\t\t\tif ($to_be_continued->post_id <= $this->_summary['next_post_id']) {\n\t\t\t\tself::debug('redirecting to next');\n\t\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_DESTROY);\n\t\t\t}\n\t\t\tself::debug('\ud83c\udf8a Finished destroying');\n\t\t}\n\n\t\t\/\/ Delete postmeta info\n\t\t$q = \"DELETE FROM `$wpdb->postmeta` WHERE meta_key = %s\";\n\t\t$wpdb->query($wpdb->prepare($q, self::DB_SIZE));\n\t\t$wpdb->query($wpdb->prepare($q, self::DB_SET));\n\n\t\t\/\/ Delete img_optm table\n\t\t$this->__data->tb_del('img_optm');\n\t\t$this->__data->tb_del('img_optming');\n\n\t\t\/\/ Clear options table summary info\n\t\tself::delete_option('_summary');\n\t\tself::delete_option(self::DB_NEED_PULL);\n\n\t\t$msg = __('Destroy all optimization data successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Destroy optm file\n\t *\/\n\tprivate function _destroy_optm_file( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\t\tself::debug('deleting ' . $short_file_path);\n\n\t\t\/\/ del webp\n\t\t$this->__media->info($short_file_path . '.webp', $this->tmp_pid) && $this->__media->del($short_file_path . '.webp', $this->tmp_pid);\n\t\t$this->__media->info($short_file_path . '.optm.webp', $this->tmp_pid) && $this->__media->del($short_file_path . '.optm.webp', $this->tmp_pid);\n\n\t\t\/\/ del avif\n\t\t$this->__media->info($short_file_path . '.avif', $this->tmp_pid) && $this->__media->del($short_file_path . '.avif', $this->tmp_pid);\n\t\t$this->__media->info($short_file_path . '.optm.avif', $this->tmp_pid) && $this->__media->del($short_file_path . '.optm.avif', $this->tmp_pid);\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\t\t$bk_optm_file   = $local_filename . '.bk.optm.' . $extension;\n\n\t\t\/\/ del optimized ori\n\t\tif ($this->__media->info($bk_file, $this->tmp_pid)) {\n\t\t\tself::debug('deleting optim ori');\n\t\t\t$this->__media->del($short_file_path, $this->tmp_pid);\n\t\t\t$this->__media->rename($bk_file, $short_file_path, $this->tmp_pid);\n\t\t}\n\t\t$this->__media->info($bk_optm_file, $this->tmp_pid) && $this->__media->del($bk_optm_file, $this->tmp_pid);\n\t}\n\n\t\/**\n\t * Rescan to find new generated images\n\t *\n\t * @since 1.6.7\n\t * @access private\n\t *\/\n\tprivate function _rescan() {\n\t\tglobal $wpdb;\n\t\texit('tobedone');\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t$limit  = 500;\n\n\t\tself::debug('rescan images');\n\n\t\t\/\/ Get images\n\t\t$q    = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a, `$wpdb->postmeta` b\n\t\t\tWHERE a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\t\tAND a.ID = b.post_id\n\t\t\t\tAND b.meta_key = '_wp_attachment_metadata'\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d, %d\n\t\t\t\";\n\t\t$list = $wpdb->get_results($wpdb->prepare($q, $offset * $limit, $limit + 1)); \/\/ last one is the seed for next batch\n\n\t\tif (!$list) {\n\t\t\t$msg = __('Rescanned successfully.', 'litespeed-cache');\n\t\t\tAdmin_Display::success($msg);\n\n\t\t\tself::debug('rescan bypass: no gathered image found');\n\t\t\treturn;\n\t\t}\n\n\t\tif (count($list) == $limit + 1) {\n\t\t\t$to_be_continued = true;\n\t\t\tarray_pop($list); \/\/ last one is the seed for next round, discard here.\n\t\t} else {\n\t\t\t$to_be_continued = false;\n\t\t}\n\n\t\t\/\/ Prepare post_ids to inquery gathered images\n\t\t$pid_set      = array();\n\t\t$scanned_list = array();\n\t\tforeach ($list as $v) {\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$scanned_list[] = array(\n\t\t\t\t'pid' => $v->post_id,\n\t\t\t\t'meta' => $meta_value,\n\t\t\t);\n\n\t\t\t$pid_set[] = $v->post_id;\n\t\t}\n\n\t\t\/\/ Build gathered images\n\t\t$q    = \"SELECT src, post_id FROM `$this->_table_img_optm` WHERE post_id IN (\" . implode(',', array_fill(0, count($pid_set), '%d')) . ')';\n\t\t$list = $wpdb->get_results($wpdb->prepare($q, $pid_set));\n\t\tforeach ($list as $v) {\n\t\t\t$this->_existed_src_list[] = $v->post_id . '.' . $v->src;\n\t\t}\n\n\t\t\/\/ Find new images\n\t\tforeach ($scanned_list as $v) {\n\t\t\t$meta_value = $v['meta'];\n\t\t\t\/\/ Parse all child src and put them into $this->_img_in_queue, missing ones to $this->_img_in_queue_missed\n\t\t\t$this->tmp_pid  = $v['pid'];\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t$this->_append_img_queue($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_append_img_queue' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tself::debug('rescanned [img] ' . count($this->_img_in_queue));\n\n\t\t$count = count($this->_img_in_queue);\n\t\tif ($count > 0) {\n\t\t\t\/\/ Save to DB\n\t\t\t$this->_save_raw();\n\t\t}\n\n\t\tif ($to_be_continued) {\n\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_RESCAN);\n\t\t}\n\n\t\t$msg = $count ? sprintf(__('Rescanned %d images successfully.', 'litespeed-cache'), $count) : __('Rescanned successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Calculate bkup original images storage\n\t *\n\t * @since 2.2.6\n\t * @access private\n\t *\/\n\tprivate function _calc_bkup() {\n\t\tglobal $wpdb;\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t$limit  = 500;\n\n\t\tif (!$offset) {\n\t\t\t$this->_summary['bk_summary'] = array(\n\t\t\t\t'date' => time(),\n\t\t\t\t'count' => 0,\n\t\t\t\t'sum' => 0,\n\t\t\t);\n\t\t}\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t$this->_get_bk_size($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_get_bk_size' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\t$this->_summary['bk_summary']['date'] = time();\n\t\tself::save_summary();\n\n\t\tself::debug('_calc_bkup total: ' . $this->_summary['bk_summary']['count'] . ' [size] ' . $this->_summary['bk_summary']['sum']);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\n\t\tif ($to_be_continued) {\n\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_CALC_BKUP);\n\t\t}\n\n\t\t$msg = __('Calculated backups successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Calculate single size\n\t *\/\n\tprivate function _get_bk_size( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\n\t\t$img_info = $this->__media->info($bk_file, $this->tmp_pid);\n\t\tif (!$img_info) {\n\t\t\treturn;\n\t\t}\n\n\t\t++$this->_summary['bk_summary']['count'];\n\t\t$this->_summary['bk_summary']['sum'] += $img_info['size'];\n\t}\n\n\t\/**\n\t * Delete bkup original images storage\n\t *\n\t * @since  2.5\n\t * @access public\n\t *\/\n\tpublic function rm_bkup() {\n\t\tglobal $wpdb;\n\n\t\tif (!$this->__data->tb_exist('img_optming')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\t\t$limit  = 500;\n\n\t\tif (empty($this->_summary['rmbk_summary'])) {\n\t\t\t$this->_summary['rmbk_summary'] = array(\n\t\t\t\t'date' => time(),\n\t\t\t\t'count' => 0,\n\t\t\t\t'sum' => 0,\n\t\t\t);\n\t\t}\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t$this->_del_bk_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_del_bk_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\t$this->_summary['rmbk_summary']['date'] = time();\n\t\tself::save_summary();\n\n\t\tself::debug('rm_bkup total: ' . $this->_summary['rmbk_summary']['count'] . ' [size] ' . $this->_summary['rmbk_summary']['sum']);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\n\t\tif ($to_be_continued) {\n\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, self::TYPE_RM_BKUP);\n\t\t}\n\n\t\t$msg = __('Removed backups successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Delete single file\n\t *\/\n\tprivate function _del_bk_file( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\n\t\t$img_info = $this->__media->info($bk_file, $this->tmp_pid);\n\t\tif (!$img_info) {\n\t\t\treturn;\n\t\t}\n\n\t\t++$this->_summary['rmbk_summary']['count'];\n\t\t$this->_summary['rmbk_summary']['sum'] += $img_info['size'];\n\n\t\t$this->__media->del($bk_file, $this->tmp_pid);\n\t}\n\n\t\/**\n\t * Count images\n\t *\n\t * @since 1.6\n\t * @access public\n\t *\/\n\tpublic function img_count() {\n\t\tglobal $wpdb;\n\n\t\t$q           = \"SELECT count(*)\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\t\";\n\t\t$groups_all  = $wpdb->get_var($q);\n\t\t$groups_new  = $wpdb->get_var($q . ' AND ID>' . (int) $this->_summary['next_post_id'] . ' ORDER BY ID');\n\t\t$groups_done = $wpdb->get_var($q . ' AND ID<=' . (int) $this->_summary['next_post_id'] . ' ORDER BY ID');\n\n\t\t$q      = \"SELECT b.post_id\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\tORDER BY a.ID DESC\n\t\t\tLIMIT 1\n\t\t\t\";\n\t\t$max_id = $wpdb->get_var($q);\n\n\t\t$count_list = array(\n\t\t\t'max_id' => $max_id,\n\t\t\t'groups_all' => $groups_all,\n\t\t\t'groups_new' => $groups_new,\n\t\t\t'groups_done' => $groups_done,\n\t\t);\n\n\t\t\/\/ images count from work table\n\t\tif ($this->__data->tb_exist('img_optming')) {\n\t\t\t$q               = \"SELECT COUNT(DISTINCT post_id),COUNT(*) FROM `$this->_table_img_optming` WHERE optm_status = %d\";\n\t\t\t$groups_to_check = array( self::STATUS_RAW, self::STATUS_REQUESTED, self::STATUS_NOTIFIED, self::STATUS_ERR_FETCH );\n\t\t\tforeach ($groups_to_check as $v) {\n\t\t\t\t$count_list['img.' . $v]                                   = $count_list['group.' . $v] = 0;\n\t\t\t\tlist($count_list['group.' . $v], $count_list['img.' . $v]) = $wpdb->get_row($wpdb->prepare($q, $v), ARRAY_N);\n\t\t\t}\n\t\t}\n\n\t\treturn $count_list;\n\t}\n\n\t\/**\n\t * Check if fetch cron is running\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t *\/\n\tpublic function cron_running( $bool_res = true ) {\n\t\t$last_run = !empty($this->_summary['last_pull']) ? $this->_summary['last_pull'] : 0;\n\n\t\t$is_running = $last_run && time() - $last_run < 120;\n\n\t\tif ($bool_res) {\n\t\t\treturn $is_running;\n\t\t}\n\n\t\treturn array( $last_run, $is_running );\n\t}\n\n\t\/**\n\t * Update fetch cron timestamp tag\n\t *\n\t * @since  1.6.2\n\t * @access private\n\t *\/\n\tprivate function _update_cron_running( $done = false ) {\n\t\t$this->_summary['last_pull'] = time();\n\n\t\tif ($done) {\n\t\t\t\/\/ Only update cron tag when its from the active running cron\n\t\t\tif ($this->_cron_ran) {\n\t\t\t\t\/\/ Rollback for next running\n\t\t\t\t$this->_summary['last_pull'] -= 120;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tself::save_summary();\n\n\t\t$this->_cron_ran = true;\n\t}\n\n\t\/**\n\t * Batch switch images to ori\/optm version\n\t *\n\t * @since  1.6.2\n\t * @access public\n\t *\/\n\tpublic function batch_switch( $type ) {\n\t\tglobal $wpdb;\n\n\t\tif (defined('LITESPEED_CLI') || wp_doing_cron()) {\n\t\t\t$offset = 0;\n\t\t\twhile ($offset !== 'done') {\n\t\t\t\tAdmin_Display::info(\"Starting switch to $type [offset] $offset\");\n\t\t\t\t$offset = $this->_batch_switch($type, $offset);\n\t\t\t}\n\t\t} else {\n\t\t\t$offset = !empty($_GET['litespeed_i']) ? $_GET['litespeed_i'] : 0;\n\n\t\t\t$newOffset = $this->_batch_switch($type, $offset);\n\t\t\tif ($newOffset !== 'done') {\n\t\t\t\treturn Router::self_redirect(Router::ACTION_IMG_OPTM, $type);\n\t\t\t}\n\t\t}\n\n\t\t$msg = __('Switched images successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Switch images per offset\n\t *\/\n\tprivate function _batch_switch( $type, $offset ) {\n\t\tglobal $wpdb;\n\t\t$limit          = 500;\n\t\t$this->tmp_type = $type;\n\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->posts` a\n\t\t\tLEFT JOIN `$wpdb->postmeta` b ON b.post_id = a.ID\n\t\t\tWHERE b.meta_key = '_wp_attachment_metadata'\n\t\t\t\tAND a.post_type = 'attachment'\n\t\t\t\tAND a.post_status = 'inherit'\n\t\t\t\tAND a.post_mime_type IN ('image\/jpeg', 'image\/png', 'image\/gif')\n\t\t\tORDER BY a.ID\n\t\t\tLIMIT %d,%d\n\t\t\t\";\n\t\t$q     = $wpdb->prepare($img_q, array( $offset * $limit, $limit ));\n\t\t$list  = $wpdb->get_results($q);\n\t\t$i     = 0;\n\t\tforeach ($list as $v) {\n\t\t\tif (!$v->post_id) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\t\tif (!$meta_value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t++$i;\n\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t$this->_switch_bk_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_switch_bk_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tself::debug('batch switched images total: ' . $i . ' [type] ' . $type);\n\n\t\t++$offset;\n\t\t$to_be_continued = $wpdb->get_row($wpdb->prepare($img_q, array( $offset * $limit, 1 )));\n\t\tif ($to_be_continued) {\n\t\t\treturn $offset;\n\t\t}\n\t\treturn 'done';\n\t}\n\n\t\/**\n\t * Delete single file\n\t *\/\n\tprivate function _switch_bk_file( $meta_value, $is_ori_file = false ) {\n\t\t$short_file_path = $meta_value['file'];\n\t\tif (!$is_ori_file) {\n\t\t\t$short_file_path = $this->tmp_path . $short_file_path;\n\t\t}\n\n\t\t$extension      = pathinfo($short_file_path, PATHINFO_EXTENSION);\n\t\t$local_filename = substr($short_file_path, 0, -strlen($extension) - 1);\n\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\t\t$bk_optm_file   = $local_filename . '.bk.optm.' . $extension;\n\n\t\t\/\/ self::debug('_switch_bk_file ' . $bk_file . ' [type] ' . $this->tmp_type);\n\t\t\/\/ switch to ori\n\t\tif ($this->tmp_type === self::TYPE_BATCH_SWITCH_ORI || $this->tmp_type == 'orig') {\n\t\t\t\/\/ self::debug('switch to orig ' . $bk_file);\n\t\t\tif (!$this->__media->info($bk_file, $this->tmp_pid)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this->__media->rename($local_filename . '.' . $extension, $bk_optm_file, $this->tmp_pid);\n\t\t\t$this->__media->rename($bk_file, $local_filename . '.' . $extension, $this->tmp_pid);\n\t\t}\n\t\t\/\/ switch to optm\n\t\telseif ($this->tmp_type === self::TYPE_BATCH_SWITCH_OPTM || $this->tmp_type == 'optm') {\n\t\t\t\/\/ self::debug('switch to optm ' . $bk_file);\n\t\t\tif (!$this->__media->info($bk_optm_file, $this->tmp_pid)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this->__media->rename($local_filename . '.' . $extension, $bk_file, $this->tmp_pid);\n\t\t\t$this->__media->rename($bk_optm_file, $local_filename . '.' . $extension, $this->tmp_pid);\n\t\t}\n\t}\n\n\t\/**\n\t * Switch image between original one and optimized one\n\t *\n\t * @since 1.6.2\n\t * @access private\n\t *\/\n\tprivate function _switch_optm_file( $type ) {\n\t\tAdmin_Display::success(__('Switched to optimized file successfully.', 'litespeed-cache'));\n\t\treturn;\n\t\tglobal $wpdb;\n\n\t\t$pid         = substr($type, 4);\n\t\t$switch_type = substr($type, 0, 4);\n\n\t\t$q    = \"SELECT src,post_id FROM `$this->_table_img_optm` WHERE post_id = %d AND optm_status = %d\";\n\t\t$list = $wpdb->get_results($wpdb->prepare($q, array( $pid, self::STATUS_PULLED )));\n\n\t\t$msg = 'Unknown Msg';\n\n\t\tforeach ($list as $v) {\n\t\t\t\/\/ to switch webp file\n\t\t\tif ($switch_type === 'webp') {\n\t\t\t\tif ($this->__media->info($v->src . '.webp', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.webp', $v->src . '.optm.webp', $v->post_id);\n\t\t\t\t\tself::debug('Disabled WebP: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Disabled WebP file successfully.', 'litespeed-cache');\n\t\t\t\t} elseif ($this->__media->info($v->src . '.optm.webp', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.optm.webp', $v->src . '.webp', $v->post_id);\n\t\t\t\t\tself::debug('Enable WebP: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Enabled WebP file successfully.', 'litespeed-cache');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ to switch avif file\n\t\t\telseif ($switch_type === 'avif') {\n\t\t\t\tif ($this->__media->info($v->src . '.avif', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.avif', $v->src . '.optm.avif', $v->post_id);\n\t\t\t\t\tself::debug('Disabled AVIF: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Disabled AVIF file successfully.', 'litespeed-cache');\n\t\t\t\t} elseif ($this->__media->info($v->src . '.optm.avif', $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src . '.optm.avif', $v->src . '.avif', $v->post_id);\n\t\t\t\t\tself::debug('Enable AVIF: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Enabled AVIF file successfully.', 'litespeed-cache');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ to switch original file\n\t\t\telse {\n\t\t\t\t$extension      = pathinfo($v->src, PATHINFO_EXTENSION);\n\t\t\t\t$local_filename = substr($v->src, 0, -strlen($extension) - 1);\n\t\t\t\t$bk_file        = $local_filename . '.bk.' . $extension;\n\t\t\t\t$bk_optm_file   = $local_filename . '.bk.optm.' . $extension;\n\n\t\t\t\t\/\/ revert ori back\n\t\t\t\tif ($this->__media->info($bk_file, $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src, $bk_optm_file, $v->post_id);\n\t\t\t\t\t$this->__media->rename($bk_file, $v->src, $v->post_id);\n\t\t\t\t\tself::debug('Restore original img: ' . $bk_file);\n\n\t\t\t\t\t$msg = __('Restored original file successfully.', 'litespeed-cache');\n\t\t\t\t} elseif ($this->__media->info($bk_optm_file, $v->post_id)) {\n\t\t\t\t\t$this->__media->rename($v->src, $bk_file, $v->post_id);\n\t\t\t\t\t$this->__media->rename($bk_optm_file, $v->src, $v->post_id);\n\t\t\t\t\tself::debug('Switch to optm img: ' . $v->src);\n\n\t\t\t\t\t$msg = __('Switched to optimized file successfully.', 'litespeed-cache');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Delete one optm data and recover original file\n\t *\n\t * @since 2.4.2\n\t * @access public\n\t *\/\n\tpublic function reset_row( $post_id ) {\n\t\tglobal $wpdb;\n\n\t\tif (!$post_id) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Gathered image don't have DB_SIZE info yet\n\t\t\/\/ $size_meta = get_post_meta( $post_id, self::DB_SIZE, true );\n\n\t\t\/\/ if ( ! $size_meta ) {\n\t\t\/\/ return;\n\t\t\/\/ }\n\n\t\tself::debug('_reset_row [pid] ' . $post_id);\n\n\t\t\/\/ TODO: Load image sub files\n\t\t$img_q = \"SELECT b.post_id, b.meta_value\n\t\t\tFROM `$wpdb->postmeta` b\n\t\t\tWHERE b.post_id =%d  AND b.meta_key = '_wp_attachment_metadata'\";\n\t\t$q     = $wpdb->prepare($img_q, array( $post_id ));\n\t\t$v     = $wpdb->get_row($q);\n\n\t\t$meta_value = $this->_parse_wp_meta_value($v);\n\t\tif ($meta_value) {\n\t\t\t$this->tmp_pid  = $v->post_id;\n\t\t\t$this->tmp_path = pathinfo($meta_value['file'], PATHINFO_DIRNAME) . '\/';\n\t\t\t$this->_destroy_optm_file($meta_value, true);\n\t\t\tif (!empty($meta_value['sizes'])) {\n\t\t\t\tarray_map(array( $this, '_destroy_optm_file' ), $meta_value['sizes']);\n\t\t\t}\n\t\t}\n\n\t\tdelete_post_meta($post_id, self::DB_SIZE);\n\t\tdelete_post_meta($post_id, self::DB_SET);\n\n\t\t$msg = __('Reset the optimized data successfully.', 'litespeed-cache');\n\t\tAdmin_Display::success($msg);\n\t}\n\n\t\/**\n\t * Show an image's optm status\n\t *\n\t * @since  1.6.5\n\t * @access public\n\t *\/\n\tpublic function check_img() {\n\t\tglobal $wpdb;\n\n\t\t$pid = $_POST['data'];\n\n\t\tself::debug('Check image [ID] ' . $pid);\n\n\t\t$data = array();\n\n\t\t$data['img_count']    = $this->img_count();\n\t\t$data['optm_summary'] = self::get_summary();\n\n\t\t$data['_wp_attached_file']       = get_post_meta($pid, '_wp_attached_file', true);\n\t\t$data['_wp_attachment_metadata'] = get_post_meta($pid, '_wp_attachment_metadata', true);\n\n\t\t\/\/ Get img_optm data\n\t\t$q        = \"SELECT * FROM `$this->_table_img_optm` WHERE post_id = %d\";\n\t\t$list     = $wpdb->get_results($wpdb->prepare($q, $pid));\n\t\t$img_data = array();\n\t\tif ($list) {\n\t\t\tforeach ($list as $v) {\n\t\t\t\t$img_data[] = array(\n\t\t\t\t\t'id' => $v->id,\n\t\t\t\t\t'optm_status' => $v->optm_status,\n\t\t\t\t\t'src' => $v->src,\n\t\t\t\t\t'srcpath_md5' => $v->srcpath_md5,\n\t\t\t\t\t'src_md5' => $v->src_md5,\n\t\t\t\t\t'server_info' => $v->server_info,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t$data['img_data'] = $img_data;\n\n\t\treturn array(\n\t\t\t'_res' => 'ok',\n\t\t\t'data' => $data,\n\t\t);\n\t}\n\n\t\/**\n\t * Handle all request actions from main cls\n\t *\n\t * @since  2.0\n\t * @access public\n\t *\/\n\tpublic function handler() {\n\t\t$type = Router::verify_type();\n\n\t\tswitch ($type) {\n\t\t\tcase self::TYPE_RESET_ROW:\n            $this->reset_row(!empty($_GET['id']) ? $_GET['id'] : false);\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CALC_BKUP:\n            $this->_calc_bkup();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RM_BKUP:\n            $this->rm_bkup();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_NEW_REQ:\n            $this->new_req();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESCAN:\n            $this->_rescan();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_RESET_COUNTER:\n            $this->_reset_counter();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_DESTROY:\n            $this->_destroy();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_CLEAN:\n            $this->clean();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_PULL:\n            self::start_async();\n\t\t\t\tbreak;\n\n\t\t\tcase self::TYPE_BATCH_SWITCH_ORI:\n\t\t\tcase self::TYPE_BATCH_SWITCH_OPTM:\n            $this->batch_switch($type);\n\t\t\t\tbreak;\n\n\t\t\tcase substr($type, 0, 4) === 'avif':\n\t\t\tcase substr($type, 0, 4) === 'webp':\n\t\t\tcase substr($type, 0, 4) === 'orig':\n            $this->_switch_optm_file($type);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tAdmin::redirect();\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/tag.cls.php","ext":"php","size":9481,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The plugin cache-tag class for X-LiteSpeed-Tag\n *\n * @since       1.1.3\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\nclass Tag extends Root {\n\n\tconst TYPE_FEED                    = 'FD';\n\tconst TYPE_FRONTPAGE               = 'F';\n\tconst TYPE_HOME                    = 'H';\n\tconst TYPE_PAGES                   = 'PGS';\n\tconst TYPE_PAGES_WITH_RECENT_POSTS = 'PGSRP';\n\tconst TYPE_HTTP                    = 'HTTP.';\n\tconst TYPE_POST                    = 'Po.'; \/\/ Post. Cannot use P, reserved for litemage.\n\tconst TYPE_ARCHIVE_POSTTYPE        = 'PT.';\n\tconst TYPE_ARCHIVE_TERM            = 'T.'; \/\/ for is_category|is_tag|is_tax\n\tconst TYPE_AUTHOR                  = 'A.';\n\tconst TYPE_ARCHIVE_DATE            = 'D.';\n\tconst TYPE_BLOG                    = 'B.';\n\tconst TYPE_LOGIN                   = 'L';\n\tconst TYPE_URL                     = 'URL.';\n\tconst TYPE_WIDGET                  = 'W.';\n\tconst TYPE_ESI                     = 'ESI.';\n\tconst TYPE_REST                    = 'REST';\n\tconst TYPE_AJAX                    = 'AJAX.';\n\tconst TYPE_LIST                    = 'LIST';\n\tconst TYPE_MIN                     = 'MIN';\n\tconst TYPE_LOCALRES                = 'LOCALRES';\n\n\tconst X_HEADER = 'X-LiteSpeed-Tag';\n\n\tprivate static $_tags          = array();\n\tprivate static $_tags_priv     = array( 'tag_priv' );\n\tpublic static $error_code_tags = array( 403, 404, 500 );\n\n\t\/**\n\t * Initialize\n\t *\n\t * @since 4.0\n\t *\/\n\tpublic function init() {\n\t\t\/\/ register recent posts widget tag before theme renders it to make it work\n\t\tadd_filter('widget_posts_args', array( $this, 'add_widget_recent_posts' ));\n\t}\n\n\t\/**\n\t * Check if the login page is cacheable.\n\t * If not, unset the cacheable member variable.\n\t *\n\t * NOTE: This is checked separately because login page doesn't go through WP logic.\n\t *\n\t * @since 1.0.0\n\t * @access public\n\t *\/\n\tpublic function check_login_cacheable() {\n\t\tif (!$this->conf(Base::O_CACHE_PAGE_LOGIN)) {\n\t\t\treturn;\n\t\t}\n\t\tif (Control::isset_notcacheable()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!empty($_GET)) {\n\t\t\tControl::set_nocache('has GET request');\n\t\t\treturn;\n\t\t}\n\n\t\t$this->cls('Control')->set_cacheable();\n\n\t\tself::add(self::TYPE_LOGIN);\n\n\t\t\/\/ we need to send lsc-cookie manually to make it be sent to all other users when is cacheable\n\t\t$list = headers_list();\n\t\tif (empty($list)) {\n\t\t\treturn;\n\t\t}\n\t\tforeach ($list as $hdr) {\n\t\t\tif (strncasecmp($hdr, 'set-cookie:', 11) == 0) {\n\t\t\t\t$cookie = substr($hdr, 12);\n\t\t\t\t@header('lsc-cookie: ' . $cookie, false);\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Register purge tag for pages with recent posts widget\n\t * of the plugin.\n\t *\n\t * @since    1.0.15\n\t * @access   public\n\t * @param array $params [WordPress params for widget_posts_args]\n\t *\/\n\tpublic function add_widget_recent_posts( $params ) {\n\t\tself::add(self::TYPE_PAGES_WITH_RECENT_POSTS);\n\t\treturn $params;\n\t}\n\n\t\/**\n\t * Adds cache tags to the list of cache tags for the current page.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param mixed $tags A string or array of cache tags to add to the current list.\n\t *\/\n\tpublic static function add( $tags ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\tDebug2::debug('\ud83d\udcb0 [Tag] Add ', $tags);\n\n\t\tself::$_tags = array_merge(self::$_tags, $tags);\n\n\t\t\/\/ Send purge header immediately\n\t\t$tag_header = self::cls()->output(true);\n\t\t@header($tag_header);\n\t}\n\n\t\/**\n\t * Add a post id to cache tag\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function add_post( $pid ) {\n\t\tself::add(self::TYPE_POST . $pid);\n\t}\n\n\t\/**\n\t * Add a widget id to cache tag\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function add_widget( $id ) {\n\t\tself::add(self::TYPE_WIDGET . $id);\n\t}\n\n\t\/**\n\t * Add a private ESI to cache tag\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function add_private_esi( $tag ) {\n\t\tself::add_private(self::TYPE_ESI . $tag);\n\t}\n\n\t\/**\n\t * Adds private cache tags to the list of cache tags for the current page.\n\t *\n\t * @since 1.6.3\n\t * @access public\n\t * @param mixed $tags A string or array of cache tags to add to the current list.\n\t *\/\n\tpublic static function add_private( $tags ) {\n\t\tif (!is_array($tags)) {\n\t\t\t$tags = array( $tags );\n\t\t}\n\n\t\tself::$_tags_priv = array_merge(self::$_tags_priv, $tags);\n\t}\n\n\t\/**\n\t * Return tags for Admin QS\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t *\/\n\tpublic static function output_tags() {\n\t\treturn self::$_tags;\n\t}\n\n\t\/**\n\t * Will get a hash of the URI. Removes query string and appends a '\/' if it is missing.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t * @param string  $uri The uri to get the hash of.\n\t * @param boolean $ori Return the original url or not\n\t * @return bool|string False on input error, hash otherwise.\n\t *\/\n\tpublic static function get_uri_tag( $uri, $ori = false ) {\n\t\t$no_qs = strtok($uri, '?');\n\t\tif (empty($no_qs)) {\n\t\t\treturn false;\n\t\t}\n\t\t$slashed = trailingslashit($no_qs);\n\n\t\t\/\/ If only needs uri tag\n\t\tif ($ori) {\n\t\t\treturn $slashed;\n\t\t}\n\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\treturn self::TYPE_URL . $slashed;\n\t\t}\n\t\treturn self::TYPE_URL . md5($slashed);\n\t}\n\n\t\/**\n\t * Get the unique tag based on self url.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param boolean $ori Return the original url or not\n\t *\/\n\tpublic static function build_uri_tag( $ori = false ) {\n\t\treturn self::get_uri_tag(urldecode($_SERVER['REQUEST_URI']), $ori);\n\t}\n\n\t\/**\n\t * Gets the cache tags to set for the page.\n\t *\n\t * This includes site wide post types (e.g. front page) as well as\n\t * any third party plugin specific cache tags.\n\t *\n\t * @since 1.0.0\n\t * @access private\n\t * @return array The list of cache tags to set.\n\t *\/\n\tprivate static function _build_type_tags() {\n\t\t$tags = array();\n\n\t\t$tags[] = Utility::page_type();\n\n\t\t$tags[] = self::build_uri_tag();\n\n\t\tif (is_front_page()) {\n\t\t\t$tags[] = self::TYPE_FRONTPAGE;\n\t\t} elseif (is_home()) {\n\t\t\t$tags[] = self::TYPE_HOME;\n\t\t}\n\n\t\tglobal $wp_query;\n\t\tif (isset($wp_query)) {\n\t\t\t$queried_obj_id = get_queried_object_id();\n\t\t\tif (is_archive()) {\n\t\t\t\t\/\/ An Archive is a Category, Tag, Author, Date, Custom Post Type or Custom Taxonomy based pages.\n\t\t\t\tif (is_category() || is_tag() || is_tax()) {\n\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_TERM . $queried_obj_id;\n\t\t\t\t} elseif (is_post_type_archive() && ($post_type = get_post_type())) {\n\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_POSTTYPE . $post_type;\n\t\t\t\t} elseif (is_author()) {\n\t\t\t\t\t$tags[] = self::TYPE_AUTHOR . $queried_obj_id;\n\t\t\t\t} elseif (is_date()) {\n\t\t\t\t\tglobal $post;\n\n\t\t\t\t\tif ($post && isset($post->post_date)) {\n\t\t\t\t\t\t$date = $post->post_date;\n\t\t\t\t\t\t$date = strtotime($date);\n\t\t\t\t\t\tif (is_day()) {\n\t\t\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_DATE . date('Ymd', $date);\n\t\t\t\t\t\t} elseif (is_month()) {\n\t\t\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_DATE . date('Ym', $date);\n\t\t\t\t\t\t} elseif (is_year()) {\n\t\t\t\t\t\t\t$tags[] = self::TYPE_ARCHIVE_DATE . date('Y', $date);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} elseif (is_singular()) {\n\t\t\t\t\/\/ $this->is_singular = $this->is_single || $this->is_page || $this->is_attachment;\n\t\t\t\t$tags[] = self::TYPE_POST . $queried_obj_id;\n\n\t\t\t\tif (is_page()) {\n\t\t\t\t\t$tags[] = self::TYPE_PAGES;\n\t\t\t\t}\n\t\t\t} elseif (is_feed()) {\n\t\t\t\t$tags[] = self::TYPE_FEED;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Check REST API\n\t\tif (REST::cls()->is_rest()) {\n\t\t\t$tags[] = self::TYPE_REST;\n\n\t\t\t$path = !empty($_SERVER['SCRIPT_URL']) ? $_SERVER['SCRIPT_URL'] : false;\n\t\t\tif ($path) {\n\t\t\t\t\/\/ posts collections tag\n\t\t\t\tif (substr($path, -6) == '\/posts') {\n\t\t\t\t\t$tags[] = self::TYPE_LIST; \/\/ Not used for purge yet\n\t\t\t\t}\n\n\t\t\t\t\/\/ single post tag\n\t\t\t\tglobal $post;\n\t\t\t\tif (!empty($post->ID) && substr($path, -strlen($post->ID) - 1) === '\/' . $post->ID) {\n\t\t\t\t\t$tags[] = self::TYPE_POST . $post->ID;\n\t\t\t\t}\n\n\t\t\t\t\/\/ pages collections & single page tag\n\t\t\t\tif (stripos($path, '\/pages') !== false) {\n\t\t\t\t\t$tags[] = self::TYPE_PAGES;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Append AJAX action tag\n\t\tif (Router::is_ajax() && !empty($_REQUEST['action'])) {\n\t\t\t$tags[] = self::TYPE_AJAX . $_REQUEST['action'];\n\t\t}\n\n\t\treturn $tags;\n\t}\n\n\t\/**\n\t * Generate all cache tags before output\n\t *\n\t * @access private\n\t * @since 1.1.3\n\t *\/\n\tprivate static function _finalize() {\n\t\t\/\/ run 3rdparty hooks to tag\n\t\tdo_action('litespeed_tag_finalize');\n\t\t\/\/ generate wp tags\n\t\tif (!defined('LSCACHE_IS_ESI')) {\n\t\t\t$type_tags   = self::_build_type_tags();\n\t\t\tself::$_tags = array_merge(self::$_tags, $type_tags);\n\t\t}\n\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\tself::$_tags[] = 'guest';\n\t\t}\n\n\t\t\/\/ append blog main tag\n\t\tself::$_tags[] = '';\n\t\t\/\/ removed duplicates\n\t\tself::$_tags = array_unique(self::$_tags);\n\t}\n\n\t\/**\n\t * Sets up the Cache Tags header.\n\t * ONLY need to run this if is cacheable\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return string empty string if empty, otherwise the cache tags header.\n\t *\/\n\tpublic function output( $no_finalize = false ) {\n\t\tif (defined('LSCACHE_NO_CACHE') && LSCACHE_NO_CACHE) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!$no_finalize) {\n\t\t\tself::_finalize();\n\t\t}\n\n\t\t$prefix_tags = array();\n\t\t\/**\n\t\t * Only append blog_id when is multisite\n\t\t *\n\t\t * @since 2.9.3\n\t\t *\/\n\t\t$prefix = LSWCP_TAG_PREFIX . (is_multisite() ? get_current_blog_id() : '') . '_';\n\n\t\t\/\/ If is_private and has private tags, append them first, then specify prefix to `public` for public tags\n\t\tif (Control::is_private()) {\n\t\t\tforeach (self::$_tags_priv as $priv_tag) {\n\t\t\t\t$prefix_tags[] = $prefix . $priv_tag;\n\t\t\t}\n\t\t\t$prefix = 'public:' . $prefix;\n\t\t}\n\n\t\tforeach (self::$_tags as $tag) {\n\t\t\t$prefix_tags[] = $prefix . $tag;\n\t\t}\n\n\t\t$hdr = self::X_HEADER . ': ' . implode(',', $prefix_tags);\n\n\t\treturn $hdr;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/str.cls.php","ext":"php","size":3226,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * LiteSpeed String Operator Library Class\n *\n * @since 1.3\n * @package LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Str\n *\n * Provides string manipulation utilities for LiteSpeed Cache.\n *\n * @since 1.3\n *\/\nclass Str {\n\n\t\/**\n\t * Translate QC HTML links from html.\n\t *\n\t * Converts `<a href=\"{#xxx#}\">xxxx<\/a>` to `<a href=\"xxx\">xxxx<\/a>`.\n\t *\n\t * @since 7.0\n\t * @access public\n\t * @param string $html The HTML string to process.\n\t * @return string The processed HTML string.\n\t *\/\n\tpublic static function translate_qc_apis( $html ) {\n\t\tpreg_match_all( '\/<a href=\"{#(\\w+)#}\"\/U', $html, $matches );\n\t\tif ( ! $matches ) {\n\t\t\treturn $html;\n\t\t}\n\n\t\tforeach ( $matches[0] as $k => $html_to_be_replaced ) {\n\t\t\t$link = '<a href=\"' . Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_API, false, null, array( 'action2' => $matches[1][ $k ] ) ) . '\"';\n\t\t\t$html = str_replace( $html_to_be_replaced, $link, $html );\n\t\t}\n\t\treturn $html;\n\t}\n\n\t\/**\n\t * Return safe HTML\n\t *\n\t * Sanitizes HTML to allow only specific tags and attributes.\n\t *\n\t * @since 7.0\n\t * @access public\n\t * @param string $html The HTML string to sanitize.\n\t * @return string The sanitized HTML string.\n\t *\/\n\tpublic static function safe_html( $html ) {\n\t\t$common_attrs = array(\n\t\t\t'style'  => array(),\n\t\t\t'class'  => array(),\n\t\t\t'target' => array(),\n\t\t\t'src'    => array(),\n\t\t\t'color'  => array(),\n\t\t\t'href'   => array(),\n\t\t);\n\t\t$tags         = array( 'hr', 'h3', 'h4', 'h5', 'ul', 'li', 'br', 'strong', 'p', 'span', 'img', 'a', 'div', 'font' );\n\t\t$allowed_tags = array();\n\t\tforeach ( $tags as $tag ) {\n\t\t\t$allowed_tags[ $tag ] = $common_attrs;\n\t\t}\n\n\t\treturn wp_kses( $html, $allowed_tags );\n\t}\n\n\t\/**\n\t * Generate random string\n\t *\n\t * Creates a random string of specified length and character type.\n\t *\n\t * @since  1.3\n\t * @access public\n\t * @param int $len  Length of string.\n\t * @param int $type Character type: 1-Number, 2-LowerChar, 4-UpperChar, 7-All.\n\t * @return string Randomly generated string.\n\t *\/\n\tpublic static function rrand( $len, $type = 7 ) {\n\t\tswitch ( $type ) {\n\t\t\tcase 0:\n\t\t\t\t$charlist = '012';\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t$charlist = '0123456789';\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\t$charlist = 'abcdefghijklmnopqrstuvwxyz';\n\t\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\t$charlist = '0123456789abcdefghijklmnopqrstuvwxyz';\n\t\t\t\tbreak;\n\n\t\t\tcase 4:\n\t\t\t\t$charlist = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\n\t\t\tcase 5:\n\t\t\t\t$charlist = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\n\t\t\tcase 6:\n\t\t\t\t$charlist = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\n\t\t\tcase 7:\n\t\t\t\t$charlist = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\t\t\tbreak;\n\t\t}\n\n\t\t$str = '';\n\n\t\t$max = strlen( $charlist ) - 1;\n\t\tfor ( $i = 0; $i < $len; $i++ ) {\n\t\t\t$str .= $charlist[ random_int( 0, $max ) ];\n\t\t}\n\n\t\treturn $str;\n\t}\n\n\t\/**\n\t * Trim double quotes from a string\n\t *\n\t * Removes double quotes from a string for use as a preformatted src in HTML.\n\t *\n\t * @since 6.5.3\n\t * @access public\n\t * @param string $text The string to process.\n\t * @return string The string with double quotes removed.\n\t *\/\n\tpublic static function trim_quotes( $text ) {\n\t\treturn str_replace( '\"', '', $text );\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/src\/error.cls.php","ext":"php","size":7560,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The error class.\n *\n * @since       3.0\n * @package     LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit();\n\n\/**\n * Class Error\n *\n * Handles error message translation and throwing for LiteSpeed Cache.\n *\n * @since 3.0\n *\/\nclass Error {\n\n\t\/**\n\t * Error code mappings to numeric values.\n\t *\n\t * @since 3.0\n\t * @var array\n\t *\/\n\tprivate static $CODE_SET = array(\n\t\t'HTA_LOGIN_COOKIE_INVALID' => 4300, \/\/ .htaccess did not find.\n\t\t'HTA_DNF'                 => 4500, \/\/ .htaccess did not find.\n\t\t'HTA_BK'                  => 9010, \/\/ backup\n\t\t'HTA_R'                   => 9041, \/\/ read htaccess\n\t\t'HTA_W'                   => 9042, \/\/ write\n\t\t'HTA_GET'                 => 9030, \/\/ failed to get\n\t);\n\n\t\/**\n\t * Throw an error with message\n\t *\n\t * Throws an exception with the translated error message.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param string $code Error code.\n\t * @param mixed  $args Optional arguments for message formatting.\n\t * @throws \\Exception Always throws an exception with the error message.\n\t *\/\n\tpublic static function t( $code, $args = null ) {\n\t\tthrow new \\Exception( wp_kses_post( self::msg( $code, $args ) ) );\n\t}\n\n\t\/**\n\t * Translate an error to description\n\t *\n\t * Converts error codes to human-readable messages.\n\t *\n\t * @since  3.0\n\t * @access public\n\t * @param string $code Error code.\n\t * @param mixed  $args Optional arguments for message formatting.\n\t * @return string Translated error message.\n\t *\/\n\tpublic static function msg( $code, $args = null ) {\n\t\tswitch ( $code ) {\n\t\t\tcase 'qc_setup_required':\n\t\t\t\t$msg =\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t__( 'You will need to finish %s setup to use the online services.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<strong>QUIC.cloud<\/strong>'\n\t\t\t\t\t) .\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\tadmin_url( 'admin.php?page=litespeed-general' ),\n\t\t\t\t\t\t__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'out_of_daily_quota':\n\t\t\t\t$msg  = __( 'You have used all of your daily quota for today.', 'litespeed-cache' );\n\t\t\t\t$msg .=\n\t\t\t\t\t' ' .\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t'https:\/\/docs.quic.cloud\/billing\/services\/#daily-limits-on-free-quota-usage',\n\t\t\t\t\t\t__( 'Learn more or purchase additional quota.', 'litespeed-cache' ),\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'out_of_quota':\n\t\t\t\t$msg  = __( 'You have used all of your quota left for current service this month.', 'litespeed-cache' );\n\t\t\t\t$msg .=\n\t\t\t\t\t' ' .\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t'https:\/\/docs.quic.cloud\/billing\/services\/#daily-limits-on-free-quota-usage',\n\t\t\t\t\t\t__( 'Learn more or purchase additional quota.', 'litespeed-cache' ),\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'too_many_requested':\n\t\t\t\t$msg = __( 'You have too many requested images, please try again in a few minutes.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'too_many_notified':\n\t\t\t\t$msg = __( 'You have images waiting to be pulled. Please wait for the automatic pull to complete, or pull them down manually now.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'empty_list':\n\t\t\t\t$msg = __( 'The image list is empty.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'lack_of_param':\n\t\t\t\t$msg = __( 'Not enough parameters. Please check if the QUIC.cloud connection is set correctly', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'unfinished_queue':\n\t\t\t\t$msg = __( 'There is proceeding queue not pulled yet.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 0 === strpos( $code, 'unfinished_queue ' ):\n\t\t\t\t$msg = sprintf(\n\t\t\t\t\t__( 'There is proceeding queue not pulled yet. Queue info: %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . substr( $code, strlen( 'unfinished_queue ' ) ) . '<\/code>'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_alias':\n\t\t\t\t$msg = __( 'The site is not a valid alias on QUIC.cloud.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'site_not_registered':\n\t\t\t\t$msg = __( 'The site is not registered on QUIC.cloud.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_key':\n\t\t\t\t$msg = __( 'The QUIC.cloud connection is not correct. Please try to sync your QUIC.cloud connection again.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'heavy_load':\n\t\t\t\t$msg = __( 'The current server is under heavy load.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'redetect_node':\n\t\t\t\t$msg = __( 'Online node needs to be redetected.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_overdraw':\n\t\t\t\t$msg = __( 'Credits are not enough to proceed the current request.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'W':\n\t\t\t\t$msg = __( '%s file not writable.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_DNF':\n\t\t\t\tif ( ! is_array( $args ) ) {\n\t\t\t\t\t$args = array( '<code>' . $args . '<\/code>' );\n\t\t\t\t}\n\t\t\t\t$args[] = '.htaccess';\n\t\t\t\t$msg    = __( 'Could not find %1$s in %2$s.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_LOGIN_COOKIE_INVALID':\n\t\t\t\t$msg = sprintf( __( 'Invalid login cookie. Please check the %s file.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_BK':\n\t\t\t\t$msg = sprintf( __( 'Failed to back up %s file, aborted changes.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_R':\n\t\t\t\t$msg = sprintf( __( '%s file not readable.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_W':\n\t\t\t\t$msg = sprintf( __( '%s file not writable.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'HTA_GET':\n\t\t\t\t$msg = sprintf( __( 'Failed to get %s file contents.', 'litespeed-cache' ), '.htaccess' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'failed_tb_creation':\n\t\t\t\t$msg = __( 'Failed to create table %1$s! SQL: %2$s.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'crawler_disabled':\n\t\t\t\t$msg = __( 'Crawler disabled by the server admin.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'try_later': \/\/ QC error code\n\t\t\t\t$msg = __( 'Previous request too recent. Please try again later.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 0 === strpos( $code, 'try_later ' ):\n\t\t\t\t$msg = sprintf(\n\t\t\t\t\t__( 'Previous request too recent. Please try again after %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . Utility::readable_time( substr( $code, strlen( 'try_later ' ) ), 3600, true ) . '<\/code>'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase 'waiting_for_approval':\n\t\t\t\t$msg = __( 'Your application is waiting for approval.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'callback_fail_hash':\n\t\t\t\t$msg = __( 'The callback validation to your domain failed due to hash mismatch.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'callback_fail':\n\t\t\t\t$msg = __( 'The callback validation to your domain failed. Please make sure there is no firewall blocking our servers.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase substr( $code, 0, 14 ) === 'callback_fail ':\n\t\t\t\t$msg =\n\t\t\t\t\t__( 'The callback validation to your domain failed. Please make sure there is no firewall blocking our servers. Response code: ', 'litespeed-cache' ) .\n\t\t\t\t\tsubstr( $code, 14 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'forbidden':\n\t\t\t\t$msg = __( 'Your domain has been forbidden from using our services due to a previous policy violation.', 'litespeed-cache' );\n\t\t\t\tbreak;\n\n\t\t\tcase 'err_dns_active':\n\t\t\t\t$msg = __(\n\t\t\t\t\t'You cannot remove this DNS zone, because it is still in use. Please update the domain\\'s nameservers, then try to delete this zone again, otherwise your site will become inaccessible.',\n\t\t\t\t\t'litespeed-cache'\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t$msg = __( 'Unknown error', 'litespeed-cache' ) . ': ' . $code;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( null !== $args ) {\n\t\t\t$msg = is_array( $args ) ? vsprintf( $msg, $args ) : sprintf( $msg, $args );\n\t\t}\n\n\t\tif ( isset( self::$CODE_SET[ $code ] ) ) {\n\t\t\t$msg = 'ERROR ' . self::$CODE_SET[ $code ] . ': ' . $msg;\n\t\t}\n\n\t\treturn $msg;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/package-lock.json","ext":"json","size":3217,"mtime":1757312769,"type":"text","content":"{\n\t\"name\": \"litespeed-cache\",\n\t\"lockfileVersion\": 3,\n\t\"requires\": true,\n\t\"packages\": {\n\t\t\"\": {\n\t\t\t\"name\": \"litespeed-cache\",\n\t\t\t\"license\": \"GPLv3\",\n\t\t\t\"devDependencies\": {\n\t\t\t\t\"@prettier\/plugin-php\": \"^0.21.0\",\n\t\t\t\t\"prettier\": \"^3.0.3\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules\/@prettier\/plugin-php\": {\n\t\t\t\"version\": \"0.21.0\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/@prettier\/plugin-php\/-\/plugin-php-0.21.0.tgz\",\n\t\t\t\"integrity\": \"sha512-vWC6HIUUfhvl\/7F5IxVQ0ItGB\/7ZY+jDlX7KsTqvfKMODW\/zvzj8r1Ab4harS22+O3xxHykVVd5jvylmxMMctg==\",\n\t\t\t\"dev\": true,\n\t\t\t\"dependencies\": {\n\t\t\t\t\"linguist-languages\": \"^7.21.0\",\n\t\t\t\t\"mem\": \"^9.0.2\",\n\t\t\t\t\"php-parser\": \"^3.1.5\"\n\t\t\t},\n\t\t\t\"peerDependencies\": {\n\t\t\t\t\"prettier\": \"^3.0.0\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules\/linguist-languages\": {\n\t\t\t\"version\": \"7.27.0\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/linguist-languages\/-\/linguist-languages-7.27.0.tgz\",\n\t\t\t\"integrity\": \"sha512-Wzx\/22c5Jsv2ag+uKy+ITanGA5hzvBZngrNGDXLTC7ZjGM6FLCYGgomauTkxNJeP9of353OM0pWqngYA180xgw==\",\n\t\t\t\"dev\": true\n\t\t},\n\t\t\"node_modules\/map-age-cleaner\": {\n\t\t\t\"version\": \"0.1.3\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/map-age-cleaner\/-\/map-age-cleaner-0.1.3.tgz\",\n\t\t\t\"integrity\": \"sha512-bJzx6nMoP6PDLPBFmg7+xRKeFZvFboMrGlxmNj9ClvX53KrmvM5bXFXEWjbz4cz1AFn+jWJ9z\/DJSz7hrs0w3w==\",\n\t\t\t\"dev\": true,\n\t\t\t\"dependencies\": {\n\t\t\t\t\"p-defer\": \"^1.0.0\"\n\t\t\t},\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=6\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules\/mem\": {\n\t\t\t\"version\": \"9.0.2\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/mem\/-\/mem-9.0.2.tgz\",\n\t\t\t\"integrity\": \"sha512-F2t4YIv9XQUBHt6AOJ0y7lSmP1+cY7Fm1DRh9GClTGzKST7UWLMx6ly9WZdLH\/G\/ppM5RL4MlQfRT71ri9t19A==\",\n\t\t\t\"dev\": true,\n\t\t\t\"dependencies\": {\n\t\t\t\t\"map-age-cleaner\": \"^0.1.3\",\n\t\t\t\t\"mimic-fn\": \"^4.0.0\"\n\t\t\t},\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=12.20\"\n\t\t\t},\n\t\t\t\"funding\": {\n\t\t\t\t\"url\": \"https:\/\/github.com\/sindresorhus\/mem?sponsor=1\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules\/mimic-fn\": {\n\t\t\t\"version\": \"4.0.0\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/mimic-fn\/-\/mimic-fn-4.0.0.tgz\",\n\t\t\t\"integrity\": \"sha512-vqiC06CuhBTUdZH+RYl8sFrL096vA45Ok5ISO6sE\/Mr1jRbGH4Csnhi8f3wKVl7x8mO4Au7Ir9D3Oyv1VYMFJw==\",\n\t\t\t\"dev\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=12\"\n\t\t\t},\n\t\t\t\"funding\": {\n\t\t\t\t\"url\": \"https:\/\/github.com\/sponsors\/sindresorhus\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules\/p-defer\": {\n\t\t\t\"version\": \"1.0.0\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/p-defer\/-\/p-defer-1.0.0.tgz\",\n\t\t\t\"integrity\": \"sha512-wB3wfAxZpk2AzOfUMJNL+d36xothRSyj8EXOa4f6GMqYDN9BJaaSISbsk+wS9abmnebVw95C2Kb5t85UmpCxuw==\",\n\t\t\t\"dev\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=4\"\n\t\t\t}\n\t\t},\n\t\t\"node_modules\/php-parser\": {\n\t\t\t\"version\": \"3.1.5\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/php-parser\/-\/php-parser-3.1.5.tgz\",\n\t\t\t\"integrity\": \"sha512-jEY2DcbgCm5aclzBdfW86GM6VEIWcSlhTBSHN1qhJguVePlYe28GhwS0yoeLYXpM2K8y6wzLwrbq814n2PHSoQ==\",\n\t\t\t\"dev\": true\n\t\t},\n\t\t\"node_modules\/prettier\": {\n\t\t\t\"version\": \"3.0.3\",\n\t\t\t\"resolved\": \"https:\/\/registry.npmjs.org\/prettier\/-\/prettier-3.0.3.tgz\",\n\t\t\t\"integrity\": \"sha512-L\/4pUDMxcNa8R\/EthV08Zt42WBO4h1rarVtK0K+QJG0X187OLo7l699jWw0GKuwzkPQ\/\/jMFA\/8Xm6Fh3J\/DAg==\",\n\t\t\t\"dev\": true,\n\t\t\t\"bin\": {\n\t\t\t\t\"prettier\": \"bin\/prettier.cjs\"\n\t\t\t},\n\t\t\t\"engines\": {\n\t\t\t\t\"node\": \">=14\"\n\t\t\t},\n\t\t\t\"funding\": {\n\t\t\t\t\"url\": \"https:\/\/github.com\/prettier\/prettier?sponsor=1\"\n\t\t\t}\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/package.json","ext":"json","size":948,"mtime":1757312769,"type":"text","content":"{\n\t\"name\": \"litespeed-cache\",\n\t\"description\": \"High-performance page caching and site optimization from LiteSpeed\",\n\t\"license\": \"GPLv3\",\n\t\"scripts\": {\n\t\t\"format-check\": \"vendor\/bin\/phpcs --standard=phpcs.ruleset.xml cli\/ lib\/ src\/ tpl\/ thirdparty autoload.php litespeed-cache.php\",\n\t\t\"install-composer-packages\": \"composer require --dev squizlabs\/php_codesniffer:^3.12 wp-coding-standards\/wpcs:^3.1 dealerdirect\/phpcodesniffer-composer-installer:^1.0 && vendor\/bin\/phpcs --config-set installed_paths vendor\/wp-coding-standards\/wpcs,vendor\/phpcsstandards\/phpcsutils,vendor\/phpcsstandards\/phpcsextra\",\n\t\t\"sniff-check\": \"vendor\/bin\/phpcs --standard=phpcs.ruleset.xml cli\/ lib\/ src\/ tpl\/ thirdparty autoload.php litespeed-cache.php\",\n\t\t\"wpformat\": \"vendor\/bin\/phpcbf --standard=phpcs.ruleset.xml cli\/ lib\/ src\/ tpl\/ thirdparty autoload.php litespeed-cache.php\"\n\t},\n\t\"devDependencies\": {\n\t\t\"@prettier\/plugin-php\": \"^0.21.0\",\n\t\t\"prettier\": \"^3.0.3\"\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/beaver-builder.cls.php","ext":"php","size":966,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the Beaver Builder plugin.\n *\n * @since       3.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Beaver_Builder {\n\n\t\/**\n\t * Detects if Beaver_Builder is active.\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (!defined('FL_BUILDER_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/**\n\t\t * Purge All hooks\n\t\t *\n\t\t * @see  beaver-builder\/extensions\/fi-builder-cache-helper\/classes\/class-fi-builder-cache-helper.php\n\t\t *\/\n\t\t$actions = array( 'fl_builder_cache_cleared', 'fl_builder_after_save_layout', 'fl_builder_after_save_user_template', 'upgrader_process_complete' );\n\n\t\tforeach ($actions as $val) {\n\t\t\tadd_action($val, __CLASS__ . '::purge');\n\t\t}\n\t}\n\n\t\/**\n\t * Purges the cache when Beaver_Builder's cache is purged.\n\t *\n\t * @since 3.0\n\t * @access public\n\t *\/\n\tpublic static function purge() {\n\t\tdo_action('litespeed_purge_all', '3rd Beaver_Builder');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/nextgengallery.cls.php","ext":"php","size":6399,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the NextGen Gallery plugin.\n *\n * @since       1.0.5\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\n\/\/ Try preload instead\n\/\/ todo: need test\n\/\/ add_action('load_nextgen_gallery_modules', 'NextGenGallery::detect') ;\n\nclass NextGenGallery {\n\n\tconst CACHETAG_ALBUMS    = 'NGG_A.';\n\tconst CACHETAG_GALLERIES = 'NGG_G.';\n\tconst CACHETAG_TAGS      = 'NGG_T.';\n\n\t\/**\n\t * Detect is triggered at the load_nextgen_gallery_modules action.\n\t *\n\t * If this action is triggered, assume NextGen Gallery is used.\n\t *\n\t * @since   1.0.5\n\t * @access  public\n\t *\/\n\tpublic static function preload() {\n\t\tadd_action('ngg_added_new_image', __CLASS__ . '::add_image');\n\t\tadd_action('ngg_ajax_image_save', __CLASS__ . '::update_image');\n\t\tadd_action('ngg_delete_picture', __CLASS__ . '::delete_image');\n\t\tadd_action('ngg_moved_images', __CLASS__ . '::move_image', 10, 3);\n\t\tadd_action('ngg_copied_images', __CLASS__ . '::copy_image', 10, 3);\n\t\tadd_action('ngg_generated_image', __CLASS__ . '::gen_image');\n\t\tadd_action('ngg_recovered_image', __CLASS__ . '::gen_image');\n\n\t\tadd_action('ngg_gallery_sort', __CLASS__ . '::update_gallery');\n\t\tadd_action('ngg_delete_gallery', __CLASS__ . '::update_gallery');\n\n\t\tadd_action('ngg_update_album', __CLASS__ . '::update_album');\n\t\tadd_action('ngg_delete_album', __CLASS__ . '::update_album');\n\n\t\tadd_filter('ngg_displayed_gallery_cache_params', __CLASS__ . '::add_container');\n\t}\n\n\t\/**\n\t * When an image is added, need to purge all pages that displays its gallery.\n\t *\n\t * @since   1.0.5\n\t * @access  public\n\t * @param   string $image  The image object added.\n\t *\/\n\tpublic static function add_image( $image ) {\n\t\tif (!$image || !method_exists($image, 'get_gallery')) {\n\t\t\treturn;\n\t\t}\n\t\t$gallery = $image->get_gallery();\n\t\tif ($gallery && $gallery->pageid) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $gallery->pageid);\n\t\t}\n\t}\n\n\t\/**\n\t * When an image is updated, need to purge all pages that displays its gallery.\n\t *\n\t * @since 1.0.5\n\t * @access  public\n\t *\/\n\tpublic static function update_image() {\n\t\tif (isset($_REQUEST['gallery_id'])) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . sanitize_key($_REQUEST['gallery_id']));\n\t\t\treturn;\n\t\t}\n\n\t\tif (isset($_POST['task_list'])) {\n\t\t\t$task_list = str_replace('\\\\', '', $_POST['task_list']);\n\t\t\t$task_list = json_decode($task_list, true);\n\n\t\t\tif (!empty($task_list[0]['query']['id'])) {\n\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . sanitize_key($task_list[0]['query']['id']));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (isset($_POST['id'])) {\n\t\t\t$id = (int) $_POST['id'];\n\t\t} elseif (isset($_POST['image'])) {\n\t\t\t$id = (int) $_POST['image'];\n\t\t} elseif (isset($_GET['pid'])) {\n\t\t\t$id = (int) $_GET['pid'];\n\t\t} else {\n\t\t\terror_log('LiteSpeed_Cache hit ngg_ajax_image_save with no post image id.');\n\t\t\treturn;\n\t\t}\n\t\t$image = \\C_Image_Mapper::get_instance()->find($id);\n\t\tif ($image) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $image->galleryid);\n\t\t}\n\t}\n\n\t\/**\n\t * When an image is deleted, need to purge all pages that displays its gallery.\n\t *\n\t * @since 1.0.5\n\t * @access  public\n\t *\/\n\tpublic static function delete_image() {\n\t\tif (isset($_GET['gid'])) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . sanitize_key($_GET['gid']));\n\t\t}\n\t}\n\n\t\/**\n\t * When an image is moved, need to purge all old galleries and the new gallery.\n\t *\n\t * @since 1.0.8\n\t * @access  public\n\t * @param array   $images unused\n\t * @param array   $old_gallery_ids Source gallery ids for the images.\n\t * @param integer $new_gallery_id Destination gallery id.\n\t *\/\n\tpublic static function move_image( $images, $old_gallery_ids, $new_gallery_id ) {\n\t\tforeach ($old_gallery_ids as $gid) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $gid);\n\t\t}\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $new_gallery_id);\n\t}\n\n\t\/**\n\t * When an image is copied, need to purge the destination gallery.\n\t *\n\t * @param array   $image_pid_map unused\n\t * @param array   $old_gallery_ids unused\n\t * @param integer $new_gallery_id Destination gallery id.\n\t *\/\n\tpublic static function copy_image( $image_pid_map, $old_gallery_ids, $new_gallery_id ) {\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $new_gallery_id);\n\t}\n\n\t\/**\n\t * When an image is re-generated, need to purge the gallery it belongs to.\n\t * Also applies to recovered images.\n\t *\n\t * @param Image $image The re-generated image.\n\t *\/\n\tpublic static function gen_image( $image ) {\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $image->galleryid);\n\t}\n\n\t\/**\n\t * When a gallery is updated, need to purge all pages that display the gallery.\n\t *\n\t * @since 1.0.5\n\t * @access  public\n\t * @param   integer $gid    The gallery id of the gallery updated.\n\t *\/\n\tpublic static function update_gallery( $gid ) {\n\t\t\/\/ New version input will be an object with gid value\n\t\tif (is_object($gid) && !empty($gid->gid)) {\n\t\t\t$gid = $gid->gid;\n\t\t}\n\n\t\tdo_action('litespeed_purge', self::CACHETAG_GALLERIES . $gid);\n\t}\n\n\t\/**\n\t * When an album is updated, need to purge all pages that display the album.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param   integer $aid    The album id of the album updated.\n\t *\/\n\tpublic static function update_album( $aid ) {\n\t\tdo_action('litespeed_purge', self::CACHETAG_ALBUMS . $aid);\n\t}\n\n\t\/**\n\t * When rendering a page, if the page has a gallery, album or tag cloud,\n\t * it needs to be tagged appropriately.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param object $render_parms Parameters used to render the associated part of the page.\n\t * @return mixed Null if passed in null, $render_parms otherwise.\n\t *\/\n\tpublic static function add_container( $render_parms ) {\n\t\t\/\/ Check if null. If it is null, can't continue.\n\t\tif (is_null($render_parms)) {\n\t\t\treturn null;\n\t\t}\n\t\t$src           = $render_parms[0]->source;\n\t\t$container_ids = $render_parms[0]->container_ids;\n\t\t\/\/ Can switch on first char if we end up with more sources.\n\t\tswitch ($src) {\n\t\t\tcase 'albums':\n            $tag = self::CACHETAG_ALBUMS;\n\t\t\t\tbreak;\n\t\t\tcase 'galleries':\n            $tag = self::CACHETAG_GALLERIES;\n\t\t\t\tbreak;\n\t\t\tcase 'tags':\n            $tag = self::CACHETAG_TAGS;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn $render_parms;\n\t\t}\n\n\t\tforeach ($container_ids as $id) {\n\t\t\tdo_action('litespeed_tag_add', $tag . $id);\n\t\t}\n\n\t\treturn $render_parms;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/yith-wishlist.cls.php","ext":"php","size":4464,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the YITH WooCommerce Wishlist plugin.\n *\n * @since       1.1.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Tag;\nuse LiteSpeed\\Conf;\nuse LiteSpeed\\Base;\n\nclass Yith_Wishlist {\n\n\tconst ESI_PARAM_POSTID = 'yith_pid';\n\tprivate static $_post_id;\n\n\t\/**\n\t * Detects if YITH WooCommerce Wishlist and WooCommerce are installed.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (!defined('WOOCOMMERCE_VERSION') || !defined('YITH_WCWL')) {\n\t\t\treturn;\n\t\t}\n\t\tif (apply_filters('litespeed_esi_status', false)) {\n\t\t\tadd_action('litespeed_tpl_normal', __CLASS__ . '::is_not_esi');\n\t\t\tadd_action('litespeed_esi_load-yith_wcwl_add', __CLASS__ . '::load_add_to_wishlist');\n\t\t\tadd_filter('litespeed_esi_inline-yith_wcwl_add', __CLASS__ . '::inline_add_to_wishlist', 20, 2);\n\n\t\t\t\/\/ hook to add\/delete wishlist\n\t\t\tadd_action('yith_wcwl_added_to_wishlist', __CLASS__ . '::purge');\n\t\t\tadd_action('yith_wcwl_removed_from_wishlist', __CLASS__ . '::purge');\n\t\t}\n\t}\n\n\t\/**\n\t * Purge ESI yith cache when add\/remove items\n\t *\n\t * @since 1.2.0\n\t * @access public\n\t *\/\n\tpublic static function purge() {\n\t\tdo_action('litespeed_purge_esi', 'yith_wcwl_add');\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_is_not_esi_template action.\n\t *\n\t * If the request is not an ESI request, hook to the add to wishlist button\n\t * filter to replace it as an esi block.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function is_not_esi() {\n\t\tadd_filter('yith_wcwl_add_to_wishlist_params', __CLASS__ . '::add_to_wishlist_params', 999, 2);\n\n\t\tadd_filter('yith_wcwl_add_to_wishlisth_button_html', __CLASS__ . '::sub_add_to_wishlist', 999);\n\t}\n\n\t\/**\n\t * Store the post id for later shortcode usage\n\t *\n\t * @since  3.4.1\n\t *\/\n\tpublic static function add_to_wishlist_params( $defaults, $atts ) {\n\t\tself::$_post_id = !empty($atts['product_id']) ? $atts['product_id'] : $defaults['product_id'];\n\n\t\treturn $defaults;\n\t}\n\n\t\/**\n\t * Hooked to the yith_wcwl_add_to_wishlisth_button_html filter.\n\t *\n\t * The add to wishlist button displays a different output when the item is already in the wishlist\/cart.\n\t * For this reason, the button must be an ESI block. This function replaces the normal html with the ESI block.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function sub_add_to_wishlist( $template ) {\n\t\t$params = array(\n\t\t\tself::ESI_PARAM_POSTID => self::$_post_id,\n\t\t);\n\n\t\t$inline_tags  = array( '', rtrim(Tag::TYPE_ESI, '.'), Tag::TYPE_ESI . 'yith_wcwl_add' );\n\t\t$inline_tags  = implode(\n\t\t\t',',\n\t\t\tarray_map(function ( $val ) {\n\t\t\t\treturn 'public:' . LSWCP_TAG_PREFIX . '_' . $val;\n\t\t\t}, $inline_tags)\n\t\t);\n\t\t$inline_tags .= ',' . LSWCP_TAG_PREFIX . '_tag_priv';\n\n\t\tdo_action('litespeed_esi_combine', 'yith_wcwl_add');\n\n\t\t$inline_params = array(\n\t\t\t'val' => $template,\n\t\t\t'tag' => $inline_tags,\n\t\t\t'control' => 'private,no-vary,max-age=' . Conf::cls()->conf(Base::O_CACHE_TTL_PRIV),\n\t\t);\n\n\t\treturn apply_filters('litespeed_esi_url', 'yith_wcwl_add', 'YITH ADD TO WISHLIST', $params, 'private,no-vary', false, false, false, $inline_params);\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_esi_load-yith_wcwl_add action.\n\t *\n\t * This will load the add to wishlist button html for output.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function load_add_to_wishlist( $params ) {\n\t\t\/\/ global $post, $wp_query;\n\t\t\/\/ $post = get_post( $params[ self::ESI_PARAM_POSTID ] );\n\t\t\/\/ $wp_query->setup_postdata( $post );\n\t\techo \\YITH_WCWL_Shortcode::add_to_wishlist(array( 'product_id' => $params[self::ESI_PARAM_POSTID] ));\n\t\tdo_action('litespeed_control_set_private', 'yith wishlist');\n\t\tdo_action('litespeed_vary_no');\n\t}\n\n\t\/**\n\t * Generate ESI inline value\n\t *\n\t * @since  3.4.2\n\t *\/\n\tpublic static function inline_add_to_wishlist( $res, $params ) {\n\t\tif (!is_array($res)) {\n\t\t\t$res = array();\n\t\t}\n\n\t\t$pid = $params[self::ESI_PARAM_POSTID];\n\n\t\t$res['val'] = \\YITH_WCWL_Shortcode::add_to_wishlist(array( 'product_id' => $pid ));\n\n\t\t$res['control'] = 'private,no-vary,max-age=' . Conf::cls()->conf(Base::O_CACHE_TTL_PRIV);\n\n\t\t$inline_tags  = array( '', rtrim(Tag::TYPE_ESI, '.'), Tag::TYPE_ESI . 'yith_wcwl_add' );\n\t\t$inline_tags  = implode(\n\t\t\t',',\n\t\t\tarray_map(function ( $val ) {\n\t\t\t\treturn 'public:' . LSWCP_TAG_PREFIX . '_' . $val;\n\t\t\t}, $inline_tags)\n\t\t);\n\t\t$inline_tags .= ',' . LSWCP_TAG_PREFIX . '_tag_priv';\n\n\t\t$res['tag'] = $inline_tags;\n\n\t\treturn $res;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/woocommerce.content.tpl.php","ext":"php","size":3603,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined( 'WPINC' ) || exit;\n\nuse LiteSpeed\\API;\nuse LiteSpeed\\Doc;\nuse LiteSpeed\\Admin_Display;\nuse LiteSpeed\\Lang;\nuse LiteSpeed\\Base;\n?>\n\n<div data-litespeed-layout='woocommerce'>\n\n\t<h3 class=\"litespeed-title-short\">\n\t\t<?php echo __( 'WooCommerce Settings', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#woocommerce-tab' ); ?>\n\t<\/h3>\n\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php echo __( 'NOTICE:', 'litespeed-cache' ); ?><\/h4>\n\t\t<p><?php echo __( 'After verifying that the cache works in general, please test the cart.', 'litespeed-cache' ); ?><\/p>\n\t\t<p><?php printf( __( 'To test the cart, visit the <a %s>FAQ<\/a>.', 'litespeed-cache' ), 'href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/installation\/#non-cacheable-pages\" target=\"_blank\"' ); ?><\/p>\n\t\t<p><?php echo __( 'By default, the My Account, Checkout, and Cart pages are automatically excluded from caching. Misconfiguration of page associations in WooCommerce settings may cause some pages to be erroneously excluded.', 'litespeed-cache' ); ?><\/p>\n\t<\/div>\n\n\t<table class=\"wp-list-table striped litespeed-table\">\n\t\t<tbody>\n\t\t\t<tr>\n\t\t\t\t<th>\n\t\t\t\t\t<?php $id = self::O_UPDATE_INTERVAL; ?>\n\t\t\t\t\t<?php echo __( 'Product Update Interval', 'litespeed-cache' ); ?>\n\t\t\t\t<\/th>\n\t\t\t\t<td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$options = array(\n\t\t\t\t\t\tself::O_PQS_CS  => __( 'Purge product on changes to the quantity or stock status.', 'litespeed-cache' ) . ' ' . __( 'Purge categories only when stock status changes.', 'litespeed-cache' ),\n\t\t\t\t\t\tself::O_PS_CS   => __( 'Purge product and categories only when the stock status changes.', 'litespeed-cache' ),\n\t\t\t\t\t\tself::O_PS_CN   => __( 'Purge product only when the stock status changes.', 'litespeed-cache' ) . ' ' . __( 'Do not purge categories on changes to the quantity or stock status.', 'litespeed-cache' ),\n\t\t\t\t\t\tself::O_PQS_CQS => __( 'Always purge both product and categories on changes to the quantity or stock status.', 'litespeed-cache' ),\n\t\t\t\t\t);\n\t\t\t\t\t$conf    = (int) apply_filters( 'litespeed_conf', $id );\n\t\t\t\t\tforeach ( $options as $k => $v ) :\n\t\t\t\t\t\t$checked = (int) $k === $conf ? ' checked ' : '';\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<?php do_action( 'litespeed_setting_enroll', $id ); ?>\n\t\t\t\t\t\t<div class='litespeed-radio-row'>\n\t\t\t\t\t\t\t<input type='radio' autocomplete='off' name='<?php echo $id; ?>' id='conf_<?php echo $id; ?>_<?php echo $k; ?>' value='<?php echo $k; ?>' <?php echo $checked; ?> \/>\n\t\t\t\t\t\t\t<label for='conf_<?php echo $id; ?>_<?php echo $k; ?>'><?php echo $v; ?><\/label>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php echo __( 'Determines how changes in product quantity and product stock status affect product pages and their associated category pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\n\t\t\t<tr>\n\t\t\t\t<th>\n\t\t\t\t\t<?php $id = self::O_CART_VARY; ?>\n\t\t\t\t\t<?php echo __( 'Vary for Mini Cart', 'litespeed-cache' ); ?>\n\t\t\t\t<\/th>\n\t\t\t\t<td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$conf = (int) apply_filters( 'litespeed_conf', $id );\n\t\t\t\t\t$this->cls( 'Admin_Display' )->build_switch( $id );\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php echo __( 'Generate a separate vary cache copy for the mini cart when the cart is not empty.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php echo __( 'If your theme does not use JS to update the mini cart, you must enable this option to display the correct cart contents.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<br \/><?php Doc::notice_htaccess(); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\n\t\t<\/tbody>\n\t<\/table>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/facetwp.cls.php","ext":"php","size":711,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with FacetWP.\n *\n * @since       2.9.9\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Facetwp {\n\n\tpublic static function detect() {\n\t\tif (!defined('FACETWP_VERSION')) {\n\t\t\treturn;\n\t\t}\n\t\t\/**\n\t\t * For Facetwp, if the template is \"wp\", return the buffered HTML\n\t\t * So marked as rest call to put is_json to ESI\n\t\t *\/\n\t\tif (!empty($_POST['action']) && !empty($_POST['data']) && !empty($_POST['data']['template']) && $_POST['data']['template'] === 'wp') {\n\t\t\tadd_filter('litespeed_esi_params', __CLASS__ . '::set_is_json');\n\t\t}\n\t}\n\n\tpublic static function set_is_json( $params ) {\n\t\t$params['is_json'] = 1;\n\t\treturn $params;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wpml.cls.php","ext":"php","size":653,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with WPML.\n *\n * @since       2.9.4\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WPML {\n\n\tpublic static function detect() {\n\t\tif (!defined('WPML_PLUGIN_BASENAME')) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('litespeed_internal_domains', __CLASS__ . '::append_domains');\n\t}\n\n\t\/**\n\t * Take language domains as internal domains\n\t *\/\n\tpublic static function append_domains( $domains ) {\n\t\t$wpml_domains = apply_filters('wpml_setting', false, 'language_domains');\n\t\tif ($wpml_domains) {\n\t\t\t$domains = array_merge($domains, array_values($wpml_domains));\n\t\t}\n\n\t\treturn $domains;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/autoptimize.cls.php","ext":"php","size":756,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the Autoptimize plugin.\n *\n * @since       1.0.12\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Autoptimize {\n\n\t\/**\n\t * Detects if Autoptimize is active.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (defined('AUTOPTIMIZE_PLUGIN_DIR')) {\n\t\t\tadd_action('litespeed_purge_finalize', __CLASS__ . '::purge');\n\t\t}\n\t}\n\n\t\/**\n\t * Purges the cache when Autoptimize's cache is purged.\n\t *\n\t * @since 1.0.12\n\t * @access public\n\t *\/\n\tpublic static function purge() {\n\t\tif (defined('AUTOPTIMIZE_PURGE') || has_action('shutdown', 'autoptimize_do_cachepurged_action', 11)) {\n\t\t\tdo_action('litespeed_purge_all', '3rd Autoptimize');\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/user-switching.cls.php","ext":"php","size":544,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with User Switching.\n *\n * @since       3.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass User_Switching {\n\n\tpublic static function detect() {\n\t\tif (!class_exists('user_switching')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/**\n\t\t * Register switch back URL nonce\n\t\t *\n\t\t * @since  3.0 @Robert Staddon\n\t\t *\/\n\t\tif (function_exists('current_user_switched') && ($old_user = current_user_switched())) {\n\t\t\tdo_action('litespeed_nonce', 'switch_to_olduser_' . $old_user->ID);\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/litespeed-check.cls.php","ext":"php","size":4756,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * Check if any plugins that could conflict with LiteSpeed Cache are active.\n *\n * @since       4.7\n *\/\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass LiteSpeed_Check {\n\n\tpublic static $_incompatible_plugins = array(\n\t\t\/\/ 'autoptimize\/autoptimize.php',\n\t\t'breeze\/breeze.php',\n\t\t'cache-enabler\/cache-enabler.php',\n\t\t'cachify\/cachify.php',\n\t\t'cloudflare\/cloudflare.php',\n\t\t'comet-cache\/comet-cache.php',\n\t\t'docket-cache\/docket-cache.php',\n\t\t'fast-velocity-minify\/fvm.php',\n\t\t'hummingbird-performance\/wp-hummingbird.php',\n\t\t'nginx-cache\/nginx-cache.php',\n\t\t'nitropack\/main.php',\n\t\t'pantheon-advanced-page-cache\/pantheon-advanced-page-cache.php',\n\t\t'powered-cache\/powered-cache.php',\n\t\t'psn-pagespeed-ninja\/pagespeedninja.php',\n\t\t'sg-cachepress\/sg-cachepress.php',\n\t\t'simple-cache\/simple-cache.php',\n\t\t\/\/ 'redis-cache\/redis-cache.php',\n\t\t'w3-total-cache\/w3-total-cache.php',\n\t\t'wp-cloudflare-page-cache\/wp-cloudflare-page-cache.php',\n\t\t'wp-fastest-cache\/wpFastestCache.php',\n\t\t'wp-meteor\/wp-meteor.php',\n\t\t'wp-optimize\/wp-optimize.php',\n\t\t'wp-performance-score-booster\/wp-performance-score-booster.php',\n\t\t'wp-rocket\/wp-rocket.php',\n\t\t'wp-super-cache\/wp-cache.php',\n\t);\n\n\tprivate static $_option = 'thirdparty_litespeed_check';\n\tprivate static $_msg_id = 'id=\"lscwp-incompatible-plugin-notice\"';\n\n\tpublic static function detect() {\n\t\tif (!is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/**\n\t\t * Check for incompatible plugins when `litespeed-cache` is first activated.\n\t\t *\/\n\t\t$plugin = basename(LSCWP_DIR) . '\/litespeed-cache.php';\n\t\tregister_deactivation_hook($plugin, function ( $_network_wide ) {\n\t\t\t\\LiteSpeed\\Admin_Display::delete_option(self::$_option);\n\t\t});\n\t\tif (!\\LiteSpeed\\Admin_Display::get_option(self::$_option)) {\n\t\t\tself::activated_plugin($plugin, null);\n\t\t\t\\LiteSpeed\\Admin_Display::add_option(self::$_option, true);\n\t\t}\n\n\t\t\/**\n\t\t * Check for incompatible plugins when any plugin is (de)activated.\n\t\t *\/\n\t\tadd_action('activated_plugin', __CLASS__ . '::activated_plugin', 10, 2);\n\t\tadd_action('deactivated_plugin', __CLASS__ . '::deactivated_plugin', 10, 2);\n\n\t\tif (class_exists('PagespeedNinja')) {\n\t\t\t\\LiteSpeed\\Admin_Display::error(\n\t\t\t\t'<div ' .\n\t\t\t\t\tself::$_msg_id .\n\t\t\t\t\t'>' .\n\t\t\t\t\t__('Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', 'litespeed-cache') .\n\t\t\t\t\t'<p style=\"color: red; font-weight: 700;\">' .\n\t\t\t\t\t'PageSpeed Ninja' .\n\t\t\t\t\t'<\/p>' .\n\t\t\t\t\t'<\/div>'\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic static function activated_plugin( $plugin, $network_wide ) {\n\t\tself::incompatible_plugin_notice($plugin, $network_wide, 'activated');\n\t}\n\n\tpublic static function deactivated_plugin( $plugin, $network_wide ) {\n\t\tself::incompatible_plugin_notice($plugin, $network_wide, 'deactivated');\n\t}\n\n\t\/**\n\t * Detect any incompatible plugins that are currently `active` and `valid`.\n\t * Show a notification if there are any.\n\t *\/\n\tpublic static function incompatible_plugin_notice( $plugin, $_network_wide, $action ) {\n\t\tself::update_messages();\n\n\t\t\/**\n\t\t * The 'deactivated_plugin' action fires before\n\t\t * `wp_get_active_and_valid_plugins` can see the change, so we'll need to\n\t\t * remove `$plugin` from the list.\n\t\t *\/\n\t\t$deactivated = 'deactivated' === $action ? array( $plugin ) : array();\n\n\t\t$incompatible_plugins = array_map(function ( $plugin ) {\n\t\t\treturn WP_PLUGIN_DIR . '\/' . $plugin;\n\t\t}, array_diff(self::$_incompatible_plugins, $deactivated));\n\n\t\t$active_incompatible_plugins = array_map(function ( $plugin ) {\n\t\t\t$plugin = get_plugin_data($plugin, false, true);\n\t\t\treturn $plugin['Name'];\n\t\t}, array_intersect($incompatible_plugins, wp_get_active_and_valid_plugins()));\n\n\t\tif (empty($active_incompatible_plugins)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\\LiteSpeed\\Admin_Display::error(\n\t\t\t'<div ' .\n\t\t\t\tself::$_msg_id .\n\t\t\t\t'>' .\n\t\t\t\t__('Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', 'litespeed-cache') .\n\t\t\t\t'<p style=\"color: red; font-weight: 700;\">' .\n\t\t\t\timplode(', ', $active_incompatible_plugins) .\n\t\t\t\t'<\/p>' .\n\t\t\t\t'<\/div>',\n\t\t\tfalse,\n\t\t\ttrue\n\t\t);\n\t}\n\n\t\/**\n\t * Prevent multiple incompatible plugin notices, in case an admin (de)activates\n\t * a number of incompatible plugins in succession without dismissing the\n\t * notice(s).\n\t *\/\n\tprivate static function update_messages() {\n\t\t$messages = \\LiteSpeed\\Admin_Display::get_option(\\LiteSpeed\\Admin_Display::DB_MSG_PIN, array());\n\t\tif (is_array($messages)) {\n\t\t\tforeach ($messages as $index => $message) {\n\t\t\t\tif (strpos($message, self::$_msg_id) !== false) {\n\t\t\t\t\tunset($messages[$index]);\n\t\t\t\t\tif (!$messages) {\n\t\t\t\t\t\t$messages = -1;\n\t\t\t\t\t}\n\t\t\t\t\t\\LiteSpeed\\Admin_Display::update_option(\\LiteSpeed\\Admin_Display::DB_MSG_PIN, $messages);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/gravity-forms.cls.php","ext":"php","size":545,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with Gravity Forms.\n *\n * @since       4.1.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Gravity_Forms {\n\n\t\/**\n\t * Check if GF is enabled and disable LSCWP on gf-download and gf-signature URI\n\t *\n\t * @since 4.1.0 #900899 #827184\n\t *\/\n\tpublic static function preload() {\n\t\tif (class_exists('GFCommon')) {\n\t\t\tif (isset($_GET['gf-download']) || isset($_GET['gf-signature'])) {\n\t\t\t\tdo_action('litespeed_disable_all', 'Stopped for Gravity Form');\n\t\t\t}\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/theme-my-login.cls.php","ext":"php","size":895,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the Theme My Login plugin.\n *\n * @since       1.0.15\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Theme_My_Login {\n\n\t\/**\n\t * Detects if Better Theme My Login is active.\n\t *\n\t * @since 1.0.15\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (defined('THEME_MY_LOGIN_PATH')) {\n\t\t\tadd_action('litespeed_control_finalize', __CLASS__ . '::set_control');\n\t\t}\n\t}\n\n\t\/**\n\t * This filter is used to let the cache know if a page is cacheable.\n\t *\n\t * @access public\n\t * @since 1.0.15\n\t *\/\n\tpublic static function set_control() {\n\t\tif (!apply_filters('litespeed_control_cacheable', false)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ check if this page is TML page or not\n\t\tif (class_exists('Theme_My_Login') && \\Theme_My_Login::is_tml_page()) {\n\t\t\tdo_action('litespeed_control_set_nocache', 'Theme My Login');\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/entry.inc.php","ext":"php","size":1515,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The registry for Third Party Plugins Integration files.\n *\n * This file is only used to include the integration files\/classes.\n * This works as an entry point for the initial add_action for the\n * detect function.\n *\n * It is not required to add all integration files here, this just provides\n * a common place for plugin authors to append their file to.\n *\/\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\n$third_cls = array(\n\t'Aelia_CurrencySwitcher',\n\t'Autoptimize',\n\t'Avada',\n\t'BBPress',\n\t'Beaver_Builder',\n\t'Caldera_Forms',\n\t'Divi_Theme_Builder',\n\t'Facetwp',\n\t'LiteSpeed_Check',\n\t'Theme_My_Login',\n\t'User_Switching',\n\t'WCML',\n\t'WooCommerce',\n\t'WC_PDF_Product_Vouchers',\n\t'Woo_Paypal',\n\t'Wp_Polls',\n\t'WP_PostRatings',\n\t'Wpdiscuz',\n\t'WPLister',\n\t'WPML',\n\t'WpTouch',\n\t'Yith_Wishlist',\n);\n\nforeach ($third_cls as $cls) {\n\tadd_action('litespeed_load_thirdparty', 'LiteSpeed\\Thirdparty\\\\' . $cls . '::detect');\n}\n\n\/\/ Preload needed for certain thirdparty\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Divi_Theme_Builder::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\WooCommerce::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\NextGenGallery::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\AMP::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Elementor::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Gravity_Forms::preload');\nadd_action('litespeed_init', 'LiteSpeed\\Thirdparty\\Perfmatters::preload');\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wp-polls.cls.php","ext":"php","size":504,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the WP-Polls plugin.\n *\n * @since       1.0.7\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\n\/\/ todo: need test\n\nclass Wp_Polls {\n\n\tpublic static function detect() {\n\t\tadd_filter('wp_polls_display_pollvote', __CLASS__ . '::set_control');\n\t\tadd_filter('wp_polls_display_pollresult', __CLASS__ . '::set_control');\n\t}\n\n\tpublic static function set_control() {\n\t\tdo_action('litespeed_control_set_nocache', 'wp polls');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wplister.cls.php","ext":"php","size":713,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the WPLister plugin.\n *\n * @since        1.1.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WPLister {\n\n\t\/**\n\t * Detects if WooCommerce and WPLister are installed.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (defined('WOOCOMMERCE_VERSION') && defined('WPLISTER_VERSION')) {\n\t\t\t\/\/ User reported this will sync correctly.\n\t\t\tadd_action('wplister_revise_inventory_status', array( WooCommerce::cls(), 'backend_purge' ));\n\t\t\t\/\/ Added as a safety measure for WPLister Pro only.\n\t\t\tadd_action('wplister_inventory_status_changed', array( WooCommerce::cls(), 'backend_purge' ));\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/bbpress.cls.php","ext":"php","size":2405,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the bbPress plugin.\n *\n * @since       1.0.5\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Router;\n\nclass BBPress {\n\n\t\/**\n\t * Detect if bbPress is installed and if the page is a bbPress page.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (function_exists('is_bbpress')) {\n\t\t\tadd_action('litespeed_api_purge_post', __CLASS__ . '::on_purge'); \/\/ todo\n\t\t\tif (apply_filters('litespeed_esi_status', false)) {\n\t\t\t\t\/\/ don't consider private cache yet (will do if any feedback)\n\t\t\t\tadd_action('litespeed_control_finalize', __CLASS__ . '::set_control');\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * This filter is used to let the cache know if a page is cacheable.\n\t *\n\t * @access public\n\t * @since 1.2.0\n\t *\/\n\tpublic static function set_control() {\n\t\tif (!apply_filters('litespeed_control_cacheable', false)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ set non ESI public\n\t\tif (is_bbpress() && Router::is_logged_in()) {\n\t\t\tdo_action('litespeed_control_set_nocache', 'bbpress nocache due to loggedin');\n\t\t}\n\t}\n\n\t\/**\n\t * When a bbPress page is purged, need to purge the forums list and\n\t * any\/all ancestor pages.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t * @param integer $post_id The post id of the page being purged.\n\t *\/\n\tpublic static function on_purge( $post_id ) {\n\t\tif (!is_bbpress()) {\n\t\t\tif (!function_exists('bbp_is_forum') || !function_exists('bbp_is_topic') || !function_exists('bbp_is_reply')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!bbp_is_forum($post_id) && !bbp_is_topic($post_id) && !bbp_is_reply($post_id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t\/\/ Need to purge base forums page, bbPress page was updated.\n\t\tdo_action('litespeed_purge_posttype', bbp_get_forum_post_type());\n\t\t$ancestors = get_post_ancestors($post_id);\n\n\t\t\/\/ If there are ancestors, need to purge them as well.\n\t\tif (!empty($ancestors)) {\n\t\t\tforeach ($ancestors as $ancestor) {\n\t\t\t\tdo_action('litespeed_purge_post', $ancestor);\n\t\t\t}\n\t\t}\n\n\t\tglobal $wp_widget_factory;\n\t\t$replies_widget = $wp_widget_factory->get_widget_object('BBP_Replies_Widget');\n\t\tif (bbp_is_reply($post_id) && $replies_widget) {\n\t\t\tdo_action('litespeed_purge_widget', $replies_widget->id);\n\t\t}\n\n\t\t$topic_widget = $wp_widget_factory->get_widget_object('BBP_Topics_Widget');\n\t\tif (bbp_is_topic($post_id) && $topic_widget) {\n\t\t\tdo_action('litespeed_purge_widget', $topic_widget->id);\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wp-postratings.cls.php","ext":"php","size":632,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the WP-PostRatings plugin.\n *\n * @since       1.1.1\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WP_PostRatings {\n\n\t\/**\n\t * Detects if plugin is installed.\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (defined('WP_POSTRATINGS_VERSION')) {\n\t\t\tadd_action('rate_post', __CLASS__ . '::flush', 10, 3);\n\t\t}\n\t}\n\n\t\/**\n\t * Purges the cache\n\t *\n\t * @since 1.1.1\n\t * @access public\n\t *\/\n\tpublic static function flush( $uid, $post_id, $post_ratings_score ) {\n\t\tdo_action('litespeed_purge_post', $post_id);\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wpdiscuz.cls.php","ext":"php","size":754,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with Wpdiscuz.\n *\n * @since       2.9.5\n * @package     LiteSpeed\n * @subpackage  LiteSpeed_Cache\/thirdparty\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\nclass Wpdiscuz {\n\n\tpublic static function detect() {\n\t\tif (!defined('WPDISCUZ_DS')) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::check_commenter();\n\t\tadd_action('wpdiscuz_add_comment', __CLASS__ . '::add_comment');\n\t}\n\n\tpublic static function add_comment() {\n\t\tAPI::vary_append_commenter();\n\t}\n\n\tpublic static function check_commenter() {\n\t\t$commentor = wp_get_current_commenter();\n\n\t\tif (strlen($commentor['comment_author']) > 0) {\n\t\t\tadd_filter('litespeed_vary_check_commenter_pending', '__return_false');\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/caldera-forms.cls.php","ext":"php","size":428,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with Caldera Forms.\n *\n * @since       3.2.2\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Caldera_Forms {\n\n\tpublic static function detect() {\n\t\tif (!defined('CFCORE_VER')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ plugins\/caldera-forms\/classes\/render\/nonce.php -> class Caldera_Forms_Render_Nonce\n\t\tdo_action('litespeed_nonce', 'caldera_forms_front_*');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wc-pdf-product-vouchers.cls.php","ext":"php","size":673,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with WooCommerce PDF Product Vouchers.\n *\n * @since       5.1.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WC_PDF_Product_Vouchers {\n\n\t\/**\n\t * Do not cache generated vouchers\n\t *\n\t * @since 5.1.0\n\t *\/\n\tpublic static function detect() {\n\t\tif (!class_exists('\\WC_PDF_Product_Vouchers_Loader')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$is_voucher = !empty($_GET['post_type']) && 'wc_voucher' === $_GET['post_type'];\n\t\t$has_key    = !empty($_GET['voucher_key']) || !empty($_GET['key']);\n\n\t\tif ($is_voucher && $has_key) {\n\t\t\tdo_action('litespeed_control_set_nocache', '3rd WC PDF Product Voucher');\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/perfmatters.cls.php","ext":"php","size":683,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The Third Party integration with the Perfmatters plugin.\n *\n * @since       4.4.5\n *\/\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Perfmatters {\n\n\tpublic static function preload() {\n\t\tif (!defined('PERFMATTERS_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (has_action('shutdown', 'perfmatters_script_manager') !== false) {\n\t\t\tadd_action('init', __CLASS__ . '::disable_litespeed_esi', 4);\n\t\t}\n\t}\n\n\tpublic static function disable_litespeed_esi() {\n\t\tdefined('LITESPEED_ESI_OFF') || define('LITESPEED_ESI_OFF', true);\n\t\tdo_action('litespeed_debug', 'Disable ESI due to Perfmatters script manager');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/amp.cls.php","ext":"php","size":1882,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with AMP plugin.\n *\n * @since       2.9.8.6\n * @package     LiteSpeed\n * @subpackage  LiteSpeed_Cache\/thirdparty\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\nclass AMP {\n\n\t\/**\n\t * @since 4.2\n\t *\/\n\tprivate static function _maybe_amp( $amp_function ) {\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!isset($_GET['amp']) && (!function_exists($amp_function) || !$amp_function())) {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_debug', '[3rd] \u274c AMP disabled page optm\/lazy');\n\n\t\t!defined('LITESPEED_NO_PAGEOPTM') && define('LITESPEED_NO_PAGEOPTM', true);\n\t\t!defined('LITESPEED_NO_LAZY') && define('LITESPEED_NO_LAZY', true);\n\t\t!defined('LITESPEED_NO_OPTM') && define('LITESPEED_NO_OPTM', true);\n\t\t\/\/ ! defined( 'LITESPEED_GUEST' ) && define( 'LITESPEED_GUEST', false );\n\t}\n\n\t\/**\n\t * ampforwp_is_amp_endpoint() from Accelerated Mobile Pages\n\t *\n\t * @since 4.2\n\t *\/\n\tpublic static function maybe_acc_mob_pages() {\n\t\tself::_maybe_amp('ampforwp_is_amp_endpoint');\n\t}\n\n\t\/**\n\t * Google AMP fix\n\t *\n\t * @since 4.2.0.1\n\t *\/\n\tpublic static function maybe_google_amp() {\n\t\tself::_maybe_amp('amp_is_request');\n\t}\n\n\t\/**\n\t * CSS async will affect AMP result and\n\t * Lazyload will inject JS library which AMP not allowed\n\t * need to force set false before load\n\t *\n\t * @since 2.9.8.6\n\t * @access public\n\t *\/\n\tpublic static function preload() {\n\t\tadd_action('wp', __CLASS__ . '::maybe_acc_mob_pages');\n\t\tadd_action('wp', __CLASS__ . '::maybe_google_amp');\n\n\t\t\/\/ amp_is_request() from AMP\n\t\t\/\/ self::maybe_amp( 'amp_is_request' );\n\t\t\/\/ add_filter( 'litespeed_can_optm', '__return_false' );\n\t\t\/\/ do_action( 'litespeed_conf_force', API::O_OPTM_CSS_ASYNC, false );\n\t\t\/\/ do_action( 'litespeed_conf_force', API::O_MEDIA_LAZY, false );\n\t\t\/\/ do_action( 'litespeed_conf_force', API::O_MEDIA_IFRAME_LAZY, false );\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/woo-paypal.cls.php","ext":"php","size":623,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with WooCommerce PayPal Checkout Gateway\n *\n * @ref https:\/\/wordpress.org\/plugins\/woocommerce-gateway-paypal-express-checkout\/\n *\n * @since       3.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Woo_Paypal {\n\n\tpublic static function detect() {\n\t\tif (!defined('WC_GATEWAY_PPEC_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_nonce', '_wc_ppec_update_shipping_costs_nonce private');\n\t\tdo_action('litespeed_nonce', '_wc_ppec_start_checkout_nonce private');\n\t\tdo_action('litespeed_nonce', '_wc_ppec_generate_cart_nonce private');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/divi-theme-builder.cls.php","ext":"php","size":2287,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with DIVI Theme.\n *\n * @since       2.9.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Divi_Theme_Builder {\n\n\t\/\/ private static $js_comment_box = false;\n\n\t\/**\n\t * Check if is Edit mode in frontend, disable all LSCWP features to avoid breaking page builder\n\t *\n\t * @since 2.9.7.2 #435538 #581740 #977284\n\t * @since  2.9.9.1 Added 'et_pb_preview' for loading image from library in divi page edit\n\t *\/\n\tpublic static function preload() {\n\t\tif (!function_exists('et_setup_theme')) {\n\t\t\treturn;\n\t\t}\n\t\tif (!empty($_GET['et_fb']) || !empty($_GET['et_pb_preview']) || (!empty($_GET['p']) && !empty($_GET['preview']) && $_GET['preview'] === 'true')) {\n\t\t\tdo_action('litespeed_disable_all', 'divi edit mode');\n\t\t}\n\t}\n\n\tpublic static function detect() {\n\t\tif (!defined('ET_CORE')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ As DIVI will set page to non-cacheable for the 1st visit to generate CCSS, will need to ignore that no-cache for crawler\n\t\tdefined('LITESPEED_CRAWLER_IGNORE_NONCACHEABLE') || define('LITESPEED_CRAWLER_IGNORE_NONCACHEABLE', true);\n\n\t\t\/**\n\t\t * Add contact form to nonce\n\t\t *\n\t\t * @since  2.9.7.1 #475461\n\t\t *\/\n\t\tdo_action('litespeed_nonce', 'et-pb-contact-form-submit');\n\n\t\t\/**\n\t\t * Subscribe module and A\/B logging\n\t\t *\n\t\t * @since  3.0 @Robert Staddon\n\t\t *\/\n\t\tdo_action('litespeed_nonce', 'et_frontend_nonce');\n\t\tdo_action('litespeed_nonce', 'et_ab_log_nonce');\n\n\t\t\/*\n\t\t\/\/ the comment box fix is for user using theme builder, ESI will load the wrong json string\n\t\t\/\/ As we disabled all for edit mode, this is no more needed\n\t\tadd_action( 'et_fb_before_comments_template', 'Divi_Theme_Builder::js_comment_box_on' );\n\t\tadd_action( 'et_fb_after_comments_template', 'Divi_Theme_Builder::js_comment_box_off' );\n\t\tadd_filter( 'litespeed_esi_params-comment-form', 'Divi_Theme_Builder::esi_comment_add_slash' );\/\/ Note: this is changed in v2.9.8.1\n\t\t*\/\n\t}\n\n\t\/*\n\tpublic static function js_comment_box_on() {\n\t\tself::$js_comment_box = true;\n\t}\n\n\tpublic static function js_comment_box_off() {\n\t\tself::$js_comment_box = false;\n\t}\n\n\tpublic static function esi_comment_add_slash( $params )\n\t{\n\t\tif ( self::$js_comment_box ) {\n\t\t\t$params[ 'is_json' ] = 1;\n\t\t\t$params[ '_ls_silence' ] = 1;\n\t\t}\n\n\t\treturn $params;\n\t}\n\t*\/\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/aelia-currencyswitcher.cls.php","ext":"php","size":1801,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the Aelia CurrencySwitcher plugin.\n *\n * @since       1.0.13\n * @since       2.6     Removed hook_vary as OLS supports vary header already\n * @package     LiteSpeed\n * @subpackage  LiteSpeed_Cache\/thirdparty\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\n\nclass Aelia_CurrencySwitcher {\n\n\tprivate static $_cookies = array( 'aelia_cs_selected_currency', 'aelia_customer_country', 'aelia_customer_state', 'aelia_tax_exempt' );\n\n\t\/**\n\t * Detects if WooCommerce is installed.\n\t *\n\t * @since 1.0.13\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (defined('WOOCOMMERCE_VERSION') && isset($GLOBALS['woocommerce-aelia-currencyswitcher']) && is_object($GLOBALS['woocommerce-aelia-currencyswitcher'])) {\n\t\t\t\/\/ Not all pages need to add vary, so need to use this API to set conditions\n\t\t\tself::$_cookies = apply_filters('litespeed_3rd_aelia_cookies', self::$_cookies);\n\t\t\tadd_filter('litespeed_vary_curr_cookies', __CLASS__ . '::check_cookies'); \/\/ this is for vary response headers, only add when needed\n\t\t\tadd_filter('litespeed_vary_cookies', __CLASS__ . '::register_cookies'); \/\/ this is for rewrite rules, so always add\n\t\t}\n\t}\n\n\tpublic static function register_cookies( $list ) {\n\t\treturn array_merge($list, self::$_cookies);\n\t}\n\n\t\/**\n\t * If the page is not a woocommerce page, ignore the logic.\n\t * Else check cookies. If cookies are set, set the vary headers, else do not cache the page.\n\t *\n\t * @since 1.0.13\n\t * @access public\n\t *\/\n\tpublic static function check_cookies( $list ) {\n\t\t\/\/ NOTE: is_cart and is_checkout should also be checked, but will be checked by woocommerce anyway.\n\t\tif (!is_woocommerce()) {\n\t\t\treturn $list;\n\t\t}\n\n\t\treturn array_merge($list, self::$_cookies);\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/avada.cls.php","ext":"php","size":671,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the Avada plugin.\n *\n * @since       1.1.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass Avada {\n\n\t\/**\n\t * Detects if Avada is installed.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (!defined('AVADA_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_action('update_option_avada_dynamic_css_posts', __CLASS__ . '::flush');\n\t\tadd_action('update_option_fusion_options', __CLASS__ . '::flush');\n\t}\n\n\t\/**\n\t * Purges the cache\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic static function flush() {\n\t\tdo_action('litespeed_purge_all', '3rd avada');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/woocommerce.tab.tpl.php","ext":"php","size":230,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * WooCommerce tab template for LiteSpeed Cache plugin.\n *\n * @package LiteSpeed\n *\/\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<a class='litespeed-tab nav-tab' href='#woocommerce' data-litespeed-tab='woocommerce'>WooCommerce<\/a>\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/elementor.cls.php","ext":"php","size":1671,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the bbPress plugin.\n *\n * @since       2.9.8.8\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\Debug2;\n\nclass Elementor {\n\n\tpublic static function preload() {\n\t\tif (!defined('ELEMENTOR_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!is_admin()) {\n\t\t\t\/\/ add_action( 'init', __CLASS__ . '::disable_litespeed_esi', 4 ); \/\/ temporarily comment out this line for backward compatibility\n\t\t}\n\n\t\tif (isset($_GET['action']) && $_GET['action'] === 'elementor') {\n\t\t\tdo_action('litespeed_disable_all', 'elementor edit mode');\n\t\t}\n\n\t\tif (!empty($_SERVER['HTTP_REFERER']) && strpos($_SERVER['HTTP_REFERER'], 'action=elementor')) {\n\t\t\tif (!empty($_REQUEST['actions'])) {\n\t\t\t\t$json = json_decode(stripslashes($_REQUEST['actions']), true);\n\t\t\t\t\/\/ Debug2::debug( '3rd Elementor', $json );\n\t\t\t\tif (\n\t\t\t\t\t!empty($json['save_builder']['action']) &&\n\t\t\t\t\t$json['save_builder']['action'] == 'save_builder' &&\n\t\t\t\t\t!empty($json['save_builder']['data']['status']) &&\n\t\t\t\t\t$json['save_builder']['data']['status'] == 'publish'\n\t\t\t\t) {\n\t\t\t\t\treturn; \/\/ Save post, don't disable all in case we will allow fire crawler right away after purged\n\t\t\t\t}\n\t\t\t}\n\t\t\tdo_action('litespeed_disable_all', 'elementor edit mode in HTTP_REFERER');\n\t\t}\n\n\t\t\/\/ Clear LSC cache on Elementor Regenerate CSS & Data\n\t\tadd_action('elementor\/core\/files\/clear_cache', __CLASS__ . '::regenerate_litespeed_cache');\n\t}\n\n\tpublic static function disable_litespeed_esi() {\n\t\tdefine('LITESPEED_ESI_OFF', true);\n\t}\n\n\tpublic static function regenerate_litespeed_cache() {\n\t\tdo_action('litespeed_purge_all', 'Elementor - Regenerate CSS & Data');\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/woocommerce.cls.php","ext":"php","size":24919,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\n\/**\n * The Third Party integration with the WooCommerce plugin.\n *\n * @since         1.0.5\n * @since  1.6.6 Added function_exists check for compatibility\n * @package       LiteSpeed\n * @subpackage    LiteSpeed_Cache\/thirdparty\n *\/\n\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nuse LiteSpeed\\API;\nuse LiteSpeed\\Base;\nuse LiteSpeed\\ESI;\n\nclass WooCommerce extends Base {\n\n\tconst O_CACHE_TTL_FRONTPAGE = Base::O_CACHE_TTL_FRONTPAGE;\n\n\tconst CACHETAG_SHOP     = 'WC_S';\n\tconst CACHETAG_TERM     = 'WC_T.';\n\tconst O_UPDATE_INTERVAL = 'wc_update_interval';\n\tconst O_CART_VARY       = 'wc_cart_vary';\n\tconst O_PQS_CS          = 0; \/\/ flush product on quantity + stock change, categories on stock change\n\tconst O_PS_CS           = 1; \/\/ flush product and categories on stock change\n\tconst O_PS_CN           = 2; \/\/ flush product on stock change, categories no flush\n\tconst O_PQS_CQS         = 3; \/\/ flush product and categories on quantity + stock change\n\n\tconst ESI_PARAM_ARGS    = 'wc_args';\n\tconst ESI_PARAM_POSTID  = 'wc_post_id';\n\tconst ESI_PARAM_NAME    = 'wc_name';\n\tconst ESI_PARAM_PATH    = 'wc_path';\n\tconst ESI_PARAM_LOCATED = 'wc_located';\n\n\tprivate $esi_enabled;\n\n\t\/**\n\t * Detects if WooCommerce is installed.\n\t *\n\t * @since 1.0.5\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tif (!defined('WOOCOMMERCE_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::cls()->add_hooks();\n\t}\n\n\t\/**\n\t * Add hooks to woo actions\n\t *\n\t * @since  1.6.3\n\t * @access public\n\t *\/\n\tpublic function add_hooks() {\n\t\t$this->_option_append();\n\n\t\t$this->esi_enabled = apply_filters('litespeed_esi_status', false);\n\n\t\tadd_action('litespeed_control_finalize', array( $this, 'set_control' ));\n\t\tadd_action('litespeed_tag_finalize', array( $this, 'set_tag' ));\n\n\t\t\/\/ Purging a product on stock change should only occur during product purchase. This function will add the purging callback when an order is complete.\n\t\tadd_action('woocommerce_product_set_stock', array( $this, 'purge_product' ));\n\t\tadd_action('woocommerce_variation_set_stock', array( $this, 'purge_product' )); \/\/ #984479 Update variations stock\n\n\t\tadd_action('comment_post', array( $this, 'add_review' ), 10, 3);\n\n\t\tif ($this->esi_enabled) {\n\t\t\tif (function_exists('is_shop') && !is_shop()) {\n\t\t\t\tadd_action('litespeed_tpl_normal', array( $this, 'set_block_template' ));\n\t\t\t\t\/\/ No need for add-to-cart button\n\t\t\t\t\/\/ add_action( 'litespeed_esi_load-wc-add-to-cart-form', array( $this, 'load_add_to_cart_form_block' ) ) ;\n\n\t\t\t\tadd_action('litespeed_esi_load-storefront-cart-header', array( $this, 'load_cart_header' ));\n\t\t\t\tadd_action('litespeed_esi_load-widget', array( $this, 'register_post_view' ));\n\t\t\t}\n\n\t\t\tif (function_exists('is_product') && is_product()) {\n\t\t\t\tadd_filter('litespeed_esi_params', array( $this, 'add_post_id' ), 10, 2);\n\t\t\t}\n\n\t\t\t\/\/ #612331 - remove WooCommerce geolocation redirect on ESI page (PR#708)\n\t\t\tif (!empty($_GET[ESI::QS_ACTION]) && !empty($_GET[ESI::QS_PARAMS])) {\n\t\t\t\tremove_action( 'template_redirect', array( 'WC_Cache_Helper', 'geolocation_ajax_redirect' ), 10 );\n\t\t\t}\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\tadd_action('litespeed_api_purge_post', array( $this, 'backend_purge' )); \/\/ todo\n\t\t\tadd_action('delete_term_relationships', array( $this, 'delete_rel' ), 10, 2);\n\t\t\tadd_action('litespeed_settings_tab', array( $this, 'settings_add_tab' ));\n\t\t\tadd_action('litespeed_settings_content', array( $this, 'settings_add_content' ));\n\t\t\tadd_filter('litespeed_widget_default_options', array( $this, 'wc_widget_default' ), 10, 2);\n\t\t}\n\n\t\tif (apply_filters('litespeed_conf', self::O_CART_VARY)) {\n\t\t\tadd_filter('litespeed_vary_cookies', function ( $list ) {\n\t\t\t\t$list[] = 'woocommerce_cart_hash';\n\t\t\t\treturn array_unique($list);\n\t\t\t});\n\t\t}\n\t}\n\n\t\/**\n\t * Purge esi private tag\n\t *\n\t * @since  1.6.3\n\t * @access public\n\t *\/\n\tpublic function purge_esi() {\n\t\tdo_action('litespeed_debug', '3rd woo purge ESI in action: ' . current_filter());\n\t\tdo_action('litespeed_purge_private_esi', 'storefront-cart-header');\n\t}\n\n\t\/**\n\t * Purge private all\n\t *\n\t * @since  3.0\n\t * @access public\n\t *\/\n\tpublic function purge_private_all() {\n\t\tdo_action('litespeed_purge_private_all');\n\t}\n\n\t\/**\n\t * Check if need to give an ESI block for cart\n\t *\n\t * @since  1.7.2\n\t * @access public\n\t *\/\n\tpublic function check_if_need_esi( $template ) {\n\t\tif ($this->vary_needed()) {\n\t\t\tdo_action('litespeed_debug', 'API: 3rd woo added ESI');\n\t\t\tadd_action('litespeed_tpl_normal', array( $this, 'set_swap_header_cart' ));\n\t\t}\n\n\t\treturn $template;\n\t}\n\n\t\/**\n\t * Keep vary on if cart is not empty\n\t *\n\t * @since  1.7.2\n\t * @access public\n\t *\/\n\tpublic function vary_maintain( $vary ) {\n\t\tif ($this->vary_needed()) {\n\t\t\tdo_action('litespeed_debug', 'API: 3rd woo added vary due to cart not empty');\n\t\t\t$vary['woo_cart'] = 1;\n\t\t}\n\n\t\treturn $vary;\n\t}\n\n\t\/**\n\t * Check if vary need to be on based on cart\n\t *\n\t * @since  1.7.2\n\t * @access private\n\t *\/\n\tprivate function vary_needed() {\n\t\tif (!function_exists('WC')) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$woocom = WC();\n\t\tif (!$woocom) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (is_null($woocom->cart)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn $woocom->cart->get_cart_contents_count() > 0;\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_is_not_esi_template action.\n\t * If the request is not an esi request, I want to set my own hook in woocommerce_before_template_part to see if it's something I can ESI.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic function set_block_template() {\n\t\tadd_action('woocommerce_before_template_part', array( $this, 'block_template' ), 999, 4);\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_is_not_esi_template action.\n\t * If the request is not an esi request, I want to set my own hook\n\t * in storefront_header to see if it's something I can ESI.\n\t *\n\t * Will remove storefront_header_cart in storefront_header.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t *\/\n\tpublic function set_swap_header_cart() {\n\t\t$priority = has_action('storefront_header', 'storefront_header_cart');\n\t\tif ($priority !== false) {\n\t\t\tremove_action('storefront_header', 'storefront_header_cart', $priority);\n\t\t\tadd_action('storefront_header', array( $this, 'esi_cart_header' ), $priority);\n\t\t}\n\t}\n\n\t\/**\n\t * Hooked to the woocommerce_before_template_part action.\n\t * Checks if the template contains 'add-to-cart'. If so, and if I want to ESI the request, block it and build my esi code block.\n\t *\n\t * The function parameters will be passed to the esi request.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic function block_template( $template_name, $template_path, $located, $args ) {\n\t\tif (strpos($template_name, 'add-to-cart') === false) {\n\t\t\tif (strpos($template_name, 'related.php') !== false) {\n\t\t\t\tremove_action('woocommerce_before_template_part', array( $this, 'block_template' ), 999);\n\t\t\t\tadd_filter('woocommerce_related_products_args', array( $this, 'add_related_tags' ));\n\t\t\t\tadd_action('woocommerce_after_template_part', array( $this, 'end_template' ), 999);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\treturn;\n\n\t\t\/\/ todo: wny not use?\n\n\t\tglobal $post;\n\t\t$params = array(\n\t\t\tself::ESI_PARAM_ARGS => $args,\n\t\t\tself::ESI_PARAM_NAME => $template_name,\n\t\t\tself::ESI_PARAM_POSTID => $post->ID,\n\t\t\tself::ESI_PARAM_PATH => $template_path,\n\t\t\tself::ESI_PARAM_LOCATED => $located,\n\t\t);\n\t\tadd_action('woocommerce_after_add_to_cart_form', array( $this, 'end_form' ));\n\t\tadd_action('woocommerce_after_template_part', array( $this, 'end_form' ), 999);\n\t\techo apply_filters('litespeed_esi_url', 'wc-add-to-cart-form', 'WC_CART_FORM', $params);\n\t\techo apply_filters('litespeed_clean_wrapper_begin', '');\n\t}\n\n\t\/**\n\t * Hooked to the woocommerce_after_add_to_cart_form action.\n\t * If this is hit first, clean the buffer and remove this function and\n\t * end_template.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t *\/\n\tpublic function end_form( $template_name = '' ) {\n\t\tif (!empty($template_name) && strpos($template_name, 'add-to-cart') === false) {\n\t\t\treturn;\n\t\t}\n\t\techo apply_filters('litespeed_clean_wrapper_end', '');\n\t\tremove_action('woocommerce_after_add_to_cart_form', array( $this, 'end_form' ));\n\t\tremove_action('woocommerce_after_template_part', array( $this, 'end_form' ), 999);\n\t}\n\n\t\/**\n\t * If related products are loaded, need to add the extra product ids.\n\t *\n\t * The page will be purged if any of the products are changed.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param array $args The arguments used to build the related products section.\n\t * @return array The unchanged arguments.\n\t *\/\n\tpublic function add_related_tags( $args ) {\n\t\tif (empty($args) || !isset($args['post__in'])) {\n\t\t\treturn $args;\n\t\t}\n\t\t$related_posts = $args['post__in'];\n\t\tforeach ($related_posts as $related) {\n\t\t\tdo_action('litespeed_tag_add_post', $related);\n\t\t}\n\t\treturn $args;\n\t}\n\n\t\/**\n\t * Hooked to the woocommerce_after_template_part action.\n\t * If the template contains 'add-to-cart', clean the buffer.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param type $template_name\n\t *\/\n\tpublic function end_template( $template_name ) {\n\t\tif (strpos($template_name, 'related.php') !== false) {\n\t\t\tremove_action('woocommerce_after_template_part', array( $this, 'end_template' ), 999);\n\t\t\t$this->set_block_template();\n\t\t}\n\t}\n\n\t\/**\n\t * Hooked to the storefront_header header.\n\t * If I want to ESI the request, block it and build my esi code block.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t *\/\n\tpublic function esi_cart_header() {\n\t\techo apply_filters('litespeed_esi_url', 'storefront-cart-header', 'STOREFRONT_CART_HEADER');\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_esi_load-storefront-cart-header action.\n\t * Generates the cart header for esi display.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t *\/\n\tpublic function load_cart_header() {\n\t\tstorefront_header_cart();\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_esi_load-wc-add-to-cart-form action.\n\t * Parses the esi input parameters and generates the add to cart form\n\t * for esi display.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @global type $post\n\t * @global type $wp_query\n\t * @param type $params\n\t *\/\n\tpublic function load_add_to_cart_form_block( $params ) {\n\t\tglobal $post, $wp_query;\n\t\t$post = get_post($params[self::ESI_PARAM_POSTID]);\n\t\t$wp_query->setup_postdata($post);\n\t\tfunction_exists('wc_get_template') && wc_get_template($params[self::ESI_PARAM_NAME], $params[self::ESI_PARAM_ARGS], $params[self::ESI_PARAM_PATH]);\n\t}\n\n\t\/**\n\t * Update woocommerce when someone visits a product and has the\n\t * recently viewed products widget.\n\t *\n\t * Currently, this widget should not be cached.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param array $params Widget parameter array\n\t *\/\n\tpublic function register_post_view( $params ) {\n\t\tif ($params[API::PARAM_NAME] !== 'WC_Widget_Recently_Viewed') {\n\t\t\treturn;\n\t\t}\n\t\tif (!isset($params[self::ESI_PARAM_POSTID])) {\n\t\t\treturn;\n\t\t}\n\t\t$id       = $params[self::ESI_PARAM_POSTID];\n\t\t$esi_post = get_post($id);\n\t\t$product  = function_exists('wc_get_product') ? wc_get_product($esi_post) : false;\n\n\t\tif (empty($product)) {\n\t\t\treturn;\n\t\t}\n\n\t\tglobal $post;\n\t\t$post = $esi_post;\n\t\tfunction_exists('wc_track_product_view') && wc_track_product_view();\n\t}\n\n\t\/**\n\t * Adds the post id to the widget ESI parameters for the Recently Viewed widget.\n\t *\n\t * This is needed in the ESI request to update the cookie properly.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic function add_post_id( $params, $block_id ) {\n\t\tif ($block_id == 'widget') {\n\t\t\tif ($params[API::PARAM_NAME] == 'WC_Widget_Recently_Viewed') {\n\t\t\t\t$params[self::ESI_PARAM_POSTID] = get_the_ID();\n\t\t\t}\n\t\t}\n\n\t\treturn $params;\n\t}\n\n\t\/**\n\t * Hooked to the litespeed_widget_default_options filter.\n\t *\n\t * The recently viewed widget must be esi to function properly.\n\t * This function will set it to enable and no cache by default.\n\t *\n\t * @since 1.1.0\n\t * @access public\n\t *\/\n\tpublic function wc_widget_default( $options, $widget ) {\n\t\tif (!is_array($options)) {\n\t\t\treturn $options;\n\t\t}\n\t\t$widget_name = get_class($widget);\n\t\tif ($widget_name === 'WC_Widget_Recently_Viewed') {\n\t\t\t$options[API::WIDGET_O_ESIENABLE] = API::VAL_ON2;\n\t\t\t$options[API::WIDGET_O_TTL]       = 0;\n\t\t} elseif ($widget_name === 'WC_Widget_Recent_Reviews') {\n\t\t\t$options[API::WIDGET_O_ESIENABLE] = API::VAL_ON;\n\t\t\t$options[API::WIDGET_O_TTL]       = 86400;\n\t\t}\n\t\treturn $options;\n\t}\n\n\t\/**\n\t * Set WooCommerce cache tags based on page type.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t *\/\n\tpublic function set_tag() {\n\t\t$id = get_the_ID();\n\t\tif ($id === false) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ Check if product has a cache ttl limit or not\n\t\t$sale_from = (int) get_post_meta($id, '_sale_price_dates_from', true);\n\t\t$sale_to   = (int) get_post_meta($id, '_sale_price_dates_to', true);\n\t\t$now       = current_time('timestamp');\n\t\t$ttl       = false;\n\t\tif ($sale_from && $now < $sale_from) {\n\t\t\t$ttl = $sale_from - $now;\n\t\t} elseif ($sale_to && $now < $sale_to) {\n\t\t\t$ttl = $sale_to - $now;\n\t\t}\n\t\tif ($ttl && $ttl < apply_filters('litespeed_control_ttl', 0)) {\n\t\t\tdo_action('litespeed_control_set_ttl', $ttl, \"WooCommerce set scheduled TTL to $ttl\");\n\t\t}\n\n\t\tif (function_exists('is_shop') && is_shop()) {\n\t\t\tdo_action('litespeed_tag_add', self::CACHETAG_SHOP);\n\t\t}\n\t\tif (function_exists('is_product_taxonomy') && !is_product_taxonomy()) {\n\t\t\treturn;\n\t\t}\n\t\tif (isset($GLOBALS['product_cat']) && is_string($GLOBALS['product_cat'])) {\n\t\t\t\/\/ todo: need to check previous woo version to find if its from old woo versions or not!\n\t\t\t$term = get_term_by('slug', $GLOBALS['product_cat'], 'product_cat');\n\t\t} elseif (isset($GLOBALS['product_tag']) && is_string($GLOBALS['product_tag'])) {\n\t\t\t$term = get_term_by('slug', $GLOBALS['product_tag'], 'product_tag');\n\t\t} else {\n\t\t\t$term = false;\n\t\t}\n\n\t\tif ($term === false) {\n\t\t\treturn;\n\t\t}\n\t\twhile (isset($term)) {\n\t\t\tdo_action('litespeed_tag_add', self::CACHETAG_TERM . $term->term_id);\n\t\t\tif ($term->parent == 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$term = get_term($term->parent);\n\t\t}\n\t}\n\n\t\/**\n\t * Check if the page is cacheable according to WooCommerce.\n\t *\n\t * @since 1.0.5\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param string $esi_id        The ESI block id if a request is an ESI request.\n\t * @return boolean              True if cacheable, false if not.\n\t *\/\n\tpublic function set_control( $esi_id ) {\n\t\tif (!apply_filters('litespeed_control_cacheable', false)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/**\n\t\t * Avoid possible 500 issue\n\t\t *\n\t\t * @since 1.6.2.1\n\t\t *\/\n\t\tif (!function_exists('WC')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$woocom = WC();\n\t\tif (!$woocom || empty($woocom->session)) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/ For later versions, DONOTCACHEPAGE should be set.\n\t\t\/\/ No need to check uri\/qs.\n\t\tif (version_compare($woocom->version, '1.4.2', '>=')) {\n\t\t\tif (version_compare($woocom->version, '3.2.0', '<') && defined('DONOTCACHEPAGE') && DONOTCACHEPAGE) {\n\t\t\t\tdo_action('litespeed_control_set_nocache', '3rd party woocommerce not cache by constant');\n\t\t\t\treturn;\n\t\t\t} elseif (version_compare($woocom->version, '2.1.0', '>=')) {\n\t\t\t\t$err = false;\n\n\t\t\t\tif (!function_exists('wc_get_page_id')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\/**\n\t\t\t\t * From woo\/inc\/class-wc-cache-helper.php:prevent_caching()\n\t\t\t\t *\n\t\t\t\t * @since  1.4\n\t\t\t\t *\/\n\t\t\t\t$page_ids = array_filter(array( wc_get_page_id('cart'), wc_get_page_id('checkout'), wc_get_page_id('myaccount') ));\n\t\t\t\tif (isset($_GET['download_file']) || isset($_GET['add-to-cart']) || is_page($page_ids)) {\n\t\t\t\t\t$err = 'woo non cacheable pages';\n\t\t\t\t} elseif (function_exists('wc_notice_count') && wc_notice_count() > 0) {\n\t\t\t\t\t$err = 'has wc notice';\n\t\t\t\t}\n\n\t\t\t\tif ($err) {\n\t\t\t\t\tdo_action('litespeed_control_set_nocache', '3rd party woocommerce not cache due to ' . $err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t$uri     = esc_url($_SERVER['REQUEST_URI']);\n\t\t$uri_len = strlen($uri);\n\t\tif ($uri_len < 5) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (in_array($uri, array( 'cart\/', 'checkout\/', 'my-account\/', 'addons\/', 'logout\/', 'lost-password\/', 'product\/' ))) {\n\t\t\t\/\/ why contains `product`?\n\t\t\tdo_action('litespeed_control_set_nocache', 'uri in cart\/account\/user pages');\n\t\t\treturn;\n\t\t}\n\n\t\t$qs     = sanitize_text_field($_SERVER['QUERY_STRING']);\n\t\t$qs_len = strlen($qs);\n\t\tif (!empty($qs) && $qs_len >= 12 && strpos($qs, 'add-to-cart=') === 0) {\n\t\t\tdo_action('litespeed_control_set_nocache', 'qs contains add-to-cart');\n\t\t\treturn;\n\t\t}\n\t}\n\n\t\/**\n\t * Purge a product page and related pages (based on settings) on checkout.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param WC_Product $product\n\t *\/\n\tpublic function purge_product( $product ) {\n\t\tdo_action('litespeed_debug', '[3rd] Woo Purge [pid] ' . $product->get_id());\n\n\t\t$do_purge = function ( $action, $debug = '' ) use ( $product ) {\n\t\t\t$config = apply_filters('litespeed_conf', self::O_UPDATE_INTERVAL);\n\t\t\tif (is_null($config)) {\n\t\t\t\t$config = self::O_PQS_CS;\n\t\t\t}\n\n\t\t\tif ($config === self::O_PQS_CQS) {\n\t\t\t\t$action();\n\t\t\t\tif ($debug) {\n\t\t\t\t\tdo_action('litespeed_debug', $debug);\n\t\t\t\t}\n\t\t\t} elseif ($config !== self::O_PQS_CS && $product->is_in_stock()) {\n\t\t\t\tdo_action('litespeed_debug', '[3rd] Woo No purge needed [option] ' . $config);\n\t\t\t\treturn false;\n\t\t\t} elseif ($config !== self::O_PS_CN && !$product->is_in_stock()) {\n\t\t\t\t$action();\n\t\t\t\tif ($debug) {\n\t\t\t\t\tdo_action('litespeed_debug', $debug);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\tif (\n\t\t\t!$do_purge(function () use ( $product ) {\n\t\t\t\t$this->backend_purge($product->get_id());\n\t\t\t})\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tdo_action('litespeed_purge_post', $product->get_id());\n\n\t\t\/\/ Check if is variation, purge stock too #984479\n\t\tif ($product->is_type('variation')) {\n\t\t\tdo_action('litespeed_purge_post', $product->get_parent_id());\n\t\t}\n\n\t\t\/\/ Check if WPML is enabled ##972971\n\t\tif (defined('WPML_PLUGIN_BASENAME')) {\n\t\t\t\/\/ Check if it is a variable product and get post\/parent ID\n\t\t\t$wpml_purge_id = $product->is_type('variation') ? $product->get_parent_id() : $product->get_id();\n\t\t\t$type          = apply_filters('wpml_element_type', get_post_type($wpml_purge_id));\n\t\t\t$trid          = apply_filters('wpml_element_trid', false, $wpml_purge_id, $type);\n\t\t\t$translations  = apply_filters('wpml_get_element_translations', array(), $trid, $type);\n\t\t\tforeach ($translations as $lang => $translation) {\n\t\t\t\tdo_action('litespeed_debug', '[3rd] Woo WPML purge language: ' . $translation->language_code . ' , post ID: ' . $translation->element_id);\n\t\t\t\tdo_action('litespeed_purge_post', $translation->element_id);\n\t\t\t\t\/\/ use the $translation->element_id as it is post ID of other languages\n\t\t\t}\n\n\t\t\t\/\/ Check other languages category and purge if configured.\n\t\t\t\/\/ wp_get_post_terms() only returns default language category ID\n\t\t\t$default_cats = wp_get_post_terms($wpml_purge_id, 'product_cat');\n\t\t\t$languages    = apply_filters('wpml_active_languages', null);\n\n\t\t\tforeach ($default_cats as $default_cat) {\n\t\t\t\tforeach ($languages as $language) {\n\t\t\t\t\t$tr_cat_id = icl_object_id($default_cat->term_id, 'product_cat', false, $language['code']);\n\t\t\t\t\t$do_purge(function () use ( $tr_cat_id ) {\n\t\t\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $tr_cat_id);\n\t\t\t\t\t}, '[3rd] Woo Purge WPML category [language] ' . $language['code'] . ' [cat] ' . $tr_cat_id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * Delete object-term relationship. If the post is a product and\n\t * the term ids array is not empty, will add purge tags to the deleted\n\t * terms.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param int   $post_id Object ID.\n\t * @param array $term_ids An array of term taxonomy IDs.\n\t *\/\n\tpublic function delete_rel( $post_id, $term_ids ) {\n\t\tif (!function_exists('wc_get_product')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (empty($term_ids) || wc_get_product($post_id) === false) {\n\t\t\treturn;\n\t\t}\n\t\tforeach ($term_ids as $term_id) {\n\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $term_id);\n\t\t}\n\t}\n\n\t\/**\n\t * Purge a product's categories and tags pages in case they are affected.\n\t *\n\t * @since 1.0.9\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param int $post_id Post id that is about to be purged\n\t *\/\n\tpublic function backend_purge( $post_id ) {\n\t\tif (!function_exists('wc_get_product')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isset($post_id) || wc_get_product($post_id) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\t$cats = $this->get_cats($post_id);\n\t\tif (!empty($cats)) {\n\t\t\tforeach ($cats as $cat) {\n\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $cat);\n\t\t\t}\n\t\t}\n\n\t\tif (!function_exists('wc_get_product_terms')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$tags = wc_get_product_terms($post_id, 'product_tag', array( 'fields' => 'ids' ));\n\t\tif (!empty($tags)) {\n\t\t\tforeach ($tags as $tag) {\n\t\t\t\tdo_action('litespeed_purge', self::CACHETAG_TERM . $tag);\n\t\t\t}\n\t\t}\n\t}\n\n\t\/**\n\t * When a product has a new review added, purge the recent reviews widget.\n\t *\n\t * @since 1.1.0\n\t * @since 1.6.3 Removed static\n\t * @access public\n\t * @param $unused\n\t * @param integer $comment_approved Whether the comment is approved or not.\n\t * @param array   $commentdata Information about the comment.\n\t *\/\n\tpublic function add_review( $unused, $comment_approved, $commentdata ) {\n\t\tif (!function_exists('wc_get_product')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$post_id = $commentdata['comment_post_ID'];\n\t\tif ($comment_approved !== 1 || !isset($post_id) || wc_get_product($post_id) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tglobal $wp_widget_factory;\n\t\tif (!isset($wp_widget_factory->widgets['WC_Widget_Recent_Reviews'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t$recent_reviews = $wp_widget_factory->widgets['WC_Widget_Recent_Reviews'];\n\t\tif (!is_null($recent_reviews)) {\n\t\t\tdo_action('litespeed_tag_add_widget', $recent_reviews->id);\n\t\t}\n\t}\n\n\t\/**\n\t * Append new options\n\t *\n\t * @since 1.6.3 Removed static\n\t * @since  3.0 new API\n\t *\/\n\tprivate function _option_append() {\n\t\t\/\/ Append option save value filter\n\t\tdo_action('litespeed_conf_multi_switch', self::O_UPDATE_INTERVAL, 3); \/\/ This need to be before conf_append\n\n\t\tdo_action('litespeed_conf_append', self::O_UPDATE_INTERVAL, false);\n\t\tdo_action('litespeed_conf_append', self::O_CART_VARY, false);\n\t}\n\n\t\/**\n\t * Hooked to `litespeed_settings_tab` action.\n\t * Adds the integration configuration options (currently, to determine purge rules)\n\t *\n\t * @since 1.6.3 Removed static\n\t *\/\n\tpublic function settings_add_tab( $setting_page ) {\n\t\tif ($setting_page != 'cache') {\n\t\t\treturn;\n\t\t}\n\n\t\trequire 'woocommerce.tab.tpl.php';\n\t}\n\n\t\/**\n\t * Hook to show config content\n\t *\n\t * @since  3.0\n\t *\/\n\tpublic function settings_add_content( $setting_page ) {\n\t\tif ($setting_page != 'cache') {\n\t\t\treturn;\n\t\t}\n\n\t\trequire 'woocommerce.content.tpl.php';\n\t}\n\n\t\/**\n\t * Helper function to select the function(s) to use to get the product\n\t * category ids.\n\t *\n\t * @since 1.0.10\n\t * @since 1.6.3 Removed static\n\t * @access private\n\t * @param int $product_id The product id\n\t * @return array An array of category ids.\n\t *\/\n\tprivate function get_cats( $product_id ) {\n\t\tif (!function_exists('WC')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$woocom = WC();\n\t\tif (isset($woocom) && version_compare($woocom->version, '2.5.0', '>=') && function_exists('wc_get_product_cat_ids')) {\n\t\t\treturn wc_get_product_cat_ids($product_id);\n\t\t}\n\t\t$product_cats = wp_get_post_terms($product_id, 'product_cat', array( 'fields' => 'ids' ));\n\t\tforeach ($product_cats as $product_cat) {\n\t\t\t$product_cats = array_merge($product_cats, get_ancestors($product_cat, 'product_cat'));\n\t\t}\n\n\t\treturn $product_cats;\n\t}\n\n\t\/**\n\t * 3rd party prepload\n\t *\n\t * @since  2.9.8.4\n\t *\/\n\tpublic static function preload() {\n\t\t\/**\n\t\t * Auto puge for WooCommerce Advanced Bulk Edit plugin,\n\t\t * Bulk edit hook need to add to preload as it will die before detect.\n\t\t *\/\n\t\tadd_action('wp_ajax_wpmelon_adv_bulk_edit', __CLASS__ . '::bulk_edit_purge', 1);\n\t}\n\n\t\/**\n\t * Auto puge for WooCommerce Advanced Bulk Edit plugin,\n\t *\n\t * @since  2.9.8.4\n\t *\/\n\tpublic static function bulk_edit_purge() {\n\t\tif (empty($_POST['type']) || $_POST['type'] != 'saveproducts' || empty($_POST['data'])) {\n\t\t\treturn;\n\t\t}\n\n\t\t\/*\n\t\t * admin-ajax form-data structure\n\t\t * array(\n\t\t *      \"type\" => \"saveproducts\",\n\t\t *      \"data\" => array(\n\t\t *          \"column1\" => \"464$###0$###2#^#463$###0$###4#^#462$###0$###6#^#\",\n\t\t *          \"column2\" => \"464$###0$###2#^#463$###0$###4#^#462$###0$###6#^#\"\n\t\t *      )\n\t\t *  )\n\t\t *\/\n\t\t$stock_string_arr = array();\n\t\tforeach ($_POST['data'] as $stock_value) {\n\t\t\t$stock_string_arr = array_merge($stock_string_arr, explode('#^#', $stock_value));\n\t\t}\n\n\t\t$lscwp_3rd_woocommerce = new self();\n\n\t\tif (count($stock_string_arr) < 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tforeach ($stock_string_arr as $edited_stock) {\n\t\t\t$product_id = strtok($edited_stock, '$');\n\t\t\t$product    = wc_get_product($product_id);\n\n\t\t\tif (empty($product)) {\n\t\t\t\tdo_action('litespeed_debug', '3rd woo purge: ' . $product_id . ' not found.');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$lscwp_3rd_woocommerce->purge_product($product);\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wptouch.cls.php","ext":"php","size":728,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with the WPTouch Mobile plugin.\n *\n * @since       1.0.7\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WpTouch {\n\n\t\/**\n\t * Detects if WPTouch is installed.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t *\/\n\tpublic static function detect() {\n\t\tglobal $wptouch_pro;\n\t\tif (isset($wptouch_pro)) {\n\t\t\tadd_action('litespeed_control_finalize', __CLASS__ . '::set_control');\n\t\t}\n\t}\n\n\t\/**\n\t * Check if the device is mobile. If so, set mobile.\n\t *\n\t * @since 1.0.7\n\t * @access public\n\t *\/\n\tpublic static function set_control() {\n\t\tglobal $wptouch_pro;\n\t\tif ($wptouch_pro->is_mobile_device) {\n\t\t\tadd_filter('litespeed_is_mobile', '__return_true');\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/thirdparty\/wcml.cls.php","ext":"php","size":960,"mtime":1757312769,"type":"text","content":"<?php\n\/\/ phpcs:ignoreFile\n\/**\n * The Third Party integration with WCML.\n *\n * @since       3.0\n *\/\nnamespace LiteSpeed\\Thirdparty;\n\ndefined('WPINC') || exit();\n\nclass WCML {\n\n\tprivate static $_currency = '';\n\n\tpublic static function detect() {\n\t\tif (!defined('WCML_VERSION')) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('wcml_client_currency', __CLASS__ . '::apply_client_currency');\n\t\tadd_action('wcml_set_client_currency', __CLASS__ . '::set_client_currency');\n\t}\n\n\tpublic static function set_client_currency( $currency ) {\n\t\tself::apply_client_currency($currency);\n\n\t\tdo_action('litespeed_vary_ajax_force');\n\t}\n\n\tpublic static function apply_client_currency( $currency ) {\n\t\tif ($currency !== wcml_get_woocommerce_currency_option()) {\n\t\t\tself::$_currency = $currency;\n\t\t\tadd_filter('litespeed_vary', __CLASS__ . '::apply_vary');\n\t\t}\n\n\t\treturn $currency;\n\t}\n\n\tpublic static function apply_vary( $list ) {\n\t\t$list['wcml_currency'] = self::$_currency;\n\t\treturn $list;\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/data\/cache_nocacheable.txt","ext":"txt","size":407,"mtime":1757312769,"type":"text","content":"# Predefined list for Do Not Cache URIs #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/cache_nocacheable.txt We will merge into next plugin release\n\n\n# WP v6.6 Official Site Editor (Appearance >> Editor)\n^\/wp-json\/wp\/v2"},{"base":"plugins","rel":"litespeed-cache\/data\/css_excludes.txt","ext":"txt","size":702,"mtime":1757312769,"type":"text","content":"# Predefined list for excluding CSS files or inline CSS codes #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/css_excludes.txt We will merge into next plugin release\n\n# CSS file URL excludes\n\n\n\n# Inline CSS excludes\n\n########## Flatsome theme random string excludes ############\n#row-\n#col-\n#cats-\n#stack-\n#timer-\n#gap-\n#portfolio-\n#image_\n#banner-\n#map-\n#text-\n#page-header-\n#section_\n\n.tdi_ # Theme: Newspaper by tagDiv.com 2020\n\n######### WoodMart - Responsive WooCommerce WordPress Theme ########\n.tabs-wd-\n#wd-"},{"base":"plugins","rel":"litespeed-cache\/data\/esi.nonces.txt","ext":"txt","size":1659,"mtime":1757312769,"type":"text","content":"## To predefine more list, please submit a PR to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/esi.nonces.txt\n## \t Comment Format:\n## \t\t1. `# this is comment`\n## \t\t2. `##this is comment`\n\n\n## Predefined elsewhere so not needed here:\n\n## WordPress core\n# stats_nonce\n# subscribe_nonce\n\n# Divi Theme Builder\n# et-pb-contact-form-submit\n# et_frontend_nonce\n# et_ab_log_nonce\n\n# WooCommerce PayPal Checkout\n# _wc_ppec_update_shipping_costs_nonce private\n# _wc_ppec_start_checkout_nonce private\n# _wc_ppec_generate_cart_nonce private\n\n# User Switching\n# switch_to_olduser_'<ID>'\n\n# Caldera Forms\n# caldera_forms_front_*\n\n\n## Predefined list of ESI nonces:\n\n# WordPress REST nonce\nwp_rest\n\n# CM Registration Pro\ncmreg_registration_nonce private\nrole_nonce private\n\n# WooCommerce Delivery Area Pro #16843635\nwdap-call-nonce private\n\n# SEOpress Cookie Consent\nseopress_cookies_user_consent_nonce\n\n# SearchWP Metrics\nswpmtxnonce\n\n# The Events Calendar\n_tec_view_rest_nonce_primary\n_tec_view_rest_nonce_secondary\n\n# wpDataTables #986128\nwdt*\n\n# WPBakery gallery\n_vcnonce\ndata-vc-public-nonce\n\n# Extra Theme\nrating_nonce\ntimeline_nonce\nblog_feed_nonce\n\n# WS Form\nwsf_post\n\n# Easy Digital Download (EDD)\nedd-* private\nedd_* private\n\n# WP Menu Cart\nwpmenucart private\n\n# Advanced Custom Fields + Advanced Forms\nacf_nonce\naf_form_nonce\naf_submission_*\n\n# Woo nonce\nwoocommerce-login\n\n# Premium Addons for Elementor\npa-blog-widget-nonce\n\n# WPUF User Frontend\nwpuf* private\n\n# MetForm\nform_nonce\n\n# Mobile hamburger menu - jetMenu #306983 #163710 PR#419\ntgmpa-*\nbulk-*\n\n# WP Data Access\nwpda-*\n\n# Elementor\nelementor-pro-frontend\nelementor-conversion-center-click"},{"base":"plugins","rel":"litespeed-cache\/data\/js_defer_excludes.txt","ext":"txt","size":508,"mtime":1757312769,"type":"text","content":"# Predefined list for excluding deferred JS files or inline JS codes #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/js_defer_excludes.txt We will merge into next plugin release\n\n# JS file URL excludes\nadsbygoogle\n\n## JetPack Stats\nstats.wp.com\/e-\n_stq\n\n# Cloudflare turnstile - Tobolo\nturnstile\nchallenges.cloudflare.com"},{"base":"plugins","rel":"litespeed-cache\/data\/esi.nonce.txt","ext":"txt","size":754,"mtime":1757312769,"type":"text","content":"# !!!!! Legacy file for v3.5.1- !!!!!\n\n## Predefined elsewhere so not needed here:\n\n## WordPress core\n#stats_nonce\n#subscribe_nonce\n\n# Divi Theme Builder\n#et-pb-contact-form-submit\n#et_frontend_nonce\n#et_ab_log_nonce\n\n# WooCommerce PayPal Checkout\n#_wc_ppec_update_shipping_costs_nonce private\n#_wc_ppec_start_checkout_nonce private\n#_wc_ppec_generate_cart_nonce private\n\n# User Switching\n#switch_to_olduser_'<ID>'\n\n# Caldera Forms\n#caldera_forms_front_*\n\n## Predefined list of ESI nonces:\n\n# CM Registration Pro\ncmreg_registration_nonce private\nrole_nonce private\n\n# WooCommerce Delivery Area Pro #16843635\nwdap-call-nonce private\n\n# SEOpress Cookie Consent\nseopress_cookies_user_consent_nonce\n\n#SearchWP Metrics\nswpmtxnonce\n\n#wpDataTables #986128\nwdt*\n"},{"base":"plugins","rel":"litespeed-cache\/data\/const.default.json","ext":"json","size":6900,"mtime":1757312769,"type":"text","content":"{\n\t\"auto_upgrade\": \"\",\n\t\"server_ip\": \"\",\n\t\"guest\": \"\",\n\t\"guest_optm\": \"\",\n\t\"news\": \"1\",\n\t\"guest_uas\": \"Lighthouse\\nGTmetrix\\nGoogle\\nPingdom\\nbot\\nspider\\nPTST\\nHeadlessChrome\",\n\t\"guest_ips\": \"208.70.247.157\\n172.255.48.130\\n172.255.48.131\\n172.255.48.132\\n172.255.48.133\\n172.255.48.134\\n172.255.48.135\\n172.255.48.136\\n172.255.48.137\\n172.255.48.138\\n172.255.48.139\\n172.255.48.140\\n172.255.48.141\\n172.255.48.142\\n172.255.48.143\\n172.255.48.144\\n172.255.48.145\\n172.255.48.146\\n172.255.48.147\\n52.229.122.240\\n104.214.72.101\\n13.66.7.11\\n13.85.24.83\\n13.85.24.90\\n13.85.82.26\\n40.74.242.253\\n40.74.243.13\\n40.74.243.176\\n104.214.48.247\\n157.55.189.189\\n104.214.110.135\\n70.37.83.240\\n65.52.36.250\\n13.78.216.56\\n52.162.212.163\\n23.96.34.105\\n65.52.113.236\\n172.255.61.34\\n172.255.61.35\\n172.255.61.36\\n172.255.61.37\\n172.255.61.38\\n172.255.61.39\\n172.255.61.40\\n104.41.2.19\\n191.235.98.164\\n191.235.99.221\\n191.232.194.51\\n52.237.235.185\\n52.237.250.73\\n52.237.236.145\\n104.211.143.8\\n104.211.165.53\\n52.172.14.87\\n40.83.89.214\\n52.175.57.81\\n20.188.63.151\\n20.52.36.49\\n52.246.165.153\\n51.144.102.233\\n13.76.97.224\\n102.133.169.66\\n52.231.199.170\\n13.53.162.7\\n40.123.218.94\",\n\t\"cache-priv\": \"1\",\n\t\"cache-commenter\": \"1\",\n\t\"cache-rest\": \"1\",\n\t\"cache-page_login\": \"1\",\n\t\"cache-resources\": \"1\",\n\t\"cache-browser\": \"\",\n\t\"cache-mobile\": \"\",\n\t\"cache-mobile_rules\": \"Mobile\\nAndroid\\nSilk\/\\nKindle\\nBlackBerry\\nOpera Mini\\nOpera Mobi\",\n\t\"cache-exc_useragents\": \"\",\n\t\"cache-exc_cookies\": \"\",\n\t\"cache-exc_qs\": \"\",\n\t\"cache-exc_cat\": \"\",\n\t\"cache-exc_tag\": \"\",\n\t\"cache-force_uri\": \"\",\n\t\"cache-force_pub_uri\": \"\",\n\t\"cache-priv_uri\": \"\",\n\t\"cache-exc\": \"\",\n\t\"cache-exc_roles\": \"\",\n\t\"cache-drop_qs\": \"fbclid\\ngclid\\nutm*\\n_ga\",\n\t\"cache-ttl_pub\": \"604800\",\n\t\"cache-ttl_priv\": \"1800\",\n\t\"cache-ttl_frontpage\": \"604800\",\n\t\"cache-ttl_feed\": \"604800\",\n\t\"cache-ttl_rest\": \"604800\",\n\t\"cache-ttl_browser\": \"31557600\",\n\t\"cache-login_cookie\": \"\",\n\t\"cache-vary_group\": \"\",\n\t\"cache-ttl_status\": \"404 3600\\n500 600\",\n\t\"purge-upgrade\": \"0\",\n\t\"purge-stale\": \"\",\n\t\"purge-post_all\": \"\",\n\t\"purge-post_f\": \"1\",\n\t\"purge-post_h\": \"1\",\n\t\"purge-post_p\": \"1\",\n\t\"purge-post_pwrp\": \"1\",\n\t\"purge-post_a\": \"1\",\n\t\"purge-post_y\": \"\",\n\t\"purge-post_m\": \"1\",\n\t\"purge-post_d\": \"\",\n\t\"purge-post_t\": \"1\",\n\t\"purge-post_pt\": \"1\",\n\t\"purge-timed_urls\": \"\",\n\t\"purge-timed_urls_time\": \"\",\n\t\"purge-hook_all\": \"switch_theme\\nwp_create_nav_menu\\nwp_update_nav_menu\\nwp_delete_nav_menu\\ncreate_term\\nedit_terms\\ndelete_term\\nadd_link\\nedit_link\\ndelete_link\",\n\t\"esi\": \"\",\n\t\"esi-cache_admbar\": \"1\",\n\t\"esi-cache_commform\": \"1\",\n\t\"esi-nonce\": \"stats_nonce\\nsubscribe_nonce\",\n\t\"util-heartbeat\": \"1\",\n\t\"util-instant_click\": \"\",\n\t\"util-no_https_vary\": \"\",\n\t\"debug-disable_all\": \"\",\n\t\"debug\": \"\",\n\t\"debug-ips\": \"127.0.0.1\",\n\t\"debug-level\": \"\",\n\t\"debug-filesize\": \"3\",\n\t\"debug-collapse_qs\": \"\",\n\t\"debug-inc\": \"\",\n\t\"debug-exc\": \"\",\n\t\"debug-exc_strings\": \"\",\n\t\"db_optm-revisions_max\": \"0\",\n\t\"db_optm-revisions_age\": \"0\",\n\t\"optm-css_min\": \"\",\n\t\"optm-css_comb\": \"\",\n\t\"optm-css_comb_ext_inl\": \"1\",\n\t\"optm-ucss\": \"\",\n\t\"optm-ucss_inline\": \"\",\n\t\"optm-ucss_file_exc_inline\": \"\",\n\t\"optm-ucss_whitelist\": \"\",\n\t\"optm-ucss_exc\": \"\",\n\t\"optm-css_exc\": \"\",\n\t\"optm-js_min\": \"\",\n\t\"optm-js_comb\": \"\",\n\t\"optm-js_comb_ext_inl\": \"1\",\n\t\"optm-js_exc\": \"jquery.js\\njquery.min.js\",\n\t\"optm-html_min\": \"\",\n\t\"optm-html_lazy\": \"\",\n\t\"optm-qs_rm\": \"\",\n\t\"optm-ggfonts_rm\": \"\",\n\t\"optm-css_async\": \"\",\n\t\"optm-ccss_per_url\": \"\",\n\t\"optm-ccss_whitelist\": \"\",\n\t\"optm-css_async_inline\": \"1\",\n\t\"optm-css_font_display\": \"\",\n\t\"optm-js_defer\": \"\",\n\t\"optm-emoji_rm\": \"\",\n\t\"optm-noscript_rm\": \"\",\n\t\"optm-ggfonts_async\": \"\",\n\t\"optm-exc_roles\": \"\",\n\t\"optm-ccss_con\": \"\",\n\t\"optm-ccss_sep_posttype\": \"page\",\n\t\"optm-ccss_sep_uri\": \"\",\n\t\"optm-js_defer_exc\": \"jquery.js\\njquery.min.js\\ngtm.js\\nanalytics.js\",\n\t\"optm-gm_js_exc\": \"\",\n\t\"optm-dns_prefetch\": \"\",\n\t\"optm-dns_prefetch_ctrl\": \"\",\n\t\"optm-dns_preconnect\": \"\",\n\t\"optm-exc\": \"\",\n\t\"optm-guest_only\": \"1\",\n\t\"object\": \"\",\n\t\"object-kind\": \"\",\n\t\"object-host\": \"localhost\",\n\t\"object-port\": \"11211\",\n\t\"object-life\": \"360\",\n\t\"object-persistent\": \"1\",\n\t\"object-admin\": \"1\",\n\t\"object-transients\": \"1\",\n\t\"object-db_id\": \"0\",\n\t\"object-user\": \"\",\n\t\"object-pswd\": \"\",\n\t\"object-global_groups\": \"users\\nuserlogins\\nuseremail\\nuserslugs\\nusermeta\\nuser_meta\\nsite-transient\\nsite-options\\nsite-lookup\\nsite-details\\nblog-lookup\\nblog-details\\nblog-id-cache\\nrss\\nglobal-posts\\nglobal-cache-test\",\n\t\"object-non_persistent_groups\": \"comment\\ncounts\\nplugins\\nwc_session_id\",\n\t\"discuss-avatar_cache\": \"\",\n\t\"discuss-avatar_cron\": \"\",\n\t\"discuss-avatar_cache_ttl\": \"604800\",\n\t\"optm-localize\": \"\",\n\t\"optm-localize_domains\": \"### Popular scripts ###\\nhttps:\/\/platform.twitter.com\/widgets.js\\nhttps:\/\/connect.facebook.net\/en_US\/fbevents.js\",\n\t\"media-lazy\": \"\",\n\t\"media-lazy_placeholder\": \"\",\n\t\"media-placeholder_resp\": \"\",\n\t\"media-placeholder_resp_color\": \"#cfd4db\",\n\t\"media-placeholder_resp_svg\": \"<svg xmlns=\\\"http:\/\/www.w3.org\/2000\/svg\\\" width=\\\"{width}\\\" height=\\\"{height}\\\" viewBox=\\\"0 0 {width} {height}\\\"><rect width=\\\"100%\\\" height=\\\"100%\\\" style=\\\"fill:{color};fill-opacity: 0.1;\\\"\/><\/svg>\",\n\t\"media-lqip\": \"\",\n\t\"media-lqip_qual\": \"4\",\n\t\"media-lqip_min_w\": \"150\",\n\t\"media-lqip_min_h\": \"150\",\n\t\"media-placeholder_resp_async\": \"1\",\n\t\"media-iframe_lazy\": \"\",\n\t\"media-add_missing_sizes\": \"\",\n\t\"media-lazy_exc\": \"\",\n\t\"media-lazy_cls_exc\": \"wmu-preview-img\",\n\t\"media-lazy_parent_cls_exc\": \"\",\n\t\"media-iframe_lazy_cls_exc\": \"\",\n\t\"media-iframe_lazy_parent_cls_exc\": \"\",\n\t\"media-lazy_uri_exc\": \"\",\n\t\"media-lqip_exc\": \"\",\n\t\"media-vpi\": \"\",\n\t\"media-vpi_cron\": \"\",\n\t\"img_optm-auto\": \"\",\n\t\"img_optm-ori\": \"1\",\n\t\"img_optm-rm_bkup\": \"\",\n\t\"img_optm-webp\": \"\",\n\t\"img_optm-lossless\": \"\",\n\t\"img_optm-exif\": \"1\",\n\t\"img_optm-webp_attr\": \"img.src\\ndiv.data-thumb\\nimg.data-src\\nimg.data-lazyload\\ndiv.data-large_image\\nimg.retina_logo_url\\ndiv.data-parallax-image\\ndiv.data-vc-parallax-image\\nvideo.poster\",\n\t\"img_optm-webp_replace_srcset\": \"\",\n\t\"img_optm-jpg_quality\": \"82\",\n\t\"crawler\": \"\",\n\t\"crawler-crawl_interval\": \"302400\",\n\t\"crawler-load_limit\": \"1\",\n\t\"crawler-sitemap\": \"\",\n\t\"crawler-roles\": \"\",\n\t\"crawler-cookies\": \"\",\n\t\"misc-heartbeat_front\": \"\",\n\t\"misc-heartbeat_front_ttl\": \"60\",\n\t\"misc-heartbeat_back\": \"\",\n\t\"misc-heartbeat_back_ttl\": \"60\",\n\t\"misc-heartbeat_editor\": \"\",\n\t\"misc-heartbeat_editor_ttl\": \"15\",\n\t\"cdn\": \"\",\n\t\"cdn-attr\": \".src\\n.data-src\\n.href\\n.poster\\nsource.srcset\",\n\t\"cdn-ori\": \"\",\n\t\"cdn-ori_dir\": \"\",\n\t\"cdn-exc\": \"\",\n\t\"cdn-quic\": \"\",\n\t\"cdn-quic_email\": \"\",\n\t\"cdn-quic_key\": \"\",\n\t\"cdn-cloudflare\": \"\",\n\t\"cdn-cloudflare_email\": \"\",\n\t\"cdn-cloudflare_key\": \"\",\n\t\"cdn-cloudflare_name\": \"\",\n\t\"cdn-cloudflare_zone\": \"\",\n\t\"cdn-cloudflare_clear\": \"\",\n\t\"cdn-mapping\": {\n\t\t\"url\": [\"\"],\n\t\t\"inc_js\": [\"1\"],\n\t\t\"inc_css\": [\"1\"],\n\t\t\"inc_img\": [\"1\"],\n\t\t\"filetype\": [\".aac\\n.css\\n.eot\\n.gif\\n.jpeg\\n.jpg\\n.js\\n.less\\n.mp3\\n.mp4\\n.ogg\\n.otf\\n.pdf\\n.png\\n.svg\\n.ttf\\n.webp\\n.woff\\n.woff2\"]\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/data\/js_excludes.txt","ext":"txt","size":1071,"mtime":1757312769,"type":"text","content":"# Predefined list for excluding JS files or inline JS codes #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/js_excludes.txt We will merge into next plugin release\n\n# JS file URL excludes\nmaps-api-ssl.google.com\nmaps.google.com\/maps\nmaps.googleapis.com\ngoogle.com\/recaptcha\ngoogle-analytics.com\/analytics.js\nstats.wp.com\njs.stripe.com\npaypal.com\/sdk\/js\ncse.google.com\/cse.js\n\/syntaxhighlighter\/\nspotlight-social-photo-feeds ## https:\/\/docs.spotlightwp.com\/article\/757-autoptimize-compatibility @Tobolo\nuserway.org\n\n# Inline JS excludes\ndocument.write\ngtag\ngtm\ndataLayer\nadsbygoogle\n\nblock_tdi_ ## Theme: Newspaper by tagDiv.com\n\ndata-view-breakpoint-pointer ## Plugin: The Events Calendar by Modern Tribe (https:\/\/theeventscalendar.com\/)\n\nwp-json\/wp-statistics ## WP Statistics\n\n## JetPack Stats\nstats.wp.com\/e-\n_stq\n\n# Cloudflare turnstile - Tobolo\nturnstile\nchallenges.cloudflare.com"},{"base":"plugins","rel":"litespeed-cache\/data\/ccss_whitelist.txt","ext":"txt","size":461,"mtime":1757312769,"type":"text","content":"# Predefined list for CCSS whitelist #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/ccss_whitelist.txt We will merge into next plugin release\n\n\n############# DoBar compatibility #############\n.pace-inactive\n\n############# DIVI ################\n.et_pb_number_counter.active\n"},{"base":"plugins","rel":"litespeed-cache\/data\/const.network_default.json","ext":"json","size":1174,"mtime":1757312769,"type":"text","content":"{\n\t\"cache\": false,\n\t\"use_primary_settings\": false,\n\t\"auto_upgrade\": false,\n\t\"cache-resources\": true,\n\t\"cache-browser\": false,\n\t\"cache-mobile\": false,\n\t\"cache-mobile_rules\": \"Mobile\\nAndroid\\nSilk\/\\nKindle\\nBlackBerry\\nOpera Mini\\nOpera Mobi\",\n\t\"cache-login_cookie\": \"\",\n\t\"cache-exc_cookies\": \"\",\n\t\"cache-exc_useragents\": \"\",\n\t\"cache-ttl_browser\": 31557600,\n\t\"purge-upgrade\": false,\n\t\"object\": false,\n\t\"object-kind\": false,\n\t\"object-host\": \"localhost\",\n\t\"object-port\": 11211,\n\t\"object-life\": 360,\n\t\"object-persistent\": true,\n\t\"object-admin\": true,\n\t\"object-transients\": true,\n\t\"object-db_id\": 0,\n\t\"object-user\": \"\",\n\t\"object-pswd\": \"\",\n\t\"object-global_groups\": \"users\\nuserlogins\\nusermeta\\nuser_meta\\nuseremail\\nuserslugs\\nsites\\nsite-details\\nsite-transient\\nsite-options\\nsite-lookup\\nblog-lookup\\nblog-id-cache\\nblog-details\\nnetworks\\nrss\\nglobal-posts\\nglobal-cache-test\",\n\t\"object-non_persistent_groups\": \"comment\\ncounts\\nplugins\",\n\t\"debug-disable_all\": false,\n\t\"debug\": false,\n\t\"debug-ips\": \"127.0.0.1\",\n\t\"debug-level\": false,\n\t\"debug-filesize\": 3,\n\t\"debug-collapse_qs\": false,\n\t\"debug-inc\": \"\",\n\t\"debug-exc\": \"\",\n\t\"debug-exc_strings\": \"\",\n\t\"img_optm-webp\": false\n}\n"},{"base":"plugins","rel":"litespeed-cache\/data\/ucss_whitelist.txt","ext":"txt","size":460,"mtime":1757312769,"type":"text","content":"# Predefined list for UCSS whitelist #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/ucss_whitelist.txt We will merge into next plugin release\n\n\n############# DoBar compatibility #############\n.pace-inactive\n\n############# DIVI ################\n.et_pb_number_counter.active"},{"base":"plugins","rel":"litespeed-cache\/data\/optm_uri_exc.txt","ext":"txt","size":377,"mtime":1757312769,"type":"text","content":"# Predefined list for excluding URI from page optimization #\n# Comment can use `# `(there is a space following), or `##`, can use both as a new line or end of one line\n# If you want to predefine new items, please send a Pull Request to https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/optm_uri_exc.txt We will merge into next plugin release\n\n# URI excludes\n.well-known"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/report.tpl.php","ext":"php","size":6502,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Report Interface\n *\n * Renders the report interface for LiteSpeed Cache, allowing users to generate and send environment reports to LiteSpeed Support.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$_report = Report::cls();\n$report  = $_report->generate_environment_report();\n\n$env_ref = Report::get_summary();\n\n\/\/ Detect passwordless plugin\n$dologin_link        = '';\n$has_pswdless_plugin = false;\nif ( function_exists( 'dologin_gen_link' ) ) {\n\t$has_pswdless_plugin = true;\n\tif ( ! empty( $_GET['dologin_gen_link'] ) && ! empty( $_GET['litespeed_purge_nonce'] ) && wp_verify_nonce( sanitize_text_field( wp_unslash( $_GET['litespeed_purge_nonce'] ) ), 'litespeed_purge_action' ) ) {\n\t\tunset( $_GET['dologin_gen_link'] );\n\t\t$dologin_link = dologin_gen_link( 'Litespeed Report' );\n\t\t?>\n\t\t<script>\n\t\t\twindow.history.pushState('remove_gen_link', document.title, window.location.href.replace('&dologin_gen_link=1', ''));\n\t\t<\/script>\n\t\t<?php\n\t}\n}\n\n$install_link = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_INSTALL_3RD, false, null, array( 'plugin' => 'dologin' ) );\n\n$btn_title = esc_html__( 'Send to LiteSpeed', 'litespeed-cache' );\nif ( ! empty( $env_ref['num'] ) ) {\n\t$btn_title = esc_html__( 'Regenerate and Send a New Report', 'litespeed-cache' );\n}\n?>\n\n<?php if ( ! $has_pswdless_plugin ) : ?>\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?><\/h4>\n\t\t<p>\n\t\t\t<?php printf( esc_html__( 'To generate a passwordless link for LiteSpeed Support Team access, you must install %s.', 'litespeed-cache' ), '<a href=\"https:\/\/wordpress.org\/plugins\/dologin\/\" target=\"_blank\">DoLogin Security<\/a>' ); ?>\n\t\t<\/p>\n\t\t<p>\n\t\t\t<a href=\"<?php echo esc_url( $install_link ); ?>\" class=\"button litespeed-btn litespeed-right20\"><?php esc_html_e( 'Install DoLogin Security', 'litespeed-cache' ); ?><\/a>\n\t\t\t<a href=\"<?php echo esc_url( admin_url( 'plugin-install.php?s=dologin+security&tab=search&type=term' ) ); ?>\" target=\"_blank\"><?php esc_html_e( 'Go to plugins list', 'litespeed-cache' ); ?><\/a>\n\t\t<\/p>\n\t<\/div>\n<?php endif; ?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'LiteSpeed Report', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#report-tab' ); ?>\n<\/h3>\n\n<p><?php esc_html_e( 'Last Report Number', 'litespeed-cache' ); ?>: <b><?php echo ! empty( $env_ref['num'] ) ? '<span id=\"report_span\" style=\"cursor: pointer;\" onClick=\"litespeed_copy_to_clipboard(\\'report_span\\', this)\" aria-label=\"' . esc_attr__( 'Click to copy', 'litespeed-cache' ) . '\" data-balloon-pos=\"down\" class=\"litespeed-wrap\">' . esc_html( $env_ref['num'] ) . '<\/span>' : '-'; ?><\/b><\/p>\n<p><?php esc_html_e( 'Last Report Date', 'litespeed-cache' ); ?>: <b><?php echo ! empty( $env_ref['dateline'] ) ? esc_html( gmdate( 'm\/d\/Y H:i:s', $env_ref['dateline'] ) ) : '-'; ?><\/b><\/p>\n\n<p class=\"litespeed-desc\">\n\t<?php esc_html_e( 'The environment report contains detailed information about the WordPress configuration.', 'litespeed-cache' ); ?>\n\t<br \/>\n\t<?php esc_html_e( 'If you run into any issues, please refer to the report number in your support message.', 'litespeed-cache' ); ?>\n<\/p>\n\n<?php $this->form_action( Router::ACTION_REPORT, Report::TYPE_SEND_REPORT ); ?>\n\t<table class=\"wp-list-table striped litespeed-table\">\n\t\t<tbody>\n\t\t\t<tr>\n\t\t\t\t<th><?php esc_html_e( 'System Information', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<td>\n\t\t\t\t\t<textarea id=\"litespeed-report\" rows=\"20\" cols=\"100\" readonly><?php echo esc_textarea( $report ); ?><\/textarea>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\t\t\t<tr>\n\t\t\t\t<th><\/th>\n\t\t\t\t<td>\n\t\t\t\t\t<?php\n\t\t\t\t\t$this->build_checkbox(\n\t\t\t\t\t\t'attach_php',\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\tesc_html__( 'Attach PHP info to report. Check this box to insert relevant data from %s.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<a href=\"https:\/\/www.php.net\/manual\/en\/function.phpinfo.php\" target=\"_blank\">phpinfo()<\/a>'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\t\t\t<tr>\n\t\t\t\t<th><?php esc_html_e( 'Passwordless Link', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<td>\n\t\t\t\t\t<input type=\"text\" class=\"litespeed-regular-text\" id=\"litespeed-report-link\" name=\"link\" value=\"<?php echo esc_attr( $dologin_link ); ?>\" style=\"width:500px;\" \/>\n\t\t\t\t\t<?php if ( $has_pswdless_plugin ) : ?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( wp_nonce_url( admin_url( 'admin.php?page=litespeed-toolbox&dologin_gen_link=1' ), 'litespeed_purge_action', 'litespeed_purge_nonce' ) ); ?>\" class=\"button button-secondary\"><?php esc_html_e( 'Generate Link for Current User', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<button type=\"button\" class=\"button button-secondary\" disabled><?php esc_html_e( 'Generate Link for Current User', 'litespeed-cache' ); ?><\/button>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php esc_html_e( 'To grant wp-admin access to the LiteSpeed Support Team, please generate a passwordless link for the current logged-in user to be sent with the report.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php if ( $dologin_link ) : ?>\n\t\t\t\t\t\t\t<br \/><strong>\ud83d\udea8 <?php esc_html_e( 'Please do NOT share the above passwordless link with anyone.', 'litespeed-cache' ); ?><\/strong>\n\t\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\t\t\t\t\t\tesc_html__( 'Generated links may be managed under %sSettings%s.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<a href=\"' . esc_url( menu_page_url( 'dologin', false ) ) . '#pswdless\">',\n\t\t\t\t\t\t\t\t\t'<\/a>' );\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/strong>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\t\t\t<tr>\n\t\t\t\t<th><?php esc_html_e( 'Notes', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<td>\n\t\t\t\t\t<textarea name=\"notes\" rows=\"10\" cols=\"100\"><\/textarea>\n\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t<?php esc_html_e( 'Optional', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php esc_html_e( 'provide more information here to assist the LiteSpeed team with debugging.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\t\t<\/tbody>\n\t<\/table>\n\n\t<div class=\"litespeed-top20\"><\/div>\n\t<button class=\"button button-primary\" type=\"submit\"><?php echo esc_html( $btn_title ); ?><\/button>\n\t<button class=\"button button-primary litespeed-float-submit\" type=\"submit\"><?php echo esc_html( $btn_title ); ?><\/button>\n\n\t<p class=\"litespeed-top30 litespeed-left10 litespeed-desc\">\n\t\t<?php esc_html_e( 'Send this report to LiteSpeed. Refer to this report number when posting in the WordPress support forum.', 'litespeed-cache' ); ?>\n\t<\/p>\n<\/form>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/import_export.tpl.php","ext":"php","size":2741,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Import\/Export Settings\n *\n * Renders the import\/export settings interface for LiteSpeed Cache, allowing users to export, import, or reset plugin settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$summary = Import::get_summary();\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Export Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#importexport-tab' ); ?>\n<\/h3>\n\n<div>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMPORT, Import::TYPE_EXPORT ) ); ?>\" class=\"button button-primary\">\n\t\t<?php esc_html_e( 'Export', 'litespeed-cache' ); ?>\n\t<\/a>\n<\/div>\n\n<?php if ( ! empty( $summary['export_file'] ) ) : ?>\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Last exported', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $summary['export_file'] ); ?><\/code> <?php echo esc_html( Utility::readable_time( $summary['export_time'] ) ); ?>\n\t<\/div>\n<?php endif; ?>\n\n<div class=\"litespeed-desc\">\n\t<?php esc_html_e( 'This will export all current LiteSpeed Cache settings and save them as a file.', 'litespeed-cache' ); ?>\n<\/div>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Import Settings', 'litespeed-cache' ); ?>\n<\/h3>\n\n<?php $this->form_action( Router::ACTION_IMPORT, Import::TYPE_IMPORT, true ); ?>\n\t<div class=\"litespeed-div\">\n\t\t<input type=\"file\" name=\"ls_file\" class=\"litespeed-input\" \/>\n\t<\/div>\n\t<div class=\"litespeed-div\">\n\t\t<?php submit_button( esc_html__( 'Import', 'litespeed-cache' ), 'button button-primary', 'litespeed-submit' ); ?>\n\t<\/div>\n<\/form>\n\n<?php if ( ! empty( $summary['import_file'] ) ) : ?>\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Last imported', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $summary['import_file'] ); ?><\/code> <?php echo esc_html( Utility::readable_time( $summary['import_time'] ) ); ?>\n\t<\/div>\n<?php endif; ?>\n\n<div class=\"litespeed-desc\">\n\t<?php esc_html_e( 'This will import settings from a file and override all current LiteSpeed Cache settings.', 'litespeed-cache' ); ?>\n<\/div>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Reset All Settings', 'litespeed-cache' ); ?>\n<\/h3>\n\n<div>\n\t<p class=\"litespeed-danger\">\ud83d\udea8 <?php esc_html_e( 'This will reset all settings to default settings.', 'litespeed-cache' ); ?><\/p>\n<\/div>\n<div>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMPORT, Import::TYPE_RESET ) ); ?>\" data-litespeed-cfm=\"<?php echo esc_attr( __( 'Are you sure you want to reset all settings back to the default settings?', 'litespeed-cache' ) ); ?>\" class=\"button litespeed-btn-danger-bg\">\n\t\t<?php esc_html_e( 'Reset Settings', 'litespeed-cache' ); ?>\n\t<\/a>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/settings-debug.tpl.php","ext":"php","size":6616,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Debug Settings Interface\n *\n * Renders the debug settings interface for LiteSpeed Cache, allowing users to configure debugging options and view the site with specific settings bypassed.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action( $this->_is_network_admin ? Router::ACTION_SAVE_SETTINGS_NETWORK : false );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Debug Helpers', 'litespeed-cache' ); ?>\n<\/h3>\n\n<a href=\"<?php echo esc_url( home_url( '\/' ) . '?' . Router::ACTION . '=before_optm' ); ?>\" class=\"button button-success\" target=\"_blank\">\n\t<?php esc_html_e( 'View Site Before Optimization', 'litespeed-cache' ); ?>\n<\/a>\n\n<a href=\"<?php echo esc_url( home_url( '\/' ) . '?' . Router::ACTION . '=' . Core::ACTION_QS_NOCACHE ); ?>\" class=\"button button-success\" target=\"_blank\">\n\t<?php esc_html_e( 'View Site Before Cache', 'litespeed-cache' ); ?>\n<\/a>\n\n\n<?php\n$temp_disabled_time = $this->conf( Base::DEBUG_TMP_DISABLE );\n$temp_disabled      = Debug2::is_tmp_disable();\nif ( !$temp_disabled ) {\n?>\n\t<a href=\"<?php echo wp_kses_post( Utility::build_url(Router::ACTION_TMP_DISABLE, false, false, '_ori') ); ?>\" class=\"button litespeed-btn-danger\">\n\t\t<?php esc_html_e( 'Disable All Features for 24 Hours', 'litespeed-cache' ); ?>\n\t<\/a>\n<?php\n} else {\n\t$date = wp_date( get_option('date_format') . ' ' . get_option( 'time_format' ), $temp_disabled_time );\n?>\n\t<a href=\"<?php echo wp_kses_post( Utility::build_url(Router::ACTION_TMP_DISABLE, false, false, '_ori') ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Remove `Disable All Feature` Flag Now', 'litespeed-cache' ); ?>\n\t<\/a>\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?><\/h4>\n\t\t<p><?php echo wp_kses_post( sprintf ( __( 'LiteSpeed Cache is temporarily disabled until: %s.', 'litespeed-cache' ), '<strong>' . $date . '<\/strong>' ) ); ?><\/p>\n\t<\/div>\n<?php\n}\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Debug Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#debug-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_DISABLE_ALL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'This will disable LSCache and all optimization features for debug purpose.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), esc_html__( 'ON', 'litespeed-cache' ), esc_html__( 'Admin IP Only', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Outputs to a series of files in the %s directory.', 'litespeed-cache' ), '<code>wp-content\/litespeed\/debug<\/code>' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'To prevent filling up the disk, this setting should be OFF when everything is working.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'The Admin IP option will only output log messages on requests from admin IPs listed below.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_IPS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id, 50 ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Allows listed IPs (one per line) to perform certain actions from their browsers.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Your IP', 'litespeed-cache' ); ?>: <code><?php echo esc_html( Router::get_ip() ); ?><\/code>\n\t\t\t\t\t<?php $this->_validate_ip( $option_id ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<?php\n\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/admin\/#admin-ip-commands',\n\t\t\t\t\t\tesc_html__( 'More information about the available commands can be found here.', 'litespeed-cache' )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_LEVEL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'Basic', 'litespeed-cache' ), esc_html__( 'Advanced', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Advanced level will log more details.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_FILESIZE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php esc_html_e( 'MB', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the maximum size of the log file.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 3, 3000 ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_COLLAPSE_QS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Shorten query strings in the debug log to improve readability.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_INC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Only log listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent any debug log of listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_DEBUG_EXC_STRINGS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent writing log entries that include listed strings.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n\n<?php $this->form_end(); ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/beta_test.tpl.php","ext":"php","size":3947,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Beta Test\n *\n * Renders the beta test interface for LiteSpeed Cache, allowing users to switch plugin versions or test GitHub commits.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n\/\/ List of available public versions\n$v_list = array(\n\t'7.4',\n\t'7.3.0.1',\n\t'7.3',\n\t'7.2',\n\t'7.1',\n\t'7.0.1',\n\t'6.5.4',\n\t'5.7.0.1',\n\t'4.6',\n\t'3.6.4',\n);\n?>\n\n<?php $this->form_action( Router::ACTION_DEBUG2, Debug2::TYPE_BETA_TEST ); ?>\n\n\t<h3 class=\"litespeed-title\">\n\t\t<?php esc_html_e( 'Try GitHub Version', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#beta-test-tab' ); ?>\n\t<\/h3>\n\n\t<?php if ( defined( 'LITESPEED_DISABLE_ALL' ) && LITESPEED_DISABLE_ALL ) : ?>\n\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?><\/h4>\n\t\t\t<p><?php esc_html_e( 'LiteSpeed Cache is disabled. This functionality will not work.', 'litespeed-cache' ); ?><\/p>\n\t\t<\/div>\n\t<?php endif; ?>\n\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Use this section to switch plugin versions. To beta test a GitHub commit, enter the commit URL in the field below.', 'litespeed-cache' ); ?>\n\t<\/div>\n\t<div class=\"litespeed-desc\">\n\t\t<?php esc_html_e( 'Example', 'litespeed-cache' ); ?>: <code>https:\/\/github.com\/litespeedtech\/lscache_wp\/commit\/example_comment_hash_d3ebec0535aaed5c932c0<\/code>\n\t<\/div>\n\n\t<input type=\"text\" name=\"<?php echo esc_attr( Debug2::BETA_TEST_URL ); ?>\" class=\"litespeed-input-long\" id=\"litespeed-beta-test\" value=\"\">\n\n\t<p>\n\t\t<a href=\"javascript:;\" class=\"button litespeed-btn-success\" onclick=\"document.getElementById('litespeed-beta-test').value='dev';\"><?php esc_html_e( 'Use latest GitHub Dev commit', 'litespeed-cache' ); ?><\/a> <code>dev<\/code>\n\t<\/p>\n\n\t<p>\n\t\t<a href=\"javascript:;\" class=\"button litespeed-btn-success\" onclick=\"document.getElementById('litespeed-beta-test').value='master';\"><?php esc_html_e( 'Use latest GitHub Master commit', 'litespeed-cache' ); ?><\/a> <code>master<\/code>\n\t<\/p>\n\n\t<p>\n\t\t<a href=\"javascript:;\" class=\"button litespeed-btn-success\" onclick=\"document.getElementById('litespeed-beta-test').value='latest';\"><?php esc_html_e( 'Use latest WordPress release version', 'litespeed-cache' ); ?><\/a> <code><?php echo esc_attr( Debug2::BETA_TEST_URL_WP ); ?><\/code> <?php esc_html_e( 'OR', 'litespeed-cache' ); ?> <code>latest<\/code>\n\t<\/p>\n\n\t<p>\n\t\t<?php foreach ( $v_list as $v ) : ?>\n\t\t\t<a href=\"javascript:;\" class=\"button <?php echo '3.6.4' === $v ? 'litespeed-btn-danger' : 'litespeed-btn-success'; ?>\" onclick=\"document.getElementById('litespeed-beta-test').value='<?php echo esc_attr( $v ); ?>';\"><?php echo esc_html( $v ); ?><\/a>\n\t\t<?php endforeach; ?>\n\t\t<span class=\"litespeed-danger\">\n\t\t\t\ud83d\udea8 <?php esc_html_e( 'Downgrade not recommended. May cause fatal error due to refactored code.', 'litespeed-cache' ); ?>\n\t\t<\/span>\n\t<\/p>\n\n\t<div class=\"litespeed-desc\">\n\t\t<?php printf( esc_html__( 'Press the %s button to use the most recent GitHub commit. Master is for release candidate & Dev is for experimental testing.', 'litespeed-cache' ), '<code>' . esc_html__( 'Use latest GitHub Dev\/Master commit', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t<\/div>\n\t<div class=\"litespeed-desc\">\n\t\t<?php printf( esc_html__( 'Press the %s button to stop beta testing and go back to the current release from the WordPress Plugin Directory.', 'litespeed-cache' ), '<code>' . esc_html__( 'Use latest WordPress release version', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t<\/div>\n\n\t<p class=\"litespeed-danger\">\n\t\t\ud83d\udea8 <?php printf( esc_html__( 'In order to avoid an upgrade error, you must be using %1$s or later before you can upgrade to %2$s versions.', 'litespeed-cache' ), '<code>v3.6.4<\/code>', '<code>dev\/master\/v4+<\/code>' ); ?>\n\t<\/p>\n\n\t<button type=\"submit\" class=\"button button-primary\"><?php esc_html_e( 'Upgrade', 'litespeed-cache' ); ?><\/button>\n<\/form>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/heartbeat.tpl.php","ext":"php","size":4442,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Heartbeat Control\n *\n * Renders the heartbeat control settings interface for LiteSpeed Cache, allowing configuration of WordPress heartbeat intervals.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Heartbeat Control', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#heartbeat-tab' ); ?>\n<\/h3>\n\n<div class=\"litespeed-callout notice notice-warning inline\">\n\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?><\/h4>\n\t<p>\n\t\t<?php esc_html_e( 'Disable WordPress interval heartbeat to reduce server load.', 'litespeed-cache' ); ?>\n\t\t<span class=\"litespeed-warning\">\n\t\t\t\ud83d\udea8 <?php esc_html_e( 'Disabling this may cause WordPress tasks triggered by AJAX to stop working.', 'litespeed-cache' ); ?>\n\t\t<\/span>\n\t<\/p>\n<\/div>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_FRONT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Turn ON to control heartbeat on frontend.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_FRONT_TTL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Specify the %s heartbeat interval in seconds.', 'litespeed-cache' ), 'frontend' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'WordPress valid interval is %s seconds.', 'litespeed-cache' ), '<code>15<\/code> - <code>120<\/code>' ); ?><br \/>\n\t\t\t\t\t<?php printf( esc_html__( 'Set to %1$s to forbid heartbeat on %2$s.', 'litespeed-cache' ), '<code>0<\/code>', 'frontend' ); ?><br \/>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 15, 120, true ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_BACK; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Turn ON to control heartbeat on backend.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_BACK_TTL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Specify the %s heartbeat interval in seconds.', 'litespeed-cache' ), 'backend' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'WordPress valid interval is %s seconds.', 'litespeed-cache' ), '<code>15<\/code> - <code>120<\/code>' ); ?><br \/>\n\t\t\t\t\t<?php printf( esc_html__( 'Set to %1$s to forbid heartbeat on %2$s.', 'litespeed-cache' ), '<code>0<\/code>', 'backend' ); ?><br \/>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 15, 120, true ); ?>\n<\/div>\n<\/td>\n<\/tr>\n\n<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_EDITOR; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Turn ON to control heartbeat in backend editor.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MISC_HEARTBEAT_EDITOR_TTL; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t<?php printf( esc_html__( 'Specify the %s heartbeat interval in seconds.', 'litespeed-cache' ), 'backend editor' ); ?>\n\t\t<?php printf( esc_html__( 'WordPress valid interval is %s seconds.', 'litespeed-cache' ), '<code>15<\/code> - <code>120<\/code>' ); ?><br \/>\n\t\t<?php printf( esc_html__( 'Set to %1$s to forbid heartbeat on %2$s.', 'litespeed-cache' ), '<code>0<\/code>', 'backend editor' ); ?><br \/>\n\t\t<?php $this->recommended( $option_id ); ?>\n\t\t<?php $this->_validate_ttl( $option_id, 15, 120, true ); ?>\n\t<\/div>\n<\/td>\n<\/tr>\n\n<\/tbody>\n<\/table>\n\n<?php $this->form_end(); ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/log_viewer.tpl.php","ext":"php","size":2827,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Log Viewer\n *\n * Renders the log viewer interface for LiteSpeed Cache, displaying debug, purge, and crawler logs with options to copy or clear logs.\n *\n * @package LiteSpeed\n * @since 4.7\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$logs = array(\n\tarray(\n\t\t'name'      => 'debug',\n\t\t'label'     => esc_html__( 'Debug Log', 'litespeed-cache' ),\n\t\t'accesskey' => 'A',\n\t),\n\tarray(\n\t\t'name'      => 'purge',\n\t\t'label'     => esc_html__( 'Purge Log', 'litespeed-cache' ),\n\t\t'accesskey' => 'B',\n\t),\n\tarray(\n\t\t'name'      => 'crawler',\n\t\t'label'     => esc_html__( 'Crawler Log', 'litespeed-cache' ),\n\t\t'accesskey' => 'C',\n\t),\n);\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'LiteSpeed Logs', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#log-view-tab' ); ?>\n<\/h3>\n\n<div class=\"litespeed-log-subnav-wrapper\">\n\t<?php foreach ( $logs as $log ) : ?>\n\t\t<a href=\"#<?php echo esc_attr( $log['name'] ); ?>_log\" class=\"button button-secondary\" data-litespeed-subtab=\"<?php echo esc_attr( $log['name'] ); ?>_log\" litespeed-accesskey=\"<?php echo esc_attr( $log['accesskey'] ); ?>\">\n\t\t\t<?php echo esc_html( $log['label'] ); ?>\n\t\t<\/a>\n\t<?php endforeach; ?>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_DEBUG2, Debug2::TYPE_CLEAR_LOG ) ); ?>\" class=\"button button-primary\" litespeed-accesskey=\"D\">\n\t\t<?php esc_html_e( 'Clear Logs', 'litespeed-cache' ); ?>\n\t<\/a>\n<\/div>\n\n<?php\nforeach ( $logs as $log ) :\n\t$file      = $this->cls( 'Debug2' )->path( $log['name'] );\n\t$lines     = File::count_lines( $file );\n\t$max_lines = apply_filters( 'litespeed_debug_show_max_lines', 1000 );\n\t$start     = $lines > $max_lines ? $lines - $max_lines : 0;\n\t$lines     = File::read( $file, $start );\n\t$lines     = $lines ? trim( implode( \"\\n\", $lines ) ) : '';\n\n\t$log_body_id = 'litespeed-log-' . esc_attr( $log['name'] );\n?>\n\t<div class=\"litespeed-log-view-wrapper\" data-litespeed-sublayout=\"<?php echo esc_attr( $log['name'] ); ?>_log\">\n\t\t<h3 class=\"litespeed-title\">\n\t\t\t<?php echo esc_html( $log['label'] ); ?>\n\t\t\t<a href=\"#<?php echo esc_attr( $log['name'] ); ?>_log\" class=\"button litespeed-info-button litespeed-wrap\" onClick=\"litespeed_copy_to_clipboard('<?php echo esc_js( $log_body_id ); ?>', this)\" aria-label=\"<?php esc_attr_e( 'Click to copy', 'litespeed-cache' ); ?>\" data-balloon-pos=\"down\">\n\t\t\t\t<?php esc_html_e( 'Copy Log', 'litespeed-cache' ); ?>\n\t\t\t<\/a>\n\t\t<\/h3>\n\t\t<div class=\"litespeed-log-body\" id=\"<?php echo esc_attr( $log_body_id ); ?>\">\n\t\t\t<?php echo nl2br( esc_html( $lines ) ); ?>\n\t\t<\/div>\n\t<\/div>\n<?php endforeach; ?>\n\n<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_DEBUG2, Debug2::TYPE_CLEAR_LOG ) ); ?>\" class=\"button button-primary\">\n\t<?php esc_html_e( 'Clear Logs', 'litespeed-cache' ); ?>\n<\/a>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/entry.tpl.php","ext":"php","size":1727,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Toolbox\n *\n * Renders the toolbox interface for LiteSpeed Cache, providing access to various administrative tools and settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'purge' => esc_html__( 'Purge', 'litespeed-cache' ),\n);\n\nif ( ! $this->_is_network_admin ) {\n\t$menu_list['import_export'] = esc_html__( 'Import \/ Export', 'litespeed-cache' );\n}\n\nif ( ! $this->_is_multisite || $this->_is_network_admin ) {\n\t$menu_list['edit_htaccess'] = esc_html__( 'View .htaccess', 'litespeed-cache' );\n}\n\nif ( ! $this->_is_network_admin ) {\n\t$menu_list['heartbeat'] = esc_html__( 'Heartbeat', 'litespeed-cache' );\n\t$menu_list['report']    = esc_html__( 'Report', 'litespeed-cache' );\n}\n\nif ( ! $this->_is_multisite || $this->_is_network_admin ) {\n\t$menu_list['settings-debug'] = esc_html__( 'Debug Settings', 'litespeed-cache' );\n\t$menu_list['log_viewer']     = esc_html__( 'Log View', 'litespeed-cache' );\n\t$menu_list['beta_test']      = esc_html__( 'Beta Test', 'litespeed-cache' );\n}\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Toolbox', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\tv<?php echo esc_html( Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t<\/h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php foreach ( $menu_list as $curr_tab => $val ) : ?>\n\t\t\t<div data-litespeed-layout=\"<?php echo esc_attr( $curr_tab ); ?>\">\n\t\t\t\t<?php require LSCWP_DIR . \"tpl\/toolbox\/$curr_tab.tpl.php\"; ?>\n\t\t\t<\/div>\n\t\t<?php endforeach; ?>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/purge.tpl.php","ext":"php","size":11670,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Purge Interface\n *\n * Renders the purge interface for LiteSpeed Cache, allowing users to clear various cache types and purge specific content.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$_panels = array(\n\tarray(\n\t\t'title'      => esc_html__( 'Purge Front Page', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will Purge Front Page only', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-front',\n\t\t'append_url' => Purge::TYPE_PURGE_FRONTPAGE,\n\t),\n\tarray(\n\t\t'title'      => esc_html__( 'Purge Pages', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will Purge Pages only', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-pages',\n\t\t'append_url' => Purge::TYPE_PURGE_PAGES,\n\t),\n);\n\nforeach ( Tag::$error_code_tags as $code ) {\n\t$_panels[] = array(\n\t\t'title'      => sprintf( esc_html__( 'Purge %s Error', 'litespeed-cache' ), esc_html( $code ) ),\n\t\t'desc'       => sprintf( esc_html__( 'Purge %s error pages', 'litespeed-cache' ), esc_html( $code ) ),\n\t\t'icon'       => 'purge-' . esc_attr( $code ),\n\t\t'append_url' => Purge::TYPE_PURGE_ERROR . esc_attr( $code ),\n\t);\n}\n\n$_panels[] = array(\n\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - LSCache',\n\t'desc'       => esc_html__( 'Purge the LiteSpeed cache entries created by this plugin', 'litespeed-cache' ),\n\t'icon'       => 'purge-all',\n\t'append_url' => Purge::TYPE_PURGE_ALL_LSCACHE,\n);\n\n$_panels[] = array(\n\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'CSS\/JS Cache', 'litespeed-cache' ),\n\t'desc'       => esc_html__( 'This will purge all minified\/combined CSS\/JS entries only', 'litespeed-cache' ),\n\t'icon'       => 'purge-cssjs',\n\t'append_url' => Purge::TYPE_PURGE_ALL_CSSJS,\n);\n\nif ( defined( 'LSCWP_OBJECT_CACHE' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Object Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'Purge all the object caches', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-object',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_OBJECT,\n\t);\n}\n\nif ( Router::opcache_enabled() ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Opcode Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'Reset the entire opcode cache', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-opcache',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_OPCACHE,\n\t);\n}\n\nif ( $this->has_cache_folder( 'ccss' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Critical CSS', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all generated critical CSS files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_CCSS,\n\t);\n}\n\nif ( $this->has_cache_folder( 'ucss' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Unique CSS', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all generated unique CSS files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_UCSS,\n\t);\n}\n\nif ( $this->has_cache_folder( 'localres' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Localized Resources', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all localized resources', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_LOCALRES,\n\t);\n}\n\nif ( $this->has_cache_folder( 'lqip' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'LQIP Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all generated image LQIP placeholder files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-front',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_LQIP,\n\t);\n}\n\nif ( $this->has_cache_folder( 'avatar' ) ) {\n\t$_panels[] = array(\n\t\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'Gravatar Cache', 'litespeed-cache' ),\n\t\t'desc'       => esc_html__( 'This will delete all cached Gravatar files', 'litespeed-cache' ),\n\t\t'icon'       => 'purge-cssjs',\n\t\t'append_url' => Purge::TYPE_PURGE_ALL_AVATAR,\n\t);\n}\n\n$_panels[] = array(\n\t'title'      => esc_html__( 'Purge All', 'litespeed-cache' ),\n\t'desc'       => esc_html__( 'Purge the cache entries created by this plugin except for Critical CSS & Unique CSS & LQIP caches', 'litespeed-cache' ),\n\t'icon'       => 'purge-all',\n\t'title_cls'  => 'litespeed-warning',\n\t'newline'    => true,\n\t'append_url' => Purge::TYPE_PURGE_ALL,\n);\n\nif ( ! is_multisite() || is_network_admin() ) {\n\t$_panels[] = array(\n\t\t'title'     => esc_html__( 'Empty Entire Cache', 'litespeed-cache' ),\n\t\t'desc'      => esc_html__( 'Clears all cache entries related to this site, including other web applications.', 'litespeed-cache' ) . ' <b>' . esc_html__( 'This action should only be used if things are cached incorrectly.', 'litespeed-cache' ) . '<\/b>',\n\t\t'tag'       => Core::ACTION_PURGE_EMPTYCACHE,\n\t\t'icon'      => 'empty-cache',\n\t\t'title_cls' => 'litespeed-danger',\n\t\t'cfm'       => esc_html__( 'This will clear EVERYTHING inside the cache.', 'litespeed-cache' ) . ' ' . esc_html__( 'This may cause heavy load on the server.', 'litespeed-cache' ) . ' ' . esc_html__( 'If only the WordPress site should be purged, use Purge All.', 'litespeed-cache' ),\n\t);\n}\n\n?>\n\n<?php require_once LSCWP_DIR . 'tpl\/inc\/check_cache_disabled.php'; ?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Purge', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#purge-tab' ); ?>\n<\/h3>\n\n<div class=\"litespeed-panel-wrapper litespeed-cards-wrapper\">\n\t<?php foreach ( $_panels as $panel ) : ?>\n\t\t<?php\n\t\t$action_tag = ! empty( $panel['tag'] ) ? $panel['tag'] : Router::ACTION_PURGE;\n\t\t$append_url = ! empty( $panel['append_url'] ) ? $panel['append_url'] : false;\n\t\t$cfm        = ! empty( $panel['cfm'] ) ? Str::trim_quotes( $panel['cfm'] ) : false;\n\t\t?>\n\t\t<?php if ( ! empty( $panel['newline'] ) ) : ?>\n\t\t\t<div class=\"litespeed-col-br\"><\/div>\n\t\t<?php endif; ?>\n\t\t<a class=\"litespeed-panel postbox\" href=\"<?php echo esc_url( Utility::build_url( $action_tag, $append_url ) ); ?>\" data-litespeed-cfm=\"<?php echo esc_attr( $cfm ); ?>\">\n\t\t\t<section class=\"litespeed-panel-wrapper-icon\">\n\t\t\t\t<span class=\"litespeed-panel-icon-<?php echo esc_attr( $panel['icon'] ); ?>\"><\/span>\n\t\t\t<\/section>\n\t\t\t<section class=\"litespeed-panel-content\">\n\t\t\t\t<div class=\"litespeed-h3 <?php echo ! empty( $panel['title_cls'] ) ? esc_attr( $panel['title_cls'] ) : ''; ?>\">\n\t\t\t\t\t<?php echo esc_html( $panel['title'] ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<span class=\"litespeed-panel-para\"><?php echo wp_kses_post( $panel['desc'] ); ?><\/span>\n\t\t\t<\/section>\n\t\t<\/a>\n\t<?php endforeach; ?>\n<\/div>\n\n<?php\nif ( is_multisite() && is_network_admin() ) {\n\treturn;\n}\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Purge By...', 'litespeed-cache' ); ?>\n<\/h3>\n<p class=\"litespeed-description\">\n\t<?php esc_html_e( 'Select below for \"Purge by\" options.', 'litespeed-cache' ); ?>\n\t<?php Doc::one_per_line(); ?>\n<\/p>\n\n<?php $this->form_action( Core::ACTION_PURGE_BY ); ?>\n\t<div class=\"litespeed-row\">\n\t\t<div class=\"litespeed-switch litespeed-mini litespeed-right20 litespeed-margin-bottom10\">\n\t\t\t<?php $val = Admin_Display::PURGEBY_CAT; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_category\" value=\"<?php echo esc_attr( $val ); ?>\" checked \/>\n\t\t\t<label for=\"purgeby_option_category\"><?php esc_html_e( 'Category', 'litespeed-cache' ); ?><\/label>\n\n\t\t\t<?php $val = Admin_Display::PURGEBY_PID; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_postid\" value=\"<?php echo esc_attr( $val ); ?>\" \/>\n\t\t\t<label for=\"purgeby_option_postid\"><?php esc_html_e( 'Post ID', 'litespeed-cache' ); ?><\/label>\n\n\t\t\t<?php $val = Admin_Display::PURGEBY_TAG; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_tag\" value=\"<?php echo esc_attr( $val ); ?>\" \/>\n\t\t\t<label for=\"purgeby_option_tag\"><?php esc_html_e( 'Tag', 'litespeed-cache' ); ?><\/label>\n\n\t\t\t<?php $val = Admin_Display::PURGEBY_URL; ?>\n\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\" id=\"purgeby_option_url\" value=\"<?php echo esc_attr( $val ); ?>\" \/>\n\t\t\t<label for=\"purgeby_option_url\"><?php esc_html_e( 'URL', 'litespeed-cache' ); ?><\/label>\n\t\t<\/div>\n\n\t\t<div class=\"litespeed-cache-purgeby-text litespeed-desc\">\n\t\t\t<div class=\"\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_CAT ); ?>\">\n\t\t\t\t<?php printf( esc_html__( 'Purge pages by category name - e.g. %2$s should be used for the URL %1$s.', 'litespeed-cache' ), '<code>http:\/\/example.com\/category\/category-name\/<\/code>', '<code>category-name<\/code>' ); ?>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-hide\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_PID ); ?>\">\n\t\t\t\t<?php esc_html_e( 'Purge pages by post ID.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-hide\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_TAG ); ?>\">\n\t\t\t\t<?php printf( esc_html__( 'Purge pages by tag name - e.g. %2$s should be used for the URL %1$s.', 'litespeed-cache' ), '<code>http:\/\/example.com\/tag\/tag-name\/<\/code>', '<code>tag-name<\/code>' ); ?>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-hide\" data-purgeby=\"<?php echo esc_attr( Admin_Display::PURGEBY_URL ); ?>\">\n\t\t\t\t<?php esc_html_e( 'Purge pages by relative or full URL.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php printf( esc_html__( 'e.g. Use %1$s or %2$s.', 'litespeed-cache' ), '<code>\/2016\/02\/24\/hello-world\/<\/code>', '<code>http:\/\/example.com\/2016\/02\/24\/hello-world\/<\/code>' ); ?>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\n\t<p>\n\t\t<textarea name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_LIST ); ?>\" rows=\"5\" class=\"litespeed-textarea\"><\/textarea>\n\t<\/p>\n\n\t<p>\n\t\t<button type=\"submit\" class=\"button button-primary\"><?php esc_html_e( 'Purge List', 'litespeed-cache' ); ?><\/button>\n\t<\/p>\n<\/form>\n<script>\n(function ($) {\n\tfunction setCookie(name, value, days) {\n\t\tvar expires = \"\";\n\t\tif (days) {\n\t\t\tvar date = new Date();\n\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\texpires = \"; expires=\" + date.toUTCString();\n\t\t}\n\t\tdocument.cookie = name + \"=\" + (value || \"\") + expires + \"; path=\/; SameSite=Strict\";\n\t}\n\n\tfunction getCookie(name) {\n\t\tvar nameEQ = name + \"=\";\n\t\tvar ca = document.cookie.split(';');\n\t\tfor (var i = 0; i < ca.length; i++) {\n\t\t\tvar c = ca[i];\n\t\t\twhile (c.charAt(0) == ' ') {\n\t\t\t\tc = c.substring(1, c.length);\n\t\t\t}\n\t\t\tif (c.indexOf(nameEQ) == 0) {\n\t\t\t\treturn c.substring(nameEQ.length, c.length);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tjQuery(document).ready(function () {\n\t\tvar savedPurgeBy = getCookie('litespeed_purgeby_option');\n\t\tif (savedPurgeBy) {\n\t\t\t$('input[name=\"<?php echo esc_attr( Admin_Display::PURGEBYOPT_SELECT ); ?>\"][value=\"' + savedPurgeBy + '\"]').prop('checked', true);\n\t\t\t$('[data-purgeby]').addClass('litespeed-hide');\n\t\t\t$('[data-purgeby=\"' + savedPurgeBy + '\"]').removeClass('litespeed-hide');\n\t\t}\n\t\t\/\/ Manage page -> purge by\n\t\t$('[name=purgeby]').on('change', function (event) {\n\t\t\t$('[data-purgeby]').addClass('litespeed-hide');\n\t\t\t$('[data-purgeby=' + this.value + ']').removeClass('litespeed-hide');\n\t\t\tsetCookie('litespeed_purgeby_option', this.value, 30);\n\t\t});\n\t});\n})(jQuery);\n<\/script>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/toolbox\/edit_htaccess.tpl.php","ext":"php","size":3609,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache View .htaccess\n *\n * Renders the .htaccess view interface for LiteSpeed Cache, displaying the contents and paths of frontend and backend .htaccess files.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$content = null;\ntry {\n\t$content = Htaccess::cls()->htaccess_read();\n} catch ( \\Exception $e ) {\n\t?>\n\t<div class=\"notice notice-error is-dismissible\">\n\t\t<p><?php echo wp_kses_post( $e->getMessage() ); ?><\/p>\n\t<\/div>\n\t<?php\n}\n\n$htaccess_path = Htaccess::get_frontend_htaccess();\n\n\/\/ Check for `ExpiresDefault` in .htaccess when LiteSpeed is enabled\nif ( defined( 'LITESPEED_ON' ) && $content && stripos( $content, \"\\nExpiresDefault\" ) !== false ) {\n\t$is_dismissed = GUI::get_option( self::DB_DISMISS_MSG );\n\tif ( self::RULECONFLICT_DISMISSED !== $is_dismissed ) {\n\t\tif ( self::RULECONFLICT_ON !== $is_dismissed ) {\n\t\t\tGUI::update_option( self::DB_DISMISS_MSG, self::RULECONFLICT_ON );\n\t\t}\n\t\trequire_once LSCWP_DIR . 'tpl\/inc\/show_rule_conflict.php';\n\t}\n}\n?>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'LiteSpeed Cache View .htaccess', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/toolbox\/#view-htaccess-tab' ); ?>\n<\/h3>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( '.htaccess Path', 'litespeed-cache' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php esc_html_e( 'Frontend .htaccess Path', 'litespeed-cache' ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<code><?php echo esc_html( $htaccess_path ); ?><\/code>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Default path is', 'litespeed-cache' ); ?>: <code><?php echo esc_html( Htaccess::get_frontend_htaccess( true ) ); ?><\/code>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'PHP Constant %s is supported.', 'litespeed-cache' ), '<code>LITESPEED_CFG_HTACCESS<\/code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'You can use this code %1$s in %2$s to specify the htaccess file path.', 'litespeed-cache' ), '<code>defined(\"LITESPEED_CFG_HTACCESS\") || define(\"LITESPEED_CFG_HTACCESS\", \"your path on server\");<\/code>', '<code>wp-config.php<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php esc_html_e( 'Backend .htaccess Path', 'litespeed-cache' ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<code><?php echo esc_html( Htaccess::get_backend_htaccess() ); ?><\/code>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Default path is', 'litespeed-cache' ); ?>: <code><?php echo esc_html( Htaccess::get_backend_htaccess( true ) ); ?><\/code>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'PHP Constant %s is supported.', 'litespeed-cache' ), '<code>LITESPEED_CFG_HTACCESS_BACKEND<\/code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'You can use this code %1$s in %2$s to specify the htaccess file path.', 'litespeed-cache' ), '<code>defined(\"LITESPEED_CFG_HTACCESS_BACKEND\") || define(\"LITESPEED_CFG_HTACCESS_BACKEND\", \"your path on server\");<\/code>', '<code>wp-config.php<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n\n<?php if ( null !== $content ) : ?>\n\t<h3 class=\"litespeed-title\">\n\t\t<?php printf( esc_html__( 'Current %s Contents', 'litespeed-cache' ), '.htaccess' ); ?>\n\t<\/h3>\n\n\t<h4><?php echo esc_html( $htaccess_path ); ?><\/h4>\n\n\t<textarea readonly wrap=\"off\" rows=\"50\" class=\"large-text\"><?php echo esc_textarea( $content ); ?><\/textarea>\n<?php endif; ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/settings_inc.auto_upgrade.tpl.php","ext":"php","size":651,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Auto Upgrade Setting\n *\n * Manages the auto-upgrade setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n\t<!-- build_setting_auto_upgrade -->\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_AUTO_UPGRADE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Turn this option ON to have LiteSpeed Cache updated automatically, whenever a new version is released. If OFF, update manually as usual.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/online.tpl.php","ext":"php","size":12382,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache QUIC.cloud Online Services\n *\n * Manages QUIC.cloud online services integration for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$cloud_summary = Cloud::get_summary();\n\n$cloud_instance = Cloud::cls();\n$cloud_instance->finish_qc_activation( 'online' );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'QUIC.cloud Online Services', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/' ); ?>\n<\/h3>\n\n<div class=\"litespeed-desc\"><?php esc_html_e( 'QUIC.cloud provides CDN and online optimization services, and is not required. You may use many features of this plugin without QUIC.cloud.', 'litespeed-cache' ); ?><\/div>\n\n<?php if ( $cloud_instance->activated() ) : ?>\n\t<div class=\"litespeed-callout notice notice-success inline\">\n\t\t<h4><?php esc_html_e( 'Current Cloud Nodes in Service', 'litespeed-cache' ); ?>\n\t\t\t<a class=\"litespeed-right litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_CLEAR_CLOUD, false, null, array( 'ref' => 'online' ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label='<?php esc_html_e( 'Click to clear all nodes for further redetection.', 'litespeed-cache' ); ?>' data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to clear all cloud nodes?', 'litespeed-cache' ); ?>\"><i class='litespeed-quic-icon'><\/i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/a>\n\t\t<\/h4>\n\t\t<p>\n\t\t\t<?php\n\t\t\t$has_service = false;\n\t\t\tforeach ( Cloud::$services as $svc ) {\n\t\t\t\tif ( isset( $cloud_summary[ 'server.' . $svc ] ) ) {\n\t\t\t\t\t$has_service = true;\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t'<p><strong>%1$s<\/strong> <code>%2$s<\/code> <strong>%3$s<\/strong> <code>%4$s<\/code> <strong>%5$s<\/strong> <code>%6$s<\/code><\/p>',\n\t\t\t\t\t\tesc_html__( 'Service:', 'litespeed-cache' ),\n\t\t\t\t\t\tesc_html( $svc ),\n\t\t\t\t\t\tesc_html__( 'Node:', 'litespeed-cache' ),\n\t\t\t\t\t\tesc_html( $cloud_summary[ 'server.' . $svc ] ),\n\t\t\t\t\t\tesc_html__( 'Connected Date:', 'litespeed-cache' ),\n\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary[ 'server_date.' . $svc ] ) )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( ! $has_service ) {\n\t\t\t\tesc_html_e( 'No cloud services currently in use', 'litespeed-cache' );\n\t\t\t}\n\t\t\t?>\n\t\t<\/p>\n\t<\/div>\n<?php endif; ?>\n\n<?php if ( ! $cloud_instance->activated() ) : ?>\n\t<h4 class=\"litespeed-text-md litespeed-top30\"><span class=\"dashicons dashicons-no-alt litespeed-danger\"><\/span> <?php esc_html_e( 'QUIC.cloud Integration Disabled', 'litespeed-cache' ); ?><\/h4>\n\t<p><?php esc_html_e( 'Speed up your WordPress site even further with QUIC.cloud Online Services and CDN.', 'litespeed-cache' ); ?><\/p>\n\t<div class=\"litespeed-desc\"><?php esc_html_e( 'Free monthly quota available.', 'litespeed-cache' ); ?><\/div>\n\t<p><a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'online' ) ) ); ?>\">\n\t\t\t<span class=\"dashicons dashicons-yes\"><\/span>\n\t\t\t<?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t<\/a><\/p>\n\n\t<div>\n\t\t<h3 class=\"litespeed-title-section\"><?php esc_html_e( 'Online Services', 'litespeed-cache' ); ?><\/h3>\n\t\t<p><?php esc_html_e( \"QUIC.cloud's Online Services improve your site in the following ways:\", 'litespeed-cache' ); ?><\/p>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( '<strong>Image Optimization<\/strong> gives you smaller image file sizes that transmit faster.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( '<strong>Page Optimization<\/strong> streamlines page styles and visual elements for faster loading.', 'litespeed-cache' ) ); ?><\/li>\n\t\t<\/ul>\n\n\t\t<h4 class=\"litespeed-text-md litespeed-margin-bottom-remove\"><?php esc_html_e( 'Image Optimization', 'litespeed-cache' ); ?><\/h4>\n\t\t<p><?php esc_html_e( \"QUIC.cloud's Image Optimization service does the following:\", 'litespeed-cache' ); ?><\/p>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php esc_html_e( \"Processes your uploaded PNG and JPG images to produce smaller versions that don't sacrifice quality.\", 'litespeed-cache' ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php esc_html_e( 'Optionally creates next-generation WebP or AVIF image files.', 'litespeed-cache' ); ?><\/li>\n\t\t<\/ul>\n\t\t<p><?php esc_html_e( 'Processing for PNG, JPG, and WebP image formats is free. AVIF is available for a fee.', 'litespeed-cache' ); ?> <a href=\"https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/image-optimization-service\/\" target=\"_blank\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a><\/p>\n\n\t\t<h4 class=\"litespeed-text-md litespeed-margin-bottom-remove\"><?php esc_html_e( 'Page Optimization', 'litespeed-cache' ); ?><\/h4>\n\t\t<p><?php esc_html_e( \"QUIC.cloud's Page Optimization services address CSS bloat, and improve the user experience during page load, which can lead to improved page speed scores.\", 'litespeed-cache' ); ?><\/p>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( '<strong>Critical CSS (CCSS)<\/strong> loads visible above-the-fold content faster and with full styling.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( '<strong>Unique CSS (UCSS)<\/strong> removes unused style definitions for a speedier page load overall.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( '<strong>Low Quality Image Placeholder (LQIP)<\/strong> gives your imagery a more pleasing look as it lazy loads.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( '<strong>Viewport Images (VPI)<\/strong> provides a well-polished fully-loaded view above the fold.', 'litespeed-cache' ) ); ?><\/li>\n\t\t<\/ul>\n\n\t\t<div>\n\t\t\t<a href=\"https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/page-optimization\/\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a>\n\t\t<\/div>\n\t<\/div>\n\n\t<div>\n\t\t<h3 class=\"litespeed-title-section\"><?php esc_html_e( 'Content Delivery Network', 'litespeed-cache' ); ?><\/h3>\n\n\t\t<h4 class=\"litespeed-text-md litespeed-margin-bottom-remove\"><?php esc_html_e( 'QUIC.cloud CDN:', 'litespeed-cache' ); ?><\/h4>\n\t\t<ul>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( 'Caches your entire site, including dynamic content and <strong>ESI blocks<\/strong>.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( 'Delivers global coverage with a growing <strong>network of 80+ PoPs<\/strong>.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( 'Provides <strong>security at the CDN level<\/strong>, protecting your server from attack.', 'litespeed-cache' ) ); ?><\/li>\n\t\t\t<li><span class=\"dashicons dashicons-saved litespeed-primary\"><\/span> <?php echo wp_kses_post( __( 'Offers optional <strong>built-in DNS service<\/strong> to simplify CDN onboarding.', 'litespeed-cache' ) ); ?><\/li>\n\t\t<\/ul>\n\n\t\t<div>\n\t\t\t<a href=\"https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/quic-cloud-cdn-service\/\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a>\n\t\t<\/div>\n\n\t\t<hr class=\"litespeed-hr-with-space\">\n\n\t\t<p class=\"litespeed-desc\"><?php esc_html_e( 'In order to use most QUIC.cloud services, you need quota. QUIC.cloud gives you free quota every month, but if you need more, you can purchase it.', 'litespeed-cache' ); ?> <a href=\"https:\/\/docs.quic.cloud\/billing\/services\/\" target=\"_blank\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a><\/p>\n\n\t\t<div class=\"litespeed-flex litespeed-flex-align-center\">\n\t\t\t<a class=\"button button-secondary litespeed-right20\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'online' ) ) ); ?>\">\n\t\t\t\t<span class=\"dashicons dashicons-yes\"><\/span>\n\t\t\t\t<?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t\t<\/a>\n\t\t<\/div>\n\t<\/div>\n\n<?php elseif ( ! empty( $cloud_summary['qc_activated'] ) && ( 'linked' === $cloud_summary['qc_activated'] || 'cdn' === $cloud_summary['qc_activated'] ) ) : ?>\n\t<h4 class=\"litespeed-text-md litespeed-top30\"><span class=\"dashicons dashicons-saved litespeed-success\"><\/span> <?php esc_html_e( 'QUIC.cloud Integration Enabled', 'litespeed-cache' ); ?><\/h4>\n\t<p><?php esc_html_e( 'Your site is connected and ready to use QUIC.cloud Online Services.', 'litespeed-cache' ); ?>\n\t\t<?php if ( empty( $cloud_summary['partner'] ) ) : ?>\n\t\t\t<a href=\"<?php echo esc_url( $cloud_instance->qc_link() ); ?>\" class=\"litespeed-link-with-icon\" target=\"_blank\"><?php esc_html_e( 'Go to QUIC.cloud dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"><\/span><\/a>\n\t\t<?php endif; ?>\n\t<\/p>\n\n\t<ul>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"><\/span> <?php esc_html_e( 'Page Optimization', 'litespeed-cache' ); ?><\/li>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"><\/span> <?php esc_html_e( 'Image Optimization', 'litespeed-cache' ); ?><\/li>\n\t\t<?php if ( 'cdn' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"><\/span> <?php esc_html_e( 'CDN - Enabled', 'litespeed-cache' ); ?><\/li>\n\t\t<?php else : ?>\n\t\t\t<li><span class=\"dashicons dashicons-no-alt litespeed-default\"><\/span> <span class=\"litespeed-default\"><?php esc_html_e( 'CDN - Disabled', 'litespeed-cache' ); ?><\/span><\/li>\n\t\t<?php endif; ?>\n\t<\/ul>\n\n<?php else : ?>\n\t<h4 class=\"litespeed-text-md litespeed-top30\"><span class=\"dashicons dashicons-saved litespeed-success\"><\/span> <?php esc_html_e( 'QUIC.cloud Integration Enabled with limitations', 'litespeed-cache' ); ?><\/h4>\n\t<p><?php echo wp_kses_post( __( 'Your site is connected and using QUIC.cloud Online Services as an <strong>anonymous user<\/strong>. The CDN function and certain features of optimization services are not available for anonymous users. Link to QUIC.cloud to use the CDN and all available Online Services features.', 'litespeed-cache' ) ); ?><\/p>\n\t<div class=\"litespeed-desc\"><?php esc_html_e( 'Free monthly quota available.', 'litespeed-cache' ); ?><\/div>\n\n\t<ul>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"><\/span> <?php esc_html_e( 'Page Optimization', 'litespeed-cache' ); ?><\/li>\n\t\t<li><span class=\"dashicons dashicons-yes litespeed-success\"><\/span> <?php esc_html_e( 'Image Optimization', 'litespeed-cache' ); ?><\/li>\n\t\t<li><span class=\"dashicons dashicons-no-alt litespeed-danger\"><\/span> <?php esc_html_e( 'CDN - not available for anonymous users', 'litespeed-cache' ); ?><\/li>\n\t<\/ul>\n\n\t<p><a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'online' ) ) ); ?>\"><span class=\"dashicons dashicons-yes\"><\/span><?php esc_html_e( 'Link to QUIC.cloud', 'litespeed-cache' ); ?><\/a><\/p>\n<?php endif; ?>\n\n<?php if ( $cloud_instance->activated() ) : ?>\n\t<div class=\"litespeed-empty-space-medium\"><\/div>\n\t<div class=\"litespeed-column-with-boxes-footer\">\n\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_RESET, false, null, array( 'ref' => 'online' ) ) ); ?>\" class=\"litespeed-link-with-icon litespeed-danger\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to disconnect from QUIC.cloud? This will not remove any data from the QUIC.cloud dashboard.', 'litespeed-cache' ); ?>\"><span class=\"dashicons dashicons-dismiss\"><\/span><?php esc_html_e( 'Disconnect from QUIC.cloud', 'litespeed-cache' ); ?><\/a>\n\t\t<div class=\"litespeed-desc litespeed-margin-bottom-remove\"><?php esc_html_e( 'Remove QUIC.cloud integration from this site. Note: QUIC.cloud data will be preserved so you can re-enable services at any time. If you want to fully remove your site from QUIC.cloud, delete the domain through the QUIC.cloud Dashboard first.', 'litespeed-cache' ); ?><\/div>\n\t<\/div>\n<?php endif; ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/settings.tpl.php","ext":"php","size":6112,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache General Settings\n *\n * Manages general settings for LiteSpeed Cache, including Guest Mode optimization, server IP, and news settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$cloud_instance = Cloud::cls();\n$cloud_summary  = Cloud::get_summary();\n\n$ajax_url_get_ip = function_exists('get_rest_url') ? get_rest_url(null, 'litespeed\/v1\/tool\/check_ip') : '\/';\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'General Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/general\/' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl\/general\/settings_inc.auto_upgrade.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl\/general\/settings_inc.guest.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_GUEST_OPTM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<span class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\ud83d\udea8\n\t\t\t\t\t\t<?php esc_html_e( 'This option enables maximum optimization for Guest Mode visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/general\/#guest-optimization', esc_html__( 'Please read all warnings before enabling this option.', 'litespeed-cache' ), false, 'litespeed-danger' ); ?>\n\t\t\t\t\t<\/span>\n\n\t\t\t\t\t<?php\n\t\t\t\t\t$type_list = array();\n\t\t\t\t\tif ( $this->conf( Base::O_GUEST ) && ! $this->conf( Base::O_OPTM_UCSS ) ) {\n\t\t\t\t\t\t$type_list[] = 'UCSS';\n\t\t\t\t\t}\n\t\t\t\t\tif ( $this->conf( Base::O_GUEST ) && ! $this->conf( Base::O_OPTM_CSS_ASYNC ) ) {\n\t\t\t\t\t\t$type_list[] = 'CCSS';\n\t\t\t\t\t}\n\t\t\t\t\tif ( ! empty( $type_list ) ) {\n\t\t\t\t\t\t$the_type = implode( '\/', $type_list );\n\t\t\t\t\t\techo '<br \/>';\n\t\t\t\t\t\techo '<font class=\"litespeed-info\">';\n\t\t\t\t\t\techo '\u26a0\ufe0f ' . sprintf( esc_html__( 'Your %1$s quota on %2$s will still be in use.', 'litespeed-cache' ), esc_html( $the_type ), 'QUIC.cloud' );\n\t\t\t\t\t\techo '<\/font>';\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_GUEST ) ) : ?>\n\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t<font class=\"litespeed-warning litespeed-left10\">\n\t\t\t\t\t\t\t\u26a0\ufe0f <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( '%s must be turned ON for this setting to work.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_GUEST ) ) . '<\/code>' ); ?>\n\t\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_CACHE_MOBILE ) ) : ?>\n\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t<font class=\"litespeed-primary litespeed-left10\">\n\t\t\t\t\t\t\t\u26a0\ufe0f <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'You need to turn %s on to get maximum result.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_CACHE_MOBILE ) ) . '<\/code>' ); ?>\n\t\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_IMG_OPTM_WEBP ) ) : ?>\n\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t<font class=\"litespeed-primary litespeed-left10\">\n\t\t\t\t\t\t\t\u26a0\ufe0f <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'You need to turn %s on and finish all WebP generation to get maximum result.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_IMG_OPTM_WEBP ) ) . '<\/code>' ); ?>\n\t\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_SERVER_IP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( \"Enter this site's IP address to allow cloud services directly call IP instead of domain name. This eliminates the overhead of DNS and CDN lookups.\", 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( 'Your server IP', 'litespeed-cache' ); ?>: <code id='litespeed_server_ip'>-<\/code> <a href=\"javascript:;\" class=\"button button-link\" id=\"litespeed_get_ip\"><?php esc_html_e( 'Check my public IP from', 'litespeed-cache' ); ?> CyberPanel.sh<\/a>\n\t\t\t\t\t\u26a0\ufe0f <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php esc_html_e( 'the auto-detected IP may not be accurate if you have an additional outgoing IP set, or you have multiple IPs configured on your server.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( 'Please make sure this IP is the correct one for visiting your site.', 'litespeed-cache' ); ?>\n\n\t\t\t\t\t<?php $this->_validate_ip( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_NEWS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Turn this option ON to show latest news automatically, including hotfixes, new releases, available beta versions, and promotions.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t<\/tbody>\n<\/table>\n\n<?php $this->form_end(); ?>\n\n<script>\n(function ($) {\n\tjQuery(document).ready(function () {\n\t\t\/**\n\t\t * Get server IP\n\t\t * @since  3.0\n\t\t *\/\n\t\t$('#litespeed_get_ip').on('click', function (e) {\n\t\t\tconsole.log('[litespeed] get server IP');\n\t\t\t$.ajax({\n\t\t\t\turl: '<?php echo $ajax_url_get_ip; \/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>',\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\txhr.setRequestHeader('X-WP-Nonce', '<?php echo esc_js(wp_create_nonce('wp_rest')); ?>');\n\t\t\t\t\t$('#litespeed_server_ip').html('Detecting...');\n\t\t\t\t},\n\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t$('#litespeed_server_ip').html('Done');\n\t\t\t\t\tconsole.log('[litespeed] get server IP response: ' + data);\n\t\t\t\t\t$('#litespeed_server_ip').html(data);\n\t\t\t\t},\n\t\t\t\terror: function (xhr, error) {\n\t\t\t\t\tconsole.log('[litespeed] get server IP error', error);\n\t\t\t\t\t$('#litespeed_server_ip').html('Failed to detect IP');\n\t\t\t\t},\n\t\t\t\tcomplete: function (xhr, status) {\n\t\t\t\t\tconsole.log('[litespeed] AJAX complete', status, xhr);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t});\n})(jQuery);\n<\/script>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/settings_tuning.tpl.php","ext":"php","size":1592,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Tuning Settings\n *\n * Manages tuning settings for LiteSpeed Cache, including Guest Mode configurations.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Tuning Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/general\/#tuning-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_GUEST_UAS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id, 30 ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed User Agents will be considered as Guest Mode visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_GUEST_IPS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id, 50 ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed IPs will be considered as Guest Mode visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n<\/tbody><\/table>\n\n<?php $this->form_end(); ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/entry.tpl.php","ext":"php","size":1341,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache General Settings\n *\n * Manages general settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n    'online'          => esc_html__( 'Online Services', 'litespeed-cache' ),\n    'settings'        => esc_html__( 'General Settings', 'litespeed-cache' ),\n    'settings_tuning' => esc_html__( 'Tuning', 'litespeed-cache' ),\n);\n\nif ( is_network_admin() ) {\n    $menu_list = array(\n        'network_settings' => esc_html__( 'General Settings', 'litespeed-cache' ),\n    );\n}\n\n?>\n\n<div class=\"wrap\">\n    <h1 class=\"litespeed-h1\">\n        <?php esc_html_e( 'LiteSpeed Cache General Settings', 'litespeed-cache' ); ?>\n    <\/h1>\n    <span class=\"litespeed-desc\">\n        v<?php echo esc_html( Core::VER ); ?>\n    <\/span>\n    <hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n    <h2 class=\"litespeed-header nav-tab-wrapper\">\n        <?php GUI::display_tab_list( $menu_list ); ?>\n    <\/h2>\n\n    <div class=\"litespeed-body\">\n        <?php\n        foreach ( $menu_list as $menu_key => $val ) {\n            echo '<div data-litespeed-layout=\"' . esc_attr( $menu_key ) . '\">';\n            require LSCWP_DIR . 'tpl\/general\/' . $menu_key . '.tpl.php';\n            echo '<\/div>';\n        }\n        ?>\n    <\/div>\n\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/settings_inc.guest.tpl.php","ext":"php","size":2164,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Guest Mode Setting\n *\n * Manages the Guest Mode setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$guest_update_url = wp_parse_url( LSWCP_PLUGIN_URL . GUI::PHP_GUEST, PHP_URL_PATH );\n\n?>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_GUEST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( \"Guest Mode provides an always cacheable landing page for an automated guest's first time visit, and then attempts to update cache varies via AJAX.\", 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'This option can help to correct the cache vary for certain advanced mobile or tablet visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/general\/#guest-mode' ); ?>\n\t\t\t\t<br \/><?php Doc::notice_htaccess(); ?>\n\t\t\t\t<br \/><?php Doc::crawler_affected(); ?>\n\t\t\t<\/div>\n\t\t\t<?php if ( $this->conf( $option_id ) ) : ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Guest Mode testing result', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<font id='litespeed_gm_status'><?php esc_html_e( 'Testing', 'litespeed-cache' ); ?>...<\/font>\n\t\t\t\t<\/div>\n\t\t\t\t<script>\n\t\t\t\t\t(function ($) {\n\t\t\t\t\t\tjQuery(document).ready(function () {\n\t\t\t\t\t\t\t$.post( '<?php echo $guest_update_url; \/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>', function(data){\n\t\t\t\t\t\t\t\tif ( data === '[]' || data === '{\"reload\":\"yes\"}' ) {\n\t\t\t\t\t\t\t\t\t$('#litespeed_gm_status').html('<font class=\"litespeed-success\"><?php esc_html_e( 'Guest Mode passed testing.', 'litespeed-cache' ); ?><\/font>');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$('#litespeed_gm_status').html('<font class=\"litespeed-danger\"><?php esc_html_e( 'Guest Mode failed to test.', 'litespeed-cache' ); ?><\/font>');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).fail( function(){\n\t\t\t\t\t\t\t\t$('#litespeed_gm_status').html('<font class=\"litespeed-danger\"><?php esc_html_e( 'Guest Mode failed to test.', 'litespeed-cache' ); ?><\/font>');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t})(jQuery);\n\t\t\t\t<\/script>\n\t\t\t<?php endif; ?>\n\t\t<\/td>\n\t<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/general\/network_settings.tpl.php","ext":"php","size":1211,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network General Settings\n *\n * Manages network-wide general settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'General Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/general\/' ); ?>\n<\/h3>\n\n<?php\n$this->form_action( Router::ACTION_SAVE_SETTINGS_NETWORK );\n?>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<?php require LSCWP_DIR . 'tpl\/general\/settings_inc.auto_upgrade.tpl.php'; ?>\n\n\t<tr>\n\t\t<th><?php esc_html_e( 'Use Primary Site Configuration', 'litespeed-cache' ); ?><\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( Base::NETWORK_O_USE_PRIMARY ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( \"Check this option to use the primary site's configuration for all subsites.\", 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'This will disable the settings page on all subsites.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<?php require LSCWP_DIR . 'tpl\/general\/settings_inc.guest.tpl.php'; ?>\n\n<\/tbody><\/table>\n\n<?php\n$this->form_end();\n?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/presets\/entry.tpl.php","ext":"php","size":1246,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Configuration Presets\n *\n * Renders the configuration presets interface for LiteSpeed Cache, including standard presets and import\/export functionality.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'standard'      => esc_html__( 'Standard Presets', 'litespeed-cache' ),\n\t'import_export' => esc_html__( 'Import \/ Export', 'litespeed-cache' ),\n);\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Configuration Presets', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\tv<?php echo esc_html( Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t<\/h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php\n\t\tforeach ( $menu_list as $curr_tab => $val ) :\n\t\t\t?>\n\t\t\t<div data-litespeed-layout=\"<?php echo esc_attr( $curr_tab ); ?>\">\n\t\t\t\t<?php\n\t\t\t\tif ( 'import_export' === $curr_tab ) {\n\t\t\t\t\trequire LSCWP_DIR . \"tpl\/toolbox\/$curr_tab.tpl.php\";\n\t\t\t\t} else {\n\t\t\t\t\trequire LSCWP_DIR . \"tpl\/presets\/$curr_tab.tpl.php\";\n\t\t\t\t}\n\t\t\t\t?>\n\t\t\t<\/div>\n\t\t\t<?php\n\t\tendforeach;\n\t\t?>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/presets\/standard.tpl.php","ext":"php","size":8816,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Standard Presets\n *\n * Renders the standard presets interface for LiteSpeed Cache, allowing users to apply predefined configuration presets.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$presets = array(\n\t'essentials' => array(\n\t\t'title'  => esc_html__( 'Essentials', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Default Cache', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Higher TTL', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Browser Cache', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This no-risk preset is appropriate for all websites. Good for new users, simple websites, or cache-oriented development.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is not required to use this preset. Only basic caching features are enabled.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'basic' => array(\n\t\t'title'  => esc_html__( 'Basic', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Essentials, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Image Optimization', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Mobile Cache', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This low-risk preset introduces basic optimizations for speed and user experience. Appropriate for enthusiastic beginners.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Includes optimizations known to improve site score in page speed measurement tools.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'advanced' => array(\n\t\t'title'  => esc_html__( 'Advanced (Recommended)', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Basic, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Guest Mode and Guest Optimization', 'litespeed-cache' ),\n\t\t\tesc_html__( 'CSS, JS and HTML Minification', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Font Display Optimization', 'litespeed-cache' ),\n\t\t\tesc_html__( 'JS Defer for both external and inline JS', 'litespeed-cache' ),\n\t\t\tesc_html__( 'DNS Prefetch for static files', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Gravatar Cache', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Remove Query Strings from Static Files', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Remove WordPress Emoji', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Remove Noscript Tags', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This preset is good for most websites, and is unlikely to cause conflicts. Any CSS or JS conflicts may be resolved with Page Optimization > Tuning tools.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Includes many optimizations known to improve page speed scores.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'aggressive' => array(\n\t\t'title'  => esc_html__( 'Aggressive', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Advanced, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'CSS & JS Combine', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Asynchronous CSS Loading with Critical CSS', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Removed Unused CSS for Users', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Lazy Load for Iframes', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This preset might work out of the box for some websites, but be sure to test! Some CSS or JS exclusions may be necessary in Page Optimization > Tuning.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Includes many optimizations known to improve page speed scores.', 'litespeed-cache' ),\n\t\t),\n\t),\n\t'extreme' => array(\n\t\t'title'  => esc_html__( 'Extreme', 'litespeed-cache' ),\n\t\t'body'   => array(\n\t\t\tesc_html__( 'Everything in Aggressive, Plus', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Lazy Load for Images', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Viewport Image Generation', 'litespeed-cache' ),\n\t\t\tesc_html__( 'JS Delayed', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Inline JS added to Combine', 'litespeed-cache' ),\n\t\t\tesc_html__( 'Inline CSS added to Combine', 'litespeed-cache' ),\n\t\t),\n\t\t'footer' => array(\n\t\t\tesc_html__( 'This preset almost certainly will require testing and exclusions for some CSS, JS and Lazy Loaded images. Pay special attention to logos, or HTML-based slider images.', 'litespeed-cache' ),\n\t\t\tesc_html__( 'A QUIC.cloud connection is required to use this preset. Enables the maximum level of optimizations for improved page speed scores.', 'litespeed-cache' ),\n\t\t),\n\t),\n);\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'LiteSpeed Cache Standard Presets', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/presets\/#standard-tab' ); ?>\n<\/h3>\n\n<p><?php esc_html_e( 'Use an official LiteSpeed-designed Preset to configure your site in one click. Try no-risk caching essentials, extreme optimization, or something in between.', 'litespeed-cache' ); ?><\/p>\n\n<div class=\"litespeed-comparison-cards\">\n\t<?php\n\tforeach ( array_keys( $presets ) as $name ) :\n\t\t$curr_title   = $presets[ $name ]['title'];\n\t\t$recommend    = 'advanced' === $name;\n\t\t$card_class   = $recommend ? 'litespeed-comparison-card-rec' : '';\n\t\t$button_class = $recommend ? 'button-primary' : 'button-secondary';\n\t\t?>\n\t\t<div class=\"litespeed-comparison-card postbox <?php echo esc_attr( $card_class ); ?>\">\n\t\t\t<div class=\"litespeed-card-content\">\n\t\t\t\t<div class=\"litespeed-card-header\">\n\t\t\t\t\t<h3 class=\"litespeed-h3\">\n\t\t\t\t\t\t<?php echo esc_html( $curr_title ); ?>\n\t\t\t\t\t<\/h3>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-card-body\">\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<?php foreach ( $presets[ $name ]['body'] as $line ) : ?>\n\t\t\t\t\t\t\t<li><?php echo esc_html( $line ); ?><\/li>\n\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-card-footer\">\n\t\t\t\t\t<h4><?php esc_html_e( 'Who should use this preset?', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t<?php foreach ( $presets[ $name ]['footer'] as $line ) : ?>\n\t\t\t\t\t\t<p><?php echo esc_html( $line ); ?><\/p>\n\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-card-action\">\n\t\t\t\t<a\n\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PRESET, Preset::TYPE_APPLY, false, null, array( 'preset' => $name ) ) ); ?>\"\n\t\t\t\t\tclass=\"button <?php echo esc_attr( $button_class ); ?>\"\n\t\t\t\t\tdata-litespeed-cfm=\"<?php echo esc_attr( sprintf( __( 'This will back up your current settings and replace them with the %1$s preset settings. Do you want to continue?', 'litespeed-cache' ), $curr_title ) ); ?>\"\n\t\t\t\t>\n\t\t\t\t\t<?php esc_html_e( 'Apply Preset', 'litespeed-cache' ); ?>\n\t\t\t\t<\/a>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<?php endforeach; ?>\n<\/div>\n\n<?php\n$summary = Preset::get_summary();\n$backups = array();\nforeach ( Preset::get_backups() as $backup ) {\n\t$backup = explode( '-', $backup );\n\tif ( empty( $backup[1] ) ) {\n\t\tcontinue;\n\t}\n\t$timestamp  = $backup[1];\n\t$time       = trim( Utility::readable_time( $timestamp ) );\n\t$name       = empty( $backup[3] ) ? null : $backup[3];\n\t$curr_title = empty( $presets[ $name ]['title'] ) ? $name : $presets[ $name ]['title'];\n\t$curr_title = null === $curr_title ? esc_html__( 'unknown', 'litespeed-cache' ) : $curr_title;\n\t$backups[]  = array(\n\t\t'timestamp' => $timestamp,\n\t\t'time'      => $time,\n\t\t'title'     => $curr_title,\n\t);\n}\n\nif ( ! empty( $summary['preset'] ) || ! empty( $backups ) ) :\n\t?>\n\t<h3 class=\"litespeed-title-short\">\n\t\t<?php esc_html_e( 'History', 'litespeed-cache' ); ?>\n\t<\/h3>\n<?php endif; ?>\n\n<?php if ( ! empty( $summary['preset'] ) ) : ?>\n\t<p>\n\t\t<?php\n\t\t$name = strtolower( $summary['preset'] );\n\t\t$time = trim( Utility::readable_time( $summary['preset_timestamp'] ) );\n\t\tif ( 'error' === $name ) {\n\t\t\tprintf( esc_html__( 'Error: Failed to apply the settings %1$s', 'litespeed-cache' ), esc_html( $time ) );\n\t\t} elseif ( 'backup' === $name ) {\n\t\t\tprintf( esc_html__( 'Restored backup settings %1$s', 'litespeed-cache' ), esc_html( $time ) );\n\t\t} else {\n\t\t\tprintf(\n\t\t\t\tesc_html__( 'Applied the %1$s preset %2$s', 'litespeed-cache' ),\n\t\t\t\t'<strong>' . esc_html( $presets[ $name ]['title'] ) . '<\/strong>',\n\t\t\t\tesc_html( $time )\n\t\t\t);\n\t\t}\n\t\t?>\n\t<\/p>\n<?php endif; ?>\n\n<?php foreach ( $backups as $backup ) : ?>\n\t<p>\n\t\t<?php printf( esc_html__( 'Backup created %1$s before applying the %2$s preset', 'litespeed-cache' ), esc_html( $backup['time'] ), esc_html( $backup['title'] ) ); ?>\n\t\t<a\n\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PRESET, Preset::TYPE_RESTORE, false, null, array( 'timestamp' => $backup['timestamp'] ) ) ); ?>\"\n\t\t\tclass=\"litespeed-left10\"\n\t\t\tdata-litespeed-cfm=\"<?php echo esc_attr( sprintf( __( 'This will restore the backup settings created %1$s before applying the %2$s preset. Any changes made since then will be lost. Do you want to continue?', 'litespeed-cache' ), $backup['time'], $backup['title'] ) ); ?>\"\n\t\t>\n\t\t\t<?php esc_html_e( 'Restore Settings', 'litespeed-cache' ); ?>\n\t\t<\/a>\n\t<\/p>\n<?php endforeach; ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-esi.tpl.php","ext":"php","size":5939,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache ESI Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php echo esc_html__( 'ESI Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#esi-tab' ); ?>\n<\/h3>\n\n<div class=\"litespeed-description\">\n\t<p><?php echo esc_html__( 'With ESI (Edge Side Includes), pages may be served from cache for logged-in users.', 'litespeed-cache' ); ?><\/p>\n\t<p><?php echo esc_html__( 'ESI allows you to designate parts of your dynamic page as separate fragments that are then assembled together to make the whole page. In other words, ESI lets you \u201cpunch holes\u201d in a page, and then fill those holes with content that may be cached privately, cached publicly with its own TTL, or not cached at all.', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https:\/\/blog.litespeedtech.com\/2017\/08\/30\/wpw-private-cache-vs-public-cache\/', esc_html__( 'WpW: Private Cache vs. Public Cache', 'litespeed-cache' ) ); ?>\n\t<\/p>\n\t<p>\n\t\t\ud83d\udca1:\n\t\t<?php echo esc_html__( 'You can turn shortcodes into ESI blocks.', 'litespeed-cache' ); ?>\n\t\t<?php\n\t\tprintf(\n\t\t\tesc_html__( 'Replace %1$s with %2$s.', 'litespeed-cache' ),\n\t\t\t'<code>[shortcodeA att1=\"val1\" att2=\"val2\"]<\/code>',\n\t\t\t'<code>[esi shortcodeA att1=\"val1\" att2=\"val2\"]<\/code>'\n\t\t);\n\t\t?>\n\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/admin\/#turning-wordpress-shortcodes-into-esi-blocks' ); ?>\n\t<\/p>\n\t<p>\n\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/api\/#generate-esi-block-url', esc_html__( 'ESI sample for developers', 'litespeed-cache' ) ); ?>\n\t<\/p>\n<\/div>\n\n<div class=\"litespeed-relative\">\n\n<?php if ( ! LSWCP_ESI_SUPPORT && ! $this->conf( Base::O_CDN_QUIC ) ) : ?>\n\t<div class=\"litespeed-callout-danger\">\n\t\t<h4><?php echo esc_html__( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n\t\t<h4><?php echo esc_html__( 'These options are only available with LiteSpeed Enterprise Web Server or QUIC.cloud CDN.', 'litespeed-cache' ); ?><\/h4>\n\t<\/div>\n<?php endif; ?>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_ESI; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Turn ON to cache public pages for logged in users, and serve the Admin Bar and Comment Form via ESI blocks. These two blocks will be uncached unless enabled below.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_ESI_CACHE_ADMBAR; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Cache the built-in Admin Bar ESI block.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_ESI_CACHE_COMMFORM; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Cache the built-in Comment Form ESI block.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_ESI_NONCE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<\/div>\n\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'The list will be merged with the predefined nonces in your local data file.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php echo esc_html__( 'The latest data file is', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/master\/data\/esi.nonces.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/master\/data\/esi.nonces.txt<\/a>\n\t\t\t\t<br><span class=\"litespeed-success\">\n\t\t\t\t\t<?php echo esc_html__( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_esi_nonces<\/code>' ); ?>\n\t\t\t\t<\/span>\n\t\t\t<\/p>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'The above nonces will be converted to ESI automatically.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br><?php echo esc_html__( 'An optional second parameter may be used to specify cache control. Use a space to separate', 'litespeed-cache' ); ?>: <code>my_nonce_action private<\/code>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php printf( esc_html__( 'Wildcard %1$s supported (match zero or more characters). For example, to match %2$s and %3$s, use %4$s.', 'litespeed-cache' ), '<code>*<\/code>', '<code>nonce_formid_1<\/code>', '<code>nonce_formid_3<\/code>', '<code>nonce_formid_*<\/code>' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_VARY_GROUP; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<table class=\"litespeed-vary-table wp-list-table striped litespeed-table form-table\"><tbody>\n\t\t\t<?php foreach ( $roles as $curr_role => $curr_title ) : ?>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\"litespeed-vary-title\"><?php echo esc_html( $curr_title ); ?><\/td>\n\t\t\t\t\t<td class=\"litespeed-vary-val\">\n\t\t\t\t\t<?php\n\t\t\t\t\t\t$this->build_input(\n\t\t\t\t\t\t\t$option_id . '[' . $curr_role . ']',\n\t\t\t\t\t\t\t'litespeed-input-short',\n\t\t\t\t\t\t\t$this->cls( 'Vary' )->in_vary_group( $curr_role )\n\t\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<\/td>\n\t\t\t\t<\/tr>\n\t\t\t<?php endforeach; ?>\n\t\t\t<\/tbody><\/table>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'If your site contains public content that certain user roles can see but other roles cannot, you can specify a Vary Group for those user roles. For example, specifying an administrator vary group allows there to be a separate publicly-cached page tailored to administrators (with \u201cedit\u201d links, etc), while all other user roles see the default public page.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>\n\n<\/div>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/more_settings_tip.tpl.php","ext":"php","size":670,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Setting Tip\n *\n * Displays a notice to inform users about additional LiteSpeed Cache settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nglobal $pagenow;\nif ( 'options-general.php' !== $pagenow ) {\n\treturn;\n}\n?>\n\n<div class=\"litespeed-callout notice notice-success inline\">\n\t<h4><?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?><\/h4>\n\t<p>\n\t\t<?php\n\t\tprintf(\n\t\t\t\/* translators: %s: LiteSpeed Cache menu label *\/\n\t\t\tesc_html__( 'More settings available under %s menu', 'litespeed-cache' ),\n\t\t\t'<code>' . esc_html__( 'LiteSpeed Cache', 'litespeed-cache' ) . '<\/code>'\n\t\t);\n\t\t?>\n\t<\/p>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/network_settings-browser.tpl.php","ext":"php","size":277,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Browser Settings\n *\n * Includes the browser cache settings template for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nrequire LSCWP_DIR . 'tpl\/cache\/settings_inc.browser.tpl.php';\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-browser.tpl.php","ext":"php","size":210,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Browser Cache Setting\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nrequire LSCWP_DIR . 'tpl\/cache\/settings_inc.browser.tpl.php';\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-excludes.tpl.php","ext":"php","size":4915,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Exclude Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php echo esc_html__( 'Exclude Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#excludes-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php echo esc_html__( 'Paths containing these strings will not be cached.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t\t<br><?php echo esc_html__( 'Predefined list will also be combined w\/ the above settings', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/cache_nocacheable.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/cache_nocacheable.txt<\/a>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_EXC_QS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php echo esc_html__( 'Query strings containing these parameters will not be cached.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'For example, for %1$s, %2$s and %3$s can be used here.', 'litespeed-cache' ), '<code>?aa=bb&cc=dd<\/code>', '<code>aa<\/code>', '<code>cc<\/code>' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_EXC_CAT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php\n\t\t\t\t$excludes_buf = '';\n\t\t\t\tif ( $this->conf( $option_id ) ) {\n\t\t\t\t\t$excludes_buf = implode( \"\\n\", array_map( 'get_cat_name', $this->conf( $option_id ) ) );\n\t\t\t\t}\n\t\t\t\t$this->build_textarea( $option_id, false, $excludes_buf );\n\t\t\t\t?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<b><?php echo esc_html__( 'All categories are cached by default.', 'litespeed-cache' ); ?><\/b>\n\t\t\t\t\t<?php printf( esc_html__( 'To prevent %s from being cached, enter them here.', 'litespeed-cache' ), esc_html__( 'categories', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<h4><?php echo esc_html__( 'NOTE', 'litespeed-cache' ); ?>:<\/h4>\n\t\t\t\t\t<ol>\n\t\t\t\t\t\t<li><?php echo esc_html__( 'If the category name is not found, the category will be removed from the list on save.', 'litespeed-cache' ); ?><\/li>\n\t\t\t\t\t<\/ol>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_EXC_TAG; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php\n\t\t\t\t$excludes_buf = '';\n\t\t\t\tif ( $this->conf( $option_id ) ) {\n\t\t\t\t\t$tag_names = array();\n\t\t\t\t\tforeach ( array_map( 'get_tag', $this->conf( $option_id ) ) as $curr_tag ) {\n\t\t\t\t\t\t$tag_names[] = $curr_tag->name;\n\t\t\t\t\t}\n\t\t\t\t\tif ( ! empty( $tag_names ) ) {\n\t\t\t\t\t\t$excludes_buf = implode( \"\\n\", $tag_names );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$this->build_textarea( $option_id, false, $excludes_buf );\n\t\t\t\t?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<b><?php echo esc_html__( 'All tags are cached by default.', 'litespeed-cache' ); ?><\/b>\n\t\t\t\t\t<?php printf( esc_html__( 'To prevent %s from being cached, enter them here.', 'litespeed-cache' ), esc_html__( 'tags', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<h4><?php echo esc_html__( 'NOTE', 'litespeed-cache' ); ?>:<\/h4>\n\t\t\t\t\t<ol>\n\t\t\t\t\t\t<li><?php echo esc_html__( 'If the tag slug is not found, the tag will be removed from the list on save.', 'litespeed-cache' ); ?><\/li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\tesc_html__( 'To exclude %1$s, insert %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<code>http:\/\/www.example.com\/tag\/category\/tag-slug\/<\/code>',\n\t\t\t\t\t\t\t'<code>tag-slug<\/code>'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t<\/ol>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<?php\n\t\tif ( ! $this->_is_multisite ) :\n\t\t\trequire LSCWP_DIR . 'tpl\/cache\/settings_inc.exclude_cookies.tpl.php';\n\t\t\trequire LSCWP_DIR . 'tpl\/cache\/settings_inc.exclude_useragent.tpl.php';\n\t\tendif;\n\t\t?>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_EXC_ROLES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php echo esc_html__( 'Selected roles will be excluded from cache.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-tick-list\">\n\t\t\t\t\t<?php foreach ( $roles as $curr_role => $curr_title ) : ?>\n\t\t\t\t\t\t<?php $this->build_checkbox( $option_id . '[]', esc_html( $curr_title ), Control::cls()->in_cache_exc_roles( $curr_role ), $curr_role ); ?>\n\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t<\/tbody>\n<\/table>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.login_cookie.tpl.php","ext":"php","size":3618,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Login Cookie and Vary Cookies Settings\n *\n * Displays the login cookie and vary cookies settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $option_id = Base::O_CACHE_LOGIN_COOKIE; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_input( $option_id ); ?>\n\t\t<?php $this->_validate_syntax( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php\n\t\t\tesc_html_e( 'SYNTAX: alphanumeric and \"_\". No spaces and case sensitive. MUST BE UNIQUE FROM OTHER WEB APPLICATIONS.', 'litespeed-cache' );\n\t\t\t?>\n\t\t\t<br \/>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: Default login cookie name *\/\n\t\t\t\tesc_html__( 'The default login cookie is %s.', 'litespeed-cache' ),\n\t\t\t\t'<code>_lscache_vary<\/code>'\n\t\t\t);\n\t\t\t?>\n\t\t\t<?php esc_html_e( 'The server will determine if the user is logged in based on the existence of this cookie.', 'litespeed-cache' ); ?>\n\t\t\t<?php esc_html_e( 'This setting is useful for those that have multiple web applications for the same domain.', 'litespeed-cache' ); ?>\n\t\t\t<?php esc_html_e( 'If every web application uses the same cookie, the server may confuse whether a user is logged in or not.', 'litespeed-cache' ); ?>\n\t\t\t<?php esc_html_e( 'The cookie set here will be used for this WordPress installation.', 'litespeed-cache' ); ?>\n\t\t\t<br \/>\n\t\t\t<?php esc_html_e( 'Example use case:', 'litespeed-cache' ); ?><br \/>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: Example domain *\/\n\t\t\t\tesc_html__( 'There is a WordPress installed for %s.', 'litespeed-cache' ),\n\t\t\t\t'<u>www.example.com<\/u>'\n\t\t\t);\n\t\t\t?>\n\t\t\t<br \/>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: Example subdomain *\/\n\t\t\t\tesc_html__( 'Then another WordPress is installed (NOT MULTISITE) at %s', 'litespeed-cache' ),\n\t\t\t\t'<u>www.example.com\/blog\/<\/u>'\n\t\t\t);\n\t\t\t?>\n\t\t\t<?php esc_html_e( 'The cache needs to distinguish who is logged into which WordPress site in order to cache correctly.', 'litespeed-cache' ); ?><br \/>\n\t\t\t<?php Doc::notice_htaccess(); ?>\n\t\t<\/div>\n\n\t\t<?php if ( preg_match( '#[^\\w\\-]#', $this->conf( $option_id ) ) ) : ?>\n\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t<p>\u274c <?php esc_html_e( 'Invalid login cookie. Invalid characters found.', 'litespeed-cache' ); ?><\/p>\n\t\t\t<\/div>\n\t\t<?php endif; ?>\n\n\t\t<?php\n\t\tif ( defined( 'LITESPEED_ON' ) && $this->conf( $option_id ) ) {\n\t\t\t$cookie_rule = '';\n\t\t\ttry {\n\t\t\t\t$cookie_rule = Htaccess::cls()->current_login_cookie();\n\t\t\t} catch ( \\Exception $e ) {\n\t\t\t\t?>\n\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t<p><?php echo esc_html( $e->getMessage() ); ?><\/p>\n\t\t\t\t<\/div>\n\t\t\t\t<?php\n\t\t\t}\n\n\t\t\t$cookie_arr = explode( ',', $cookie_rule );\n\t\t\tif ( ! in_array( $this->conf( $option_id ), $cookie_arr, true ) ) {\n\t\t\t\t?>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<p><?php esc_html_e( 'WARNING: The .htaccess login cookie and Database login cookie do not match.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t<\/div>\n\t\t\t\t<?php\n\t\t\t}\n\t\t}\n\t\t?>\n\t<\/td>\n<\/tr>\n\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $option_id = Base::O_CACHE_VARY_COOKIES; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_textarea( $option_id, 50 ); ?>\n\t\t<?php $this->_validate_syntax( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php esc_html_e( 'SYNTAX: alphanumeric and \"_\". No spaces and case sensitive.', 'litespeed-cache' ); ?>\n\t\t\t<br \/>\n\t\t\t<?php esc_html_e( 'You can list the 3rd party vary cookies here.', 'litespeed-cache' ); ?>\n\t\t\t<br \/>\n\t\t\t<?php Doc::notice_htaccess(); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.exclude_useragent.tpl.php","ext":"php","size":794,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Exclude User Agents Setting\n *\n * Displays the exclude user agents setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $option_id = Base::O_CACHE_EXC_USERAGENTS; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: \"user agents\" *\/\n\t\t\t\tesc_html__( 'To prevent %s from being cached, enter them here.', 'litespeed-cache' ),\n\t\t\t\tesc_html__( 'user agents', 'litespeed-cache' )\n\t\t\t);\n\t\t\t?>\n\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<?php $this->_validate_syntax( $option_id ); ?>\n\t\t\t<br \/><?php Doc::notice_htaccess(); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/network_settings-advanced.tpl.php","ext":"php","size":575,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Advanced Settings\n *\n * Displays the advanced settings section for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Advanced Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#advanced-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<?php require LSCWP_DIR . 'tpl\/cache\/settings_inc.login_cookie.tpl.php'; ?>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-purge.tpl.php","ext":"php","size":6518,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Purge Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Purge Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#purge-tab' ); ?>\n<\/h3>\n\n<?php\n$option_list = array(\n\tBase::O_PURGE_POST_ALL                     => esc_html__( 'All pages', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_FRONTPAGE               => esc_html__( 'Front page', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_HOMEPAGE                => esc_html__( 'Home page', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_PAGES                   => esc_html__( 'Pages', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_PAGES_WITH_RECENT_POSTS => esc_html__( 'All pages with Recent Posts Widget', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_AUTHOR                  => esc_html__( 'Author archive', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_POSTTYPE                => esc_html__( 'Post type archive', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_YEAR                    => esc_html__( 'Yearly archive', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_MONTH                   => esc_html__( 'Monthly archive', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_DATE                    => esc_html__( 'Daily archive', 'litespeed-cache' ),\n\tBase::O_PURGE_POST_TERM                    => esc_html__( 'Term archive (include category, tag, and tax)', 'litespeed-cache' ),\n);\n\n\/\/ break line at these ids\n$break_arr = array(\n\tBase::O_PURGE_POST_PAGES,\n\tBase::O_PURGE_POST_PAGES_WITH_RECENT_POSTS,\n\tBase::O_PURGE_POST_POSTTYPE,\n\tBase::O_PURGE_POST_DATE,\n);\n?>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\n\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t<?php require LSCWP_DIR . 'tpl\/cache\/settings_inc.purge_on_upgrade.tpl.php'; ?>\n\t<?php endif; ?>\n\n\t<tr>\n\t\t<th><?php esc_html_e( 'Auto Purge Rules For Publish\/Update', 'litespeed-cache' ); ?><\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Select \"All\" if there are dynamic widgets linked to posts on pages other than the front or home pages.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t<?php esc_html_e( 'Other checkboxes will be ignored.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t<?php esc_html_e( 'Select only the archive types that are currently used, the others can be left unchecked.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t<div class=\"litespeed-tick-wrapper\">\n\t\t\t\t\t<?php\n\t\t\t\t\tforeach ( $option_list as $option_id => $cur_title ) {\n\t\t\t\t\t\t$this->build_checkbox( $option_id, $cur_title );\n\t\t\t\t\t\tif ( in_array( $option_id, $break_arr, true ) ) {\n\t\t\t\t\t\t\techo '<\/div><div class=\"litespeed-tick-wrapper litespeed-top10\">';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Select which pages will be automatically purged when posts are published\/updated.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_PURGE_STALE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'If ON, the stale copy of a cached page will be shown to visitors until a new cache copy is available. Reduces the server load for following visits. If OFF, the page will be dynamically generated while visitors wait.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#serve-stale' ); ?>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'By design, this option may serve stale content. Do not enable this option, if that is not OK with you.', 'litespeed-cache' ); ?><br>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_PURGE_TIMED_URLS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id, 80 ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php printf( esc_html__( 'The URLs here (one per line) will be purged automatically at the time set in the option \"%s\".', 'litespeed-cache' ), esc_html__( 'Scheduled Purge Time', 'litespeed-cache' ) ); ?><br>\n\t\t\t\t<?php printf( esc_html__( 'Both %1$s and %2$s are acceptable.', 'litespeed-cache' ), '<code>http:\/\/www.example.com\/path\/url.php<\/code>', '<code>\/path\/url.php<\/code>' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php printf( esc_html__( 'Wildcard %1$s supported (match zero or more characters). For example, to match %2$s and %3$s, use %4$s.', 'litespeed-cache' ), '<code>*<\/code>', '<code>\/path\/u-1.html<\/code>', '<code>\/path\/u-2.html<\/code>', '<code>\/path\/u-*.html<\/code>' ); ?>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'For URLs with wildcards, there may be a delay in initiating scheduled purge.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#scheduled-purge-urls' ); ?>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_PURGE_TIMED_URLS_TIME; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, null, null, 'time' ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php printf( esc_html__( 'Specify the time to purge the \"%s\" list.', 'litespeed-cache' ), esc_html__( 'Scheduled Purge URLs', 'litespeed-cache' ) ); ?>\n\t\t\t\t<?php printf( esc_html__( 'Current server time is %s.', 'litespeed-cache' ), '<code>' . esc_html( gmdate( 'H:i:s', time() + LITESPEED_TIME_OFFSET ) ) . '<\/code>' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_PURGE_HOOK_ALL; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id, 50 ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'A Purge All will be executed when WordPress runs these hooks.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#purge-all-hooks' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.cache_mobile.tpl.php","ext":"php","size":2793,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Mobile View Settings\n *\n * Displays the mobile view cache settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $cid = Base::O_CACHE_MOBILE; ?>\n\t\t<?php $this->title( $cid ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_switch( $cid ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php esc_html_e( 'Serve a separate cache copy for mobile visitors.', 'litespeed-cache' ); ?>\n\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#cache-mobile', esc_html__( 'Learn more about when this is needed', 'litespeed-cache' ) ); ?>\n\t\t\t<br \/><?php Doc::notice_htaccess(); ?>\n\t\t\t<br \/><?php Doc::crawler_affected(); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>\n\n<tr>\n\t<th scope=\"row\" class=\"litespeed-padding-left\">\n\t\t<?php $cid = Base::O_CACHE_MOBILE_RULES; ?>\n\t\t<?php $this->title( $cid ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php\n\t\tif ( $this->conf( Base::O_CACHE_MOBILE ) ) {\n\t\t\tif ( defined( 'LITESPEED_ON' ) ) {\n\t\t\t\ttry {\n\t\t\t\t\t$mobile_agents = Htaccess::cls()->current_mobile_agents();\n\t\t\t\t\tif ( Utility::arr2regex( $this->conf( $cid ), true ) !== $mobile_agents ) {\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Htaccess did not match configuration option.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\/* translators: %s: Current mobile agents in htaccess *\/\n\t\t\t\t\t\t\t\t\tesc_html__( 'Htaccess rule is: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $mobile_agents ) . '<\/code>'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t}\n\t\t\t\t} catch ( \\Exception $e ) {\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t\t<p><?php echo wp_kses_post( $e->getMessage() ); ?><\/p>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t?>\n\n\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t<div>\n\t\t\t\t<?php $this->build_textarea( $cid, 40 ); ?>\n\t\t\t<\/div>\n\t\t\t<div>\n\t\t\t\t<?php $this->recommended( $cid ); ?>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<?php $this->_validate_syntax( $cid ); ?>\n\n\t\t\t<?php if ( $this->conf( Base::O_CACHE_MOBILE ) && ! $this->conf( $cid ) ) : ?>\n\t\t\t\t<span class=\"litespeed-warning\">\n\t\t\t\t\t\u274c\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %1$s: Cache Mobile label, %2$s: ON status, %3$s: List of Mobile User Agents label *\/\n\t\t\t\t\t\tesc_html__( 'If %1$s is %2$s, then %3$s must be populated!', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'Cache Mobile', 'litespeed-cache' ) . '<\/code>',\n\t\t\t\t\t\t'<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '<\/code>',\n\t\t\t\t\t\t'<code>' . esc_html__( 'List of Mobile User Agents', 'litespeed-cache' ) . '<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/span>\n\t\t\t<?php endif; ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.exclude_cookies.tpl.php","ext":"php","size":775,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Exclude Cookies Setting\n *\n * Displays the exclude cookies setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $option_id = Base::O_CACHE_EXC_COOKIES; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: \"cookies\" *\/\n\t\t\t\tesc_html__( 'To prevent %s from being cached, enter them here.', 'litespeed-cache' ),\n\t\t\t\tesc_html__( 'cookies', 'litespeed-cache' )\n\t\t\t);\n\t\t\t?>\n\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<?php $this->_validate_syntax( $option_id ); ?>\n\t\t\t<br \/><?php Doc::notice_htaccess(); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/network_settings-cache.tpl.php","ext":"php","size":1291,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Cache Settings\n *\n * Displays the network cache control settings section for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Cache Control Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th><?php esc_html_e( 'Network Enable Cache', 'litespeed-cache' ); ?><\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( Base::O_CACHE ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Enabling LiteSpeed Cache for WordPress here enables the cache for the network.', 'litespeed-cache' ); ?><br \/>\n\t\t\t\t\t<?php esc_html_e( 'It is STRONGLY recommended that the compatibility with other plugins on a single\/few sites is tested first.', 'litespeed-cache' ); ?><br \/>\n\t\t\t\t\t<?php esc_html_e( 'This is to ensure compatibility prior to enabling the cache for all sites.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<?php\n\t\trequire LSCWP_DIR . 'tpl\/cache\/settings_inc.cache_mobile.tpl.php';\n\t\trequire LSCWP_DIR . 'tpl\/cache\/settings_inc.cache_dropquery.tpl.php';\n\t\t?>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.browser.tpl.php","ext":"php","size":2347,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Browser Cache Settings\n *\n * Displays the browser cache settings section for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Browser Cache Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#browser-tab' ); ?>\n<\/h3>\n\n<?php if ( 'LITESPEED_SERVER_OLS' === LITESPEED_SERVER_TYPE ) : ?>\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?><\/h4>\n\t\t<p>\n\t\t\t<?php esc_html_e( 'OpenLiteSpeed users please check this', 'litespeed-cache' ); ?>:\n\t\t\t<?php Doc::learn_more( 'https:\/\/openlitespeed.org\/kb\/how-to-set-up-custom-headers\/', esc_html__( 'Setting Up Custom Headers', 'litespeed-cache' ) ); ?>\n\t\t<\/p>\n\t<\/div>\n<?php endif; ?>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_CACHE_BROWSER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( \"Browser caching stores static files locally in the user's browser. Turn on this setting to reduce repeated requests for static files.\", 'litespeed-cache' ); ?><br>\n\t\t\t\t\t<?php Doc::notice_htaccess(); ?><br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\t\t\tesc_html__( 'You can turn on browser caching in server admin too. %sLearn more about LiteSpeed browser cache settings%s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#how-to-set-it-up\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t\t\t'<\/a>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_CACHE_TTL_BROWSER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The amount of time, in seconds, that files will be stored in browser cache before expiring.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 30 ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/entry.tpl.php","ext":"php","size":2443,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Settings\n *\n * Displays the cache settings page with tabbed navigation for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'cache'    => __( 'Cache', 'litespeed-cache' ),\n\t'ttl'      => __( 'TTL', 'litespeed-cache' ),\n\t'purge'    => __( 'Purge', 'litespeed-cache' ),\n\t'excludes' => __( 'Excludes', 'litespeed-cache' ),\n\t'esi'      => __( 'ESI', 'litespeed-cache' ),\n);\n\nif ( ! $this->_is_multisite ) {\n\t$menu_list['object']  = __( 'Object', 'litespeed-cache' );\n\t$menu_list['browser'] = __( 'Browser', 'litespeed-cache' );\n}\n\n$menu_list['advanced'] = __( 'Advanced', 'litespeed-cache' );\n\n\/**\n * Generate roles for setting usage\n *\n * @since 1.6.2\n *\/\nglobal $wp_roles;\n$wp_orig_roles = $wp_roles;\nif ( ! isset( $wp_roles ) ) {\n\t$wp_orig_roles = new \\WP_Roles();\n}\n\n$roles = array();\nforeach ( $wp_orig_roles->roles as $k => $v ) {\n\t$roles[ $k ] = $v['name'];\n}\nksort( $roles );\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Settings', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php\n\t\t$i             = 1;\n\t\t$accesskey_set = array();\n\t\tforeach ( $menu_list as $k => $val ) {\n\t\t\t$accesskey = '';\n\t\t\tif ( $i <= 9 ) {\n\t\t\t\t$accesskey = $i;\n\t\t\t} else {\n\t\t\t\t$tmp = strtoupper( substr( $k, 0, 1 ) );\n\t\t\t\tif ( ! in_array( $tmp, $accesskey_set, true ) ) {\n\t\t\t\t\t$accesskey_set[] = $tmp;\n\t\t\t\t\t$accesskey       = esc_attr( $tmp );\n\t\t\t\t}\n\t\t\t}\n\t\t\tprintf('<a class=\"litespeed-tab nav-tab\" href=\"#%1$s\" data-litespeed-tab=\"%1$s\" litespeed-accesskey=\"%2$s\">%3$s<\/a>', esc_attr( $k ), esc_attr($accesskey), esc_html( $val ));\n\t\t\t++$i;\n\t\t}\n\t\tdo_action( 'litespeed_settings_tab', 'cache' );\n\t\t?>\n\t<\/h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php $this->cache_disabled_warning(); ?>\n\n\t\t<?php\n\t\t$this->form_action();\n\n\t\trequire LSCWP_DIR . 'tpl\/inc\/check_if_network_disable_all.php';\n\t\trequire LSCWP_DIR . 'tpl\/cache\/more_settings_tip.tpl.php';\n\n\t\tforeach ( $menu_list as $k => $val ) {\n\t\t\techo '<div data-litespeed-layout=\"' . esc_attr( $k ) . '\">';\n\t\t\trequire LSCWP_DIR . \"tpl\/cache\/settings-$k.tpl.php\";\n\t\t\techo '<\/div>';\n\t\t}\n\n\t\tdo_action( 'litespeed_settings_content', 'cache' );\n\n\t\t$this->form_end();\n\t\t?>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/network_settings-excludes.tpl.php","ext":"php","size":698,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Exclude Settings\n *\n * Displays the network exclude settings section for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Exclude Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#excludes-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<?php\n\t\t\/\/ Cookie\n\t\trequire LSCWP_DIR . 'tpl\/cache\/settings_inc.exclude_cookies.tpl.php';\n\n\t\t\/\/ User Agent\n\t\trequire LSCWP_DIR . 'tpl\/cache\/settings_inc.exclude_useragent.tpl.php';\n\t\t?>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/network_settings-purge.tpl.php","ext":"php","size":583,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Purge Settings\n *\n * Displays the network purge settings section for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Purge Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#purge-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<?php require LSCWP_DIR . 'tpl\/cache\/settings_inc.purge_on_upgrade.tpl.php'; ?>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.cache_dropquery.tpl.php","ext":"php","size":1116,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Drop Query Strings Setting\n *\n * Displays the drop query strings setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $option_id = Base::O_CACHE_DROP_QS; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: LiteSpeed Web Server version *\/\n\t\t\t\tesc_html__( 'Ignore certain query strings when caching. (LSWS %s required)', 'litespeed-cache' ),\n\t\t\t\t'v5.2.3+'\n\t\t\t);\n\t\t\t?>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %1$s: Example query string, %2$s: Example wildcard *\/\n\t\t\t\tesc_html__( 'For example, to drop parameters beginning with %1$s, %2$s can be used here.', 'litespeed-cache' ),\n\t\t\t\t'<code>utm<\/code>',\n\t\t\t\t'<code>utm*<\/code>'\n\t\t\t);\n\t\t\t?>\n\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#drop-query-string' ); ?>\n\t\t\t<br \/>\n\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<br \/>\n\t\t\t<?php Doc::notice_htaccess(); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.object.tpl.php","ext":"php","size":8521,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Object Cache Settings\n *\n * Displays the object cache settings section for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$lang_enabled  = '<span class=\"litespeed-success\">' . esc_html__( 'Enabled', 'litespeed-cache' ) . '<\/span>';\n$lang_disabled = '<span class=\"litespeed-warning\">' . esc_html__( 'Disabled', 'litespeed-cache' ) . '<\/span>';\n\n$mem_enabled   = class_exists( 'Memcached' ) ? $lang_enabled : $lang_disabled;\n$redis_enabled = class_exists( 'Redis' ) ? $lang_enabled : $lang_disabled;\n\n$mem_conn = $this->cls( 'Object_Cache' )->test_connection();\nif ( null === $mem_conn ) {\n\t$mem_conn_desc = '<span class=\"litespeed-desc\">' . esc_html__( 'Not Available', 'litespeed-cache' ) . '<\/span>';\n} elseif ( $mem_conn ) {\n\t$mem_conn_desc = '<span class=\"litespeed-success\">' . esc_html__( 'Passed', 'litespeed-cache' ) . '<\/span>';\n} else {\n\t$severity      = $this->conf( Base::O_OBJECT, true ) ? 'danger' : 'warning';\n\t$mem_conn_desc = '<span class=\"litespeed-' . esc_attr( $severity ) . '\">' . esc_html__( 'Failed', 'litespeed-cache' ) . '<\/span>';\n}\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Object Cache Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#object-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Use external object cache functionality.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/admin\/#memcached-lsmcd-and-redis-object-cache-support-in-lscwp' ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-block\">\n\t\t\t\t\t<div class=\"litespeed-col-auto\">\n\t\t\t\t\t\t<h4><?php esc_html_e( 'Status', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class=\"litespeed-col-auto\">\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\/* translators: %s: Object cache name *\/\n\t\t\t\t\t\t\tesc_html__( '%s Extension', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'Memcached'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t: <?php echo wp_kses_post( $mem_enabled ); ?><br>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\/* translators: %s: Object cache name *\/\n\t\t\t\t\t\t\tesc_html__( '%s Extension', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'Redis'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t: <?php echo wp_kses_post( $redis_enabled ); ?><br>\n\t\t\t\t\t\t<?php esc_html_e( 'Connection Test', 'litespeed-cache' ); ?>: <?php echo wp_kses_post( $mem_conn_desc ); ?>\n\t\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/admin\/#how-to-debug' ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_KIND; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( 'Memcached', 'Redis' ) ); ?>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_HOST; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %s: Object cache name *\/\n\t\t\t\t\t\tesc_html__( 'Your %s Hostname or IP address.', 'litespeed-cache' ),\n\t\t\t\t\t\t'Memcached\/<a href=\"https:\/\/docs.litespeedtech.com\/products\/lsmcd\/\" target=\"_blank\" rel=\"noopener\">LSMCD<\/a>\/Redis'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %1$s: Socket name, %2$s: Host field title, %3$s: Example socket path *\/\n\t\t\t\t\t\tesc_html__( 'If you are using a %1$s socket, %2$s should be set to %3$s', 'litespeed-cache' ),\n\t\t\t\t\t\t'UNIX',\n\t\t\t\t\t\tesc_html( Lang::title( $option_id ) ),\n\t\t\t\t\t\t'<code>\/path\/to\/memcached.sock<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_PORT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short2' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %1$s: Object cache name, %2$s: Port number *\/\n\t\t\t\t\t\tesc_html__( 'Default port for %1$s is %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'Memcached',\n\t\t\t\t\t\t'<code>11211<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %1$s: Object cache name, %2$s: Port number *\/\n\t\t\t\t\t\tesc_html__( 'Default port for %1$s is %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'Redis',\n\t\t\t\t\t\t'<code>6379<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %1$s: Socket name, %2$s: Port field title, %3$s: Port value *\/\n\t\t\t\t\t\tesc_html__( 'If you are using a %1$s socket, %2$s should be set to %3$s', 'litespeed-cache' ),\n\t\t\t\t\t\t'UNIX',\n\t\t\t\t\t\tesc_html( Lang::title( $option_id ) ),\n\t\t\t\t\t\t'<code>0<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_LIFE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short2' ); ?> <?php esc_html_e( 'seconds', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Default TTL for cached objects.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_USER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %s: SASL *\/\n\t\t\t\t\t\tesc_html__( 'Only available when %s is installed.', 'litespeed-cache' ),\n\t\t\t\t\t\t'SASL'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_PSWD; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the password used when connecting.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_DB_ID; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Database to be used', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_GLOBAL_GROUPS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id, 30 ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Groups cached at the network level.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_NON_PERSISTENT_GROUPS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id, 30 ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_PERSISTENT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Use keep-alive connections to speed up cache operations.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_ADMIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Improve wp-admin speed through caching. (May encounter expired data)', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_OBJECT_TRANSIENTS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %1$s: Object Cache Admin title, %2$s: OFF status *\/\n\t\t\t\t\t\tesc_html__( 'Save transients in database when %1$s is %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html( Lang::title( Base::O_OBJECT_ADMIN ) ) . '<\/code>',\n\t\t\t\t\t\t'<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#store-transients' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/entry_network.tpl.php","ext":"php","size":1400,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Cache Settings\n *\n * Displays the network cache settings page with tabbed navigation for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'cache'    => __( 'Cache', 'litespeed-cache' ),\n\t'purge'    => __( 'Purge', 'litespeed-cache' ),\n\t'excludes' => __( 'Excludes', 'litespeed-cache' ),\n\t'object'   => __( 'Object', 'litespeed-cache' ),\n\t'browser'  => __( 'Browser', 'litespeed-cache' ),\n\t'advanced' => __( 'Advanced', 'litespeed-cache' ),\n);\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Network Cache Settings', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t<\/h2>\n\t<div class=\"litespeed-body\">\n\t\t<?php $this->cache_disabled_warning(); ?>\n\n\t\t<?php\n\t\t$this->form_action( Router::ACTION_SAVE_SETTINGS_NETWORK );\n\n\t\tforeach ( $menu_list as $k => $val ) {\n\t\t\t$k_escaped = esc_attr( $k );\n\t\t\t?>\n\t\t\t<div data-litespeed-layout=\"<?php echo esc_html( $k_escaped ); ?>\">\n\t\t\t<?php\n\t\t\trequire LSCWP_DIR . \"tpl\/cache\/network_settings-$k.tpl.php\";\n\t\t\t?>\n\t\t\t<\/div>\n\t\t\t<?php\n\t\t}\n\n\t\t$this->form_end();\n\t\t?>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-advanced.tpl.php","ext":"php","size":2613,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * Advanced Settings Template\n *\n * @package     LiteSpeed\n * @since       1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Advanced Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( esc_url( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#advanced-tab' ) ); ?>\n<\/h3>\n\n<div class=\"litespeed-callout notice notice-warning inline\">\n\t<h4><?php esc_html_e( 'NOTICE:', 'litespeed-cache' ); ?><\/h4>\n\t<p><?php esc_html_e( 'These settings are meant for ADVANCED USERS ONLY.', 'litespeed-cache' ); ?><\/p>\n<\/div>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_CACHE_AJAX_TTL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 60 ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify an AJAX action in POST\/GET and the number of seconds to cache that request, separated by a space.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl\/cache\/settings_inc.login_cookie.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_UTIL_NO_HTTPS_VARY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Enable this option if you are using both HTTP and HTTPS in the same domain and are noticing cache irregularities.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( esc_url( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#improve-httphttps-compatibility' ) ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th scope=\"row\">\n\t\t\t\t<?php $option_id = Base::O_UTIL_INSTANT_CLICK; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'When a visitor hovers over a page link, preload that page. This will speed up the visit to that link.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( esc_url( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#instant-click' ) ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<span class=\"litespeed-danger\">\n\t\t\t\t\t\u26a0\ufe0f\n\t\t\t\t\t\t<?php esc_html_e( 'This will generate extra requests to the server, which will increase server load.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings_inc.purge_on_upgrade.tpl.php","ext":"php","size":637,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Purge on Upgrade Setting\n *\n * Displays the purge on upgrade setting for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<!-- build_setting_purge_on_upgrade -->\n<tr>\n\t<th scope=\"row\">\n\t\t<?php $option_id = Base::O_PURGE_ON_UPGRADE; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php esc_html_e( 'When enabled, the cache will automatically purge when any plugin, theme or the WordPress core is upgraded.', 'litespeed-cache' ); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-object.tpl.php","ext":"php","size":209,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Object Cache Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nrequire LSCWP_DIR . 'tpl\/cache\/settings_inc.object.tpl.php';\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/network_settings-object.tpl.php","ext":"php","size":290,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Object Settings\n *\n * Includes the network object cache settings template for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nrequire LSCWP_DIR . 'tpl\/cache\/settings_inc.object.tpl.php';\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-cache.tpl.php","ext":"php","size":5776,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Control Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Cache Control Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php if ( $this->_is_multisite ) : ?>\n\t\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), esc_html__( 'ON', 'litespeed-cache' ), esc_html__( 'Use Network Admin Setting', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\t\t\tesc_html__( 'Please visit the %sInformation%s page on how to test the cache.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/installation\/#testing\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t\t\t'<\/a>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<strong><?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>: <\/strong><?php esc_html_e( 'When disabling the cache, all cached entries for this site will be purged.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php if ( $this->_is_multisite ) : ?>\n\t\t\t\t\t\t<?php esc_html_e( 'The network admin setting can be overridden here.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_CACHE ) && $this->conf( Base::O_CDN_QUIC ) ) : ?>\n\t\t\t\t\t\t<span class=\"litespeed-success\"><?php esc_html_e( 'With QUIC.cloud CDN enabled, you may still be seeing cache headers from your local server.', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_PRIV; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Privately cache frontend pages for logged-in users. (LSWS %s required)', 'litespeed-cache' ), 'v5.2.1+' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_COMMENTER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Privately cache commenters that have pending comments. Disabling this option will serve non-cacheable pages to commenters. (LSWS %s required)', 'litespeed-cache' ), 'v5.2.1+' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_REST; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Cache requests made by WordPress REST API calls.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_PAGE_LOGIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Disabling this option may negatively affect performance.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl\/cache\/settings_inc.cache_mobile.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_PRIV_URI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'URI Paths containing these strings will NOT be cached as public.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_FORCE_URI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Paths containing these strings will be cached regardless of no-cacheable settings.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php esc_html_e( 'To define a custom TTL for a URI, add a space followed by the TTL value to the end of the URI.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'For example, %1$s defines a TTL of %2$s seconds for %3$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>\/mypath\/mypage 300<\/code>',\n\t\t\t\t\t\t300,\n\t\t\t\t\t\t'<code>\/mypath\/mypage<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CACHE_FORCE_PUB_URI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Paths containing these strings will be forced to public cached regardless of no-cacheable settings.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php esc_html_e( 'To define a custom TTL for a URI, add a space followed by the TTL value to the end of the URI.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'For example, %1$s defines a TTL of %2$s seconds for %3$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>\/mypath\/mypage 300<\/code>',\n\t\t\t\t\t\t300,\n\t\t\t\t\t\t'<code>\/mypath\/mypage<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<?php if ( ! $this->_is_multisite ) : ?>\n\t\t\t<?php require LSCWP_DIR . 'tpl\/cache\/settings_inc.cache_dropquery.tpl.php'; ?>\n\t\t<?php endif; ?>\n\n\t<\/tbody>\n<\/table>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cache\/settings-ttl.tpl.php","ext":"php","size":3443,"mtime":1756468862,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache TTL Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php echo esc_html__( 'TTL', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#ttl-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_TTL_PUB; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Specify how long, in seconds, public pages are cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 30 ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_TTL_PRIV; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Specify how long, in seconds, private pages are cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 60, 3600 ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_TTL_FRONTPAGE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Specify how long, in seconds, the front page is cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 30 ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_TTL_FEED; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Specify how long, in seconds, feeds are cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php echo esc_html__( 'If this is set to a number less than 30, feeds will not be cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_TTL_REST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Specify how long, in seconds, REST calls are cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php echo esc_html__( 'If this is set to a number less than 30, feeds will not be cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_CACHE_TTL_STATUS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id, 30 ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php echo esc_html__( 'Specify an HTTP status code and the number of seconds to cache that page, separated by a space.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/cloud_promo.tpl.php","ext":"php","size":3028,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * QUIC.cloud Promotion Banner\n *\n * Displays a promotional banner for QUIC.cloud services with a tweet option to earn credits.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n?>\n\n<div class=\"litespeed-wrap notice notice-success litespeed-banner-promo-qc\">\n\n\t<div class=\"litespeed-banner-promo-qc-content\">\n\n\t\t<div class=\"litespeed-banner-promo-qc-description\">\n\t\t\t<h2><?php esc_html_e( 'You just unlocked a promotion from QUIC.cloud!', 'litespeed-cache' ); ?><\/h2>\n\t\t\t<p>\n\t\t\t\t<?php\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Spread the love and earn %s credits to use in our QUIC.cloud online services.', 'litespeed-cache' ),\n\t\t\t\t\t'<strong>' . absint($this->_summary['promo'][0]['quota']) . '<\/strong>'\n\t\t\t\t);\n\t\t\t\t?>\n\t\t\t\t<\/p>\n\t\t\t<p>\n\t\t\t\t<a class=\"button button-primary\" href=\"<?php echo esc_url($this->_summary['promo'][0]['url']); ?>\" target=\"_blank\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Send to twitter to get %s bonus', 'litespeed-cache' ),\n\t\t\t\t\t\tabsint($this->_summary['promo'][0]['quota'])\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/a>\n\t\t\t\t<a href=\"https:\/\/www.quic.cloud\/faq\/#credit\" target=\"_blank\"><?php esc_html_e( 'Learn more', 'litespeed-cache' ); ?><\/a>\n\t\t\t<\/p>\n\t\t<\/div>\n\n\t\t<div class=\"litespeed-banner-promo-qc-preview\">\n\t\t\t<h4 class=\"litespeed-tweet-preview-title\"><?php esc_html_e( 'Tweet preview', 'litespeed-cache' ); ?><\/h4>\n\t\t\t<div class=\"litespeed-tweet-preview\">\n\n\t\t\t\t<div class=\"litespeed-tweet-img\"><img src=\"<?php echo esc_url($this->_summary['promo'][0]['image']); ?>\"><\/div>\n\n\t\t\t\t<div class=\"litespeed-tweet-preview-content\">\n\t\t\t\t\t<p class=\"litespeed-tweet-text\"><?php echo esc_html($this->_summary['promo'][0]['content']); ?><\/p>\n\n\t\t\t\t\t<div class=\"litespeed-tweet-cta\">\n\t\t\t\t\t\t<a href=\"<?php echo esc_url($this->_summary['promo'][0]['url']); ?>\" class=\"litespeed-tweet-btn\" target=\"_blank\"><svg version=\"1.1\" xmlns=\"http:\/\/www.w3.org\/2000\/svg\" xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 250 250\" xml:space=\"preserve\">\n\t\t\t\t\t\t\t\t<path class=\"st0\" d=\"M78.6,226.6c94.3,0,145.9-78.2,145.9-145.9c0-2.2,0-4.4-0.1-6.6c10-7.3,18.7-16.3,25.6-26.5\n\t\t\t\t\t\t\t\tc-9.4,4.1-19.3,6.9-29.5,8.1c10.7-6.4,18.7-16.5,22.5-28.4c-10.1,6-21.1,10.2-32.6,12.4c-19.4-20.7-51.9-21.7-72.6-2.2\n\t\t\t\t\t\t\t\tc-13.3,12.5-19,31.2-14.8,49C81.9,84.3,43.4,64.8,17.4,32.8c-13.6,23.4-6.7,53.4,15.9,68.5c-8.2-0.2-16.1-2.4-23.3-6.4\n\t\t\t\t\t\t\t\tc0,0.2,0,0.4,0,0.6c0,24.4,17.2,45.4,41.2,50.3c-7.6,2.1-15.5,2.4-23.2,0.9c6.7,20.9,26,35.2,47.9,35.6c-18.2,14.3-40.6,22-63.7,22\n\t\t\t\t\t\t\t\tc-4.1,0-8.2-0.3-12.2-0.7C23.5,218.6,50.7,226.6,78.6,226.6\" \/>\n\t\t\t\t\t\t\t<\/svg>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Tweet this', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t<\/div>\n\n\t\t<\/div>\n\t<\/div>\n\n\t<div>\n\t\t<?php $dismiss_url = Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_CLEAR_PROMO ); ?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice', 'litespeed-cache' ); ?>.<\/span>\n\t\t<a href=\"<?php echo esc_url($dismiss_url); ?>\" class=\"litespeed-notice-dismiss\">X<\/a>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/score.php","ext":"php","size":7371,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Performance Review Banner\n *\n * Displays a promotional banner showing page load time and PageSpeed score improvements.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$health_scores = Health::cls()->scores();\n\n\/\/ Exit if speed is not significantly improved or score is reduced.\nif ( $health_scores['speed_before'] <= $health_scores['speed_after'] * 2 || $health_scores['score_before'] >= $health_scores['score_after'] ) {\n\treturn;\n}\n\n\/\/ Banner can be shown now.\n$this->_promo_true = true;\n\nif ( $check_only ) {\n\treturn;\n}\n\n$ajax_url_promo = Utility::build_url(Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PROMO, true, null, array( 'promo_tag' => $promo_tag ), true);\n?>\n\n<div class=\"litespeed-wrap notice notice-info litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-logo\"><\/div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-banner-promo-content\"><?php esc_html_e( 'Thank You for Using the LiteSpeed Cache Plugin!', 'litespeed-cache' ); ?><\/h3>\n\n\t\t<div class=\"litespeed-row-flex litespeed-banner-promo-content litespeed-margin-left-remove litespeed-flex-wrap\">\n\t\t\t<div class=\"litespeed-right50 litespeed-margin-bottom20\">\n\t\t\t\t<h2 class=\"litespeed-text-grey litespeed-margin-bottom-remove litespeed-top10\"><?php esc_html_e( 'Page Load Time', 'litespeed-cache' ); ?><\/h2>\n\t\t\t\t<hr class=\"litespeed-margin-bottom-remove\" \/>\n\t\t\t\t<div class=\"litespeed-row-flex\" style=\"margin-left: -10px;\">\n\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\"><?php esc_html_e( 'Before', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-text-grey\">\n\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_before'] ); ?><span class=\"litespeed-text-large\">s<\/span>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\"><?php esc_html_e( 'After', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_after'] ); ?><span class=\"litespeed-text-large\">s<\/span>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-text-fern\">\n\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_improved'] ); ?><span class=\"litespeed-text-large\">%<\/span>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<?php if ( $health_scores['score_before'] < $health_scores['score_after'] ) : ?>\n\t\t\t\t<div class=\"litespeed-margin-bottom20\">\n\t\t\t\t\t<h2 class=\"litespeed-text-grey litespeed-margin-bottom-remove litespeed-top10\"><?php esc_html_e( 'PageSpeed Score', 'litespeed-cache' ); ?><\/h2>\n\t\t\t\t\t<hr class=\"litespeed-margin-bottom-remove\" \/>\n\t\t\t\t\t<div class=\"litespeed-row-flex\" style=\"margin-left: -10px;\">\n\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center litespeed-margin-y-remove\"><?php esc_html_e( 'Before', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\" style=\"margin-top: -5px;\">\n\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( esc_html( $health_scores['score_before'] ), 45, false, true, 'litespeed-pie-' . esc_attr( $this->get_cls_of_pagescore( $health_scores['score_before'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center litespeed-margin-y-remove\"><?php esc_html_e( 'After', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\" style=\"margin-top: -5px;\">\n\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( esc_html( $health_scores['score_after'] ), 45, false, true, 'litespeed-pie-' . esc_attr( $this->get_cls_of_pagescore( $health_scores['score_after'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-margin-y-remove\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class=\"litespeed-top10 litespeed-text-jumbo litespeed-text-fern\">\n\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['score_improved'] ); ?><span class=\"litespeed-text-large\">%<\/span>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<?php endif; ?>\n\t\t<\/div>\n\n\t\t<div class=\"litespeed-row-flex litespeed-flex-wrap litespeed-margin-y5\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<a href=\"https:\/\/wordpress.org\/support\/plugin\/litespeed-cache\/reviews\/?filter=5#new-post\" target=\"_blank\" rel=\"noopener\" style=\"text-decoration: none;\">\n\t\t\t\t\t<button class=\"button litespeed-btn-success litespeed-btn-mini\">\n\t\t\t\t\t\t<?php esc_html_e( \"Sure I'd love to review!\", 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\u2b50\u2b50\u2b50\u2b50\u2b50\n\t\t\t\t\t<\/button>\n\t\t\t\t<\/a>\n\t\t\t\t<button type=\"button\" class=\"button litespeed-btn-primary litespeed-btn-mini\" id=\"litespeed-promo-done\"><?php esc_html_e( \"I've already left a review\", 'litespeed-cache' ); ?><\/button>\n\t\t\t\t<button type=\"button\" class=\"button litespeed-btn-warning litespeed-btn-mini\" id=\"litespeed-promo-later\"><?php esc_html_e( 'Maybe later', 'litespeed-cache' ); ?><\/button>\n\t\t\t<\/div>\n\t\t\t<div>\n\t\t\t\t<p class=\"litespeed-text-small\">\n\t\t\t\t\t<?php esc_html_e( 'Created with \u2764\ufe0f by LiteSpeed team.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<a href=\"https:\/\/wordpress.org\/support\/plugin\/litespeed-cache\" target=\"_blank\" rel=\"noopener\"><?php esc_html_e( 'Support forum', 'litespeed-cache' ); ?><\/a> | <a href=\"https:\/\/www.litespeedtech.com\/support\" target=\"_blank\" rel=\"noopener\"><?php esc_html_e( 'Submit a ticket', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\n\t<div>\n\t\t<?php\n\t\t$dismiss_url = Utility::build_url(\n\t\t\tCore::ACTION_DISMISS,\n\t\t\tGUI::TYPE_DISMISS_PROMO,\n\t\t\tfalse,\n\t\t\tnull,\n\t\t\tarray(\n\t\t\t\t'promo_tag' => 'score',\n\t\t\t\t'later'     => 1,\n\t\t\t)\n\t\t);\n\t\t?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice.', 'litespeed-cache' ); ?><\/span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\"><?php esc_html_e( 'Dismiss', 'litespeed-cache' ); ?><\/a>\n\t<\/div>\n<\/div>\n\n<script>\n(function ($) {\n\tjQuery(document).ready(function () {\n\t\t\/** Promo banner **\/\n\t\t$('#litespeed-promo-done').on('click', function (event) {\n\t\t\t$('.litespeed-banner-promo-full').slideUp();\n\t\t\t$.get('<?php echo $ajax_url_promo;\/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>&done=1');\n\t\t});\n\t\t$('#litespeed-promo-later').on('click', function (event) {\n\t\t\t$('.litespeed-banner-promo-full').slideUp();\n\t\t\t$.get('<?php echo $ajax_url_promo;\/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>');\n\t\t});\n\t});\n})(jQuery);\n<\/script>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/cloud_news.tpl.php","ext":"php","size":2178,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Promotion Banner\n *\n * Displays a promotional banner with news and installation options.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<div class=\"litespeed-wrap notice notice-success litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-top15\"><?php echo wp_kses_post( $this->_summary['news.title'] ); ?><\/h3>\n\t\t<div class=\"litespeed-banner-description\" style=\"flex-direction: column;\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php echo wp_kses_post( $this->_summary['news.content'] ); ?>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-inline\">\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15 litespeed-margin-bottom10\">\n\t\t\t\t\t<?php if ( ! empty( $this->_summary['news.plugin'] ) ) : ?>\n\t\t\t\t\t\t<?php $install_link = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_INSTALL_3RD, false, null, array( 'plugin' => $this->_summary['news.plugin'] ) ); ?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( $install_link ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Install', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tif ( ! empty( $this->_summary['news.plugin_name'] ) ) {\n\t\t\t\t\t\t\t\techo esc_html( $this->_summary['news.plugin_name'] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( ! empty( $this->_summary['news.zip'] ) ) : ?>\n\t\t\t\t\t\t<?php $install_link = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_INSTALL_ZIP ); ?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( $install_link ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Install', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\n\t<div>\n\t\t<?php $dismiss_url = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_DISMISS_RECOMMENDED ); ?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice', 'litespeed-cache' ); ?><\/span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\">X<\/a>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/slack.php","ext":"php","size":2146,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Slack Community Banner\n *\n * Displays a promotional banner inviting users to join the LiteSpeed Slack community.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<div class=\"litespeed-wrap notice notice-info litespeed-banner-promo-full\" id=\"litespeed-banner-promo-slack\">\n\t<div class=\"litespeed-banner-promo-logo\"><\/div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title\"><?php esc_html_e( 'Welcome to LiteSpeed', 'litespeed-cache' ); ?><\/h3>\n\t\t<div class=\"litespeed-banner-description\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php esc_html_e( 'Want to connect with other LiteSpeed users?', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t\/* translators: %s: Link to LiteSpeed Slack community *\/\n\t\t\t\t\t\tesc_html__( 'Join the %s community.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<a href=\"https:\/\/join.slack.com\/t\/golitespeed\/shared_invite\/enQtMzE5ODgxMTUyNTgzLTNiNWQ1MWZlYmI4YjEzNTM4NjdiODY2YTQ0OWVlMzBlNGZkY2E3Y2E4MjIzNmNmZmU0ZjIyNWM1ZmNmMWRlOTk\" target=\"_blank\" class=\"litespeed-banner-promo-slack-textlink\" rel=\"noopener\">LiteSpeed Slack<\/a>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/p>\n\t\t\t\t<p class=\"litespeed-banner-promo-slack-line2\">\n\t\t\t\t\tgolitespeed.slack.com\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t\t<div>\n\t\t\t\t<h3 class=\"litespeed-banner-button-link\">\n\t\t\t\t\t<a href=\"https:\/\/join.slack.com\/t\/golitespeed\/shared_invite\/enQtMzE5ODgxMTUyNTgzLTNiNWQ1MWZlYmI4YjEzNTM4NjdiODY2YTQ0OWVlMzBlNGZkY2E3Y2E4MjIzNmNmZmU0ZjIyNWM1ZmNmMWRlOTk\" target=\"_blank\" rel=\"noopener\">\n\t\t\t\t\t\t<?php esc_html_e( 'Join Us on Slack', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/h3>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\t<div>\n\t\t<?php $dismiss_url = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PROMO, false, null, array( 'promo_tag' => 'slack' ) ); ?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice.', 'litespeed-cache' ); ?><\/span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\"><?php esc_html_e( 'Dismiss', 'litespeed-cache' ); ?><\/a>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/ajax.php","ext":"php","size":617,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * Health Check Script\n *\n * Triggers a health check request for speed when the document is loaded.\n *\n * @package LiteSpeed\n * @since 1.0.0\n * @deprecated 3.3 Will only show banner after user manually checked score\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$url = Utility::build_url( Router::ACTION_HEALTH, Health::TYPE_SPEED, true, null, array(), true );\n?>\n<script>\ndocument.addEventListener('DOMContentLoaded', function() {\n\tjQuery(document).ready( function() {\n\t\t\tjQuery.get( '<?php echo $url; \/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>' ) ;\n\t\t} ) ;\n});\n<\/script>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/new_version_dev.tpl.php","ext":"php","size":1584,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Developer Version Banner\n *\n * Displays a promotional banner for a new developer version of LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<div class=\"litespeed-wrap notice notice-warning litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-logo\"><\/div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-top15\">\n\t\t\t<?php esc_html_e( 'LiteSpeed Cache', 'litespeed-cache' ); ?>:\n\t\t\t<?php esc_html_e( 'New Developer Version Available!', 'litespeed-cache' ); ?>\n\t\t<\/h3>\n\t\t<div class=\"litespeed-banner-description\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php\n\t\t\t\t\t\/* translators: %s: Developer version number *\/\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'New developer version %s is available now.', 'litespeed-cache' ),\n\t\t\t\t\t\t'v' . esc_html( $this->_summary['version.dev'] )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-row-flex litespeed-banner-description\">\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php $url = Utility::build_url( Router::ACTION_DEBUG2, Debug2::TYPE_BETA_TEST, false, null, array( Debug2::BETA_TEST_URL => 'dev' ) ); ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-success litespeed-btn-mini\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-image-rotate\"><\/span>\n\t\t\t\t\t\t<?php esc_html_e( 'Upgrade', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/banner\/new_version.php","ext":"php","size":3899,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache New Version Banner\n *\n * Displays a promotional banner for a new version of LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n * @note Only shown for single site installations.\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n\/\/ Exit if multisite or auto-upgrade is enabled.\nif ( is_multisite() || $this->conf( Base::O_AUTO_UPGRADE ) ) {\n\treturn;\n}\n\n$current = get_site_transient( 'update_plugins' );\nif ( ! isset( $current->response[ Core::PLUGIN_FILE ] ) ) {\n\treturn;\n}\n\n\/\/ Check for new version every 12 hours.\n$last_check = empty( $this->_summary['new_version.last_check'] ) ? 0 : $this->_summary['new_version.last_check'];\nif ( time() - $last_check > 43200 ) {\n\tGUI::save_summary( array( 'new_version.last_check' => time() ) );\n\n\t\/\/ Detect version\n\t$auto_v = Cloud::version_check( 'new_version_banner' );\n\tif ( ! empty( $auto_v['latest'] ) ) {\n\t\tGUI::save_summary( array( 'new_version.v' => $auto_v['latest'] ) );\n\t}\n\t\/\/ After detect, don't show, just return and show next time\n\treturn;\n}\n\nif ( ! isset( $this->_summary['new_version.v'] ) || version_compare( Core::VER, $this->_summary['new_version.v'], '>=' ) ) {\n\treturn;\n}\n\n\/\/ Banner can be shown now.\n$this->_promo_true = true;\n\nif ( $check_only ) {\n\treturn;\n}\n?>\n\n<div class=\"litespeed-wrap notice notice-success litespeed-banner-promo-full\">\n\t<div class=\"litespeed-banner-promo-logo\"><\/div>\n\n\t<div class=\"litespeed-banner-promo-content\">\n\t\t<h3 class=\"litespeed-banner-title litespeed-top15\">\n\t\t\t<?php esc_html_e( 'LiteSpeed Cache', 'litespeed-cache' ); ?>:\n\t\t\t<?php esc_html_e( 'New Version Available!', 'litespeed-cache' ); ?>\n\t\t<\/h3>\n\t\t<div class=\"litespeed-banner-description\">\n\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t<p class=\"litespeed-banner-description-content\">\n\t\t\t\t\t<?php\n\t\t\t\t\t\/* translators: %s: New version number *\/\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'New release %s is available now.', 'litespeed-cache' ),\n\t\t\t\t\t\t'v' . esc_html( $this->_summary['new_version.v'] )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t\t<div class=\"litespeed-row-flex litespeed-banner-description\">\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php $url = Utility::build_url( Router::ACTION_ACTIVATION, Activation::TYPE_UPGRADE ); ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-success litespeed-btn-mini\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-image-rotate\"><\/span>\n\t\t\t\t\t\t<?php esc_html_e( 'Upgrade', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php\n\t\t\t\t\t$cfg = array( Conf::TYPE_SET . '[' . Base::O_AUTO_UPGRADE . ']' => 1 );\n\t\t\t\t\t$url = Utility::build_url( Router::ACTION_CONF, Conf::TYPE_SET, false, null, $cfg );\n\t\t\t\t\t?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-primary litespeed-btn-mini\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span>\n\t\t\t\t\t\t<?php esc_html_e( 'Turn On Auto Upgrade', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-banner-description-padding-right-15\">\n\t\t\t\t\t<?php $url = Utility::build_url( Core::ACTION_DISMISS, GUI::TYPE_DISMISS_PROMO, false, null, array( 'promo_tag' => 'new_version' ) ); ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( $url ); ?>\" class=\"button litespeed-btn-warning litespeed-btn-mini\">\n\t\t\t\t\t\t<?php esc_html_e( 'Maybe Later', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\n\t<div>\n\t\t<?php\n\t\t$dismiss_url = Utility::build_url(\n\t\t\tCore::ACTION_DISMISS,\n\t\t\tGUI::TYPE_DISMISS_PROMO,\n\t\t\tfalse,\n\t\t\tnull,\n\t\t\tarray(\n\t\t\t\t'promo_tag' => 'new_version',\n\t\t\t\t'later'     => 1,\n\t\t\t)\n\t\t);\n\t\t?>\n\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Dismiss this notice.', 'litespeed-cache' ); ?><\/span>\n\t\t<a href=\"<?php echo esc_url( $dismiss_url ); ?>\" class=\"litespeed-notice-dismiss\"><?php esc_html_e( 'Dismiss', 'litespeed-cache' ); ?><\/a>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/metabox.php","ext":"php","size":1618,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Post Meta Settings\n *\n * Renders the post meta settings interface for LiteSpeed Cache, allowing configuration of post-specific options.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nwp_nonce_field( self::POST_NONCE_ACTION, Router::NONCE );\n\n$pid = get_the_ID();\n\nforeach ( $this->_postmeta_settings as $key => $label ) {\n\t$existing_val = get_post_meta( $pid, $key, true );\n\n\tif ( in_array( $key, array( 'litespeed_vpi_list', 'litespeed_vpi_list_mobile' ), true ) ) {\n\t\tif ( is_array( $existing_val ) ) {\n\t\t\t$existing_val = implode( PHP_EOL, $existing_val );\n\t\t}\n\t\t?>\n\t\t<div style=\"margin-bottom:10px;\">\n\t\t\t<label for=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\"><?php echo esc_html( $label ); ?><\/label>\n\t\t\t<textarea style=\"width:100%\" rows=\"5\" id=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\" name=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\"><?php echo esc_textarea( $existing_val ); ?><\/textarea>\n\t\t<\/div>\n\t\t<?php\n\t} else {\n\t\t?>\n\t\t<div style=\"display:flex;margin-bottom:10px;align-items: center;gap: 2ch;justify-content: space-between;\">\n\t\t\t<label for=\"<?php echo esc_attr( $key ); ?>\"><?php echo esc_html( $label ); ?><\/label>\n\t\t\t<input class=\"litespeed-tiny-toggle\" id=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\" name=\"<?php echo esc_attr( Str::trim_quotes( $key ) ); ?>\" type=\"checkbox\" value=\"1\" <?php echo $existing_val ? 'checked' : ''; ?> \/>\n\t\t<\/div>\n\t\t<?php\n\t}\n}\n?>\n\n<div style=\"text-align:right;\">\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/metabox\/' ); ?>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/check_cache_disabled.php","ext":"php","size":2051,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Warning Notice\n *\n * Displays warnings if LiteSpeed Cache functionality is unavailable due to server or plugin configuration issues.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$reasons = array();\n\nif ( ! defined( 'LITESPEED_ALLOWED' ) ) {\n    if ( defined( 'LITESPEED_SERVER_TYPE' ) && LITESPEED_SERVER_TYPE === 'NONE' ) {\n        $reasons[] = array(\n            'title' => esc_html__( 'To use the caching functions you must have a LiteSpeed web server or be using QUIC.cloud CDN.', 'litespeed-cache' ),\n            'link'  => 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/faq\/#why-do-the-cache-features-require-a-litespeed-server',\n        );\n    } else {\n        $reasons[] = array(\n            'title' => esc_html__( 'Please enable the LSCache Module at the server level, or ask your hosting provider.', 'litespeed-cache' ),\n            'link'  => 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/#server-level-prerequisites',\n        );\n    }\n} elseif ( ! defined( 'LITESPEED_ON' ) ) {\n    $reasons[] = array(\n        'title' => esc_html__( 'Please enable LiteSpeed Cache in the plugin settings.', 'litespeed-cache' ),\n        'link'  => 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cache\/#enable-cache',\n    );\n}\n\nif ( $reasons ) : ?>\n    <div class=\"litespeed-callout notice notice-error inline\">\n        <h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n        <p>\n            <?php esc_html_e( 'LSCache caching functions on this page are currently unavailable!', 'litespeed-cache' ); ?>\n        <\/p>\n        <ul class=\"litespeed-list\">\n            <?php foreach ( $reasons as $reason ) : ?>\n                <li>\n                    <?php echo esc_html( $reason['title'] ); ?>\n                    <a href=\"<?php echo esc_url( $reason['link'] ); ?>\" target=\"_blank\" class=\"litespeed-learn-more\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a>\n                <\/li>\n            <?php endforeach; ?>\n        <\/ul>\n    <\/div>\n<?php endif; ?>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/show_display_installed.php","ext":"php","size":1709,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Installation Notice\n *\n * Displays a notice informing users that the LiteSpeed Cache plugin was installed by the server admin.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$buf  = sprintf(\n\t'<h3>%s<\/h3>\n\t<p>%s<\/p>\n\t<p>%s<\/p>\n\t<p>%s<\/p>\n\t<p>%s<\/p>\n\t<p>%s<\/p>\n\t<ul>\n\t\t<li>%s<\/li>\n\t\t<li>%s<\/li>\n\t<\/ul>',\n\tesc_html__( 'LiteSpeed Cache plugin is installed!', 'litespeed-cache' ),\n\tesc_html__( 'This message indicates that the plugin was installed by the server admin.', 'litespeed-cache' ),\n\tesc_html__( 'The LiteSpeed Cache plugin is used to cache pages - a simple way to improve the performance of the site.', 'litespeed-cache' ),\n\tesc_html__( 'However, there is no way of knowing all the possible customizations that were implemented.', 'litespeed-cache' ),\n\tesc_html__( 'For that reason, please test the site to make sure everything still functions properly.', 'litespeed-cache' ),\n\tesc_html__( 'Examples of test cases include:', 'litespeed-cache' ),\n\tesc_html__( 'Visit the site while logged out.', 'litespeed-cache' ),\n\tesc_html__( 'Create a post, make sure the front page is accurate.', 'litespeed-cache' )\n);\n$buf .= sprintf(\n\t\/* translators: %s: Link tags *\/\n\tesc_html__( 'If there are any questions, the team is always happy to answer any questions on the %ssupport forum%s.', 'litespeed-cache' ),\n\t'<a href=\"https:\/\/wordpress.org\/support\/plugin\/litespeed-cache\" rel=\"noopener noreferrer\" target=\"_blank\">',\n\t'<\/a>'\n);\n$buf .= '<p>' . esc_html__( 'If you would rather not move at litespeed, you can deactivate this plugin.', 'litespeed-cache' ) . '<\/p>';\n\nself::add_notice( self::NOTICE_BLUE . ' lscwp-whm-notice', $buf );\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/show_rule_conflict.php","ext":"php","size":935,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Unexpected Cache Rule Notice\n *\n * Displays a warning notice about conflicting cache rules in .htaccess that may cause stale content.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\n$err = sprintf(\n\tesc_html__(\n\t\t'Unexpected cache rule %2$s found in %1$s file. This rule may cause visitors to see old versions of pages due to the browser caching HTML pages. If you are sure that HTML pages are not being browser cached, this message can be dismissed. (%3$sLearn More%4$s)',\n\t\t'litespeed-cache'\n\t),\n\t'.htaccess',\n\t'<code>ExpiresDefault<\/code>',\n\t'<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/troubleshoot\/#browser-displays-stale-content\" target=\"_blank\">',\n\t'<\/a>'\n);\n\n\/\/ Other plugin left cache expired rules in .htaccess which will cause conflicts\necho wp_kses_post( self::build_notice(self::NOTICE_YELLOW . ' lscwp-notice-ruleconflict', $err) );\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/in_upgrading.php","ext":"php","size":528,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Upgrade Notice\n *\n * Displays a notice informing the user that the LiteSpeed Cache plugin has been upgraded and a page refresh is needed to complete the configuration data upgrade.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$message = esc_html__( 'LiteSpeed cache plugin upgraded. Please refresh the page to complete the configuration data upgrade.', 'litespeed-cache' );\n\necho wp_kses_post( self::build_notice( self::NOTICE_BLUE, $message ) );\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/modal.deactivation.php","ext":"php","size":5927,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Deactivation Modal\n *\n * Renders the deactivation modal interface for LiteSpeed Cache, allowing users to send reason of deactivation.\n *\n * @package LiteSpeed\n * @since 7.3\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n\/\/ Modal data\n$_title = esc_html__('Deactivate LiteSpeed Cache', 'litespeed');\n$_id    = 'litespeed-modal-deactivate';\n\n$reasons = array(\n\tarray(\n\t\t'value' => 'Temporary',\n\t\t'text' => esc_html__('The deactivation is temporary', 'litespeed-cache'),\n\t\t'id' => 'temp',\n\t\t'selected' => true,\n\t),\n\tarray(\n\t\t'value' => 'Performance worse',\n\t\t'text' => esc_html__('Site performance is worse', 'litespeed-cache'),\n\t\t'id' => 'performance',\n\t),\n\tarray(\n\t\t'value' => 'Plugin complicated',\n\t\t'text' => esc_html__('Plugin is too complicated', 'litespeed-cache'),\n\t\t'id' => 'complicated',\n\t),\n\tarray(\n\t\t'value' => 'Other',\n\t\t'text' => esc_html__('Other', 'litespeed-cache'),\n\t\t'id' => 'other',\n\t),\n);\n?>\n<div style=\"display: none\">\n    <div id=\"litespeed-deactivation\" class=\"iziModal\">\n        <div id=\"litespeed-modal-deactivate\">\n            <form id=\"litespeed-deactivation-form\" method=\"post\">\n                <p><?php esc_attr_e('Why are you deactivating the plugin?', 'litespeed-cache'); ?><\/p>\n                <div class=\"deactivate-reason-wrapper\">\n                    <?php foreach ($reasons as $reason) : ?>\n                    <label for=\"litespeed-deactivate-reason-<?php esc_attr_e( $reason['id'] ); ?>\">\n                        <input type=\"radio\" id=\"litespeed-deactivate-reason-<?php esc_attr_e( $reason['id'] ); ?>\" value=\"<?php esc_attr_e( $reason['value'] ); ?>\"\n                            <?php isset($reason['selected']) && $reason['selected'] ? ' checked=\"checked\"' : ''; ?> name=\"litespeed-reason\" \/>\n                        <?php esc_html_e( $reason['text'] ); ?>\n                    <\/label>\n                    <?php endforeach; ?>\n                <\/div>\n                <div class=\"deactivate-clear-settings-wrapper\">\n                    <i style=\"font-size: 0.9em;\">\n                        <?php\n                            esc_html_e('On uninstall, all plugin settings will be deleted.', 'litespeed-cache');\n                        ?>\n                    <\/i>\n                    <br \/>\n                    <i style=\"font-size: 0.9em;\">\n\n                        <?php\n                            printf(\n                                esc_html__('If you have used Image Optimization, please %sDestroy All Optimization Data%s first. NOTE: this does not remove your optimized images.', 'litespeed-cache'),\n                                '<a href=\"admin.php?page=litespeed-img_optm#litespeed-imageopt-destroy\" target=\"_blank\">',\n                                '<\/a>'\n                            );\n                        ?>\n                    <\/i>\n                <\/div>\n                <div class=\"deactivate-actions\">\n                    <input type=\"submit\" id=\"litespeed-deactivation-form-submit\" class=\"button button-primary\" value=\"<?php esc_attr_e('Deactivate', 'litespeed-cache'); ?>\" title=\"<?php esc_attr_e('Deactivate plugin', 'litespeed-cache'); ?>\" \/>\n                    <input type=\"button\" id=\"litespeed-deactivation-form-cancel\" class=\"button litespeed-btn-warning\" value=\"<?php esc_attr_e('Cancel', 'litespeed-cache'); ?>\" title=\"<?php esc_attr_e('Close popup', 'litespeed-cache'); ?>\" \/>\n                <\/div>\n            <\/form>\n        <\/div>\n    <\/div>\n<\/div>\n<script>\n    (function ($) {\n    'use strict';\n        jQuery(document).ready(function () {\n            var lscId = '<?php echo home_url(); \/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>';\n            var modalesc_attr_element = $('#litespeed-deactivation');\n            var deactivateesc_attr_element = $('#deactivate-litespeed-cache');\n\n            if (deactivateesc_attr_element.length > 0 && modalesc_attr_element.length > 0) {\n                \/\/ Variables\n                var modal_formElement = $('#litespeed-deactivation-form');\n\n                deactivateesc_attr_element.on('click', function (e) {\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                    modal_formElement.attr('action', decodeURI($(this).attr('href')));\n                    modalesc_attr_element.iziModal({\n                        radius: '.5rem',\n                        width: 550,\n                        autoOpen: true,\n                    });\n                });\n\n                $(document).on('submit', '#litespeed-deactivation-form', function (e) {\n                    e.preventDefault();\n                    $('#litespeed-deactivation-form-submit').attr('disabled', true);\n                    var container = $('#litespeed-deactivation-form');\n\n                    \/\/ Save selected data\n                    var data = {\n                        id: lscId,\n                        siteLink: window.location.hostname,\n                        reason: $(container).find('[name=litespeed-reason]:checked').val()\n                    };\n\n                    $.ajax({\n                        url: 'https:\/\/wpapi.quic.cloud\/survey',\n                        dataType: 'json',\n                        method: 'POST',\n                        cache: false,\n                        data: data,\n                        success: function (data) {\n                            console.log('QC data sent.');\n                        },\n                        error: function (xhr, error) {\n                            console.log('Error sending data to QC.');\n                        },\n                    });\n\n                    $('#litespeed-deactivation-form')[0].submit();\n                });\n                $(document).on('click', '#litespeed-deactivation-form-cancel', function (e) {\n                    modalesc_attr_element.iziModal('close');\n                });\n            }\n        });\n    })(jQuery);\n<\/script>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/admin_footer.php","ext":"php","size":1792,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Admin Footer\n *\n * Customizes the admin footer text for LiteSpeed Cache with links to rate, documentation, support forum, and community.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$stars = '<span class=\"wporg-ratings rating-stars\"><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"><\/span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"><\/span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"><\/span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"><\/span><span class=\"dashicons dashicons-star-filled\" style=\"color:#ffb900 !important;\"><\/span><\/span>';\n\n$rate_us = '<a href=\"https:\/\/wordpress.org\/support\/plugin\/litespeed-cache\/reviews\/?filter=5#new-post\" rel=\"noopener noreferrer\" target=\"_blank\">' . sprintf( esc_html__( 'Rate %1$s on %2$s', 'litespeed-cache' ), '<strong>' . esc_html__( 'LiteSpeed Cache', 'litespeed-cache' ) . $stars . '<\/strong>', 'WordPress.org' ) . '<\/a>';\n\n$wiki = '<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/\" target=\"_blank\">' . esc_html__( 'Read LiteSpeed Documentation', 'litespeed-cache' ) . '<\/a>';\n\n$forum = '<a href=\"https:\/\/wordpress.org\/support\/plugin\/litespeed-cache\" target=\"_blank\">' . esc_html__( 'Visit LSCWP support forum', 'litespeed-cache' ) . '<\/a>';\n\n$community = '<a href=\"https:\/\/litespeedtech.com\/slack\" target=\"_blank\">' . esc_html__( 'Join LiteSpeed Slack community', 'litespeed-cache' ) . '<\/a>';\n\n\/\/ Change the footer text\nif ( ! is_multisite() || is_network_admin() ) {\n\t$footer_text = $rate_us . ' | ' . $wiki . ' | ' . $forum . ' | ' . $community;\n} else {\n\t$footer_text = $wiki . ' | ' . $forum . ' | ' . $community;\n}\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/show_error_cookie.php","ext":"php","size":921,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Database Login Cookie Notice\n *\n * Displays a notice about mismatched login cookies for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit();\n\n$err =\n\tesc_html__('NOTICE: Database login cookie did not match your login cookie.', 'litespeed-cache') .\n\t' ' .\n\tesc_html__('If the login cookie was recently changed in the settings, please log out and back in.', 'litespeed-cache') .\n\t' ' .\n\tsprintf(\n\t\tesc_html__('If not, please verify the setting in the %sAdvanced tab%s.', 'litespeed-cache'),\n\t\t\"<a href='\" . esc_url(admin_url('admin.php?page=litespeed-cache#advanced')) . '\">',\n\t\t'<\/a>'\n\t);\n\nif (LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_OLS') {\n\t$err .= ' ' . esc_html__('If using OpenLiteSpeed, the server must be restarted once for the changes to take effect.', 'litespeed-cache');\n}\n\nself::add_notice(self::NOTICE_YELLOW, $err);\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/inc\/check_if_network_disable_all.php","ext":"php","size":884,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Primary Site Configuration Warning\n *\n * Displays a warning notice on subsite admin pages when the network admin has enforced primary site configurations.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nif ( ! is_multisite() ) {\n    return;\n}\n\nif ( get_current_blog_id() === BLOG_ID_CURRENT_SITE ) {\n    return;\n}\n\nif ( ! $this->network_conf( Base::NETWORK_O_USE_PRIMARY ) ) {\n    return;\n}\n?>\n<div class=\"litespeed-callout notice notice-error inline\">\n    <h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n    <p>\n        <?php esc_html_e( 'The network admin selected use primary site configs for all subsites.', 'litespeed-cache' ); ?>\n        <?php esc_html_e( 'The following options are selected, but are not editable in this settings page.', 'litespeed-cache' ); ?>\n    <\/p>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/esi.tpl.php","ext":"php","size":209,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache ESI Block Loader\n *\n * Loads the ESI block for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\ndefined( 'WPINC' ) || exit;\n\n\\LiteSpeed\\ESI::cls()->load_esi_block();\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_media_exc.tpl.php","ext":"php","size":3964,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Media Excludes Settings\n *\n * Renders the media excludes settings interface for LiteSpeed Cache, allowing configuration of exclusions for lazy loading and LQIP.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Media Excludes', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#media-excludes-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed images will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br \/><?php esc_html_e( 'Useful for above-the-fold images causing CLS (a Core Web Vitals metric).', 'litespeed-cache' ); ?>\n\t\t\t\t<br \/><font class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_media_lazy_img_excludes<\/code>' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-lazy=\"1\"<\/code>' ); ?>\n\t\t\t\t<\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Images containing these class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url( true ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_PARENT_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Images having these parent class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_IFRAME_LAZY_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Iframes containing these class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url( true ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_IFRAME_LAZY_PARENT_CLS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Iframes having these parent class names will not be lazy loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_URI_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Prevent any lazy load of listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_MEDIA_LQIP_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'These images will not generate LQIP.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_html.tpl.php","ext":"php","size":6471,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache HTML Settings\n *\n * Renders the HTML optimization settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'HTML Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#html-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_HTML_MIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Minify HTML content.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_DNS_PREFETCH; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prefetching DNS can reduce latency for visitors.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'For example', 'litespeed-cache' ); ?>: <code>\/\/www.example.com<\/code>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#dns-prefetch' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_DNS_PREFETCH_CTRL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically enable DNS prefetching for all URLs in the document, including images, CSS, JavaScript, and so forth.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve the page loading speed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/X-DNS-Prefetch-Control' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_DNS_PRECONNECT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Preconnecting speeds up future loads from a given origin.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'For example', 'litespeed-cache' ); ?>: <code>https:\/\/example.com<\/code>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTML\/Attributes\/rel\/preconnect' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_HTML_LAZY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Delay rendering off-screen HTML elements by its selector.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#html-lazyload-selectors' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_HTML_SKIP_COMMENTS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'When minifying HTML do not discard comments that match a specified pattern.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<?php printf( esc_html__( 'If comment to be kept is like: %1$s write: %2$s', 'litespeed-cache' ), '<code>&lt;!-- A comment that needs to be here --&gt;<\/code>', '<code>A comment that needs to be here<\/code>' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_QS_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Remove query strings from internal static resources.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\t\t\u26a0\ufe0f\n\t\t\t\t\t\t<?php esc_html_e( 'Google reCAPTCHA will be bypassed automatically.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Append query string %s to the resources to bypass this action.', 'litespeed-cache' ), '<code>&amp;_litespeed_rm_qs=0<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GGFONTS_ASYNC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Use Web Font Loader library to load Google Fonts asynchronously while leaving other CSS intact.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will also add a preconnect to Google Fonts to establish a connection earlier.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#load-google-fonts-asynchronously' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GGFONTS_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent Google Fonts from loading on all pages.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_EMOJI_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Stop loading WordPress.org emoji. Browser default emoji will be displayed instead.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_NOSCRIPT_RM; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'This option will remove all %s tags from HTML.', 'litespeed-cache' ), '<code>&lt;noscript&gt;<\/code>' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#remove-noscript-tags' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_js.tpl.php","ext":"php","size":3487,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache JS Settings\n *\n * Renders the JS optimization settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'JS Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#js-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_MIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Minify JS files and inline JS codes.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_COMB; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Combine all local JS files into a single file.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/ts-optimize\/\" target=\"_blank\"><?php esc_html_e( 'How to Fix Problems Caused by CSS\/JS Optimization.', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'This option may result in a JS error or layout issue on frontend pages with certain themes\/plugins.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php esc_html_e( 'JS error can be found from the developer console of browser by right clicking and choosing Inspect.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_COMB_EXT_INL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Include external JS and inline JS in combined file when %1$s is also enabled. This option helps maintain the priorities of JS execution, which should minimize potential errors caused by JS Combine.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_JS_COMB ) ) . '<\/code>' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_DEFER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), esc_html__( 'Deferred', 'litespeed-cache' ), esc_html__( 'Delayed', 'litespeed-cache' ) ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Deferring until page is parsed or delaying till interaction can help reduce resource contention and improve performance causing a lower FID (Core Web Vitals metric).', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#load-js-deferred' ); ?><br \/>\n\t\t\t\t\t<?php esc_html_e( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/web.dev\/fid\/#what-is-fid' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'This option may result in a JS error or layout issue on frontend pages with certain themes\/plugins.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_localization.tpl.php","ext":"php","size":5254,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Localization Settings\n *\n * Renders the localization settings interface for LiteSpeed Cache, including Gravatar caching and resource localization.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$last_generated = Avatar::get_summary();\n$avatar_queue   = Avatar::cls()->queue_count();\n?>\n\n<?php if ( $this->cls( 'Avatar' )->need_db() && ! $this->cls( 'Data' )->tb_exist( 'avatar' ) ) : ?>\n<div class=\"litespeed-callout notice notice-error inline\">\n\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n\t<p><?php printf( esc_html__( 'Failed to create Avatar table. Please follow <a %s>Table Creation guidance from LiteSpeed Wiki<\/a> to finish setup.', 'litespeed-cache' ), 'href=\"https:\/\/www.litespeedtech.com\/support\/wiki\/doku.php\/litespeed_wiki:cache:lscwp:installation\" target=\"_blank\"' ); ?><\/p>\n<\/div>\n<?php endif; ?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Localization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#localization-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_DISCUSS_AVATAR_CACHE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Store Gravatar locally.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'Accelerates the speed by caching Gravatar (Globally Recognized Avatars).', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th class=\"litespeed-padding-left\">\n\t\t\t<?php $option_id = Base::O_DISCUSS_AVATAR_CRON; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Refresh Gravatar cache by cron.', 'litespeed-cache' ); ?>\n\t\t\t<\/div>\n\n\t\t\t<?php if ( $last_generated ) : ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php if ( ! empty( $last_generated['last_request'] ) ) : ?>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo esc_html__( 'Last ran', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $last_generated['last_request'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t<\/p>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php if ( $avatar_queue ) : ?>\n\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Avatar list in queue waiting for update', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php echo esc_html( $avatar_queue ); ?>\n\t\t\t\t\t\t<\/h4>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_AVATAR, Avatar::TYPE_GENERATE ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'Run Queue Manually', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<?php endif; ?>\n\t\t\t<\/div>\n\t\t\t<?php endif; ?>\n\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th class=\"litespeed-padding-left\">\n\t\t\t<?php $option_id = Base::O_DISCUSS_AVATAR_CACHE_TTL; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id ); ?> <?php $this->readable_seconds(); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Specify how long, in seconds, Gravatar files are cached.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 3600 ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_LOCALIZE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Localize external resources.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#localize' ); ?>\n\n\t\t\t\t<br \/><font class=\"litespeed-danger\">\n\t\t\t\t\t\ud83d\udea8 <?php printf( esc_html__( 'Please thoroughly test all items in %s to ensure they function as expected.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_LOCALIZE_DOMAINS ) ) . '<\/code>' ); ?>\n\t\t\t\t<\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th class=\"litespeed-padding-left\">\n\t\t\t<?php $option_id = Base::O_OPTM_LOCALIZE_DOMAINS; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div>\n\t\t\t\t\t<?php $this->recommended( $option_id, true ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Resources listed here will be copied and replaced with local URLs.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php esc_html_e( 'HTTPS sources only.', 'litespeed-cache' ); ?>\n\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\n\t\t\t\t<br \/><?php printf( esc_html__( 'Comments are supported. Start a line with a %s to turn it into a comment line.', 'litespeed-cache' ), '<code>#<\/code>' ); ?>\n\n\t\t\t\t<br \/><?php esc_html_e( 'Example', 'litespeed-cache' ); ?>: <code>https:\/\/www.example.com\/one.js<\/code>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#localization-files' ); ?>\n\n\t\t\t\t<br \/><font class=\"litespeed-danger\">\n\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'Please thoroughly test each JS file you add to ensure it functions as expected.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_css.tpl.php","ext":"php","size":15999,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache CSS Settings\n *\n * Renders the CSS optimization settings interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__admin_display     = Admin_Display::cls();\n$css_summary         = CSS::get_summary();\n$ucss_summary        = UCSS::get_summary();\n$closest_server_ucss = Cloud::get_summary( 'server.' . Cloud::SVC_UCSS );\n$closest_server      = Cloud::get_summary( 'server.' . Cloud::SVC_CCSS );\n\n$ccss_queue = $this->load_queue( 'ccss' );\n$ucss_queue = $this->load_queue( 'ucss' );\n\n$next_gen = '<code class=\"litespeed-success\">' . $this->cls( 'Media' )->next_gen_image_title() . '<\/code>';\n\n$ucss_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_UCSS );\n$ccss_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_CCSS );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'CSS Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_MIN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Minify CSS files and inline CSS code.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_COMB; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Combine CSS files and inline CSS code.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/ts-optimize\/\" target=\"_blank\"><?php esc_html_e( 'How to Fix Problems Caused by CSS\/JS Optimization.', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_UCSS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php if ( ! $this->cls( 'Cloud' )->activated() ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t\t\t<?php echo wp_kses_post( Error::msg( 'qc_setup_required' ) ); ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php esc_html_e( 'Use QUIC.cloud online service to generate unique CSS.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will drop the unused CSS on each page from the combined file.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#generate-ucss' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( 'Automatic generation of unique CSS is in the background via a cron-based queue.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\"><?php esc_html_e( 'API', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'Filter %s available for UCSS per page type generation.', 'litespeed-cache' ), '<code>add_filter( \"litespeed_ucss_per_pagetype\", \"__return_true\" );<\/code>' ); ?><\/font>\n\t\t\t\t\t<?php $__admin_display->_check_overwritten( 'optm-ucss_per_pagetype' ); ?>\n\n\t\t\t\t\t<?php if ( $this->conf( Base::O_OPTM_UCSS ) && ! $this->conf( Base::O_OPTM_CSS_COMB ) ) : ?>\n\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'This option is bypassed because %1$s option is %2$s.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_CSS_COMB ) ) . '<\/code>', '<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t<?php if ( $ucss_summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $ucss_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $ucss_summary['last_request'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last requested cost', 'litespeed-cache' ) . ': <code>' . esc_html( $ucss_summary['last_spent'] ) . 's<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server_ucss ) : ?>\n\t\t\t\t\t\t<a class=\"litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_UCSS ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label=\"<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server_ucss ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class=\"litespeed-quic-icon\"><\/i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $ucss_queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'URL list in %s queue waiting for cron', 'litespeed-cache' ), 'UCSS' ); ?> ( <?php echo esc_html( count( $ucss_queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_UCSS, UCSS::TYPE_CLEAR_Q ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $ucss_queue as $queue_key => $queue_val ) :\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) :\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tendif;\n\t\t\t\t\t\t\t\t\tif ( ! is_array( $queue_val ) ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<span class=\"litespeed-success\">';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $queue_val['url'] );\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<\/span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$pos = strpos( $queue_key, ' ' );\n\t\t\t\t\t\t\t\t\tif ( $pos ) {\n\t\t\t\t\t\t\t\t\t\techo ' (' . esc_html__( 'Vary Group', 'litespeed-cache' ) . ':' . esc_html( substr( $queue_key, 0, $pos ) ) . ')';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( $queue_val['is_mobile'] ) {\n\t\t\t\t\t\t\t\t\t\techo ' <span data-balloon-pos=\"up\" aria-label=\"mobile\">\ud83d\udcf1<\/span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['is_webp'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo ' ' . wp_kses_post( $next_gen );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo '<br \/>';\n\t\t\t\t\t\t\t\tendforeach;\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( $ucss_service_hot ) : ?>\n\t\t\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'UCSS' ); ?>\n\t\t\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $ucss_service_hot ) ); ?>\n\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_UCSS, UCSS::TYPE_GEN ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'UCSS' ); ?>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_UCSS_INLINE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Inline UCSS to reduce the extra CSS file loading. This option will not be automatically turned on for %1$s pages. To use it on %1$s pages, please set it to ON.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_GUEST ) ) . '<\/code>' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-info\">\n\t\t\t\t\t\t<?php printf( esc_html__( 'This option will automatically bypass %s option.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_CSS_ASYNC ) ) . '<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_COMB_EXT_INL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Include external CSS and inline CSS in combined file when %1$s is also enabled. This option helps maintain the priorities of CSS, which should minimize potential errors caused by CSS Combine.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_CSS_COMB ) ) . '<\/code>' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_ASYNC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php if ( ! $this->cls( 'Cloud' )->activated() ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t\t\t\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t\t\t<?php echo wp_kses_post( Error::msg( 'qc_setup_required' ) ); ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php esc_html_e( 'Optimize CSS delivery.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?><br \/>\n\t\t\t\t\t<?php esc_html_e( 'Use QUIC.cloud online service to generate critical CSS and load remaining CSS asynchronously.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#load-css-asynchronously' ); ?><br \/>\n\t\t\t\t\t<?php esc_html_e( 'Automatic generation of critical CSS is in the background via a cron-based queue.', 'litespeed-cache' ); ?><br \/>\n\t\t\t\t\t<?php printf( esc_html__( 'When this option is turned %s, it will also load Google Fonts asynchronously.', 'litespeed-cache' ), '<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in HTML code will be excluded.', 'litespeed-cache' ), '<code>data-no-async=\"1\"<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\n\t\t\t\t\t<?php if ( $this->conf( Base::O_OPTM_CSS_ASYNC ) && $this->conf( Base::O_OPTM_CSS_COMB ) && $this->conf( Base::O_OPTM_UCSS ) && $this->conf( Base::O_OPTM_UCSS_INLINE ) ) : ?>\n\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'This option is bypassed due to %s option.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_OPTM_UCSS_INLINE ) ) . '<\/code>' ); ?>\n\t\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t<?php if ( $css_summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $css_summary['last_request_ccss'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $css_summary['last_request_ccss'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last requested cost', 'litespeed-cache' ) . ': <code>' . esc_html( $css_summary['last_spent_ccss'] ) . 's<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t<a class=\"litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_CCSS ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label=\"<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class=\"litespeed-quic-icon\"><\/i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $ccss_queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'URL list in %s queue waiting for cron', 'litespeed-cache' ), 'CCSS' ); ?> ( <?php echo esc_html( count( $ccss_queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CSS, CSS::TYPE_CLEAR_Q_CCSS ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $ccss_queue as $queue_key => $queue_val ) :\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) :\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tendif;\n\t\t\t\t\t\t\t\t\tif ( ! is_array( $queue_val ) ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<span class=\"litespeed-success\">';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $queue_val['url'] );\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<\/span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$pos = strpos( $queue_key, ' ' );\n\t\t\t\t\t\t\t\t\tif ( $pos ) {\n\t\t\t\t\t\t\t\t\t\techo ' (' . esc_html__( 'Vary Group', 'litespeed-cache' ) . ':' . esc_html( substr( $queue_key, 0, $pos ) ) . ')';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( $queue_val['is_mobile'] ) {\n\t\t\t\t\t\t\t\t\t\techo ' <span data-balloon-pos=\"up\" aria-label=\"mobile\">\ud83d\udcf1<\/span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $queue_val['is_webp'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo ' ' . wp_kses_post( $next_gen );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo '<br \/>';\n\t\t\t\t\t\t\t\tendforeach;\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( $ccss_service_hot ) : ?>\n\t\t\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'CCSS' ); ?>\n\t\t\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $ccss_service_hot ) ); ?>\n\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CSS, CSS::TYPE_GEN_CCSS ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'CCSS' ); ?>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_CCSS_PER_URL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Disable this option to generate CCSS per Post Type instead of per page. This can save significant CCSS quota, however it may result in incorrect CSS styling if your site uses a page builder.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_ASYNC_INLINE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'This will inline the asynchronous CSS library to avoid render blocking.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_CSS_FONT_DISPLAY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'Default', 'litespeed-cache' ), 'Swap' ) ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Set this to append %1$s to all %2$s rules before caching CSS to specify how fonts should be displayed while being downloaded.', 'litespeed-cache' ), '<code>font-display<\/code>', '<code>@font-face<\/code>' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( '%s is recommended.', 'litespeed-cache' ), '<code>' . esc_html__( 'Swap', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_tuning.tpl.php","ext":"php","size":6191,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Tuning Settings\n *\n * Renders the tuning settings interface for LiteSpeed Cache, allowing configuration of optimization exclusions and role-based settings.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nglobal $wp_roles;\n$wp_orig_roles = $wp_roles;\nif ( ! isset( $wp_roles ) ) {\n\t$wp_orig_roles = new \\WP_Roles();\n}\n\n$roles = array();\nforeach ( $wp_orig_roles->roles as $k => $v ) {\n\t$roles[ $k ] = $v['name'];\n}\nksort( $roles );\n\n?>\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Tuning Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#tuning-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_DELAY_INC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Listed JS files or inline JS code will be delayed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_js_delay_inc<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Listed JS files or inline JS code will not be minified or combined.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optimize_js_excludes<\/code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-optimize=\"1\"<\/code>' ); ?>\n\t\t\t\t\t\t<br \/><?php esc_html_e( 'Predefined list will also be combined with the above settings.', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/js_excludes.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/js_excludes.txt<\/a>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_JS_DEFER_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Listed JS files or inline JS code will not be deferred or delayed.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br \/><span class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_js_defer_exc<\/code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-defer=\"1\"<\/code>' ); ?>\n\t\t\t\t\t\t<br \/><?php esc_html_e( 'Predefined list will also be combined with the above settings.', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/js_defer_excludes.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/js_defer_excludes.txt<\/a>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GM_JS_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Listed JS files or inline JS code will not be optimized by %s.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_GUEST ) ) . '<\/code>' ); ?>\n\t\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<br \/><span class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_gm_js_exc<\/code>' ); ?>\n\t\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-defer=\"1\"<\/code>' ); ?>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Prevent any optimization of listed pages.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t\t\t<br \/><span class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optm_uri_exc<\/code>' ); ?>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_GUEST_ONLY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Only optimize pages for guest (not logged in) visitors. If turned this OFF, CSS\/JS\/CCSS files will be doubled by each user group.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_OPTM_EXC_ROLES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Selected roles will be excluded from all optimizations.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-tick-list\">\n\t\t\t\t\t<?php\n\t\t\t\t\tforeach ( $roles as $role_id => $role_title ) {\n\t\t\t\t\t\t$this->build_checkbox( $option_id . '[]', $role_title, $this->cls( 'Conf' )->in_optm_exc_roles( $role_id ), $role_id );\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/entry.tpl.php","ext":"php","size":2033,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Page Optimization Interface\n *\n * Renders the page optimization settings interface for LiteSpeed Cache with tabbed navigation.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'settings_css'          => esc_html__( 'CSS Settings', 'litespeed-cache' ),\n\t'settings_js'           => esc_html__( 'JS Settings', 'litespeed-cache' ),\n\t'settings_html'         => esc_html__( 'HTML Settings', 'litespeed-cache' ),\n\t'settings_media'        => esc_html__( 'Media Settings', 'litespeed-cache' ),\n\t'settings_vpi'          => esc_html__( 'VPI', 'litespeed-cache' ),\n\t'settings_media_exc'    => esc_html__( 'Media Excludes', 'litespeed-cache' ),\n\t'settings_localization' => esc_html__( 'Localization', 'litespeed-cache' ),\n\t'settings_tuning'       => esc_html__( 'Tuning', 'litespeed-cache' ),\n\t'settings_tuning_css'   => esc_html__( 'Tuning', 'litespeed-cache' ) . ' - CSS',\n);\n\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Page Optimization', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\tv<?php echo esc_html( Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\n\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t<h4><?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?><\/h4>\n\t\t<p><?php esc_html_e( 'Please test thoroughly when enabling any option in this list. After changing Minify\/Combine settings, please do a Purge All action.', 'litespeed-cache' ); ?><\/p>\n\t<\/div>\n\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t<\/h2>\n\n\t<div class=\"litespeed-body\">\n\t<?php\n\t\t$this->form_action();\n\n\t\t\/\/ Include all tpl for faster UE\n\t\tforeach ( $menu_list as $tab_key => $tab_val ) {\n\t\t\t?>\n\t\t\t<div data-litespeed-layout='<?php echo esc_attr( $tab_key ); ?>'>\n\t\t\t\t<?php require LSCWP_DIR . 'tpl\/page_optm\/' . $tab_key . '.tpl.php'; ?>\n\t\t\t<\/div>\n\t\t\t<?php\n\t\t}\n\n\t\t$this->form_end();\n\t?>\n\t<\/div>\n\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_media.tpl.php","ext":"php","size":13411,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Media Settings\n *\n * Renders the media settings interface for LiteSpeed Cache, including lazy loading, placeholders, and image optimization options.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__admin_display     = Admin_Display::cls();\n$placeholder_summary = Placeholder::get_summary();\n$closest_server      = Cloud::get_summary( 'server.' . Cloud::SVC_LQIP );\n\n$lqip_queue = $this->load_queue( 'lqip' );\n\n$scaled_size = apply_filters( 'big_image_size_threshold', 2560 ) . 'px';\n\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Media Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#media-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LAZY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Load images only when they enter the viewport.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve page loading time by reducing initial HTTP requests.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t\ud83d\udca1\n\t\t\t\t\t\t<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#lazy-load-images\" target=\"_blank\"><?php esc_html_e( 'Adding Style to Your Lazy-Loaded Images', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LAZY_PLACEHOLDER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-long' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify a base64 image to be used as a simple placeholder while images finish loading.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( 'This can be predefined in %2$s as well using constant %1$s, with this setting taking priority.', 'litespeed-cache' ), '<code>LITESPEED_PLACEHOLDER<\/code>', '<code>wp-config.php<\/code>' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( 'By default a gray image placeholder %s will be used.', 'litespeed-cache' ), '<code>data:image\/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=<\/code>' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( 'For example, %s can be used for a transparent placeholder.', 'litespeed-cache' ), '<code>data:image\/gif;base64,R0lGODlhAQABAIAAAAAAAP\/\/\/yH5BAEAAAAALAAAAAABAAEAAAIBRAA7<\/code>' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Responsive image placeholders can help to reduce layout reshuffle when images are loaded.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will generate the placeholder with same dimensions as the image if it has the width and height attributes.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP_SVG; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-long' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify an SVG to be used as a placeholder when generating locally.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'It will be converted to a base64 SVG placeholder on-the-fly.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( 'Variables %s will be replaced with the corresponding image properties.', 'litespeed-cache' ), '<code>{width} {height}<\/code>' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( 'Variables %s will be replaced with the configured background color.', 'litespeed-cache' ), '<code>{color}<\/code>' ); ?>\n\t\t\t\t\t<br \/><?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP_COLOR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, null, null, 'color' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the responsive placeholder SVG color.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LQIP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Use QUIC.cloud LQIP (Low Quality Image Placeholder) generator service for responsive image previews while loading.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( 'Keep this off to use plain color placeholders.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#lqip-cloud-generator' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LQIP_QUAL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify the quality when generating LQIP.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( 'Larger number will generate higher resolution quality placeholder, but will result in larger files which will increase page size and consume more points.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 1, 20 ); ?>\n\t\t\t\t\t<br \/>\ud83d\udca1 <?php printf( esc_html__( 'Changes to this setting do not apply to already-generated LQIPs. To regenerate existing LQIPs, please %s first from the admin bar menu.', 'litespeed-cache' ), '<code>' . esc_html__( 'Purge All', 'litespeed-cache' ) . ' - ' . esc_html__( 'LQIP Cache', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_LQIP_MIN_W; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> x\n\t\t\t\t<?php $this->build_input( Base::O_MEDIA_LQIP_MIN_H, 'litespeed-input-short' ); ?>\n\t\t\t\t<?php esc_html_e( 'pixels', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'LQIP requests will not be sent for images where both width and height are smaller than these dimensions.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 10, 800 ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( Base::O_MEDIA_LQIP_MIN_H, 10, 800 ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_PLACEHOLDER_RESP_ASYNC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically generate LQIP in the background via a cron-based queue.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'If set to %1$s, before the placeholder is localized, the %2$s configuration will be used.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '<\/code>',\n\t\t\t\t\t\t'<code>' . esc_html( Lang::title( Base::O_MEDIA_PLACEHOLDER_RESP_SVG ) ) . '<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php printf( esc_html__( 'If set to %s this is done in the foreground, which may slow down page load.', 'litespeed-cache' ), '<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '<\/code>' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#generate-lqip-in-background' ); ?>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php if ( $placeholder_summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $placeholder_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $placeholder_summary['last_request'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t<a class=\"litespeed-redetect\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_LQIP ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label='<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>' data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class='litespeed-quic-icon'><\/i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $lqip_queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Size list in queue waiting for cron', 'litespeed-cache' ); ?> ( <?php echo esc_html( count( $lqip_queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PLACEHOLDER, Placeholder::TYPE_CLEAR_Q ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $lqip_queue as $k => $v ) {\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) {\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $v );\n\t\t\t\t\t\t\t\t\techo '<br \/>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_PLACEHOLDER, Placeholder::TYPE_GENERATE ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Run Queue Manually', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_IFRAME_LAZY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Load iframes only when they enter the viewport.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve page loading time by reducing initial HTTP requests.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_ADD_MISSING_SIZES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Set an explicit width and height on image elements to reduce layout shifts and improve CLS (a Core Web Vitals metric).', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/web.dev\/optimize-cls\/#images-without-dimensions' ); ?>\n\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-warning litespeed-left10\">\n\t\t\t\t\t\t\u26a0\ufe0f <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( '%s must be turned ON for this setting to work.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_MEDIA_LAZY ) ) . '<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t<?php printf( esc_html__( 'Use %1$s to bypass remote image dimension check when %2$s is ON.', 'litespeed-cache' ), '<code>add_filter( \"litespeed_media_ignore_remote_missing_sizes\", \"__return_true\" );<\/code>', '<code>' . esc_html( Lang::title( Base::O_MEDIA_ADD_MISSING_SIZES ) ) . '<\/code>' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php $__admin_display->_check_overwritten( Base::O_MEDIA_ADD_MISSING_SIZES ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_JPG_QUALITY; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The image compression quality setting of WordPress out of 100.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<?php $this->_validate_ttl( $option_id, 0, 100 ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_AUTO_RESCALE_ORI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically replace large images with scaled versions.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Scaled size threshold', 'litespeed-cache' ); ?>: <code><?php echo wp_kses_post( $scaled_size ); ?><\/code>\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<span class=\"litespeed-success\">\n\t\t\t\t\t\tAPI:\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\tesc_html__( 'Filter %s available to change threshold.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<code>big_image_size_threshold<\/code>'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<a href=\"https:\/\/developer.wordpress.org\/reference\/hooks\/big_image_size_threshold\/\" target=\"_blank\" class=\"litespeed-learn-more\">\n\t\t\t\t\t\t\t<?php esc_html_e('Learn More', 'litespeed-cache'); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/span>\n\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t\ud83d\udea8\n\t\t\t\t\t\t<?php esc_html_e( 'This is irreversible.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_vpi.tpl.php","ext":"php","size":5265,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Viewport Images Settings\n *\n * Renders the Viewport Images settings interface for LiteSpeed Cache, allowing configuration of viewport image detection and exclusions.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$summary        = VPI::get_summary();\n$closest_server = Cloud::get_summary( 'server.' . Cloud::SVC_VPI );\n\n$queue           = $this->load_queue( 'vpi' );\n$vpi_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_VPI );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Viewport Images', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#vpi-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_VPI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'When you use Lazy Load, it will delay the loading of all images on a page.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( 'The Viewport Images service detects which images appear above the fold, and excludes them from lazy load.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php esc_html_e( \"This enables the page's initial screenful of imagery to be fully displayed without delay.\", 'litespeed-cache' ); ?>\n\n\t\t\t\t\t<?php if ( ! $this->conf( Base::O_MEDIA_LAZY ) ) : ?>\n\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t<font class=\"litespeed-warning litespeed-left10\">\n\t\t\t\t\t\t\t\u26a0\ufe0f <?php esc_html_e( 'Notice', 'litespeed-cache' ); ?>: <?php printf( esc_html__( '%s must be turned ON for this setting to work.', 'litespeed-cache' ), '<code>' . esc_html( Lang::title( Base::O_MEDIA_LAZY ) ) . '<\/code>' ); ?>\n\t\t\t\t\t\t<\/font>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t<?php if ( $summary ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last generated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $summary['last_request'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t<a class='litespeed-redetect' href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_VPI ) ) ); ?>\" data-balloon-pos=\"up\" data-balloon-break aria-label='<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>' data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><i class='litespeed-quic-icon'><\/i> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $queue ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'URL list in %s queue waiting for cron', 'litespeed-cache' ), 'VPI' ); ?> ( <?php echo esc_html( count( $queue ) ); ?> )\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_VPI, VPI::TYPE_CLEAR_Q ) ); ?>\" class=\"button litespeed-btn-warning litespeed-right\"><?php esc_html_e( 'Clear', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h4>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\tforeach ( $queue as $k => $v ) {\n\t\t\t\t\t\t\t\t\tif ( $i++ > 20 ) {\n\t\t\t\t\t\t\t\t\t\techo '...';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! is_array( $v ) ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( ! empty( $v['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<span class=\"litespeed-success\">';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo esc_html( $v['url'] );\n\t\t\t\t\t\t\t\t\tif ( ! empty( $v['_status'] ) ) {\n\t\t\t\t\t\t\t\t\t\techo '<\/span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$pos = strpos( $k, ' ' );\n\t\t\t\t\t\t\t\t\tif ( $pos ) {\n\t\t\t\t\t\t\t\t\t\techo ' (' . esc_html__( 'Vary Group', 'litespeed-cache' ) . ':' . esc_html( substr( $k, 0, $pos ) ) . ')';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( $v['is_mobile'] ) {\n\t\t\t\t\t\t\t\t\t\techo ' <span data-balloon-pos=\"up\" aria-label=\"mobile\">\ud83d\udcf1<\/span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\techo '<br \/>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( $vpi_service_hot ) : ?>\n\t\t\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'VPI' ); ?>\n\t\t\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $vpi_service_hot ) ); ?>\n\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_VPI, VPI::TYPE_GEN ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Run %s Queue Manually', 'litespeed-cache' ), 'VPI' ); ?>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php Doc::queue_issues(); ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_MEDIA_VPI_CRON; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Enable Viewport Images auto generation cron.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/page_optm\/settings_tuning_css.tpl.php","ext":"php","size":7625,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Tuning CSS Settings\n *\n * Renders the Tuning CSS settings interface for LiteSpeed Cache, allowing configuration of CSS exclusions and optimizations.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n?>\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Tuning CSS Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#tuning-css-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n<tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CSS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed CSS files or inline CSS code will not be minified or combined.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br \/><font class=\"litespeed-success\">\n\t\t\t\t\t<?php echo esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_optimize_css_excludes<\/code>' ); ?>\n\t\t\t\t\t<?php printf( esc_html__( 'Elements with attribute %s in html code will be excluded.', 'litespeed-cache' ), '<code>data-no-optimize=\"1\"<\/code>' ); ?>\n\t\t\t\t\t<br \/><?php echo esc_html_e( 'Predefined list will also be combined with the above settings', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/css_excludes.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/css_excludes.txt<\/a>\n\t\t\t\t<\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_UCSS_FILE_EXC_INLINE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed CSS files will be excluded from UCSS and saved to inline.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_UCSS_SELECTOR_WHITELIST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'List the CSS selectors whose styles should always be included in UCSS.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#ucss-selector-allowlist', esc_html__( 'Learn more', 'litespeed-cache' ) ); ?>.\n\t\t\t\t<br \/><?php printf( esc_html__( 'Wildcard %s supported.', 'litespeed-cache' ), '<code>*<\/code>' ); ?>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'The selector must exist in the CSS. Parent classes in the HTML will not work.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'Predefined list will also be combined w\/ the above settings', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/ucss_whitelist.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/ucss_whitelist.txt<\/a>\n\t\t\t\t<\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_UCSS_EXC; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Listed URI will not generate UCSS.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::full_or_partial_url(); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<br \/><span class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'API', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php printf( esc_html__( 'Filter %s is supported.', 'litespeed-cache' ), '<code>litespeed_ucss_exc<\/code>' ); ?>\n\t\t\t\t<\/span>\n\t\t\t\t<br \/><font class=\"litespeed-success\"><?php esc_html_e( 'API', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'Use %1$s to generate one single UCSS for the pages which page type is %2$s while other page types still per URL.', 'litespeed-cache' ), \"<code>add_filter( 'litespeed_ucss_per_pagetype', function(){return get_post_type() == 'page';} );<\/code>\", '<code>page<\/code>' ); ?><\/font>\n\t\t\t\t<br \/><font class=\"litespeed-success\"><?php esc_html_e( 'API', 'litespeed-cache' ); ?>: <?php printf( esc_html__( 'Use %1$s to bypass UCSS for the pages which page type is %2$s.', 'litespeed-cache' ), \"<code>add_action( 'litespeed_optm', function(){get_post_type() == 'page' && do_action( 'litespeed_conf_force', 'optm-ucss', false );});<\/code>\", '<code>page<\/code>' ); ?><\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_SEP_POSTTYPE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'List post types where each item of that type should have its own CCSS generated.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php printf( esc_html__( 'For example, if every Page on the site has different formatting, enter %s in the box. Separate critical CSS files will be stored for every Page on the site.', 'litespeed-cache' ), '<code>page<\/code>' ); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#separate-ccss-cache-post-types_1' ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_SEP_URI; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Separate critical CSS files will be generated for paths containing these strings.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_uri_usage_example(); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_SELECTOR_WHITELIST; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'List the CSS selectors whose styles should always be included in CCSS.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/pageopt\/#ccss-selector-allowlist', esc_html__( 'Learn more', 'litespeed-cache' ) ); ?>.\n\t\t\t\t<br \/><?php printf( esc_html__( 'Wildcard %s supported.', 'litespeed-cache' ), '<code>*<\/code>' ); ?>\n\t\t\t\t<div class=\"litespeed-callout notice notice-warning inline\">\n\t\t\t\t\t<h4><?php esc_html_e( 'Note', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'Selectors must exist in the CSS. Parent classes in the HTML will not work.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t\t<font class=\"litespeed-success\">\n\t\t\t\t\t<?php esc_html_e( 'Predefined list will also be combined w\/ the above settings', 'litespeed-cache' ); ?>: <a href=\"https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/ccss_whitelist.txt\" target=\"_blank\">https:\/\/github.com\/litespeedtech\/lscache_wp\/blob\/dev\/data\/ccss_whitelist.txt<\/a>\n\t\t\t\t<\/font>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_OPTM_CCSS_CON; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php printf( esc_html__( 'Specify critical CSS rules for above-the-fold content when enabling %s.', 'litespeed-cache' ), esc_html__( 'Load CSS Asynchronously', 'litespeed-cache' ) ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/esi_widget_edit.php","ext":"php","size":2621,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Widget Settings\n *\n * Configures ESI settings for widgets in LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$options = ! empty( $instance[ Base::OPTION_NAME ] ) ? $instance[ Base::OPTION_NAME ] : array();\n\nif ( empty( $options ) ) {\n\t$options = array(\n\t\tESI::WIDGET_O_ESIENABLE => Base::VAL_OFF,\n\t\tESI::WIDGET_O_TTL       => '28800',\n\t);\n\n\tadd_filter( 'litespeed_widget_default_options', 'LiteSpeed\\ESI::widget_default_options', 10, 2 );\n\n\t$options = apply_filters( 'litespeed_widget_default_options', $options, $widget );\n}\n\nif ( empty( $options ) ) {\n\t$esi = Base::VAL_OFF;\n\t$ttl = '28800';\n} else {\n\t$esi = $options[ ESI::WIDGET_O_ESIENABLE ];\n\t$ttl = $options[ ESI::WIDGET_O_TTL ];\n}\n\n$display = Admin_Display::cls();\n\n?>\n<div class=\"litespeed-widget-setting\">\n\n\t<h4><?php esc_html_e( 'LiteSpeed Cache', 'litespeed-cache' ); ?>:<\/h4>\n\n\t<b><?php esc_html_e( 'Enable ESI', 'litespeed-cache' ); ?>:<\/b>\n\t&nbsp;\n\t<div class=\"litespeed-inline\">\n\t\t<div class=\"litespeed-switch litespeed-mini\">\n\t\t<?php\n\t\t\t$esi_option = ESI::WIDGET_O_ESIENABLE;\n\t\t\t$name       = $widget->get_field_name( $esi_option );\n\n\t\t\t$cache_status_list = array(\n\t\t\t\tarray( Base::VAL_ON, esc_html__( 'Public', 'litespeed-cache' ) ),\n\t\t\t\tarray( Base::VAL_ON2, esc_html__( 'Private', 'litespeed-cache' ) ),\n\t\t\t\tarray( Base::VAL_OFF, esc_html__( 'Disable', 'litespeed-cache' ) ),\n\t\t\t);\n\n\t\t\tforeach ( $cache_status_list as $v ) {\n\t\t\t\tlist( $value, $label ) = $v;\n\t\t\t\t$id_attr               = $widget->get_field_id( $esi_option ) . '_' . $value;\n\t\t\t\t$checked               = $esi === $value ? 'checked' : '';\n\t\t\t\t?>\n\t\t\t\t<input type=\"radio\" autocomplete=\"off\" name=\"<?php echo esc_attr($name); ?>\" id=\"<?php echo esc_attr($id_attr); ?>\" value=\"<?php echo esc_attr( $value ); ?>\" <?php echo esc_attr($checked); ?> \/>\n\t\t\t\t<label for=\"<?php echo esc_attr($id_attr); ?>\"><?php echo esc_html( $label ); ?><\/label>\n\t\t\t\t<?php\n\t\t\t}\n\t\t?>\n\t\t<\/div>\n\t<\/div>\n\t<br \/><br \/>\n\n\t<b><?php esc_html_e( 'Widget Cache TTL', 'litespeed-cache' ); ?>:<\/b>\n\t&nbsp;\n\t<?php\n\t\t$ttl_option = ESI::WIDGET_O_TTL;\n\t\t$name       = $widget->get_field_name( $ttl_option );\n\t\t?>\n\t\t<input type=\"text\" class=\"regular-text litespeed-reset\" name=\"<?php echo esc_attr($name); ?>\" value=\"<?php echo esc_attr($ttl); ?>\" size=\"7\" \/>\n\t<?php esc_html_e( 'seconds', 'litespeed-cache' ); ?>\n\n\t<p class=\"install-help\">\n\t\t<?php esc_html_e( 'Recommended value: 28800 seconds (8 hours).', 'litespeed-cache' ); ?>\n\t\t<?php esc_html_e( 'A TTL of 0 indicates do not cache.', 'litespeed-cache' ); ?>\n\t<\/p>\n<\/div>\n\n<br \/>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/img_optm\/summary.tpl.php","ext":"php","size":19449,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Image Optimization Summary\n *\n * Manages the image optimization summary interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$closest_server = Cloud::get_summary( 'server.' . Cloud::SVC_IMG_OPTM );\n$usage_cloud    = Cloud::get_summary( 'usage.' . Cloud::SVC_IMG_OPTM );\n$allowance      = Cloud::cls()->allowance( Cloud::SVC_IMG_OPTM );\n\n$img_optm = Img_Optm::cls();\n\n$wet_limit = $img_optm->wet_limit();\n$img_count = $img_optm->img_count();\n\n$optm_summary = Img_Optm::get_summary();\n\nlist($last_run, $is_running) = $img_optm->cron_running( false );\n$finished_percentage         = 0;\nif ( $img_count['groups_all'] ) {\n\t$finished_percentage = 100 - floor( $img_count['groups_new'] * 100 \/ $img_count['groups_all'] );\n}\nif ( 100 === $finished_percentage && $img_count['groups_new'] ) {\n\t$finished_percentage = 99;\n}\n\n$unfinished_num = 0;\nif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ] ) ) {\n\t$unfinished_num += $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ];\n}\nif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ] ) ) {\n\t$unfinished_num += $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ];\n}\nif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_ERR_FETCH ] ) ) {\n\t$unfinished_num += $img_count[ 'img.' . Img_Optm::STATUS_ERR_FETCH ];\n}\n\n$imgoptm_service_hot = $this->cls( 'Cloud' )->service_hot( Cloud::SVC_IMG_OPTM . '-' . Img_Optm::CLOUD_ACTION_NEW_REQ );\n?>\n<div class=\"litespeed-flex-container litespeed-column-with-boxes\">\n\t<div class=\"litespeed-width-7-10 litespeed-column-left litespeed-image-optim-summary-wrapper\">\n\t\t<div class=\"litespeed-image-optim-summary\">\n\n\t\t\t<h3>\n\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_IMG_OPTM ) ) ); ?>\" class=\"litespeed-info-button litespeed-redetect\" data-balloon-pos=\"right\" data-balloon-break aria-label=\"<?php printf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"><span class=\"litespeed-quic-icon\"><\/span> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<span class=\"litespeed-quic-icon\"><\/span> <?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php esc_html_e( 'Optimize images with our QUIC.cloud server', 'litespeed-cache' ); ?>\n\t\t\t\t<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/imageopt\/#image-optimization-summary-tab\" target=\"_blank\" class=\"litespeed-right litespeed-learn-more\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a>\n\t\t\t<\/h3>\n\n\t\t\t<p>\n\t\t\t\t<?php printf( esc_html__( 'You can request a maximum of %s images at once.', 'litespeed-cache' ), '<strong>' . intval( $allowance ) . '<\/strong>' ); ?>\n\t\t\t<\/p>\n\n\t\t\t<?php if ( $wet_limit ) : ?>\n\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'To make sure our server can communicate with your server without any issues and everything works fine, for the few first requests the number of image groups allowed in a single request is limited.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php echo esc_html__( 'Current limit is', 'litespeed-cache' ) . ': <strong>' . esc_html( $wet_limit ) . '<\/strong>'; ?>\n\t\t\t\t<\/p>\n\t\t\t<?php endif; ?>\n\n\t\t\t<div class=\"litespeed-img-optim-actions\">\n\t\t\t\t<?php if ( $imgoptm_service_hot ) : ?>\n\t\t\t\t\t<button class=\"button button-secondary\" disabled>\n\t\t\t\t\t\t<span class=\"dashicons dashicons-images-alt2\"><\/span> <?php esc_html_e( 'Send Optimization Request', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t- <?php printf( esc_html__( 'Available after %d second(s)', 'litespeed-cache' ), esc_html( $imgoptm_service_hot ) ); ?>\n\t\t\t\t\t<\/button>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<a data-litespeed-onlyonce class=\"button button-primary\"\n\t\t\t\t\t<?php\n\t\t\t\t\tif ( ! empty( $img_count['groups_new'] ) || ! empty( $img_count[ 'group.' . Img_Optm::STATUS_RAW ] ) ) :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_NEW_REQ ) ); ?>\"\n\t\t\t\t\t\t<?php\n\t\t\t\t\telse :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"javascript:;\" disabled <?php endif; ?>>\n\t\t\t\t\t\t<span class=\"dashicons dashicons-images-alt2\"><\/span> <?php esc_html_e( 'Send Optimization Request', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<?php endif; ?>\n\n\t\t\t\t<a data-litespeed-onlyonce class=\"button button-secondary\" data-balloon-length=\"large\" data-balloon-pos=\"right\" aria-label=\"<?php esc_html_e( 'Only press the button if the pull cron job is disabled.', 'litespeed-cache' ); ?> <?php esc_html_e( 'Images will be pulled automatically if the cron job is running.', 'litespeed-cache' ); ?>\"\n\t\t\t\t\t<?php\n\t\t\t\t\tif ( ! empty( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ] ) && ! $is_running ) :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_PULL ) ); ?>\"\n\t\t\t\t\t\t<?php\n\t\t\t\t\telse :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\thref=\"javascript:;\" disabled <?php endif; ?>>\n\t\t\t\t\t<?php esc_html_e( 'Pull Images', 'litespeed-cache' ); ?>\n\t\t\t\t<\/a>\n\t\t\t<\/div>\n\n\t\t\t<div>\n\t\t\t\t<h3 class=\"litespeed-title-section\">\n\t\t\t\t\t<?php esc_html_e( 'Optimization Status', 'litespeed-cache' ); ?>\n\t\t\t\t<\/h3>\n\n\t\t\t\t<div class=\"litespeed-light-code\">\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_NEW ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_NEW ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count['group_new'] ) ); ?>\n\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_RAW ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_RAW ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_RAW ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_RAW ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_REQUESTED ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'After the QUIC.cloud Image Optimization server finishes optimization, it will notify your site to pull the optimized images.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'This process is automatic.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_NOTIFIED ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php if ( $last_run ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<?php printf( esc_html__( 'Last pull initiated by cron at %s.', 'litespeed-cache' ), '<code>' . esc_html( Utility::readable_time( $last_run ) ) . '<\/code>' ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_PULLED ] ) ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t<?php echo esc_html( Lang::img_status( Img_Optm::STATUS_PULLED ) ); ?>:\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_PULLED ] ) ); ?>\n\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_PULLED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<p>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\t'<a href=\"%1$s\" class=\"button button-secondary litespeed-btn-warning\" data-balloon-pos=\"right\" aria-label=\"%2$s\" %3$s><span class=\"dashicons dashicons-editor-removeformatting\"><\/span> %4$s<\/a>',\n\t\t\t\t\t\t( $unfinished_num ? esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_CLEAN ) ) : 'javascript:;' ),\n\t\t\t\t\t\tesc_html__( 'Remove all previous unfinished image optimization requests.', 'litespeed-cache' ),\n\t\t\t\t\t\t( $unfinished_num ? '' : ' disabled' ),\n\t\t\t\t\t\tesc_html__( 'Clean Up Unfinished Data', 'litespeed-cache' ) . ( $unfinished_num ? ': ' . esc_html( Admin_Display::print_plural( $unfinished_num, 'image' ) ) : '' )\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<\/p>\n\n\t\t\t\t\t<h3 class=\"litespeed-title-section\">\n\t\t\t\t\t\t<?php esc_html_e( 'Storage Optimization', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/h3>\n\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'A backup of each image is saved before it is optimized.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/p>\n\n\t\t\t\t\t<?php if ( ! empty( $optm_summary['bk_summary'] ) ) : ?>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Last calculated', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $optm_summary['bk_summary']['date'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php if ( $optm_summary['bk_summary']['count'] ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Files', 'litespeed-cache' ) . ': <code>' . intval( $optm_summary['bk_summary']['count'] ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html__( 'Total', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::real_size( $optm_summary['bk_summary']['sum'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a class=\"button button-secondary\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'Calculate Original Image Storage', 'litespeed-cache' ); ?>\"\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tif ( $finished_percentage > 0 ) :\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_CALC_BKUP ) ); ?>\"\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\telse :\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\thref=\"javascript:;\" disabled <?php endif; ?>>\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span> <?php esc_html_e( 'Calculate Backups Disk Space', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t<\/div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<h4><?php esc_html_e( 'Image Thumbnail Group Sizes', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t<div class=\"litespeed-desc litespeed-left20\">\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tforeach ( Media::cls()->get_image_sizes() as $size_title => $size ) {\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<div>%1$s ( %2$s x %3$s )<\/div>',\n\t\t\t\t\t\t\t\tesc_html( $size_title ),\n\t\t\t\t\t\t\t\t$size['width'] ? esc_html( $size['width'] ) . 'px' : '*',\n\t\t\t\t\t\t\t\t$size['height'] ? esc_html( $size['height'] ) . 'px' : '*'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t\t<hr class=\"litespeed-hr-with-space\">\n\t\t\t\t<div>\n\t\t\t\t\t<h4><?php esc_html_e( 'Delete all backups of the original images', 'litespeed-cache' ); ?><\/h4>\n\t\t\t\t\t<div class=\"notice notice-error litespeed-callout-bg inline\">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'This is irreversible.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'You will be unable to Revert Optimization once the backups are deleted!', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t\t<?php if ( ! empty( $optm_summary['rmbk_summary'] ) ) : ?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Last ran', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::readable_time( $optm_summary['rmbk_summary']['date'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Files', 'litespeed-cache' ) . ': <code>' . esc_html( $optm_summary['rmbk_summary']['count'] ) . '<\/code>'; ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php echo esc_html__( 'Saved', 'litespeed-cache' ) . ': <code>' . esc_html( Utility::real_size( $optm_summary['rmbk_summary']['sum'] ) ) . '<\/code>'; ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<\/div>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<div class=\"litespeed-image-optim-summary-footer\">\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RM_BKUP ) ); ?>\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure you want to remove all image backups?', 'litespeed-cache' ); ?>\" class=\"litespeed-link-with-icon litespeed-danger\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-trash\"><\/span><?php esc_html_e( 'Remove Original Image Backups', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\n\t<div class=\"litespeed-width-3-10 litespeed-column-right\">\n\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-imgopt-info\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t<?php esc_html_e( 'Image Information', 'litespeed-cache' ); ?>\n\t\t\t\t<\/h3>\n\n\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle\">\n\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $finished_percentage, 70, true ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Image groups total', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php if ( $img_count['groups_new'] ) : ?>\n\t\t\t\t\t\t\t\t<code><?php echo esc_html( Admin_Display::print_plural( $img_count['groups_new'], 'group' ) ); ?><\/code>\n\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t<font class=\"litespeed-congratulate\"><?php esc_html_e( 'Congratulations, all gathered!', 'litespeed-cache' ); ?><\/font>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/imageopt\/#what-is-an-image-group\" target=\"_blank\" class=\"litespeed-desc litespeed-help-btn-icon\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'What is a group?', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-editor-help\"><\/span>\n\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'What is an image group?', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Current image post id position', 'litespeed-cache' ); ?>: <?php echo ! empty( $optm_summary['next_post_id'] ) ? esc_html( $optm_summary['next_post_id'] ) : '-'; ?><br>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Maximum image post id', 'litespeed-cache' ); ?>: <?php echo esc_html( $img_count['max_id'] ); ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\" style=\"display: none;\">\n\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RESCAN ) ); ?>\" class=\"\" data-balloon-pos=\"up\" data-balloon-length=\"large\" aria-label=\"<?php esc_html_e( 'Scan for any new unoptimized image thumbnail sizes and resend necessary image optimization requests.', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t<?php esc_html_e( 'Rescan New Thumbnails', 'litespeed-cache' ); ?>\n\t\t\t\t<\/a>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t<?php esc_html_e( 'Optimization Summary', 'litespeed-cache' ); ?>\n\t\t\t\t<\/h3>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Total Reduction', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['reduced'] ) ? esc_html( Utility::real_size( $optm_summary['reduced'] ) ) : '-'; ?><\/code>\n\t\t\t\t<\/p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Images Pulled', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['img_taken'] ) ? esc_html( $optm_summary['img_taken'] ) : '-'; ?><\/code>\n\t\t\t\t<\/p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Last Request', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['last_requested'] ) ? esc_html( Utility::readable_time( $optm_summary['last_requested'] ) ) : '-'; ?><\/code>\n\t\t\t\t<\/p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'Last Pulled', 'litespeed-cache' ); ?>: <code><?php echo isset( $optm_summary['last_pulled'] ) ? esc_html( Utility::readable_time( $optm_summary['last_pulled'] ) ) : '-'; ?><\/code>\n\t\t\t\t\t<?php\n\t\t\t\t\tif ( isset( $optm_summary['last_pulled_by_cron'] ) && $optm_summary['last_pulled_by_cron'] ) {\n\t\t\t\t\t\techo '(Cron)';\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact litespeed-desc\">\n\t\t\t\t<?php\n\t\t\t\tprintf(\n\t\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\t\tesc_html__( 'Results can be checked in %sMedia Library%s.', 'litespeed-cache' ),\n\t\t\t\t\t'<a href=\"upload.php?mode=list\">',\n\t\t\t\t\t'<\/a>'\n\t\t\t\t);\n\t\t\t\t?>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\"><?php esc_html_e( 'Optimization Tools', 'litespeed-cache' ); ?><\/h3>\n\n\t\t\t\t<p>\n\t\t\t\t\t<?php esc_html_e( 'You can quickly switch between using original (unoptimized versions) and optimized image files. It will affect all images on your website, both regular and webp versions if available.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/p>\n\n\t\t\t\t<div class=\"litespeed-links-group\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_BATCH_SWITCH_ORI ) ); ?>\" class=\"litespeed-link-with-icon\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'Use original images (unoptimized) on your site', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-undo\"><\/span><?php esc_html_e( 'Use Original Files', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/span><span>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_BATCH_SWITCH_OPTM ) ); ?>\" class=\"litespeed-link-with-icon litespeed-icon-right\" data-balloon-pos=\"up\" aria-label=\"<?php esc_html_e( 'Switch back to using optimized images on your site', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Use Optimized Files', 'litespeed-cache' ); ?><span class=\"dashicons dashicons-redo\"><\/span>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t<p>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_RESET_COUNTER ) ); ?>\" class=\"litespeed-link-with-icon litespeed-warning\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-dismiss\"><\/span><?php esc_html_e( 'Soft Reset Optimization Counter', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/p>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'This will reset the %1$s. If you changed WebP\/AVIF settings and want to generate %2$s for the previously optimized images, use this action.', 'litespeed-cache' ), '<code>' . esc_html__( 'Current image post id position', 'litespeed-cache' ) . '<\/code>', 'WebP\/AVIF' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t<p>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_DESTROY ) ); ?>\" class=\"litespeed-link-with-icon litespeed-danger\" data-litespeed-cfm=\"<?php esc_html_e( 'Are you sure to destroy all optimized images?', 'litespeed-cache' ); ?>\" id=\"litespeed-imageopt-destroy\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-dismiss\"><\/span><?php esc_html_e( 'Destroy All Optimization Data', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/p>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Remove all previous image optimization requests\/results, revert completed optimizations, and delete all optimization files.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/img_optm\/settings.media_webp.tpl.php","ext":"php","size":1568,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Image Optimization WebP\/AVIF Setting\n *\n * Manages the WebP and AVIF optimization settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n?>\n\n<tr>\n\t<th>\n\t\t<?php $option_id = Base::O_IMG_OPTM_WEBP; ?>\n\t\t<?php $this->title( $option_id ); ?>\n\t<\/th>\n\t<td>\n\t\t<?php $this->build_switch( $option_id, array( esc_html__( 'OFF', 'litespeed-cache' ), 'WebP', 'AVIF' ) ); ?>\n\t\t<?php Doc::maybe_on_by_gm( $option_id ); ?>\n\t\t<div class=\"litespeed-desc\">\n\t\t\t<?php esc_html_e( 'Request WebP\/AVIF versions of original images when doing optimization.', 'litespeed-cache' ); ?>\n\t\t\t<?php printf( esc_html__( 'Significantly improve load time by replacing images with their optimized %s versions.', 'litespeed-cache' ), '.webp\/.avif' ); ?>\n\t\t\t<br \/><?php Doc::notice_htaccess(); ?>\n\t\t\t<br \/><?php Doc::crawler_affected(); ?>\n\t\t\t<br \/>\n\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\u26a0\ufe0f <?php printf( esc_html__( '%1$s is a %2$s paid feature.', 'litespeed-cache' ), 'AVIF', 'QUIC.cloud' ); ?><\/font>\n\t\t\t<br \/>\n\t\t\t<font class=\"litespeed-warning\">\n\t\t\t\t\u26a0\ufe0f <?php printf( esc_html__( 'When switching formats, please %1$s or %2$s to apply this new choice to previously optimized images.', 'litespeed-cache' ), esc_html__( 'Destroy All Optimization Data', 'litespeed-cache' ), esc_html__( 'Soft Reset Optimization Counter', 'litespeed-cache' ) ); ?><\/font>\n\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/imageopt\/#soft-reset-optimization-counter' ); ?>\n\t\t<\/div>\n\t<\/td>\n<\/tr>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/img_optm\/settings.tpl.php","ext":"php","size":4322,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Image Optimization Settings\n *\n * Manages image optimization settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Image Optimization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/imageopt\/#image-optimization-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_AUTO; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically request optimization via cron job.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_ORI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Optimize images and save backups of the originals in the same folder.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_RM_BKUP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Automatically remove the original image backups after fetching optimized images.', 'litespeed-cache' ); ?>\n\n\t\t\t\t\t<br \/>\n\t\t\t\t\t<font class=\"litespeed-danger\">\n\t\t\t\t\t\t\ud83d\udea8\n\t\t\t\t\t\t<?php esc_html_e( 'This is irreversible.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<?php esc_html_e( 'You will be unable to Revert Optimization once the backups are deleted!', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/font>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_LOSSLESS; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Optimize images using lossless compression.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This can improve quality but may result in larger images than lossy compression will.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_EXIF; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Preserve EXIF data (copyright, GPS, comments, keywords, etc) when optimizing.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'This will increase the size of optimized files.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<?php\n\t\tif ( ! is_multisite() ) :\n\t\t\t\/\/ webp\n\t\t\trequire LSCWP_DIR . 'tpl\/img_optm\/settings.media_webp.tpl.php';\n\t\tendif;\n\t\t?>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_WEBP_ATTR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify which element attributes will be replaced with WebP\/AVIF.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Only attributes listed here will be replaced.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br \/><?php printf( esc_html__( 'Use the format %1$s or %2$s (element is optional).', 'litespeed-cache' ), '<code>element.attribute<\/code>', '<code>.attribute<\/code>' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_IMG_OPTM_WEBP_REPLACE_SRCSET; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Enable replacement of WebP\/AVIF in %s elements that were generated outside of WordPress logic.', 'litespeed-cache' ), '<code>srcset<\/code>' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/imageopt\/#webp-for-extra-srcset' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t<\/tbody>\n<\/table>\n\n<?php\n$this->form_end();\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/img_optm\/entry.tpl.php","ext":"php","size":1303,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Image Optimization\n *\n * Manages the image optimization interface for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n    'summary'  => esc_html__( 'Image Optimization Summary', 'litespeed-cache' ),\n    'settings' => esc_html__( 'Image Optimization Settings', 'litespeed-cache' ),\n);\n\nif ( is_network_admin() ) {\n    $menu_list = array(\n        'network_settings' => esc_html__( 'Image Optimization Settings', 'litespeed-cache' ),\n    );\n}\n\n?>\n\n<div class=\"wrap\">\n    <h1 class=\"litespeed-h1\">\n        <?php esc_html_e( 'LiteSpeed Cache Image Optimization', 'litespeed-cache' ); ?>\n    <\/h1>\n    <span class=\"litespeed-desc\">\n        v<?php echo esc_html( Core::VER ); ?>\n    <\/span>\n    <hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n    <h2 class=\"litespeed-header nav-tab-wrapper\">\n        <?php GUI::display_tab_list( $menu_list ); ?>\n    <\/h2>\n\n    <div class=\"litespeed-body\">\n        <?php\n        foreach ( $menu_list as $menu_key => $val ) {\n            echo '<div data-litespeed-layout=\"' . esc_attr( $menu_key ) . '\">';\n            require LSCWP_DIR . 'tpl\/img_optm\/' . $menu_key . '.tpl.php';\n            echo '<\/div>';\n        }\n        ?>\n    <\/div>\n\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/img_optm\/network_settings.tpl.php","ext":"php","size":715,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Image Optimization Network Settings\n *\n * Manages network-wide image optimization settings for LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action( Router::ACTION_SAVE_SETTINGS_NETWORK );\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Image Optimization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/imageopt\/#image-optimization-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<?php require LSCWP_DIR . 'tpl\/img_optm\/settings.media_webp.tpl.php'; ?>\n\n<\/tbody><\/table>\n\n<?php\n$this->form_end();"},{"base":"plugins","rel":"litespeed-cache\/tpl\/dash\/network_dash.tpl.php","ext":"php","size":4770,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Network Dashboard\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$cloud_summaries = array();\n$blogs           = Activation::get_network_ids();\nforeach ( $blogs as $network_blog_id ) {\n\tswitch_to_blog( $network_blog_id );\n\t$cloud_summaries[ home_url() ] = Cloud::get_summary();\n\t\/\/ May need restore_current_blog();\n}\n\n?>\n\n<div class=\"litespeed-dashboard\">\n<?php foreach ( $cloud_summaries as $home_url => $cloud_summary ) : ?>\n\n\t<div class=\"litespeed-dashboard-header\">\n\t\t<h3 class=\"litespeed-dashboard-title\">\n\t\t\t<?php echo esc_html( sprintf( __( 'Usage Statistics: %s', 'litespeed-cache' ), $home_url ) ); ?>\n\t\t<\/h3>\n\t\t<hr>\n\t<\/div>\n\n\t<div class=\"litespeed-dashboard-stats-wrapper\">\n\t\t<?php\n\t\t$cat_list = array(\n\t\t\t'img_optm'  => esc_html__( 'Image Optimization', 'litespeed-cache' ),\n\t\t\t'page_optm' => esc_html__( 'Page Optimization', 'litespeed-cache' ),\n\t\t\t'cdn'       => esc_html__( 'CDN Bandwidth', 'litespeed-cache' ),\n\t\t\t'lqip'      => esc_html__( 'Low Quality Image Placeholder', 'litespeed-cache' ),\n\t\t);\n\n\t\tforeach ( $cat_list as $svc => $svc_title ) :\n\t\t\t$finished_percentage = 0;\n\t\t\t$total_used          = '-';\n\t\t\t$used                = '-';\n\t\t\t$quota               = '-';\n\t\t\t$pag_used            = '-';\n\t\t\t$pag_total           = '-';\n\t\t\t$pag_width           = 0;\n\t\t\t$pag_bal             = 0;\n\n\t\t\tif ( ! empty( $cloud_summary[ 'usage.' . $svc ] ) ) {\n\t\t\t\t$usage               = $cloud_summary[ 'usage.' . $svc ];\n\t\t\t\t$finished_percentage = floor( $usage['used'] * 100 \/ $usage['quota'] );\n\t\t\t\t$used                = $usage['used'];\n\t\t\t\t$quota               = $usage['quota'];\n\t\t\t\t$pag_used            = ! empty( $usage['pag_used'] ) ? $usage['pag_used'] : 0;\n\t\t\t\t$pag_bal             = ! empty( $usage['pag_bal'] ) ? $usage['pag_bal'] : 0;\n\t\t\t\t$pag_total           = $pag_used + $pag_bal;\n\n\t\t\t\tif ( $pag_total ) {\n\t\t\t\t\t$pag_width = round( $pag_used \/ $pag_total * 100 ) . '%';\n\t\t\t\t}\n\n\t\t\t\tif ( 'cdn' === $svc ) {\n\t\t\t\t\t$used      = Utility::real_size( $used * 1024 * 1024 );\n\t\t\t\t\t$quota     = Utility::real_size( $quota * 1024 * 1024 );\n\t\t\t\t\t$pag_used  = Utility::real_size( $pag_used * 1024 * 1024 );\n\t\t\t\t\t$pag_total = Utility::real_size( $pag_total * 1024 * 1024 );\n\t\t\t\t}\n\n\t\t\t\tif ( ! empty( $usage['total_used'] ) ) {\n\t\t\t\t\t$total_used = $usage['total_used'];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$percentage_bg = 'success';\n\t\t\tif ( 95 < $finished_percentage ) {\n\t\t\t\t$percentage_bg = 'danger';\n\t\t\t} elseif ( 85 < $finished_percentage ) {\n\t\t\t\t$percentage_bg = 'warning';\n\t\t\t}\n\t\t\t?>\n\n\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t<h3 class=\"litespeed-title\"><?php echo esc_html( $svc_title ); ?><\/h3>\n\n\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle litespeed-pie-<?php echo esc_attr( $percentage_bg ); ?>\">\n\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $finished_percentage, 60, false ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"litespeed-dashboard-stats\">\n\t\t\t\t\t\t\t\t<h3><?php echo esc_html( 'img_optm' === $svc ? __( 'Fast Queue Usage', 'litespeed-cache' ) : __( 'Usage', 'litespeed-cache' ) ); ?><\/h3>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<strong><?php echo esc_html( $used ); ?><\/strong>\n\t\t\t\t\t\t\t\t\t<?php if ( $quota !== $used ) : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-desc\"> \/ <?php echo esc_html( $quota ); ?><\/span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<?php if ( 0 < $pag_total ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-payg\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr__( 'Pay as You Go', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'PAYG Balance', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $pag_bal ); ?><\/strong>\n\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr( sprintf( __( 'This Month Usage: %s', 'litespeed-cache' ), esc_html( $pag_used ) ) ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"><\/span>\n\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Pay as You Go Usage Statistics', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php endif; ?>\n\n\t\t\t\t\t<?php if ( 'img_optm' === $svc ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Total Usage', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $total_used ); ?> \/ \u221e<\/strong>\n\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr__( 'Total images optimized in this month', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"><\/span>\n\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<div class=\"clear\"><\/div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t<?php endforeach; ?>\n\t<\/div>\n\n<?php endforeach; ?>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/dash\/entry.tpl.php","ext":"php","size":964,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Dashboard Wrapper\n *\n * Renders the main dashboard page for the LiteSpeed Cache plugin in the WordPress admin area.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'dashboard' => esc_html__( 'Dashboard', 'litespeed-cache' ),\n);\n\nif ( $this->_is_network_admin ) {\n\t$menu_list = array(\n\t\t'network_dash' => esc_html__( 'Network Dashboard', 'litespeed-cache' ),\n\t);\n}\n\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php echo esc_html__( 'LiteSpeed Cache Dashboard', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\t<?php\n\tforeach ( $menu_list as $tab_key => $tab_val ) {\n\t\techo '<div data-litespeed-layout=\"' . esc_attr( $tab_key ) . '\">';\n\t\trequire LSCWP_DIR . 'tpl\/dash\/' . $tab_key . '.tpl.php';\n\t\techo '<\/div>';\n\t}\n\t?>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/dash\/dashboard.tpl.php","ext":"php","size":44871,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Dashboard\n *\n * Displays the dashboard for LiteSpeed Cache plugin, including cache status,\n * crawler status, QUIC.cloud service usage, and optimization statistics.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$health_scores   = Health::cls()->scores();\n$crawler_summary = Crawler::get_summary();\n\n\/\/ Image related info\n$img_optm_summary        = Img_Optm::get_summary();\n$img_count               = Img_Optm::cls()->img_count();\n$img_finished_percentage = 0;\nif ( ! empty( $img_count['groups_all'] ) ) {\n\t$img_finished_percentage = 100 - floor( $img_count['groups_new'] * 100 \/ $img_count['groups_all'] );\n}\nif ( 100 === $img_finished_percentage && ! empty( $img_count['groups_new'] ) ) {\n\t$img_finished_percentage = 99;\n}\n\n$cloud_instance = Cloud::cls();\n$cloud_instance->finish_qc_activation();\n\n$cloud_summary           = Cloud::get_summary();\n$css_summary             = CSS::get_summary();\n$ucss_summary            = UCSS::get_summary();\n$placeholder_summary     = Placeholder::get_summary();\n$vpi_summary             = VPI::get_summary();\n$ccss_count              = count( $this->load_queue( 'ccss' ) );\n$ucss_count              = count( $this->load_queue( 'ucss' ) );\n$placeholder_queue_count = count( $this->load_queue( 'lqip' ) );\n$vpi_queue_count         = count( $this->load_queue( 'vpi' ) );\n$can_page_load_time      = defined( 'LITESPEED_SERVER_TYPE' ) && 'NONE' !== LITESPEED_SERVER_TYPE;\n\n?>\n\n<div class=\"litespeed-dashboard\">\n\t<?php if ( ! $cloud_instance->activated() && ! Admin_Display::has_qc_hide_banner() ) : ?>\n\t\t<div class=\"litespeed-dashboard-group\">\n\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-cache\">\n\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Cache Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-cache' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$cache_list = array(\n\t\t\t\t\t\t\tBase::O_CACHE         => esc_html__( 'Public Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\tBase::O_CACHE_PRIV    => esc_html__( 'Private Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\tBase::O_OBJECT        => esc_html__( 'Object Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\tBase::O_CACHE_BROWSER => esc_html__( 'Browser Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tforeach ( $cache_list as $cache_option => $cache_title ) :\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php if ( $this->conf( $cache_option ) ) : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php echo esc_html( $cache_title ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-crawler\">\n\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Crawler Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<code><?php echo esc_html( count( Crawler::cls()->list_crawlers() ) ); ?><\/code> <?php esc_html_e( 'Crawler(s)', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Currently active crawler', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $crawler_summary['curr_crawler'] ); ?><\/code>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['curr_crawler_beginning_time'] ) ) : ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Current crawler started at', 'litespeed-cache' ); ?>:<\/span>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['curr_crawler_beginning_time'] ) ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_start_time'] ) ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Last interval', 'litespeed-cache' ); ?>:<\/span>\n\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['last_start_time'] ) ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['end_reason'] ) ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Ended reason', 'litespeed-cache' ); ?>:<\/span>\n\t\t\t\t\t\t\t\t<?php echo esc_html( $crawler_summary['end_reason'] ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_crawled'] ) ) : ?>\n\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( '%1$s %2$d item(s)', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t'<span class=\"litespeed-bold\">' . esc_html__( 'Last crawled:', 'litespeed-cache' ) . '<\/span>',\n\t\t\t\t\t\t\t\t\tesc_html( $crawler_summary['last_crawled'] )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t\t<?php\n\t\t\t\t$news = $cloud_instance->load_qc_status_for_dash( 'news_dash_guest' );\n\t\t\t\tif ( ! empty( $news ) ) :\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t\t\t<div class=\"inside litespeed-text-center\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'News', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t\t\t\t\t<?php echo wp_kses_post( $news ); ?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<?php endif; ?>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<?php endif; ?>\n\n\t<div class=\"litespeed-dashboard-qc\">\n\t\t<?php if ( ! $cloud_instance->activated() && ! Admin_Display::has_qc_hide_banner() ) : ?>\n\t\t\t<div class=\"litespeed-dashboard-unlock\">\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"litespeed-dashboard-unlock-title\">\n\t\t\t\t\t\t<strong class=\"litespeed-qc-text-gradient\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Accelerate, Optimize, Protect', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/strong>\n\t\t\t\t\t<\/h3>\n\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-desc\">\n\t\t\t\t\t\t<?php echo wp_kses_post( __( 'Speed up your WordPress site even further with <strong>QUIC.cloud Online Services and CDN<\/strong>.', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php esc_html_e( 'Free monthly quota available. Can also be used anonymously (no email required).', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE ) ); ?>\">\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-yes\"><\/span>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<a class=\"button button-link litespeed-top10\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_ADMIN_DISPLAY, Admin_Display::TYPE_QC_HIDE_BANNER ) ); ?>\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Do not show this again', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-footer\">\n\t\t\t\t\t\t<?php esc_html_e( 'QUIC.cloud provides CDN and online optimization services, and is not required. You may use many features of this plugin without QUIC.cloud.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t\t<a href=\"https:\/\/www.quic.cloud\/\" target=\"_blank\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Learn More about QUIC.cloud', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<?php endif; ?>\n\n\t\t<div class=\"litespeed-dashboard-qc-enable\">\n\t\t\t<div class=\"litespeed-dashboard-header\">\n\t\t\t\t<h3 class=\"litespeed-dashboard-title litespeed-dashboard-title--w-btn\">\n\t\t\t\t\t<span class=\"litespeed-right10\"><?php esc_html_e( 'QUIC.cloud Service Usage Statistics', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_SYNC_USAGE ) ); ?>\" class=\"button button-secondary button-small\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span> <?php esc_html_e( 'Refresh Usage', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Sync data from Cloud', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/h3>\n\t\t\t\t<hr>\n\t\t\t\t<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/dashboard\/#usage-statistics\" target=\"_blank\" class=\"litespeed-learn-more\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a>\n\t\t\t<\/div>\n\n\t\t\t<?php if ( ! $cloud_instance->activated() && Admin_Display::has_qc_hide_banner() ) : ?>\n\t\t\t\t<p class=\"litespeed-desc litespeed-margin-top-remove\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'The features below are provided by %s', 'litespeed-cache' ),\n\t\t\t\t\t\t'<a href=\"https:\/\/quic.cloud\" target=\"_blank\">QUIC.cloud<\/a>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/p>\n\t\t\t<?php endif; ?>\n\n\t\t\t<div class=\"litespeed-dashboard-stats-wrapper\">\n\t\t\t\t<?php\n\t\t\t\t$cat_list = array(\n\t\t\t\t\t'img_optm'  => esc_html__( 'Image Optimization', 'litespeed-cache' ),\n\t\t\t\t\t'page_optm' => esc_html__( 'Page Optimization', 'litespeed-cache' ),\n\t\t\t\t\t'cdn'       => esc_html__( 'CDN Bandwidth', 'litespeed-cache' ),\n\t\t\t\t\t'lqip'      => esc_html__( 'Low Quality Image Placeholder', 'litespeed-cache' ),\n\t\t\t\t);\n\n\t\t\t\tforeach ( $cat_list as $svc => $svc_title ) :\n\t\t\t\t\t$finished_percentage = 0;\n\t\t\t\t\t$total_used          = '-';\n\t\t\t\t\t$used                = '-';\n\t\t\t\t\t$quota               = '-';\n\t\t\t\t\t$pag_used            = '-';\n\t\t\t\t\t$pag_total           = '-';\n\t\t\t\t\t$pag_width           = 0;\n\t\t\t\t\t$percentage_bg       = 'success';\n\t\t\t\t\t$pag_txt_color       = '';\n\t\t\t\t\t$usage               = false;\n\n\t\t\t\t\tif ( ! empty( $cloud_summary[ 'usage.' . $svc ] ) ) {\n\t\t\t\t\t\t$usage               = $cloud_summary[ 'usage.' . $svc ];\n\t\t\t\t\t\t$finished_percentage = floor( $usage['used'] * 100 \/ $usage['quota'] );\n\t\t\t\t\t\t$used                = (int) $usage['used'];\n\t\t\t\t\t\t$quota               = (int) $usage['quota'];\n\t\t\t\t\t\t$pag_used            = ! empty( $usage['pag_used'] ) ? (int) $usage['pag_used'] : 0;\n\t\t\t\t\t\t$pag_bal             = ! empty( $usage['pag_bal'] ) ? (int) $usage['pag_bal'] : 0;\n\t\t\t\t\t\t$pag_total           = $pag_used + $pag_bal;\n\t\t\t\t\t\tif ( ! empty( $usage['total_used'] ) ) {\n\t\t\t\t\t\t\t$total_used = (int) $usage['total_used'];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( $pag_total ) {\n\t\t\t\t\t\t\t$pag_width = round( $pag_used \/ $pag_total * 100 ) . '%';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( $finished_percentage > 85 ) {\n\t\t\t\t\t\t\t$percentage_bg = 'warning';\n\t\t\t\t\t\t\tif ( $finished_percentage > 95 ) {\n\t\t\t\t\t\t\t\t$percentage_bg = 'danger';\n\t\t\t\t\t\t\t\tif ( $pag_bal ) {\n\t\t\t\t\t\t\t\t\t$percentage_bg = 'warning';\n\t\t\t\t\t\t\t\t\t$pag_txt_color = 'litespeed-success';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t?>\n\t\t\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\"><?php echo esc_html( $svc_title ); ?><\/h3>\n\t\t\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle litespeed-pie-<?php echo esc_attr( $percentage_bg ); ?>\">\n\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $finished_percentage, 60, false ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-dashboard-stats\">\n\t\t\t\t\t\t\t\t\t\t<h3><?php echo 'img_optm' === $svc ? esc_html__( 'Fast Queue Usage', 'litespeed-cache' ) : esc_html__( 'Usage', 'litespeed-cache' ); ?><\/h3>\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<strong><?php echo esc_html( $used ); ?><\/strong>\n\t\t\t\t\t\t\t\t\t\t\t<?php if ( $used !== $quota ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-desc\"> \/ <?php echo esc_html( $quota ); ?><\/span>\n\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<?php if ( $pag_total > 0 ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-payg <?php echo esc_attr( $pag_txt_color ); ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'PAYG Balance', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $pag_bal ); ?><\/strong>\n\t\t\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php echo esc_attr( sprintf( esc_html__( 'PAYG used this month: %s. PAYG balance and usage not included in above quota calculation.', 'litespeed-cache' ), $pag_used ) ); ?>\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"><\/span>\n\t\t\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Pay as You Go Usage Statistics', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( 'page_optm' === $svc && ! empty( $usage['sub_svc'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t$i = 0;\n\t\t\t\t\t\t\t\t\tforeach ( $usage['sub_svc'] as $sub_svc => $sub_usage ) :\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"<?php echo $i++ > 0 ? 'litespeed-left10' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( strtoupper( $sub_svc ) ); ?>: <strong><?php echo (int) $sub_usage; ?><\/strong>\n\t\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( 'img_optm' === $svc ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Total Usage', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $total_used ); ?> \/ \u221e<\/strong>\n\t\t\t\t\t\t\t\t\t<button class=\"litespeed-info-button\" data-balloon-pos=\"up\" aria-label=\"<?php esc_attr_e( 'Total images optimized in this month', 'litespeed-cache' ); ?>\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-info\"><\/span>\n\t\t\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<div class=\"clear\"><\/div>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( isset( $usage['remaining_daily_quota'] ) && $usage['remaining_daily_quota'] >= 0 && isset( $usage['daily_quota'] ) && $usage['daily_quota'] >= 0 ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-dashboard-stats-total\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Remaining Daily Quota', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $usage['remaining_daily_quota'] ); ?> \/ <?php echo esc_html( $usage['daily_quota'] ); ?><\/strong>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<div class=\"clear\"><\/div>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<?php endforeach; ?>\n\t\t\t\t<?php if ( ! empty( $cloud_summary['partner'] ) ) : ?>\n\t\t\t\t\t<div class=\"litespeed-postbox litespeed-postbox-partner\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\"><?php esc_html_e( 'Partner Benefits Provided by', 'litespeed-cache' ); ?><\/h3>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['logo'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php elseif ( ! empty( $cloud_summary['partner']['name'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?><\/span>\n\t\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?><\/span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<?php endif; ?>\n\t\t\t<\/div>\n\n\t\t\t<p class=\"litespeed-right litespeed-qc-dashboard-link\">\n\t\t\t\t<?php\n\t\t\t\tif ( ! empty( $cloud_summary['partner'] ) && ! empty( $cloud_summary['partner']['login_title'] ) && ! empty( $cloud_summary['partner']['login_link'] ) ) :\n\t\t\t\t\tDoc::learn_more( $cloud_summary['partner']['login_link'], $cloud_summary['partner']['login_title'], true, 'button litespeed-btn-warning' );\n\t\t\t\telseif ( ! empty( $cloud_summary['partner'] ) && ! empty( $cloud_summary['partner']['disable_qc_login'] ) ) :\n\t\t\t\t\t\/\/ Skip rendering any link or button.\n\t\t\t\t\techo '';\n\t\t\t\telse :\n\t\t\t\t\tif ( ! $cloud_instance->activated() ) :\n\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\tUtility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE ),\n\t\t\t\t\t\t\tesc_html__( 'Enable QUIC.cloud Services', 'litespeed-cache' ),\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t'button litespeed-btn-warning'\n\t\t\t\t\t\t);\n\t\t\t\t\telseif ( ! empty( $cloud_summary['qc_activated'] ) && 'anonymous' !== $cloud_summary['qc_activated'] ) :\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_instance->qc_link() ); ?>\" class=\"litespeed-link-with-icon\" target=\"qc\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Go to QUIC.cloud dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"><\/span>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\tUtility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_LINK ),\n\t\t\t\t\t\t\tesc_html__( 'Link to QUIC.cloud', 'litespeed-cache' ),\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t'button litespeed-btn-warning'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t<\/p>\n\n\t\t\t<div class=\"litespeed-dashboard-group\">\n\t\t\t\t<hr>\n\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-pagetime\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Page Load Time', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php if ( $can_page_load_time ) : ?>\n\t\t\t\t\t\t\t\t\t<?php $closest_server = Cloud::get_summary( 'server.' . Cloud::SVC_HEALTH ); ?>\n\t\t\t\t\t\t\t\t\t<?php if ( $closest_server ) : ?>\n\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_REDETECT_CLOUD, false, null, array( 'svc' => Cloud::SVC_HEALTH ) ) ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\tdata-balloon-pos=\"up\"\n\t\t\t\t\t\t\t\t\t\t\tdata-balloon-break\n\t\t\t\t\t\t\t\t\t\t\taria-label=\"<?php echo esc_attr( sprintf( esc_html__( 'Current closest Cloud server is %s. Click to redetect.', 'litespeed-cache' ), esc_html( $closest_server ) ) ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\tdata-litespeed-cfm=\"<?php esc_attr_e( 'Are you sure you want to redetect the closest cloud server for this service?', 'litespeed-cache' ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"litespeed-title-right-icon\">\n\t\t\t\t\t\t\t\t\t\t\t<i class='litespeed-quic-icon'><\/i> <small><?php esc_html_e( 'Redetect', 'litespeed-cache' ); ?><\/small>\n\t\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t\t\t\t<?php if ( $can_page_load_time && ! empty( $health_scores['speed_before'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-score-col\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Before', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-text-md litespeed-text-grey\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_before'] ); ?><span class=\"litespeed-text-large\">s<\/span>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-score-col\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'After', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-text-md litespeed-text-success\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_after'] ); ?><span class=\"litespeed-text-large\">s<\/span>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-score-col litespeed-score-col--imp\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-text-jumbo litespeed-text-success\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['speed_improved'] ); ?><span class=\"litespeed-text-large\">%<\/span>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<p><?php esc_html_e( 'You must be using one of the following products in order to measure Page Load Time:', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https:\/\/www.litespeedtech.com\/products\/litespeed-web-server\" target=\"_blank\"><?php esc_html_e( 'LiteSpeed Web Server', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https:\/\/openlitespeed.org\/\" target=\"_blank\"><?php esc_html_e( 'OpenLiteSpeed Web Server', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https:\/\/www.litespeedtech.com\/products\/litespeed-web-adc\" target=\"_blank\"><?php esc_html_e( 'LiteSpeed Web ADC', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t\t\t\t\t<br \/>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"https:\/\/quic.cloud\" target=\"_blank\"><?php esc_html_e( 'QUIC.cloud CDN', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( $can_page_load_time ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.health-speed'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-right10\">\n\t\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\t\tesc_html__( 'Requested: %s ago', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t\t'<span data-balloon-pos=\"up\" aria-label=\"' . esc_attr( Utility::readable_time( $cloud_summary['last_request.health-speed'] ) ) . '\">' . esc_html( human_time_diff( $cloud_summary['last_request.health-speed'] ) ) . '<\/span>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_HEALTH, Health::TYPE_SPEED ) ); ?>\" class=\"button button-secondary button-small\">\n\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span>\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Refresh', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Refresh page load time', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-pagespeed\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'PageSpeed Score', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php $guest_option = Base::O_GUEST; ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-general#settings' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php echo esc_html( Lang::title( $guest_option ) ); ?><\/a>\n\t\t\t\t\t\t\t\t<?php if ( $this->conf( $guest_option ) ) : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-margin-bottom20\">\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-row-flex\" style=\"margin-left: -10px;\">\n\t\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $health_scores['score_before'] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Before', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $health_scores['score_before'], 45, false, true, 'litespeed-pie-' . esc_attr( GUI::cls()->get_cls_of_pagescore( $health_scores['score_before'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey litespeed-text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'After', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-promo-score\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $health_scores['score_after'], 45, false, true, 'litespeed-pie-' . esc_attr( GUI::cls()->get_cls_of_pagescore( $health_scores['score_after'] ) ) ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-width-1-3 litespeed-padding-space litespeed-margin-x5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-text-grey\" style=\"white-space: nowrap;\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Improved by', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-postbox-score-improve litespeed-text-fern\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( $health_scores['score_improved'] ); ?><span class=\"litespeed-text-large\">%<\/span>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.health-score'] ) ) : ?>\n\t\t\t\t\t\t\t\t<span class=\"litespeed-right10\">\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Requested: %s ago', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<span data-balloon-pos=\"up\" aria-label=\"' . esc_attr( Utility::readable_time( $cloud_summary['last_request.health-score'] ) ) . '\">' . esc_html( human_time_diff( $cloud_summary['last_request.health-score'] ) ) . '<\/span>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_HEALTH, Health::TYPE_SCORE ) ); ?>\" class=\"button button-secondary button-small\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Refresh', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Refresh page score', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-double litespeed-postbox-imgopt\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Image Optimization Summary', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-img_optm' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<div class=\"litespeed-postbox-double-content\">\n\t\t\t\t\t\t\t\t<div class=\"litespeed-postbox-double-col\">\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-flex-container\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-icon-vertical-middle\">\n\t\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses( GUI::pie( $img_finished_percentage, 70, true ), GUI::allowed_svg_tags() ); ?>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"litespeed-dashboard-stats\">\n\t\t\t\t\t\t\t\t\t\t\t\t<a data-litespeed-onlyonce class=\"button button-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $img_count['groups_new'] ) || ! empty( $img_count[ 'groups.' . Img_Optm::STATUS_RAW ] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"<?php echo esc_url( Utility::build_url( Router::ACTION_IMG_OPTM, Img_Optm::TYPE_NEW_REQ ) ); ?>\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"javascript:;\" disabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-images-alt2\"><\/span><?php esc_html_e( 'Send Optimization Request', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Total Reduction', 'litespeed-cache' ); ?>: <code><?php echo isset( $img_optm_summary['reduced'] ) ? esc_html( Utility::real_size( $img_optm_summary['reduced'] ) ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Images Pulled', 'litespeed-cache' ); ?>: <code><?php echo isset( $img_optm_summary['img_taken'] ) ? esc_html( $img_optm_summary['img_taken'] ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-postbox-double-col\">\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Images requested', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_REQUESTED ] ) ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_REQUESTED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<?php if ( ! empty( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<p class=\"litespeed-success\">\n\t\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Images notified to pull', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'group.' . Img_Optm::STATUS_NOTIFIED ] ) ); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t(<?php echo esc_html( Admin_Display::print_plural( $img_count[ 'img.' . Img_Optm::STATUS_NOTIFIED ], 'image' ) ); ?>)\n\t\t\t\t\t\t\t\t\t\t\t<\/code>\n\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Last Request', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $img_optm_summary['last_requested'] ) ? esc_html( Utility::readable_time( $img_optm_summary['last_requested'] ) ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Last Pull', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $img_optm_summary['last_pull'] ) ? esc_html( Utility::readable_time( $img_optm_summary['last_pull'] ) ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t$opt_list = array(\n\t\t\t\t\t\t\t\t\t\tBase::O_IMG_OPTM_AUTO => Lang::title( Base::O_IMG_OPTM_AUTO ),\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tforeach ( $opt_list as $opt_id => $opt_title ) :\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<?php if ( $this->conf( $opt_id ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-img_optm#settings' ) ); ?>\"><?php echo esc_html( $opt_title ); ?><\/a>\n\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-cache\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Cache Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-cache' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t$cache_list = array(\n\t\t\t\t\t\t\t\tBase::O_CACHE         => esc_html__( 'Public Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tBase::O_CACHE_PRIV    => esc_html__( 'Private Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tBase::O_OBJECT        => esc_html__( 'Object Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tBase::O_CACHE_BROWSER => esc_html__( 'Browser Cache', 'litespeed-cache' ),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tforeach ( $cache_list as $cache_option => $cache_title ) :\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php if ( $this->conf( $cache_option ) ) : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-success litespeed-label-dashboard\"><?php esc_html_e( 'ON', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"litespeed-label-danger litespeed-label-dashboard\"><?php esc_html_e( 'OFF', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( $cache_title ); ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-ccss\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Critical CSS', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_css' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $css_summary['last_request_ccss'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $css_summary['last_request_ccss'] ) ) . '<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $css_summary['last_spent_ccss'] ) . 's<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $ccss_count ) ? esc_html( $ccss_count ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $ccss_count ) ? esc_url( Utility::build_url( Router::ACTION_CSS, CSS::TYPE_GEN_CCSS ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $ccss_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.ccss'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.ccss'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-ucss\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Unique CSS', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_css' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $ucss_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $ucss_summary['last_request'] ) ) . '<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $ucss_summary['last_spent'] ) . 's<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $ucss_count ) ? esc_html( $ucss_count ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $ucss_count ) ? esc_url( Utility::build_url( Router::ACTION_UCSS, UCSS::TYPE_GEN ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $ucss_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.ucss'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.ucss'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-lqip\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Low Quality Image Placeholder', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_media' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $placeholder_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $placeholder_summary['last_request'] ) ) . '<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $placeholder_summary['last_spent'] ) . 's<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $placeholder_queue_count ) ? esc_html( $placeholder_queue_count ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $placeholder_queue_count ) ? esc_url( Utility::build_url( Router::ACTION_PLACEHOLDER, Placeholder::TYPE_GENERATE ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $placeholder_queue_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.lqip'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.lqip'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-vpi\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Viewport Image', 'litespeed-cache' ); ?> (VPI)\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-page_optm#settings_vpi' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<?php if ( ! empty( $vpi_summary['last_request'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Last generated: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( Utility::readable_time( $vpi_summary['last_request'] ) ) . '<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Time to execute previous request: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<code>' . esc_html( $vpi_summary['last_spent'] ) . 's<\/code>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Requests in queue', 'litespeed-cache' ); ?>: <code><?php echo ! empty( $vpi_queue_count ) ? esc_html( $vpi_queue_count ) : '-'; ?><\/code>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo ! empty( $vpi_queue_count ) ? esc_url( Utility::build_url( Router::ACTION_VPI, VPI::TYPE_GEN ) ) : 'javascript:;'; ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-secondary button-small <?php echo empty( $vpi_queue_count ) ? 'disabled' : ''; ?>\">\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Force cron', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['last_request.vpi'] ) ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\tesc_html__( 'Last requested: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\tesc_html( Utility::readable_time( $cloud_summary['last_request.vpi'] ) )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-crawler\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Crawler Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<code><?php echo esc_html( count( Crawler::cls()->list_crawlers() ) ); ?><\/code> <?php esc_html_e( 'Crawler(s)', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Currently active crawler', 'litespeed-cache' ); ?>: <code><?php echo esc_html( $crawler_summary['curr_crawler'] ); ?><\/code>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['curr_crawler_beginning_time'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Current crawler started at', 'litespeed-cache' ); ?>:<\/span>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['curr_crawler_beginning_time'] ) ); ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_start_time'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Last interval', 'litespeed-cache' ); ?>:<\/span>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( Utility::readable_time( $crawler_summary['last_start_time'] ) ); ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['end_reason'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t\t<span class=\"litespeed-bold\"><?php esc_html_e( 'Ended reason', 'litespeed-cache' ); ?>:<\/span>\n\t\t\t\t\t\t\t\t\t<?php echo esc_html( $crawler_summary['end_reason'] ); ?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $crawler_summary['last_crawled'] ) ) : ?>\n\t\t\t\t\t\t\t\t<p class=\"litespeed-desc\">\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( '%1$s %2$d item(s)', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t'<span class=\"litespeed-bold\">' . esc_html__( 'Last crawled:', 'litespeed-cache' ) . '<\/span>',\n\t\t\t\t\t\t\t\t\t\tesc_html( $crawler_summary['last_crawled'] )\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<div class=\"postbox litespeed-postbox litespeed-postbox-quiccloud <?php echo empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ? 'litespeed-postbox--quiccloud' : ''; ?>\">\n\t\t\t\t\t\t<div class=\"inside\">\n\t\t\t\t\t\t\t<h3 class=\"litespeed-title litespeed-dashboard-title--w-btn\">\n\t\t\t\t\t\t\t\t<span class=\"litespeed-quic-icon\"><\/span><?php esc_html_e( 'QUIC.cloud CDN', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t<?php if ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t\t\t\t<a href=\"https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/litespeed-cache-service\/\" class=\"litespeed-title-right-icon\" target=\"_blank\"><?php esc_html_e( 'Learn More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-cdn' ) ); ?>\" class=\"litespeed-title-right-icon\"><?php esc_html_e( 'More', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t<?php if ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-text-center litespeed-empty-space-medium\">\n\t\t\t\t\t\t\t\t\t<p class=\"litespeed-margin-bottom20\">\n\t\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\t\t\t\tesc_url( Utility::build_url( Router::ACTION_CLOUD, $cloud_instance->activated() ? Cloud::TYPE_ENABLE_CDN : Cloud::TYPE_ACTIVATE ) ),\n\t\t\t\t\t\t\t\t\t\t\t'<span class=\"dashicons dashicons-saved\"><\/span>' . esc_html__( 'Enable QUIC.cloud CDN', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\t\t'button button-primary litespeed-button-cta'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<p class=\"litespeed-margin-bottom10 litespeed-top20 litespeed-text-md\">\n\t\t\t\t\t\t\t\t\t\t<strong class=\"litespeed-qc-text-gradient\"><?php esc_html_e( 'Best available WordPress performance', 'litespeed-cache' ); ?><\/strong>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t<p class=\"litespeed-margin-bottom20 litespeed-margin-top-remove\">\n\t\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\t\tesc_html__( 'Globally fast TTFB, easy setup, and %s!', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\t\t'<a href=\"https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/litespeed-cache-service\/\" target=\"_blank\">' . esc_html__( 'more', 'litespeed-cache' ) . '<\/a>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t\t<?php echo wp_kses_post( $cloud_instance->load_qc_status_for_dash( 'cdn_dash_mini' ) ); ?>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php if ( $cloud_instance->activated() ) : ?>\n\t\t\t\t\t\t\t<div class=\"inside litespeed-postbox-footer litespeed-postbox-footer--compact\">\n\t\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_SYNC_STATUS ) ); ?>\"\n\t\t\t\t\t\t\t\t\tclass=\"button button-<?php echo 'cdn' !== $cloud_summary['qc_activated'] ? 'link' : 'secondary'; ?> button-small\">\n\t\t\t\t\t\t\t\t\t<?php if ( 'cdn' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span>\n\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'Refresh Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t<span class=\"screen-reader-text\"><?php esc_html_e( 'Refresh QUIC.cloud status', 'litespeed-cache' ); ?><\/span>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<?php\n\t\t\t\t\t$promo_mini = $cloud_instance->load_qc_status_for_dash( 'promo_mini' );\n\t\t\t\t\tif ( $promo_mini ) :\n\t\t\t\t\t\techo wp_kses_post( $promo_mini );\n\t\t\t\t\tendif;\n\t\t\t\t\t?>\n\n\t\t\t\t\t<?php if ( $cloud_instance->activated() ) : ?>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$news = $cloud_instance->load_qc_status_for_dash( 'news_dash' );\n\t\t\t\t\t\tif ( $news ) :\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t\t\t\t\t\t<div class=\"inside litespeed-text-center\">\n\t\t\t\t\t\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t\t\t\t\t\t<?php esc_html_e( 'News', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t\t\t\t\t\t\t<?php echo wp_kses_post( $news ); ?>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/crawler\/summary.tpl.php","ext":"php","size":18505,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Crawler Summary\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__crawler    = Crawler::cls();\n$crawler_list = $__crawler->list_crawlers();\n$summary      = Crawler::get_summary();\n\nif ( $summary['curr_crawler'] >= count( $crawler_list ) ) {\n\t$summary['curr_crawler'] = 0;\n}\n\n$is_running = time() - $summary['is_running'] <= 900;\n\n$disabled     = Router::can_crawl() ? '' : 'disabled';\n$disabled_tip = '';\nif ( ! $this->conf( Base::O_CRAWLER_SITEMAP ) ) {\n\t$disabled     = 'disabled';\n\t$disabled_tip = '<span class=\"litespeed-callout notice notice-error inline litespeed-left20\">' . sprintf(\n\t\tesc_html__( 'You need to set the %s in Settings first before using the crawler', 'litespeed-cache' ),\n\t\t'<code>' . esc_html( Lang::title( Base::O_CRAWLER_SITEMAP ) ) . '<\/code>'\n\t) . '<\/span>';\n}\n\n$crawler_run_interval = defined( 'LITESPEED_CRAWLER_RUN_INTERVAL' ) ? LITESPEED_CRAWLER_RUN_INTERVAL : 600;\nif ( $crawler_run_interval > 0 ) :\n\t$recurrence = '';\n\t$hours      = (int) floor( $crawler_run_interval \/ 3600 );\n\tif ( $hours ) {\n\t\t$recurrence .= sprintf(\n\t\t\t$hours > 1 ? esc_html__( '%d hours', 'litespeed-cache' ) : esc_html__( '%d hour', 'litespeed-cache' ),\n\t\t\t$hours\n\t\t);\n\t}\n\t$minutes = (int) floor( ( $crawler_run_interval % 3600 ) \/ 60 );\n\tif ( $minutes ) {\n\t\t$recurrence .= ' ';\n\t\t$recurrence .= sprintf(\n\t\t\t$minutes > 1 ? esc_html__( '%d minutes', 'litespeed-cache' ) : esc_html__( '%d minute', 'litespeed-cache' ),\n\t\t\t$minutes\n\t\t);\n\t}\n?>\n\n\t<h3 class=\"litespeed-title litespeed-relative\">\n\t\t<?php esc_html_e( 'Crawler Cron', 'litespeed-cache' ); ?>\n\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/crawler\/' ); ?>\n\t<\/h3>\n\n\t<?php if ( ! Router::can_crawl() ) : ?>\n\t\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n\t\t\t<p><?php esc_html_e( 'The crawler feature is not enabled on the LiteSpeed server. Please consult your server admin or hosting provider.', 'litespeed-cache' ); ?><\/p>\n\t\t\t<p>\n\t\t\t\t<?php\n\t\t\t\tprintf(\n\t\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\t\tesc_html__( 'See %sIntroduction for Enabling the Crawler%s for detailed information.', 'litespeed-cache' ),\n\t\t\t\t\t'<a href=\"https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/admin\/#enabling-and-limiting-the-crawler\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t\t'<\/a>'\n\t\t\t\t);\n\t\t\t\t?>\n\t\t\t<\/p>\n\t\t<\/div>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['this_full_beginning_time'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Current sitemap crawl started at', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php echo esc_html( Utility::readable_time( $summary['this_full_beginning_time'] ) ); ?>\n\t\t<\/p>\n\t\t<?php if ( ! $is_running ) : ?>\n\t\t\t<p>\n\t\t\t\t<b><?php esc_html_e( 'The next complete sitemap crawl will start at', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t\t<?php echo esc_html( gmdate( 'm\/d\/Y H:i:s', $summary['this_full_beginning_time'] + LITESPEED_TIME_OFFSET + (int) $summary['last_full_time_cost'] + $this->conf( Base::O_CRAWLER_CRAWL_INTERVAL ) ) ); ?>\n\t\t\t<\/p>\n\t\t<?php endif; ?>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['last_full_time_cost'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Last complete run time for all crawlers', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php printf( esc_html__( '%d seconds', 'litespeed-cache' ), (int) $summary['last_full_time_cost'] ); ?>\n\t\t<\/p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['last_crawler_total_cost'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Run time for previous crawler', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php printf( esc_html__( '%d seconds', 'litespeed-cache' ), (int) $summary['last_crawler_total_cost'] ); ?>\n\t\t<\/p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['curr_crawler_beginning_time'] ) : ?>\n\t\t<p>\n\t\t\t<b><?php esc_html_e( 'Current crawler started at', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php echo esc_html( Utility::readable_time( $summary['curr_crawler_beginning_time'] ) ); ?>\n\t\t<\/p>\n\t<?php endif; ?>\n\n\t<p>\n\t\t<b><?php esc_html_e( 'Current server load', 'litespeed-cache' ); ?>:<\/b>\n\t\t<?php echo esc_html( $__crawler->get_server_load() ); ?>\n\t<\/p>\n\n\t<?php if ( $summary['last_start_time'] ) : ?>\n\t\t<p class=\"litespeed-desc\">\n\t\t\t<b><?php esc_html_e( 'Last interval', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php echo esc_html( Utility::readable_time( $summary['last_start_time'] ) ); ?>\n\t\t<\/p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['end_reason'] ) : ?>\n\t\t<p class=\"litespeed-desc\">\n\t\t\t<b><?php esc_html_e( 'Ended reason', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php echo esc_html( $summary['end_reason'] ); ?>\n\t\t<\/p>\n\t<?php endif; ?>\n\n\t<?php if ( $summary['last_crawled'] ) : ?>\n\t\t<p class=\"litespeed-desc\">\n\t\t\t<b><?php esc_html_e( 'Last crawled', 'litespeed-cache' ); ?>:<\/b>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\tesc_html__( '%d item(s)', 'litespeed-cache' ),\n\t\t\t\tesc_html( $summary['last_crawled'] )\n\t\t\t);\n\t\t\t?>\n\t\t<\/p>\n\t<?php endif; ?>\n\n\t<p>\n\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_RESET ) ); ?>\" class=\"button litespeed-btn-warning\"><?php esc_html_e( 'Reset position', 'litespeed-cache' ); ?><\/a>\n\t\t<a href=\"<?php echo Router::can_crawl() ? esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_START ) ) : 'javascript:;'; ?>\" id=\"litespeed_manual_trigger\" class=\"button litespeed-btn-success\" litespeed-accesskey=\"R\" <?php echo wp_kses_post( $disabled ); ?>><?php esc_html_e( 'Manually run', 'litespeed-cache' ); ?><\/a>\n\t\t<?php echo wp_kses_post( $disabled_tip ); ?>\n\t<\/p>\n\n\t<div class=\"litespeed-table-responsive\">\n\t\t<table class=\"wp-list-table widefat striped\" data-crawler-list>\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th scope=\"col\">#<\/th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Cron Name', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Run Frequency', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Status', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Activate', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Running', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<\/tr>\n\t\t\t<\/thead>\n\t\t\t<tbody>\n\t\t\t\t<?php\n\t\t\t\tforeach ( $crawler_list as $i => $v ) :\n\t\t\t\t\t$hit          = ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_HIT ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_HIT ] : 0;\n\t\t\t\t\t$miss         = ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_MISS ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_MISS ] : 0;\n\t\t\t\t\t$blacklisted  = ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_BLACKLIST ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_BLACKLIST ] : 0;\n\t\t\t\t\t$blacklisted += ! empty( $summary['crawler_stats'][ $i ][ Crawler::STATUS_NOCACHE ] ) ? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_NOCACHE ] : 0;\n\t\t\t\t\t$waiting      = isset( $summary['crawler_stats'][ $i ][ Crawler::STATUS_WAIT ] )\n\t\t\t\t\t\t? (int) $summary['crawler_stats'][ $i ][ Crawler::STATUS_WAIT ]\n\t\t\t\t\t\t: (int) ( $summary['list_size'] - $hit - $miss - $blacklisted );\n\t\t\t\t?>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\techo esc_html( $i + 1 );\n\t\t\t\t\t\t\tif ( $i === $summary['curr_crawler'] ) {\n\t\t\t\t\t\t\t\techo '<img class=\"litespeed-crawler-curr\" src=\"' . esc_url( LSWCP_PLUGIN_URL . 'assets\/img\/Litespeed.icon.svg' ) . '\" alt=\"Current Crawler\">';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t<td><?php echo wp_kses_post( $v['title'] ); ?><\/td>\n\t\t\t\t\t\t<td><?php echo esc_html( $recurrence ); ?><\/td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-default\" data-balloon-pos=\"up\" aria-label=\"%s\">%s<\/i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Waiting', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $waiting > 0 ? $waiting : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-success\" data-balloon-pos=\"up\" aria-label=\"%s\">%s<\/i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Hit', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $hit > 0 ? $hit : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-primary\" data-balloon-pos=\"up\" aria-label=\"%s\">%s<\/i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Miss', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $miss > 0 ? $miss : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t'<i class=\"litespeed-badge litespeed-bg-danger\" data-balloon-pos=\"up\" aria-label=\"%s\">%s<\/i> ',\n\t\t\t\t\t\t\t\tesc_attr__( 'Blocklisted', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( $blacklisted > 0 ? $blacklisted : '-' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php $this->build_toggle( 'litespeed-crawler-' . $i, $__crawler->is_active( $i ) ); ?>\n\t\t\t\t\t\t\t<?php if ( ! empty( $v['uid'] ) && empty( $this->conf( Base::O_SERVER_IP ) ) ) : ?>\n\t\t\t\t\t\t\t\t<div class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'You must set %s before using this feature.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\tesc_html( Lang::title( Base::O_SERVER_IP ) )\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\t\t\tesc_url( admin_url( 'admin.php?page=litespeed-general#settings' ) ),\n\t\t\t\t\t\t\t\t\t\tesc_html__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tif ( $i === $summary['curr_crawler'] ) {\n\t\t\t\t\t\t\t\techo esc_html__( 'Position: ', 'litespeed-cache' ) . esc_html( $summary['last_pos'] + 1 );\n\t\t\t\t\t\t\t\tif ( $is_running ) {\n\t\t\t\t\t\t\t\t\techo ' <span class=\"litespeed-label-success\">' . esc_html__( 'running', 'litespeed-cache' ) . '<\/span>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/td>\n\t\t\t\t\t<\/tr>\n\t\t\t\t<?php endforeach; ?>\n\t\t\t<\/tbody>\n\t\t<\/table>\n\t<\/div>\n\n\t<p>\n\t\t<i class=\"litespeed-badge litespeed-bg-default\"><\/i> = <?php esc_html_e( 'Waiting to be Crawled', 'litespeed-cache' ); ?><br>\n\t\t<i class=\"litespeed-badge litespeed-bg-success\"><\/i> = <?php esc_html_e( 'Already Cached', 'litespeed-cache' ); ?><br>\n\t\t<i class=\"litespeed-badge litespeed-bg-primary\"><\/i> = <?php esc_html_e( 'Successfully Crawled', 'litespeed-cache' ); ?><br>\n\t\t<i class=\"litespeed-badge litespeed-bg-danger\"><\/i> = <?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><br>\n\t<\/p>\n\n\t<div class=\"litespeed-desc\">\n\t\t<div><?php esc_html_e( 'Run frequency is set by the Interval Between Runs setting.', 'litespeed-cache' ); ?><\/div>\n\t\t<div>\n\t\t\t<?php\n\t\t\tesc_html_e( 'Crawlers cannot run concurrently. If both the cron and a manual run start at similar times, the first to be started will take precedence.', 'litespeed-cache' );\n\t\t\t?>\n\t\t<\/div>\n\t\t<div>\n\t\t\t<?php\n\t\t\tprintf(\n\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\tesc_html__( 'Please see %sHooking WP-Cron Into the System Task Scheduler%s to learn how to create the system cron task.', 'litespeed-cache' ),\n\t\t\t\t'<a href=\"https:\/\/developer.wordpress.org\/plugins\/cron\/hooking-wp-cron-into-the-system-task-scheduler\/\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t'<\/a>'\n\t\t\t);\n\t\t\t?>\n\t\t<\/div>\n\t<\/div>\n<?php\nendif;\n?>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Watch Crawler Status', 'litespeed-cache' ); ?><\/h3>\n\n<?php\n$ajax_url = $__crawler->json_path();\nif ( $ajax_url ) :\n?>\n\t<input type=\"button\" id=\"litespeed-crawl-url-btn\" value=\"<?php esc_attr_e( 'Show crawler status', 'litespeed-cache' ); ?>\" class=\"button button-secondary\" data-url=\"<?php echo esc_url( $ajax_url ); ?>\" \/>\n\t<div class=\"litespeed-shell litespeed-hide\">\n\t\t<div class=\"litespeed-shell-header-bar\"><\/div>\n\t\t<div class=\"litespeed-shell-header\">\n\t\t\t<div class=\"litespeed-shell-header-bg\"><\/div>\n\t\t\t<div class=\"litespeed-shell-header-icon-container\">\n\t\t\t\t<img id=\"litespeed-shell-icon\" src=\"<?php echo esc_url( LSWCP_PLUGIN_URL . 'assets\/img\/Litespeed.icon.svg' ); ?>\" alt=\"LiteSpeed Icon\" \/>\n\t\t\t<\/div>\n\t\t<\/div>\n\t\t<ul class=\"litespeed-shell-body\">\n\t\t\t<li><?php esc_html_e( 'Start watching...', 'litespeed-cache' ); ?><\/li>\n\t\t\t<li id=\"litespeed-loading-dot\"><\/li>\n\t\t<\/ul>\n\t<\/div>\n<?php else : ?>\n\t<p><?php esc_html_e( 'No crawler meta file generated yet', 'litespeed-cache' ); ?><\/p>\n<?php endif; ?>\n\n<script>\nvar _litespeed_meta;\nvar _litespeed_shell_interval = 3; \/\/ seconds\nvar _litespeed_shell_interval_range = [3, 60];\nvar _litespeed_shell_handle;\nvar _litespeed_shell_display_handle;\nvar _litespeed_crawler_url;\nvar _litespeed_dots;\n\n\n(function ($) {\n\t'use strict';\n\tjQuery(document).ready(function () {\n\t\t$('#litespeed-crawl-url-btn').on('click', function () {\n\t\t\tif (!$(this).data('url')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$('.litespeed-shell').removeClass('litespeed-hide');\n\t\t\t_litespeed_dots = window.setInterval(_litespeed_loading_dots, 300);\n\t\t\t_litespeed_crawler_url = $(this).data('url');\n\t\t\tlitespeed_fetch_meta();\n\t\t\t$(this).hide();\n\t\t});\n\n\t\t$('#litespeed_manual_trigger').on('click', function (event) {\n\t\t\t$('#litespeed-loading-dot').before('<li>Manually Started<\/li>');\n\t\t\t_litespeed_shell_interval = _litespeed_shell_interval_range[0];\n\t\t\tlitespeed_fetch_meta();\n\t\t});\n\n\t\t\/**\n\t\t * Freeze or melt a specific crawler\n\t\t * @since  4.3\n\t\t *\/\n\t\tif ($('[data-crawler-list] [data-litespeed_toggle_id]').length > 0) {\n\t\t\t$('[data-crawler-list] [data-litespeed_toggle_id]').on('click', function (e) {\n\t\t\t\tvar crawler_id = $(this).attr('data-litespeed_toggle_id');\n\t\t\t\tvar crawler_id = Number(crawler_id.split('-').pop());\n\t\t\t\tvar that = this;\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: '<?php echo function_exists('get_rest_url') ? get_rest_url(null, 'litespeed\/v1\/toggle_crawler_state') : '\/'; \/\/ phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>',\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcache: false,\n\t\t\t\t\tdata: { crawler_id: crawler_id },\n\t\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\t\txhr.setRequestHeader('X-WP-Nonce', '<?php echo esc_js( wp_create_nonce('wp_rest') ); ?>');\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\t$(that)\n\t\t\t\t\t\t\t.toggleClass('litespeed-toggle-btn-default litespeed-toggleoff', data == 0)\n\t\t\t\t\t\t\t.toggleClass('litespeed-toggle-btn-primary', data == 1);\n\t\t\t\t\t\tconsole.log('litespeed-crawler-ajax: change Activate option');\n\t\t\t\t\t},\n\t\t\t\t\terror: function (xhr, error) {\n\t\t\t\t\t\tconsole.log(xhr);\n\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t\tconsole.log('litespeed-crawler-ajax: option failed to save due to some error');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n})(jQuery);\n\n\nfunction litespeed_fetch_meta() {\n\twindow.clearTimeout(_litespeed_shell_handle);\n\tjQuery('#litespeed-loading-dot').text('');\n\tjQuery.ajaxSetup({ cache: false });\n\tjQuery.getJSON(_litespeed_crawler_url, function (meta) {\n\t\tlitespeed_pulse();\n\t\tvar changed = false;\n\t\tif (meta && 'list_size' in meta) {\n\t\t\tnew_meta =\n\t\t\t\tmeta.list_size + ' ' + meta.file_time + ' ' + meta.curr_crawler + ' ' + meta.last_pos + ' ' + meta.last_count + ' ' + meta.last_start_time + ' ' + meta.is_running;\n\t\t\tif (new_meta != _litespeed_meta) {\n\t\t\t\t_litespeed_meta = new_meta;\n\t\t\t\tchanged = true;\n\t\t\t\tstring = _litespeed_build_meta(meta);\n\t\t\t\tjQuery('#litespeed-loading-dot').before(string);\n\t\t\t\t\/\/ remove first log elements\n\t\t\t\tlog_length = jQuery('.litespeed-shell-body li').length;\n\t\t\t\tif (log_length > 50) {\n\t\t\t\t\tjQuery('.litespeed-shell-body li:lt(' + (log_length - 50) + ')').remove();\n\t\t\t\t}\n\t\t\t\t\/\/ scroll to end\n\t\t\t\tjQuery('.litespeed-shell-body')\n\t\t\t\t\t.stop()\n\t\t\t\t\t.animate(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscrollTop: jQuery('.litespeed-shell-body')[0].scrollHeight,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t800,\n\t\t\t\t\t);\n\t\t\t}\n\n\t\t\t\/\/ dynamic adjust the interval length\n\t\t\t_litespeed_adjust_interval(changed);\n\t\t}\n\t\t\/\/ display interval counting\n\t\tlitespeed_display_interval_reset();\n\t\t_litespeed_shell_handle = window.setTimeout(_litespeed_dynamic_timeout, _litespeed_shell_interval * 1000);\n\t});\n}\n\nfunction _litespeed_loading_dots() {\n\tjQuery('#litespeed-loading-dot').append('.');\n}\n\n\/**\n * Dynamic adjust interval\n *\/\nfunction _litespeed_adjust_interval(changed) {\n\tif (changed) {\n\t\t_litespeed_shell_interval -= Math.ceil(_litespeed_shell_interval \/ 2);\n\t} else {\n\t\t_litespeed_shell_interval++;\n\t}\n\n\tif (_litespeed_shell_interval < _litespeed_shell_interval_range[0]) {\n\t\t_litespeed_shell_interval = _litespeed_shell_interval_range[0];\n\t}\n\tif (_litespeed_shell_interval > _litespeed_shell_interval_range[1]) {\n\t\t_litespeed_shell_interval = _litespeed_shell_interval_range[1];\n\t}\n}\n\nfunction _litespeed_build_meta(meta) {\n\tvar string =\n\t\t'<li>' +\n\t\tlitespeed_date(meta.last_update_time) +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size: ' +\n\t\tmeta.list_size +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Crawler: #' +\n\t\t(meta.curr_crawler * 1 + 1) +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Position: ' +\n\t\t(meta.last_pos * 1 + 1) +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Threads: ' +\n\t\tmeta.last_count +\n\t\t'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Status: ';\n\tif (meta.is_running) {\n\t\tstring += 'crawling, ' + meta.last_status;\n\t} else {\n\t\tstring += meta.end_reason ? meta.end_reason : '-';\n\t}\n\tstring += '<\/li>';\n\treturn string;\n}\n\nfunction _litespeed_dynamic_timeout() {\n\tlitespeed_fetch_meta();\n}\n\nfunction litespeed_display_interval_reset() {\n\twindow.clearInterval(_litespeed_shell_display_handle);\n\tjQuery('.litespeed-shell-header-bar').data('num', _litespeed_shell_interval);\n\t_litespeed_shell_display_handle = window.setInterval(_litespeed_display_interval, 1000);\n\n\tjQuery('.litespeed-shell-header-bar')\n\t\t.stop()\n\t\t.animate({ width: '100%' }, 500, function () {\n\t\t\tjQuery('.litespeed-shell-header-bar').css('width', '0%');\n\t\t});\n}\n\nfunction _litespeed_display_interval() {\n\tvar num = jQuery('.litespeed-shell-header-bar').data('num');\n\tjQuery('.litespeed-shell-header-bar')\n\t\t.stop()\n\t\t.animate({ width: litespeed_get_percent(num, _litespeed_shell_interval) + '%' }, 1000);\n\tif (num > 0) num--;\n\tif (num < 0) num = 0;\n\tjQuery('.litespeed-shell-header-bar').data('num', num);\n}\n\nfunction litespeed_get_percent(num1, num2) {\n\tnum1 = num1 * 1;\n\tnum2 = num2 * 1;\n\tnum = (num2 - num1) \/ num2;\n\treturn num * 100;\n}\n\nfunction litespeed_date(timestamp) {\n\tvar a = new Date(timestamp * 1000);\n\tvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\tvar year = a.getFullYear();\n\tvar month = months[a.getMonth()];\n\tvar date = litespeed_add_zero(a.getDate());\n\tvar hour = litespeed_add_zero(a.getHours());\n\tvar min = litespeed_add_zero(a.getMinutes());\n\tvar sec = litespeed_add_zero(a.getSeconds());\n\tvar time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;\n\treturn time;\n}\n\nfunction litespeed_add_zero(i) {\n\tif (i < 10) {\n\t\ti = '0' + i;\n\t}\n\treturn i;\n}\n\nfunction litespeed_pulse() {\n\tjQuery('#litespeed-shell-icon').animate(\n\t\t{\n\t\t\twidth: 27,\n\t\t\theight: 34,\n\t\t\topacity: 1,\n\t\t},\n\t\t700,\n\t\tfunction () {\n\t\t\tjQuery('#litespeed-shell-icon').animate(\n\t\t\t\t{\n\t\t\t\t\twidth: 23,\n\t\t\t\t\theight: 29,\n\t\t\t\t\topacity: 0.5,\n\t\t\t\t},\n\t\t\t\t700,\n\t\t\t);\n\t\t},\n\t);\n}\n\n<\/script>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/crawler\/settings.tpl.php","ext":"php","size":6244,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Crawler General Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Crawler General Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/crawler\/#general-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'This will enable crawler cron.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br><?php Doc::notice_htaccess(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_CRAWL_INTERVAL; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?> <?php esc_html_e( 'seconds', 'litespeed-cache' ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify how long in seconds before the crawler should initiate crawling the entire sitemap again.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_SITEMAP; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The crawler will use your XML sitemap or sitemap index. Enter the full URL to your sitemap here.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_LOAD_LIMIT; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_input( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'The maximum average server load allowed while crawling. The number of crawler threads in use will be actively reduced until average server load falls under this limit. If this cannot be achieved with a single thread, the current crawler run will be terminated.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php if ( ! empty( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE ] ) ) : ?>\n\t\t\t\t\t\t<span class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'Server enforced value: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t'<code>' . esc_html( sanitize_text_field( wp_unslash( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE ] ) ) ) . '<\/code>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<?php elseif ( ! empty( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT ] ) ) : ?>\n\t\t\t\t\t\t<span class=\"litespeed-warning\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'Server allowed max value: %s', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\t'<code>' . esc_html( sanitize_text_field( wp_unslash( $_SERVER[ Base::ENV_CRAWLER_LOAD_LIMIT ] ) ) ) . '<\/code>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php $this->_api_env_var( Base::ENV_CRAWLER_LOAD_LIMIT, Base::ENV_CRAWLER_LOAD_LIMIT_ENFORCE ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_ROLES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id, 20 ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'To crawl the site as a logged-in user, enter the user ids to be simulated.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php if ( empty( $this->conf( Base::O_SERVER_IP ) ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'You must set %s before using this feature.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( Lang::title( Base::O_SERVER_IP ) )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\tesc_url( admin_url( 'admin.php?page=litespeed-general#settings' ) ),\n\t\t\t\t\t\t\t\tesc_html__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( empty( $this->conf( Base::O_ESI ) ) ) : ?>\n\t\t\t\t\t\t<div class=\"litespeed-danger litespeed-text-bold\">\n\t\t\t\t\t\t\t\ud83d\udea8 <?php esc_html_e( 'NOTICE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\tesc_html__( 'You must set %1$s to %2$s before using this feature.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\tesc_html( Lang::title( Base::O_ESI ) ),\n\t\t\t\t\t\t\t\tesc_html__( 'ON', 'litespeed-cache' )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\t\tesc_url( admin_url( 'admin.php?page=litespeed-cache#esi' ) ),\n\t\t\t\t\t\t\t\tesc_html__( 'Click here to set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CRAWLER_COOKIES; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->enroll( $option_id . '[name][]' ); ?>\n\t\t\t\t<?php $this->enroll( $option_id . '[vals][]' ); ?>\n\t\t\t\t<div id=\"litespeed_crawler_simulation_div\"><\/div>\n\t\t\t\t<script type=\"text\/babel\">\n\t\t\t\t\tReactDOM.render(\n\t\t\t\t\t\t<CrawlerSimulate list={ <?php echo wp_json_encode( $this->conf( $option_id ) ); ?> } \/>,\n\t\t\t\t\t\tdocument.getElementById( 'litespeed_crawler_simulation_div' )\n\t\t\t\t\t);\n\t\t\t\t<\/script>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'To crawl for a particular cookie, enter the cookie name, and the values you wish to crawl for. Values should be one per line. There will be one crawler created per cookie value, per simulated role.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/crawler\/#cookie-simulation' ); ?>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\tesc_html__( 'Use %1$s in %2$s to indicate this cookie has not been set.', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<code>_null<\/code>',\n\t\t\t\t\t\t\tesc_html__( 'Cookie Values', 'litespeed-cache' )\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n\n<?php $this->form_end(); ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/crawler\/blacklist.tpl.php","ext":"php","size":3087,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Crawler Blocklist\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$crawler_summary = Crawler::get_summary();\n$__map           = Crawler_Map::cls();\n$__admin_display = Admin_Display::cls();\n$list            = $__map->list_blacklist( 30 );\n$count           = $__map->count_blacklist();\n$pagination      = Utility::pagination( $count, 30 );\n?>\n\n<p class=\"litespeed-right\">\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_BLACKLIST_EMPTY ) ); ?>\" class=\"button litespeed-btn-warning\" data-litespeed-cfm=\"<?php esc_attr_e( 'Are you sure to delete all existing blocklist items?', 'litespeed-cache' ); ?>\">\n\t\t<?php esc_html_e( 'Empty blocklist', 'litespeed-cache' ); ?>\n\t<\/a>\n<\/p>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Blocklist', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/crawler\/#blocklist-tab' ); ?>\n<\/h3>\n\n<?php echo esc_html__( 'Total', 'litespeed-cache' ) . ': ' . esc_html( $count ); ?>\n\n<?php echo wp_kses_post( $pagination ); ?>\n\n<div class=\"litespeed-table-responsive\">\n\t<table class=\"wp-list-table widefat striped\">\n\t\t<thead>\n\t\t\t<tr>\n\t\t\t\t<th scope=\"col\">#<\/th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'URL', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Status', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Operation', 'litespeed-cache' ); ?><\/th>\n\t\t\t<\/tr>\n\t\t<\/thead>\n\t\t<tbody>\n\t\t\t<?php foreach ( $list as $i => $v ) : ?>\n\t\t\t<tr>\n\t\t\t\t<td><?php echo esc_html( $i + 1 ); ?><\/td>\n\t\t\t\t<td><?php echo esc_html( $v['url'] ); ?><\/td>\n\t\t\t\t<td><?php echo wp_kses_post( Crawler::cls()->display_status( $v['res'], $v['reason'] ) ); ?><\/td>\n\t\t\t\t<td>\n\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_BLACKLIST_DEL, false, null, array( 'id' => $v['id'] ) ) ); ?>\" class=\"button button-secondary\">\n\t\t\t\t\t\t<?php esc_html_e( 'Remove from Blocklist', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/td>\n\t\t\t<\/tr>\n\t\t\t<?php endforeach; ?>\n\t\t<\/tbody>\n\t<\/table>\n<\/div>\n\n<?php echo wp_kses_post( $pagination ); ?>\n\n<p>\n\t<span class=\"litespeed-success\">\n\t\t<?php\n\t\tprintf(\n\t\t\tesc_html__( 'API: PHP Constant %s available to disable blocklist.', 'litespeed-cache' ),\n\t\t\t'<code>LITESPEED_CRAWLER_DISABLE_BLOCKLIST<\/code>'\n\t\t);\n\t\t?>\n\t<\/span>\n<\/p>\n<p>\n\t<span class=\"litespeed-success\">\n\t\t<?php\n\t\tprintf(\n\t\t\tesc_html__( 'API: Filter %s available to disable blocklist.', 'litespeed-cache' ),\n\t\t\t'<code>add_filter( \\'litespeed_crawler_disable_blocklist\\', \\'__return_true\\' );<\/code>'\n\t\t);\n\t\t?>\n\t<\/span>\n<\/p>\n<?php $__admin_display->_check_overwritten( 'crawler-blocklist' ); ?>\n<p>\n\t<i class=\"litespeed-dot litespeed-bg-default\"><\/i> = <?php esc_html_e( 'Not blocklisted', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-warning\"><\/i> = <?php esc_html_e( 'Blocklisted due to not cacheable', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-danger\"><\/i> = <?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><br>\n<\/p>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/crawler\/entry.tpl.php","ext":"php","size":1147,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Crawler Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = [\n\t'summary'   => esc_html__( 'Summary', 'litespeed-cache' ),\n\t'map'       => esc_html__( 'Map', 'litespeed-cache' ),\n\t'blacklist' => esc_html__( 'Blocklist', 'litespeed-cache' ),\n\t'settings'  => esc_html__( 'Settings', 'litespeed-cache' ),\n];\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache Crawler', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t<\/h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php\n\t\tforeach ( $menu_list as $menu_key => $menu_value ) {\n\t\t\tprintf(\n\t\t\t\t'<div data-litespeed-layout=\"%s\">',\n\t\t\t\tesc_attr( $menu_key )\n\t\t\t);\n\t\t\trequire LSCWP_DIR . \"tpl\/crawler\/$menu_key.tpl.php\";\n\t\t\techo '<\/div>';\n\t\t}\n\t\t?>\n\t<\/div>\n<\/div>\n\n<iframe name=\"litespeedHiddenIframe\" src=\"\" width=\"0\" height=\"0\" frameborder=\"0\"><\/iframe>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/crawler\/map.tpl.php","ext":"php","size":4218,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Crawler Sitemap List\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$crawler_summary = Crawler::get_summary();\n$__map           = Crawler_Map::cls();\n$list            = $__map->list_map( 30 );\n$count           = $__map->count_map();\n$pagination      = Utility::pagination( $count, 30 );\n$kw              = '';\nif (! empty( $_POST['kw'] ) && ! empty( $_POST['_wpnonce'] )) {\n\t$nonce = sanitize_text_field(wp_unslash($_POST['_wpnonce']));\n\tif (wp_verify_nonce($nonce)) {\n\t\t$kw = sanitize_text_field(wp_unslash($_POST['kw']));\n\t}\n}\n?>\n\n<p class=\"litespeed-right\">\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_EMPTY ) ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Clean Crawler Map', 'litespeed-cache' ); ?>\n\t<\/a>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_REFRESH_MAP ) ); ?>\" class=\"button button-secondary\">\n\t\t<?php esc_html_e( 'Refresh Crawler Map', 'litespeed-cache' ); ?>\n\t<\/a>\n<\/p>\n\n<p>\n\t<?php\n\tif ( ! empty( $crawler_summary['sitemap_time'] ) ) {\n\t\tprintf(\n\t\t\tesc_html__( 'Generated at %s', 'litespeed-cache' ),\n\t\t\tesc_html( Utility::readable_time( $crawler_summary['sitemap_time'] ) )\n\t\t);\n\t}\n\t?>\n<\/p>\n\n<h3 class=\"litespeed-title\">\n\t<?php esc_html_e( 'Sitemap List', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/crawler\/#map-tab' ); ?>\n<\/h3>\n\n<?php echo esc_html__( 'Sitemap Total', 'litespeed-cache' ) . ': ' . esc_html( $count ); ?>\n\n<div style=\"display: flex; justify-content: space-between;\">\n\t<div style=\"margin-top:10px;\">\n\t\t<form action=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler' ) ); ?>\" method=\"post\">\n\t\t<?php wp_nonce_field(); ?>\n\t\t\t<input type=\"text\" name=\"kw\" value=\"<?php echo esc_attr( $kw ); ?>\" placeholder=\"<?php esc_attr_e( 'URL Search', 'litespeed-cache' ); ?>\" style=\"width: 600px;\" \/>\n\t\t<\/form>\n\t<\/div>\n\t<div>\n\t\t<a style=\"padding-right:10px;\" href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler&' . Router::TYPE . '=hit' ) ); ?>\"><?php esc_html_e( 'Cache Hit', 'litespeed-cache' ); ?><\/a>\n\t\t<a style=\"padding-right:10px;\" href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler&' . Router::TYPE . '=miss' ) ); ?>\"><?php esc_html_e( 'Cache Miss', 'litespeed-cache' ); ?><\/a>\n\t\t<a style=\"padding-right:10px;\" href=\"<?php echo esc_url( admin_url( 'admin.php?page=litespeed-crawler&' . Router::TYPE . '=blacklisted' ) ); ?>\"><?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><\/a>\n\t<\/div>\n\t<div>\n\t\t<?php echo wp_kses_post( $pagination ); ?>\n\t<\/div>\n<\/div>\n\n<div class=\"litespeed-table-responsive\">\n\t<table class=\"wp-list-table widefat striped\">\n\t\t<thead>\n\t\t\t<tr>\n\t\t\t\t<th scope=\"col\">#<\/th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'URL', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Crawler Status', 'litespeed-cache' ); ?><\/th>\n\t\t\t\t<th scope=\"col\"><?php esc_html_e( 'Operation', 'litespeed-cache' ); ?><\/th>\n\t\t\t<\/tr>\n\t\t<\/thead>\n\t\t<tbody>\n\t\t\t<?php foreach ( $list as $i => $v ) : ?>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><?php echo esc_html( $i + 1 ); ?><\/td>\n\t\t\t\t\t<td><?php echo esc_html( $v['url'] ); ?><\/td>\n\t\t\t\t\t<td><?php echo wp_kses_post( Crawler::cls()->display_status( $v['res'], $v['reason'] ) ); ?><\/td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CRAWLER, Crawler::TYPE_BLACKLIST_ADD, false, null, array( 'id' => $v['id'] ) ) ); ?>\" class=\"button button-secondary\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'Add to Blocklist', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/td>\n\t\t\t\t<\/tr>\n\t\t\t<?php endforeach; ?>\n\t\t<\/tbody>\n\t<\/table>\n<\/div>\n\n<?php echo wp_kses_post( $pagination ); ?>\n\n<p>\n\t<i class=\"litespeed-dot litespeed-bg-success\"><\/i> = <?php esc_html_e( 'Cache Hit', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-primary\"><\/i> = <?php esc_html_e( 'Cache Miss', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-warning\"><\/i> = <?php esc_html_e( 'Blocklisted due to not cacheable', 'litespeed-cache' ); ?><br>\n\t<i class=\"litespeed-dot litespeed-bg-danger\"><\/i> = <?php esc_html_e( 'Blocklisted', 'litespeed-cache' ); ?><br>\n<\/p>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/db_optm\/manage.tpl.php","ext":"php","size":8223,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Database Optimization\n *\n * Manages database optimization options and displays table engine conversion tools.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$_panels = array(\n    'all' => array(\n        'title' => esc_html__( 'Clean All', 'litespeed-cache' ),\n        'desc'  => '',\n    ),\n    'revision' => array(\n        'title' => esc_html__( 'Post Revisions', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all post revisions', 'litespeed-cache' ),\n    ),\n    'orphaned_post_meta' => array(\n        'title' => esc_html__( 'Orphaned Post Meta', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all orphaned post meta records', 'litespeed-cache' ),\n    ),\n    'auto_draft' => array(\n        'title' => esc_html__( 'Auto Drafts', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all auto saved drafts', 'litespeed-cache' ),\n    ),\n    'trash_post' => array(\n        'title' => esc_html__( 'Trashed Posts', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all trashed posts and pages', 'litespeed-cache' ),\n    ),\n    'spam_comment' => array(\n        'title' => esc_html__( 'Spam Comments', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all spam comments', 'litespeed-cache' ),\n    ),\n    'trash_comment' => array(\n        'title' => esc_html__( 'Trashed Comments', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all trashed comments', 'litespeed-cache' ),\n    ),\n    'trackback-pingback' => array(\n        'title' => esc_html__( 'Trackbacks\/Pingbacks', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all trackbacks and pingbacks', 'litespeed-cache' ),\n    ),\n    'expired_transient' => array(\n        'title' => esc_html__( 'Expired Transients', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean expired transient options', 'litespeed-cache' ),\n    ),\n    'all_transients' => array(\n        'title' => esc_html__( 'All Transients', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Clean all transient options', 'litespeed-cache' ),\n    ),\n    'optimize_tables' => array(\n        'title' => esc_html__( 'Optimize Tables', 'litespeed-cache' ),\n        'desc'  => esc_html__( 'Optimize all tables in your database', 'litespeed-cache' ),\n    ),\n);\n\n$rev_max = $this->conf( Base::O_DB_OPTM_REVISIONS_MAX );\n$rev_age = $this->conf( Base::O_DB_OPTM_REVISIONS_AGE );\nif ( $rev_max || $rev_age ) {\n    $_panels['revision']['desc'] = sprintf(\n\t\tesc_html__( 'Clean revisions older than %1$s day(s), excluding %2$s latest revisions', 'litespeed-cache' ),\n\t\t'<strong>' . esc_html( $rev_age ) . '<\/strong>',\n\t\t'<strong>' . esc_html( $rev_max ) . '<\/strong>'\n\t);\n}\n\n$total = 0;\nforeach ( $_panels as $key => $v ) {\n    if ( 'all' !== $key ) {\n        $_panels[ $key ]['count'] = $this->cls( 'DB_Optm' )->db_count( $key );\n        if ( ! in_array( $key, array( 'optimize_tables' ), true ) ) {\n            $total += $_panels[ $key ]['count'];\n        }\n    }\n    $_panels[ $key ]['link'] = Utility::build_url( Router::ACTION_DB_OPTM, $key );\n}\n\n$_panels['all']['count'] = $total;\n\n$autoload_summary = DB_Optm::cls()->autoload_summary();\n\n?>\n\n<h3 class=\"litespeed-title\">\n    <?php esc_html_e( 'Database Optimizer', 'litespeed-cache' ); ?>\n    <?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/database\/' ); ?>\n<\/h3>\n\n<div class=\"litespeed-panel-wrapper litespeed-cards-wrapper\">\n\n    <?php foreach ( $_panels as $key => $v ) : ?>\n        <a href=\"<?php echo esc_url( $v['link'] ); ?>\" class=\"litespeed-panel postbox\">\n            <section class=\"litespeed-panel-wrapper-icon\">\n                <span class=\"litespeed-panel-icon-<?php echo esc_attr( $key ); ?>\"><\/span>\n            <\/section>\n            <section class=\"litespeed-panel-content\">\n                <div class=\"litespeed-h3\">\n                    <?php echo esc_html( $v['title'] ); ?>\n                    <span class=\"litespeed-panel-counter<?php echo $v['count'] > 0 ? '-red' : ''; ?>\">(<?php echo esc_html( $v['count'] ); ?><?php echo DB_Optm::hide_more() ? '+' : ''; ?>)<\/span>\n                <\/div>\n                <span class=\"litespeed-panel-para\"><?php echo wp_kses_post( $v['desc'] ); ?><\/span>\n            <\/section>\n            <section class=\"litespeed-panel-wrapper-top-right\">\n                <span class=\"litespeed-panel-top-right-icon<?php echo $v['count'] > 0 ? '-cross' : '-tick'; ?>\"><\/span>\n            <\/section>\n        <\/a>\n    <?php endforeach; ?>\n\n<\/div>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Database Table Engine Converter', 'litespeed-cache' ); ?><\/h3>\n\n<div class=\"litespeed-panel-wrapper\">\n\n    <table class=\"wp-list-table widefat striped\">\n        <thead>\n            <tr>\n                <th scope=\"col\">#<\/th>\n                <th scope=\"col\"><?php esc_html_e( 'Table', 'litespeed-cache' ); ?><\/th>\n                <th scope=\"col\"><?php esc_html_e( 'Engine', 'litespeed-cache' ); ?><\/th>\n                <th scope=\"col\"><?php esc_html_e( 'Tool', 'litespeed-cache' ); ?><\/th>\n            <\/tr>\n        <\/thead>\n        <tbody>\n            <?php\n            $list = DB_Optm::cls()->list_myisam();\n            if ( ! empty( $list ) ) :\n                foreach ( $list as $k => $v ) :\n                    ?>\n                    <tr>\n                        <td><?php echo esc_html( $k + 1 ); ?><\/td>\n                        <td><?php echo esc_html( $v->table_name ); ?><\/td>\n                        <td><?php echo esc_html( $v->engine ); ?><\/td>\n                        <td>\n                            <a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_DB_OPTM, DB_Optm::TYPE_CONV_TB, false, false, array( 'tb' => $v->table_name ) ) ); ?>\">\n                                <?php esc_html_e( 'Convert to InnoDB', 'litespeed-cache' ); ?>\n                            <\/a>\n                        <\/td>\n                    <\/tr>\n                <?php endforeach; ?>\n            <?php else : ?>\n                <tr>\n                    <td colspan=\"4\" class=\"litespeed-success litespeed-text-center\">\n                        <?php esc_html_e( 'We are good. No table uses MyISAM engine.', 'litespeed-cache' ); ?>\n                    <\/td>\n                <\/tr>\n            <?php endif; ?>\n        <\/tbody>\n    <\/table>\n\n<\/div>\n\n<style type=\"text\/css\">\n    .litespeed-body .field-col {\n        display: inline-block;\n        vertical-align: top;\n        margin-left: 20px;\n        margin-right: 20px;\n    }\n\n    .litespeed-body .field-col:first-child {\n        margin-left: 0;\n    }\n<\/style>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Database Summary', 'litespeed-cache' ); ?><\/h3>\n<div>\n    <div class=\"field-col\">\n        <p>\n        \t<?php esc_html_e( 'Autoload size', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( Utility::real_size( $autoload_summary->autoload_size ) ); ?><\/strong><\/p>\n        <p><?php esc_html_e( 'Autoload entries', 'litespeed-cache' ); ?>: <strong><?php echo esc_html( $autoload_summary->autload_entries ); ?><\/strong><\/p>\n    <\/div>\n\n    <div class=\"field-col\">\n        <p><?php esc_html_e( 'Autoload top list', 'litespeed-cache' ); ?>:<\/p>\n        <table class=\"wp-list-table widefat striped litespeed-width-auto litespeed-table-compact\">\n            <thead>\n                <tr>\n                    <th scope=\"col\">#<\/th>\n                    <th scope=\"col\"><?php esc_html_e( 'Option Name', 'litespeed-cache' ); ?><\/th>\n                    <th scope=\"col\"><?php esc_html_e( 'Autoload', 'litespeed-cache' ); ?><\/th>\n                    <th scope=\"col\"><?php esc_html_e( 'Size', 'litespeed-cache' ); ?><\/th>\n                <\/tr>\n            <\/thead>\n            <tbody>\n                <?php foreach ( $autoload_summary->autoload_toplist as $k => $v ) : ?>\n                    <tr>\n                        <td><?php echo esc_html( $k + 1 ); ?><\/td>\n                        <td><?php echo esc_html( $v->option_name ); ?><\/td>\n                        <td><?php echo esc_html( $v->autoload ); ?><\/td>\n                        <td><?php echo esc_html( $v->option_value_length ); ?><\/td>\n                    <\/tr>\n                <?php endforeach; ?>\n            <\/tbody>\n        <\/table>\n    <\/div>\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/db_optm\/settings.tpl.php","ext":"php","size":1520,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Database Optimization Settings\n *\n * Manages settings for database optimization in LiteSpeed Cache.\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'DB Optimization Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/database\/#db-optimization-settings-tab' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\"><tbody>\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_DB_OPTM_REVISIONS_MAX; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Specify the number of most recent revisions to keep when cleaning revisions.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 1, 100, true ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n\t<tr>\n\t\t<th>\n\t\t\t<?php $option_id = Base::O_DB_OPTM_REVISIONS_AGE; ?>\n\t\t\t<?php $this->title( $option_id ); ?>\n\t\t<\/th>\n\t\t<td>\n\t\t\t<?php $this->build_input( $option_id, 'litespeed-input-short' ); ?> <?php esc_html_e( 'Day(s)', 'litespeed-cache' ); ?>\n\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t<?php esc_html_e( 'Revisions newer than this many days will be kept when cleaning revisions.', 'litespeed-cache' ); ?>\n\t\t\t\t<?php $this->_validate_ttl( $option_id, 1, 600, true ); ?>\n\t\t\t<\/div>\n\t\t<\/td>\n\t<\/tr>\n\n<\/tbody><\/table>\n\n<?php\n$this->form_end();\n?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/db_optm\/entry.tpl.php","ext":"php","size":1060,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Database Optimization\n *\n * @package LiteSpeed\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n    'manage'   => esc_html__( 'Manage', 'litespeed-cache' ),\n);\n\nif ( ! is_network_admin() ) {\n    $menu_list['settings'] = esc_html__( 'DB Optimization Settings', 'litespeed-cache' );\n}\n\n?>\n\n<div class=\"wrap\">\n    <h1 class=\"litespeed-h1\">\n        <?php esc_html_e( 'LiteSpeed Cache Database Optimization', 'litespeed-cache' ); ?>\n    <\/h1>\n    <span class=\"litespeed-desc\">\n        <?php echo esc_html( 'v' . Core::VER ); ?>\n    <\/span>\n    <hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n    <h2 class=\"litespeed-header nav-tab-wrapper\">\n        <?php GUI::display_tab_list( $menu_list ); ?>\n    <\/h2>\n\n    <div class=\"litespeed-body\">\n    <?php\n        foreach ( $menu_list as $tab_key => $tab_val ) {\n\t\t\techo '<div data-litespeed-layout=\"' . esc_attr( $tab_key ) . '\">';\n\t\t\trequire LSCWP_DIR . 'tpl\/db_optm\/' . $tab_key . '.tpl.php';\n\t\t\techo '<\/div>';\n        }\n    ?>\n    <\/div>\n\n<\/div>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cdn\/other.tpl.php","ext":"php","size":7207,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache CDN Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$home_url = home_url( '\/' );\n$parsed   = wp_parse_url( $home_url );\n$home_url = str_replace( $parsed['scheme'] . ':', '', $home_url );\n\n$cdn_mapping = $this->conf( Base::O_CDN_MAPPING );\n\/\/ Special handler: Append one row if somehow the DB default preset value got deleted\nif ( ! $cdn_mapping ) {\n\t$this->load_default_vals();\n\t$cdn_mapping = self::$_default_options[ Base::O_CDN_MAPPING ];\n}\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'CDN Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cdn\/' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Turn this setting %s if you are using a traditional Content Delivery Network (CDN) or a subdomain for static content with QUIC.cloud CDN.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'ON', 'litespeed-cache' ) . '<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cdn\/#use-cdn-mapping' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'NOTE: QUIC.cloud CDN and Cloudflare do not use CDN Mapping. If you are only using QUIC.cloud or Cloudflare, leave this setting %s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>' . esc_html__( 'OFF', 'litespeed-cache' ) . '<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\"><\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_URL . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_INC_IMG . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_INC_CSS . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_INC_JS . '][]' ); ?>\n\t\t\t\t<?php $this->enroll( Base::O_CDN_MAPPING . '[' . Base::CDN_MAPPING_FILETYPE . '][]' ); ?>\n\n\t\t\t\t<div id=\"litespeed_cdn_mapping_div\"><\/div>\n\n\t\t\t\t<script type=\"text\/babel\">\n\t\t\t\t\tReactDOM.render(\n\t\t\t\t\t\t<CDNMapping list={ <?php echo wp_json_encode( $cdn_mapping ); ?> } \/>,\n\t\t\t\t\t\tdocument.getElementById( 'litespeed_cdn_mapping_div' )\n\t\t\t\t\t);\n\t\t\t\t<\/script>\n\n\t\t\t\t<div class=\"litespeed-warning\">\n\t\t\t\t\t<?php esc_html_e( 'NOTE', 'litespeed-cache' ); ?>:\n\t\t\t\t\t<?php esc_html_e( 'To randomize CDN hostname, define multiple hostnames for the same resources.', 'litespeed-cache' ); ?>\n\t\t\t\t<\/div>\n\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_INC_IMG ); ?><\/b>:\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Serve all image files through the CDN. This will affect all attachments, HTML %1$s tags, and CSS %2$s attributes.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>&lt;img<\/code>',\n\t\t\t\t\t\t'<code>url()<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_INC_CSS ); ?><\/b>:\n\t\t\t\t\t<?php esc_html_e( 'Serve all CSS files through the CDN. This will affect all enqueued WP CSS files.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_INC_JS ); ?><\/b>:\n\t\t\t\t\t<?php esc_html_e( 'Serve all JavaScript files through the CDN. This will affect all enqueued WP JavaScript files.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<b><?php $this->title( Base::CDN_MAPPING_FILETYPE ); ?><\/b>:\n\t\t\t\t\t<?php esc_html_e( 'Static file type links to be replaced by CDN links.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'This will affect all tags containing attributes: %s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>src=\"\"<\/code> <code>data-src=\"\"<\/code> <code>href=\"\"<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cdn\/#include-file-types', esc_html__( 'Default value', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'If you turn any of the above settings OFF, please remove the related file types from the %s box.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<b>' . esc_html__( 'Include File Types', 'litespeed-cache' ) . '<\/b>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cdn\/#include-file-types' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN_ATTR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Specify which HTML element attributes will be replaced with CDN Mapping.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php esc_html_e( 'Only attributes listed here will be replaced.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Use the format %1$s or %2$s (element is optional).', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>element.attribute<\/code>',\n\t\t\t\t\t\t'<code>.attribute<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_CDN_ORI; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Site URL to be served through the CDN. Beginning with %1$s. For example, %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>\/\/<\/code>',\n\t\t\t\t\t\t'<code>' . esc_html( $home_url ) . '<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<br>\n\t\t\t\t\t<?php\n\t\t\t\t\tprintf(\n\t\t\t\t\t\tesc_html__( 'Wildcard %1$s supported (match zero or more characters). For example, to match %2$s and %3$s, use %4$s.', 'litespeed-cache' ),\n\t\t\t\t\t\t'<code>*<\/code>',\n\t\t\t\t\t\t'<code>\/\/www.aa.com<\/code>',\n\t\t\t\t\t\t'<code>\/\/aa.com<\/code>',\n\t\t\t\t\t\t'<code>\/\/*aa.com<\/code>'\n\t\t\t\t\t);\n\t\t\t\t\t?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_CDN_ORI_DIR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<div class=\"litespeed-textarea-recommended\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->build_textarea( $option_id, 40 ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php $this->recommended( $option_id ); ?>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Only files within these directories will be pointed to the CDN.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\n\t\t<tr>\n\t\t\t<th class=\"litespeed-padding-left\">\n\t\t\t\t<?php $option_id = Base::O_CDN_EXC; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_textarea( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php esc_html_e( 'Paths containing these strings will not be served from the CDN.', 'litespeed-cache' ); ?>\n\t\t\t\t\t<?php Doc::one_per_line(); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n\n<?php $this->form_end(); ?>"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cdn\/qc.tpl.php","ext":"php","size":8891,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache QUIC.cloud CDN Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$__cloud = Cloud::cls();\n$__cloud->finish_qc_activation( 'cdn' );\n$cloud_summary = Cloud::get_summary();\n?>\n\n<div class=\"litespeed-flex-container litespeed-column-with-boxes\">\n\t<div class=\"litespeed-width-7-10 litespeed-column-left litespeed-cdn-summary-wrapper\">\n\t\t<div class=\"litespeed-column-left-inside\">\n\t\t\t<h3>\n\t\t\t\t<?php if ( $__cloud->activated() ) : ?>\n\t\t\t\t\t<a class=\"button button-small litespeed-right litespeed-learn-more\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_SYNC_STATUS ) ); ?>\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"><\/span> <?php esc_html_e( 'Refresh Status', 'litespeed-cache' ); ?>\n\t\t\t\t\t<\/a>\n\t\t\t\t<?php endif; ?>\n\t\t\t\t<span class=\"litespeed-quic-icon\"><\/span> <?php esc_html_e( 'QUIC.cloud CDN Status Overview', 'litespeed-cache' ); ?>\n\t\t\t<\/h3>\n\t\t\t<p class=\"litespeed-desc\"><?php esc_html_e( 'Check the status of your most important settings and the health of your CDN setup here.', 'litespeed-cache' ); ?><\/p>\n\n\t\t\t<?php if ( ! $__cloud->activated() ) : ?>\n\t\t\t\t<div class=\"litespeed-dashboard-unlock litespeed-dashboard-unlock--inline\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 class=\"litespeed-dashboard-unlock-title\"><strong class=\"litespeed-qc-text-gradient\"><?php esc_html_e( 'Accelerate, Optimize, Protect', 'litespeed-cache' ); ?><\/strong><\/h3>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-desc\">\n\t\t\t\t\t\t\t<?php echo wp_kses_post( __( 'Speed up your WordPress site even further with <strong>QUIC.cloud Online Services and CDN<\/strong>.', 'litespeed-cache' ) ); ?>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p><?php esc_html_e( 'Free monthly quota available.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<a class=\"button button-primary\" href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ACTIVATE, false, null, array( 'ref' => 'cdn' ) ) ); ?>\">\n\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-yes\"><\/span><?php esc_html_e( 'Enable QUIC.cloud services', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<p class=\"litespeed-dashboard-unlock-footer\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'QUIC.cloud provides CDN and online optimization services, and is not required. You may use many features of this plugin without QUIC.cloud.', 'litespeed-cache' ); ?><br>\n\t\t\t\t\t\t\t<a href=\"https:\/\/www.quic.cloud\/\" target=\"_blank\" rel=\"noopener\"><?php esc_html_e( 'Learn More about QUIC.cloud', 'litespeed-cache' ); ?><\/a>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<?php elseif ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t<div class=\"litespeed-top20\">\n\t\t\t\t\t<?php if ( ! empty( $cloud_summary['qc_activated'] ) && 'linked' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t<p><?php echo wp_kses_post( __( 'QUIC.cloud CDN is currently <strong>fully disabled<\/strong>.', 'litespeed-cache' ) ); ?><\/p>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<p><?php echo wp_kses_post( __( 'QUIC.cloud CDN is <strong>not available<\/strong> for anonymous (unlinked) users.', 'litespeed-cache' ) ); ?><\/p>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$btn_title = esc_html__( 'Link & Enable QUIC.cloud CDN', 'litespeed-cache' );\n\t\t\t\t\t\tif ( ! empty( $cloud_summary['qc_activated'] ) && 'linked' === $cloud_summary['qc_activated'] ) {\n\t\t\t\t\t\t\t$btn_title = esc_html__( 'Enable QUIC.cloud CDN', 'litespeed-cache' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDoc::learn_more(\n\t\t\t\t\t\t\tesc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_ENABLE_CDN, false, null, array( 'ref' => 'cdn' ) ) ),\n\t\t\t\t\t\t\t'<span class=\"dashicons dashicons-yes\"><\/span>' . $btn_title,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t'button button-primary litespeed-button-cta'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<h3 class=\"litespeed-title-section\"><?php esc_html_e( 'Content Delivery Network Service', 'litespeed-cache' ); ?><\/h3>\n\t\t\t\t\t<p class=\"litespeed-text-md\">\n\t\t\t\t\t\t<?php esc_html_e( 'Serve your visitors fast', 'litespeed-cache' ); ?> <strong class=\"litespeed-qc-text-gradient\"><?php esc_html_e( 'no matter where they live.', 'litespeed-cache' ); ?><\/strong>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\tprintf(\n\t\t\t\t\t\t\t\/* translators: %s: Link tags *\/\n\t\t\t\t\t\t\tesc_html__( 'Best available WordPress performance, globally fast TTFB, easy setup, and %smore%s!', 'litespeed-cache' ),\n\t\t\t\t\t\t\t'<a href=\"https:\/\/www.quic.cloud\/quic-cloud-services-and-features\/litespeed-cache-service\/\" target=\"_blank\" rel=\"noopener\">',\n\t\t\t\t\t\t\t'<\/a>'\n\t\t\t\t\t\t);\n\t\t\t\t\t\t?>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t<?php else : ?>\n\t\t\t\t<?php echo wp_kses_post( $__cloud->load_qc_status_for_dash( 'cdn_dash' ) ); ?>\n\t\t\t<?php endif; ?>\n\t\t<\/div>\n\t<\/div>\n\n\t<div class=\"litespeed-width-3-10 litespeed-column-right\">\n\t\t<div class=\"postbox litespeed-postbox\">\n\t\t\t<div class=\"inside\">\n\t\t\t\t<h3 class=\"litespeed-title\">\n\t\t\t\t\t<?php esc_html_e( 'QUIC.cloud CDN Options', 'litespeed-cache' ); ?>\n\t\t\t\t<\/h3>\n\t\t\t\t<?php if ( ! empty( $cloud_summary['partner'] ) && ! empty( $cloud_summary['partner']['disable_qc_login'] ) ) : ?>\n\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['logo'] ) ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\" rel=\"noopener\">\n\t\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<img src=\"<?php echo esc_url( $cloud_summary['partner']['logo'] ); ?>\" alt=\"<?php echo esc_attr( $cloud_summary['partner']['name'] ); ?>\">\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php elseif ( ! empty( $cloud_summary['partner']['name'] ) ) : ?>\n\t\t\t\t\t\t<?php if ( ! empty( $cloud_summary['partner']['url'] ) ) : ?>\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $cloud_summary['partner']['url'] ); ?>\" target=\"_blank\" rel=\"noopener\">\n\t\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?><\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t\t<span class=\"postbox-partner-name\"><?php echo esc_html( $cloud_summary['partner']['name'] ); ?><\/span>\n\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t<?php if ( ! $__cloud->activated() ) : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, go to your hosting provider\\'s portal.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, please contact your hosting provider.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php else : ?>\n\t\t\t\t\t<?php if ( ! $__cloud->activated() ) : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, go to QUIC.cloud Dashboard.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"button button-primary disabled\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Link to QUIC.cloud', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<\/button>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php elseif ( 'anonymous' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'You are currently using services as an anonymous user. To manage your QUIC.cloud options, use the button below to create an account and link to the QUIC.cloud Dashboard.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CLOUD, Cloud::TYPE_LINK, false, null, array( 'ref' => 'cdn' ) ) ); ?>\" class=\"button button-<?php echo ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) ? 'secondary' : 'primary'; ?>\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'Link to QUIC.cloud', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php elseif ( 'linked' === $cloud_summary['qc_activated'] ) : ?>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $__cloud->qc_link() ); ?>\" target=\"qc\" rel=\"noopener\" class=\"button button-<?php echo ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) ? 'secondary' : 'primary'; ?>\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'My QUIC.cloud Dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"><\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php else : ?>\n\t\t\t\t\t\t<p><?php esc_html_e( 'To manage your QUIC.cloud options, go to QUIC.cloud Dashboard.', 'litespeed-cache' ); ?><\/p>\n\t\t\t\t\t\t<p class=\"litespeed-top20\">\n\t\t\t\t\t\t\t<a href=\"<?php echo esc_url( $__cloud->qc_link() ); ?>\" target=\"qc\" rel=\"noopener\" class=\"button button-<?php echo ( empty( $cloud_summary['qc_activated'] ) || 'cdn' !== $cloud_summary['qc_activated'] ) ? 'secondary' : 'primary'; ?>\">\n\t\t\t\t\t\t\t\t<?php esc_html_e( 'My QUIC.cloud Dashboard', 'litespeed-cache' ); ?> <span class=\"dashicons dashicons-external\"><\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<?php endif; ?>\n\t\t\t\t<?php endif; ?>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<?php $promo_mini = $__cloud->load_qc_status_for_dash( 'promo_mini' ); ?>\n\t\t<?php if ( $promo_mini ) : ?>\n\t\t\t<?php echo wp_kses_post( $promo_mini ); ?>\n\t\t<?php endif; ?>\n\t<\/div>\n<\/div>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cdn\/entry.tpl.php","ext":"php","size":992,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache CDN Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$menu_list = array(\n\t'qc'    => esc_html__( 'QUIC.cloud', 'litespeed-cache' ),\n\t'cf'    => esc_html__( 'Cloudflare', 'litespeed-cache' ),\n\t'other' => esc_html__( 'Other Static CDN', 'litespeed-cache' ),\n);\n?>\n\n<div class=\"wrap\">\n\t<h1 class=\"litespeed-h1\">\n\t\t<?php esc_html_e( 'LiteSpeed Cache CDN', 'litespeed-cache' ); ?>\n\t<\/h1>\n\t<span class=\"litespeed-desc\">\n\t\t<?php echo esc_html( 'v' . Core::VER ); ?>\n\t<\/span>\n\t<hr class=\"wp-header-end\">\n<\/div>\n\n<div class=\"litespeed-wrap\">\n\t<h2 class=\"litespeed-header nav-tab-wrapper\">\n\t\t<?php GUI::display_tab_list( $menu_list ); ?>\n\t<\/h2>\n\n\t<div class=\"litespeed-body\">\n\t\t<?php\n\t\tforeach ( $menu_list as $menu_key => $menu_value ) {\n\t\t\tprintf(\n\t\t\t\t'<div data-litespeed-layout=\"%s\">',\n\t\t\t\tesc_attr( $menu_key )\n\t\t\t);\n\t\t\trequire LSCWP_DIR . \"tpl\/cdn\/$menu_key.tpl.php\";\n\t\t\techo '<\/div>';\n\t\t}\n\t\t?>\n\t<\/div>\n<\/div>\n"},{"base":"plugins","rel":"litespeed-cache\/tpl\/cdn\/cf.tpl.php","ext":"php","size":6677,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * LiteSpeed Cache Cloudflare Settings\n *\n * @package LiteSpeed\n * @since 1.0.0\n *\/\n\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\n$this->form_action();\n?>\n\n<h3 class=\"litespeed-title-short\">\n\t<?php esc_html_e( 'Cloudflare Settings', 'litespeed-cache' ); ?>\n\t<?php Doc::learn_more( 'https:\/\/docs.litespeedtech.com\/lscache\/lscwp\/cdn\/' ); ?>\n<\/h3>\n\n<table class=\"wp-list-table striped litespeed-table\">\n\t<tbody>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN_CLOUDFLARE; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Use %s API functionality.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"litespeed-block\">\n\t\t\t\t\t<div class='litespeed-col'>\n\t\t\t\t\t\t<label class=\"litespeed-form-label\"><?php esc_html_e( 'Global API Key \/ API Token', 'litespeed-cache' ); ?><\/label>\n\t\t\t\t\t\t<?php $this->build_input( Base::O_CDN_CLOUDFLARE_KEY ); ?>\n\t\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'Your API key \/ token is used to access %s APIs.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'Get it from %s.', 'litespeed-cache' ), '<a href=\"https:\/\/dash.cloudflare.com\/profile\/api-tokens\" target=\"_blank\" rel=\"noopener\">Cloudflare<\/a>' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Recommended to generate the token from Cloudflare API token template \"WordPress\".', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class='litespeed-col'>\n\t\t\t\t\t\t<label class=\"litespeed-form-label\"><?php esc_html_e( 'Email Address', 'litespeed-cache' ); ?><\/label>\n\t\t\t\t\t\t<?php $this->build_input( Base::O_CDN_CLOUDFLARE_EMAIL ); ?>\n\t\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php printf( esc_html__( 'Your Email address on %s.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Optional when API token used.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class='litespeed-col'>\n\t\t\t\t\t\t<label class=\"litespeed-form-label\"><?php esc_html_e( 'Domain', 'litespeed-cache' ); ?><\/label>\n\t\t\t\t\t\t<?php\n\t\t\t\t\t\t$cf_zone = $this->conf( Base::O_CDN_CLOUDFLARE_ZONE );\n\t\t\t\t\t\t$cls     = $cf_zone ? ' litespeed-input-success' : ' litespeed-input-warning';\n\t\t\t\t\t\t$this->build_input( Base::O_CDN_CLOUDFLARE_NAME, $cls );\n\t\t\t\t\t\t?>\n\t\t\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t\t\t<?php esc_html_e( 'You can just type part of the domain.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t\t<?php esc_html_e( 'Once saved, it will be matched with the current list and completed automatically.', 'litespeed-cache' ); ?>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t\t<tr>\n\t\t\t<th>\n\t\t\t\t<?php $option_id = Base::O_CDN_CLOUDFLARE_CLEAR; ?>\n\t\t\t\t<?php $this->title( $option_id ); ?>\n\t\t\t<\/th>\n\t\t\t<td>\n\t\t\t\t<?php $this->build_switch( $option_id ); ?>\n\t\t\t\t<div class=\"litespeed-desc\">\n\t\t\t\t\t<?php printf( esc_html__( 'Clear %s cache when \"Purge All\" is run.', 'litespeed-cache' ), 'Cloudflare' ); ?>\n\t\t\t\t<\/div>\n\t\t\t<\/td>\n\t\t<\/tr>\n\t<\/tbody>\n<\/table>\n\n<?php\n$this->form_end();\n$cf_on     = $this->conf( Base::O_CDN_CLOUDFLARE );\n$cf_domain = $this->conf( Base::O_CDN_CLOUDFLARE_NAME );\n$cf_zone   = $this->conf( Base::O_CDN_CLOUDFLARE_ZONE );\nif ( ! $cf_domain ) {\n\t$cf_domain = '-';\n}\nif ( ! $cf_zone ) {\n\t$cf_zone = '-';\n}\n\n$curr_status = CDN\\Cloudflare::get_option( CDN\\Cloudflare::ITEM_STATUS, array() );\n?>\n\n<h3 class=\"litespeed-title\"><?php esc_html_e( 'Cloudflare', 'litespeed-cache' ); ?><\/h3>\n\n<?php if ( ! $cf_on ) : ?>\n\t<div class=\"litespeed-callout notice notice-error inline\">\n\t\t<h4><?php esc_html_e( 'WARNING', 'litespeed-cache' ); ?><\/h4>\n\t\t<p>\n\t\t\t<?php esc_html_e( 'To enable the following functionality, turn ON Cloudflare API in CDN Settings.', 'litespeed-cache' ); ?>\n\t\t<\/p>\n\t<\/div>\n<?php endif; ?>\n\n<p><?php esc_html_e( 'Cloudflare Domain', 'litespeed-cache' ); ?>: <code><?php echo esc_textarea( $cf_domain ); ?><\/code><\/p>\n<p><?php esc_html_e( 'Cloudflare Zone', 'litespeed-cache' ); ?>: <code><?php echo esc_textarea( $cf_zone ); ?><\/code><\/p>\n\n<p>\n\t<b><?php esc_html_e( 'Development Mode', 'litespeed-cache' ); ?>:<\/b>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_SET_DEVMODE_ON ) ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Turn ON', 'litespeed-cache' ); ?>\n\t<\/a>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_SET_DEVMODE_OFF ) ); ?>\" class=\"button litespeed-btn-warning\">\n\t\t<?php esc_html_e( 'Turn OFF', 'litespeed-cache' ); ?>\n\t<\/a>\n\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_GET_DEVMODE ) ); ?>\" class=\"button litespeed-btn-success\">\n\t\t<?php esc_html_e( 'Check Status', 'litespeed-cache' ); ?>\n\t<\/a>\n\n\t<?php if ( $curr_status ) : ?>\n\t\t<span class=\"litespeed-desc\">\n\t\t\t<?php\n\t\t\tif ( time() >= $curr_status['devmode_expired'] ) {\n\t\t\t\t$expired_at             = gmdate( 'm\/d\/Y H:i:s', $curr_status['devmode_expired'] + LITESPEED_TIME_OFFSET );\n\t\t\t\t$curr_status['devmode'] = 'OFF';\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Current status is %1$s since %2$s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . esc_html( strtoupper( $curr_status['devmode'] ) ) . '<\/code>',\n\t\t\t\t\t'<code>' . esc_html( $expired_at ) . '<\/code>'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t$expired_at = $curr_status['devmode_expired'] - time();\n\t\t\t\t$expired_at = Utility::readable_time( $expired_at, 3600 * 3, true );\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Current status is %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . esc_html( strtoupper( $curr_status['devmode'] ) ) . '<\/code>'\n\t\t\t\t);\n\t\t\t\tprintf(\n\t\t\t\t\tesc_html__( 'Development mode will be automatically turned off in %s.', 'litespeed-cache' ),\n\t\t\t\t\t'<code>' . esc_html( $expired_at ) . '<\/code>'\n\t\t\t\t);\n\t\t\t}\n\t\t\t?>\n\t\t<\/span>\n\t<?php endif; ?>\n\t<br>\n\t<?php esc_html_e( 'Temporarily bypass Cloudflare cache. This allows changes to the origin server to be seen in realtime.', 'litespeed-cache' ); ?>\n\t<br>\n\t<?php esc_html_e( 'Development Mode will be turned off automatically after three hours.', 'litespeed-cache' ); ?>\n\t<?php printf( esc_html__( '%1$sLearn More%2$s', 'litespeed-cache' ), '<a href=\"https:\/\/support.cloudflare.com\/hc\/en-us\/articles\/200168246\" target=\"_blank\" rel=\"noopener\">', '<\/a>' ); ?>\n<\/p>\n\n<p>\n\t<b><?php esc_html_e( 'Cloudflare Cache', 'litespeed-cache' ); ?>:<\/b>\n\t<?php if ( ! $cf_on ) : ?>\n\t\t<a href=\"#\" class=\"button button-secondary disabled\">\n\t<?php else : ?>\n\t\t<a href=\"<?php echo esc_url( Utility::build_url( Router::ACTION_CDN_CLOUDFLARE, CDN\\Cloudflare::TYPE_PURGE_ALL ) ); ?>\" class=\"button litespeed-btn-danger\">\n\t<?php endif; ?>\n\t\t<?php esc_html_e( 'Purge Everything', 'litespeed-cache' ); ?>\n\t<\/a>\n<\/p>"},{"base":"plugins","rel":"litespeed-cache\/composer.json","ext":"json","size":641,"mtime":1757312769,"type":"text","content":"{\n\t\"name\": \"litespeedtech\/lscache_wp\",\n\t\"require-dev\": {\n\t\t\"squizlabs\/php_codesniffer\": \"^3.12\",\n\t\t\"phpcompatibility\/php-compatibility\": \"*\",\n\t\t\"wp-coding-standards\/wpcs\": \"^3.1\",\n\t\t\"phpcsstandards\/phpcsutils\": \"^1.0\",\n\t\t\"phpcsstandards\/phpcsextra\": \"^1.2\",\n\t\t\"dealerdirect\/phpcodesniffer-composer-installer\": \"^1.0\",\n\t\t\"php-stubs\/wp-cli-stubs\": \"^2.12\"\n\t},\n\t\"prefer-stable\": true,\n\t\"scripts\": {\n\t\t\"sniff-check\": \"vendor\/bin\/phpcs --standard=phpcs.ruleset.xml --no-cache cli\/ lib\/ src\/ tpl\/ thirdparty autoload.php litespeed-cache.php\"\n\t},\n\t\"config\": {\n\t\t\"allow-plugins\": {\n\t\t\t\"dealerdirect\/phpcodesniffer-composer-installer\": true\n\t\t}\n\t}\n}\n"},{"base":"plugins","rel":"litespeed-cache\/security.md","ext":"md","size":370,"mtime":1757312769,"type":"text","content":"# Security Policy\n\n## Reporting Security Bugs\n\nWe take security seriously. Please report potential vulnerabilities found in the LiteSpeed Cache plugin's source code via email to `support@litespeedtech.com` or open a ticket from your LiteSpeed Client Area.\n\nPlease see [Reporting Vulnerabilities](https:\/\/www.litespeedtech.com\/report-security-bugs) for more information.\n"},{"base":"mu","rel":"wtp-theme-seo-bridge.php","ext":"php","size":2748,"mtime":1757335020,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP SEO \u2192 Theme Bridge\n * Description: Podmienia <title> i meta description w head na warto\u015bci z WTP SEO (_wtp_seo_title_LANG, _wtp_seo_desc_LANG), z uwzgl\u0119dnieniem \u201eSEO always\u201d.\n * Version: 1.0.0\n *\/\n\nif (!defined('ABSPATH')) { exit; }\n\n\/**\n * Lokalny helper: we\u017a j\u0119zyk tak, jak widzi to motyw \/ wtyczki.\n *\/\nfunction wtpseo_bridge_detect_lang() {\n    if (function_exists('wtp_detect_lang')) {\n        return wtp_detect_lang();\n    }\n    \/\/ fallback\n    if (!empty($_GET['lang'])) return sanitize_text_field($_GET['lang']);\n    if (!empty($_COOKIE['wtp_lang'])) return sanitize_text_field($_COOKIE['wtp_lang']);\n    if (!empty($_SERVER['HTTP_ACCEPT_LANGUAGE'])) return strtolower(substr($_SERVER['HTTP_ACCEPT_LANGUAGE'],0,2));\n    return 'en';\n}\n\n\/**\n * Title: podmie\u0144 tylko na singlu i stronach (post\/page), gdy mamy SEO meta.\n *\/\nadd_filter('pre_get_document_title', function ($title) {\n    if (is_admin()) return $title;\n\n    if (is_singular()) {\n        $post_id = get_queried_object_id();\n        if ($post_id) {\n            \/\/ u\u017cyj funkcji z core SEO, je\u015bli dost\u0119pne (zachowujemy s\u0142ab\u0105 zale\u017cno\u015b\u0107)\n            if (function_exists('wtpseo_get_title_for_lang')) {\n                $lang  = wtpseo_bridge_detect_lang();\n                $t = wtpseo_get_title_for_lang($post_id, $lang);\n                if ($t) return $t;\n            }\n        }\n    }\n    return $title;\n}, 20);\n\n\/**\n * Meta description: do head \u2014 wykorzystaj buffer lub wp_head hook.\n *\/\nadd_action('wp_head', function () {\n    if (!is_singular()) return;\n    if (!function_exists('wtpseo_get_desc_for_lang')) return;\n\n    $post_id = get_queried_object_id();\n    if (!$post_id) return;\n\n    $lang = wtpseo_bridge_detect_lang();\n    $desc = wtpseo_get_desc_for_lang($post_id, $lang);\n    if ($desc) {\n        $desc = esc_attr($desc);\n        echo \"\\n<meta name=\\\"description\\\" content=\\\"{$desc}\\\" \/>\\n\";\n    }\n}, 3);\n\n\/**\n * W razie gdyby motyw u\u017cywa\u0142 og\u00f3lnych filtrowanych miejsc na title\/meta \u2014 dodaj te\u017c klasyczne filtry.\n *\/\nadd_filter('wpseo_title', function ($t) {\n    if (!function_exists('wtpseo_get_title_for_lang')) return $t;\n    if (!is_singular()) return $t;\n    $post_id = get_queried_object_id();\n    if (!$post_id) return $t;\n    $lang = wtpseo_bridge_detect_lang();\n    $val = wtpseo_get_title_for_lang($post_id, $lang);\n    return $val ? $val : $t;\n}, 20, 1);\n\nadd_filter('wpseo_metadesc', function ($d) {\n    if (!function_exists('wtpseo_get_desc_for_lang')) return $d;\n    if (!is_singular()) return $d;\n    $post_id = get_queried_object_id();\n    if (!$post_id) return $d;\n    $lang = wtpseo_bridge_detect_lang();\n    $val = wtpseo_get_desc_for_lang($post_id, $lang);\n    return $val ? $val : $d;\n}, 20, 1);"},{"base":"mu","rel":"wtp-ro-open-108.php","ext":"php","size":5773,"mtime":1757341038,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP RO Open (MU) v1.0.8\n * Description: REST do snapshot\u00f3w JSON + diagnostyka. Jedyny aktywny plik z rodziny \"wtp-ro-open-*\".\n * Version: 1.0.8\n *\/\nif (!defined('ABSPATH')) { exit; }\n\nadd_action('rest_api_init', function () {\n\n    \/\/ === 0) PING: sprawd\u017a, \u017ce \u0142aduje si\u0119 ta wersja i ten plik\n    register_rest_route('wtp-ro-open\/v1', '\/ping', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function () {\n            return [\n                'ok'      => true,\n                'version' => '1.0.8',\n                'file'    => __FILE__,\n                'mtime'   => @filemtime(__FILE__),\n                'abs'     => ABSPATH,\n                'home'    => home_url('\/'),\n            ];\n        }\n    ]);\n\n    \/\/ === 1) DIAG: listing katalogu snapshotu (dwa warianty \u015bcie\u017cek)\n    register_rest_route('wtp-ro-open\/v1', '\/ls', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'args' => [\n            'site_key' => ['required' => true, 'type' => 'string'],\n        ],\n        'callback' => function (WP_REST_Request $r) {\n            $site_key = (string) $r->get_param('site_key');\n            if (!preg_match('\/^[A-Za-z0-9]{8,64}$\/', $site_key)) {\n                return new WP_Error('bad_site_key', 'Invalid site_key', ['status'=>400]);\n            }\n\n            $up = wp_get_upload_dir();\n            $baseurl  = isset($up['baseurl']) ? $up['baseurl'] : '';\n            $basedir  = isset($up['basedir']) ? $up['basedir'] : '';\n            $dirA = wp_normalize_path( ABSPATH . 'wp-content\/uploads\/wtp-ro\/public\/' . $site_key . '\/' );\n            $dirB = $basedir ? wp_normalize_path( trailingslashit($basedir) . 'wtp-ro\/public\/' . $site_key . '\/' ) : '';\n\n            $listA = is_dir($dirA) ? array_values(array_diff(scandir($dirA), ['.','..'])) : null;\n            $listB = ($dirB && is_dir($dirB)) ? array_values(array_diff(scandir($dirB), ['.','..'])) : null;\n\n            return [\n                'version' => '1.0.8',\n                'upload_dir' => $up,\n                'paths' => [\n                    'dirA_abs' => $dirA,\n                    'dirB_wp_uploads' => $dirB,\n                ],\n                'exists' => [\n                    'dirA' => is_dir($dirA),\n                    'dirB' => ($dirB ? is_dir($dirB) : false),\n                ],\n                'list' => [\n                    'dirA' => $listA,\n                    'dirB' => $listB,\n                ],\n                'urls' => [\n                    'baseurl' => $baseurl,\n                    'public_url' => $baseurl ? untrailingslashit($baseurl).'\/wtp-ro\/public\/'.$site_key.'\/' : null,\n                ],\n            ];\n        }\n    ]);\n\n    \/\/ === 2) GET: pobierz plik JSON przez URL (z nag\u0142\u00f3wkami przegl\u0105darki)\n    register_rest_route('wtp-ro-open\/v1', '\/get', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'args' => [\n            'site_key' => ['required' => true, 'type' => 'string'],\n            'file'     => ['required' => true, 'type' => 'string'],\n        ],\n        'callback' => function (WP_REST_Request $r) {\n            $site_key = (string) $r->get_param('site_key');\n            $file     = (string) $r->get_param('file');\n\n            if (!preg_match('\/^[A-Za-z0-9]{8,64}$\/', $site_key)) {\n                return new WP_Error('bad_site_key', 'Invalid site_key', ['status'=>400]);\n            }\n            if (!preg_match('\/^[A-Za-z0-9._-]+\\.json$\/', $file)) {\n                return new WP_Error('bad_file', 'Invalid file name', ['status'=>400]);\n            }\n\n            $up = wp_get_upload_dir();\n            if (empty($up['baseurl'])) {\n                return new WP_Error('no_uploads', 'Uploads baseurl not available', ['status'=>500]);\n            }\n            $url = untrailingslashit($up['baseurl']) . \"\/wtp-ro\/public\/{$site_key}\/{$file}\";\n            $url .= (strpos($url, '?') === false ? '?' : '&') . '_b=' . time(); \/\/ cache-buster\n\n            $args = [\n                'timeout' => 20,\n                'redirection' => 5,\n                'headers' => [\n                    'Host'             => parse_url(home_url(), PHP_URL_HOST),\n                    'User-Agent'       => 'Mozilla\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/124.0.0.0 Safari\/537.36',\n                    'Accept'           => 'text\/html,application\/xhtml+xml,application\/xml;q=0.9,application\/json;q=0.8,*\/*;q=0.7',\n                    'Accept-Language'  => 'pl,en;q=0.9',\n                    'Referer'          => home_url('\/'),\n                    'Origin'           => home_url(),\n                    'Connection'       => 'keep-alive',\n                ],\n            ];\n\n            $res  = wp_remote_get($url, $args);\n            if (is_wp_error($res)) {\n                return new WP_Error('fetch_error', $res->get_error_message(), ['status'=>502]);\n            }\n            $code = wp_remote_retrieve_response_code($res);\n            $body = wp_remote_retrieve_body($res);\n            if ($code !== 200 || $body === '') {\n                return new WP_Error('upstream_'.$code, 'Upstream returned '.$code, ['status' => $code ?: 502]);\n            }\n\n            $data = json_decode($body, true);\n            if ($data === null && json_last_error() !== JSON_ERROR_NONE) {\n                return new WP_REST_Response(['raw' => base64_encode($body)], 200);\n            }\n\n            $resp = new WP_REST_Response($data, 200);\n            $resp->header('Content-Type', 'application\/json; charset=utf-8');\n            $resp->header('Cache-Control', 'public, max-age=60');\n            $resp->header('Access-Control-Allow-Origin', '*');\n            return $resp;\n        }\n    ]);\n\n});"},{"base":"mu","rel":"wtp-ro-theme-bundle.php","ext":"php","size":1980,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP RO Theme Bundle (text\/plain)\n * Description: Jeden endpoint zwracaj\u0105cy ca\u0142y snapshot (lub wycinek) jako text\/plain dla analizy.\n * Version: 1.0.0\n *\/\nif (!defined('ABSPATH')) exit;\n\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-ro\/v1', '\/theme-bundle', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function () {\n            $site_key = '5Depft8Y9LU0t6Sv';\n            $base = WP_CONTENT_DIR . \"\/uploads\/wtp-ro\/public\/{$site_key}\/\";\n\n            \/\/ Pliki snapshotu do zwr\u00f3cenia (pe\u0142ny zestaw). Mo\u017cesz skr\u00f3ci\u0107 do manifest+bundle+files_000..016.\n            $files = ['manifest.json','index.json','bundle.json'];\n            for ($i = 0; $i <= 16; $i++) {\n                $files[] = sprintf('files_%03d.json', $i);\n            }\n\n            \/\/ Zbierz zawarto\u015b\u0107 do jednego JSON-a (klucz=plik, warto\u015b\u0107=tre\u015b\u0107).\n            $out = [];\n            foreach ($files as $f) {\n                $path = $base . $f;\n                $realBase = realpath($base);\n                $realPath = realpath($path);\n                if (!$realBase || !$realPath || strpos($realPath, $realBase) !== 0 || !is_file($realPath)) {\n                    continue;\n                }\n                $data = @file_get_contents($realPath);\n                if ($data !== false) {\n                    \/\/ trzymamy oryginalny tekst pliku jako string\n                    $out[$f] = $data;\n                }\n            }\n\n            header('Content-Type: text\/plain; charset=UTF-8');\n            header('Cache-Control: public, max-age=60');\n            header('Access-Control-Allow-Origin: *');\n            header('Access-Control-Allow-Methods: GET, OPTIONS');\n\n            \/\/ Jedna odpowied\u017a z ca\u0142\u0105 paczk\u0105:\n            return new WP_REST_Response(\n                wp_json_encode($out, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE),\n                200\n            );\n        }\n    ]);\n});"},{"base":"mu","rel":"wtp-log-mirror.php","ext":"php","size":2869,"mtime":1757348041,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Log Mirror\n * Description: Kopiuje ogon wp-debug.log (poza public_html) do bezpiecznego mirrora w uploads oraz do publicznego katalogu RO (dla runnera).\n * Author: WTP\n *\/\n\nif (!defined('ABSPATH')) { exit; }\n\nadd_action('shutdown', function () {\n\n    \/\/ 1) Sk\u0105d czytamy g\u0142\u00f3wny log (poza public_html)\n    \/\/    U Ciebie ju\u017c ustawione w wp-config.php:\n    \/\/    define('WP_DEBUG_LOG', '\/home\/u493676300\/debug\/wp-debug.log');\n    $src = defined('WP_DEBUG_LOG') ? WP_DEBUG_LOG : false;\n    if (!$src || !is_string($src) || !file_exists($src) || !is_readable($src)) {\n        return;\n    }\n\n    \/\/ 2) Konfiguracja mirrorowania\n    $TAIL_BYTES = 262144; \/\/ ~256 KB\n    $ud        = wp_upload_dir();\n    $basedir   = rtrim($ud['basedir'], '\/');\n\n    \/\/ a) PRYWATNY mirror (zabroniony przez .htaccess)\n    $privDir   = $basedir . '\/wtp-logs';\n    $privFile  = $privDir . '\/wp-debug-latest.txt';\n    $privMeta  = $privDir . '\/meta.json';\n\n    \/\/ b) PUBLICZNY pod RO (dla runnera \/ REST get?site_key=...&file=logs\/wp-debug-latest.txt)\n    $opt       = get_option('wtp_ro_settings', []);\n    $siteKey   = isset($opt['site_key']) ? sanitize_text_field($opt['site_key']) : '';\n    $pubDir    = $siteKey ? ($basedir . '\/wtp-ro\/public\/' . $siteKey . '\/logs') : '';\n    $pubFile   = $siteKey ? ($pubDir . '\/wp-debug-latest.txt') : '';\n    $pubMeta   = $siteKey ? ($pubDir . '\/meta.json') : '';\n\n    \/\/ 3) Wczytaj ogon pliku (bez zjadania pami\u0119ci)\n    $srcSize   = filesize($src);\n    $cut       = false;\n    $chunk     = '';\n\n    $fh = @fopen($src, 'rb');\n    if ($fh) {\n        \/\/ przesu\u0144 pointer na ogon\n        if ($srcSize > $TAIL_BYTES) {\n            $cut = true;\n            fseek($fh, -1 * $TAIL_BYTES, SEEK_END);\n        }\n        $chunk = stream_get_contents($fh);\n        fclose($fh);\n    } else {\n        return;\n    }\n\n    \/\/ 4) Zadbaj o katalog PRYWATNY + .htaccess\n    if (!is_dir($privDir)) {\n        wp_mkdir_p($privDir);\n    }\n    $htacc = $privDir . '\/.htaccess';\n    if (!file_exists($htacc)) {\n        \/\/ twarda blokada dost\u0119pu z www\n        @file_put_contents($htacc, \"Require all denied\\nDeny from all\\n\");\n    }\n\n    \/\/ 5) Zapisz prywatny mirror\n    @file_put_contents($privFile, $chunk);\n\n    $meta = [\n        'source'         => $src,\n        'source_size'    => $srcSize,\n        'mirrored_bytes' => strlen($chunk),\n        'truncated'      => $cut,\n        'updated_at'     => gmdate('c'),\n    ];\n    @file_put_contents($privMeta, wp_json_encode($meta, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES));\n\n    \/\/ 6) Zapisz PUBLICZNY mirror (je\u015bli znamy site_key)\n    if ($siteKey && $pubDir) {\n        if (!is_dir($pubDir)) {\n            wp_mkdir_p($pubDir);\n        }\n        @file_put_contents($pubFile, $chunk);\n        @file_put_contents($pubMeta, wp_json_encode($meta, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES));\n    }\n});"},{"base":"mu","rel":"wtp-patcher-plugins.php","ext":"php","size":8667,"mtime":1757312517,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Patcher \u2014 Plugins (from chunked index)\n * Description: Patchuje wszystkie (lub wybrane) wtyczki z GitHuba na podstawie plugins-index.json + chunk\u00f3w.\n * Version: 1.0.0\n *\/\nif (!defined('ABSPATH')) exit;\n\n\/**\n * WYMAGANE w wp-config.php (jak przy eksporcie):\n * define('WTP_GH_OWNER',  'BoskiDionysos');\n * define('WTP_GH_REPO',   'weektoppick-wp-modules');\n * define('WTP_GH_BRANCH', 'main'); \/\/ opcjonalnie (domy\u015blnie main)\n * define('WTP_GH_SECRET', '...');  \/\/ ten sam sekret co przy eksporcie\n *\/\n\nadd_action('rest_api_init', function () {\n\n    \/\/ Wariant z parametrami: \/wp-json\/wtp-ro\/v1\/patch-plugins?key=...&index=...&dry=0&only=slug1,slug2\n    register_rest_route('wtp-ro\/v1', '\/patch-plugins', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if (!wtp_pp_auth_ok($req)) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            $indexUrl = trim((string)$req->get_param('index'));\n            if ($indexUrl === '') {\n                \/\/ domy\u015blny index z GH raw\n                $owner  = defined('WTP_GH_OWNER')  ? constant('WTP_GH_OWNER')  : '';\n                $repo   = defined('WTP_GH_REPO')   ? constant('WTP_GH_REPO')   : '';\n                $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n                if (!$owner || !$repo) {\n                    return new WP_REST_Response(['ok'=>false,'error'=>'missing-index-and-defaults'], 400);\n                }\n                $indexUrl = \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/plugins-index.json\";\n            }\n\n            $dry  = (string)$req->get_param('dry') === '1' || (string)$req->get_param('dry') === 'true';\n            $only = array_filter(array_map('trim', explode(',', (string)$req->get_param('only'))));\n\n            $result = wtp_pp_apply_from_index($indexUrl, $dry, $only);\n            $code   = ($result['ok'] ?? false) ? 200 : 500;\n            return new WP_REST_Response($result, $code);\n        }\n    ]);\n\n    \/\/ Kr\u00f3tszy wariant: \/wp-json\/wtp-ro\/v1\/patch\/plugins\/<secret>?index=...&dry=0&only=...\n    register_rest_route('wtp-ro\/v1', '\/patch\/plugins\/(?P<secret>[^\/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            $sec = (string)$req->get_param('secret');\n            if (!defined('WTP_GH_SECRET') || $sec !== constant('WTP_GH_SECRET')) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            $indexUrl = trim((string)$req->get_param('index'));\n            if ($indexUrl === '') {\n                $owner  = defined('WTP_GH_OWNER')  ? constant('WTP_GH_OWNER')  : '';\n                $repo   = defined('WTP_GH_REPO')   ? constant('WTP_GH_REPO')   : '';\n                $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n                if (!$owner || !$repo) {\n                    return new WP_REST_Response(['ok'=>false,'error'=>'missing-index-and-defaults'], 400);\n                }\n                $indexUrl = \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/plugins-index.json\";\n            }\n            $dry  = (string)$req->get_param('dry') === '1' || (string)$req->get_param('dry') === 'true';\n            $only = array_filter(array_map('trim', explode(',', (string)$req->get_param('only'))));\n\n            $result = wtp_pp_apply_from_index($indexUrl, $dry, $only);\n            $code   = ($result['ok'] ?? false) ? 200 : 500;\n            return new WP_REST_Response($result, $code);\n        }\n    ]);\n});\n\n\/** Autoryzacja: ?key=\u2026 lub nag\u0142\u00f3wki *\/\nfunction wtp_pp_auth_ok(WP_REST_Request $req) {\n    if (!defined('WTP_GH_SECRET')) return false;\n    $want = constant('WTP_GH_SECRET');\n\n    $key = $req->get_param('key');\n    if (is_string($key) && hash_equals($want, $key)) return true;\n\n    $hdr = $req->get_header('X-WTP-Secret');\n    if (is_string($hdr) && hash_equals($want, $hdr)) return true;\n\n    $auth = $req->get_header('Authorization');\n    if (is_string($auth) && stripos($auth, 'Bearer ') === 0) {\n        $b = trim(substr($auth, 7));\n        if (hash_equals($want, $b)) return true;\n    }\n    return false;\n}\n\n\/**\n * G\u0142\u00f3wna logika: pobiera index, pobiera wszystkie chunki, scala map\u0119 i zapisuje pliki.\n *\n * @param string $indexUrl URL do plugins-index.json\n * @param bool   $dry      true = symulacja\n * @param array  $onlySlugs lista slug\u00f3w (opcjonalnie), np. ['akismet','classic-editor']\n *\/\nfunction wtp_pp_apply_from_index($indexUrl, $dry=false, array $onlySlugs=[]) {\n    $resp = [\n        'ok'        => false,\n        'index'     => $indexUrl,\n        'dry_run'   => (bool)$dry,\n        'only'      => $onlySlugs,\n        'created'   => [],\n        'updated'   => [],\n        'skipped'   => [],\n        'errors'    => [],\n        'chunks'    => [],\n    ];\n\n    $index = wtp_pp_http_get_json($indexUrl);\n    if (!is_array($index) || empty($index['chunks']) || !is_array($index['chunks'])) {\n        $resp['errors'][] = 'bad-index';\n        return $resp;\n    }\n\n    \/\/ Zbierz wszystkie chunki do jednej mapy\n    $bundle = []; \/\/ \"plugins\/... => content\" albo \"mu-plugins\/... => content\"\n    foreach ($index['chunks'] as $row) {\n        $url = $row['raw'] ?? $row['url'] ?? null;\n        if (!$url) continue;\n        $resp['chunks'][] = $url;\n\n        $part = wtp_pp_http_get_json($url);\n        if (!is_array($part)) {\n            $resp['errors'][] = 'bad-chunk: '.$url;\n            continue;\n        }\n        \/\/ merge, chunki maj\u0105 unikalne klucze\n        foreach ($part as $k => $v) {\n            $bundle[$k] = $v;\n        }\n    }\n    if (!$bundle) {\n        $resp['errors'][] = 'empty-bundle';\n        return $resp;\n    }\n\n    \/\/ Filtr ONLY (po slugu wtyczki dla prefixu \"plugins\/\")\n    $onlySlugs = array_map('strtolower', $onlySlugs);\n    if ($onlySlugs) {\n        $bundle = array_filter($bundle, function($v, $k) use ($onlySlugs) {\n            if (strpos($k, 'plugins\/') === 0) {\n                \/\/ plugins\/<slug>\/...\n                $rest = substr($k, 8);\n                $slug = strtolower(strtok($rest, '\/'));\n                return in_array($slug, $onlySlugs, true);\n            }\n            if (strpos($k, 'mu-plugins\/') === 0) {\n                $rest = substr($k, 11);\n                $slug = strtolower(strtok($rest, '\/'));\n                return in_array($slug, $onlySlugs, true);\n            }\n            return false;\n        }, ARRAY_FILTER_USE_BOTH);\n        if (!$bundle) {\n            $resp['errors'][] = 'only-filter-empty';\n            return $resp;\n        }\n    }\n\n    \/\/ Zapis na dysk\n    foreach ($bundle as $key => $content) {\n        if (!is_string($content)) $content = (string)$content;\n\n        if (strpos($key, 'plugins\/') === 0) {\n            $base = wp_normalize_path(WP_PLUGIN_DIR);\n            $rel  = substr($key, 8); \/\/ bez \"plugins\/\"\n        } elseif (strpos($key, 'mu-plugins\/') === 0) {\n            $base = wp_normalize_path(WPMU_PLUGIN_DIR);\n            $rel  = substr($key, 11); \/\/ bez \"mu-plugins\/\"\n        } else {\n            $resp['skipped'][] = $key;\n            continue;\n        }\n\n        $target = $base . '\/' . $rel;\n        $target = wp_normalize_path($target);\n        $dir    = dirname($target);\n\n        if ($dry) {\n            if (file_exists($target)) $resp['updated'][] = $key;\n            else                      $resp['created'][] = $key;\n            continue;\n        }\n\n        if (!is_dir($dir)) {\n            if (!wp_mkdir_p($dir)) {\n                $resp['errors'][] = 'mkdir-failed: '.$dir;\n                continue;\n            }\n        }\n\n        $exists = file_exists($target);\n        $ok     = @file_put_contents($target, $content);\n        if ($ok === false) {\n            $resp['errors'][] = 'write-failed: '.$target;\n            continue;\n        }\n        if ($exists) $resp['updated'][] = $key;\n        else         $resp['created'][] = $key;\n    }\n\n    $resp['ok'] = empty($resp['errors']);\n    return $resp;\n}\n\n\/** GET JSON helper (bez zewn. bibliotek) *\/\nfunction wtp_pp_http_get_json($url) {\n    $args = [\n        'method'  => 'GET',\n        'timeout' => 25,\n        'headers' => ['Accept' => 'application\/json'],\n    ];\n    $res  = wp_remote_request($url, $args);\n    if (is_wp_error($res)) return null;\n    $code = wp_remote_retrieve_response_code($res);\n    if ($code < 200 || $code >= 300) return null;\n    $body = wp_remote_retrieve_body($res);\n    $json = json_decode($body, true);\n    return is_array($json) ? $json : null;\n}"},{"base":"mu","rel":"wtp-seo.php","ext":"php","size":16995,"mtime":1757334951,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP SEO (Core)\n * Description: Panel SEO + meta boksy: tytu\u0142\/opis\/keywords per j\u0119zyk (np. _wtp_seo_title_en). Walidacja d\u0142ugo\u015bci, REST do akcji linkiem, tryb \u201eSEO always\u201d.\n * Version: 1.0.0\n *\/\n\nif (!defined('ABSPATH')) { exit; }\n\n\/**\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * Konfiguracja domy\u015blna (mo\u017cesz zmieni\u0107 w Ustawienia \u2192 WTP SEO)\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *\/\nif (!defined('WTP_SEO_DEFAULT_TITLE_MAX')) define('WTP_SEO_DEFAULT_TITLE_MAX', 60);\nif (!defined('WTP_SEO_DEFAULT_DESC_MAX'))  define('WTP_SEO_DEFAULT_DESC_MAX', 160);\n\n\/**\n * Pomocnicze: wykryj j\u0119zyk (preferuj funkcj\u0119 z motywu, ale nie redefiniuj).\n *\/\nfunction wtpseo_detect_lang() {\n    if (function_exists('wtp_detect_lang')) {\n        return wtp_detect_lang();\n    }\n    \/\/ fallback prosty (cookie \u2192 Accept-Language \u2192 en)\n    $get = isset($_GET['lang']) ? sanitize_text_field($_GET['lang']) : '';\n    if ($get) { return $get; }\n    if (!empty($_COOKIE['wtp_lang'])) {\n        return sanitize_text_field($_COOKIE['wtp_lang']);\n    }\n    if (!empty($_SERVER['HTTP_ACCEPT_LANGUAGE'])) {\n        $al = strtolower(substr($_SERVER['HTTP_ACCEPT_LANGUAGE'], 0, 2));\n        return $al;\n    }\n    return 'en';\n}\n\n\/**\n * Lista j\u0119zyk\u00f3w: spr\u00f3buj wzi\u0105\u0107 z motywu ($WTP_LANGS), inaczej opcja\/plugin, finalnie fallback.\n *\/\nfunction wtpseo_get_languages() {\n    \/\/ 1) global z motywu\n    global $WTP_LANGS;\n    if (is_array($WTP_LANGS) && !empty($WTP_LANGS)) {\n        return array_keys($WTP_LANGS);\n    }\n    \/\/ 2) opcja z wtyczki\n    $opt = get_option('wtp_seo_langs');\n    if (is_array($opt) && !empty($opt)) {\n        return array_values(array_unique(array_map('sanitize_text_field', $opt)));\n    }\n    \/\/ 3) fallback\n    return array('en','pl','de','fr','es','pt','cs','sk');\n}\n\n\/**\n * Opcje g\u0142\u00f3wne (pobierz scalone z domy\u015blnymi).\n *\/\nfunction wtpseo_get_options() {\n    $opt = get_option('wtp_seo_options');\n    $def = array(\n        'title_max'     => WTP_SEO_DEFAULT_TITLE_MAX,\n        'desc_max'      => WTP_SEO_DEFAULT_DESC_MAX,\n        'seo_always'    => 1,          \/\/ \u201eSEO always\u201d \u2013 je\u015bli brak per-lang, u\u017cyj bazowego\n        'base_language' => 'en',       \/\/ j\u0119zyk bazowy, z kt\u00f3rego kopiujemy w razie braku\n    );\n    if (!is_array($opt)) $opt = array();\n    return array_merge($def, $opt);\n}\n\n\/**\n * Klucze meta per j\u0119zyk.\n *\/\nfunction wtpseo_meta_key_title($lang) { return '_wtp_seo_title_' . sanitize_key($lang); }\nfunction wtpseo_meta_key_desc($lang)  { return '_wtp_seo_desc_'  . sanitize_key($lang); }\nfunction wtpseo_meta_key_pk($lang)    { return '_wtp_seo_primary_kw_' . sanitize_key($lang); }\nfunction wtpseo_meta_key_oks($lang)   { return '_wtp_seo_other_kw_'   . sanitize_key($lang); }\n\n\/**\n * Walidacje d\u0142ugo\u015bci.\n *\/\nfunction wtpseo_trim_len($str, $max) {\n    $str = trim((string)$str);\n    if ($max > 0 && mb_strlen($str, 'UTF-8') > $max) {\n        $str = mb_substr($str, 0, $max, 'UTF-8');\n    }\n    return $str;\n}\n\n\/**\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * ADMIN: Ustawienia (Ustawienia \u2192 WTP SEO)\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *\/\nadd_action('admin_menu', function () {\n    add_options_page('WTP SEO', 'WTP SEO', 'manage_options', 'wtp-seo', 'wtpseo_render_settings_page');\n});\n\nfunction wtpseo_render_settings_page() {\n    if (!current_user_can('manage_options')) { return; }\n\n    \/\/ Zapis\n    if (!empty($_POST['wtpseo_save']) && check_admin_referer('wtpseo_save_settings')) {\n        $title_max = isset($_POST['title_max']) ? intval($_POST['title_max']) : WTP_SEO_DEFAULT_TITLE_MAX;\n        $desc_max  = isset($_POST['desc_max'])  ? intval($_POST['desc_max'])  : WTP_SEO_DEFAULT_DESC_MAX;\n        $seo_always = !empty($_POST['seo_always']) ? 1 : 0;\n        $base_lang  = isset($_POST['base_language']) ? sanitize_text_field($_POST['base_language']) : 'en';\n\n        $langs_raw  = isset($_POST['langs']) ? (array)$_POST['langs'] : array();\n        $langs      = array();\n        foreach ($langs_raw as $l) { $langs[] = sanitize_text_field($l); }\n\n        update_option('wtp_seo_options', array(\n            'title_max'     => max(10, $title_max),\n            'desc_max'      => max(30, $desc_max),\n            'seo_always'    => $seo_always,\n            'base_language' => $base_lang,\n        ));\n        update_option('wtp_seo_langs', array_values(array_unique($langs)));\n\n        echo '<div class=\"updated\"><p>Saved.<\/p><\/div>';\n    }\n\n    $opts  = wtpseo_get_options();\n    $langs = wtpseo_get_languages();\n\n    ?>\n    <div class=\"wrap\">\n      <h1>WTP SEO \u2014 ustawienia<\/h1>\n      <form method=\"post\">\n        <?php wp_nonce_field('wtpseo_save_settings'); ?>\n\n        <table class=\"form-table\" role=\"presentation\">\n          <tr>\n            <th scope=\"row\">Aktywne j\u0119zyki<\/th>\n            <td>\n              <p>Wpisz kody j\u0119zyk\u00f3w (ISO-2), ka\u017cdy w osobnym polu:<\/p>\n              <div id=\"wtpseo-langs\">\n                <?php\n                $show = !empty($langs) ? $langs : array('en','pl');\n                foreach ($show as $i => $code) {\n                    echo '<input type=\"text\" name=\"langs[]\" value=\"'.esc_attr($code).'\" style=\"width:80px;margin-right:6px;margin-bottom:6px\" \/>';\n                }\n                ?>\n                <button class=\"button\" type=\"button\" onclick=\"wtpseo_add_lang()\">+ j\u0119zyk<\/button>\n              <\/div>\n              <script>\n              function wtpseo_add_lang(){\n                  var wrap=document.getElementById('wtpseo-langs');\n                  var inp=document.createElement('input');\n                  inp.type='text'; inp.name='langs[]'; inp.style.width='80px'; inp.style.marginRight='6px'; inp.style.marginBottom='6px';\n                  wrap.insertBefore(inp, wrap.lastElementChild);\n              }\n              <\/script>\n            <\/td>\n          <\/tr>\n\n          <tr>\n            <th scope=\"row\">Maks. d\u0142ugo\u015bci<\/th>\n            <td>\n              <label>Title max: <input type=\"number\" name=\"title_max\" value=\"<?php echo esc_attr($opts['title_max']); ?>\" style=\"width:100px\"><\/label>\n              &nbsp;&nbsp;\n              <label>Description max: <input type=\"number\" name=\"desc_max\" value=\"<?php echo esc_attr($opts['desc_max']); ?>\" style=\"width:100px\"><\/label>\n            <\/td>\n          <\/tr>\n\n          <tr>\n            <th scope=\"row\">SEO always<\/th>\n            <td>\n              <label><input type=\"checkbox\" name=\"seo_always\" value=\"1\" <?php checked($opts['seo_always'], 1); ?>> Je\u015bli dla danego j\u0119zyka nie ma Title\/Description \u2014 u\u017cyj bazowego.<\/label>\n            <\/td>\n          <\/tr>\n\n          <tr>\n            <th scope=\"row\">J\u0119zyk bazowy<\/th>\n            <td>\n              <input type=\"text\" name=\"base_language\" value=\"<?php echo esc_attr($opts['base_language']); ?>\" style=\"width:80px\">\n              <p class=\"description\">Z tego j\u0119zyka skopiujemy Title\/Description, gdy brakuje w docelowym (gdy w\u0142\u0105czone \u201eSEO always\u201d).<\/p>\n            <\/td>\n          <\/tr>\n        <\/table>\n\n        <p><button class=\"button button-primary\" name=\"wtpseo_save\" value=\"1\">Zapisz<\/button><\/p>\n      <\/form>\n    <\/div>\n    <?php\n}\n\n\/**\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * META BOX: per post \u2014 Title\/Desc\/Keywords dla wszystkich j\u0119zyk\u00f3w\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *\/\nadd_action('add_meta_boxes', function () {\n    $screens = array('post', 'page');\n    foreach ($screens as $sc) {\n        add_meta_box('wtpseo_meta', 'WTP SEO (per j\u0119zyk)', 'wtpseo_meta_box_cb', $sc, 'normal', 'high');\n    }\n});\n\nfunction wtpseo_meta_box_cb($post) {\n    wp_nonce_field('wtpseo_meta_save', 'wtpseo_meta_nonce');\n\n    $opts  = wtpseo_get_options();\n    $langs = wtpseo_get_languages();\n\n    echo '<style>.wtpseo-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}.wtpseo-field{border:1px solid #ddd;border-radius:6px;padding:10px;background:#fff}<\/style>';\n    echo '<div class=\"wtpseo-grid\">';\n\n    foreach ($langs as $lang) {\n        $k_title = wtpseo_meta_key_title($lang);\n        $k_desc  = wtpseo_meta_key_desc($lang);\n        $k_pk    = wtpseo_meta_key_pk($lang);\n        $k_oks   = wtpseo_meta_key_oks($lang);\n\n        $v_title = get_post_meta($post->ID, $k_title, true);\n        $v_desc  = get_post_meta($post->ID, $k_desc, true);\n        $v_pk    = get_post_meta($post->ID, $k_pk, true);\n        $v_oks   = get_post_meta($post->ID, $k_oks, true);\n\n        echo '<div class=\"wtpseo-field\">';\n        echo '<h4 style=\"margin:0 0 8px\">J\u0119zyk: '.esc_html(strtoupper($lang)).'<\/h4>';\n        echo '<p><label><strong>SEO Title<\/strong> (max '.$opts['title_max'].')<br>';\n        echo '<input type=\"text\" name=\"wtpseo['.esc_attr($lang).'][title]\" value=\"'.esc_attr($v_title).'\" style=\"width:100%\"><\/label><\/p>';\n        echo '<p><label><strong>SEO Description<\/strong> (max '.$opts['desc_max'].')<br>';\n        echo '<textarea name=\"wtpseo['.esc_attr($lang).'][desc]\" rows=\"3\" style=\"width:100%\">'.esc_textarea($v_desc).'<\/textarea><\/label><\/p>';\n        echo '<p><label><strong>Primary keyword<\/strong><br>';\n        echo '<input type=\"text\" name=\"wtpseo['.esc_attr($lang).'][pk]\" value=\"'.esc_attr($v_pk).'\" style=\"width:100%\"><\/label><\/p>';\n        echo '<p><label><strong>Other keywords<\/strong> (po przecinku)<br>';\n        echo '<input type=\"text\" name=\"wtpseo['.esc_attr($lang).'][oks]\" value=\"'.esc_attr($v_oks).'\" style=\"width:100%\"><\/label><\/p>';\n        echo '<\/div>';\n    }\n    echo '<\/div>';\n}\n\nadd_action('save_post', function ($post_id) {\n    if (!isset($_POST['wtpseo_meta_nonce']) || !wp_verify_nonce($_POST['wtpseo_meta_nonce'], 'wtpseo_meta_save')) return;\n    if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) return;\n    if (!current_user_can('edit_post', $post_id)) return;\n\n    $opts  = wtpseo_get_options();\n    $langs = wtpseo_get_languages();\n\n    $in = isset($_POST['wtpseo']) ? (array)$_POST['wtpseo'] : array();\n\n    foreach ($langs as $lang) {\n        $row = isset($in[$lang]) ? (array)$in[$lang] : array();\n\n        $title = isset($row['title']) ? wtpseo_trim_len(wp_unslash($row['title']), $opts['title_max']) : '';\n        $desc  = isset($row['desc'])  ? wtpseo_trim_len(wp_unslash($row['desc']),  $opts['desc_max'])  : '';\n        $pk    = isset($row['pk'])    ? sanitize_text_field(wp_unslash($row['pk'])) : '';\n        $oks   = isset($row['oks'])   ? sanitize_text_field(wp_unslash($row['oks'])): '';\n\n        update_post_meta($post_id, wtpseo_meta_key_title($lang), $title);\n        update_post_meta($post_id, wtpseo_meta_key_desc($lang),  $desc);\n        update_post_meta($post_id, wtpseo_meta_key_pk($lang),    $pk);\n        update_post_meta($post_id, wtpseo_meta_key_oks($lang),   $oks);\n    }\n}, 10, 1);\n\n\/**\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * REST: proste akcje linkiem (np. do masowych operacji\/automatyzacji)\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * GET \/wp-json\/wtp-ro\/v1\/seo\/copy-missing?post=123&from=en&to=pl&key=SECRET\n *   \u2014 skopiuje brakuj\u0105ce title\/description\/keywords z \"from\" \u2192 \"to\" (je\u015bli puste)\n *\n * GET \/wp-json\/wtp-ro\/v1\/seo\/fix-lengths?post=123&key=SECRET\n *   \u2014 przytnie wszystkie title\/desc do limit\u00f3w (bez AI)\n *\/\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-ro\/v1', '\/seo\/copy-missing', array(\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            \/\/ proste zabezpieczenie sekretem (je\u015bli masz WTP_GH_SECRET \u2013 u\u017cyj go)\n            if (defined('WTP_GH_SECRET')) {\n                $key = $req->get_param('key');\n                if (!$key || $key !== constant('WTP_GH_SECRET')) {\n                    return new WP_REST_Response(array('ok'=>false,'error'=>'forbidden'), 403);\n                }\n            }\n\n            $post_id = intval($req->get_param('post'));\n            $from    = sanitize_text_field($req->get_param('from'));\n            $to      = sanitize_text_field($req->get_param('to'));\n\n            if (!$post_id || !$from || !$to || $from === $to) {\n                return new WP_REST_Response(array('ok'=>false,'error'=>'bad-params'), 400);\n            }\n\n            $fields = array('title','desc','pk','oks');\n            $copied = array();\n            foreach ($fields as $f) {\n                $src_key = call_user_func('wtpseo_meta_key_'.($f==='title'?'title': ($f==='desc'?'desc': ($f==='pk'?'pk':'oks')) ), $from);\n                $dst_key = call_user_func('wtpseo_meta_key_'.($f==='title'?'title': ($f==='desc'?'desc': ($f==='pk'?'pk':'oks')) ), $to);\n\n                $src = get_post_meta($post_id, $src_key, true);\n                $dst = get_post_meta($post_id, $dst_key, true);\n                if ($src && !$dst) {\n                    update_post_meta($post_id, $dst_key, $src);\n                    $copied[] = $f;\n                }\n            }\n            return new WP_REST_Response(array('ok'=>true,'copied'=>$copied), 200);\n        }\n    ));\n\n    register_rest_route('wtp-ro\/v1', '\/seo\/fix-lengths', array(\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if (defined('WTP_GH_SECRET')) {\n                $key = $req->get_param('key');\n                if (!$key || $key !== constant('WTP_GH_SECRET')) {\n                    return new WP_REST_Response(array('ok'=>false,'error'=>'forbidden'), 403);\n                }\n            }\n\n            $post_id = intval($req->get_param('post'));\n            if (!$post_id) return new WP_REST_Response(array('ok'=>false,'error'=>'bad-post'), 400);\n\n            $opts  = wtpseo_get_options();\n            $langs = wtpseo_get_languages();\n\n            $changed = array();\n            foreach ($langs as $lang) {\n                $kt = wtpseo_meta_key_title($lang);\n                $kd = wtpseo_meta_key_desc($lang);\n\n                $vt = get_post_meta($post_id, $kt, true);\n                $vd = get_post_meta($post_id, $kd, true);\n\n                $nt = wtpseo_trim_len($vt, $opts['title_max']);\n                $nd = wtpseo_trim_len($vd, $opts['desc_max']);\n\n                if ($nt !== $vt) { update_post_meta($post_id, $kt, $nt); $changed[] = \"title:$lang\"; }\n                if ($nd !== $vd) { update_post_meta($post_id, $kd, $nd); $changed[] = \"desc:$lang\"; }\n            }\n            return new WP_REST_Response(array('ok'=>true,'changed'=>$changed), 200);\n        }\n    ));\n});\n\n\/**\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * \u201eSEO always\u201d \u2013 funkcje pomocnicze dla Bridge i innych\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *\/\nfunction wtpseo_get_title_for_lang($post_id, $lang) {\n    $opts = wtpseo_get_options();\n    $val  = get_post_meta($post_id, wtpseo_meta_key_title($lang), true);\n    if ($val) return $val;\n    if (!empty($opts['seo_always']) && !empty($opts['base_language'])) {\n        $fallback = get_post_meta($post_id, wtpseo_meta_key_title($opts['base_language']), true);\n        if ($fallback) return $fallback;\n    }\n    return '';\n}\n\nfunction wtpseo_get_desc_for_lang($post_id, $lang) {\n    $opts = wtpseo_get_options();\n    $val  = get_post_meta($post_id, wtpseo_meta_key_desc($lang), true);\n    if ($val) return $val;\n    if (!empty($opts['seo_always']) && !empty($opts['base_language'])) {\n        $fallback = get_post_meta($post_id, wtpseo_meta_key_desc($opts['base_language']), true);\n        if ($fallback) return $fallback;\n    }\n    return '';\n}"},{"base":"mu","rel":"wtp-patcher-theme.php","ext":"php","size":5227,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Patcher \u2014 Theme (GitHub \u2192 WP)\n * Description: Pobiera theme-bundle.json z GitHuba i zapisuje pliki do aktywnego motywu (z backupem .bak). Endpoint: \/wp-json\/wtp-ro\/v1\/patch-theme?key=SECRET\n * Version: 1.0.0\n *\/\nif (!defined('ABSPATH')) exit;\n\n\/**\n * WYMAGANE:\n *   define('WTP_GH_SECRET', 'twoj_bardzo_tajny_sekret'); \/\/ w wp-config.php (JU\u017b masz)\n *\n * OPCJONALNE (mo\u017cesz zostawi\u0107 domy\u015blne):\n *   define('WTP_PATCH_THEME_URL', 'https:\/\/raw.githubusercontent.com\/BoskiDionysos\/weektoppick-wp-modules\/main\/theme-bundle.json');\n *\/\n\nif (!defined('WTP_PATCH_THEME_URL')) {\n    define('WTP_PATCH_THEME_URL', 'https:\/\/raw.githubusercontent.com\/BoskiDionysos\/weektoppick-wp-modules\/main\/theme-bundle.json');\n}\n\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-ro\/v1', '\/patch-theme', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true', \/\/ publiczny, ale sprawdzamy SECRET ni\u017cej\n        'callback' => 'wtp_patch_theme_run',\n        'args'     => [\n            'key'  => ['type'=>'string','required'=>false],\n            'url'  => ['type'=>'string','required'=>false], \/\/ opcjonalny override URL\n            'dry'  => ['type'=>'boolean','required'=>false], \/\/ podgl\u0105d bez zapisu\n        ],\n    ]);\n});\n\nfunction wtp_patch_theme_run(WP_REST_Request $req) {\n    \/\/ --- auth przez sekret ---\n    if (!defined('WTP_GH_SECRET')) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'missing-secret'], 403);\n    }\n    $key = (string)$req->get_param('key');\n    if ($key === '' || !hash_equals(WTP_GH_SECRET, $key)) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n    }\n\n    \/\/ --- ustal \u017ar\u00f3d\u0142o bundle ---\n    $url = (string)($req->get_param('url') ?: WTP_PATCH_THEME_URL);\n\n    \/\/ pobierz JSON\n    $res = wp_remote_get($url, [\n        'timeout' => 30,\n        'headers' => [\n            'Accept'     => 'application\/json',\n            'User-Agent' => 'WTP-Patcher\/1.0',\n        ],\n    ]);\n    $code = wp_remote_retrieve_response_code($res);\n    if ($code !== 200) {\n        return new WP_REST_Response(['ok'=>false,'error'=>\"fetch-failed:$code\"], 500);\n    }\n    $body = wp_remote_retrieve_body($res);\n    $bundle = json_decode($body, true);\n    if (!is_array($bundle)) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'invalid-json'], 500);\n    }\n\n    \/\/ --- katalog motywu ---\n    $theme_dir = wp_normalize_path(get_stylesheet_directory());\n    if (!$theme_dir || !is_dir($theme_dir) || !is_writable($theme_dir)) {\n        return new WP_REST_Response(['ok'=>false,'error'=>'theme-dir-not-writable'], 500);\n    }\n\n    $dry = filter_var($req->get_param('dry'), FILTER_VALIDATE_BOOLEAN);\n\n    $updated = [];\n    $created = [];\n    $skipped = [];\n    $errors  = [];\n\n    foreach ($bundle as $keyPath => $content) {\n        \/\/ Oczekujemy kluczy typu \"theme\/rel\/plik.php\"\n        if (strpos($keyPath, 'theme\/') !== 0) {\n            $skipped[] = $keyPath;\n            continue;\n        }\n        $rel = substr($keyPath, strlen('theme\/')); \/\/ relatywnie do motywu\n\n        \/\/ sanity path: bez ..\/, bez pocz\u0105tkowego slasha\n        if ($rel === '' || strpos($rel, '..') !== false || $rel[0] === '\/') {\n            $errors[] = ['file'=>$keyPath,'error'=>'bad-relpath'];\n            continue;\n        }\n\n        $target = wp_normalize_path($theme_dir . '\/' . $rel);\n        \/\/ dopuszczalne rozszerzenia \u2014 lekkie sito\n        $ext = strtolower(pathinfo($target, PATHINFO_EXTENSION));\n        if (!in_array($ext, ['php','css','js','json','svg','txt','md','html','po','mo'], true)) {\n            $skipped[] = $keyPath;\n            continue;\n        }\n\n        \/\/ utw\u00f3rz katalog\n        $dir = dirname($target);\n        if (!is_dir($dir)) {\n            if (!$dry) {\n                if (!wp_mkdir_p($dir)) {\n                    $errors[] = ['file'=>$keyPath,'error'=>'mkdir-failed'];\n                    continue;\n                }\n            }\n        }\n\n        $exists = file_exists($target);\n        if (!$dry) {\n            \/\/ zr\u00f3b backup .bak (tylko je\u017celi istnia\u0142)\n            if ($exists) {\n                $bak = $target . '.bak';\n                \/\/ \u017ceby nie nadpisywa\u0107 istniej\u0105cego .bak, dopisz timestamp\n                if (file_exists($bak)) {\n                    $bak = $target . '.' . date('Ymd_His') . '.bak';\n                }\n                if (!@copy($target, $bak)) {\n                    $errors[] = ['file'=>$keyPath,'error'=>'backup-failed'];\n                    continue;\n                }\n            }\n            \/\/ zapisz now\u0105 tre\u015b\u0107\n            $ok = @file_put_contents($target, $content);\n            if ($ok === false) {\n                $errors[] = ['file'=>$keyPath,'error'=>'write-failed'];\n                continue;\n            }\n        }\n\n        if ($exists) { $updated[] = $rel; } else { $created[] = $rel; }\n    }\n\n    $ok = empty($errors);\n    return new WP_REST_Response([\n        'ok'       => $ok,\n        'dry_run'  => (bool)$dry,\n        'source'   => $url,\n        'theme'    => basename($theme_dir),\n        'created'  => $created,\n        'updated'  => $updated,\n        'skipped'  => $skipped,\n        'errors'   => $errors\n    ], $ok ? 200 : 500);\n}"},{"base":"mu","rel":"wtp-push-runner-cron.php","ext":"php","size":4617,"mtime":1757342681,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Push Runner (Cron -> GitHub Dispatch)\n * Description: Co 10 min sprawdza, czy snapshot si\u0119 zmieni\u0142; je\u015bli tak, wyzwala GitHub Actions (workflow_dispatch).\n * Version: 1.0.0\n *\/\nif ( ! defined('ABSPATH') ) { exit; }\n\nadd_action('wtp_runner_check_event', 'wtp_runner_check_and_dispatch');\n\nregister_activation_hook(__FILE__, function(){\n    if ( ! wp_next_scheduled('wtp_runner_check_event') ) {\n        wp_schedule_event(time() + 60, 'ten_minutes', 'wtp_runner_check_event');\n    }\n});\n\nregister_deactivation_hook(__FILE__, function(){\n    $ts = wp_next_scheduled('wtp_runner_check_event');\n    if ( $ts ) wp_unschedule_event($ts, 'wtp_runner_check_event');\n});\n\n\/\/ Dodatkowy interwa\u0142 10 min\nadd_filter('cron_schedules', function($s){\n    if ( ! isset($s['ten_minutes']) ) {\n        $s['ten_minutes'] = ['interval' => 600, 'display' => 'Every 10 Minutes'];\n    }\n    return $s;\n});\n\n\/**\n * G\u0142\u00f3wny checker:\n * - czyta index.json przez lokalny dysk (szybciej) lub REST fallback\n * - je\u015bli generated_at\/mtime > ostatnio znane -> wyzwala dispatch workflow\n *\/\nfunction wtp_runner_check_and_dispatch() {\n    $site_key = defined('WTP_SITE_KEY') ? WTP_SITE_KEY : '';\n    if ( ! $site_key || ! preg_match('\/^[A-Za-z0-9]{8,64}$\/', $site_key) ) {\n        error_log('[WTP Runner] Missing\/invalid WTP_SITE_KEY');\n        return;\n    }\n\n    \/\/ \u015bcie\u017cki\n    $index_path = ABSPATH . 'wp-content\/uploads\/wtp-ro\/public\/' . $site_key . '\/index.json';\n    $last_opt_key = 'wtp_runner_last_generated_at';\n\n    \/\/ spr\u00f3buj z dysku\n    $generated_at = 0;\n    if ( file_exists($index_path) && is_readable($index_path) ) {\n        $raw = file_get_contents($index_path);\n        if ( $raw !== false ) {\n            $j = json_decode($raw, true);\n            if ( is_array($j) && !empty($j['generated_at']) ) {\n                $generated_at = intval($j['generated_at']);\n            } else {\n                \/\/ fallback: mtime pliku\n                $generated_at = @filemtime($index_path) ?: 0;\n            }\n        }\n    } else {\n        \/\/ fallback przez REST (nasz MU endpoint \/get)\n        $url = home_url('\/wp-json\/wtp-ro-open\/v1\/get?site_key=' . rawurlencode($site_key) . '&file=index.json');\n        $res = wp_remote_get($url, ['timeout' => 10]);\n        if ( ! is_wp_error($res) && wp_remote_retrieve_response_code($res) === 200 ) {\n            $body = wp_remote_retrieve_body($res);\n            $j = json_decode($body, true);\n            if ( is_array($j) && !empty($j['generated_at']) ) {\n                $generated_at = intval($j['generated_at']);\n            }\n        }\n    }\n\n    if ( ! $generated_at ) {\n        \/\/ nic nie r\u00f3b \u2013 brak danych\n        return;\n    }\n\n    $last = intval( get_option($last_opt_key, 0) );\n    if ( $generated_at <= $last ) {\n        \/\/ snapshot bez zmian\n        return;\n    }\n\n    \/\/ zmiana wykryta: zapisz now\u0105 warto\u015b\u0107 i wyzw\u00f3l dispatch\n    update_option($last_opt_key, $generated_at, false);\n    wtp_runner_dispatch_workflow($site_key);\n}\n\n\/**\n * Wywo\u0142uje GitHub Actions workflow_dispatch z inputs.site_key\n *\/\nfunction wtp_runner_dispatch_workflow($site_key) {\n    $owner   = defined('WTP_GH_OWNER')    ? WTP_GH_OWNER    : '';\n    $repo    = defined('WTP_GH_REPO')     ? WTP_GH_REPO     : '';\n    $workflow= defined('WTP_GH_WORKFLOW') ? WTP_GH_WORKFLOW : 'wtp-snapshot-sync.yml';\n    $token   = defined('WTP_GH_TOKEN')    ? WTP_GH_TOKEN    : '';\n\n    if ( ! $owner || ! $repo || ! $workflow || ! $token ) {\n        error_log('[WTP Runner] Missing GitHub config (owner\/repo\/workflow\/token)');\n        return;\n    }\n\n    $url = \"https:\/\/api.github.com\/repos\/{$owner}\/{$repo}\/actions\/workflows\/{$workflow}\/dispatches\";\n    $payload = json_encode([\n        'ref' => 'main',\n        'inputs' => [\n            'site_key' => $site_key,\n            'rest_base'=> home_url('\/wp-json\/wtp-ro-open\/v1'),\n        ],\n    ]);\n\n    $args = [\n        'timeout' => 20,\n        'headers' => [\n            'Authorization' => 'Bearer ' . $token,\n            'Accept'        => 'application\/vnd.github+json',\n            'User-Agent'    => 'wtp-push-runner',\n        ],\n        'body' => $payload,\n    ];\n\n    $res = wp_remote_post($url, $args);\n    if ( is_wp_error($res) ) {\n        error_log('[WTP Runner] GitHub dispatch error: ' . $res->get_error_message());\n        return;\n    }\n    $code = wp_remote_retrieve_response_code($res);\n    if ( $code !== 204 ) {\n        error_log('[WTP Runner] GitHub dispatch HTTP ' . $code . ' body: ' . wp_remote_retrieve_body($res));\n    } else {\n        error_log('[WTP Runner] GitHub dispatch OK for site_key=' . $site_key);\n    }\n}"},{"base":"mu","rel":"wtp-dev-bridge.php","ext":"php","size":20182,"mtime":1757310179,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Dev Bridge \u2014 GitHub Export + Patcher (all-in-one)\n * Description: Eksport motywu i wtyczek do GitHub (z chunkowaniem) + patch motywu z theme-bundle.json (RAW). Bez kolizji sta\u0142ych.\n * Version: 4.0.0\n *\/\nif (!defined('ABSPATH')) exit;\n\n\/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\/\/ GLOBAL GUARD: \u0142aduj tylko raz (eliminuje duplikaty w logach)\n\/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nif (defined('WTP_DEV_BRIDGE_LOADED')) return;\ndefine('WTP_DEV_BRIDGE_LOADED', true);\n\n\/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\/\/ WYMAGANE W wp-config.php  (NIE definiujemy tu!)\n\/\/ \u2500  define('WTP_GH_OWNER',  'BoskiDionysos');\n\/\/ \u2500  define('WTP_GH_REPO',   'weektoppick-wp-modules');\n\/\/ \u2500  define('WTP_GH_BRANCH', 'main');               \/\/ opcjonalnie\n\/\/ \u2500  define('WTP_GH_TOKEN',  'ghp_xxx');            \/\/ repo:contents write\n\/\/ \u2500  define('WTP_GH_SECRET', 'super_tajny_sekret'); \/\/ do REST\n\/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n$__need = ['WTP_GH_OWNER','WTP_GH_REPO','WTP_GH_TOKEN','WTP_GH_SECRET'];\nforeach ($__need as $__c) { if (!defined($__c)) { error_log(\"[WTP Bridge] Missing constant $__c\"); return; } }\n\n\/\/ ============================================================================\n\/\/ KLASA \u2013 ca\u0142a logika w \u015brodku (brak globalnych const \u2192 brak kolizji)\n\/\/ ============================================================================\nif (!class_exists('WTP_Dev_Bridge')):\n\nfinal class WTP_Dev_Bridge {\n\n    \/\/ Konfiguracja (trzymamy w w\u0142a\u015bciwo\u015bciach \u2013 nie ma redefinicji)\n    private static array $allowedExt     = ['php','css','js','json','svg','txt','md','html','po','mo'];\n    private static string $excludeRx     = '#(?:^|\/)(node_modules|vendor|\\.git|\\.svn|\\.github|tests?|bin|dist|cache)(\/|$)#i';\n    private static string $excludeFileRx = '#\\.(map|lock|min\\.map|ico|woff2?|ttf|eot)$#i';\n    private static int    $chunkTarget   = 4_500_000; \/\/ ~4.5 MB (poni\u017cej 5 MB limit\u00f3w)\n    private static string $themeTarget   = 'theme-bundle.json';\n    private static string $pluginsTarget = 'plugins-bundle.json';\n    private static string $pluginsIndex  = 'plugins-index.json';\n    private static string $chunkBase     = 'plugins-bundle';\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ ROUTES\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    public static function boot() : void {\n        add_action('rest_api_init', [__CLASS__, 'register_routes']);\n    }\n\n    public static function register_routes() : void {\n\n        \/\/ publish\/theme\/{secret}\n        register_rest_route('wtp-ro\/v1', '\/publish\/theme\/(?P<secret>[^\/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n                $bundle = self::collect_theme();\n                if (!$bundle) return self::err(500,'empty-theme');\n                $res = self::push_to_github($bundle, self::$themeTarget, 'Update theme-bundle.json (publish)');\n                return self::answer($res);\n            }\n        ]);\n\n        \/\/ publish\/plugins\/{secret}\n        register_rest_route('wtp-ro\/v1', '\/publish\/plugins\/(?P<secret>[^\/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n                $bundle = self::collect_plugins_full();\n                if (!$bundle) return self::err(500,'empty-plugins');\n                $res = self::push_to_github($bundle, self::$pluginsTarget, 'Update plugins-bundle.json (publish)');\n                return self::answer($res);\n            }\n        ]);\n\n        \/\/ publish\/all\/{secret}\n        register_rest_route('wtp-ro\/v1', '\/publish\/all\/(?P<secret>[^\/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n\n                $out = [];\n\n                $theme = self::collect_theme();\n                if ($theme) {\n                    $r1 = self::push_to_github($theme, self::$themeTarget, 'Update theme-bundle.json (publish-all)');\n                    $out['theme'] = self::res_map($r1);\n                } else $out['theme'] = ['ok'=>false,'error'=>'empty-theme'];\n\n                $plugins = self::collect_plugins_full();\n                if ($plugins) {\n                    $r2 = self::push_to_github($plugins, self::$pluginsTarget, 'Update plugins-bundle.json (publish-all)');\n                    $out['plugins'] = self::res_map($r2);\n                } else $out['plugins'] = ['ok'=>false,'error'=>'empty-plugins'];\n\n                $ok = ($out['theme']['ok']??false) || ($out['plugins']['ok']??false);\n                return new \\WP_REST_Response(['ok'=>$ok]+$out, $ok?200:500);\n            }\n        ]);\n\n        \/\/ publish\/plugins-chunked\/{secret}\n        register_rest_route('wtp-ro\/v1', '\/publish\/plugins-chunked\/(?P<secret>[^\/]+)', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                if (!self::auth_secret_path($req)) return self::err(403,'forbidden');\n                $bundle = self::collect_plugins_full();\n                if (!$bundle) return self::err(500,'empty-plugins');\n\n                $chunks = self::chunk_map($bundle, self::$chunkTarget);\n                if (!$chunks) return self::err(500,'chunking-failed');\n\n                $push = self::push_chunks_and_index($chunks);\n                if (is_wp_error($push)) return self::err(500, $push->get_error_message());\n                return new \\WP_REST_Response(['ok'=>true]+$push, 200);\n            }\n        ]);\n\n        \/\/ patch\/theme?key=SECRET&url=RAW_JSON&dry=0|1\n        register_rest_route('wtp-ro\/v1', '\/patch\/theme', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => function(\\WP_REST_Request $req) {\n                $key = (string)$req->get_param('key');\n                if (!$key || $key !== constant('WTP_GH_SECRET')) return self::err(403,'forbidden');\n\n                $url = trim((string)$req->get_param('url'));\n                if ($url === '') return self::err(400,'missing-url');\n\n                $dry = (string)$req->get_param('dry');\n                $dry = ($dry === '1' || strtolower($dry) === 'true' || $dry === 'on') ? true : false;\n\n                $json = self::http('GET', $url, null, null, 25);\n                if ($json['code'] !== 200 || !is_array($json['body_raw'])) {\n                    return self::err(502, 'fetch-failed');\n                }\n                $map = $json['body_raw']; \/\/ mapa \"theme\/relpath\" => content\n\n                $themeDir = wp_normalize_path(get_stylesheet_directory());\n                $updated = []; $created = []; $skipped = []; $errors = [];\n\n                foreach ($map as $k => $v) {\n                    if (strpos($k, 'theme\/') !== 0) { $skipped[] = $k; continue; }\n                    $rel = ltrim(substr($k, 6), '\/'); \/\/ po \"theme\/\"\n                    if ($rel === '') { $skipped[] = $k; continue; }\n\n                    $target = $themeDir . '\/' . $rel;\n                    $dir = dirname($target);\n                    if (!is_dir($dir)) {\n                        if (!$dry) @wp_mkdir_p($dir);\n                        if (!is_dir($dir)) { $errors[] = $rel; continue; }\n                    }\n                    $exists = file_exists($target);\n                    if (!$dry) {\n                        $ok = @file_put_contents($target, $v);\n                        if ($ok === false) { $errors[] = $rel; continue; }\n                    }\n                    if ($exists) $updated[] = $rel; else $created[] = $rel;\n                }\n\n                return new \\WP_REST_Response([\n                    'ok'      => empty($errors),\n                    'dry_run' => $dry,\n                    'source'  => $url,\n                    'theme'   => basename($themeDir),\n                    'created' => $created,\n                    'updated' => $updated,\n                    'skipped' => $skipped,\n                    'errors'  => $errors,\n                ], empty($errors) ? 200 : 500);\n            }\n        ]);\n\n        \/\/ proste: ping\/selftest (bez sekretu)\n        register_rest_route('wtp-ro\/v1', '\/ping', [\n            'methods'  => 'GET',\n            'permission_callback' => '__return_true',\n            'callback' => fn() => new \\WP_REST_Response(['ok'=>true,'ts'=>time()], 200)\n        ]);\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ AUTH helpers\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function auth_secret_path(\\WP_REST_Request $req) : bool {\n        $sec = (string)$req->get_param('secret');\n        return ($sec !== '' && $sec === constant('WTP_GH_SECRET'));\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ COLLECTORS\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function collect_theme() : array {\n        $base = wp_normalize_path( get_stylesheet_directory() );\n        return self::collect_from_base($base, 'theme');\n    }\n\n    private static function collect_plugins_full() : array {\n        $out = [];\n        $plugins = wp_normalize_path( WP_PLUGIN_DIR );\n        if (is_dir($plugins)) $out += self::collect_from_base($plugins, 'plugins');\n\n        $mu = wp_normalize_path( WPMU_PLUGIN_DIR );\n        if (is_dir($mu) && $mu !== $plugins) $out += self::collect_from_base($mu, 'mu-plugins');\n\n        return $out;\n    }\n\n    private static function collect_from_base(string $base, string $prefix) : array {\n        $rii = new \\RecursiveIteratorIterator(new \\RecursiveDirectoryIterator($base, \\FilesystemIterator::SKIP_DOTS));\n        $out = [];\n        foreach ($rii as $spl) {\n            \/** @var \\SplFileInfo $spl *\/\n            if (!$spl->isFile()) continue;\n\n            $path = wp_normalize_path($spl->getPathname());\n            $rel  = ltrim(str_replace($base, '', $path), '\/');\n\n            if (preg_match(self::$excludeRx, $rel))     continue;\n            if (preg_match(self::$excludeFileRx, $rel)) continue;\n\n            $ext = strtolower(pathinfo($rel, PATHINFO_EXTENSION));\n            if (!in_array($ext, self::$allowedExt, true)) continue;\n\n            $content = @file_get_contents($path);\n            if ($content === false) continue;\n\n            $key = trim($prefix,'\/').'\/'.$rel;\n            $out[$key] = $content;\n        }\n        return $out;\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ CHUNKING\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function chunk_map(array $map, int $targetBytes) : array {\n        $chunks = []; $current = []; $approx = 2; \/\/ {}\n        foreach ($map as $k => $v) {\n            $entry = [$k => $v];\n            $ej = json_encode($entry, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE);\n            $sz = strlen($ej) + 1;\n            if ($approx + $sz > $targetBytes && !empty($current)) {\n                $chunks[] = $current; $current = []; $approx = 2;\n            }\n            $current[$k] = $v; $approx += $sz;\n        }\n        if (!empty($current)) $chunks[] = $current;\n        return $chunks;\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ GITHUB PUSH (single file)\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function push_to_github(array $bundle, string $target, string $msg) {\n        if (empty($bundle)) return new \\WP_Error('wtp_empty','Empty bundle');\n        $payload = json_encode($bundle, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE);\n        if ($payload === false) return new \\WP_Error('wtp_json','json_encode failed');\n\n        $owner  = constant('WTP_GH_OWNER');\n        $repo   = constant('WTP_GH_REPO');\n        $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n        $token  = constant('WTP_GH_TOKEN');\n\n        $api  = \"https:\/\/api.github.com\/repos\/{$owner}\/{$repo}\/contents\/{$target}\";\n        $sha  = null;\n        $get  = self::http('GET', $api.'?ref='.rawurlencode($branch), $token, null, 25);\n        if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n        $body = ['message'=>$msg,'content'=>base64_encode($payload),'branch'=>$branch];\n        if ($sha) $body['sha'] = $sha;\n\n        $put = self::http('PUT', $api, $token, $body, 30);\n        if ($put['code'] >= 300) {\n            return new \\WP_Error('wtp_github_put', 'GitHub PUT error '.$put['code'].': '.json_encode($put['body']));\n        }\n\n        $raw = \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/{$target}\";\n        return ['raw_url'=>$raw,'commit'=>$put['body']['commit']['sha'] ?? null];\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ GITHUB PUSH (chunks + index)\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function push_chunks_and_index(array $chunks) {\n        $owner  = constant('WTP_GH_OWNER');\n        $repo   = constant('WTP_GH_REPO');\n        $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n        $token  = constant('WTP_GH_TOKEN');\n\n        $pushed = [];\n        foreach ($chunks as $i => $map) {\n            $payload = json_encode($map, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE);\n            $path    = sprintf('%s_%03d.json', self::$chunkBase, $i);\n            $res     = self::gh_put_file($owner,$repo,$branch,$token,$path,$payload,'Update '.$path.' (chunk)');\n            if ($res['code'] >= 300) {\n                return new \\WP_Error('wtp_github_put', 'GitHub PUT error '.$res['code'].': '.json_encode($res['body']));\n            }\n            $pushed[] = [\n                'path' => $path,\n                'size' => strlen($payload),\n                'sha1' => sha1($payload),\n                'raw'  => \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/{$path}\",\n            ];\n        }\n\n        $index = [\n            'version'       => 1,\n            'generated_at'  => time(),\n            'total_chunks'  => count($pushed),\n            'chunks'        => $pushed,\n        ];\n        $idxPayload = json_encode($index, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT);\n        $idxRes     = self::gh_put_file($owner,$repo,$branch,$token,self::$pluginsIndex,$idxPayload,'Update '.self::$pluginsIndex.' (index)');\n        if ($idxRes['code'] >= 300) {\n            return new \\WP_Error('wtp_github_put', 'GitHub PUT index error '.$idxRes['code'].': '.json_encode($idxRes['body']));\n        }\n\n        return [\n            'index_raw_url' => \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/\".self::$pluginsIndex,\n            'chunks'        => $pushed,\n        ];\n    }\n\n    private static function gh_put_file($owner,$repo,$branch,$token,$path,$content,$message) {\n        $api = \"https:\/\/api.github.com\/repos\/{$owner}\/{$repo}\/contents\/{$path}\";\n        $sha = null;\n        $get = self::http('GET', $api.'?ref='.rawurlencode($branch), $token, null, 25);\n        if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n        $body = ['message'=>$message,'content'=>base64_encode($content),'branch'=>$branch];\n        if ($sha) $body['sha'] = $sha;\n        return self::http('PUT', $api, $token, $body, 30);\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ HTTP helper (WP)\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function http(string $method, string $url, ?string $token, $json, int $timeout = 20) : array {\n        $args = [\n            'method'  => $method,\n            'headers' => [\n                'User-Agent' => 'WTP-Dev-Bridge',\n                'Accept'     => 'application\/json',\n            ],\n            'timeout' => $timeout,\n        ];\n        if ($token) $args['headers']['Authorization'] = 'token '.$token;\n        if ($json !== null) {\n            $args['headers']['Content-Type'] = 'application\/json';\n            $args['body'] = is_string($json) ? $json : json_encode($json);\n        }\n        $res  = wp_remote_request($url, $args);\n        $code = wp_remote_retrieve_response_code($res);\n        $body = wp_remote_retrieve_body($res);\n\n        \/\/ spr\u00f3buj JSON; je\u015bli nie wychodzi \u2013 zwr\u00f3\u0107 raw\n        $decoded = json_decode($body, true);\n        return [\n            'code'     => $code,\n            'body'     => is_array($decoded) ? $decoded : null,\n            'body_raw' => is_array($decoded) ? $decoded : null,\n            'text'     => is_array($decoded) ? null : $body,\n        ];\n    }\n\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    \/\/ Response helpers\n    \/\/ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    private static function err(int $code, string $msg) {\n        return new \\WP_REST_Response(['ok'=>false,'error'=>$msg], $code);\n    }\n    private static function answer($res) {\n        if (is_wp_error($res)) return self::err(500, $res->get_error_message());\n        return new \\WP_REST_Response(['ok'=>true]+$res, 200);\n    }\n    private static function res_map($res) : array {\n        return is_wp_error($res) ? ['ok'=>false,'error'=>$res->get_error_message()] : ['ok'=>true]+$res;\n    }\n}\n\nWTP_Dev_Bridge::boot();\n\nendif; \/\/ class exists"},{"base":"mu","rel":"wtp-translate.php","ext":"php","size":6542,"mtime":1757332837,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Translate (mu-plugin)\n * Description: T\u0142umaczenia tre\u015bci per j\u0119zyk (mock + hak na AI), batch + panel Tools. Szanuje \u201eSEO always\u201d.\n * Version: 1.0.0\n *\/\nif (!defined('ABSPATH')) exit;\n\n\/** Domy\u015blne j\u0119zyki je\u015bli motyw nie poda *\/\nif (!isset($WTP_LANGS) || !is_array($WTP_LANGS) || !$WTP_LANGS) {\n  $WTP_LANGS = [\n    'en'=>['flag'=>'\ud83c\uddec\ud83c\udde7','name'=>'English'],\n    'pl'=>['flag'=>'\ud83c\uddf5\ud83c\uddf1','name'=>'Polski'],\n    'de'=>['flag'=>'\ud83c\udde9\ud83c\uddea','name'=>'Deutsch'],\n    'fr'=>['flag'=>'\ud83c\uddeb\ud83c\uddf7','name'=>'Fran\u00e7ais'],\n    'it'=>['flag'=>'\ud83c\uddee\ud83c\uddf9','name'=>'Italiano'],\n    'es'=>['flag'=>'\ud83c\uddea\ud83c\uddf8','name'=>'Espa\u00f1ol'],\n    'pt'=>['flag'=>'\ud83c\uddf5\ud83c\uddf9','name'=>'Portugu\u00eas'],\n    'cs'=>['flag'=>'\ud83c\udde8\ud83c\uddff','name'=>'\u010ce\u0161tina'],\n    'sk'=>['flag'=>'\ud83c\uddf8\ud83c\uddf0','name'=>'Sloven\u010dina'],\n  ];\n}\n\n\/** Ustawienia jako\u015bci per j\u0119zyk (0=off, 1=fast, 2=mid, 3=full) *\/\nfunction wtp_tr_defaults(){\n  $langs = array_keys($GLOBALS['WTP_LANGS']);\n  $levels = [];\n  foreach($langs as $l){ $levels[$l] = ($l==='en')?3:1; } \/\/ EN full, reszta fast\n  return ['levels'=>$levels];\n}\nfunction wtp_tr_getopt(){\n  $o = get_option('wtp_tr_options');\n  if (!is_array($o)) $o=[];\n  return array_replace_recursive(wtp_tr_defaults(), $o);\n}\nadd_action('admin_menu', function(){\n  add_submenu_page('tools.php','WTP Translate','WTP Translate','manage_options','wtp-translate','wtp_tr_tools_page');\n});\nadd_action('admin_init', function(){\n  register_setting('wtp_tr_group','wtp_tr_options',[\n    'type'=>'array','sanitize_callback'=>'wtp_tr_sanitize','default'=>wtp_tr_defaults()\n  ]);\n});\nfunction wtp_tr_sanitize($in){\n  $d = wtp_tr_defaults(); $out = is_array($in)?$in:[];\n  $levels = $out['levels'] ?? [];\n  $out['levels']=[];\n  foreach(array_keys($GLOBALS['WTP_LANGS']) as $l){\n    $v = isset($levels[$l])? intval($levels[$l]) : $d['levels'][$l];\n    $out['levels'][$l] = max(0,min(3,$v));\n  }\n  return $out;\n}\nfunction wtp_tr_tools_page(){\n  if (!current_user_can('manage_options')) return;\n  $o = wtp_tr_getopt();\n  ?>\n  <div class=\"wrap\">\n    <h1>WTP Translate<\/h1>\n    <form method=\"post\" action=\"options.php\">\n      <?php settings_fields('wtp_tr_group'); ?>\n      <h2>Jako\u015b\u0107 t\u0142umacze\u0144 per j\u0119zyk<\/h2>\n      <table class=\"form-table\">\n        <tr><th>J\u0119zyk<\/th><th>Poziom<\/th><\/tr>\n        <?php foreach($GLOBALS['WTP_LANGS'] as $code=>$meta): ?>\n          <tr>\n            <th><?php echo esc_html($meta['flag'].' '.$meta['name'].' ('.$code.')'); ?><\/th>\n            <td>\n              <select name=\"wtp_tr_options[levels][<?php echo esc_attr($code);?>]\">\n                <?php\n                $opts = [0=>'OFF',1=>'FAST',2=>'MID',3=>'FULL'];\n                foreach($opts as $k=>$lbl){\n                  printf('<option value=\"%d\"%s>%s<\/option>',$k, selected($o['levels'][$code]??1,$k,false), esc_html($lbl));\n                }\n                ?>\n              <\/select>\n            <\/td>\n          <\/tr>\n        <?php endforeach; ?>\n      <\/table>\n      <?php submit_button(); ?>\n    <\/form>\n\n    <hr>\n    <h2>Batch t\u0142umacze\u0144<\/h2>\n    <p>Wype\u0142nia brakuj\u0105ce t\u0142umaczenia (mock je\u017celi brak AI). Mo\u017cesz pu\u015bci\u0107 po postach lub kategoriach.<\/p>\n    <p>\n      <a class=\"button button-primary\" href=\"<?php echo esc_url(admin_url('admin-post.php?action=wtp_tr_batch&scope=posts')); ?>\">Posty<\/a>\n      <a class=\"button\" href=\"<?php echo esc_url(admin_url('admin-post.php?action=wtp_tr_batch&scope=terms')); ?>\">Kategorie<\/a>\n    <\/p>\n    <p>Albo URL-em (z telefonu): <code><?php echo esc_html(site_url('\/wp-json\/wtp-ro\/v1\/tr\/batch?secret=')); ?><strong>TW\u00d3J_SEKRET<\/strong>&amp;scope=posts|terms<\/code><\/p>\n  <\/div>\n  <?php\n}\n\n\/** Batch \u2013 przyciski + REST *\/\nadd_action('admin_post_wtp_tr_batch', function(){\n  if (!current_user_can('manage_options')) wp_die('forbidden');\n  $scope = sanitize_text_field($_GET['scope'] ?? 'posts');\n  $done = wtp_tr_run_batch($scope);\n  wp_safe_redirect(add_query_arg(['page'=>'wtp-translate','done'=>$done], admin_url('tools.php')));\n  exit;\n});\nadd_action('rest_api_init', function(){\n  register_rest_route('wtp-ro\/v1','\/tr\/batch',[\n    'methods'=>'GET','permission_callback'=>'__return_true',\n    'callback'=>function(WP_REST_Request $req){\n        $secret = $req->get_param('secret');\n        if (!$secret || ($secret !== (defined('WTP_GH_SECRET')? constant('WTP_GH_SECRET') : ''))) {\n          return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'],403);\n        }\n        $scope = $req->get_param('scope') ?: 'posts';\n        $done = wtp_tr_run_batch($scope);\n        return new WP_REST_Response(['ok'=>true,'done'=>$done],200);\n    }\n  ]);\n});\n\n\/** Rdze\u0144: wype\u0142nij brakuj\u0105ce t\u0142umaczenia (mock albo przez filtr AI) *\/\nfunction wtp_tr_run_batch($scope='posts'){\n  $langs = array_keys($GLOBALS['WTP_LANGS']); $count=0;\n\n  if ($scope==='posts') {\n    $q = new WP_Query(['post_type'=>'post','post_status'=>'publish','posts_per_page'=>300,'no_found_rows'=>true]);\n    foreach($q->posts as $p){\n      $src = [\n        'title'=>get_the_title($p),\n        'excerpt'=>wp_strip_all_tags(wp_trim_words(get_post_field('post_content',$p),60,'')),\n      ];\n      foreach($langs as $l){\n        \/\/ pola docelowe (to przyk\u0142adowe klucze \u2013 mo\u017cesz zmieni\u0107 wg potrzeb)\n        $have = get_post_meta($p->ID, \"_wtp_tr_excerpt_{$l}\", true);\n        if ($have===''){\n          $text = apply_filters('wtp_translate_generate', null, $src, $l, $p->ID);\n          if (!is_string($text) || $text===''){\n            \/\/ mock fallback\n            $text = '['.$l.'] '.$src['excerpt'];\n          }\n          update_post_meta($p->ID, \"_wtp_tr_excerpt_{$l}\", $text);\n          $count++;\n        }\n      }\n    }\n  } else {\n    $terms = get_terms(['taxonomy'=>'category','hide_empty'=>false]);\n    foreach($terms as $t){\n      $src = ['name'=>$t->name,'desc'=>$t->description ?: $t->name];\n      foreach($langs as $l){\n        $have = get_term_meta($t->term_id, \"_wtp_tr_desc_{$l}\", true);\n        if ($have===''){\n          $text = apply_filters('wtp_translate_generate', null, $src, $l, $t->term_id);\n          if (!is_string($text) || $text===''){\n            $text = '['.$l.'] '.$src['desc'];\n          }\n          update_term_meta($t->term_id, \"_wtp_tr_desc_{$l}\", $text);\n          $count++;\n        }\n      }\n    }\n  }\n  return $count;\n}\n\n\/**\n * Przyk\u0142ad integracji z AI (DOCS):\n *\n * add_filter('wtp_translate_generate', function($out, $src, $lang, $object_id){\n *   \/\/ Tu wywo\u0142aj sw\u00f3j serwis AI i zwr\u00f3\u0107 string\n *   return my_ai_call($src['excerpt'] ?? $src['desc'], $lang);\n * }, 10, 4);\n *\/"},{"base":"mu","rel":"wtp-canonical-redirects.php","ext":"php","size":711,"mtime":1757345807,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Canonical Redirects\n * Description: 301 z \/?p=ID na kanoniczny permalink; usuwa \u015bmieciowe parametry.\n *\/\n\nif (!defined('ABSPATH')) exit;\n\nadd_action('template_redirect', function () {\n    \/\/ 1) \/?p=ID -> permalink\n    if (isset($_GET['p']) && is_numeric($_GET['p'])) {\n        $id = (int) $_GET['p'];\n        $url = get_permalink($id);\n        if ($url && !is_wp_error($url)) {\n            wp_redirect($url, 301);\n            exit;\n        }\n    }\n\n    \/\/ 2) je\u015bli to feed na stronie, przekieruj na stron\u0119 bez \/feed\/\n    if (is_feed()) {\n        $url = home_url(add_query_arg([]));\n        if ($url) {\n            wp_redirect($url, 301);\n            exit;\n        }\n    }\n}, 1);"},{"base":"mu","rel":"wtp-tax-i18n-seo.php","ext":"php","size":16624,"mtime":1757331162,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Taxonomy i18n + SEO (mu-plugin)\n * Description: T\u0142umaczenia i SEO (title\/desc) dla kategorii\/podkategorii (taksonomie). UI w edycji terminu + kolejka + REST.\n * Version: 1.0.0\n *\/\nif (!defined('ABSPATH')) exit;\n\n\/** Wsp\u00f3lne z translate\/seo *\/\nif (!defined('WTP_ALLOWED_LANGS')) define('WTP_ALLOWED_LANGS','en,pl,de,fr,it,es,pt,cs,sk');\nif (!defined('WTP_TAX_OPT')) define('WTP_TAX_OPT','wtp_tax_settings');\nif (!defined('WTP_TR_OPTION')) define('WTP_TR_OPTION','wtp_translate_settings'); \/\/ u\u017cyjemy quality + seo_always z WTP Translate\n\n\/\/ Kolejka termin\u00f3w\nconst WTP_TAX_QUEUE = 'wtp_tax_queue_items'; \/\/ tablica string\u00f3w \"tax:term_id\"\n\n\/\/ Meta klucze (term meta)\nfunction wtp_tax_key_name($lang){ return \"_wtp_tr_name_{$lang}\"; }\nfunction wtp_tax_key_desc($lang){ return \"_wtp_tr_desc_{$lang}\"; }\nfunction wtp_tax_key_seo_t($lang){ return \"_wtp_seo_title_{$lang}\"; }\nfunction wtp_tax_key_seo_d($lang){ return \"_wtp_seo_desc_{$lang}\"; }\n\n\/\/ J\u0119zyki\nfunction wtp_tax_langs(){ $codes=array_filter(array_map('trim',explode(',',WTP_ALLOWED_LANGS))); return $codes?:['en']; }\nfunction wtp_tax_current_lang(){\n    if (isset($_GET['lang'])) { $x=strtolower(sanitize_text_field($_GET['lang'])); if (in_array($x, wtp_tax_langs(), true)) return $x; }\n    if (isset($_COOKIE['wtp_lang'])) { $x=strtolower(sanitize_text_field($_COOKIE['wtp_lang'])); if (in_array($x, wtp_tax_langs(), true)) return $x; }\n    return 'en';\n}\n\n\/\/ Pobranie ustawie\u0144 jako\u015bci\/sealw z WTP Translate (fallback domy\u015blne)\nfunction wtp_tax_get_tr_settings(){\n    $def_quality = ['en'=>'off','pl'=>'full','de'=>'mid','fr'=>'mid','it'=>'rough','es'=>'rough','pt'=>'rough','cs'=>'rough','sk'=>'rough'];\n    $tr = get_option(WTP_TR_OPTION, []);\n    $quality = isset($tr['quality']) && is_array($tr['quality']) ? array_merge($def_quality,$tr['quality']) : $def_quality;\n    $seo_always = isset($tr['seo_always']) ? (int)$tr['seo_always'] : 1;\n    $model = isset($tr['model']) ? sanitize_text_field($tr['model']) : 'gpt-4o-mini';\n    $max_batch = isset($tr['max_batch']) ? max(1,(int)$tr['max_batch']) : 5;\n    return compact('quality','seo_always','model','max_batch');\n}\n\n\/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * UI w edycji terminu (kategorie\/podkategorie)\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nadd_action('edit_term_form_fields', function($term){\n    if (!current_user_can('manage_categories')) return;\n    $langs = wtp_tax_langs();\n    $active = wtp_tax_current_lang();\n    echo '<tr class=\"form-field\"><th colspan=\"2\"><h3>WTP: T\u0142umaczenia i SEO (per j\u0119zyk)<\/h3><\/th><\/tr>';\n    echo '<tr class=\"form-field\"><th scope=\"row\">Aktywny j\u0119zyk<\/th><td><strong>'.esc_html(strtoupper($active)).'<\/strong> (mo\u017cesz prze\u0142\u0105czy\u0107 ?lang=xx w URL)<\/td><\/tr>';\n\n    \/\/ Pola tylko dla aktywnego j\u0119zyka, \u017ceby nie prze\u0142adowywa\u0107 UI\n    $t = get_term_meta($term->term_id, wtp_tax_key_name($active), true);\n    $d = get_term_meta($term->term_id, wtp_tax_key_desc($active), true);\n    $st= get_term_meta($term->term_id, wtp_tax_key_seo_t($active), true);\n    $sd= get_term_meta($term->term_id, wtp_tax_key_seo_d($active), true);\n\n    echo '<tr class=\"form-field\"><th scope=\"row\"><label>Nazwa ('.$active.')<\/label><\/th><td><input type=\"text\" name=\"wtp_tax_name\" value=\"'.esc_attr($t).'\" style=\"width:100%\"><\/td><\/tr>';\n    echo '<tr class=\"form-field\"><th scope=\"row\"><label>Opis ('.$active.')<\/label><\/th><td><textarea name=\"wtp_tax_desc\" rows=\"3\" style=\"width:100%\">'.esc_textarea($d).'<\/textarea><\/td><\/tr>';\n    echo '<tr class=\"form-field\"><th scope=\"row\"><label>SEO Title ('.$active.')<\/label><\/th><td><input type=\"text\" name=\"wtp_tax_seo_t\" value=\"'.esc_attr($st).'\" style=\"width:100%\"><\/td><\/tr>';\n    echo '<tr class=\"form-field\"><th scope=\"row\"><label>SEO Description ('.$active.')<\/label><\/th><td><textarea name=\"wtp_tax_seo_d\" rows=\"2\" style=\"width:100%\">'.esc_textarea($sd).'<\/textarea><\/td><\/tr>';\n    wp_nonce_field('wtp_tax_save','wtp_tax_nonce');\n}, 10, 1);\n\nadd_action('edited_term', function($term_id){\n    if (!isset($_POST['wtp_tax_nonce']) || !wp_verify_nonce($_POST['wtp_tax_nonce'],'wtp_tax_save')) return;\n    $lang = wtp_tax_current_lang();\n    $name = isset($_POST['wtp_tax_name']) ? wp_strip_all_tags(wp_unslash($_POST['wtp_tax_name'])) : '';\n    $desc = isset($_POST['wtp_tax_desc']) ? wp_strip_all_tags(wp_unslash($_POST['wtp_tax_desc'])) : '';\n    $st   = isset($_POST['wtp_tax_seo_t']) ? wp_strip_all_tags(wp_unslash($_POST['wtp_tax_seo_t'])) : '';\n    $sd   = isset($_POST['wtp_tax_seo_d']) ? wp_strip_all_tags(wp_unslash($_POST['wtp_tax_seo_d'])) : '';\n\n    update_term_meta($term_id, wtp_tax_key_name($lang), $name);\n    update_term_meta($term_id, wtp_tax_key_desc($lang), $desc);\n    update_term_meta($term_id, wtp_tax_key_seo_t($lang), $st);\n    update_term_meta($term_id, wtp_tax_key_seo_d($lang), $sd);\n\n    \/\/ wpisz do kolejki automatycznie\n    if (!empty($_POST['taxonomy'])) {\n        wtp_tax_enqueue((string)sanitize_key($_POST['taxonomy']), (int)$term_id);\n    }\n}, 10, 1);\n\n\/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * Kolejka: enqueue przy tworzeniu\/edycji + cron\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nfunction wtp_tax_enqueue(string $tax, int $term_id){\n    $key = $tax.':'.$term_id;\n    $q = get_option(WTP_TAX_QUEUE,[]);\n    if (!is_array($q)) $q=[];\n    if (!in_array($key,$q,true)) { $q[]=$key; update_option(WTP_TAX_QUEUE,$q,false); }\n}\nadd_action('created_term', function($term_id,$tt_id,$taxonomy){ wtp_tax_enqueue((string)$taxonomy,(int)$term_id); }, 10, 3);\nadd_action('edited_term',  function($term_id,$tt_id,$taxonomy){ wtp_tax_enqueue((string)$taxonomy,(int)$term_id); }, 10, 3);\n\n\/\/ Cron co 10 min\nadd_filter('cron_schedules', function($s){ if(!isset($s['wtp_10min'])) $s['wtp_10min']=['interval'=>600,'display'=>'WTP every 10 min']; return $s; });\nadd_action('wtp_tax_cron','wtp_tax_process_batch');\nif (!wp_next_scheduled('wtp_tax_cron')) wp_schedule_event(time()+420, 'wtp_10min', 'wtp_tax_cron');\n\n\/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * Przetwarzanie batch\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nfunction wtp_tax_process_batch(){\n    $cfg = wtp_tax_get_tr_settings();\n    $q = get_option(WTP_TAX_QUEUE,[]);\n    if (empty($q)) return;\n    $batch = array_splice($q,0,$cfg['max_batch']);\n    update_option(WTP_TAX_QUEUE,$q,false);\n\n    foreach ($batch as $item){\n        if (strpos($item,':')===false) continue;\n        [$tax,$id] = explode(':',$item,2);\n        $term = get_term((int)$id,(string)$tax);\n        if (!$term || is_wp_error($term)) continue;\n        wtp_tax_process_term_all_langs($term,$cfg);\n    }\n}\n\nfunction wtp_tax_process_term_all_langs(WP_Term $term, array $cfg){\n    $langs = wtp_tax_langs();\n    foreach ($langs as $lang){\n        \/\/ pomijamy EN tre\u015b\u0107 \u2014 ale SEO zawsze, je\u015bli w\u0142\u0105czone\n        $want_content = ($lang!=='en' && (($cfg['quality'][$lang]??'off')!=='off'));\n        $want_seo = (int)$cfg['seo_always']===1;\n        if ($want_content){\n            [$nm,$ds] = wtp_tax_ai_translate($term->name, term_description($term) ?: '', $lang, $cfg['quality'][$lang]);\n            update_term_meta($term->term_id, wtp_tax_key_name($lang), $nm);\n            update_term_meta($term->term_id, wtp_tax_key_desc($lang), $ds);\n        }\n        if ($want_seo){\n            [$st,$sd] = wtp_tax_ai_make_seo($term->name, term_description($term) ?: '', $lang);\n            update_term_meta($term->term_id, wtp_tax_key_seo_t($lang), $st);\n            update_term_meta($term->term_id, wtp_tax_key_seo_d($lang), $sd);\n        }\n    }\n}\n\n\/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * \u201eAI\u201d \u2014 real\/symulacja (sp\u00f3jnie z WTP Translate)\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nfunction wtp_tax_ai_translate($name,$desc,$lang,$quality){\n    if (!defined('WTP_OPENAI_KEY') || !WTP_OPENAI_KEY) {\n        return [\"[{$lang}\/{$quality}] \".$name, \"[{$lang}\/{$quality}] \".mb_substr(wp_strip_all_tags($desc),0,400)];\n    }\n    $prompt = \"Translate taxonomy term (category) to {$lang} with quality {$quality}. Return:\\nName:\\n<one line>\\nDescription:\\n<short paragraph>\";\n    $resp = wp_remote_post('https:\/\/api.openai.com\/v1\/chat\/completions',[\n        'timeout'=>30,'headers'=>['Authorization'=>'Bearer '.WTP_OPENAI_KEY,'Content-Type'=>'application\/json'],\n        'body'=>json_encode([\n            'model'=>'gpt-4o-mini',\n            'messages'=>[\n                ['role'=>'system','content'=>'You translate taxonomy labels.'],\n                ['role'=>'user','content'=>\"SOURCE NAME:\\n{$name}\\n\\nSOURCE DESCRIPTION:\\n{$desc}\\n\\n\".$prompt],\n            ],\n            'temperature'=>($quality==='full'?0.4:($quality==='mid'?0.5:0.7)),\n        ])\n    ]);\n    if (is_wp_error($resp)) return [$name,$desc];\n    $txt = json_decode(wp_remote_retrieve_body($resp),true)['choices'][0]['message']['content'] ?? '';\n    if (!$txt) return [$name,$desc];\n    $lines = preg_split(\"\/\\r?\\n\/\",$txt);\n    $nm = trim($lines[0] ?? $name);\n    $ds = trim($txt);\n    return [$nm,$ds];\n}\nfunction wtp_tax_ai_make_seo($name,$desc,$lang){\n    if (!defined('WTP_OPENAI_KEY') || !WTP_OPENAI_KEY) {\n        return [\"[SEO {$lang}] \".mb_substr($name,0,58), \"[SEO {$lang}] \".mb_substr(wp_strip_all_tags($desc),0,155)];\n    }\n    $prompt = \"Make SEO for taxonomy archive in {$lang}. Title <=60 chars, Description 140-160. Return as:\\nTitle: ...\\nDescription: ...\";\n    $resp = wp_remote_post('https:\/\/api.openai.com\/v1\/chat\/completions',[\n        'timeout'=>30,'headers'=>['Authorization'=>'Bearer '.WTP_OPENAI_KEY,'Content-Type'=>'application\/json'],\n        'body'=>json_encode([\n            'model'=>'gpt-4o-mini',\n            'messages'=>[\n                ['role'=>'system','content'=>'You are an SEO assistant.'],\n                ['role'=>'user','content'=>\"NAME:\\n{$name}\\n\\nDESCRIPTION:\\n\".mb_substr(wp_strip_all_tags($desc),0,1000).\"\\n\\n\".$prompt],\n            ],\n            'temperature'=>0.4,\n        ])\n    ]);\n    if (is_wp_error($resp)) return [\"[SEO {$lang}] \".mb_substr($name,0,58), \"[SEO {$lang}] \".mb_substr(wp_strip_all_tags($desc),0,155)];\n    $txt = json_decode(wp_remote_retrieve_body($resp),true)['choices'][0]['message']['content'] ?? '';\n    if (!$txt) return [\"[SEO {$lang}] \".mb_substr($name,0,58), \"[SEO {$lang}] \".mb_substr(wp_strip_all_tags($desc),0,155)];\n    $seoT=$seoD='';\n    foreach (preg_split(\"\/\\r?\\n\/\",$txt) as $ln){\n        if (!$seoT && stripos($ln,'title:')===0) $seoT=trim(substr($ln,6));\n        if (!$seoD && stripos($ln,'description:')===0) $seoD=trim(substr($ln,12));\n    }\n    $seoT = $seoT ?: mb_substr($name,0,60);\n    $seoD = $seoD ?: mb_substr(wp_strip_all_tags($desc),0,155);\n    return [$seoT,$seoD];\n}\n\n\/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * Wystaw SEO meta\/schema na stronach archiw\u00f3w taksonomii\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nadd_action('wp_head', function(){\n    if (!is_category() && !is_tag() && !is_tax()) return;\n    $term = get_queried_object();\n    if (!$term || !($term instanceof WP_Term)) return;\n    $lang = wtp_tax_current_lang();\n\n    $st = get_term_meta($term->term_id, wtp_tax_key_seo_t($lang), true);\n    $sd = get_term_meta($term->term_id, wtp_tax_key_seo_d($lang), true);\n    $nm = get_term_meta($term->term_id, wtp_tax_key_name($lang), true) ?: $term->name;\n\n    if (!$st) $st = $nm;\n    if (!$sd) $sd = wp_strip_all_tags( term_description($term) ?: '' );\n    echo '<meta name=\"description\" content=\"'.esc_attr($sd).'\">'.\"\\n\";\n\n    $data = [\n        '@context'=>'https:\/\/schema.org',\n        '@type'=>'CollectionPage',\n        'name'=>$st,\n        'inLanguage'=>$lang,\n        'description'=>$sd,\n        'url'=>get_term_link($term),\n    ];\n    echo '<script type=\"application\/ld+json\">'.wp_json_encode($data).'<\/script>'.\"\\n\";\n}, 98);\n\n\/* \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n * REST: status\/run\/one\n * \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nadd_action('rest_api_init', function(){\n    \/\/ status\n    register_rest_route('wtp-ro\/v1','\/translate\/terms\/status',[\n        'methods'=>'GET','permission_callback'=>'__return_true',\n        'callback'=>function(){ $q=get_option(WTP_TAX_QUEUE,[]); return ['ok'=>true,'queued'=>is_array($q)?count($q):0];}\n    ]);\n    \/\/ batch run\n    register_rest_route('wtp-ro\/v1','\/translate\/terms\/run',[\n        'methods'=>'GET','permission_callback'=>'__return_true',\n        'callback'=>function(WP_REST_Request $r){\n            $secret = $r->get_param('key');\n            if (!defined('WTP_GH_SECRET') || $secret!==constant('WTP_GH_SECRET')) return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'],403);\n            wtp_tax_process_batch();\n            return ['ok'=>true];\n        }\n    ]);\n    \/\/ single term\n    register_rest_route('wtp-ro\/v1','\/translate\/term',[\n        'methods'=>'GET','permission_callback'=>'__return_true',\n        'callback'=>function(WP_REST_Request $r){\n            $secret = $r->get_param('key');\n            if (!defined('WTP_GH_SECRET') || $secret!==constant('WTP_GH_SECRET')) return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'],403);\n            $tax = sanitize_key($r->get_param('tax') ?: 'category');\n            $id  = (int)$r->get_param('term');\n            $lang= strtolower(sanitize_text_field($r->get_param('lang') ?: 'pl'));\n            $term = get_term($id,$tax);\n            if (!$term || is_wp_error($term)) return new WP_REST_Response(['ok'=>false,'error'=>'no-term'],404);\n            if (!in_array($lang, wtp_tax_langs(), true)) return new WP_REST_Response(['ok'=>false,'error'=>'bad-lang'],400);\n\n            $cfg = wtp_tax_get_tr_settings();\n            $q = $cfg['quality'][$lang] ?? 'rough';\n\n            \/\/ tre\u015b\u0107 (je\u015bli nie en) + SEO always\n            if ($lang!=='en' && $q!=='off'){\n                [$nm,$ds] = wtp_tax_ai_translate($term->name, term_description($term) ?: '', $lang, $q);\n                update_term_meta($term->term_id, wtp_tax_key_name($lang), $nm);\n                update_term_meta($term->term_id, wtp_tax_key_desc($lang), $ds);\n            }\n            if ((int)$cfg['seo_always']===1){\n                [$st,$sd] = wtp_tax_ai_make_seo($term->name, term_description($term) ?: '', $lang);\n                update_term_meta($term->term_id, wtp_tax_key_seo_t($lang), $st);\n                update_term_meta($term->term_id, wtp_tax_key_seo_d($lang), $sd);\n            }\n            return ['ok'=>true,'term'=>$id,'tax'=>$tax,'lang'=>$lang];\n        }\n    ]);\n});"},{"base":"mu","rel":"wtp-canonical.php","ext":"php","size":1946,"mtime":1757346059,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Canonical + Robots\n * Description: Ustala <link rel=\"canonical\"> i dodaje noindex dla feed\/search\/404. Dzia\u0142a jako MU-plugin.\n *\/\nif (!defined('ABSPATH')) exit;\n\nadd_action('wp_head', function () {\n    \/\/ Noindex dla stron, kt\u00f3rych nie chcemy w indeksie\n    if (is_feed() || is_search() || is_404()) {\n        echo \"<meta name=\\\"robots\\\" content=\\\"noindex,follow\\\" \/>\\n\";\n        return;\n    }\n\n    \/\/ Wyznacz adres kanoniczny\n    $url = null;\n\n    if (is_singular()) {\n        $url = get_permalink();\n    } elseif (is_home() || is_front_page()) {\n        $url = home_url('\/');\n    } elseif (is_category() || is_tag() || is_tax()) {\n        $term = get_queried_object();\n        if ($term && !is_wp_error($term)) {\n            $url = get_term_link($term);\n        }\n    } elseif (is_post_type_archive()) {\n        $pt = get_query_var('post_type');\n        if ($pt) {\n            $url = get_post_type_archive_link($pt);\n        }\n    } elseif (is_author()) {\n        $author = get_queried_object();\n        if ($author && isset($author->ID)) {\n            $url = get_author_posts_url($author->ID);\n        }\n    } elseif (is_date() || is_archive()) {\n        \/\/ Fallback dla innych archiw\u00f3w\n        global $wp;\n        $req = isset($wp->request) ? $wp->request : '';\n        $url = home_url(user_trailingslashit($req));\n    }\n\n    if (!$url) return;\n\n    \/\/ Obs\u0142uga paginacji (kanoniczny z \/page\/N\/)\n    $paged = (int) get_query_var('paged');\n    if ($paged > 1) {\n        $url = trailingslashit($url) . user_trailingslashit('page\/' . $paged, 'paged');\n    }\n\n    \/\/ Usu\u0144 \u015bmieciowe parametry z kanonicznego\n    $url = remove_query_arg(array(\n        'utm_source','utm_medium','utm_campaign','utm_term','utm_content',\n        'gclid','fbclid','_ga','_gl'\n    ), $url);\n\n    \/\/ Wypluj canonical\n    $url = esc_url($url);\n    if ($url) {\n        echo '<link rel=\"canonical\" href=\"' . $url . \"\\\" \/>\\n\";\n    }\n}, 1);"},{"base":"mu","rel":"wtp-plugins-manifest.php","ext":"php","size":1459,"mtime":1757335772,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Dev \u2013 Plugins Manifest (read-only)\n * Description: Zwraca list\u0119 wtyczek (aktywne\/nieaktywne) + wersje przez REST.\n *\/\nif (!defined('ABSPATH')) exit;\n\nadd_action('rest_api_init', function () {\n    register_rest_route('wtp-dev\/v1', '\/plugins', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            $secret = $req->get_param('key');\n            if (!is_string($secret) || $secret !== '7e4c9f0e41ac8f2d92e71c0c47ddbb7a46ef7d6ff6e0c09a6c54a28dcd320baf') {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            if (!function_exists('get_plugins')) require_once ABSPATH.'wp-admin\/includes\/plugin.php';\n            $all = get_plugins();\n            $active = get_option('active_plugins', []);\n            $out = [];\n            foreach ($all as $file => $data) {\n                $slug = strtok($file, '\/');\n                $out[] = [\n                    'slug'     => $slug,\n                    'file'     => $file,\n                    'name'     => $data['Name'] ?? $slug,\n                    'version'  => $data['Version'] ?? '',\n                    'author'   => $data['Author'] ?? '',\n                    'is_active'=> in_array($file, $active, true),\n                ];\n            }\n            return ['ok'=>true, 'count'=>count($out), 'plugins'=>$out];\n        }\n    ]);\n});"},{"base":"mu","rel":"wtp-exporter-chunked.php","ext":"php","size":11517,"mtime":1757312769,"type":"text","content":"<?php\n\/**\n * Plugin Name: WTP Exporter Chunked \u2014 GitHub (plugins only)\n * Description: Eksportuje WSZYSTKIE wtyczki (plugins + mu-plugins) do wielu plik\u00f3w JSON < 5 MB + generuje indeks. Push do GitHub.\n * Version: 1.1.0\n *\/\nif (!defined('ABSPATH')) exit;\n\n\/* Twardsze limity na czas eksportu (unikamy fatal\/timeout przy du\u017cych instalacjach) *\/\n@ini_set('memory_limit', '512M');\n@set_time_limit(120);\n\n\/*\n * WYMAGANE w wp-config.php:\n * define('WTP_GH_OWNER',  'BoskiDionysos');\n * define('WTP_GH_REPO',   'weektoppick-wp-modules');\n * define('WTP_GH_BRANCH', 'main');            \/\/ opcjonalnie (domy\u015blnie 'main')\n * define('WTP_GH_TOKEN',  'ghp_xxx');         \/\/ PAT z repo:contents write\n * define('WTP_GH_SECRET', 'twoj_sekret');     \/\/ do REST (param <secret>)\n *\/\n\n$need = ['WTP_GH_OWNER','WTP_GH_REPO','WTP_GH_TOKEN','WTP_GH_SECRET'];\nforeach ($need as $c) { if (!defined($c)) { error_log(\"[WTP ExporterChunked] Missing constant $c\"); return; } }\n\n\/** \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *  KONFIG\n *  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nconst WTP_ALLOWED_EXT        = ['php','css','js','json','svg','txt','md','html','po','mo'];\nconst WTP_EXCLUDE_RX         = '#(?:^|\/)(node_modules|vendor|\\.git|\\.svn|\\.github|tests?|bin|dist|cache)(\/|$)#i';\nconst WTP_EXCLUDE_FILE_RX    = '#\\.(map|lock|min\\.map|ico|woff2?|ttf|eot)$#i';\nconst WTP_CHUNK_TARGET_BYTES = 5_000_000; \/\/ ~5 MB\nconst WTP_INDEX_PATH         = 'plugins-index.json';     \/\/ w repo (root)\nconst WTP_CHUNK_BASENAME     = 'plugins-bundle';         \/\/ prefix nazw chunk\u00f3w\n\nadd_action('rest_api_init', function () {\n\n    \/\/ \/wp-json\/wtp-ro\/v1\/publish\/plugins-chunked\/<secret>\n    register_rest_route('wtp-ro\/v1', '\/publish\/plugins-chunked\/(?P<secret>[^\/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if ($req->get_param('secret') !== constant('WTP_GH_SECRET')) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n\n            $t0 = microtime(true);\n            $bundle = wtp_collect_plugins_fs_map();                  \/\/ mapa \"plugins\/... => content\"\n            if (!$bundle) return new WP_REST_Response(['ok'=>false,'error'=>'empty-plugins'], 500);\n\n            $chunks = wtp_chunk_map($bundle, WTP_CHUNK_TARGET_BYTES); \/\/ [ [k=>v,...], ... ]\n            if (empty($chunks)) return new WP_REST_Response(['ok'=>false,'error'=>'chunking-failed'], 500);\n\n            \/\/ push wszystkich chunk\u00f3w + indeksu do GitHub\n            $push = wtp_push_chunks_and_index_to_github($chunks);\n            if (is_wp_error($push)) {\n                return new WP_REST_Response(['ok'=>false,'error'=>$push->get_error_message()], 500);\n            }\n\n            $push['t_sec'] = round(microtime(true) - $t0, 3);\n            $push['mem_mb'] = round(memory_get_usage(true)\/1048576, 1);\n            return new WP_REST_Response(['ok'=>true] + $push, 200);\n        }\n    ]);\n\n    \/\/ \/wp-json\/wtp-ro\/v1\/publish\/plugins-chunked-debug\/<secret>  (BEZ pushu \u2013 diagnostyka)\n    register_rest_route('wtp-ro\/v1', '\/publish\/plugins-chunked-debug\/(?P<secret>[^\/]+)', [\n        'methods'  => 'GET',\n        'permission_callback' => '__return_true',\n        'callback' => function (WP_REST_Request $req) {\n            if ($req->get_param('secret') !== constant('WTP_GH_SECRET')) {\n                return new WP_REST_Response(['ok'=>false,'error'=>'forbidden'], 403);\n            }\n            $t0 = microtime(true);\n            $bundle = wtp_collect_plugins_fs_map();\n            if (!$bundle) return new WP_REST_Response(['ok'=>false,'error'=>'empty-plugins'], 500);\n\n            $chunks = wtp_chunk_map($bundle, WTP_CHUNK_TARGET_BYTES);\n            $t1 = microtime(true);\n\n            return new WP_REST_Response([\n                'ok'           => true,\n                'files_total'  => count($bundle),\n                'chunks_total' => count($chunks),\n                'mem_mb'       => round(memory_get_usage(true)\/1048576, 1),\n                'time_sec'     => round($t1 - $t0, 3),\n                'chunk_sizes'  => array_map(function($m){\n                    $s = json_encode($m, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_INVALID_UTF8_SUBSTITUTE);\n                    return strlen($s);\n                }, $chunks),\n                'sample'       => array_slice(array_keys($bundle), 0, 10),\n            ], 200);\n        }\n    ]);\n});\n\n\/** \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *  ZBIERANIE: wszystkie wtyczki (plugins + mu-plugins) -> mapa \"prefix\/relpath\" => content\n *  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nfunction wtp_collect_plugins_fs_map() {\n    $out = [];\n\n    $plugins_base = wp_normalize_path(WP_PLUGIN_DIR);\n    if (is_dir($plugins_base)) {\n        $out += wtp_collect_from_base($plugins_base, 'plugins');\n    }\n\n    $mu_base = wp_normalize_path(WPMU_PLUGIN_DIR);\n    if (is_dir($mu_base) && $mu_base !== $plugins_base) {\n        $out += wtp_collect_from_base($mu_base, 'mu-plugins');\n    }\n    return $out;\n}\n\nfunction wtp_collect_from_base($base, $prefix) {\n    $rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($base, FilesystemIterator::SKIP_DOTS));\n    $out = [];\n    foreach ($rii as $spl) {\n        if (!$spl->isFile()) continue;\n        $path = wp_normalize_path($spl->getPathname());\n        $rel  = ltrim(str_replace($base, '', $path), '\/');\n\n        if (preg_match(WTP_EXCLUDE_RX, $rel)) continue;\n        if (preg_match(WTP_EXCLUDE_FILE_RX, $rel)) continue;\n\n        $ext = strtolower(pathinfo($rel, PATHINFO_EXTENSION));\n        if (!in_array($ext, WTP_ALLOWED_EXT, true)) continue;\n\n        $content = @file_get_contents($path);\n        if ($content === false) continue;\n\n        $key = trim($prefix, '\/').'\/'.$rel; \/\/ np. \"plugins\/akismet\/akismet.php\"\n        $out[$key] = $content;\n    }\n    return $out;\n}\n\n\/** \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *  CHUNKING: dzieli map\u0119 (k=>v) na paczki < limit (po JSON-encode)\n *  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nfunction wtp_chunk_map(array $map, int $targetBytes) {\n    $chunks = [];\n    $current = [];\n    $approxBytes = 2; \/\/ nawiasy {}\n\n    foreach ($map as $k => $v) {\n        \/\/ oszacuj rozmiar przy JSON (klucz+warto\u015b\u0107 jako string) \u2013 z SUBSTITUE dla bezpiecze\u0144stwa\n        $entryJson   = json_encode([$k => $v], JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_INVALID_UTF8_SUBSTITUTE);\n        $entryBytes  = strlen($entryJson) + 1;\n\n        if ($approxBytes + $entryBytes > $targetBytes && !empty($current)) {\n            $chunks[] = $current;\n            $current = [];\n            $approxBytes = 2;\n        }\n        $current[$k] = $v;\n        $approxBytes += $entryBytes;\n    }\n    if (!empty($current)) $chunks[] = $current;\n    return $chunks;\n}\n\n\/** \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n *  PUSH: pliki chunk\u00f3w + indeks do GitHub (contents API)\n *  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 *\/\nfunction wtp_push_chunks_and_index_to_github(array $chunks) {\n    $owner  = constant('WTP_GH_OWNER');\n    $repo   = constant('WTP_GH_REPO');\n    $branch = defined('WTP_GH_BRANCH') ? constant('WTP_GH_BRANCH') : 'main';\n    $token  = constant('WTP_GH_TOKEN');\n\n    $pushed = [];\n    foreach ($chunks as $i => $payloadMap) {\n        $payload = json_encode(\n            $payloadMap,\n            JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT|JSON_INVALID_UTF8_SUBSTITUTE\n        );\n        $path    = sprintf('%s_%03d.json', WTP_CHUNK_BASENAME, $i);\n        $put     = wtp_gh_put_file($owner, $repo, $branch, $token, $path, $payload, 'Update '.$path.' (chunk)');\n        if ($put['code'] >= 300) {\n            return new WP_Error('wtp_github_put', 'GitHub PUT error '.$put['code'].': '.json_encode($put['body']));\n        }\n        $pushed[] = [\n            'path' => $path,\n            'size' => strlen($payload),\n            'sha1' => sha1($payload),\n            'raw'  => \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/{$path}\"\n        ];\n    }\n\n    \/\/ Zbuduj indeks\n    $index = [\n        'version'      => 1,\n        'generated_at' => time(),\n        'chunks'       => $pushed,\n        'total_chunks' => count($pushed),\n    ];\n    $indexJson = json_encode($index, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE|JSON_PRETTY_PRINT);\n    $putIndex  = wtp_gh_put_file($owner, $repo, $branch, $token, WTP_INDEX_PATH, $indexJson, 'Update '.WTP_INDEX_PATH.' (index)');\n    if ($putIndex['code'] >= 300) {\n        return new WP_Error('wtp_github_put', 'GitHub PUT index error '.$putIndex['code'].': '.json_encode($putIndex['body']));\n    }\n\n    return [\n        'index_raw_url' => \"https:\/\/raw.githubusercontent.com\/{$owner}\/{$repo}\/{$branch}\/\".WTP_INDEX_PATH,\n        'chunks'        => $pushed,\n    ];\n}\n\nfunction wtp_gh_put_file($owner,$repo,$branch,$token,$path,$content,$message) {\n    $api = \"https:\/\/api.github.com\/repos\/{$owner}\/{$repo}\/contents\/{$path}\";\n    \/\/ get sha if exists\n    $sha = null;\n    $get = wtp_http('GET', $api.'?ref='.rawurlencode($branch), $token, null);\n    if ($get['code'] === 200 && !empty($get['body']['sha'])) $sha = $get['body']['sha'];\n\n    $body = [\n        'message' => $message,\n        'content' => base64_encode($content),\n        'branch'  => $branch,\n    ];\n    if ($sha) $body['sha'] = $sha;\n\n    return wtp_http('PUT', $api, $token, $body);\n}\n\nfunction wtp_http($method, $url, $token, $json) {\n    $args = [\n        'method'  => $method,\n        'headers' => [\n            'Authorization' => 'token '.$token,\n            'User-Agent'    => 'WTP-Exporter-Chunked',\n            'Accept'        => 'application\/vnd.github+json',\n        ],\n        'timeout' => 30,\n    ];\n    if ($json !== null) {\n        $args['body'] = json_encode($json);\n        $args['headers']['Content-Type'] = 'application\/json';\n    }\n    $res  = wp_remote_request($url, $args);\n    $code = wp_remote_retrieve_response_code($res);\n    $body = json_decode(wp_remote_retrieve_body($res), true);\n    return ['code'=>$code, 'body'=>$body];\n}"}]