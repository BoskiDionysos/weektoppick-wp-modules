<?php /**  * WTP Core Theme — SAFE functions.php  * - Brak BOM, brak zamykającego tagu, zero outputu z poziomu tego pliku.  * - ŻADNYCH include/require — najpierw stawiamy WP.  * - Dodany shortcode [wtp_top3] z bezpiecznym renderem (fallback, bez zewn. CSS).  */  if (!defined('ABSPATH')) { exit; }  // 1) Minimalne wsparcia motywu add_action('after_setup_theme', function () {     add_theme_support('title-tag');     add_theme_support('post-thumbnails');     add_theme_support('html5', ['search-form','gallery','caption','style','script']); }, 0);  // 2) Minimalne enqueue (na razie nic krytycznego) add_action('wp_enqueue_scripts', function () {     // CSS/JS dołożymy po stabilizacji — unikamy teraz 404/konfliktów. }, 10);  // 3) Shortcode [wtp_top3] — bezpieczny render 3 postów z tagiem "wtp-top3" function wtp_render_top3_shortcode($atts = []) {     if (!class_exists('WP_Query')) {         return '';     }      $q = new WP_Query([         'posts_per_page'   => 3,         'tag'              => 'wtp-top3',         'ignore_sticky_posts' => true,         'no_found_rows'    => true,         'post_status'      => 'publish',     ]);      ob_start();     ?>     <section class="wtp-top3 container">       <div class="hero">         <span class="badge"><?php echo esc_html__('This week', 'wtp-core-theme'); ?></span>         <h1><?php echo esc_html__('Top 3 picks', 'wtp-core-theme'); ?></h1>         <p><?php echo esc_html__('Best weekly deals curated for your region.', 'wtp-core-theme'); ?></p>       </div>        <div class="grid">       <?php if ( $q->have_posts() ) : while ( $q->have_posts() ) : $q->the_post(); ?>         <article class="card">           <?php if ( has_post_thumbnail() ) {               the_post_thumbnail('medium_large', ['style' => 'width:100%;height:auto;border-radius:8px;']);           } ?>           <h3><a href="<?php echo esc_url( get_permalink() ); ?>"><?php the_title(); ?></a></h3>           <p><?php echo esc_html( wp_trim_words( get_the_excerpt() ?: wp_strip_all_tags( get_the_content() ), 22 ) ); ?></p>           <a class="button" href="<?php echo esc_url( get_permalink() ); ?>">             <?php echo esc_html__('View deal', 'wtp-core-theme'); ?>           </a>         </article>       <?php endwhile; wp_reset_postdata(); else: ?>         <article class="card">           <h3><?php echo esc_html__('No picks yet', 'wtp-core-theme'); ?></h3>           <p><?php echo esc_html__('Check back soon.', 'wtp-core-theme'); ?></p>         </article>       <?php endif; ?>       </div>     </section>     <?php     return ob_get_clean(); } add_shortcode('wtp_top3', 'wtp_render_top3_shortcode');  // 4) Zero dodatkowych hooków na razie – najpierw stawiamy stabilność.